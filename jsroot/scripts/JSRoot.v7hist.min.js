var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(f){var q=0;return function(){return q<f.length?{done:!1,value:f[q++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.makeIterator=function(f){var q="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return q?q.call(f):$jscomp.arrayIterator(f)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,q,x){f!=Array.prototype&&f!=Object.prototype&&(f[q]=x.value)};
$jscomp.polyfill=function(f,q,x,k){if(q){x=$jscomp.global;f=f.split(".");for(k=0;k<f.length-1;k++){var u=f[k];u in x||(x[u]={});x=x[u]}f=f[f.length-1];k=x[f];q=q(k);q!=k&&null!=q&&$jscomp.defineProperty(x,f,{configurable:!0,writable:!0,value:q})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(f){function q(){this.batch_=null}function x(C){return C instanceof u?C:new u(function(f,k){f(C)})}if(f&&!$jscomp.FORCE_POLYFILL_PROMISE)return f;q.prototype.asyncExecute=function(C){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(C)};var k=$jscomp.global.setTimeout;q.prototype.asyncExecuteFunction=function(C){k(C,0)};q.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var C=
this.batch_;this.batch_=[];for(var f=0;f<C.length;++f){var k=C[f];C[f]=null;try{k()}catch(a){this.asyncThrow_(a)}}}this.batch_=null};q.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var u=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var C=this.createResolveAndReject_();try{f(C.resolve,C.reject)}catch(I){C.reject(I)}};u.prototype.createResolveAndReject_=function(){function f(a){return function(b){q||(q=!0,a.call(k,b))}}var k=this,q=!1;
return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};u.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof u)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var k=null!=f;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(f):this.fulfill_(f)}};u.prototype.resolveToNonPromiseObj_=function(f){var k=void 0;try{k=f.then}catch(I){this.reject_(I);return}"function"==typeof k?
this.settleSameAsThenable_(k,f):this.fulfill_(f)};u.prototype.reject_=function(f){this.settle_(2,f)};u.prototype.fulfill_=function(f){this.settle_(1,f)};u.prototype.settle_=function(f,k){if(0!=this.state_)throw Error("Cannot settle("+f+", "+k+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=k;this.executeOnSettledCallbacks_()};u.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)z.asyncExecute(this.onSettledCallbacks_[f]);
this.onSettledCallbacks_=null}};var z=new q;u.prototype.settleSameAsPromise_=function(f){var k=this.createResolveAndReject_();f.callWhenSettled_(k.resolve,k.reject)};u.prototype.settleSameAsThenable_=function(f,k){var q=this.createResolveAndReject_();try{f.call(k,q.resolve,q.reject)}catch(a){q.reject(a)}};u.prototype.then=function(f,k){function q(c,n){return"function"==typeof c?function(d){try{a(c(d))}catch(g){b(g)}}:n}var a,b,c=new u(function(c,n){a=c;b=n});this.callWhenSettled_(q(f,a),q(k,b));return c};
u.prototype.catch=function(f){return this.then(void 0,f)};u.prototype.callWhenSettled_=function(f,k){function q(){switch(a.state_){case 1:f(a.result_);break;case 2:k(a.result_);break;default:throw Error("Unexpected state: "+a.state_);}}var a=this;null==this.onSettledCallbacks_?z.asyncExecute(q):this.onSettledCallbacks_.push(q)};u.resolve=x;u.reject=function(f){return new u(function(k,q){q(f)})};u.race=function(f){return new u(function(k,q){for(var a=$jscomp.makeIterator(f),b=a.next();!b.done;b=a.next())x(b.value).callWhenSettled_(k,
q)})};u.all=function(f){var k=$jscomp.makeIterator(f),q=k.next();return q.done?x([]):new u(function(a,b){function c(b){return function(c){d[b]=c;n--;0==n&&a(d)}}var d=[],n=0;do d.push(void 0),n++,x(q.value).callWhenSettled_(c(d.length-1),b),q=k.next();while(!q.done)})};return u},"es6","es3");$jscomp.polyfill("Number.isFinite",function(f){return f?f:function(f){return"number"!==typeof f?!1:!isNaN(f)&&Infinity!==f&&-Infinity!==f}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(f,q){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:q})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function f(x){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(x||"")+"_"+q++,x)}var q=0;return f}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.asyncIterator;f||(f=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};
$jscomp.iteratorFromArray=function(f,q){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var x=0,k={next:function(){if(x<f.length){var u=x++;return{value:q(u,f[u]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};$jscomp.polyfill("Array.prototype.entries",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f,x){return[f,x]})}},"es6","es3");
JSROOT.define(["d3","painter","v7gpad"],function(f,q){function x(a){"ROOT::Experimental::RAxisEquidistant"==a._typename||"ROOT::Experimental::RAxisLabels"==a._typename?(0===a.fInvBinWidth&&(a.$dummy=!0,a.fInvBinWidth=1,a.fNBinsNoOver=0,a.fLow=0),a.min=a.fLow,a.max=a.fLow+a.fNBinsNoOver/a.fInvBinWidth,a.GetNumBins=function(){return this.fNBinsNoOver},a.GetBinCoord=function(a){return this.fLow+a/this.fInvBinWidth},a.FindBin=function(a,c){return Math.floor((a-this.fLow)*this.fInvBinWidth+c)}):"ROOT::Experimental::RAxisIrregular"==
a._typename&&(a.min=a.fBinBorders[0],a.max=a.fBinBorders[a.fBinBorders.length-1],a.GetNumBins=function(){return this.fBinBorders.length},a.GetBinCoord=function(a){var c=Math.round(a);if(0>=c)return this.fBinBorders[0];if(c>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(c==a)return this.fBinBorders[c];var b=a<c?c-1:c+1;return this.fBinBorders[c]*Math.abs(a-b)+this.fBinBorders[b]*Math.abs(a-c)},a.FindBin=function(a,c){for(var b=1;b<this.fBinBorders.length;++b)if(a<this.fBinBorders[b])return Math.floor(b-
1+c);return this.fBinBorders.length-1});a.GetBinCenter=function(a){return this.GetBinCoord(a-.5)};a.GetBinLowEdge=function(a){return this.GetBinCoord(a-1)}}function k(a,b){JSROOT.ObjectPainter.call(this,a,b);this.csstype="hist";this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.getHisto(!0)}function u(a,b){k.call(this,a,b);this.wheel_zoomy=!1}function z(a,b){k.call(this,a,b);this.wheel_zoomy=!0}function C(a,b,c){JSROOT.v7.RPavePainter.call(this,a,b,c,"stats")}
k.prototype=Object.create(JSROOT.ObjectPainter.prototype);k.prototype.isDisplayItem=function(){var a=this.getObject();return a&&a.fAxes?!0:!1};k.prototype.getHisto=function(a){var b=this.getObject(),c=b&&b.fHistImpl?b.fHistImpl.fIO:null;!c||c.getBinContent&&!a?!c&&b&&b.fAxes&&(c=b,!c.getBinContent||a)&&(3==c.fAxes.length?(x(c.fAxes[0]),x(c.fAxes[1]),x(c.fAxes[2]),c.nx=c.fIndicies[1]-c.fIndicies[0],c.dx=c.fIndicies[0]+1,c.stepx=c.fIndicies[2],c.ny=c.fIndicies[4]-c.fIndicies[3],c.dy=c.fIndicies[3]+
1,c.stepy=c.fIndicies[5],c.nz=c.fIndicies[7]-c.fIndicies[6],c.dz=c.fIndicies[6]+1,c.stepz=c.fIndicies[8],c.getBin=function(a,c,b){return a-1+this.fAxes[0].GetNumBins()*(c-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(b-1)},c.getBin0=1<c.stepx||1<c.stepy||1<c.stepz?function(a,c,b){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((c-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((b-this.dz)/this.stepz)}:function(a,c,b){return a-this.dx+this.nx*
(c-this.dy)+this.nx*this.ny*(b-dz)},c.getBinContent=function(a,c,b){return this.fBinContent[this.getBin0(a,c,b)]},c.getBinError=function(a,c,b){return Math.sqrt(Math.abs(this.getBinContent(a,c,b)))}):2==c.fAxes.length?(x(c.fAxes[0]),x(c.fAxes[1]),c.nx=c.fIndicies[1]-c.fIndicies[0],c.dx=c.fIndicies[0]+1,c.stepx=c.fIndicies[2],c.ny=c.fIndicies[4]-c.fIndicies[3],c.dy=c.fIndicies[3]+1,c.stepy=c.fIndicies[5],c.getBin=function(a,c){return a-1+this.fAxes[0].GetNumBins()*(c-1)},c.getBin0=1<c.stepx||1<c.stepy?
function(a,c){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((c-this.dy)/this.stepy)}:function(a,c){return a-this.dx+this.nx*(c-this.dy)},c.getBinContent=function(a,c){return this.fBinContent[this.getBin0(a,c)]},c.getBinError=function(a,c){return Math.sqrt(Math.abs(this.getBinContent(a,c)))}):(x(c.fAxes[0]),c.nx=c.fIndicies[1]-c.fIndicies[0],c.dx=c.fIndicies[0]+1,c.stepx=c.fIndicies[2],c.getBin=function(a){return a-1},c.getBin0=1<c.stepx?function(a){return Math.floor((a-this.dx)/
this.stepx)}:function(a){return a-this.dx},c.getBinContent=function(a){return this.fBinContent[this.getBin0(a)]},c.getBinError=function(a){return Math.sqrt(Math.abs(this.getBinContent(a)))})):c.fAxes._2?(x(c.fAxes._0),x(c.fAxes._1),x(c.fAxes._2),c.getBin=function(a,c,b){return a-1+this.fAxes._0.GetNumBins()*(c-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(b-1)},c.getBinContent=function(a,c,b){return this.fStatistics.fBinContent[this.getBin(a,c,b)]},c.getBinError=function(a,c,b){a=this.getBin(a,
c,b);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):c.fAxes._1?(x(c.fAxes._0),x(c.fAxes._1),c.getBin=function(a,c){return a-1+this.fAxes._0.GetNumBins()*(c-1)},c.getBinContent=function(a,c){return this.fStatistics.fBinContent[this.getBin(a,c)]},c.getBinError=function(a,c){a=this.getBin(a,c);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):
(x(c.fAxes._0),c.getBin=function(a){return a-1},c.getBinContent=function(a){return this.fStatistics.fBinContent[a-1]},c.getBinError=function(a){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a-1]))});return c};k.prototype.isRProfile=function(){return!1};k.prototype.isRH2Poly=function(){return!1};k.prototype.decodeOptions=function(){this.options||(this.options={Hist:1})};k.prototype.copyOptionsFrom=function(a){a!==
this&&(this.options.Mode3D=a.options.Mode3D)};k.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(b){b!==a&&"function"==typeof b.copyOptionsFrom&&b.copyOptionsFrom(a)},"objects")};k.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};k.prototype.cleanup=function(){this.clear3DScene();delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};k.prototype.getDimension=function(){return 1};
k.prototype.scanContent=function(){};k.prototype.drawFrameAxes=function(){var a=this.getFramePainter();if(!a)return Promise.resolve(!1);if(!this.isMainPainter()||!this.draw_content)return Promise.resolve(!0);a.cleanupAxes();a.xmin=a.xmax=0;a.ymin=a.ymax=0;a.zmin=a.zmax=0;a.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax);return a.drawAxes()};k.prototype.createHistDrawAttributes=function(){this.createv7AttFill();this.createv7AttLine()};
k.prototype.updateDisplayItem=function(a,b){if(!a||!b)return!1;a.fAxes=b.fAxes;a.fIndicies=b.fIndicies;a.fBinContent=b.fBinContent;a.fContMin=b.fContMin;a.fContMinPos=b.fContMinPos;a.fContMax=b.fContMax;this.getHisto(!0);return!0};k.prototype.updateObject=function(a){var b=this.getObject();if(a!==b){if(!this.matchObjectType(a))return!1;if(this.isDisplayItem())this.updateDisplayItem(b,a);else{var c=b&&b.fHistImpl?b.fHistImpl.fIO:null,d=a&&a.fHistImpl?a.fHistImpl.fIO:null;if(!c||!d)return!1;c.fStatistics=
d.fStatistics;b.fTitle=a.fTitle}}this.scanContent();return this.histogram_updated=!0};k.prototype.getAxis=function(a){var b=this.getHisto(),c=this.getObject(),d=null;if(c&&c.fAxes)switch(a){case "x":d=c.fAxes[0];break;case "y":d=c.fAxes[1];break;case "z":d=c.fAxes[2];break;default:d=c.fAxes[0]}else if(b&&b.fAxes)switch(a){case "x":d=b.fAxes._0;break;case "y":d=b.fAxes._1;break;case "z":d=b.fAxes._2;break;default:d=b.fAxes._0}d&&!d.GetBinCoord&&x(d);return d};k.prototype.getAxisBinTip=function(a,b,
c){var d=this.getFramePainter(),n=d[a+"_handle"],l=this.getAxis(a),g=l.GetBinCoord(b);if("labels"===n.kind)return d.axisAsText(a,g);b=l.GetBinCoord(b+(c||1));return"time"===n.kind?d.axisAsText(a,(g+b)/2):"["+d.axisAsText(a,g)+", "+d.axisAsText(a,b)+")"};k.prototype.extractAxesProperties=function(a){if(this.getHisto()){this.nbinsx=this.nbinsy=this.nbinsz=0;var b=this.getAxis("x");this.nbinsx=b.GetNumBins();this.xmin=b.min;this.xmax=b.max;2>a||(b=this.getAxis("y"),this.nbinsy=b.GetNumBins(),this.ymin=
b.min,this.ymax=b.max,3>a||(b=this.getAxis("z"),this.nbinsz=b.GetNumBins(),this.zmin=b.min,this.zmax=b.max))}};k.prototype.addInteractivity=function(){if(JSROOT.batch_mode||!this.isMainPainter())return!0;var a=this.getFramePainter();return a?a.addInteractivity():!1};k.prototype.processItemReply=function(a,b){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");b.reqid===this.current_item_reqid&&(null!==a&&this.updateDisplayItem(this.getObject(),a.item),b.resolveFunc(!0))};
k.prototype.drawingBins=function(a){var b=this,c=!1;a&&"string"==typeof a&&0==a.indexOf("zoom")&&(0<a.indexOf("0")&&(c=!0),1<this.getDimension()&&0<a.indexOf("1")&&(c=!0),2<this.getDimension()&&0<a.indexOf("2")&&(c=!0));return this.isDisplayItem()&&c&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&this.prepareDraw({only_indexes:!0}).incomplete?new Promise(function(a){var c=b.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},b.processItemReply.bind(b));c?(b.current_item_reqid=
c.reqid,c.resolveFunc=a,setTimeout(b.processItemReply.bind(b,null,c),1E3)):a(!0)}):Promise.resolve(!0)};k.prototype.toggleStat=function(){};k.prototype.getSelectIndex=function(a,b,c){var d=this.getFramePainter(),n=this.getAxis(a),l=this["nbins"+a]||0,g=d?d["zoom_"+a+"min"]:0;a=d?d["zoom_"+a+"max"]:0;g!==a&&n?(b="left"==b?n.FindBin(g,c||0):n.FindBin(a,(c||0)+.5),0>b?b=0:b>l&&(b=l)):b="left"==b?0:l;return b};k.prototype.clickButton=function(a){switch(a){case "ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||
this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax)return this.unzoom(),this.getFramePainter().zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),!0;break;case "ToggleLogX":this.getFramePainter().toggleAxisLog("x");break;case "ToggleLogY":this.getFramePainter().toggleAxisLog("y");break;case "ToggleLogZ":this.getFramePainter().toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};k.prototype.fillToolbar=
function(a){var b=this.getPadPainter();b&&(b.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),b.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),b.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&b.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&b.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||b.showPadButtons())};k.prototype.get3DToolTip=function(a){var b=this.getHisto(),
c={bin:a,name:b.fName||"histo",title:b.fTitle};switch(this.getDimension()){case 1:c.ix=a+1;c.iy=1;c.value=b.getBinContent(c.ix);c.error=b.getBinError(c.ix);c.lines=this.getBinTooltips(a-1);break;case 2:c.ix=a%this.nbinsx+1;c.iy=(a-(c.ix-1))/this.nbinsx+1;c.value=b.getBinContent(c.ix,c.iy);c.error=b.getBinError(c.ix,c.iy);c.lines=this.getBinTooltips(c.ix-1,c.iy-1);break;case 3:c.ix=a%this.nbinsx+1,c.iy=(a-(c.ix-1))/this.nbinsx%this.nbinsy+1,c.iz=(a-(c.ix-1)-(c.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+
1,c.value=b.getBinContent(c.ix,c.iy,c.iz),c.error=b.getBinError(c.ix,c.iy,c.iz),c.lines=this.getBinTooltips(c.ix-1,c.iy-1,c.iz-1)}return c};k.prototype.createContour=function(a,b,c){if(a&&b){c||(c={});var d=JSROOT.gStyle.fNumberContours,n=this.minbin,l=this.maxbin,g=this.minposbin;c.scatter_plot&&(50<d&&(d=50),n=this.minposbin);n===l&&(n=this.gminbin,l=this.gmaxbin,g=this.gminposbin);3>this.getDimension()&&(a.zoom_zmin!==a.zoom_zmax?(n=a.zoom_zmin,l=a.zoom_zmax):c.full_z_range&&(n=a.zmin,l=a.zmax));
b.createContour(a.logz,d,n,l,g);3>this.getDimension()&&(a.scale_zmin=b.colzmin,a.scale_zmax=b.colzmax)}};k.prototype.changeValuesRange=function(a,b){var c=this.getFramePainter();if(c){var d=c.isAxisZoomed(b)?"zoom_"+b:b;a.input("Enter values range for axis "+b+" like [0,100] or empty string to unzoom","["+c[d+"min"]+","+c[d+"max"]+"]").then(function(a){(a=a?JSON.parse(a):[])&&"object"==typeof a&&2==a.length&&Number.isFinite(a[0])&&Number.isFinite(a[1])?c.zoom(b,a[0],a[1]):c.unzoom(b)})}};k.prototype.fillContextMenu=
function(a){var b=this;a.add("header:v7histo::anyname");this.draw_content&&(a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return b.toggleStat()}),2==this.getDimension()&&a.add("Values range",function(){return b.changeValuesRange(a,"z")}),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));var c=this.getFramePainter();if(this.options.Mode3D){0<a.size()&&a.add("separator");var d=this.getMainPainter()||this;a.addchk(d.isTooltipAllowed(),"Show tooltips",function(){return d.setTooltipAllowed("toggle")});
a.addchk(c.enable_highlight,"Highlight bins",function(){c.enable_highlight=!c.enable_highlight;!c.enable_highlight&&d.highlightBin3D&&d.mode3d&&d.highlightBin3D(null)});c&&c.render3D&&(a.addchk(d.options.FrontBox,"Front box",function(){d.options.FrontBox=!d.options.FrontBox;c.render3D()}),a.addchk(d.options.BackBox,"Back box",function(){d.options.BackBox=!d.options.BackBox;c.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){b.options.Zero=!b.options.Zero;b.redrawPad()}),
12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){return b.toggleColz()}),this.fillPaletteMenu&&this.fillPaletteMenu(a));d.control&&"function"===typeof d.control.reset&&a.add("Reset camera",function(){return d.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&c.zoomChangedInteractive()&&a.add("Let update zoom",function(){return c.zoomChangedInteractive("reset")});return!0};k.prototype.updatePaletteDraw=function(){if(this.isMainPainter()){var a=
this.getPadPainter().findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");a&&a.drawPalette()}};k.prototype.fillPaletteMenu=function(a){function b(a){n.options.Palette=parseInt(a);n.redraw()}function c(c,n,p){a.addchk(c===d||p,"<nobr>"+n+"</nobr>",c,b)}var d=this.options.Palette,n=this;if(null===d||0===d)d=JSROOT.settings.Palette;a.add("sub:Palette");c(50,"ROOT 5",10<=d&&51>d);c(51,"Deep Sea");c(52,"Grayscale",0<d&&10>d);c(53,"Dark body radiator");c(54,"Two-color hue");c(55,"Rainbow");
c(56,"Inverted dark body radiator");c(57,"Bird",112<d);c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,"Alpine");c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");a.add("endsub:")};k.prototype.drawColorPalette=function(){return null};k.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=
!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)};k.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad","drawopt")};k.prototype.prepareDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===
a.extra&&(a.extra=0);void 0===a.right_extra&&(a.right_extra=a.extra);void 0===a.middle&&(a.middle=0);var b=this.getHisto(),c=this.getAxis("x"),d=this.getAxis("y"),n=this.getFramePainter(),l=this.getDimension(),g,p,e={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.right_extra),j1:2>l?0:this.getSelectIndex("y","left",0-a.extra),j2:2>l?1:this.getSelectIndex("y","right",1+a.right_extra),k1:3>l?0:this.getSelectIndex("z","left",0-a.extra),k2:3>l?1:this.getSelectIndex("z",
"right",1+a.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};this.isDisplayItem()&&b.fIndicies&&(e.i1<b.fIndicies[0]&&(e.i1=b.fIndicies[0],e.incomplete=!0),e.i2>b.fIndicies[1]&&(e.i2=b.fIndicies[1],e.incomplete=!0),e.stepi=b.fIndicies[2],1<e.stepi&&(e.incomplete=!0),1<l&&5<b.fIndicies.length&&(e.j1<b.fIndicies[3]&&(e.j1=b.fIndicies[3],e.incomplete=!0),e.j2>b.fIndicies[4]&&(e.j2=b.fIndicies[4],e.incomplete=!0),e.stepj=b.fIndicies[5],1<e.stepj&&(e.incomplete=
!0)),2<l&&8<b.fIndicies.length&&(e.k1<b.fIndicies[6]&&(e.k1=b.fIndicies[6],e.incomplete=!0),e.k2>b.fIndicies[7]&&(e.k2=b.fIndicies[7],e.incomplete=!0),e.stepk=b.fIndicies[8],1<e.stepk&&(e.incomplete=!0)));if(a.only_indexes)return e;e.grx=Array(e.i2+e.stepi+1);e.gry=Array(e.j2+e.stepj+1);a.original&&(e.original=!0,e.origx=Array(e.i2+1),e.origy=Array(e.j2+1));a.pixel_density&&(a.rounding=!0);for(g=e.i1;g<=e.i2;++g){var w=c.GetBinCoord(g+a.middle);n.logx&&0>=w?e.i1=g+1:(e.origx&&(e.origx[g]=w),e.grx[g]=
n.grx(w),a.rounding&&(e.grx[g]=Math.round(e.grx[g])),a.use3d&&(e.grx[g]<-n.size_xy3d&&(e.i1=g,e.grx[g]=-n.size_xy3d),e.grx[g]>n.size_xy3d&&(e.i2=g,e.grx[g]=n.size_xy3d)))}a.use3d&&(e.i1<e.i2-2&&e.grx[e.i1]==e.grx[e.i1+1]&&e.i1++,e.i1<e.i2-2&&e.grx[e.i2-1]==e.grx[e.i2]&&e.i2--);for(;g<e.i2+e.stepi+1;)e.grx[g++]=e.grx[e.i2];if(1===l)e.gry[0]=n.gry(0),e.gry[1]=n.gry(1);else for(p=e.j1;p<=e.j2;++p)g=d.GetBinCoord(p+a.middle),n.logy&&0>=g?e.j1=p+1:(e.origy&&(e.origy[p]=g),e.gry[p]=n.gry(g),a.rounding&&
(e.gry[p]=Math.round(e.gry[p])),a.use3d&&(e.gry[p]<-n.size_xy3d&&(e.j1=p,e.gry[p]=-n.size_xy3d),e.gry[p]>n.size_xy3d&&(e.j2=p,e.gry[p]=n.size_xy3d)));a.use3d&&1<l&&(e.j1<e.j2-2&&e.gry[e.j1]==e.gry[e.j1+1]&&e.j1++,e.j1<e.j2-2&&e.gry[e.j2-1]==e.gry[e.j2]&&e.j2--);for(;1<l&&p<e.j2+e.stepj+1;)e.gry[p++]=e.gry[e.j2];this.maxbin=this.minbin=this.minposbin=null;for(g=e.i1;g<e.i2;g+=e.stepi)for(p=e.j1;p<e.j2;p+=e.stepj)if(d=b.getBinContent(g+1,p+1),Number.isFinite(d)){e.sumz+=d;if(a.pixel_density){l=(e.grx[g+
e.stepi]-e.grx[g])*(e.gry[p]-e.gry[p+e.stepj]);if(0>=l)continue;e.max=Math.max(e.max,d);0<d&&(d<e.min||0===e.min)&&(e.min=d);d/=l}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}e.palette=n.getHistPalette();e.palette&&this.createContour(n,e.palette,a);return e};u.prototype=Object.create(k.prototype);u.prototype.scanContent=function(a){var b=this.getHisto();if(b){!this.nbinsx&&
a&&(a=!1);a||this.extractAxesProperties(1);var c=0,d=0,n=0,l=0;if(this.isDisplayItem())c=b.fContMin,d=b.fContMinPos,l=n=b.fContMax;else{var g=this.getSelectIndex("x","left"),p=this.getSelectIndex("x","right");if(a&&g===this.scan_xleft&&p===this.scan_xright)return;this.scan_xleft=g;this.scan_xright=p;a=!0;for(var e,w=0;w<this.nbinsx;++w)e=b.getBinContent(w+1),l+=e,w<g||w>=p||(0<e&&(0==d||e<d)&&(d=e),a&&(c=n=e,a=!1),c=Math.min(c,e-0),n=Math.max(n,e+0))}this.stat_entries=l;this.hmin=c;this.hmax=n;this.ymin_nz=
d;if(this.draw_content=0==this.nbinsx||1E-300>Math.abs(c)&&1E-300>Math.abs(n)?!1:!0)c>=n?0==c?(this.ymin=0,this.ymax=1):0>c?(this.ymin=2*c,this.ymax=0):(this.ymin=0,this.ymax=2*c):(b=.05*(n-c),this.ymin=c-b,0>this.ymin&&0<=c&&(this.ymin=0),this.ymax=n+b)}};u.prototype.countStat=function(a){for(var b=this.isRProfile(),c=this.getHisto(),d=this.getAxis("x"),n=this.getSelectIndex("x","left"),l=this.getSelectIndex("x","right"),g=0,p=0,e=0,w=0,m=0,h,A,F=null,r=null,t=this.getFramePainter(),f={name:"histo",
meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};n<l;++n)if(h=d.GetBinCoord(n+.5),!a||a(h)){b?(A=c.fBinEntries[n+1],w+=c.fArray[n+1],m+=c.fSumw2[n+1]):A=c.getBinContent(n+1);if(null===F||A>r)F=h,r=A;g+=A;p+=A*h;e+=A*h*h}!t.isAxisZoomed("x")&&c.fTsumw&&(g=c.fTsumw,p=c.fTsumwx,e=c.fTsumwx2);f.integral=g;0<g&&(f.meanx=p/g,f.meany=w/g,f.rmsx=Math.sqrt(Math.abs(e/g-f.meanx*f.meanx)),f.rmsy=Math.sqrt(Math.abs(m/g-f.meany*f.meany)));null!==F&&(f.xmax=F,f.wmax=r);return f};
u.prototype.fillStatistic=function(a,b){var c=this.countStat(),d=b%10,n=Math.floor(b/10)%10,l=Math.floor(b/100)%10,g=Math.floor(b/1E3)%10,p=Math.floor(b/1E4)%10,e=Math.floor(b/1E5)%10,w=Math.floor(b/1E6)%10,m=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.clearStat();0<d&&a.addText(c.name);this.isRProfile()?(0<n&&a.addText("Entries = "+a.format(c.entries,"entries")),0<l&&(a.addText("Mean = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany))),0<g&&(a.addText("Std Dev = "+a.format(c.rmsx)),
a.addText("Std Dev y = "+a.format(c.rmsy)))):(0<n&&a.addText("Entries = "+a.format(c.entries,"entries")),0<l&&a.addText("Mean = "+a.format(c.meanx)),0<g&&a.addText("Std Dev = "+a.format(c.rmsx)),0<p&&a.addText("Underflow = "+a.format(histo.getBinContent(0),"entries")),0<e&&a.addText("Overflow = "+a.format(histo.getBinContent(this.nbinsx+1),"entries")),0<w&&a.addText("Integral = "+a.format(c.integral,"entries")),0<m&&a.addText("Skew = <not avail>"),0<b&&a.addText("Kurt = <not avail>"));return!0};u.prototype.drawBars=
function(a,b,c){this.createG(!0);var d=a.i1;b=a.i2;a=a.stepi;var n=this.getFramePainter(),l=this.getHisto(),g=this.getAxis("x"),p="",e="",w="";c=n.swap_xy?0:c;for(Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=n.scale_ymin&&(c=Math.round(n.gry(this.options.BaseLine)));d<b;d+=a){var m=g.GetBinCoord(d);var h=g.GetBinCoord(d+a);if(!(n.logx&&0>=h)){m=Math.round(n.grx(m));h=Math.round(n.grx(h));var A=l.getBinContent(d+1);if(!(n.logy&&A<n.scale_ymin)){A=Math.round(n.gry(A));var F=h-m;m+=
Math.round(this.options.BarOffset*F);F=Math.round(this.options.BarWidth*F);p=n.swap_xy?p+("M"+c+","+m+"h"+(A-c)+"v"+F+"h"+(c-A)+"z"):p+("M"+m+","+A+"h"+F+"v"+(c-A)+"h"+-F+"z");0<this.options.BarStyle&&(h=m+F,F=Math.round(F/10),n.swap_xy?(e+="M"+c+","+m+"h"+(A-c)+"v"+F+"h"+(c-A)+"z",w+="M"+c+","+h+"h"+(A-c)+"v"+-F+"h"+(c-A)+"z"):(e+="M"+m+","+A+"h"+F+"v"+(c-A)+"h"+-F+"z",w+="M"+h+","+A+"h"+-F+"v"+(c-A)+"h"+F+"z"))}}}this.fillatt.empty()&&this.fillatt.setSolidColor("blue");0<p.length&&this.draw_g.append("svg:path").attr("d",
p).call(this.fillatt.func);0<e.length&&this.draw_g.append("svg:path").attr("d",e).call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).brighter(.5).toString());0<w.length&&this.draw_g.append("svg:path").attr("d",w).call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).darker(.5).toString())};u.prototype.drawFilledErrors=function(a){this.createG(!0);var b=a.i1,c=a.i2,d=a.stepi,n=this.getFramePainter(),l=this.getHisto(),g=this.getAxis("x"),p=[];for(a=[];b<c;b+=d){var e=g.GetBinCoord(b+
.5);if(!(n.logx&&0>=e)){e=Math.round(n.grx(e));var w=l.getBinContent(b+1);var m=l.getBinError(b+1);if(!(n.logy&&w-m<n.scale_ymin)){var h=Math.round(n.gry(w+m));w=Math.round(n.gry(w-m));p.push({grx:e,gry:h});a.unshift({grx:e,gry:w})}}}c=4===this.options.ErrorKind?"bezier":"line";p=q.buildSvgPath(c,p);a=q.buildSvgPath("L"+c,a);this.fillatt.empty()&&this.fillatt.setSolidColor("blue");this.draw_g.append("svg:path").attr("d",p.path+a.path+"Z").style("stroke","none").call(this.fillatt.func)};u.prototype.draw1DBins=
function(){var a=this.getFramePainter().getFrameRect();if(!this.draw_content||0>=a.width||0>=a.height)return this.removeG();this.createHistDrawAttributes();var b=this.prepareDraw({extra:1,only_indexes:!0});return this.options.Bar?this.drawBars(b,a.width,a.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(b,a.width,a.height):this.drawHistBins(b,a.width,a.height)};u.prototype.drawHistBins=function(a,b,c){var d=this;this.createG(!0);var n=this.options,l=a.i1,g=a.i2,
p=a.stepi,e=this.getFramePainter(),w=this.getHisto(),m=this.getAxis("x");a="";var h=!1,A,f,r,t,v,k,y=!n.Zero,Z=n.Error;h=n.Mark;var D=n.Line,u=n.Text,z=u&&"E"==this.options.TextKind&&this.isRProfile(),x=null,E=null,B=null,C=null,I="",aa="",U=0,J,O,V,R,ba,K,M,P;Z&&!h&&1<this.v7EvalAttr("marker_style",1)&&(h=!0);2===n.ErrorKind?this.fillatt.empty()?h=!0:x="":n.Error&&(E="");D&&(C="");h&&(this.createv7AttMarker(),0<this.markeratt.size?(B="",this.markeratt.resetPos()):h=!1);if(u){var L=this.v7EvalFont("text",
{size:20,color:"black",align:22});if(!L.angle&&!n.TextKind){var G=b/(g-l+1);G<3*L.size&&(L.setAngle(270),L.setSize(Math.round(.7*G)))}this.startTextDrawing(L,"font")}b=g-l>3*b;1===n.ErrorKind&&(G=this.lineatt.width+JSROOT.gStyle.fEndErrorSize,I="m0,"+G+"v-"+2*G+"m0,"+G,aa="m"+G+",0h-"+2*G+"m"+G+",0",U=Math.floor((this.lineatt.width-1)/2));var S=Z||h;if(S||u||D)b=!0;var W=function(a){R=w.getBinContent(a+1);y&&0===R||(K=Math.round(e.grx(m.GetBinCoord(a))),M=Math.round(e.grx(m.GetBinCoord(a+p))),P=Math.round((K+
M)/2),J=Math.round(e.gry(R)),O=V=20,Z&&(ba=w.getBinError(a+1),O=Math.round(J-e.gry(R+ba)),V=Math.round(e.gry(R-ba)-J)),u&&(a=z?w.fBinEntries[a+1]:R,0!==a&&(a=a===Math.round(a)?a.toString():q.floatToString(a,JSROOT.gStyle.fPaintTextFormat),L.angle?d.drawText({align:12,x:P,y:Math.round(J-2-L.size/5),width:0,height:0,text:a,latex:0}):d.drawText({x:Math.round(K+.1*(M-K)),y:Math.round(J-2-L.size),width:Math.round(.8*(M-K)),height:L.size,text:a,latex:0}))),D&&null!==C&&(C+=(0===C.length?"M":"L")+P+","+
J),S&&J>=-O&&J<=c+V&&(null!==x&&(x+="M"+K+","+(J-O)+"h"+(M-K)+"v"+(O+V+1)+"h-"+(M-K)+"z"),null!==B&&(B+=d.markeratt.create(P,J)),null!==E&&(0<d.options.errorX&&(a=Math.round(P-(M-K)*d.options.errorX),E+="M"+(a+U)+","+J+I+"h"+(Math.round(P+(M-K)*d.options.errorX)-a-2*U)+I),E+="M"+P+","+(J-O+U)+aa+"v"+(O+V-2*U)+aa)))};for(G=l;G<=g;G+=p)if(h=m.GetBinCoord(G),!(e.logx&&0>=h)){var N=Math.round(e.grx(h));if((h=G>g-p)&&l<g)var H=r;else H=w.getBinContent(G+1),H=Math.round(e.gry(H));if(0===a.length){var Q=
k=G;var X=A=f=N;var T=t=v=r=H;a="M"+f+","+r}else if(b)if(N!==f||h){if(S||u||D)Q===k?W(Q):Q<k?(W(Q),W(k)):(W(k),W(Q));S||t===v&&T===t||(X!==f&&(a+="h"+(f-X)),r===t?(v!==T&&(a+="v"+(v-T)),t!==v&&(a+="v"+(t-v))):(t!==T&&(a+="v"+(t-T)),v!==t&&(a+="v"+(v-t)),r!==v&&(a+="v"+(r-v))),X=f,T=r);h&&X!==N&&(a+="h"+(N-X));Q=k=G;t=v=r=H;f=N}else H<t?k=G:H>v&&(Q=G),t=Math.min(t,H),v=Math.max(v,H),r=H;else if(H!==r||h)N!==f&&(a+="h"+(N-f)),H!==r&&(a+="v"+(H-r)),r=H,f=N}g="";l=!JSROOT.batch_mode&&this.fillatt.empty()&&
n.Hist&&JSROOT.settings.Tooltip&&!S&&!D;if(!this.fillatt.empty()||l)g=c+3,l&&(l=Math.round(e.gry(0)),0>=l?g=-3:l<c&&(g=l)),g="L"+f+","+g+"L"+A+","+g+"Z",0<a.length&&(a+=g);S||D?(null!==x&&0<x.length&&this.draw_g.append("svg:path").attr("d",x).call(this.fillatt.func),null!==E&&0<E.length&&this.draw_g.append("svg:path").attr("d",E).call(this.lineatt.func),null!==C&&0<C.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",n.Fill?C+g:a).attr("stroke","none").call(this.fillatt.func),
this.draw_g.append("svg:path").attr("d",C).attr("fill","none").call(this.lineatt.func)),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).call(this.markeratt.func)):a&&n.Hist&&this.draw_g.append("svg:path").attr("d",a).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);u&&this.finishTextDrawing()};u.prototype.getBinTooltips=function(a){var b=[],c=this.getObjectHint(),d=this.getFramePainter(),n=this.getHisto(),l=this.getAxis("x"),g=this.isDisplayItem()?
n.stepx:1,p=l.GetBinCoord(a),e=l.GetBinCoord(a+g);l=n.getBinContent(a+1);var w=this.getAxisBinTip("x",a,g);0<c.length&&b.push(c);this.options.Error||this.options.Mark?(b.push("x = "+w),b.push("y = "+d.axisAsText("y",l)),this.options.Error&&("["==w[0]&&b.push("error x = "+((e-p)/2).toPrecision(4)),b.push("error y = "+n.getBinError(a+1).toPrecision(4)))):(b.push("bin = "+a),b.push("x = "+w),n.$baseh&&(l-=n.$baseh.getBinContent(a+1)),a="entries = "+(1<g?"~":""),l===Math.round(l)?b.push(a+l):b.push(a+
q.floatToString(l,JSROOT.gStyle.fStatFormat)));return b};u.prototype.processTooltipEvent=function(a){function b(a){a=p.GetBinCoord(a);return d.logx&&0>=a?null:d.grx(a)}function c(a){a=g.getBinContent(a+1);return d.logy&&a<d.scale_ymin?d.swap_xy?-1E3:10*l:Math.round(d.gry(a))}if(!a||!this.draw_content||this.options.Mode3D||!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.getFramePainter(),n=d.getFrameWidth(),l=d.getFrameHeight(),g=this.getHisto(),p=this.getAxis("x"),
e=null,w,m,h=2,A=this.getSelectIndex("x","left",-1),f=this.getSelectIndex("x","right",2);var r=A;var t=f;for(var v=d.swap_xy?a.y:a.x,k=d.swap_xy?a.x:a.y;r<t-1;){e=Math.round(.5*(r+t));var y=b(e);null===y||y<v-.5?d.swap_xy?t=e:r=e:y>v+.5?d.swap_xy?r=e:t=e:(r++,t--)}e=t=r;y=b(e);if(d.swap_xy){for(;r>A&&b(r-1)<y+2;)--r;for(;t<f&&b(t+1)>y-2;)++t}else{for(;r>A&&b(r-1)>y-2;)--r;for(;t<f&&b(t+1)<y+2;)++t}if(r<t){y=l;for(w=r;w<=t;w++){var q=Math.abs(c(w)-k);q<y&&(y=q,e=w)}y>l/10&&(e=Math.round(r+(t-r)/l*
k));y=b(e)}y=Math.round(y);w=Math.round(b(e+1));this.options.Bar&&(r=w-y,y+=Math.round(this.options.BarOffset*r),w=y+Math.round(this.options.BarWidth*r));y>w&&(r=y,y=w,w=r);r=Math.round((y+w)/2);t=q=m=c(e);if(this.options.Bar){n=!0;h=0;q=Math.round(d.gry(!1!==this.options.BaseLine&&this.options.BaseLine>d.scale_ymin?this.options.BaseLine:d.scale_ymin));if(q>m){var D=q;q=m;m=D}!a.touch&&1===a.nproc&&(k<q||k>m)&&(e=null)}else if(this.options.Error||this.options.Mark){n=!0;D=3;this.markeratt&&(D=Math.max(D,
this.markeratt.getFullSize()));if(this.options.Error){var u=g.getBinContent(e+1);m=g.getBinError(e+1);q=Math.round(d.gry(u+m));m=Math.round(d.gry(u-m));0==u&&this.isRProfile()&&(e=null);w=(w-y)*this.options.errorX;y=Math.round(r-w);w=Math.round(r+w)}w-y<2*D&&(y=r-D,w=r+D);q=Math.min(q,t-D);m=Math.max(m,t+D);!a.touch&&1===a.nproc&&(k<q||k>m)&&(e=null)}else if(this.options.Line)n=!1;else if(n=1===a.nproc&&f-A<n)m=l,this.fillatt.empty()||(m=Math.round(d.gry(0)),0>m?m=0:m>l&&(m=l),m<q&&(D=q,q=m,m=D)),
(a.y<q||a.y>m)&&!a.touch&&(e=null);null!==e&&(e===A&&y>v+h?e=null:e===f-1&&w<v-h?e=null:v<y-h||v>w+h?e=null:this.options.Zero||0!==g.getBinContent(e+1)||(e=null));h=this.draw_g.select(".tooltip_bin");if(null===e||0>=m||q>=l)return h.remove(),null;A={name:"histo",title:g.fTitle,x:r,y:t,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(e)};a.disabled?(h.remove(),A.changed=!0):n?(h.empty()&&(h=this.draw_g.append("svg:rect").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),A.changed=h.property("current_bin")!==e,A.changed&&h.attr("x",d.swap_xy?q:y).attr("width",d.swap_xy?m-q:w-y).attr("y",d.swap_xy?y:q).attr("height",d.swap_xy?w-y:m-q).style("opacity","0.3").property("current_bin",e),A.exact=5>=Math.abs(t-k)||k>=q&&k<=m,A.menu=!0,A.menu_dist=Math.sqrt((r-v)*(r-v)+(t-k)*(t-k))):(v=this.lineatt.width+3,h.empty()&&(h=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",
v).call(this.lineatt.func).call(this.fillatt.func)),A.exact=Math.abs(r-a.x)<=v&&Math.abs(t-a.y)<=v,A.menu=A.exact,A.menu_dist=Math.sqrt((r-a.x)*(r-a.x)+(t-a.y)*(t-a.y)),A.changed=h.property("current_bin")!==e,A.changed&&h.attr("cx",r).attr("cy",t).property("current_bin",e));A.changed&&(A.user_info={obj:g,name:"histo",bin:e,cont:g.getBinContent(e+1),grx:r,gry:t});return A};u.prototype.fillHistContextMenu=function(a){var b=this;a.add("Auto zoom-in",function(){return b.autoZoom()});var c=q.getDrawSettings("ROOT."+
this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.options.need_fillcol&&b.fillatt&&b.fillatt.empty()&&b.fillatt.change(5,1001);b.interactiveRedraw("pad","drawopt")})};u.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),c=b-a,d=this.getHisto(),n=this.getAxis("x");if(0!=c){for(var l=d.getBinContent(a+1),g=a;g<b;++g)l=Math.min(l,d.getBinContent(g+1));
if(!(0<l)){for(;a<b&&d.getBinContent(a+1)<=l;)++a;for(;a<b&&d.getBinContent(b)<=l;)--b;a===b-1&&2<a&&b<this.nbinsx-2&&(--a,++b);b-a<c&&a<b&&this.getFramePainter().zoom(n.GetBinCoord(a),n.GetBinCoord(b))}}};u.prototype.canZoomInside=function(a,b,c){var d=this.getAxis("x");return"x"==a&&1<d.FindBin(c,.5)-d.FindBin(b,0)||"y"==a&&Math.abs(c-b)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};u.prototype.callDrawFunc=function(a){var b=this.getFramePainter();b&&b.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&
(this.options.Mode3D=b.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};u.prototype.draw2D=function(a){var b=this;this.clear3DScene();return this.drawFrameAxes().then(function(c){return c?b.drawingBins(a):!1}).then(function(a){if(!a)return!1;b.draw1DBins();return b.addInteractivity()}).then(function(a){return a?b:null})};u.prototype.draw3D=function(a){var b=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return b.draw3D(a)})};u.prototype.redraw=function(a){this.callDrawFunc(a)};
var Y=function(a,b,c){var d=new u(a,b);return q.ensureRCanvas(d).then(function(){d.setAsMainPainter();d.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};var a=new JSROOT.DrawOptions(c);a.check("R3D_",!0)&&(d.options.Render3D=JSROOT.constants.Render3D.fromString(a.part.toLowerCase()));a=d.v7EvalAttr("kind","hist");var b=d.v7EvalAttr("sub",
0),g=d.options;g.Text=d.v7EvalAttr("text",!1);g.BarOffset=d.v7EvalAttr("bar_offset",0);g.BarWidth=d.v7EvalAttr("bar_width",1);switch(a){case "bar":g.Bar=!0;g.BarStyle=b;break;case "err":g.Error=!0;g.ErrorKind=b;break;case "p":g.Mark=!0;break;case "l":g.Line=!0;break;case "lego":g.Lego=0<b?10+b:12;g.Mode3D=!0;break;default:g.Hist=!0}d.scanContent();return d.callDrawFunc()})};z.prototype=Object.create(k.prototype);z.prototype.cleanup=function(){delete this.tt_handle;k.prototype.cleanup.call(this)};
z.prototype.getDimension=function(){return 2};z.prototype.toggleProjection=function(a,b){var c=this;"Projections"==a&&(a="");"string"==typeof a&&1<a.length&&(b=parseInt(a.substr(1)),a=a[0]);b||(b=1);if(a&&this.is_projection==a)if(this.projection_width===b)a="";else{this.projection_width=b;return}delete this.proj_hist;var d=this.is_projection===a?"":a;this.is_projection="";this.projection_width=b;(a=this.getCanvPainter())&&a.toggleProjection(this.is_projection).then(function(){return c.redrawProjection("toggling",
d)})};z.prototype.redrawProjection=function(a,b){"toggling"===a&&(this.is_projection=b)};z.prototype.executeMenuCommand=function(a,b){return k.prototype.executeMenuCommand.call(this,a,b)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.toggleProjection(a.fName[17],b&&parseInt(b)?parseInt(b):1),!0):!1};z.prototype.fillHistContextMenu=function(a){var b=this;a.add("sub:Projections",function(){return b.toggleProjection()});var c=this.is_projection||"";c&&(c+=this.projection_width);
for(var d="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" "),n=0;n<d.length;++n)a.addchk(c==d[n],d[n],d[n],function(a){return b.toggleProjection(a)});a.add("endsub:");a.add("Auto zoom-in",function(){return b.autoZoom()});c=q.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};z.prototype.clickButton=function(a){if(k.prototype.clickButton.call(this,
a))return!0;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};z.prototype.fillToolbar=function(){k.prototype.fillToolbar.call(this,!0);var a=this.getPadPainter();a&&(this.isRH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};z.prototype.toggleColor=
function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.redraw()};z.prototype.autoZoom=function(){if(!this.isRH2Poly()){var a=this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),c=this.getSelectIndex("y","left",-1),d=this.getSelectIndex("y","right",1),n,l,g=this.getHisto(),p=this.getAxis("x"),e=this.getAxis("y");if(a!=b&&c!=d){var w=g.getBinContent(a+1,c+1);for(n=a;n<b;++n)for(l=c;l<d;++l)w=
Math.min(w,g.getBinContent(n+1,l+1));if(!(0<w)){var m=b,h=a,A=d,f=c;for(n=a;n<b;++n)for(l=c;l<d;++l)g.getBinContent(n+1,l+1)>w&&(n<m&&(m=n),n>=h&&(h=n+1),l<A&&(A=l),l>=f&&(f=l+1));n=!1;m===h-1&&m>a+1&&h<b-1&&(m--,h++);A===f-1&&A>c+1&&f<d-1&&(A--,f++);if((m>a||h<b)&&m<h-1){var r=p.GetBinCoord(m);var t=p.GetBinCoord(h);n=!0}if((A>c||f<d)&&A<f-1){var k=e.GetBinCoord(A);var q=e.GetBinCoord(f);n=!0}n&&this.getFramePainter().zoom(r,t,k,q)}}}};z.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var b;
a=this.getHisto();this.extractAxesProperties(2);if(this.isRH2Poly()){this.gminposbin=null;var c=this.gminbin=this.gmaxbin=0;for(b=a.fBins.arr.length;c<b;++c){var d=a.fBins.arr[c].fContent;0===c&&(this.gminbin=this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d)}}else if(this.isDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else for(this.gminbin=
this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,c=0;c<this.nbinsx;++c)for(b=0;b<this.nbinsy;++b)d=a.getBinContent(c+1,b+1),d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);this.zmin=this.gminbin;this.zmax=this.gmaxbin;null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isRH2Poly()&&
(this.draw_content=!0,this.options.Line=1))}};z.prototype.countStat=function(a){var b=this.getHisto(),c=0,d=0,n=0,l=0,g=0,p={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},e=this.getSelectIndex("x","left"),w=this.getSelectIndex("x","right"),m=this.getSelectIndex("y","left"),h=this.getSelectIndex("y","right"),f,k,r=this.getAxis("x"),t=this.getAxis("y");for(f=1;f<=this.nbinsx;++f){var v=f<=e+1?0:f>w+1?2:1;var q=r.GetBinCoord(f-.5);
for(k=1;k<=this.nbinsy;++k){var y=k<=m+1?0:k>h+1?2:1;var u=t.GetBinCoord(k-.5);var D=b.getBinContent(f,k);p.entries+=D;p.matrix[3*y+v]+=D;if(1==v&&1==y&&(null==a||a(q,u))){if(null==p.wmax||D>p.wmax)p.wmax=D,p.xmax=q,p.ymax=u;c+=D;d+=q*D;n+=u*D;l+=q*q*D;g+=u*u*D}}}0<c&&(p.meanx=d/c,p.meany=n/c,p.rmsx=Math.sqrt(Math.abs(l/c-p.meanx*p.meanx)),p.rmsy=Math.sqrt(Math.abs(g/c-p.meany*p.meany)));null===p.wmax&&(p.wmax=0);p.integral=c;return p};z.prototype.fillStatistic=function(a,b){var c=this.countStat(),
d=Math.floor(b%10),n=Math.floor(b/10)%10,l=Math.floor(b/100)%10,g=Math.floor(b/1E3)%10,p=Math.floor(b/1E4)%10,e=Math.floor(b/1E5)%10,w=Math.floor(b/1E6)%10,m=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.clearStat();0<d&&a.addText(c.name);0<n&&a.addText("Entries = "+a.format(c.entries,"entries"));0<l&&(a.addText("Mean x = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany)));0<g&&(a.addText("Std Dev x = "+a.format(c.rmsx)),a.addText("Std Dev y = "+a.format(c.rmsy)));0<w&&a.addText("Integral = "+
a.format(c.matrix[4],"entries"));0<m&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));0<b&&a.addText("Kurt = <undef>");if(0<p||0<e)c=c.matrix,a.addText(""+c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),a.addText(""+c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),a.addText(""+c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0));return!0};z.prototype.drawBinsColor=function(){var a=this.getHisto(),b=this.prepareDraw(),c=[],d=[],n=[],l,g,p=b.stepi,
e=b.stepj;for(l=b.i1;l<b.i2;l+=p)for(g=b.j1;g<b.j2;g+=e){var w=a.getBinContent(l+1,g+1);var m=b.palette.getContourIndex(w);if(0===w){if(!this.options.Zero)continue;null===m&&this._show_empty_bins&&(m=0)}if(null!==m){w="M"+b.grx[l]+","+b.gry[g+e];if(void 0===c[m])c[m]=w;else{var h="m"+(b.grx[l]-d[m])+","+(b.gry[g+e]-n[m]);c[m]+=h.length<w.length?h:w}d[m]=b.grx[l];n[m]=b.gry[g+e];w=b.grx[l+p]-b.grx[l]||1;h=b.gry[g]-b.gry[g+e]||1;c[m]+="v"+h+"h"+w+"v"+-h+"z"}}for(m=0;m<c.length;++m)void 0!==c[m]&&this.draw_g.append("svg:path").attr("palette-index",
m).attr("fill",b.palette.getColor(m)).attr("d",c[m]);this.updatePaletteDraw();return b};z.prototype.buildContour=function(a,b,c,d){function n(a){for(var c=0;c<b.length;++c)if(a<b[c])return c-1;return b.length-1}function l(a,c,d,n,g,l,h,f){var r=d===h;h=r?f-n:h-d;c+=1;g-=a;f=m-1;for(var t=999+m,A=0,k;c<=l&&f<=t;)k=b[c],k-=a,k/=g,k*=h,r?(p[f]=d,e[f]=n+k):(p[f]=d+k,e[f]=n),w[f]=c,A++,f+=2,c++;return A}var g=this.getHisto(),p=new Float32Array(4008),e=new Float32Array(4008),w=new Int32Array(4008),m=0;
c=[];var h=0,f=[0,0,0,0],k=[0,0,0,0],r=[0,0,0,0],t=[0,0,0,0],v,q,y,u,D=a.stepi,x=a.stepj,z=a.original?a.origx:a.grx,C=a.original?a.origy:a.gry;for(q=a.j1;q<a.j2-x;q+=x)for(k[1]=k[0]=(C[q]+C[q+x])/2,k[3]=k[2]=(C[q+x]+C[q+2*x])/2,v=a.i1;v<a.i2-D;v+=D){r[0]=g.getBinContent(v+1,q+1);r[1]=g.getBinContent(v+1+D,q+1);r[2]=g.getBinContent(v+1+D,q+1+x);r[3]=g.getBinContent(v+1,q+1+x);for(y=0;4>y;y++)t[y]=n(r[y]);if(t[0]!==t[1]||t[1]!==t[2]||t[2]!==t[3]||t[3]!==t[0]){f[3]=f[0]=(z[v]+z[v+1])/2;f[2]=f[1]=(z[v+
1]+z[v+2])/2;var E=r[0]<=r[1]?0:1;var B=r[2]<=r[3]?2:3;r[E]>r[B]&&(E=B);E++;for(y=m=1;4>=y;y++)B=E%4+1,E=l(r[E-1],t[E-1],f[E-1],k[E-1],r[B-1],t[B-1],f[B-1],k[B-1]),m+=2*E,E=B;E=r[0]<=r[1]?0:1;B=r[2]<=r[3]?2:3;r[E]>r[B]&&(E=B);E++;m=2;for(y=1;4>=y;y++)B=1==E?4:E-1,E=l(r[E-1],t[E-1],f[E-1],k[E-1],r[B-1],t[B-1],f[B-1],k[B-1]),m+=2*E,E=B;B=0;for(y=1;y<=m-5;y+=2)for(;w[y-1]!=w[y];){E=p[y];var I=e[y];var Y=w[y];for(u=y;u<=m-5;u+=2)p[u]=p[u+2],e[u]=e[u+2],w[u]=w[u+2];p[m-3]=E;e[m-3]=I;w[m-3]=Y;if(2E3<B)break;
B++}if(!(2E3<B))for(y=1;y<=m-2;y+=2)B=w[y-1],0<=B&&B<b.length&&((E=c[B])||(E=c[B]=JSROOT.createTPolyLine(8016,!0)),B=E.fLastPoint,B<E.fN-2&&(E.fX[B+1]=Math.round(p[y-1]),E.fY[B+1]=Math.round(e[y-1]),E.fX[B+2]=Math.round(p[y]),E.fY[B+2]=Math.round(e[y]),E.fLastPoint=B+2,h=Math.max(h,E.fLastPoint+1)))}}a=new Int32Array(b.length);for(B=v=0;B<b.length;B++)if(0<=b[B]){v=B;break}y=0;for(B=v-1;0<=B;B--)a[y]=B,y++;for(B=v;B<b.length;B++)a[y]=B,y++;g=new Float32Array(2*h);f=new Float32Array(2*h);for(y=0;y<
b.length;++y)if(B=a[y],E=c[B])for(k=B,r=E.fX,t=E.fY,q=E.fLastPoint+1,D=0,C=z=x=void 0;;){x=h;z=x+1;g[x]=r[D];f[x]=t[D];g[z]=r[D+1];f[z]=t[D+1];r[D]=r[D+1]=0;for(t[D]=t[D+1]=0;;){C=0;for(v=2;v<q;v+=2)z<2*h-1&&r[v]===g[z]&&t[v]===f[z]&&(z++,g[z]=r[v+1],f[z]=t[v+1],r[v]=r[v+1]=0,t[v]=t[v+1]=0,C++),0<x&&r[v+1]===g[x]&&t[v+1]===f[x]&&(x--,g[x]=r[v],f[x]=t[v],r[v]=r[v+1]=0,t[v]=t[v+1]=0,C++);if(0==C)break}x+1<z&&0<=x&&d(k,g,f,x,z,B);D=0;for(v=2;v<q;v+=2)if(0!==r[v]&&0!==t[v]){D=v;break}if(0===D)break}};
z.prototype.drawBinsContour=function(a,b){var c=this,d=this.prepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),n=this.getFramePainter(),l=n.getHistPalette(),g=l.getContour(),p=n.getProjectionFunc(),e=function(a,c,b,d,e){for(var g="",l,h,f,m=b;m<=d;++m){p?(b=p(a[m],c[m]),b.x=Math.round(n.grx(b.x)),b.y=Math.round(n.gry(b.y))):b={x:Math.round(a[m]),y:Math.round(c[m])};if(g)if(m==d&&h&&b.x==h.x&&b.y==h.y){if(!f)return"";g+="z";e=!1}else b.x!=l.x&&b.y!=l.y?(g+="l"+(b.x-l.x)+","+(b.y-l.y),
f=!0):b.x!=l.x?(g+="h"+(b.x-l.x),f=!0):b.y!=l.y&&(g+="v"+(b.y-l.y),f=!0);else g="M"+b.x+","+b.y,h=b;l=b}e&&(g+="z");return g};if(14===this.options.Contour){a="M0,0h"+a+"v"+b+"h-"+a+"z";if(this.options.Proj){a=d.stepj;b=parseInt((d.j2-d.j1)/a);for(var f=new Float32Array(2*b),m=new Float32Array(2*b),h=0;h<b;++h)f[h]=d.origx[d.i1],m[h]=(d.origy[d.j1]*(h*a+.5)+d.origy[d.j2]*(b-.5-h*a))/b,f[h+b]=d.origx[d.i2],m[h+b]=(d.origy[d.j2]*(h*a+.5)+d.origy[d.j1]*(b-.5-h*a))/b;a=e(f,m,0,2*b-1,!0)}this.draw_g.append("svg:path").attr("d",
a).style("stroke","none").style("fill",l.getColor(0))}this.buildContour(d,g,l,function(a,b,d,g,n){var h=l.getColor(a),p=h;switch(c.options.Contour){case 11:p="none";var f=new JSROOT.TAttLineHandler({color:h});break;case 12:p="none";f=new JSROOT.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:p="none",f=c.lineatt}if(a=e(b,d,g,n,"none"!=p))p=c.draw_g.append("svg:path").attr("class","th2_contour").attr("d",a).style("fill",p),f?p.call(f.func):p.style("stroke","none")});d.hide_only_zeros=
!0;return d};z.prototype.createPolyBin=function(a,b,c){function d(a,c,d,e){var g=Math.sqrt((a-d)*(a-d)+(c-e)*(c-e));b._sumx+=(a+d)*g/2;b._sumy+=(c+e)*g/2;b._suml+=g}var n="",l,g=1,p=null;"TMultiGraph"==b.fPoly._typename?g=b.fPoly.fGraphs.arr.length:p=b.fPoly;c&&(b._sumx=b._sumy=b._suml=0);for(l=0;l<g;++l){if(!p||0<l)p=b.fPoly.fGraphs.arr[l];var e=p.fNpoints,f=void 0,m=p.fX,h=p.fY,k=Math.round(a.grx(m[0])),q=Math.round(a.gry(h[0])),r=void 0,t=void 0;2<e&&m[0]==m[e-1]&&h[0]==h[e-1]&&e--;n+="M"+k+","+
q;for(f=1;f<e;++f){r=Math.round(a.grx(m[f]));t=Math.round(a.gry(h[f]));c&&d(k,q,r,t);if(k!==r||q!==t)n=k===r?n+("v"+(t-q)):q===t?n+("h"+(r-k)):n+("l"+(r-k)+","+(t-q));k=r;q=t}c&&d(k,q,Math.round(a.grx(m[0])),Math.round(a.gry(h[0])));n+="z"}c&&(0<b._suml?(b._midx=Math.round(b._sumx/b._suml),b._midy=Math.round(b._sumy/b._suml)):(b._midx=Math.round(a.grx((b.fXmin+b.fXmax)/2)),b._midy=Math.round(a.gry((b.fYmin+b.fYmax)/2))));return n};z.prototype.drawPolyBinsColor=function(){var a=this.getHisto(),b=this.getFramePainter(),
c=[],d=[],n,l=a.fBins.arr.length,g=b.getHistPalette();this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;this.createContour(b,g);for(n=0;n<l;++n){var p=a.fBins.arr[n];var e=g.getContourIndex(p.fContent);if(null!==e){if(0===p.fContent){if(!this.options.Zero||!this.options.Line)continue;e=0}if(!(p.fXmin>b.scale_xmax||p.fXmax<b.scale_xmin||p.fYmin>b.scale_ymax||p.fYmax<b.scale_ymin)){var f=this.createPolyBin(b,p,this.options.Text&&p.fContent);c[e]=void 0===c[e]?f:c[e]+f;
this.options.Text&&d.push(p)}}}for(e=0;e<c.length;++e)c[e]&&(p=this.draw_g.append("svg:path").attr("palette-index",e).attr("fill",e?g.getColor(e):"none").attr("d",c[e]),this.options.Line&&p.call(this.lineatt.func));if(0<d.length){p=this.v7EvalFont("text",{size:12,color:"black",align:22});c=this.draw_g.append("svg:g").attr("class","th2poly_text");this.startTextDrawing(p,"font",c);for(n=0;n<d.length;++n)p=d[n],e="",this.options.TextKind?(p.fPoly&&(e=p.fPoly.fName),"Graph"===e&&(e=""),e||(e=p.fNumber)):
e=Math.round(p.fContent)===p.fContent?p.fContent.toString():q.floatToString(p.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({x:p._midx,y:p._midy,text:e,latex:0,draw_g:c});this.finishTextDrawing(c)}return{poly:!0}};z.prototype.drawBinsText=function(a){var b=this.getHisto(),c,d;null===a&&(a=this.prepareDraw({rounding:!1}));var n=this.v7EvalFont("text",{size:20,color:"black",align:22}),l=0,g=this.draw_g.append("svg:g").attr("class","th2_text"),p=a.stepi,e=a.stepj,f="E"==this.options.TextKind&&
this.matchObjectType("TProfile2D")&&"function"==typeof b.getBinEntries;this.options.BarOffset&&(l=this.options.BarOffset);this.startTextDrawing(n,"font",g);for(c=a.i1;c<a.i2;c+=p)for(d=a.j1;d<a.j2;d+=e){var m=b.getBinContent(c+1,d+1);if(0!==m||this._show_empty_bins){var h=a.grx[c+p]-a.grx[c];var k=a.gry[d]-a.gry[d+e];f&&(m=b.getBinEntries(c+1,d+1));m=m===Math.round(m)?m.toString():q.floatToString(m,JSROOT.gStyle.fPaintTextFormat);if(n.angle){var u=Math.round(a.grx[c]+.5*h);var r=Math.round(a.gry[d+
e]+k*(.5+l));k=h=0}else u=Math.round(a.grx[c]+.1*h),r=Math.round(a.gry[d+e]+k*(.1+l)),h=Math.round(.8*h),k=Math.round(.8*k);this.drawText({align:22,x:u,y:r,width:h,height:k,text:m,latex:0,draw_g:g})}}this.finishTextDrawing(g);a.hide_only_zeros=!0;return a};z.prototype.drawBinsArrow=function(){for(var a=this.getHisto(),b="",c,d,n=1E-30,l,g,f,e,w,m,h=this.prepareDraw({rounding:!1}),k=(h.grx[h.i2]-h.grx[h.i1])/(h.i2-h.i1+1-.03)/2,q=(h.gry[h.j2]-h.gry[h.j1])/(h.j2-h.j1+1-.03)/2,r=h.stepi,t=h.stepj,v=
0;2>v;++v)for(c=h.i1;c<h.i2;c+=r)for(d=h.j1;d<h.j2;d+=t)if(l=c===h.i1?a.getBinContent(c+1+r,d+1)-a.getBinContent(c+1,d+1):c>=h.i2-r?a.getBinContent(c+1,d+1)-a.getBinContent(c+1-r,d+1):.5*(a.getBinContent(c+1+r,d+1)-a.getBinContent(c+1-r,d+1)),g=d===h.j1?a.getBinContent(c+1,d+1+t)-a.getBinContent(c+1,d+1):d>=h.j2-t?a.getBinContent(c+1,d+1)-a.getBinContent(c+1,d+1-t):.5*(a.getBinContent(c+1,d+1+t)-a.getBinContent(c+1,d+1-t)),0===v)n=Math.max(n,Math.abs(l),Math.abs(g));else if(f=(h.grx[c]+h.grx[c+r])/
2,e=(h.gry[d]+h.gry[d+t])/2,w=k*l/n,l=q*g/n,m=f-w,g=f+w,f=e-l,e+=l,l=Math.round(g-m),g=Math.round(e-f),0!==l||0!==g)if(b+="M"+Math.round(m)+","+Math.round(f)+"l"+l+","+g,5<Math.abs(l)||5<Math.abs(g))e=Math.sqrt(2/(l*l+g*g)),m=Math.round(e*(l+g)),l=Math.round(e*(l-g)),0!==m&&0!==l&&(b+="l"+-m+","+l+"m"+m+","+-l+"l"+-l+","+-m);this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",b).style("fill","none").call(this.lineatt.func);return h};z.prototype.drawBinsBox=function(){var a=this.getHisto(),
b=this.prepareDraw({rounding:!1}),c=this.getFramePainter();c.maxbin===c.minbin&&(c.maxbin=this.gmaxbin,c.minbin=this.gminbin,c.minposbin=this.gminposbin);c.maxbin===c.minbin&&(c.minbin=Math.min(0,c.maxbin-1));var d=Math.max(Math.abs(c.maxbin),Math.abs(c.minbin)),n=Math.max(0,c.minbin),l="",g="",p="",e="",k=!1,m=0,h=b.stepi,q=b.stepj;if(c.logz&&0<d){k=!0;d=Math.log(d);m=0<n?Math.log(n):1<=c.minposbin&&100>c.minposbin?Math.log(.7):0<c.minposbin?Math.log(.7*c.minposbin):d-10;m>=d&&(m=d-10);var u=1/(d-
m)}else u=1/(d-n);for(c=b.i1;c<b.i2;c+=h)for(d=b.j1;d<b.j2;d+=q){var r=a.getBinContent(c+1,d+1);var t=Math.abs(r);if(!(0===t||t<n)){var v=k?0<t?Math.log(t)-m:0:t-n;v=.5*(0>v?1:1-Math.sqrt(v*u));0>v&&(v=0);t=b.grx[c+h]-b.grx[c];var x=b.gry[d]-b.gry[d+q];var y=v*t;var z=v*x;v=Math.round(b.grx[c]+y);var D=Math.round(b.gry[d+q]+z);t=Math.max(Math.round(t-2*y),1);x=Math.max(Math.round(x-2*z),1);l+="M"+v+","+D+"v"+x+"h"+t+"v-"+x+"z";0>r&&10===this.options.BoxStyle&&(g+="M"+v+","+D+"l"+t+","+x+"M"+(v+t)+
","+D+"l-"+t+","+x);if(11===this.options.BoxStyle&&5<t&&5<x){z=Math.round(.1*t);var C=Math.round(.1*x);y="M"+v+","+D+"h"+t+"l"+-z+","+C+"h"+(2*z-t)+"v"+(x-2*C)+"l"+-z+","+C+"z";t="M"+(v+t)+","+(D+x)+"v"+-x+"l"+-z+","+C+"v"+(x-2*C)+"h"+(2*z-t)+"l"+-z+","+C+"z";0>r?(e+=y,p+=t):(p+=y,e+=t)}}}0<l.length&&(a=this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<p.length&&"none"!==this.fillatt.color&&
this.draw_g.append("svg:path").attr("d",p).style("stroke","none").call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).brighter(.5).toString());0<e.length&&this.draw_g.append("svg:path").attr("d",e).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":f.rgb(this.fillatt.color).darker(.5).toString());0<g.length&&(g=this.draw_g.append("svg:path").attr("d",g).style("fill","none"),"none"!==this.lineatt.color?g.call(this.lineatt.func):g.style("stroke",
"black"));return b};z.prototype.drawBinsCandle=function(a){var b=this.getHisto(),c=this.getAxis("y"),d=this.prepareDraw(),n=this.getFramePainter(),l,g,f,e,k="",m="";this.createv7AttMarker();this.markeratt.resetPos();d.candle=[];for(l=d.i1;l<d.i2;++l){for(a=f=e=g=0;a<this.nbinsy;++a)e+=b.getBinContent(l+1,a+1);var h={bin:l,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var q=b.getBinContent(l+1,a+1);var u=c.GetBinCoord(a+.5);.001>f/e&&.001<=(f+q)/e&&(h.whiskerm=
u);.25>f/e&&.25<=(f+q)/e&&(h.m25y=u);.5>f/e&&.5<=(f+q)/e&&(h.median=u);.75>f/e&&.75<=(f+q)/e&&(h.p25y=u);.999>f/e&&.999<=(f+q)/e&&(h.whiskerp=u);f+=q;g+=q*u}0<f&&(h.meany=g/f);h.iqr=h.p25y-h.m25y;h.m25y-1.5*h.iqr>h.whsikerm&&(h.whiskerm=h.m25y-1.5*h.iqr);h.p25y+1.5*h.iqr<h.whiskerp&&(h.whiskerp=h.p25y+1.5*h.iqr);if(!(n.logy&&0>=h.whiskerm)){a=d.grx[l+1]-d.grx[l];a*=.66;g=(d.grx[l+1]+d.grx[l])/2+this.options.BarOffset*a;0<this.options.BarWidth&&(a*=this.options.BarWidth);h.x1=Math.round(g-a/2);h.x2=
Math.round(g+a/2);g=Math.round(g);h.y0=Math.round(n.gry(h.median));k+="M"+h.x1+","+h.y0+"h"+(h.x2-h.x1);h.y1=Math.round(n.gry(h.p25y));h.y2=Math.round(n.gry(h.m25y));k+="M"+h.x1+","+h.y1+"v"+(h.y2-h.y1)+"h"+(h.x2-h.x1)+"v-"+(h.y2-h.y1)+"z";h.yy1=Math.round(n.gry(h.whiskerp));h.yy2=Math.round(n.gry(h.whiskerm));k+="M"+g+","+h.y1+"v"+(h.yy1-h.y1);k+="M"+h.x1+","+h.yy1+"h"+(h.x2-h.x1);k+="M"+g+","+h.y2+"v"+(h.yy2-h.y2);k+="M"+h.x1+","+h.yy2+"h"+(h.x2-h.x1);for(a=0;a<this.nbinsy;++a)q=b.getBinContent(l+
1,a+1),u=c.GetBinCoord(a+.5),0<q&&u<h.whiskerm&&(m+=this.markeratt.create(g,u)),0<q&&u>h.whiskerp&&(m+=this.markeratt.create(g,u));d.candle.push(h)}}0<k.length&&this.draw_g.append("svg:path").attr("d",k).call(this.lineatt.func).call(this.fillatt.func);0<m.length&&this.draw_g.append("svg:path").attr("d",m).call(this.markeratt.func);return d};z.prototype.drawBinsScatter=function(){var a=this.getHisto(),b=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),c=[],d=[],n=[],f=[],g=[],p,e,k=
1;var m=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);var h=b.stepi,q=b.stepj;JSROOT.seed(b.sumz);if(1E5>m*b.sumz){this.createv7AttMarker();this.markeratt.resetPos();c="";for(p=b.i1;p<b.i2;p+=h){var u=b.grx[p+h]-b.grx[p];for(e=b.j1;e<b.j2;e+=q){var r=b.gry[e]-b.gry[e+q];var t=a.getBinContent(p+1,e+1);g=Math.round(m*t);if(!(0>=g))for(f=0;f<g;++f)c+=this.markeratt.create(Math.round(b.grx[p]+u*JSROOT.random()),Math.round(b.gry[e+1]+r*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",
c).call(this.markeratt.func);return b}.7<this.maxbin&&(k=.7/this.maxbin);for(p=b.i1;p<b.i2;p+=h)for(e=b.j1;e<b.j2;e+=q)if(t=a.getBinContent(p+1,e+1),!(0>=t||t<this.minbin||(u=b.grx[p+h]-b.grx[p],r=b.gry[e]-b.gry[e+q],0>=u*r||(m=b.palette.getContourIndex(t/u/r),0>m)))){t="M"+b.grx[p]+","+b.gry[e+q];if(void 0===c[m])c[m]=t,f[m]=u,g[m]=r;else{var v="m"+(b.grx[p]-d[m])+","+(b.gry[e+q]-n[m]);c[m]+=v.length<t.length?v:t;f[m]=Math.max(f[m],u);g[m]=Math.max(g[m],r)}d[m]=b.grx[p];n[m]=b.gry[e+q];c[m]+="v"+
r+"h"+u+"v-"+r+"z"}m=this.getFrameSvg().select(".main_layer");a=m.select("defs");a.empty()&&0<c.length&&(a=m.insert("svg:defs",":first-child"));this.createv7AttMarker();p=b.palette.getContour();for(m=0;m<c.length;++m)if(void 0!==c[m]&&m<p.length){u="scatter_"+m;e=a.select("."+u);e.empty()?e=a.append("svg:pattern").attr("class",u).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):e.selectAll("*").remove();u=Math.round(k*p[m]*f[m]*g[m]);1>u&&(u=1);r=new Float32Array(u);
h=new Float32Array(u);if(1===u)r[0]=h[0]=.5;else for(q=0;q<u;++q)r[q]=JSROOT.random(),h[q]=JSROOT.random();this.markeratt.resetPos();q="";for(d=0;d<u;++d)q+=this.markeratt.create(r[d]*f[m],h[d]*g[m]);e.attr("width",f[m]).attr("height",g[m]).append("svg:path").attr("d",q).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",m).attr("fill","url(#"+e.attr("id")+")").attr("d",c[m])}return b};z.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();this.createHistDrawAttributes();
this.createG(!0);var a=this.getFramePainter().getFrameRect(),b=null;this.isRH2Poly()?b=this.drawPolyBinsColor():(this.options.Scat?b=this.drawBinsScatter():this.options.Color?b=this.drawBinsColor():this.options.Box?b=this.drawBinsBox():this.options.Arrow?b=this.drawBinsArrow():0<this.options.Contour?b=this.drawBinsContour(a.width,a.height):this.options.Candle&&(b=this.drawBinsCandle(a.width)),this.options.Text&&(b=this.drawBinsText(b)),b||(b=this.drawBinsColor()));this.tt_handle=b};z.prototype.getBinTooltips=
function(a,b){var c=[],d=this.getHisto(),f=d.getBinContent(a+1,b+1),l=1,g=1;this.isDisplayItem()&&(l=d.stepx||1,g=d.stepy||1);c.push(this.getObjectHint()||"histo<2>");c.push("x = "+this.getAxisBinTip("x",a,l));c.push("y = "+this.getAxisBinTip("y",b,g));c.push("bin = "+a+", "+b);d.$baseh&&(f-=d.$baseh.getBinContent(a+1,b+1));a="entries = "+(1<l||1<g?"~":"");f===Math.round(f)?c.push(a+f):c.push(a+q.floatToString(f,JSROOT.gStyle.fStatFormat));return c};z.prototype.getCandleTooltips=function(a){var b=
[],c=this.getFramePainter(),d=this.getAxis("y");b.push(this.getObjectHint()||"histo");b.push("x = "+c.axisAsText("x",d.GetBinCoord(a.bin)));b.push("mean y = "+q.floatToString(a.meany,JSROOT.gStyle.fStatFormat));b.push("m25 = "+q.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));b.push("p25 = "+q.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return b};z.prototype.getPolyBinTooltips=function(a,b,c){a=this.getHisto().fBins.arr[a];var d=this.getFramePainter(),f=a.fPoly.fName,l=[],g=0;"Graph"===f&&(f=
"");0===f.length&&(f=a.fNumber);if(void 0===b&&void 0===c){b=c=0;var p=a.fPoly,e=1;"TMultiGraph"===p._typename&&(e=a.fPoly.fGraphs.arr.length,p=null);for(var k=0;k<e;++k){if(!p||0<k)p=a.fPoly.fGraphs.arr[k];for(var m=0;m<p.fNpoints;++m)++g,b+=p.fX[m],c+=p.fY[m]}1<g&&(b/=g,c/=g)}l.push(this.getObjectHint()||"histo");l.push("x = "+d.axisAsText("x",b));l.push("y = "+d.axisAsText("y",c));0<g&&l.push("npnts = "+g);l.push("bin = "+f);a.fContent===Math.round(a.fContent)?l.push("content = "+a.fContent):l.push("content = "+
q.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));return l};z.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var b=this.getHisto(),c=this.tt_handle,d=this.draw_g.select(".tooltip_bin");if(c.poly){c=this.getFramePainter();var f=-1,l=c.revertAxis("x",a.x),g=c.revertAxis("y",a.y);if(void 0!==l&&void 0!==g)for(var p=b.fBins.arr.length,e=0;e<p&&0>f;++e){var k=
b.fBins.arr[e];if(!(l<k.fXmin||l>k.fXmax||g<k.fYmin||g>k.fYmax||0===k.fContent&&!this.options.Zero)){var m=k.fPoly,h=1;"TMultiGraph"===m._typename&&(h=k.fPoly.fGraphs.arr.length,m=null);for(var q=0;q<h;++q){if(!m||0<q)m=k.fPoly.fGraphs.arr[q];if(m.IsInside(l,g)){f=e;break}}}}if(0>f)return d.remove(),null;l={name:"histo",title:b.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(f,
l,g)};a.disabled?(d.remove(),l.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),l.changed=d.property("current_bin")!==f,l.changed&&d.attr("d",this.createPolyBin(c,k)).style("opacity","0.7").property("current_bin",f));l.changed&&(l.user_info={obj:b,name:"histo",bin:f,cont:k.fContent,grx:a.x,gry:a.y});return l}if(c.candle){for(k=0;k<c.candle.length&&!(f=c.candle[k],f.x1<=a.x&&a.x<=f.x2&&f.yy1<=a.y&&a.y<=f.yy2);++k);if(k>=c.candle.length)return d.remove(),
null;c={name:"histo",title:b.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(f),exact:!0,menu:!0};a.disabled?(d.remove(),c.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),c.changed=d.property("current_bin")!==k,c.changed&&d.attr("x",f.x1).attr("width",f.x2-f.x1).attr("y",f.yy1).attr("height",f.yy2-f.yy1).style("opacity",
"0.7").property("current_bin",k));c.changed&&(c.user_info={obj:b,name:"histo",bin:k+1,cont:f.median,binx:k+1,biny:1,grx:a.x,gry:a.y});return c}l=0;p=null;for(k=c.i1;k<c.i2&&!(a.x>=c.grx[k]&&a.x<=c.grx[k+1]);++k);for(f=c.j1;f<c.j2&&!(a.y>=c.gry[f+1]&&a.y<=c.gry[f]);++f);k<c.i2&&f<c.j2&&(l=b.getBinContent(k+1,f+1),this.is_projection?p=0:c.hide_only_zeros?p=0!==l||this._show_empty_bins?0:null:(p=c.palette.getContourIndex(l),null===p&&0===l&&this._show_empty_bins&&(p=0)));if(null===p)return d.remove(),
null;g={name:"histo",title:b.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(k,f),exact:!0,menu:!0};this.options.Color&&(g.color2=c.palette.getColor(p));if(a.disabled&&!this.is_projection)d.remove(),g.changed=!0;else{d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));p=k;e=k+1;m=f;h=f+1;q=c.grx[p];var u=c.grx[e],r=c.gry[h],
t=c.gry[m],v=1E4*k+f;"X"==this.is_projection?(q=0,u=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(r=(this.projection_width-1)/2,h+r>=c.j2?(h=Math.min(Math.round(h+r),c.j2),m=Math.max(h-this.projection_width,c.j1)):(m=Math.max(Math.round(m-r),c.j1),h=Math.min(m+this.projection_width,c.j2))),r=c.gry[h],t=c.gry[m],v=777*m+333*h):"Y"==this.is_projection&&(r=0,t=this.getFramePainter().getFrameHeight(),1<this.projection_width&&(q=(this.projection_width-1)/2,e+q>=c.i2?(e=Math.min(Math.round(e+
q),c.i2),p=Math.max(e-this.projection_width,c.i1)):(p=Math.max(Math.round(p-q),c.i1),e=Math.min(p+this.projection_width,c.i2))),q=c.grx[p],u=c.grx[e],v=777*p+333*e);g.changed=d.property("current_bin")!==v;g.changed&&d.attr("x",q).attr("width",u-q).attr("y",r).attr("height",t-r).style("opacity","0.7").property("current_bin",v);this.is_projection&&g.changed&&this.redrawProjection(p,e,m,h)}g.changed&&(g.user_info={obj:b,name:"histo",bin:b.getBin(k+1,f+1),cont:l,binx:k+1,biny:f+1,grx:a.x,gry:a.y});return g};
z.prototype.canZoomInside=function(a,b,c){if("z"==a)return!0;a=this.getAxis(a);return 1<a.FindBin(c,.5)-a.FindBin(b,0)};z.prototype.draw2D=function(a){var b=this;this.clear3DScene();return this.drawFrameAxes().then(function(c){return c?b.drawingBins(a):!1}).then(function(a){if(!a)return!1;b.draw2DBins();return b.addInteractivity()}).then(function(a){return a?b:null})};z.prototype.draw3D=function(a){var b=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return b.draw3D(a)})};z.prototype.callDrawFunc=
function(a){var b=this.getFramePainter();b&&b.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=b.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};z.prototype.redraw=function(a){this.callDrawFunc(a)};var I=function(a,b,c){var d=new z(a,b);return q.ensureRCanvas(d).then(function(){d.setAsMainPainter();d.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,
Candle:"",Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:-1111,maximum:-1111};var a=d.v7EvalAttr("kind",""),c=d.v7EvalAttr("sub",0),b=d.options;b.Text=d.v7EvalAttr("text",!1);switch(a){case "lego":b.Lego=0<c?10+c:12;b.Mode3D=!0;break;case "surf":b.Surf=0<c?10+c:1;b.Mode3D=!0;break;case "box":b.Box=!0;b.BoxStyle=10+c;break;case "err":b.Error=!0;b.Mode3D=!0;break;case "cont":b.Contour=0<c?10+c:1;break;case "arr":b.Arrow=!0;break;case "scat":b.Scat=!0;break;case "col":b.Color=
!0;break;default:b.Text||(b.Color=!0)}d.isRH2Poly()&&(b.Mode3D?b.Lego=12:b.Color=!0);d._show_empty_bins=!1;d._can_move_colz=!0;d.scanContent();return d.callDrawFunc()})};C.prototype=Object.create(JSROOT.v7.RPavePainter.prototype);C.prototype.clearStat=function(){this.stats_lines=[]};C.prototype.addText=function(a){this.stats_lines.push(a)};C.prototype.updateStatistic=function(a){this.stats_lines=a.lines;this.drawStatistic(this.stats_lines)};C.prototype.fillStatistic=function(){var a=this.getPadPainter();
if(a&&a._fast_drawing)return!1;a=this.getObject();return void 0!==a.fLines?(this.stats_lines=a.fLines,delete a.fLines,!0):this.v7CommMode()==JSROOT.v7.CommMode.kOffline?(a=this.getMainPainter())&&"function"===typeof a.fillStatistic?a.fillStatistic(this,JSROOT.gStyle.fOptStat,JSROOT.gStyle.fOptFit):!1:void 0!==this.stats_lines};C.prototype.format=function(a,b){b||(b="stat");switch(b){case "stat":b=JSROOT.gStyle.fStatFormat;break;case "fit":b=JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&
Math.round(a)==a)return a.toFixed(0);b="14.7g";break;case "last":b=this.lastformat}a=q.floatToString(a,b||"6.4g",!0);this.lastformat=a[1];return a[0]};C.prototype.drawContent=function(){return this.fillStatistic()?this.drawStatistic(this.stats_lines):Promise.resolve(this)};C.prototype.changeMask=function(a){var b=this.getObject();a=1<<a;b.fShowMask=b.fShowMask&a?b.fShowMask&~a:b.fShowMask|a;this.fillStatistic()&&this.drawStatistic(this.stats_lines)};C.prototype.statsContextMenu=function(a){var b=
this;a.preventDefault();a.stopPropagation();q.createMenu(a,this).then(function(a){var c=b.getObject(),f=b.changeMask.bind(b);a.add("header: StatBox");for(var l=0;l<c.fEntries.length;++l)a.addchk(c.fShowMask&1<<l,c.fEntries[l],l,f);return b.fillObjectExecMenu(a)}).then(function(a){return a.show()})};C.prototype.drawStatistic=function(a){var b=this.v7EvalFont("stats_text",{size:12,color:"black",align:22}),c=0,d=0,f=0,l=this.pave_width,g=this.pave_height;if(!a)return Promise.resolve(this);for(var k=
a.length,e=0;e<k;++e){var q=a[e];0<e&&(f=Math.max(f,q.length));0==e||0>q.indexOf("|")||(0===c&&(c=e),q=q.split("|"),q.length>d&&(d=q.length))}e=g/k;var m=!1,h=.02*l;q=this.draw_g.select(".statlines");q.empty()?q=this.draw_g.append("svg:g").attr("class","statlines"):q.selectAll("*").remove();b.setSize(g/(1.2*k));this.startTextDrawing(b,"font",q);if(1==k)this.drawText({width:l,height:g,text:a[0],latex:1,draw_g:q});else for(b=0;b<k;++b){var u=b*e;if(c&&b>=c)for(var x=a[b].split("|"),r=0;r<x.length;++r)this.drawText({align:"middle",
x:l*r/d,y:u,latex:0,width:l/d,height:e,text:x[r],draw_g:q});else if(0>a[b].indexOf("="))0==b&&(m=!0,a[b].length>f+5&&(a[b]=a[b].substr(0,f+2)+"...")),this.drawText({align:0==b?"middle":"start",x:h,y:u,width:l-2*h,height:e,text:a[b],draw_g:q});else{r=a[b].split("=");x=[];for(var t=0;2>t;++t)x.push({align:0==t?"start":"end",x:h,y:u,width:l-2*h,height:e,text:r[t],draw_g:q,_expected_width:l-2*h,_args:x,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*(this._args[0].result_width&&
this._args[1].result_width)/this.__expected_width,this.draw_g)}});for(u=0;2>u;++u)this.drawText(x[u])}}a="";m&&(a+="M0,"+Math.round(e)+"h"+l);if(0<c&&1<d){for(f=c;f<k;++f)a+="M0,"+Math.round(f*e)+"h"+l;for(k=0;k<d-1;++k)a+="M"+Math.round(l/d*(k+1))+","+Math.round(c*e)+"V"+g}a&&this.draw_g.append("svg:path").attr("d",a);return this.finishTextDrawing(q)};C.prototype.redraw=function(a){var b=this;a&&"string"==typeof a&&0==a.indexOf("zoom")&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&(a={_typename:"ROOT::Experimental::RHistStatBoxBase::RRequest",
mask:this.getObject().fShowMask},this.v7SubmitRequest("stat",a,function(a){return b.updateStatistic(a)}));this.drawPave()};JSROOT.v7.RHistPainter=k;JSROOT.v7.RH1Painter=u;JSROOT.v7.RH2Painter=z;JSROOT.v7.drawHist1=Y;JSROOT.v7.drawHist2=I;JSROOT.v7.drawHistDisplayItem=function(a,b,c){return b?1==b.fAxes.length?Y(a,b,c):2==b.fAxes.length?I(a,b,c):3==b.fAxes.length?JSROOT.require("v7hist3d").then(function(){return JSROOT.v7.drawHist3(a,b,c)}):null:null};JSROOT.v7.drawHistStats=function(a,b,c){var d=
new C(a,b,c);return q.ensureRCanvas(d,!1).then(function(){return d.drawPave()})};return JSROOT});
