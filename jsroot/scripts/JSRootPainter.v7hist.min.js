var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,E,p){g!=Array.prototype&&g!=Object.prototype&&(g[E]=p.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(g,E,p,A){if(E){p=$jscomp.global;g=g.split(".");for(A=0;A<g.length-1;A++){var H=g[A];H in p||(p[H]={});p=p[H]}g=g[g.length-1];A=p[g];E=E(A);E!=A&&null!=E&&$jscomp.defineProperty(p,g,{configurable:!0,writable:!0,value:E})}};$jscomp.arrayIteratorImpl=function(g){var E=0;return function(){return E<g.length?{done:!1,value:g[E++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(g,E){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:E})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function g(p){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(p||"")+"_"+E++,p)}var E=0;return g}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.asyncIterator;g||(g=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};
$jscomp.iteratorFromArray=function(g,E){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var p=0,A={next:function(){if(p<g.length){var H=p++;return{value:E(H,g[H]),done:!1}}A.next=function(){return{done:!0,value:void 0}};return A.next()}};A[Symbol.iterator]=function(){return A};return A};$jscomp.polyfill("Array.prototype.entries",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(g,p){return[g,p]})}},"es6","es3");
(function(g){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],g);else if("object"===typeof exports&&"undefined"!==typeof module)g(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.v7hist.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.v7hist.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.v7hist.js");g(JSROOT,d3)}})(function(g,
E){function p(a){g.TObjectPainter.call(this,a);this.csstype="hist";this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.zoom_changed_interactive=0;this.GetHisto(!0)}function A(a){p.call(this,a);this.wheel_zoomy=!1}function H(a,c,b){var d=new A(c);if(!d.PrepareFrame(a))return null;d.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:g.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,
BarWidth:1,BaseLine:!1,Mode3D:!1};a=d.v7EvalAttr("kind","hist");c=d.v7EvalAttr("sub",0);b=d.options;b.Text=d.v7EvalAttr("text",!1);b.BarOffset=d.v7EvalAttr("bar_offset",0);b.BarWidth=d.v7EvalAttr("bar_width",1);switch(a){case "bar":b.Bar=!0;b.BarStyle=c;break;case "err":b.Error=!0;b.ErrorKind=c;break;case "p":b.Mark=!0;break;case "l":b.Line=!0;break;case "lego":b.Lego=0<c?10+c:12;b.Mode3D=!0;break;default:b.Hist=!0}d.ScanContent();d.CallDrawFunc(function(){d.DrawingReady()});return d}function v(a){p.call(this,
a);this.wheel_zoomy=!0}function ba(a,c,b){var d=new v(c);if(!d.PrepareFrame(a))return null;d.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Candle:"",Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:-1111,maximum:-1111};a=d.v7EvalAttr("kind","");c=d.v7EvalAttr("sub",0);b=d.options;b.Text=d.v7EvalAttr("text",!1);switch(a){case "lego":b.Lego=0<c?10+c:12;b.Mode3D=
!0;break;case "surf":b.Surf=0<c?10+c:1;b.Mode3D=!0;break;case "box":b.Box=!0;b.BoxStyle=10+c;break;case "err":b.Error=!0;b.Mode3D=!0;break;case "cont":b.Contour=0<c?10+c:1;break;case "arr":b.Arrow=!0;break;case "scat":b.Scat=!0;break;case "col":b.Color=!0;break;default:b.Text||(b.Color=!0)}d.IsTH2Poly()&&(b.Mode3D?b.Lego=12:b.Color=!0);d._show_empty_bins=!1;d._can_move_colz=!0;d.ScanContent();d.CallDrawFunc(function(){d.DrawingReady()});return d}function M(a){g.v7.RHistPainter.call(this,a);this.mode3d=
!0}function ca(a,c,b){var d=new M(c);d.PrepareFrame(a,!0);d.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};a=d.v7EvalAttr("kind","");c=d.v7EvalAttr("sub",0);b=d.options;switch(a){case "box":b.Box=10+c;break;case "sphere":b.Sphere=10+c;break;case "col":b.Color=!0;break;case "scat":b.Scatter=!0;break;default:b.Box=10}g.AssertPrerequisites("v7hist3d",function(){d.ScanContent();d.Redraw();d.DrawingReady()}.bind(this));return d}function F(a,c){g.v7.RPavePainter.call(this,a,c,
"stats")}g.sources.push("v7hist");p.prototype=Object.create(g.TObjectPainter.prototype);p.prototype.PrepareFrame=function(a,c){this.SetDivId(a,-1);this.frame_painter()||g.v7.drawFrame(a,null,c?"3d":"");return this.SetDivId(a,c?4:1)};p.prototype.GetHImpl=function(a){return a&&a.fHistImpl?a.fHistImpl.fIO:null};p.prototype.IsDisplayItem=function(){var a=this.GetObject();return a&&a.fAxes?!0:!1};p.prototype.GetHisto=function(a){var c=this.GetObject(),b=this.GetHImpl(c);!b||b.getBinContent&&!a?!b&&c&&
c.fAxes&&(b=c,!b.getBinContent||a)&&(3==b.fAxes.length?(this.ProvideAxisMethods(b.fAxes[0]),this.ProvideAxisMethods(b.fAxes[1]),this.ProvideAxisMethods(b.fAxes[2]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+1,b.stepy=b.fIndicies[5],b.nz=b.fIndicies[7]-b.fIndicies[6],b.dz=b.fIndicies[6]+1,b.stepz=b.fIndicies[8],b.getBin=function(a,b,c){return a-1+this.fAxes[0].GetNumBins()*(b-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*
(c-1)},b.getBin0=1<b.stepx||1<b.stepy||1<b.stepz?function(a,b,c){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((c-this.dz)/this.stepz)}:function(a,b,c){return a-this.dx+this.nx*(b-this.dy)+this.nx*this.ny*(c-dz)},b.getBinContent=function(a,b,c){return this.fBinContent[this.getBin0(a,b,c)]},b.getBinError=function(a,b,c){return Math.sqrt(Math.abs(this.getBinContent(a,b,c)))}):2==b.fAxes.length?(this.ProvideAxisMethods(b.fAxes[0]),
this.ProvideAxisMethods(b.fAxes[1]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+1,b.stepy=b.fIndicies[5],b.getBin=function(a,b){return a-1+this.fAxes[0].GetNumBins()*(b-1)},b.getBin0=1<b.stepx||1<b.stepy?function(a,b){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)}:function(a,b){return a-this.dx+this.nx*(b-this.dy)},b.getBinContent=function(a,b){return this.fBinContent[this.getBin0(a,
b)]},b.getBinError=function(a,b){return Math.sqrt(Math.abs(this.getBinContent(a,b)))}):(this.ProvideAxisMethods(b.fAxes[0]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.getBin=function(a){return a-1},b.getBin0=1<b.stepx?function(a){return Math.floor((a-this.dx)/this.stepx)}:function(a){return a-this.dx},b.getBinContent=function(a){return this.fBinContent[this.getBin0(a)]},b.getBinError=function(a){return Math.sqrt(Math.abs(this.getBinContent(a)))})):b.fAxes._2?
(this.ProvideAxisMethods(b.fAxes._0),this.ProvideAxisMethods(b.fAxes._1),this.ProvideAxisMethods(b.fAxes._2),b.getBin=function(a,b,c){return a-1+this.fAxes._0.GetNumBins()*(b-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(c-1)},b.getBinContent=function(a,b,c){return this.fStatistics.fBinContent[this.getBin(a,b,c)]},b.getBinError=function(a,b,c){a=this.getBin(a,b,c);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):
b.fAxes._1?(this.ProvideAxisMethods(b.fAxes._0),this.ProvideAxisMethods(b.fAxes._1),b.getBin=function(a,b){return a-1+this.fAxes._0.GetNumBins()*(b-1)},b.getBinContent=function(a,b){return this.fStatistics.fBinContent[this.getBin(a,b)]},b.getBinError=function(a,b){a=this.getBin(a,b);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):(this.ProvideAxisMethods(b.fAxes._0),b.getBin=function(a){return a-1},
b.getBinContent=function(a){return this.fStatistics.fBinContent[a-1]},b.getBinError=function(a){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a-1]))});return b};p.prototype.IsRProfile=function(){return!1};p.prototype.IsTH2Poly=function(){return!1};p.prototype.DecodeOptions=function(a){this.options||(this.options={Hist:1})};p.prototype.Clear3DScene=function(){var a=this.frame_painter();a&&"function"===
typeof a.Create3DScene&&a.Create3DScene(-1);this.mode3d=!1};p.prototype.Cleanup=function(){this.Clear3DScene();delete this.options;g.TObjectPainter.prototype.Cleanup.call(this)};p.prototype.Dimension=function(){return 1};p.prototype.ScanContent=function(a){alert("HistPainter.prototype.ScanContent not implemented")};p.prototype.DrawAxes=function(){var a=this.frame_painter();if(!a)return!1;this.is_main_painter()&&this.draw_content&&(a.CleanupAxes(),a.xmin=a.xmax=0,a.ymin=a.ymax=0,a.zmin=a.zmax=0,a.SetAxesRanges(this.xmin,
this.xmax,this.ymin,this.ymax,this.zmin,this.zmax));return a.DrawAxes()};p.prototype.CheckHistDrawAttributes=function(){this.createv7AttFill();this.createv7AttLine()};p.prototype.UpdateDisplayItem=function(a,c){if(!a||!c)return!1;a.fAxes=c.fAxes;a.fIndicies=c.fIndicies;a.fBinContent=c.fBinContent;a.fContMin=c.fContMin;a.fContMinPos=c.fContMinPos;a.fContMax=c.fContMax;this.GetHisto(!0);return!0};p.prototype.UpdateObject=function(a,c){c=this.GetObject();if(a!==c){if(!this.MatchObjectType(a))return!1;
if(this.IsDisplayItem())this.UpdateDisplayItem(c,a);else{c=this.GetHImpl(c);var b=this.GetHImpl(a);if(!c||!b)return!1;c.fStatistics=b.fStatistics;histo.fTitle=a.fTitle}}this.ScanContent();return this.histogram_updated=!0};p.prototype.GetAxis=function(a){var c=this.GetHisto(),b=this.GetObject(),d=null;if(b&&b.fAxes)switch(a){case "x":d=b.fAxes[0];break;case "y":d=b.fAxes[1];break;case "z":d=b.fAxes[2];break;default:d=b.fAxes[0]}else if(c&&c.fAxes)switch(a){case "x":d=c.fAxes._0;break;case "y":d=c.fAxes._1;
break;case "z":d=c.fAxes._2;break;default:d=c.fAxes._0}d&&!d.GetBinCoord&&this.ProvideAxisMethods(d);return d};p.prototype.ProvideAxisMethods=function(a){"ROOT::Experimental::RAxisEquidistant"==a._typename?(a.min=a.fLow,a.max=a.fLow+a.fNBinsNoOver/a.fInvBinWidth,a.GetNumBins=function(){return this.fNBinsNoOver},a.GetBinCoord=function(a){return this.fLow+a/this.fInvBinWidth},a.FindBin=function(a,b){return Math.floor((a-this.fLow)*this.fInvBinWidth+b)}):(a.min=a.fBinBorders[0],a.max=a.fBinBorders[a.fBinBorders.length-
1],a.GetNumBins=function(){return this.fBinBorders.length},a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fBinBorders[0];if(b>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(b==a)return this.fBinBorders[b];var c=a<b?b-1:b+1;return this.fBinBorders[b]*Math.abs(a-c)+this.fBinBorders[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fBinBorders.length;++c)if(a<this.fBinBorders[c])return Math.floor(c-1+b);return this.fBinBorders.length-1});
a.GetBinCenter=function(a){return this.GetBinCoord(a-.5)};a.GetBinLowEdge=function(a){return this.GetBinCoord(a-1)}};p.prototype.CreateAxisFuncs=function(a,c){if(this.GetHisto()){var b=this.GetAxis("x");this.xmin=b.min;this.xmax=b.max;a&&this.nbinsy&&(b=this.GetAxis("y"),this.ymin=b.min,this.ymax=b.max,c&&this.nbinsz&&(b=this.GetAxis("z"),this.zmin=b.min,this.zmax=b.max))}};p.prototype.AddInteractive=function(){if(this.is_main_painter()){var a=this.frame_painter();a&&a.AddInteractive()}};p.prototype.DrawBins=
function(){alert("HistPainter.DrawBins not implemented")};p.prototype.ProcessItemReply=function(a,c){if(!this.IsDisplayItem())return console.error("Get item when display normal histogram");if(c.reqid===this.current_item_reqid){if(null!==a)this.UpdateDisplayItem(this.GetObject(),a.item);else if(void 0===c._draw_call_back)return;c.method()}a=c._draw_call_back;delete c._draw_call_back;g.CallBack(a)};p.prototype.DrawingBins=function(a,c,b){b=b.bind(this);var d=!1;c&&"string"==typeof c&&0==c.indexOf("zoom")&&
(0<c.indexOf("0")&&(d=!0),1<this.Dimension()&&0<c.indexOf("1")&&(d=!0),2<this.Dimension()&&0<c.indexOf("2")&&(d=!0));if(this.IsDisplayItem()&&d&&this.v7CommMode()==g.v7.CommMode.kNormal&&this.PrepareDraw({only_indexes:!0}).incomplete&&(c=this.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},this.ProcessItemReply.bind(this)))){this.current_item_reqid=c.reqid;c._draw_call_back=a;c.method=b;setTimeout(this.ProcessItemReply.bind(this,null,c),1E3);return}b();g.CallBack(a)};
p.prototype.ToggleTitle=function(a){return!1};p.prototype.DrawTitle=function(){};p.prototype.UpdateStatWebCanvas=function(){};p.prototype.ToggleStat=function(a){};p.prototype.GetSelectIndex=function(a,c,b){var d=this.frame_painter(),h=this.GetAxis(a),f=this["nbins"+a]||0,m=d?d["zoom_"+a+"min"]:0;a=d?d["zoom_"+a+"max"]:0;m!==a&&h?(c="left"==c?h.FindBin(m,b||0):h.FindBin(a,(b||0)+.5),0>c?c=0:c>f&&(c=f)):c="left"==c?0:f;return c};p.prototype.FindStat=function(){return null};p.prototype.IgnoreStatsFill=
function(){return!0};p.prototype.CreateStat=function(a){return null};p.prototype.ButtonClick=function(a){switch(a){case "ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax){this.Unzoom();if(a=this.frame_painter())a.zoom_changed_interactive=0;return!0}if(this.draw_content&&"function"===typeof this.AutoZoom)return this.AutoZoom(),!0;break;case "ToggleLogX":this.frame_painter().ToggleLog("x");break;case "ToggleLogY":this.frame_painter().ToggleLog("y");
break;case "ToggleLogZ":this.frame_painter().ToggleLog("z");break;case "ToggleStatBox":return this.ToggleStat(),!0}return!1};p.prototype.FillToolbar=function(a){var c=this.pad_painter();c&&(c.AddButton(g.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),c.AddButton(g.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown"),c.AddButton(g.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp"),1<this.Dimension()&&c.AddButton(g.ToolbarIcons.arrow_diag,
"Toggle log z","ToggleLogZ"),this.draw_content&&c.AddButton(g.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox"),a||c.ShowButtons())};p.prototype.Get3DToolTip=function(a){var c=this.GetHisto(),b={bin:a,name:c.fName||"histo",title:c.fTitle};switch(this.Dimension()){case 1:b.ix=a+1;b.iy=1;b.value=c.getBinContent(b.ix);b.error=c.getBinError(b.ix);b.lines=this.GetBinTips(a-1);break;case 2:b.ix=a%this.nbinsx+1;b.iy=(a-(b.ix-1))/this.nbinsx+1;b.value=c.getBinContent(b.ix,b.iy);b.error=c.getBinError(b.ix,
b.iy);b.lines=this.GetBinTips(b.ix-1,b.iy-1);break;case 3:b.ix=a%this.nbinsx+1,b.iy=(a-(b.ix-1))/this.nbinsx%this.nbinsy+1,b.iz=(a-(b.ix-1)-(b.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+1,b.value=c.getBinContent(b.ix,b.iy,b.iz),b.error=c.getBinError(b.ix,b.iy,b.iz),b.lines=this.GetBinTips(b.ix-1,b.iy-1,b.iz-1)}return b};p.prototype.CreateContour=function(a,c,b){if(a&&c){b||(b={});var d=g.gStyle.fNumberContours,h=this.minbin,f=this.maxbin,m=this.minposbin;b&&b.scatter_plot&&(50<d&&(d=50),h=this.minposbin);
h===f&&(h=this.gminbin,f=this.gmaxbin,m=this.gminposbin);3>this.Dimension()&&(a.zoom_zmin!==a.zoom_zmax?(h=a.zoom_zmin,f=a.zoom_zmax):b.full_z_range&&(h=a.zmin,f=a.zmax));c.CreateContour(a.logz,d,h,f,m);3>this.Dimension()&&(a.scale_zmin=c.colzmin,a.scale_zmax=c.colzmax)}};p.prototype.FillContextMenu=function(a){this.GetHisto();a.add("header:v7histo::anyname");this.draw_content&&(a.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()}),"function"==typeof this.FillHistContextMenu&&
this.FillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var c=this.main_painter()||this,b=this.frame_painter();a.addchk(c.IsTooltipAllowed(),"Show tooltips",function(){c.SetTooltipAllowed("toggle")});a.addchk(b.enable_highlight,"Highlight bins",function(){b.enable_highlight=!b.enable_highlight;!b.enable_highlight&&c.BinHighlight3D&&c.mode3d&&c.BinHighlight3D(null)});b&&b.Render3D&&(a.addchk(c.options.FrontBox,"Front box",function(){c.options.FrontBox=!c.options.FrontBox;
b.Render3D()}),a.addchk(c.options.BackBox,"Back box",function(){c.options.BackBox=!c.options.BackBox;b.Render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.RedrawPad()}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()}),this.FillPaletteMenu&&this.FillPaletteMenu(a));c.control&&"function"===typeof c.control.reset&&a.add("Reset camera",function(){c.control.reset()})}this.FillAttContextMenu(a);
this.histogram_updated&&this.zoom_changed_interactive&&a.add("Let update zoom",function(){this.zoom_changed_interactive=0});return!0};p.prototype.UpdatePaletteDraw=function(){if(this.is_main_painter()){var a=this.FindPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");a&&a.DrawPalette()}};p.prototype.FillPaletteMenu=function(a){function c(a){h.options.Palette=parseInt(a);h.Redraw()}function b(b,h,l){a.addchk(b===d||l,"<nobr>"+h+"</nobr>",b,c)}var d=this.options.Palette,h=this;if(null===
d||0===d)d=g.gStyle.Palette;a.add("sub:Palette");b(50,"ROOT 5",10<=d&&51>d);b(51,"Deep Sea");b(52,"Grayscale",0<d&&10>d);b(53,"Dark body radiator");b(54,"Two-color hue");b(55,"Rainbow");b(56,"Inverted dark body radiator");b(57,"Bird",112<d);b(58,"Cubehelix");b(59,"Green Red Violet");b(60,"Blue Red Yellow");b(61,"Ocean");b(62,"Color Printable On Grey");b(63,"Alpine");b(64,"Aquamarine");b(65,"Army");b(66,"Atlantic");a.add("endsub:")};p.prototype.DrawColorPalette=function(a,c,b){return null};p.prototype.ToggleColz=
function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.DrawColorPalette(this.options.Zscale,!1,!0)};p.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?
12:1,this.options.Zero=!1);this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};p.prototype.PrepareDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.right_extra&&(a.right_extra=a.extra);void 0===a.middle&&(a.middle=0);var c=this.GetHisto(),b=this.GetAxis("x"),d=this.GetAxis("y"),h=this.frame_painter(),f=this.Dimension(),m,l,e={i1:this.GetSelectIndex("x","left",0-a.extra),i2:this.GetSelectIndex("x","right",1+a.right_extra),j1:2>f?0:this.GetSelectIndex("y",
"left",0-a.extra),j2:2>f?1:this.GetSelectIndex("y","right",1+a.right_extra),k1:3>f?0:this.GetSelectIndex("z","left",0-a.extra),k2:3>f?1:this.GetSelectIndex("z","right",1+a.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};this.IsDisplayItem()&&c.fIndicies&&(e.i1<c.fIndicies[0]&&(e.i1=c.fIndicies[0],e.incomplete=!0),e.i2>c.fIndicies[1]&&(e.i2=c.fIndicies[1],e.incomplete=!0),e.stepi=c.fIndicies[2],1<e.stepi&&(e.incomplete=!0),1<f&&5<c.fIndicies.length&&(e.j1<c.fIndicies[3]&&
(e.j1=c.fIndicies[3],e.incomplete=!0),e.j2>c.fIndicies[4]&&(e.j2=c.fIndicies[4],e.incomplete=!0),e.stepj=c.fIndicies[5],1<e.stepj&&(e.incomplete=!0)),2<f&&8<c.fIndicies.length&&(e.k1<c.fIndicies[6]&&(e.k1=c.fIndicies[6],e.incomplete=!0),e.k2>c.fIndicies[7]&&(e.k2=c.fIndicies[7],e.incomplete=!0),e.stepk=c.fIndicies[8],1<e.stepk&&(e.incomplete=!0)));if(a.only_indexes)return e;e.grx=Array(e.i2+e.stepi+1);e.gry=Array(e.j2+e.stepj+1);a.original&&(e.original=!0,e.origx=Array(e.i2+1),e.origy=Array(e.j2+
1));a.pixel_density&&(a.rounding=!0);for(m=e.i1;m<=e.i2;++m){var x=b.GetBinCoord(m+a.middle);h.logx&&0>=x?e.i1=m+1:(e.origx&&(e.origx[m]=x),e.grx[m]=h.grx(x),a.rounding&&(e.grx[m]=Math.round(e.grx[m])),a.use3d&&(e.grx[m]<-h.size_xy3d&&(e.i1=m,e.grx[m]=-h.size_xy3d),e.grx[m]>h.size_xy3d&&(e.i2=m,e.grx[m]=h.size_xy3d)))}a.use3d&&(e.i1<e.i2-2&&e.grx[e.i1]==e.grx[e.i1+1]&&e.i1++,e.i1<e.i2-2&&e.grx[e.i2-1]==e.grx[e.i2]&&e.i2--);for(;m<e.i2+e.stepi+1;)e.grx[m++]=e.grx[e.i2];if(1===f)e.gry[0]=h.gry(0),e.gry[1]=
h.gry(1);else for(l=e.j1;l<=e.j2;++l)m=d.GetBinCoord(l+a.middle),h.logy&&0>=m?e.j1=l+1:(e.origy&&(e.origy[l]=m),e.gry[l]=h.gry(m),a.rounding&&(e.gry[l]=Math.round(e.gry[l])),a.use3d&&(e.gry[l]<-h.size_xy3d&&(e.j1=l,e.gry[l]=-h.size_xy3d),e.gry[l]>h.size_xy3d&&(e.j2=l,e.gry[l]=h.size_xy3d)));a.use3d&&1<f&&(e.j1<e.j2-2&&e.gry[e.j1]==e.gry[e.j1+1]&&e.j1++,e.j1<e.j2-2&&e.gry[e.j2-1]==e.gry[e.j2]&&e.j2--);for(;1<f&&l<e.j2+e.stepj+1;)e.gry[l++]=e.gry[e.j2];c.getBinContent(e.i1+1,e.j1+1);this.maxbin=this.minbin=
this.minposbin=null;for(m=e.i1;m<e.i2;m+=e.stepi)for(l=e.j1;l<e.j2;l+=e.stepj)if(d=c.getBinContent(m+1,l+1),!isNaN(d)){e.sumz+=d;if(a.pixel_density){f=(e.grx[m+e.stepi]-e.grx[m])*(e.gry[l]-e.gry[l+e.stepj]);if(0>=f)continue;e.max=Math.max(e.max,d);0<d&&(d<e.min||0===e.min)&&(e.min=d);d/=f}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}e.palette=h.GetPalette();
e.palette&&this.CreateContour(h,e.palette,a);return e};A.prototype=Object.create(p.prototype);A.prototype.ScanContent=function(a){var c=this.GetHisto();if(c){!this.nbinsx&&a&&(a=!1);a||(this.nbinsx=this.GetAxis("x").GetNumBins(),this.nbinsy=0,this.CreateAxisFuncs(!1));var b=0,d=0,h=0,f=0;if(this.IsDisplayItem())b=c.fContMin,d=c.fContMinPos,f=h=c.fContMax;else{var m=this.GetSelectIndex("x","left"),l=this.GetSelectIndex("x","right");if(a&&m===this.scan_xleft&&l===this.scan_xright)return;this.scan_xleft=
m;this.scan_xright=l;a=!0;for(var e,x=0;x<this.nbinsx;++x)e=c.getBinContent(x+1),f+=e,x<m||x>=l||(0<e&&(0==d||e<d)&&(d=e),a&&(b=h=e,a=!1),b=Math.min(b,e-0),h=Math.max(h,e+0))}this.stat_entries=f;this.hmin=b;this.hmax=h;this.ymin_nz=d;if(this.draw_content=0==this.nbinsx||1E-300>Math.abs(b)&&1E-300>Math.abs(h)?!1:!0)b>=h?0==b?(this.ymin=0,this.ymax=1):0>b?(this.ymin=2*b,this.ymax=0):(this.ymin=0,this.ymax=2*b):(c=.05*(h-b),this.ymin=b-c,0>this.ymin&&0<=b&&(this.ymin=0),this.ymax=h+c)}};A.prototype.CountStat=
function(a){for(var c=this.IsRProfile(),b=this.GetHisto(),d=this.GetAxis("x"),h=this.GetSelectIndex("x","left"),f=this.GetSelectIndex("x","right"),m=0,l=0,e=0,x=0,k=0,n,q,D=null,r=null,t=this.frame_painter(),u={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};h<f;++h)if(n=d.GetBinCoord(h+.5),!a||a(n)){c?(q=b.fBinEntries[h+1],x+=b.fArray[h+1],k+=b.fSumw2[h+1]):q=b.getBinContent(h+1);if(null===D||q>r)D=n,r=q;m+=q;l+=q*n;e+=q*n*n}!t.IsAxisZoomed("x")&&b.fTsumw&&
(m=b.fTsumw,l=b.fTsumwx,e=b.fTsumwx2);u.integral=m;0<m&&(u.meanx=l/m,u.meany=x/m,u.rmsx=Math.sqrt(Math.abs(e/m-u.meanx*u.meanx)),u.rmsy=Math.sqrt(Math.abs(k/m-u.meany*u.meany)));null!==D&&(u.xmax=D,u.wmax=r);return u};A.prototype.FillStatistic=function(a,c,b){if(this.IgnoreStatsFill())return!1;b=this.CountStat();var d=c%10,h=Math.floor(c/10)%10,f=Math.floor(c/100)%10,m=Math.floor(c/1E3)%10,l=Math.floor(c/1E4)%10,e=Math.floor(c/1E5)%10,x=Math.floor(c/1E6)%10,k=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%
10;a.ClearStat();0<d&&a.AddText(b.name);this.IsRProfile()?(0<h&&a.AddText("Entries = "+a.Format(b.entries,"entries")),0<f&&(a.AddText("Mean = "+a.Format(b.meanx)),a.AddText("Mean y = "+a.Format(b.meany))),0<m&&(a.AddText("Std Dev = "+a.Format(b.rmsx)),a.AddText("Std Dev y = "+a.Format(b.rmsy)))):(0<h&&a.AddText("Entries = "+a.Format(b.entries,"entries")),0<f&&a.AddText("Mean = "+a.Format(b.meanx)),0<m&&a.AddText("Std Dev = "+a.Format(b.rmsx)),0<l&&a.AddText("Underflow = "+a.Format(histo.getBinContent(0),
"entries")),0<e&&a.AddText("Overflow = "+a.Format(histo.getBinContent(this.nbinsx+1),"entries")),0<x&&a.AddText("Integral = "+a.Format(b.integral,"entries")),0<k&&a.AddText("Skew = <not avail>"),0<c&&a.AddText("Kurt = <not avail>"));return!0};A.prototype.DrawBars=function(a,c,b){this.CreateG(!0);var d=a.i1;c=a.i2;a=a.stepi;var h=this.frame_painter(),f=this.GetHisto(),m=this.GetAxis("x"),l="",e="",x="";b=h.swap_xy?0:b;for(!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=
h.scale_ymin&&(b=Math.round(h.gry(this.options.BaseLine)));d<c;d+=a){var k=m.GetBinCoord(d);var n=m.GetBinCoord(d+a);if(!(h.logx&&0>=n)){k=Math.round(h.grx(k));n=Math.round(h.grx(n));var q=f.getBinContent(d+1);if(!(h.logy&&q<h.scale_ymin)){q=Math.round(h.gry(q));var D=n-k;k+=Math.round(this.options.BarOffset*D);D=Math.round(this.options.BarWidth*D);l=h.swap_xy?l+("M"+b+","+k+"h"+(q-b)+"v"+D+"h"+(b-q)+"z"):l+("M"+k+","+q+"h"+D+"v"+(b-q)+"h"+-D+"z");0<this.options.BarStyle&&(n=k+D,D=Math.round(D/10),
h.swap_xy?(e+="M"+b+","+k+"h"+(q-b)+"v"+D+"h"+(b-q)+"z",x+="M"+b+","+n+"h"+(q-b)+"v"+-D+"h"+(b-q)+"z"):(e+="M"+k+","+q+"h"+D+"v"+(b-q)+"h"+-D+"z",x+="M"+n+","+q+"h"+-D+"v"+(b-q)+"h"+D+"z"))}}}this.fillatt.empty()&&this.fillatt.SetSolidColor("blue");0<l.length&&this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func);0<e.length&&this.draw_g.append("svg:path").attr("d",e).call(this.fillatt.func).style("fill",E.rgb(this.fillatt.color).brighter(.5).toString());0<x.length&&this.draw_g.append("svg:path").attr("d",
x).call(this.fillatt.func).style("fill",E.rgb(this.fillatt.color).darker(.5).toString())};A.prototype.DrawFilledErrors=function(a,c,b){this.CreateG(!0);var d=a.i1;c=a.i2;var h=a.stepi,f=this.frame_painter(),m=this.GetHisto(),l=this.GetAxis("x");b=[];for(a=[];d<c;d+=h){var e=l.GetBinCoord(d+.5);if(!(f.logx&&0>=e)){e=Math.round(f.grx(e));var x=m.getBinContent(d+1);var k=m.getBinError(d+1);if(!(f.logy&&x-k<f.scale_ymin)){var n=Math.round(f.gry(x+k));x=Math.round(f.gry(x-k));b.push({grx:e,gry:n});a.unshift({grx:e,
gry:x})}}}c=4===this.options.ErrorKind?"bezier":"line";b=g.Painter.BuildSvgPath(c,b);a=g.Painter.BuildSvgPath("L"+c,a);this.fillatt.empty()&&this.fillatt.setSolidColor("blue");this.draw_g.append("svg:path").attr("d",b.path+a.path+"Z").style("stroke","none").call(this.fillatt.func)};A.prototype.DrawBins=function(){var a=this.frame_width(),c=this.frame_height();if(!this.draw_content||0>=a||0>=c)return this.RemoveDrawG();this.CheckHistDrawAttributes();var b=this.PrepareDraw({extra:1,only_indexes:!0});
return this.options.Bar?this.DrawBars(b,a,c):3===this.options.ErrorKind||4===this.options.ErrorKind?this.DrawFilledErrors(b,a,c):this.DrawHistBins(b,a,c)};A.prototype.DrawHistBins=function(a,c,b){function d(a){T=k.getBinContent(a+1);p&&0===T||(L=Math.round(e.grx(n.GetBinCoord(a))),N=Math.round(e.grx(n.GetBinCoord(a+l))),P=Math.round((L+N)/2),K=Math.round(e.gry(T)),Q=V=20,y&&(Z=k.getBinError(a+1),Q=Math.round(K-e.gry(T+Z)),V=Math.round(e.gry(T-Z)-K)),v&&(a=A?k.fBinEntries[a+1]:T,0!==a&&(a=a===Math.round(a)?
a.toString():g.FFormat(a,g.gStyle.fPaintTextFormat),M?x.DrawText({align:12,x:P,y:Math.round(K-2-R/5),width:0,height:0,rotate:M,text:a,color:da,latex:0}):x.DrawText({align:22,x:Math.round(L+.1*(N-L)),y:Math.round(K-2-R),width:Math.round(.8*(N-L)),height:R,text:a,color:da,latex:0}))),B&&null!==F&&(F+=(0===F.length?"M":"L")+P+","+K),W&&K>=-Q&&K<=b+V&&(null!==C&&(C+="M"+L+","+(K-Q)+"h"+(N-L)+"v"+(Q+V+1)+"h-"+(N-L)+"z"),null!==E&&(E+=x.markeratt.create(P,K)),null!==z&&(0<x.options.errorX&&(a=Math.round(P-
(N-L)*x.options.errorX),z+="M"+(a+X)+","+K+H+"h"+(Math.round(P+(N-L)*x.options.errorX)-a-2*X)+H),z+="M"+P+","+(K-Q+X)+aa+"v"+(Q+V-2*X)+aa)))}this.CreateG(!0);var h=this.options,f=a.i1,m=a.i2,l=a.stepi,e=this.frame_painter(),x=this,k=this.GetHisto(),n=this.GetAxis("x");a="";var q=!1,D,r,t,u,I,w,p=!h.Zero,y=h.Error;q=h.Mark;var B=h.Line,v=h.Text,A=v&&"E"==this.options.TextKind&&this.IsRProfile(),C=null,z=null,E=null,F=null,H="",aa="",X=0,K,Q,V,T,Z,L,N,P;y&&!q&&1<this.v7EvalAttr("marker_style",1)&&(q=
!0);2===h.ErrorKind?this.fillatt.empty()?q=!0:C="":h.Error&&(z="");B&&(F="");q&&(this.createv7AttMarker(),0<this.markeratt.size?(E="",this.markeratt.reset_pos()):q=!1);if(v){var da=this.v7EvalColor("text_color","black");var M=-1*this.v7EvalAttr("text_angle",0);var R=this.v7EvalAttr("text_size",20);if(!M&&!h.TextKind){var G=c/(m-f+1);G<3*R&&(M=270,R=Math.round(.7*G))}this.StartTextDrawing(42,R,this.draw_g,R)}c=m-f>3*c;1===h.ErrorKind&&(G=this.lineatt.width+g.gStyle.fEndErrorSize,H="m0,"+G+"v-"+2*G+
"m0,"+G,aa="m"+G+",0h-"+2*G+"m"+G+",0",X=Math.floor((this.lineatt.width-1)/2));var W=y||q;if(W||v||B)c=!0;for(G=f;G<=m;G+=l)if(q=n.GetBinCoord(G),!(e.logx&&0>=q)){var O=Math.round(e.grx(q));if((q=G>m-l)&&f<m)var J=t;else J=k.getBinContent(G+1),J=Math.round(e.gry(J));if(0===a.length){var S=w=G;var Y=D=r=O;var U=u=I=t=J;a="M"+r+","+t}else if(c)if(O!==r||q){if(W||v||B)S===w?d(S):S<w?(d(S),d(w)):(d(w),d(S));W||u===I&&U===u||(Y!==r&&(a+="h"+(r-Y)),t===u?(I!==U&&(a+="v"+(I-U)),u!==I&&(a+="v"+(u-I))):(u!==
U&&(a+="v"+(u-U)),I!==u&&(a+="v"+(I-u)),t!==I&&(a+="v"+(t-I))),Y=r,U=t);q&&Y!==O&&(a+="h"+(O-Y));S=w=G;u=I=t=J;r=O}else J<u?w=G:J>I&&(S=G),u=Math.min(u,J),I=Math.max(I,J),t=J;else if(J!==t||q)O!==r&&(a+="h"+(O-r)),J!==t&&(a+="v"+(J-t)),t=J,r=O}f="";this.fillatt.empty()||(f=b+3,m=Math.round(e.gry(0)),0>=m?f=-3:m<b&&(f=m),f="L"+r+","+f+"L"+D+","+f+"Z",0<a.length&&(a+=f));W||B?(null!==C&&0<C.length&&this.draw_g.append("svg:path").attr("d",C).call(this.fillatt.func),null!==z&&0<z.length&&this.draw_g.append("svg:path").attr("d",
z).call(this.lineatt.func),null!==F&&0<F.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",h.Fill?F+f:a).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",F).attr("fill","none").call(this.lineatt.func)),null!==E&&0<E.length&&this.draw_g.append("svg:path").attr("d",E).call(this.markeratt.func)):a&&h.Hist&&this.draw_g.append("svg:path").attr("d",a).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);v&&this.FinishTextDrawing(this.draw_g)};
A.prototype.GetBinTips=function(a){var c=[],b=this.GetTipName(),d=this.frame_painter(),h=this.GetHisto(),f=this.GetAxis("x"),m=this.IsDisplayItem()?h.stepx:1,l=f.GetBinCoord(a),e=f.GetBinCoord(a+m);f=h.getBinContent(a+1);var x=!1;0<b.length&&c.push(b);"labels"===d.x_kind?b=d.AxisAsText("x",l):"time"===d.x_kind?b=d.AxisAsText("x",(l+e)/2):(x=!0,b="["+d.AxisAsText("x",l)+", "+d.AxisAsText("x",e)+")");this.options.Error||this.options.Mark?(c.push("x = "+b),c.push("y = "+d.AxisAsText("y",f)),this.options.Error&&
(x&&c.push("error x = "+((e-l)/2).toPrecision(4)),c.push("error y = "+h.getBinError(a+1).toPrecision(4)))):(c.push("bin = "+a),c.push("x = "+b),h.$baseh&&(f-=h.$baseh.getBinContent(a+1)),a="entries = "+(1<m?"~":""),f===Math.round(f)?c.push(a+f):c.push(a+g.FFormat(f,g.gStyle.fStatFormat)));return c};A.prototype.ProcessTooltip=function(a){function c(a){a=l.GetBinCoord(a);return f.logx&&0>=a?null:f.grx(a)}function b(a){a=m.getBinContent(a+1);return f.logy&&a<f.scale_ymin?f.swap_xy?-1E3:10*h:Math.round(f.gry(a))}
if(null===a||!this.draw_content||this.options.Mode3D)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.frame_width(),h=this.frame_height(),f=this.frame_painter(),m=this.GetHisto(),l=this.GetAxis("x"),e=null,x=!0,k,n=2,q=this.GetSelectIndex("x","left",-1),D=this.GetSelectIndex("x","right",2);var r=q;var t=D;for(var u=f.swap_xy?a.y:a.x,g=f.swap_xy?a.x:a.y;r<t-1;){var w=Math.round(.5*(r+t));e=c(w);null===e||e<u-.5?f.swap_xy?t=w:r=w:e>u+.5?f.swap_xy?r=w:t=w:(r++,t--)}e=
t=r;w=c(e);if(f.swap_xy){for(;r>q&&c(r-1)<w+2;)--r;for(;t<D&&c(t+1)>w-2;)++t}else{for(;r>q&&c(r-1)>w-2;)--r;for(;t<D&&c(t+1)<w+2;)++t}if(r<t){x=h;for(w=r;w<=t;w++){var p=Math.abs(b(w)-g);p<x&&(x=p,e=w)}x>h/10&&(e=Math.round(r+(t-r)/h*g));w=c(e)}w=Math.round(w);var y=Math.round(c(e+1));this.options.Bar&&(r=y-w,w+=Math.round(this.options.BarOffset*r),y=w+Math.round(this.options.BarWidth*r));if(w>y){var B=w;w=y;y=B}r=Math.round((w+y)/2);t=p=k=b(e);if(this.options.Bar)x=!0,n=0,p=Math.round(f.gry(!1!==
this.options.BaseLine&&this.options.BaseLine>f.scale_ymin?this.options.BaseLine:f.scale_ymin)),p>k&&(B=p,p=k,k=B),!a.touch&&1===a.nproc&&(g<p||g>k)&&(e=null);else if(this.options.Error||this.options.Mark||this.options.Line)x=!0,d=3,this.markeratt&&(d=Math.max(d,this.markeratt.GetFullSize())),this.options.Error&&(B=m.getBinContent(e+1),k=m.getBinError(e+1),p=Math.round(f.gry(B+k)),k=Math.round(f.gry(B-k)),0==B&&this.IsRProfile()&&(e=null),y=(y-w)*this.options.errorX,w=Math.round(r-y),y=Math.round(r+
y)),y-w<2*d&&(w=r-d,y=r+d),p=Math.min(p,t-d),k=Math.max(k,t+d),!a.touch&&1===a.nproc&&(g<p||g>k)&&(e=null);else if(x=1===a.nproc&&D-q<d)k=h,this.fillatt.empty()||(k=Math.round(f.gry(0)),0>k?k=0:k>h&&(k=h),k<p&&(B=p,p=k,k=B)),(a.y<p||a.y>k)&&!a.touch&&(e=null);null!==e&&(e===q&&w>u+n?e=null:e===D-1&&y<u-n?e=null:u<w-n||u>y+n?e=null:this.options.Zero||0!==m.getBinContent(e+1)||(e=null));n=this.draw_g.select(".tooltip_bin");if(null===e||0>=k||p>=h)return n.remove(),null;q={name:"histo",title:m.fTitle,
x:r,y:t,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(e)};a.disabled?(n.remove(),q.changed=!0):x?(n.empty()&&(n=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),q.changed=n.property("current_bin")!==e,q.changed&&n.attr("x",f.swap_xy?p:w).attr("width",f.swap_xy?k-p:y-w).attr("y",f.swap_xy?w:p).attr("height",f.swap_xy?y-w:k-p).style("opacity","0.3").property("current_bin",
e),q.exact=5>=Math.abs(t-g)||g>=p&&g<=k,q.menu=!0,q.menu_dist=Math.sqrt((r-u)*(r-u)+(t-g)*(t-g))):(u=this.lineatt.width+3,n.empty()&&(n=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",u).call(this.lineatt.func).call(this.fillatt.func)),q.exact=Math.abs(r-a.x)<=u&&Math.abs(t-a.y)<=u,q.menu=q.exact,q.menu_dist=Math.sqrt((r-a.x)*(r-a.x)+(t-a.y)*(t-a.y)),q.changed=n.property("current_bin")!==e,q.changed&&n.attr("cx",r).attr("cy",t).property("current_bin",
e));q.changed&&(q.user_info={obj:m,name:"histo",bin:e,cont:m.getBinContent(e+1),grx:r,gry:t});return q};A.prototype.FillHistContextMenu=function(a){a.add("Auto zoom-in",this.AutoZoom);var c=g.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.Change(5,1001);this.InteractiveRedraw("pad","drawopt")})};A.prototype.AutoZoom=
function(){var a=this.GetSelectIndex("x","left",-1),c=this.GetSelectIndex("x","right",1),b=c-a,d=this.GetHisto(),h=this.GetAxis("x");if(0!=b){for(var f=d.getBinContent(a+1),m=a;m<c;++m)f=Math.min(f,d.getBinContent(m+1));if(!(0<f)){for(;a<c&&d.getBinContent(a+1)<=f;)++a;for(;a<c&&d.getBinContent(c)<=f;)--c;a===c-1&&2<a&&c<this.nbinsx-2&&(--a,++c);c-a<b&&a<c&&this.frame_painter().Zoom(h.GetBinCoord(a),h.GetBinCoord(c))}}};A.prototype.CanZoomIn=function(a,c,b){var d=this.GetAxis("x");return"x"==a&&1<
d.FindBin(b,.5)-d.FindBin(c,0)||"y"==a&&Math.abs(b-c)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};A.prototype.CallDrawFunc=function(a,c){var b=this.frame_painter();b&&b.mode3d!==this.options.Mode3D&&!this.is_main_painter()&&(this.options.Mode3D=b.mode3d);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,c)};A.prototype.Draw2D=function(a,c){this.Clear3DScene();this.mode3d=!1;if(!this.DrawAxes())return g.CallBack(a);this.DrawingBins(a,c,function(){this.DrawBins();this.UpdateStatWebCanvas();this.AddInteractive()})};
A.prototype.Draw3D=function(a,c){this.mode3d=!0;g.AssertPrerequisites("v7hist3d",function(){this.Draw3D(a,c)}.bind(this))};A.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};v.prototype=Object.create(p.prototype);v.prototype.Cleanup=function(){delete this.tt_handle;p.prototype.Cleanup.call(this)};v.prototype.Dimension=function(){return 2};v.prototype.ToggleProjection=function(a,c){"Projections"==a&&(a="");"string"==typeof a&&1<a.length&&(c=parseInt(a.substr(1)),a=a[0]);c||(c=1);if(a&&this.is_projection==
a)if(this.projection_width===c)a="";else{this.projection_width=c;return}delete this.proj_hist;a=this.is_projection===a?"":a;this.is_projection="";this.projection_width=c;(c=this.canv_painter())&&c.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this,"toggling",a))};v.prototype.RedrawProjection=function(a,c,b,d){"toggling"===a&&(this.is_projection=c)};v.prototype.ExecuteMenuCommand=function(a,c){return p.prototype.ExecuteMenuCommand.call(this,a,c)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==
a.fName?(this.ToggleProjection(a.fName[17],c&&parseInt(c)?parseInt(c):1),!0):!1};v.prototype.FillHistContextMenu=function(a){a.add("sub:Projections",this.ToggleProjection);var c=this.is_projection||"";c&&(c+=this.projection_width);for(var b="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" "),d=0;d<b.length;++d)a.addchk(c==b[d],b[d],b[d],this.ToggleProjection);a.add("endsub:");a.add("Auto zoom-in",this.AutoZoom);c=g.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,
function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.InteractiveRedraw("pad","drawopt")});this.options.Color&&this.FillPaletteMenu(a)};v.prototype.ButtonClick=function(a){if(p.prototype.ButtonClick.call(this,a))return!0;switch(a){case "ToggleColor":this.ToggleColor();break;case "ToggleColorZ":this.ToggleColz();break;case "Toggle3D":this.ToggleMode3D();break;default:return!1}return!0};v.prototype.FillToolbar=function(){p.prototype.FillToolbar.call(this,!0);var a=this.pad_painter();
a&&(this.IsTH2Poly()||a.AddButton(g.ToolbarIcons.th2color,"Toggle color","ToggleColor"),a.AddButton(g.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ"),a.AddButton(g.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D"),a.ShowButtons())};v.prototype.ToggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.Redraw()};v.prototype.AutoZoom=function(){if(!this.IsTH2Poly()){var a=this.GetSelectIndex("x",
"left",-1),c=this.GetSelectIndex("x","right",1),b=this.GetSelectIndex("y","left",-1),d=this.GetSelectIndex("y","right",1),h,f,m=this.GetHisto(),l=this.GetAxis("x"),e=this.GetAxis("y");if(a!=c&&b!=d){var x=m.getBinContent(a+1,b+1);for(h=a;h<c;++h)for(f=b;f<d;++f)x=Math.min(x,m.getBinContent(h+1,f+1));if(!(0<x)){var k=c,n=a,q=d,g=b;for(h=a;h<c;++h)for(f=b;f<d;++f)m.getBinContent(h+1,f+1)>x&&(h<k&&(k=h),h>=n&&(n=h+1),f<q&&(q=f),f>=g&&(g=f+1));h=!1;k===n-1&&k>a+1&&n<c-1&&(k--,n++);q===g-1&&q>b+1&&g<d-
1&&(q--,g++);if((k>a||n<c)&&k<n-1){var r=l.GetBinCoord(k);var t=l.GetBinCoord(n);h=!0}if((q>b||g<d)&&q<g-1){var u=e.GetBinCoord(q);var p=e.GetBinCoord(g);h=!0}h&&this.frame_painter().Zoom(r,t,u,p)}}}};v.prototype.ScanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var c;a=this.GetHisto();this.nbinsx=this.GetAxis("x").GetNumBins();this.nbinsy=this.GetAxis("y").GetNumBins();this.CreateAxisFuncs(!0);if(this.IsTH2Poly()){this.gminposbin=null;var b=this.gminbin=this.gmaxbin=0;for(c=a.fBins.arr.length;b<
c;++b){var d=a.fBins.arr[b].fContent;0===b&&(this.gminbin=this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d)}}else if(this.IsDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,b=0;b<this.nbinsx;++b)for(c=0;c<this.nbinsy;++c)d=a.getBinContent(b+1,c+1),d<this.gminbin?
this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);this.zmin=this.gminbin;this.zmax=this.gmaxbin;null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.IsTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};v.prototype.CountStat=function(a){var c=this.GetHisto(),b=0,d=0,h=0,f=0,m=0;this.frame_painter();var l=
{name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},e=this.GetSelectIndex("x","left"),x=this.GetSelectIndex("x","right"),k=this.GetSelectIndex("y","left"),n=this.GetSelectIndex("y","right"),q,g,r=this.GetAxis("x"),t=this.GetAxis("y");for(q=0;q<=this.nbinsx+1;++q){var u=q<=e?0:q>x?2:1;var p=r.GetBinCoord(q-.5);for(g=0;g<=this.nbinsy+1;++g){var w=g<=k?0:g>n?2:1;var v=t.GetBinCoord(g-.5);var y=c.getBinContent(q,g);l.entries+=y;l.matrix[3*
w+u]+=y;if(1==u&&1==w&&(null==a||a(p,v))){if(null==l.wmax||y>l.wmax)l.wmax=y,l.xmax=p,l.ymax=v;b+=y;d+=p*y;h+=v*y;f+=p*p*y;m+=v*v*y}}}0<b&&(l.meanx=d/b,l.meany=h/b,l.rmsx=Math.sqrt(Math.abs(f/b-l.meanx*l.meanx)),l.rmsy=Math.sqrt(Math.abs(m/b-l.meany*l.meany)));null===l.wmax&&(l.wmax=0);l.integral=b;return l};v.prototype.FillStatistic=function(a,c,b){b=this.CountStat();var d=Math.floor(c%10),h=Math.floor(c/10)%10,f=Math.floor(c/100)%10,m=Math.floor(c/1E3)%10,l=Math.floor(c/1E4)%10,e=Math.floor(c/1E5)%
10,g=Math.floor(c/1E6)%10,k=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.ClearStat();0<d&&a.AddText(b.name);0<h&&a.AddText("Entries = "+a.Format(b.entries,"entries"));0<f&&(a.AddText("Mean x = "+a.Format(b.meanx)),a.AddText("Mean y = "+a.Format(b.meany)));0<m&&(a.AddText("Std Dev x = "+a.Format(b.rmsx)),a.AddText("Std Dev y = "+a.Format(b.rmsy)));0<g&&a.AddText("Integral = "+a.Format(b.matrix[4],"entries"));0<k&&(a.AddText("Skewness x = <undef>"),a.AddText("Skewness y = <undef>"));0<c&&a.AddText("Kurt = <undef>");
if(0<l||0<e)c=b.matrix,a.AddText(""+c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),a.AddText(""+c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),a.AddText(""+c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0));return!0};v.prototype.DrawBinsColor=function(a,c){a=this.GetHisto();c=this.PrepareDraw();var b=[],d=[],h=[],f,m,l=c.stepi,e=c.stepj;for(f=c.i1;f<c.i2;f+=l)for(m=c.j1;m<c.j2;m+=e){var g=a.getBinContent(f+1,m+1);var k=c.palette.getContourIndex(g);if(0===g){if(!this.options.Zero)continue;
null===k&&this._show_empty_bins&&(k=0)}if(null!==k){g="M"+c.grx[f]+","+c.gry[m+e];if(void 0===b[k])b[k]=g;else{var n="m"+(c.grx[f]-d[k])+","+(c.gry[m+e]-h[k]);b[k]+=n.length<g.length?n:g}d[k]=c.grx[f];h[k]=c.gry[m+e];g=c.gry[m]-c.gry[m+e]||1;b[k]+="v"+g+"h"+(c.grx[f+l]-c.grx[f]||1)+"v"+-g+"z"}}for(k=0;k<b.length;++k)void 0!==b[k]&&this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",c.palette.getColor(k)).attr("d",b[k]);this.UpdatePaletteDraw();return c};v.prototype.BuildContour=function(a,
c,b,d){function h(a){for(var b=0;b<c.length;++b)if(a<c[b])return b-1;return c.length-1}function f(a,b,d,f,h,n,m,g){var q=d===m;m=q?g-f:m-d;b+=1;h-=a;g=k-1;for(var t=999+k,u=0,r;b<=n&&g<=t;)r=c[b],r-=a,r/=h,r*=m,q?(l[g]=d,e[g]=f+r):(l[g]=d+r,e[g]=f),x[g]=b,u++,g+=2,b++;return u}var m=this.GetHisto(),l=new Float32Array(4008),e=new Float32Array(4008),x=new Int32Array(4008),k=0;b=[];var n=0,q=[0,0,0,0],D=[0,0,0,0],r=[0,0,0,0],t=[0,0,0,0],u,p,w,v,y=a.stepi,B=a.stepj,A=a.original?a.origx:a.grx,E=a.original?
a.origy:a.gry;for(p=a.j1;p<a.j2-B;p+=B)for(D[1]=D[0]=(E[p]+E[p+B])/2,D[3]=D[2]=(E[p+B]+E[p+2*B])/2,u=a.i1;u<a.i2-y;u+=y){r[0]=m.getBinContent(u+1,p+1);r[1]=m.getBinContent(u+1+y,p+1);r[2]=m.getBinContent(u+1+y,p+1+B);r[3]=m.getBinContent(u+1,p+1+B);for(w=0;4>w;w++)t[w]=h(r[w]);if(t[0]!==t[1]||t[1]!==t[2]||t[2]!==t[3]||t[3]!==t[0]){q[3]=q[0]=(A[u]+A[u+1])/2;q[2]=q[1]=(A[u+1]+A[u+2])/2;var C=r[0]<=r[1]?0:1;var z=r[2]<=r[3]?2:3;r[C]>r[z]&&(C=z);C++;for(w=k=1;4>=w;w++)z=C%4+1,C=f(r[C-1],t[C-1],q[C-1],
D[C-1],r[z-1],t[z-1],q[z-1],D[z-1]),k+=2*C,C=z;C=r[0]<=r[1]?0:1;z=r[2]<=r[3]?2:3;r[C]>r[z]&&(C=z);C++;k=2;for(w=1;4>=w;w++)z=1==C?4:C-1,C=f(r[C-1],t[C-1],q[C-1],D[C-1],r[z-1],t[z-1],q[z-1],D[z-1]),k+=2*C,C=z;z=0;for(w=1;w<=k-5;w+=2)for(;x[w-1]!=x[w];){C=l[w];var F=e[w];var H=x[w];for(v=w;v<=k-5;v+=2)l[v]=l[v+2],e[v]=e[v+2],x[v]=x[v+2];l[k-3]=C;e[k-3]=F;x[k-3]=H;if(2E3<z)break;z++}if(!(2E3<z))for(w=1;w<=k-2;w+=2)z=x[w-1],0<=z&&z<c.length&&((F=b[z])||(F=b[z]=g.CreateTPolyLine(8016,!0)),C=F.fLastPoint,
C<F.fN-2&&(F.fX[C+1]=Math.round(l[w-1]),F.fY[C+1]=Math.round(e[w-1]),F.fX[C+2]=Math.round(l[w]),F.fY[C+2]=Math.round(e[w]),F.fLastPoint=C+2,n=Math.max(n,F.fLastPoint+1)))}}a=new Int32Array(c.length);for(z=u=0;z<c.length;z++)if(0<=c[z]){u=z;break}w=0;for(z=u-1;0<=z;z--)a[w]=z,w++;for(z=u;z<c.length;z++)a[w]=z,w++;m=new Float32Array(2*n);q=new Float32Array(2*n);for(w=0;w<c.length;++w)if(z=a[w],F=b[z])for(D=z,r=F.fX,t=F.fY,C=F.fLastPoint+1,B=0;;){p=n;y=p+1;m[p]=r[B];q[p]=t[B];m[y]=r[B+1];q[y]=t[B+1];
r[B]=r[B+1]=0;for(t[B]=t[B+1]=0;;){B=0;for(u=2;u<C;u+=2)y<2*n-1&&r[u]===m[y]&&t[u]===q[y]&&(y++,m[y]=r[u+1],q[y]=t[u+1],r[u]=r[u+1]=0,t[u]=t[u+1]=0,B++),0<p&&r[u+1]===m[p]&&t[u+1]===q[p]&&(p--,m[p]=r[u],q[p]=t[u],r[u]=r[u+1]=0,t[u]=t[u+1]=0,B++);if(0==B)break}p+1<y&&0<=p&&d(D,m,q,p,y,z);B=0;for(u=2;u<C;u+=2)if(0!==r[u]&&0!==t[u]){B=u;break}if(0===B)break}};v.prototype.DrawBinsContour=function(a,c){function b(a,b,c,d){var e="",f=null,k;for(k=c;k<=d;++k){c=null;switch(l.options.Proj){case 1:c=h.ProjectAitoff2xy(a[k],
b[k]);break;case 2:c=h.ProjectMercator2xy(a[k],b[k]);break;case 3:c=h.ProjectSinusoidal2xy(a[k],b[k]);break;case 4:c=h.ProjectParabolic2xy(a[k],b[k])}c?(c.x=h.grx(c.x),c.y=h.gry(c.y)):c={x:a[k],y:b[k]};c.x=Math.round(c.x);c.y=Math.round(c.y);e?c.x!=f.x&&c.y!=f.y?e+="l"+(c.x-f.x)+","+(c.y-f.y):c.x!=f.x?e+="h"+(c.x-f.x):c.y!=f.y&&(e+="v"+(c.y-f.y)):e="M"+c.x+","+c.y;f=c}return e}var d=this.PrepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),h=this.frame_painter(),f=h.GetPalette(),m=f.GetContour(),
l=this;if(14===this.options.Contour){a="M0,0h"+a+"v"+c+"h-"+a;if(this.options.Proj){a=d.stepj;c=parseInt((d.j2-d.j1)/a);for(var e=new Float32Array(2*c),x=new Float32Array(2*c),k=0;k<c;++k)e[k]=d.origx[d.i1],x[k]=(d.origy[d.j1]*(k*a+.5)+d.origy[d.j2]*(c-.5-k*a))/c,e[k+c]=d.origx[d.i2],x[k+c]=(d.origy[d.j2]*(k*a+.5)+d.origy[d.j1]*(c-.5-k*a))/c;a=b(e,x,0,2*c-1)}this.draw_g.append("svg:path").attr("d",a+"z").style("stroke","none").style("fill",f.getColor(0))}this.BuildContour(d,m,f,function(a,c,d,e,h){var k=
f.getColor(a),m=k,n=null;switch(l.options.Contour){case 11:m="none";n=new g.TAttLineHandler({color:k});break;case 12:m="none";n=new g.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:m="none",n=l.lineatt}a=l.draw_g.append("svg:path").attr("class","th2_contour").attr("d",b(c,d,e,h)+("none"==m?"":"z")).style("fill",m);null!==n?a.call(n.func):a.style("stroke","none")});d.hide_only_zeros=!0;return d};v.prototype.CreatePolyBin=function(a,c,b){function d(a,b,d,e){var f=Math.sqrt((a-d)*(a-d)+
(b-e)*(b-e));c._sumx+=(a+d)*f/2;c._sumy+=(b+e)*f/2;c._suml+=f}var h="",f,m=1,l=null;"TMultiGraph"==c.fPoly._typename?m=c.fPoly.fGraphs.arr.length:l=c.fPoly;b&&(c._sumx=c._sumy=c._suml=0);for(f=0;f<m;++f){if(!l||0<f)l=c.fPoly.fGraphs.arr[f];var e=l.fNpoints,g,k=l.fX,n=l.fY,q=Math.round(a.grx(k[0])),p=Math.round(a.gry(n[0]));2<e&&k[0]==k[e-1]&&n[0]==n[e-1]&&e--;h+="M"+q+","+p;for(g=1;g<e;++g){var r=Math.round(a.grx(k[g]));var t=Math.round(a.gry(n[g]));b&&d(q,p,r,t);if(q!==r||p!==t)h=q===r?h+("v"+(t-
p)):p===t?h+("h"+(r-q)):h+("l"+(r-q)+","+(t-p));q=r;p=t}b&&d(q,p,Math.round(a.grx(k[0])),Math.round(a.gry(n[0])));h+="z"}b&&(0<c._suml?(c._midx=Math.round(c._sumx/c._suml),c._midy=Math.round(c._sumy/c._suml)):(c._midx=Math.round(a.grx((c.fXmin+c.fXmax)/2)),c._midy=Math.round(a.gry((c.fYmin+c.fYmax)/2))));return h};v.prototype.DrawPolyBinsColor=function(a,c){var b=this.GetHisto(),d=this.frame_painter(),h=[];a=[];var f,m=b.fBins.arr.length,l=d.GetPalette();this.maxbin=this.gmaxbin;this.minbin=this.gminbin;
this.minposbin=this.gminposbin;this.CreateContour(d,l);for(f=0;f<m;++f){c=b.fBins.arr[f];var e=l.getContourIndex(c.fContent);if(null!==e){if(0===c.fContent){if(!this.options.Zero||!this.options.Line)continue;e=0}if(!(c.fXmin>d.scale_xmax||c.fXmax<d.scale_xmin||c.fYmin>d.scale_ymax||c.fYmax<d.scale_ymin)){var x=this.CreatePolyBin(d,c,this.options.Text&&c.fContent);h[e]=void 0===h[e]?x:h[e]+x;this.options.Text&&a.push(c)}}}for(e=0;e<h.length;++e)h[e]&&(c=this.draw_g.append("svg:path").attr("palette-index",
e).attr("fill",e?l.getColor(e):"none").attr("d",h[e]),this.options.Line&&c.call(this.lineatt.func));if(0<a.length){h=this.v7EvalColor("text_color","black");e=-1*this.v7EvalAttr("text_angle",0);c=this.v7EvalAttr("text_size",12);l=this.draw_g.append("svg:g").attr("class","th2poly_text");this.StartTextDrawing(42,c,l,c);for(f=0;f<a.length;++f)c=a[f],b="",this.options.TextKind?(c.fPoly&&(b=c.fPoly.fName),"Graph"===b&&(b=""),b||(b=c.fNumber)):b=Math.round(c.fContent)===c.fContent?c.fContent.toString():
g.FFormat(c.fContent,g.gStyle.fPaintTextFormat),this.DrawText({align:22,x:c._midx,y:c._midy,rotate:e,text:b,color:h,latex:0,draw_g:l});this.FinishTextDrawing(l,null)}return{poly:!0}};v.prototype.DrawBinsText=function(a,c,b){a=this.GetHisto();var d;null===b&&(b=this.PrepareDraw({rounding:!1}));c=this.v7EvalColor("text_color","black");var h=-1*this.v7EvalAttr("text_angle",0);var f=this.v7EvalAttr("text_size",20);var m=0,l=this.draw_g.append("svg:g").attr("class","th2_text"),e=b.stepi,x=b.stepj,k="E"==
this.options.TextKind&&this.MatchObjectType("TProfile2D")&&"function"==typeof a.getBinEntries;this.options.BarOffset&&(m=this.options.BarOffset);this.StartTextDrawing(42,f,l,f);for(f=b.i1;f<b.i2;f+=e)for(d=b.j1;d<b.j2;d+=x){var n=a.getBinContent(f+1,d+1);if(0!==n||this._show_empty_bins){var q=b.grx[f+e]-b.grx[f];var p=b.gry[d]-b.gry[d+x];k&&(n=a.getBinEntries(f+1,d+1));n=n===Math.round(n)?n.toString():g.FFormat(n,g.gStyle.fPaintTextFormat);if(h){var r=Math.round(b.grx[f]+.5*q);var t=Math.round(b.gry[d+
x]+p*(.5+m));p=q=0}else r=Math.round(b.grx[f]+.1*q),t=Math.round(b.gry[d+x]+p*(.1+m)),q=Math.round(.8*q),p=Math.round(.8*p);this.DrawText({align:22,x:r,y:t,width:q,height:p,rotate:h,text:n,color:c,latex:0,draw_g:l})}}this.FinishTextDrawing(l,null);b.hide_only_zeros=!0;return b};v.prototype.DrawBinsArrow=function(a,c){a=this.GetHisto();c="";var b,d,h,f=1E-30,m=this.PrepareDraw({rounding:!1}),l=(m.grx[m.i2]-m.grx[m.i1])/(m.i2-m.i1+1-.03)/2,e=(m.gry[m.j2]-m.gry[m.j1])/(m.j2-m.j1+1-.03)/2,g=m.stepi,k=
m.stepj;for(h=0;2>h;++h)for(b=m.i1;b<m.i2;b+=g)for(d=m.j1;d<m.j2;d+=k){var n=b===m.i1?a.getBinContent(b+1+g,d+1)-a.getBinContent(b+1,d+1):b>=m.i2-g?a.getBinContent(b+1,d+1)-a.getBinContent(b+1-g,d+1):.5*(a.getBinContent(b+1+g,d+1)-a.getBinContent(b+1-g,d+1));var q=d===m.j1?a.getBinContent(b+1,d+1+k)-a.getBinContent(b+1,d+1):d>=m.j2-k?a.getBinContent(b+1,d+1)-a.getBinContent(b+1,d+1-k):.5*(a.getBinContent(b+1,d+1+k)-a.getBinContent(b+1,d+1-k));if(0===h)f=Math.max(f,Math.abs(n),Math.abs(q));else{var p=
(m.grx[b]+m.grx[b+g])/2;var r=(m.gry[d]+m.gry[d+k])/2;var t=l*n/f;n=e*q/f;var u=p-t;q=p+t;p=r-n;r+=n;n=Math.round(q-u);q=Math.round(r-p);if(0!==n||0!==q)if(c+="M"+Math.round(u)+","+Math.round(p)+"l"+n+","+q,5<Math.abs(n)||5<Math.abs(q))r=Math.sqrt(2/(n*n+q*q)),u=Math.round(r*(n+q)),n=Math.round(r*(n-q)),0!==u&&0!==n&&(c+="l"+-u+","+n+"m"+u+","+-n+"l"+-n+","+-u)}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",c).style("fill","none").call(this.lineatt.func);return m};v.prototype.DrawBinsBox=
function(a,c){var b=this.GetHisto();a=this.PrepareDraw({rounding:!1});var d=this.frame_painter();d.maxbin===d.minbin&&(d.maxbin=this.gmaxbin,d.minbin=this.gminbin,d.minposbin=this.gminposbin);d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1));var h=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),f=Math.max(0,d.minbin),m="",l=c="",e="",g=!1,k=0,n=a.stepi,q=a.stepj;if(d.logz&&0<h){g=!0;h=Math.log(h);k=0<f?Math.log(f):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):
h-10;k>=h&&(k=h-10);var p=1/(h-k)}else p=1/(h-f);for(d=a.i1;d<a.i2;d+=n)for(h=a.j1;h<a.j2;h+=q){var r=b.getBinContent(d+1,h+1);var t=Math.abs(r);if(!(0===t||t<f)){var u=g?0<t?Math.log(t)-k:0:t-f;u=.5*(0>u?1:1-Math.sqrt(u*p));0>u&&(u=0);t=a.grx[d+n]-a.grx[d];var v=a.gry[h]-a.gry[h+q];var w=u*t;var A=u*v;u=Math.round(a.grx[d]+w);var y=Math.round(a.gry[h+q]+A);t=Math.max(Math.round(t-2*w),1);v=Math.max(Math.round(v-2*A),1);m+="M"+u+","+y+"v"+v+"h"+t+"v-"+v+"z";0>r&&10===this.options.BoxStyle&&(c+="M"+
u+","+y+"l"+t+","+v+"M"+(u+t)+","+y+"l-"+t+","+v);if(11===this.options.BoxStyle&&5<t&&5<v){A=Math.round(.1*t);var B=Math.round(.1*v);w="M"+u+","+y+"h"+t+"l"+-A+","+B+"h"+(2*A-t)+"v"+(v-2*B)+"l"+-A+","+B+"z";t="M"+(u+t)+","+(y+v)+"v"+-v+"l"+-A+","+B+"v"+(v-2*B)+"h"+(2*A-t)+"l"+-A+","+B+"z";0>r?(e+=w,l+=t):(l+=w,e+=t)}}}console.log("LINE COLOR",this.lineatt.color,"FILL COLOR",this.fillatt.color);0<m.length&&(b=this.draw_g.append("svg:path").attr("d",m).call(this.fillatt.func),11!==this.options.BoxStyle&&
this.fillatt.empty()?b.call(this.lineatt.func):b.style("stroke","none"));0<l.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",l).style("stroke","none").call(this.fillatt.func).style("fill",E.rgb(this.fillatt.color).brighter(.5).toString());0<e.length&&this.draw_g.append("svg:path").attr("d",e).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":E.rgb(this.fillatt.color).darker(.5).toString());0<c.length&&(b=this.draw_g.append("svg:path").attr("d",
c).style("fill","none"),"none"!==this.lineatt.color?b.call(this.lineatt.func):b.style("stroke","black"));return a};v.prototype.DrawCandle=function(a,c){c=this.GetHisto();var b=this.GetAxis("y"),d=this.PrepareDraw(),h=this.frame_painter(),f,m,l,e,g="",k="";this.createv7AttMarker();this.markeratt.reset_pos();d.candle=[];for(f=d.i1;f<d.i2;++f){for(a=l=e=m=0;a<this.nbinsy;++a)e+=c.getBinContent(f+1,a+1);var n={bin:f,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var q=
c.getBinContent(f+1,a+1);var p=b.GetBinCoord(a+.5);.001>l/e&&.001<=(l+q)/e&&(n.whiskerm=p);.25>l/e&&.25<=(l+q)/e&&(n.m25y=p);.5>l/e&&.5<=(l+q)/e&&(n.median=p);.75>l/e&&.75<=(l+q)/e&&(n.p25y=p);.999>l/e&&.999<=(l+q)/e&&(n.whiskerp=p);l+=q;m+=q*p}0<l&&(n.meany=m/l);n.iqr=n.p25y-n.m25y;n.m25y-1.5*n.iqr>n.whsikerm&&(n.whiskerm=n.m25y-1.5*n.iqr);n.p25y+1.5*n.iqr<n.whiskerp&&(n.whiskerp=n.p25y+1.5*n.iqr);if(!(h.logy&&0>=n.whiskerm)){a=d.grx[f+1]-d.grx[f];a*=.66;m=(d.grx[f+1]+d.grx[f])/2+this.options.BarOffset*
a;0<this.options.BarWidth&&(a*=this.options.BarWidth);n.x1=Math.round(m-a/2);n.x2=Math.round(m+a/2);m=Math.round(m);n.y0=Math.round(h.gry(n.median));g+="M"+n.x1+","+n.y0+"h"+(n.x2-n.x1);n.y1=Math.round(h.gry(n.p25y));n.y2=Math.round(h.gry(n.m25y));g+="M"+n.x1+","+n.y1+"v"+(n.y2-n.y1)+"h"+(n.x2-n.x1)+"v-"+(n.y2-n.y1)+"z";n.yy1=Math.round(h.gry(n.whiskerp));n.yy2=Math.round(h.gry(n.whiskerm));g+="M"+m+","+n.y1+"v"+(n.yy1-n.y1);g+="M"+n.x1+","+n.yy1+"h"+(n.x2-n.x1);g+="M"+m+","+n.y2+"v"+(n.yy2-n.y2);
g+="M"+n.x1+","+n.yy2+"h"+(n.x2-n.x1);for(a=0;a<this.nbinsy;++a)q=c.getBinContent(f+1,a+1),p=b.GetBinCoord(a+.5),0<q&&p<n.whiskerm&&(k+=this.markeratt.create(m,p)),0<q&&p>n.whiskerp&&(k+=this.markeratt.create(m,p));d.candle.push(n)}}0<g.length&&this.draw_g.append("svg:path").attr("d",g).call(this.lineatt.func).call(this.fillatt.func);0<k.length&&this.draw_g.append("svg:path").attr("d",k).call(this.markeratt.func);return d};v.prototype.DrawBinsScatter=function(a,c){var b=this.GetHisto();this.frame_painter();
a=this.PrepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0});c=[];var d=[],h=[],f=[],m=[],l,e,p=1;var k=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);var n=a.stepi,q=a.stepj;g.seed(a.sumz);if(1E5>k*a.sumz){this.createv7AttMarker();this.markeratt.reset_pos();d="";for(l=a.i1;l<a.i2;l+=n){var v=a.grx[l+n]-a.grx[l];for(e=a.j1;e<a.j2;e+=q){var r=a.gry[e]-a.gry[e+q];var t=b.getBinContent(l+1,e+1);h=Math.round(k*t);if(!(0>=h))for(c=0;c<h;++c)d+=this.markeratt.create(Math.round(a.grx[l]+
v*g.random()),Math.round(a.gry[e+1]+r*g.random()))}}this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func);return a}.7<this.maxbin&&(p=.7/this.maxbin);for(l=a.i1;l<a.i2;l+=n)for(e=a.j1;e<a.j2;e+=q)if(t=b.getBinContent(l+1,e+1),!(0>=t||t<this.minbin||(v=a.grx[l+n]-a.grx[l],r=a.gry[e]-a.gry[e+q],0>=v*r||(k=a.palette.getContourIndex(t/v/r),0>k)))){t="M"+a.grx[l]+","+a.gry[e+q];if(void 0===c[k])c[k]=t,f[k]=v,m[k]=r;else{var u="m"+(a.grx[l]-d[k])+","+(a.gry[e+q]-h[k]);c[k]+=u.length<t.length?
u:t;f[k]=Math.max(f[k],v);m[k]=Math.max(m[k],r)}d[k]=a.grx[l];h[k]=a.gry[e+q];c[k]+="v"+r+"h"+v+"v-"+r+"z"}k=this.svg_frame().select(".main_layer");b=k.select("defs");b.empty()&&0<c.length&&(b=k.insert("svg:defs",":first-child"));this.createv7AttMarker();l=a.palette.GetContour();for(k=0;k<c.length;++k)if(void 0!==c[k]&&k<l.length){d="scatter_"+k;e=b.select("."+d);e.empty()?e=b.append("svg:pattern").attr("class",d).attr("id","jsroot_scatter_pattern_"+g.id_counter++).attr("patternUnits","userSpaceOnUse"):
e.selectAll("*").remove();h=Math.round(p*l[k]*f[k]*m[k]);1>h&&(h=1);v=new Float32Array(h);r=new Float32Array(h);if(1===h)v[0]=r[0]=.5;else for(n=0;n<h;++n)v[n]=g.random(),r[n]=g.random();this.markeratt.reset_pos();d="";for(n=0;n<h;++n)d+=this.markeratt.create(v[n]*f[k],r[n]*m[k]);e.attr("width",f[k]).attr("height",m[k]).append("svg:path").attr("d",d).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",k).attr("fill","url(#"+e.attr("id")+")").attr("d",c[k])}return a};v.prototype.DrawBins=
function(){if(!this.draw_content)return this.RemoveDrawG();this.CheckHistDrawAttributes();this.CreateG(!0);var a=this.frame_width(),c=this.frame_height(),b=null;this.IsTH2Poly()?b=this.DrawPolyBinsColor(a,c):(this.options.Scat?b=this.DrawBinsScatter(a,c):this.options.Color?b=this.DrawBinsColor(a,c):this.options.Box?b=this.DrawBinsBox(a,c):this.options.Arrow?b=this.DrawBinsArrow(a,c):0<this.options.Contour?b=this.DrawBinsContour(a,c):this.options.Candle&&(b=this.DrawCandle(a,c)),this.options.Text&&
(b=this.DrawBinsText(a,c,b)),b||(b=this.DrawBinsColor(a,c)));this.tt_handle=b};v.prototype.GetBinTips=function(a,c){var b=[],d=this.frame_painter(),h=this.GetAxis("y"),f=this.GetAxis("y"),m=this.GetHisto(),l=m.getBinContent(a+1,c+1),e=1,p=1;this.IsDisplayItem()&&(e=m.stepx||1,p=m.stepy||1);b.push(this.GetTipName()||"histo<2>");"labels"==d.x_kind?b.push("x = "+d.AxisAsText("x",h.GetBinCoord(a))):b.push("x = ["+d.AxisAsText("x",h.GetBinCoord(a))+", "+d.AxisAsText("x",h.GetBinCoord(a+e))+")");"labels"==
d.y_kind?b.push("y = "+d.AxisAsText("y",f.GetBinCoord(c))):b.push("y = ["+d.AxisAsText("y",f.GetBinCoord(c))+", "+d.AxisAsText("y",f.GetBinCoord(c+p))+")");b.push("bin = "+a+", "+c);m.$baseh&&(l-=m.$baseh.getBinContent(a+1,c+1));a="entries = "+(1<e||1<p?"~":"");l===Math.round(l)?b.push(a+l):b.push(a+g.FFormat(l,g.gStyle.fStatFormat));return b};v.prototype.GetCandleTips=function(a){var c=[],b=this.frame_painter(),d=this.GetAxis("y");c.push(this.GetTipName()||"histo");c.push("x = "+b.AxisAsText("x",
d.GetBinCoord(a.bin)));c.push("mean y = "+g.FFormat(a.meany,g.gStyle.fStatFormat));c.push("m25 = "+g.FFormat(a.m25y,g.gStyle.fStatFormat));c.push("p25 = "+g.FFormat(a.p25y,g.gStyle.fStatFormat));return c};v.prototype.ProvidePolyBinHints=function(a,c,b){a=this.GetHisto().fBins.arr[a];var d=this.frame_painter(),h=a.fPoly.fName,f=[],m=0;"Graph"===h&&(h="");0===h.length&&(h=a.fNumber);if(void 0===c&&void 0===b){c=b=0;var l=a.fPoly,e=1;"TMultiGraph"===l._typename&&(e=a.fPoly.fGraphs.arr.length,l=null);
for(var p=0;p<e;++p){if(!l||0<p)l=a.fPoly.fGraphs.arr[p];for(var k=0;k<l.fNpoints;++k)++m,c+=l.fX[k],b+=l.fY[k]}1<m&&(c/=m,b/=m)}f.push(this.GetTipName()||"histo");f.push("x = "+d.AxisAsText("x",c));f.push("y = "+d.AxisAsText("y",b));0<m&&f.push("npnts = "+m);f.push("bin = "+h);a.fContent===Math.round(a.fContent)?f.push("content = "+a.fContent):f.push("content = "+g.FFormat(a.fContent,g.gStyle.fStatFormat));return f};v.prototype.ProcessTooltip=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||
this.options.Proj)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.GetHisto(),b=this.tt_handle,d,h=this.draw_g.select(".tooltip_bin");if(b.poly){b=this.frame_painter();var f,m,l=-1;b.grx===b.x&&(f=b.x.invert(a.x));b.gry===b.y&&(m=b.y.invert(a.y));if(void 0!==f&&void 0!==m){var e=c.fBins.arr.length;for(d=0;d<e&&0>l;++d){var g=c.fBins.arr[d];if(!(f<g.fXmin||f>g.fXmax||m<g.fYmin||m>g.fYmax||0===g.fContent&&!this.options.Zero)){var k=g.fPoly,n=1;"TMultiGraph"===k._typename&&
(n=g.fPoly.fGraphs.arr.length,k=null);for(var p=0;p<n;++p){if(!k||0<p)k=g.fPoly.fGraphs.arr[p];if(k.IsInside(f,m)){l=d;break}}}}}if(0>l)return h.remove(),null;f={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:!0,menu:!0,lines:this.ProvidePolyBinHints(l,f,m)};a.disabled?(h.remove(),f.changed=!0):(h.empty()&&(h=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events",
"none")),f.changed=h.property("current_bin")!==l,f.changed&&h.attr("d",this.CreatePolyBin(b,g)).style("opacity","0.7").property("current_bin",l));f.changed&&(f.user_info={obj:c,name:"histo",bin:l,cont:g.fContent,grx:a.x,gry:a.y});return f}if(b.candle){for(d=0;d<b.candle.length&&!(l=b.candle[d],l.x1<=a.x&&a.x<=l.x2&&l.yy1<=a.y&&a.y<=l.yy2);++d);if(d>=b.candle.length)return h.remove(),null;f={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?
this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(l),exact:!0,menu:!0};a.disabled?(h.remove(),f.changed=!0):(h.empty()&&(h=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),f.changed=h.property("current_bin")!==d,f.changed&&h.attr("x",l.x1).attr("width",l.x2-l.x1).attr("y",l.yy1).attr("height",l.yy2-l.yy1).style("opacity","0.7").property("current_bin",d));f.changed&&(f.user_info={obj:c,name:"histo",bin:d+1,cont:l.median,binx:d+1,biny:1,
grx:a.x,gry:a.y});return f}m=0;l=null;for(d=b.i1;d<b.i2&&!(a.x>=b.grx[d]&&a.x<=b.grx[d+1]);++d);for(g=b.j1;g<b.j2&&!(a.y>=b.gry[g+1]&&a.y<=b.gry[g]);++g);d<b.i2&&g<b.j2&&(m=c.getBinContent(d+1,g+1),this.is_projection?l=0:b.hide_only_zeros?l=0!==m||this._show_empty_bins?0:null:(l=b.palette.getContourIndex(m),null===l&&0===m&&this._show_empty_bins&&(l=0)));if(null===l)return h.remove(),null;f={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?
this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(d,g),exact:!0,menu:!0};this.options.Color&&(f.color2=b.palette.getColor(l));if(a.disabled&&!this.is_projection)h.remove(),f.changed=!0;else{h.empty()&&(h=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));l=d;e=d+1;k=g;n=g+1;p=b.grx[l];var v=b.grx[e],r=b.gry[n],t=b.gry[k],u=1E4*d+g;"X"==this.is_projection?(p=0,v=this.frame_width(),1<this.projection_width&&(u=(this.projection_width-1)/2,n+u>=
b.j2?(n=Math.min(Math.round(n+u),b.j2),k=Math.max(n-this.projection_width,b.j1)):(k=Math.max(Math.round(k-u),b.j1),n=Math.min(k+this.projection_width,b.j2))),r=b.gry[n],t=b.gry[k],u=777*k+333*n):"Y"==this.is_projection&&(r=0,t=this.frame_height(),1<this.projection_width&&(u=(this.projection_width-1)/2,e+u>=b.i2?(e=Math.min(Math.round(e+u),b.i2),l=Math.max(e-this.projection_width,b.i1)):(l=Math.max(Math.round(l-u),b.i1),e=Math.min(l+this.projection_width,b.i2))),p=b.grx[l],v=b.grx[e],u=777*l+333*e);
f.changed=h.property("current_bin")!==u;f.changed&&h.attr("x",p).attr("width",v-p).attr("y",r).attr("height",t-r).style("opacity","0.7").property("current_bin",u);this.is_projection&&f.changed&&this.RedrawProjection(l,e,k,n)}f.changed&&(f.user_info={obj:c,name:"histo",bin:c.getBin(d+1,g+1),cont:m,binx:d+1,biny:g+1,grx:a.x,gry:a.y});return f};v.prototype.CanZoomIn=function(a,c,b){if("z"==a)return!0;a=this.GetAxis(a);return 1<a.FindBin(b,.5)-a.FindBin(c,0)};v.prototype.Draw2D=function(a,c){this.mode3d=
!1;this.Clear3DScene();if(!this.DrawAxes())return g.CallBack(a);this.DrawingBins(a,c,function(){this.DrawBins();this.UpdateStatWebCanvas();this.AddInteractive()})};v.prototype.Draw3D=function(a,c){this.mode3d=!0;g.AssertPrerequisites("v7hist3d",function(){this.Draw3D(a,c)}.bind(this))};v.prototype.CallDrawFunc=function(a,c){var b=this.frame_painter();b&&b.mode3d!==this.options.Mode3D&&!this.is_main_painter()&&(this.options.Mode3D=b.mode3d);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,c)};v.prototype.Redraw=
function(a){this.CallDrawFunc(null,a)};M.prototype=Object.create(p.prototype);M.prototype.Dimension=function(){return 3};F.prototype=Object.create(g.v7.RPavePainter.prototype);F.prototype.ClearStat=function(){this.stats_lines=[]};F.prototype.AddText=function(a){this.stats_lines.push(a)};F.prototype.UpdateStatistic=function(a){this.stats_lines=a.lines;this.DrawStatistic(this.stats_lines)};F.prototype.FillStatistic=function(){var a=this.pad_painter();if(a&&a._fast_drawing)return!1;a=this.GetObject();
return void 0!==a.fLines?(this.stats_lines=a.fLines,delete a.fLines,!0):this.v7CommMode()==g.v7.CommMode.kOffline?(a=this.main_painter())&&"function"===typeof a.FillStatistic?a.FillStatistic(this,g.gStyle.fOptStat,g.gStyle.fOptFit):!1:void 0!==this.stats_lines};F.prototype.Format=function(a,c){c||(c="stat");switch(c){case "stat":c=g.gStyle.fStatFormat;break;case "fit":c=g.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);c="14.7g";break;case "last":c=
this.lastformat}delete this.lastformat;a=g.FFormat(a,c||"6.4g");this.lastformat=g.lastFFormat;return a};F.prototype.DrawContent=function(){this.FillStatistic()&&this.DrawStatistic(this.stats_lines)};F.prototype.ChangeMask=function(a){var c=this.GetObject();a=1<<a;c.fShowMask=c.fShowMask&a?c.fShowMask&~a:c.fShowMask|a;this.FillStatistic()&&this.DrawStatistic(this.stats_lines)};F.prototype.ShowContextMenu=function(){E.event.preventDefault();E.event.stopPropagation();g.Painter.createMenu(this,function(a){var c=
a.painter.GetObject(),b=a.painter.ChangeMask.bind(a.painter);a.add("header: StatBox");for(var d=0;d<c.fEntries.length;++d)a.addchk(c.fShowMask&1<<d,c.fEntries[d],d,b);a.painter.FillObjectExecMenu(a,"",function(){a.show()})},E.event)};F.prototype.DrawStatistic=function(a){this.v7EvalAttr("stats_text_size",12);var c=this.v7EvalColor("stats_text_color","black"),b=this.v7EvalAttr("stats_text_align",22),d=this.v7EvalAttr("stats_text_font",41),h=0,f=0,g=0,l=this.pave_width,e=this.pave_height;if(a){for(var p=
a.length,k=0;k<p;++k){var n=a[k];0<k&&(g=Math.max(g,n.length));if(!(0==k||0>n.indexOf("|"))){0===h&&(h=k);var q=n.split("|");q.length>f&&(f=q.length)}}n=e/p;var v=!1,r=.02*l,t=this.draw_g.select(".statlines");t.empty()?t=this.draw_g.append("svg:g").attr("class","statlines"):t.selectAll("*").remove();this.StartTextDrawing(d,e/(1.2*p),t);if(1==p)this.DrawText({align:b,width:l,height:e,text:a[0],color:c,latex:1,draw_g:t});else for(k=0;k<p;++k)if(b=k*n,h&&k>=h)for(q=a[k].split("|"),d=0;d<q.length;++d)this.DrawText({align:"middle",
x:l*d/f,y:b,latex:0,width:l/f,height:n,text:q[d],color:c,draw_g:t});else if(0>a[k].indexOf("="))0==k&&(v=!0,a[k].length>g+5&&(a[k]=a[k].substr(0,g+2)+"...")),this.DrawText({align:0==k?"middle":"start",x:r,y:b,width:l-2*r,height:n,text:a[k],color:c,draw_g:t});else{q=a[k].split("=");var u=0;for(d=0;2>d;++d)u+=this.DrawText({align:0==d?"start":"end",x:r,y:b,width:l-2*r,height:n,text:q[d],color:c,draw_g:t});this.TextScaleFactor(1.05*u/(l-2*r),t)}this.FinishTextDrawing(t);a="";v&&(a+="M0,"+Math.round(n)+
"h"+l);if(0<h&&1<f){for(c=h;c<p;++c)a+="M0,"+Math.round(c*n)+"h"+l;for(p=0;p<f-1;++p)a+="M"+Math.round(l/f*(p+1))+","+Math.round(h*n)+"V"+e}a&&this.draw_g.append("svg:path").attr("d",a)}};F.prototype.Redraw=function(a){a&&"string"==typeof a&&0==a.indexOf("zoom")&&this.v7CommMode()==g.v7.CommMode.kNormal&&(a={_typename:"ROOT::Experimental::RHistStatBoxBase::RRequest",mask:this.GetObject().fShowMask},this.v7SubmitRequest("stat",a,this.UpdateStatistic.bind(this)));this.DrawPave()};g.v7.RHistPainter=
p;g.v7.RH1Painter=A;g.v7.RH2Painter=v;g.v7.RH3Painter=M;g.v7.drawHist1=H;g.v7.drawHist2=ba;g.v7.drawHist3=ca;g.v7.drawHistDisplayItem=function(a,c,b){return c?1==c.fAxes.length?H(a,c,b):2==c.fAxes.length?ba(a,c,b):3==c.fAxes.length?ca(a,c,b):null:null};g.v7.drawHistStats=function(a,c,b){c=new F(c,b);c.SetDivId(a);c.DrawPave();return c.DrawingReady()};return g});
