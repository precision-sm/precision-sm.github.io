var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,g,v){l!=Array.prototype&&l!=Object.prototype&&(l[g]=v.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(l,g,v,m){if(g){v=$jscomp.global;l=l.split(".");for(m=0;m<l.length-1;m++){var p=l[m];p in v||(v[p]={});v=v[p]}l=l[l.length-1];m=v[l];g=g(m);g!=m&&null!=g&&$jscomp.defineProperty(v,l,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Number.isFinite",function(l){return l?l:function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g}},"es6","es3");
$jscomp.polyfill("Math.log10",function(l){return l?l:function(g){return Math.log(g)/Math.LN10}},"es6","es3");$jscomp.arrayIteratorImpl=function(l){var g=0;return function(){return g<l.length?{done:!1,value:l[g++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var g="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return g?g.call(l):$jscomp.arrayIterator(l)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function g(){this.batch_=null}function v(u){return u instanceof p?u:new p(function(g,l){g(u)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;g.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var u=this;this.asyncExecuteFunction(function(){u.executeBatch_()})}this.batch_.push(g)};var m=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(g){m(g,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=
this.batch_;this.batch_=[];for(var l=0;l<g.length;++l){var m=g[l];g[l]=null;try{m()}catch(y){this.asyncThrow_(y)}}}this.batch_=null};g.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var p=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var u=this.createResolveAndReject_();try{g(u.resolve,u.reject)}catch(B){u.reject(B)}};p.prototype.createResolveAndReject_=function(){function g(g){return function(u){m||(m=!0,g.call(l,u))}}var l=this,m=!1;
return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};p.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof p)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var l=null!=g;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(g):this.fulfill_(g)}};p.prototype.resolveToNonPromiseObj_=function(g){var l=void 0;try{l=g.then}catch(B){this.reject_(B);return}"function"==typeof l?
this.settleSameAsThenable_(l,g):this.fulfill_(g)};p.prototype.reject_=function(g){this.settle_(2,g)};p.prototype.fulfill_=function(g){this.settle_(1,g)};p.prototype.settle_=function(g,l){if(0!=this.state_)throw Error("Cannot settle("+g+", "+l+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=l;this.executeOnSettledCallbacks_()};p.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)x.asyncExecute(this.onSettledCallbacks_[g]);
this.onSettledCallbacks_=null}};var x=new g;p.prototype.settleSameAsPromise_=function(g){var l=this.createResolveAndReject_();g.callWhenSettled_(l.resolve,l.reject)};p.prototype.settleSameAsThenable_=function(g,l){var m=this.createResolveAndReject_();try{g.call(l,m.resolve,m.reject)}catch(y){m.reject(y)}};p.prototype.then=function(g,l){function m(a,b){return"function"==typeof a?function(b){try{u(a(b))}catch(d){v(d)}}:b}var u,v,C=new p(function(a,b){u=a;v=b});this.callWhenSettled_(m(g,u),m(l,v));return C};
p.prototype.catch=function(g){return this.then(void 0,g)};p.prototype.callWhenSettled_=function(g,l){function m(){switch(p.state_){case 1:g(p.result_);break;case 2:l(p.result_);break;default:throw Error("Unexpected state: "+p.state_);}}var p=this;null==this.onSettledCallbacks_?x.asyncExecute(m):this.onSettledCallbacks_.push(m)};p.resolve=v;p.reject=function(g){return new p(function(l,m){m(g)})};p.race=function(g){return new p(function(l,m){for(var p=$jscomp.makeIterator(g),u=p.next();!u.done;u=p.next())v(u.value).callWhenSettled_(l,
m)})};p.all=function(g){var l=$jscomp.makeIterator(g),m=l.next();return m.done?v([]):new p(function(g,p){function u(c){return function(d){a[c]=d;b--;0==b&&g(a)}}var a=[],b=0;do a.push(void 0),b++,v(m.value).callWhenSettled_(u(a.length-1),p),m=l.next();while(!m.done)})};return p},"es6","es3");
JSROOT.define(["d3","painter","math","gpad"],function(l,g){function v(a,b){JSROOT.ObjectPainter.call(this,a,b);this.bins=null}function m(a,b){JSROOT.ObjectPainter.call(this,a,b);this.axes_draw=!1;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=!0;this.is_bent="TGraphBentErrors"==b._typename;this.has_errors="TGraphErrors"==b._typename||"TGraphAsymmErrors"==b._typename||this.is_bent||b._typename.match(/^RooHist/)}function p(a,b){JSROOT.ObjectPainter.call(this,a,b);this.$polargram=
!0;this.zoom_rmin=this.zoom_rmax=0}function x(a,b){JSROOT.ObjectPainter.call(this,a,b)}function u(a,b){JSROOT.ObjectPainter.call(this,a,b);this.bins=null}function C(a,b){JSROOT.ObjectPainter.call(this,a,b)}function B(a,b){JSROOT.ObjectPainter.call(this,a,b);this.fBoundary="Normal"}function y(a,b){JSROOT.ObjectPainter.call(this,a,b);this.firstpainter=null;this.autorange=!1;this.painters=[]}function A(a,b,c){JSROOT.ObjectPainter.call(this,a,b,c);this.wheel_zoomy=!0}function E(a,b,c){JSROOT.ObjectPainter.call(this,
a,b,c)}v.prototype=Object.create(JSROOT.ObjectPainter.prototype);v.prototype.createBins=function(a){var b=this.getFramePainter(),c=0,d=0,e=this.getObject();b&&!a&&(b.zoom_xmin!==b.zoom_xmax?(c=b.zoom_xmin,d=b.zoom_xmax):(c=b.xmin,d=b.xmax));if(0<e.fSave.length&&!this.nosave){a=e.fSave.length-2;var k=e.fSave[a],f=e.fSave[a+1];b=e.$histo&&k===f;var h=0,t=0,g=[];b?(k=e.fSave[--a],h=e.$histo.fXaxis.FindBin(k,0)):t=(f-k)/(a-1);for(f=0;f<a;++f){var w=b?e.$histo.fXaxis.GetBinCenter(h+f+1):k+t*f;if(c===d||
!(w+2*t<c||w-2*t>d)){var z=e.fSave[f];Number.isFinite(z)&&g.push({x:w,y:z})}}return g}a=e.fXmin;h=e.fXmax;k=!1;c!==d&&(c>a&&(a=c),d<h&&(h=d));b&&b.logx&&0<a&&0<h&&(k=!0,a=Math.log(a),h=Math.log(h));c=Math.max(e.fNpx,101);d=(h-a)/(c-1);b=[];for(h=0;h<c;h++)t=a+h*d,k&&(t=Math.exp(t)),g=e.evalPar(t),Number.isFinite(g)&&b.push({x:t,y:g});return b};v.prototype.createDummyHisto=function(){var a=0,b=1,c=0,d=1,e=this.createBins(!0);e&&0<e.length&&(a=b=e[0].x,c=d=e[0].y,e.forEach(function(e){a=Math.min(e.x,
a);b=Math.max(e.x,b);c=Math.min(e.y,c);d=Math.max(e.y,d)}),0<d&&(d*=1.05),0>c&&(c*=1.05));e=JSROOT.create("TH1I");var k=this.getObject();e.fName=k.fName+"_hist";e.fTitle=k.fTitle;e.fXaxis.fXmin=a;e.fXaxis.fXmax=b;e.fYaxis.fXmin=c;e.fYaxis.fXmax=d;return e};v.prototype.processTooltipEvent=function(a){var b=!1;if(!a||null===this.bins||a.disabled)b=!0;else if(!this.bins.length||a.x<this.bins[0].grx||a.x>this.bins[this.bins.length-1].grx)b=!0;if(b)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),
null;for(var c=1E5,d=-1,e=0;e<this.bins.length;++e)b=this.bins[e],b=Math.abs(b.grx-a.x),b<c&&(c=b,d=e);b=this.bins[d];e=this.draw_g.select(".tooltip_bin");c=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",c).call(this.lineatt.func).call(this.fillatt.func));c={name:this.getObject().fName,title:this.getObject().fTitle,x:b.grx,y:b.gry,color1:this.lineatt.color,color2:this.fillatt.getFillColor(),lines:[],exact:Math.abs(b.grx-
a.x)<c&&Math.abs(b.gry-a.y)<c};c.changed=e.property("current_bin")!==d;c.menu=c.exact;c.menu_dist=Math.sqrt((b.grx-a.x)*(b.grx-a.x)+(b.gry-a.y)*(b.gry-a.y));c.changed&&e.attr("cx",b.grx).attr("cy",b.gry).property("current_bin",d);a=this.getObjectHint();0<a.length&&c.lines.push(a);(a=this.getFramePainter())&&c.lines.push("x = "+a.axisAsText("x",b.x)+" y = "+a.axisAsText("y",b.y));return c};v.prototype.redraw=function(){var a=this.getObject(),b=this.getFramePainter(),c=b.getFrameHeight(),d=this.getMainPainter();
this.createG(!0);this.bins=this.createBins(!1);this.createAttLine({attr:a});this.lineatt.used=!1;this.createAttFill({attr:a,kind:1});this.fillatt.used=!1;for(a=0;a<this.bins.length;++a){var e=this.bins[a];e.grx=b.grx(e.x);e.gry=b.gry(e.y)}2<this.bins.length&&(a=c,void 0!==d.hmin&&0<=d.hmin&&(a=Math.round(b.gry(0)),a>c||0>a)&&(a=c),b=g.buildSvgPath("bezier",this.bins,a,2),"none"!=this.lineatt.color&&this.draw_g.append("svg:path").attr("class","line").attr("d",b.path).style("fill","none").call(this.lineatt.func),
this.fillatt.empty()||this.draw_g.append("svg:path").attr("class","area").attr("d",b.path+b.close).style("stroke","none").call(this.fillatt.func))};v.prototype.canZoomInside=function(a,b,c){if("x"!==a)return!1;a=this.getObject();if(0<a.fSave.length){var d=a.fNpx;return Math.abs(a.fSave[d+1]-a.fSave[d+2])/d<Math.abs(b-c)}return!0};m.prototype=Object.create(JSROOT.ObjectPainter.prototype);m.prototype.redraw=function(){this.drawGraph()};m.prototype.cleanup=function(){delete this.interactive_bin;delete this.bins;
JSROOT.ObjectPainter.prototype.cleanup.call(this)};m.prototype.decodeOptions=function(a){"string"==typeof a&&0==a.indexOf("same ")&&(a=a.substr(5));var b=this.getObject(),c=new JSROOT.DrawOptions(a);this.options||(this.options={});JSROOT.extend(this.options,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,NoOpt:0,MainError:1,Ends:1,Axis:"",PadStats:!1,original:a});a=this.options;a.PadStats=c.check("USE_PAD_STATS");var d="";"USE_PAD_TITLE LOGXY LOGX LOGY LOGZ GRIDXY GRIDX GRIDY TICKXY TICKX TICKY".split(" ").forEach(function(a){c.check(a)&&
(d+=";"+a)});c.empty()&&(a.original=this.getMainPainter()?"lp":"alp",c=new JSROOT.DrawOptions(a.original));a._pfc=c.check("PFC");a._plc=c.check("PLC");a._pmc=c.check("PMC");c.check("NOOPT")&&(a.NoOpt=1);c.check("L")&&(a.Line=1);c.check("F")&&(a.Fill=1);c.check("A")&&(a.Axis=c.check("I")?"A":"AXIS");c.check("X+")&&(a.Axis+="X+");c.check("Y+")&&(a.Axis+="Y+");c.check("RX")&&(a.Axis+="RX");c.check("RY")&&(a.Axis+="RY");c.check("C")&&(a.Curve=a.Line=1);c.check("*")&&(a.Mark=103);c.check("P0")&&(a.Mark=
104);c.check("P")&&(a.Mark=1);c.check("B")&&(a.Bar=1,a.Errors=0);c.check("Z")&&(a.Errors=1,a.Ends=0);c.check("||")&&(a.Errors=1,a.MainError=0,a.Ends=1);c.check("[]")&&(a.Errors=1,a.MainError=0,a.Ends=2);c.check("|>")&&(a.Errors=1,a.Ends=3);c.check(">")&&(a.Errors=1,a.Ends=4);c.check("0")&&(a.Mark=1,a.Errors=1,a.OutRange=1);c.check("1")&&1==a.Bar&&(a.Bar=2);c.check("2")&&(a.Rect=1,a.Errors=0);c.check("3")&&(a.EF=1,a.Errors=0);c.check("4")&&(a.EF=2,a.Errors=0);c.check("5")&&(a.Rect=2,a.Errors=0);c.check("X")&&
(a.Errors=0);void 0===a.Errors&&(a.Errors=this.has_errors?1:0);1==a.Mark&&1==b.fMarkerStyle&&(a.Mark=101);0==a.Line+a.Fill+a.Mark+a.Bar+a.EF+a.Rect+a.Errors&&c.empty()&&(a.Line=1);"TGraphErrors"==b._typename&&1E-300>l.max(b.fEX)&&1E-300>l.max(b.fEY)&&(a.Errors=0);if(a.Axis)0>a.Axis.indexOf("A")&&(a.Axis="AXIS,"+a.Axis);else{var e=this.getPadPainter();e=e?e.getRootPad(!0):null;if(!e||e.fPrimitives&&e.fPrimitives.arr[0]===b)a.Axis="AXIS"}a.Axis+=d;a.HOptions=a.Axis};m.prototype.createBins=function(){var a=
this.getObject();if(a){var b=0,c=a.fNpoints;"TCutG"===a._typename&&3<c&&c--;if("TGraphErrors"==a._typename)b=1;else if("TGraphAsymmErrors"==a._typename||"TGraphBentErrors"==a._typename||a._typename.match(/^RooHist/))b=2;this.bins=Array(c);for(var d=0;d<c;++d){var e=this.bins[d]={x:a.fX[d],y:a.fY[d],indx:d};switch(b){case 1:e.exlow=e.exhigh=a.fEX[d];e.eylow=e.eyhigh=a.fEY[d];break;case 2:e.exlow=a.fEXlow[d],e.exhigh=a.fEXhigh[d],e.eylow=a.fEYlow[d],e.eyhigh=a.fEYhigh[d]}0===d&&(this.xmin=this.xmax=
e.x,this.ymin=this.ymax=e.y);0<b?(this.xmin=Math.min(this.xmin,e.x-e.exlow,e.x+e.exhigh),this.xmax=Math.max(this.xmax,e.x-e.exlow,e.x+e.exhigh),this.ymin=Math.min(this.ymin,e.y-e.eylow,e.y+e.eyhigh),this.ymax=Math.max(this.ymax,e.y-e.eylow,e.y+e.eyhigh)):(this.xmin=Math.min(this.xmin,e.x),this.xmax=Math.max(this.xmax,e.x),this.ymin=Math.min(this.ymin,e.y),this.ymax=Math.max(this.ymax,e.y))}}};m.prototype.createHistogram=function(a,b,c){var d=this.xmin,e=this.xmax,k=this.ymin,f=this.ymax;d>=e&&(e=
d+1);k>=f&&(f=k+1);var h=.1*(e-d),t=.1*(f-k),g=d-h;h=e+h;var w=k-t;f+=t;this.options.HOptions=this.options.Axis+";ymin:"+w+";ymax:"+f;if(a)return a;0>g&&0<=d&&(g=.9*d);0<h&&0>=e&&(h=0);d=this.getObject();-1111!=d.fMinimum&&(w=k=d.fMinimum);-1111!=d.fMaximum&&(f=d.fMaximum);0>w&&0<=k&&(w=.9*k);a=d.fHistogram;b||c||(b=c=!0);a||(a=d.fHistogram=JSROOT.createHistogram("TH1F",100),a.fName=d.fName+"_h",a.fTitle=d.fTitle,k=JSROOT.BIT(9),a.fBits|=k,this._own_histogram=!0);b&&(a.fXaxis.fXmin=g,a.fXaxis.fXmax=
h);c&&(a.fYaxis.fXmin=w,a.fYaxis.fXmax=f,a.fMinimum=w,a.fMaximum=f);return a};m.prototype.unzoomUserRange=function(a,b){var c=this.getObject();if(this._own_histogram||!c)return!1;c=c.fHistogram;a=a&&c&&(c.fXaxis.fXmin>this.xmin||c.fXaxis.fXmax<this.xmax);b=b&&c&&(c.fYaxis.fXmin>this.ymin||c.fYaxis.fXmax<this.ymax);if(!a&&!b)return!1;this.createHistogram(null,a,b);(a=this.getMainPainter())&&a.extractAxesProperties(1);return!0};m.prototype.canOptimize=function(){return 0<JSROOT.settings.OptimizeDraw&&
!this.options.NoOpt};m.prototype.optimizeBins=function(a,b){if(30>this.bins.length&&!b)return this.bins;var c=null;if("function"==typeof b)for(var d=0;d<this.bins.length;++d)b(this.bins[d],d)?c||(c=0==d?[]:this.bins.slice(0,d)):c&&c.push(this.bins[d]);c||(c=this.bins);a||(a=5E5);if(c.length<a||!this.canOptimize())return c;a=Math.floor(c.length/a);2>a&&(a=2);b=[];for(d=0;d<c.length;d+=a)b.push(c[d]);return b};m.prototype.getTooltips=function(a){var b=this.getFramePainter(),c=[];c.push(this.getObjectHint());
a&&b&&(c.push("x = "+b.axisAsText("x",a.x)),c.push("y = "+b.axisAsText("y",a.y)),this.options.Errors&&"normal"==b.x_handle.kind&&"exlow"in a&&(0!=a.exlow||0!=a.exhigh)&&c.push("error x = -"+b.axisAsText("x",a.exlow)+"/+"+b.axisAsText("x",a.exhigh)),(this.options.Errors||0<this.options.EF)&&"normal"==b.y_handle.kind&&"eylow"in a&&(0!=a.eylow||0!=a.eyhigh)&&c.push("error y = -"+b.axisAsText("y",a.eylow)+"/+"+b.axisAsText("y",a.eyhigh)));return c};m.prototype.get_main=function(){var a=this.getFramePainter();
if(a&&a.grx&&a.gry)return a;var b=(a=this.getPadPainter())?a.getPadRect():{width:800,height:600};a={pad_layer:!0,pad:a.getRootPad(!0),pw:b.width,ph:b.height,getFrameWidth:function(){return this.pw},getFrameHeight:function(){return this.ph},grx:function(a){a=this.pad.fLogx?0<a?Math.log10(a):this.pad.fUxmin:(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1);return a*this.pw},gry:function(a){a=this.pad.fLogy?0<a?Math.log10(a):this.pad.fUymin:(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1);return(1-a)*this.ph}};
return a.pad?a:null};m.prototype.drawGraph=function(){var a=this,b=this.get_main();if(b){var c=b.getFrameWidth(),d=b.getFrameHeight(),e=this.getObject(),k=0;this.createG(!b.pad_layer);if(this.options._pfc||this.options._plc||this.options._pmc){var f=this.getMainPainter();f&&f.createAutoColor&&(f=f.createAutoColor(),this.options._pfc&&(e.fFillColor=f,delete this.fillatt),this.options._plc&&(e.fLineColor=f,delete this.lineatt),this.options._pmc&&(e.fMarkerColor=f,delete this.markeratt),this.options._pfc=
this.options._plc=this.options._pmc=!1)}this.createAttLine({attr:e,can_excl:!0});this.createAttFill({attr:e,kind:1});this.fillatt.used=!1;this.draw_kind="none";this.marker_size=0;0!=this.lineatt.excl_side&&(k=this.lineatt.excl_width,0<this.lineatt.width&&(this.options.Line=1));f=null;if(this.options.EF){f=this.optimizeBins(1<this.options.EF?5E3:0);for(var h=0;h<f.length;++h){var t=f[h];t.grx=b.grx(t.x);t.gry=b.gry(t.y-t.eylow)}h=g.buildSvgPath(1<this.options.EF?"bezier":"line",f);t=[];for(var n=f.length-
1;0<=n;--n){var w=f[n];w.gry=b.gry(w.y+w.eyhigh);t.push(w)}t=g.buildSvgPath(1<this.options.EF?"Lbezier":"Lline",t);this.draw_g.append("svg:path").attr("d",h.path+t.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind="lines"}if(1==this.options.Line||1==this.options.Fill||0!==k){h="";"TCutG"==e._typename&&(this.options.Fill=1);1==this.options.Fill&&(h="Z",k=0);f||(f=this.optimizeBins(this.options.Curve?5E3:0));for(t=0;t<f.length;++t)n=f[t],n.grx=b.grx(n.x),n.gry=b.gry(n.y);t="line";
1===this.options.Curve?t="bezier":0!==k&&(t+="calc");t=g.buildSvgPath(t,f);if(0!==k){n=[];for(w=f.length-1;0<=w;--w){var z=f[w],q=Math.sqrt(z.dgrx*z.dgrx+z.dgry*z.dgry);z.grx+=k*z.dgry/q;z.gry-=k*z.dgrx/q;n.push(z)}k=g.buildSvgPath("L"+(1===this.options.Curve?"bezier":"line"),n);this.draw_g.append("svg:path").attr("d",t.path+k.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",.75)}if(this.options.Line||this.options.Fill)k=this.draw_g.append("svg:path").attr("d",t.path+h),this.options.Line?
k.call(this.lineatt.func):k.style("stroke","none"),this.options.Fill?k.call(this.fillatt.func):k.style("fill","none");this.draw_kind="lines"}k=null;if(this.options.Errors||this.options.Rect||this.options.Bar)f=this.optimizeBins(5E3,function(f,k){var h=b.grx(f.x);if(!a.options.Bar&&(0>h||h>c))return!0;var t=b.gry(f.y);if(!a.options.Bar&&!a.options.OutRange&&(0>t||t>d))return!0;f.grx1=Math.round(h);f.gry1=Math.round(t);a.has_errors&&(f.grx0=Math.round(b.grx(f.x-f.exlow)-h),f.grx2=Math.round(b.grx(f.x+
f.exhigh)-h),f.gry0=Math.round(b.gry(f.y-f.eylow)-t),f.gry2=Math.round(b.gry(f.y+f.eyhigh)-t),a.is_bent?(f.grdx0=Math.round(b.gry(f.y+e.fEXlowd[k])-t),f.grdx2=Math.round(b.gry(f.y+e.fEXhighd[k])-t),f.grdy0=Math.round(b.grx(f.x+e.fEYlowd[k])-h),f.grdy2=Math.round(b.grx(f.x+e.fEYhighd[k])-h)):f.grdx0=f.grdx2=f.grdy0=f.grdy2=0);return!1}),this.draw_kind="nodes",k=this.draw_g.selectAll(".grpoint").data(f).enter().append("svg:g").attr("class","grpoint").attr("transform",function(a){return"translate("+
a.grx1+","+a.gry1+")"});if(this.options.Bar){for(h=1;h<f.length-1;++h)f[h].width=Math.max(2,(f[h+1].grx1-f[h-1].grx1)/2-2);switch(f.length){case 0:break;case 1:f[0].width=c/4;break;case 2:f[0].width=f[1].width=(f[1].grx1-f[0].grx1)/2;break;default:f[0].width=f[1].width,f[f.length-1].width=f[f.length-2].width}var l=Math.round(b.gry(0));k.append("svg:rect").attr("x",function(a){return Math.round(-a.width/2)}).attr("y",function(b){b.bar=!0;return 1!==a.options.Bar?0:b.gry1>l?l-b.gry1:0}).attr("width",
function(a){return Math.round(a.width)}).attr("height",function(b){return 1!==a.options.Bar?d>b.gry1?d-b.gry1:0:Math.abs(l-b.gry1)}).call(this.fillatt.func)}this.options.Rect&&k.filter(function(a){return 0<a.exlow&&0<a.exhigh&&0<a.eylow&&0<a.eyhigh}).append("svg:rect").attr("x",function(a){a.rect=!0;return a.grx0}).attr("y",function(a){return a.gry2}).attr("width",function(a){return a.grx2-a.grx0}).attr("height",function(a){return a.gry0-a.gry2}).call(this.fillatt.func).call(2===this.options.Rect?
this.lineatt.func:function(){});this.error_size=0;if(this.options.Errors){var r=this.lineatt.width+JSROOT.gStyle.fEndErrorSize;h=0;h=this.options.Ends?"m0,"+r+"v-"+2*r:"";t=this.options.Ends?"m"+r+",0h-"+2*r:"";var m=h,p=h,u=t,v=t,D=this.options.MainError?"M0,0L":"M";switch(this.options.Ends){case 2:h=Math.max(this.lineatt.width+1,Math.round(.66*r));m="m"+h+","+r+"h-"+h+"v-"+2*r+"h"+h;p="m-"+h+","+r+"h"+h+"v-"+2*r+"h-"+h;u="m-"+r+","+h+"v-"+h+"h"+2*r+"v"+h;v="m-"+r+",-"+h+"v"+h+"h"+2*r+"v-"+h;break;
case 3:r=Math.max(r,Math.round(5.28*e.fMarkerSize));h=Math.max(this.lineatt.width+1,Math.round(.66*r));m="l"+h+","+r+"v-"+2*r+"l-"+h+","+r;p="l-"+h+","+r+"v-"+2*r+"l"+h+","+r;u="l-"+r+","+h+"h"+2*r+"l-"+r+",-"+h;v="l-"+r+",-"+h+"h"+2*r+"l-"+r+","+h;break;case 4:r=Math.max(r,Math.round(5.28*e.fMarkerSize)),h=Math.max(this.lineatt.width+1,Math.round(.66*r)),m="l"+h+","+r+"m0,-"+2*r+"l-"+h+","+r,p="l-"+h+","+r+"m0,-"+2*r+"l"+h+","+r,u="l-"+r+","+h+"m"+2*r+",0l-"+r+",-"+h,v="l-"+r+",-"+h+"m"+2*r+",0l-"+
r+","+h}this.error_size=r;r=Math.floor((this.lineatt.width-1)/2);h=k.filter(function(a){return 0<a.exlow||0<a.exhigh||0<a.eylow||0<a.eyhigh});!JSROOT.batch_mode&&JSROOT.settings.Tooltip&&h.append("svg:path").style("stroke","none").style("fill","none").style("pointer-events","visibleFill").attr("d",function(a){return"M"+a.grx0+","+a.gry0+"h"+(a.grx2-a.grx0)+"v"+(a.gry2-a.gry0)+"h"+(a.grx0-a.grx2)+"z"});h.append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(a){a.error=!0;
return(0<a.exlow?D+(a.grx0+r)+","+a.grdx0+m:"")+(0<a.exhigh?D+(a.grx2-r)+","+a.grdx2+p:"")+(0<a.eylow?D+a.grdy0+","+(a.gry0-r)+v:"")+(0<a.eyhigh?D+a.grdy2+","+(a.gry2+r)+u:"")})}if(this.options.Mark){h="";this.createAttMarker({attr:e,style:this.options.Mark-100});this.marker_size=this.markeratt.getFullSize();this.markeratt.resetPos();n=1E6/(this.markeratt.getMarkerLength()+7);t=1;f?this.canOptimize()&&f.length>1.5*n&&(t=Math.min(2,Math.round(f.length/n))):f=this.optimizeBins(n);for(w=0;w<f.length;w+=
t)z=f[w],n=b.grx(z.x),n>-this.marker_size&&n<c+this.marker_size&&(z=b.gry(z.y),z>-this.marker_size&&z<d+this.marker_size&&(h+=this.markeratt.create(n,z)));0<h.length&&(this.draw_g.append("svg:path").attr("d",h).call(this.markeratt.func),null===k&&"none"==this.draw_kind&&(this.draw_kind=101==this.options.Mark?"path":"mark"))}if(!JSROOT.batch_mode)return JSROOT.require(["interactive"]).then(function(b){return b.addMoveHandler(a,a.testEditable())})}};m.prototype.extractTooltip=function(a){if(!a)return null;
if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.extractTooltipForPath(a);if("nodes"!=this.draw_kind)return null;var b=this.getFramePainter(),c=b.getFrameHeight(),d=this.error_size,e=1===this.options.Bar,k=null,f=1E10,h=null,t=this.marker_size?Math.round(this.marker_size/2+1.5):0;this.draw_g.selectAll(".grpoint").each(function(){var g=l.select(this).datum();if(void 0!==g){var n=Math.pow(a.x-g.grx1,2);1===a.nproc&&(n+=Math.pow(a.y-g.gry1,2));if(!(n>=f)){if(g.error||
g.rect||g.marker)var w={x1:Math.min(-d,g.grx0,-t),x2:Math.max(d,g.grx2,t),y1:Math.min(-d,g.gry2,-t),y2:Math.max(d,g.gry0,t)};else if(g.bar){if(w={x1:-g.width/2,x2:g.width/2,y1:0,y2:c-g.gry1},e){var r=b.gry(0);w.y1=g.gry1>r?r-g.gry1:0;w.y2=g.gry1>r?0:r-g.gry1}}else w={x1:-5,x2:5,y1:-5,y2:5};r=a.y>=g.gry1+w.y1&&a.y<=g.gry1+w.y2;a.x>=g.grx1+w.x1&&a.x<=g.grx1+w.x2&&(r||1<a.nproc)&&(f=n,k=this,h=w,h.exact=r)}}});if(null===k)return null;var g=l.select(k).datum(),w={name:this.getObject().fName,title:this.getObject().fTitle,
x:g.grx1,y:g.gry1,color1:this.lineatt.color,lines:this.getTooltips(g),rect:h,d3bin:k};this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(w.color2=this.fillatt.getFillColor());h.exact&&(w.exact=!0);w.menu=w.exact;w.menu_dist=3;w.bin=g;w.binindx=g.indx;return w};m.prototype.showTooltip=function(a){if(a){if(a.usepath)return this.showTooltipForPath(a);var b=l.select(a.d3bin).datum(),c=this.draw_g.select(".tooltip_bin");c.empty()&&(c=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events",
"none"));a.changed=c.property("current_bin")!==a.d3bin;a.changed&&c.attr("x",b.grx1+a.rect.x1).attr("width",a.rect.x2-a.rect.x1).attr("y",b.gry1+a.rect.y1).attr("height",a.rect.y2-a.rect.y1).style("opacity","0.3").property("current_bin",a.d3bin)}else this.draw_g&&this.draw_g.select(".tooltip_bin").remove()};m.prototype.processTooltipEvent=function(a){var b=this.extractTooltip(a);a&&a.disabled||this.showTooltip(b);return b};m.prototype.findBestBin=function(a){if(!this.bins)return null;var b="lines"==
this.draw_kind,c=-1,d=null,e=1E10,k=this.getFramePainter(),f;for(f=0;f<this.bins.length;++f){var h=this.bins[f];var g=k.grx(h.x);var n=k.gry(h.y);n=(a.x-g)*(a.x-g)+(a.y-n)*(a.y-n);n<e&&(e=n,d=h,c=f)}100<e&&b&&(d=null);var w=Math.max(this.lineatt.width+3,4);0<this.marker_size&&(w=Math.max(this.marker_size,w));d&&(e=Math.sqrt(Math.pow(a.x-k.grx(d.x),2)+Math.pow(a.y-k.gry(d.y),2)));!b&&e>w&&(d=null);d||(c=-1);c={bin:d,indx:c,dist:e,radius:Math.round(w)};if(!d&&b){b=function(a,b,c){return b>=a&&a>=c||
b<=a&&a<=c};e=1E4;n=this.bins[0];var l=k.grx(n.x);d=0;for(f=1;f<this.bins.length;++f){h=this.bins[f];g=k.grx(h.x);if(b(a.x,l,g)){var q=k.gry(n.y);n=k.gry(h.y);1>Math.abs(g-l)?(d=a.y,n=b(a.y,q,n)?0:Math.min(Math.abs(a.y-q),Math.abs(a.y-n))):(d=q+(a.x-l)/(g-l)*(n-q),n=Math.abs(d-a.y));n<e&&(e=n,c.linex=a.x,c.liney=d)}n=h;l=g}e<.5*w&&(c.linedist=e,c.closeline=!0)}return c};m.prototype.testEditable=function(a){var b=this.getObject(),c=JSROOT.BIT(18);if(!b)return!1;("toggle"==a||void 0!==a&&!a!=b.TestBit(c))&&
b.InvertBit(c);return!b.TestBit(c)};m.prototype.extractTooltipForPath=function(a){if(null===this.bins)return null;var b=this.findBestBin(a);if(!b||!b.bin&&!b.closeline)return null;var c="lines"==this.draw_kind,d="mark"==this.draw_kind,e=this.getFramePainter(),k=this.getObject(),f={name:k.fName,title:k.fTitle,x:b.bin?e.grx(b.bin.x):b.linex,y:b.bin?e.gry(b.bin.y):b.liney,color1:this.lineatt.color,lines:this.getTooltips(b.bin),usepath:!0};f.ismark=d;f.islines=c;b.closeline?(f.menu=f.exact=!0,f.menu_dist=
b.linedist):b.bin&&(this.options.EF&&c?(f.gry1=e.gry(b.bin.y-b.bin.eylow),f.gry2=e.gry(b.bin.y+b.bin.eyhigh)):f.gry1=f.gry2=e.gry(b.bin.y),f.binindx=b.indx,f.bin=b.bin,f.radius=b.radius,f.exact=Math.abs(a.x-f.x)<=b.radius&&(Math.abs(a.y-f.gry1)<=b.radius||Math.abs(a.y-f.gry2)<=b.radius),f.menu=f.exact,f.menu_dist=Math.sqrt((a.x-f.x)*(a.x-f.x)+Math.pow(Math.min(Math.abs(a.y-f.gry1),Math.abs(a.y-f.gry2)),2)));this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(f.color2=this.fillatt.getFillColor());
c||(f.color1=this.getColor(k.fMarkerColor),f.color2||(f.color2=f.color1));return f};m.prototype.showTooltipForPath=function(a){var b=this.draw_g.select(".tooltip_bin");a&&a.bin?(b.empty()&&(b=this.draw_g.append("svg:g").attr("class","tooltip_bin")),a.changed=b.property("current_bin")!==a.bin,a.changed&&(b.selectAll("*").remove(),b.property("current_bin",a.bin),a.ismark?b.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(a.x-a.radius)).attr("y",
Math.round(a.y-a.radius)).attr("width",2*a.radius).attr("height",2*a.radius):(b.append("svg:circle").attr("cy",Math.round(a.gry1)),1<Math.abs(a.gry1-a.gry2)&&b.append("svg:circle").attr("cy",Math.round(a.gry2)),b=b.selectAll("circle").attr("r",a.radius).attr("cx",Math.round(a.x)),a.islines?(this.options.Line?b.call(this.lineatt.func):b.style("stroke","black"),this.options.Fill?b.call(this.fillatt.func):b.style("fill","none")):b.style("stroke","black"==a.color1?"green":"black").style("fill","none")))):
b.remove()};m.prototype.moveEnabled=function(){return this.testEditable()};m.prototype.moveStart=function(a,b){this.pos_dx=this.pos_dy=0;var c=this.extractTooltip({x:a,y:b});c&&c.exact&&void 0!==c.binindx?(this.move_binindx=c.binindx,this.move_bin=c.bin,this.move_x0=(c=this.getFramePainter())?c.grx(this.move_bin.x):a,this.move_y0=c?c.gry(this.move_bin.y):b):delete this.move_binindx};m.prototype.moveDrag=function(a,b){this.pos_dx+=a;this.pos_dy+=b;void 0===this.move_binindx?this.draw_g.attr("transform",
"translate("+this.pos_dx+","+this.pos_dy+")"):(a=this.getFramePainter())&&this.move_bin&&(this.move_bin.x=a.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=a.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())};m.prototype.moveEnd=function(a){var b="";if(void 0===this.move_binindx){this.draw_g.attr("transform",null);var c=this.getFramePainter();if(c&&this.bins&&!a){for(var d=0;d<this.bins.length;++d){var e=this.bins[d];e.x=c.revertAxis("x",c.grx(e.x)+this.pos_dx);e.y=c.revertAxis("y",
c.gry(e.y)+this.pos_dy);b+="SetPoint("+e.indx+","+e.x+","+e.y+");;";0==e.indx&&this.matchObjectType("TCutG")&&(b+="SetPoint("+(this.getObject().fNpoints-1)+","+e.x+","+e.y+");;")}this.drawGraph()}}else b="SetPoint("+this.move_bin.indx+","+this.move_bin.x+","+this.move_bin.y+")",0==this.move_bin.indx&&this.matchObjectType("TCutG")&&(b+=";;SetPoint("+(this.getObject().fNpoints-1)+","+this.move_bin.x+","+this.move_bin.y+")"),delete this.move_binindx;b&&!a&&this.submitCanvExec(b)};m.prototype.fillContextMenu=
function(a){var b=this;JSROOT.ObjectPainter.prototype.fillContextMenu.call(this,a);this.snapid||a.addchk(this.testEditable(),"Editable",function(){b.testEditable("toggle");b.drawGraph()});return 0<a.size()};m.prototype.executeMenuCommand=function(a,b){if(JSROOT.ObjectPainter.prototype.executeMenuCommand.call(this,a,b))return!0;b=this.getCanvPainter();var c=this.getFramePainter();if("RemovePoint"==a.fName||"InsertPoint"==a.fName){c=c?c.getLastEventPos():null;if(!b||b._readonly||!c)return!0;var d=this.extractTooltip(c);
"InsertPoint"==a.fName?(a=(d=this.getFramePainter())?d.revertAxis("x",c.x):0,c=d?d.revertAxis("y",c.y):0,b.showMessage("InsertPoint("+a.toFixed(3)+","+c.toFixed(3)+") not yet implemented")):this.args_menu_id&&d&&void 0!==d.binindx&&this.submitCanvExec("RemovePoint("+d.binindx+")",this.args_menu_id);return!0}return!1};m.prototype.updateObject=function(a,b){if(!this.matchObjectType(a))return!1;void 0!==b&&b!=this.options.original&&this.decodeOptions(b);b=this.getObject();b.fBits=a.fBits;b.fTitle=a.fTitle;
b.fX=a.fX;b.fY=a.fY;b.fNpoints=a.fNpoints;this.createBins();this.axes_draw&&(a=this.createHistogram(a.fHistogram),a.fTitle=b.fTitle,this.getMainPainter().updateObject(a,this.options.HOptions));return!0};m.prototype.canZoomInside=function(a,b,c){var d=this.getObject();if(!d||"x"!==a)return!1;for(a=0;a<d.fNpoints;++a)if(b<d.fX[a]&&d.fX[a]<c)return!0;return!1};m.prototype.clickButton=function(a){if("ToggleZoom"!==a)return!1;a=this.getFramePainter();if(!a||this.xmin===this.xmax&&this.ymin===this.ymax)return!1;
a.zoom(this.xmin,this.xmax,this.ymin,this.ymax);return!0};m.prototype.findFunc=function(){var a=this.getObject();if(a&&a.fFunctions)for(var b=0;b<a.fFunctions.arr.length;++b){var c=a.fFunctions.arr[b];if("TF1"==c._typename||"TF2"==c._typename)return c}return null};m.prototype.findStat=function(){var a=this.getObject();if(a&&a.fFunctions)for(var b=0;b<a.fFunctions.arr.length;++b){var c=a.fFunctions.arr[b];if("TPaveStats"==c._typename&&"stats"==c.fName)return c}return null};m.prototype.createStat=function(){var a=
this.findFunc();if(!a)return null;var b=this.findStat();if(b)return b;if((b=this.getCanvPainter())&&b.normal_canvas||this.options.PadStats)return null;this.create_stats=!0;var c=JSROOT.gStyle;b=JSROOT.create("TPaveStats");JSROOT.extend(b,{fName:"stats",fOptStat:0,fOptFit:c.fOptFit||111,fBorderSize:1});b.fX1NDC=c.fStatX-c.fStatW;b.fY1NDC=c.fStatY-c.fStatH;b.fX2NDC=c.fStatX;b.fY2NDC=c.fStatY;b.fFillColor=c.fStatColor;b.fFillStyle=c.fStatStyle;b.fTextAngle=0;b.fTextSize=c.fStatFontSize;b.fTextAlign=
12;b.fTextColor=c.fStatTextColor;b.fTextFont=c.fStatFont;b.AddText(a.fName);this.getObject().fFunctions.Add(b);return b};m.prototype.fillStatistic=function(a,b,c){b=this.findFunc();if(!b||!c||!this.create_stats)return!1;a.clearPave();a.fillFunctionStat(b,c);return!0};m.prototype.drawNextFunction=function(a){var b=this,c=this.getObject();if(!c.fFunctions||a>=c.fFunctions.arr.length)return Promise.resolve(this);var d=c.fFunctions.arr[a];c=c.fFunctions.opt[a];d.$main_painter=this;return JSROOT.draw(this.getDom(),
d,c).then(function(){return b.drawNextFunction(a+1)})};p.prototype=Object.create(JSROOT.ObjectPainter.prototype);p.prototype.translate=function(a,b,c){b=this.r(b);var d=b/this.szx*this.szy;a={x:b*Math.cos(-a-this.angle),y:d*Math.sin(-a-this.angle),rx:b,ry:d};c||(a.x=Math.round(a.x),a.y=Math.round(a.y),a.rx=Math.round(a.rx),a.ry=Math.round(a.ry));return a};p.prototype.format=function(a){return a===Math.round(a)?a.toString():10<this.ndig?a.toExponential(4):a.toFixed(0<this.ndig?this.ndig:0)};p.prototype.axisAsText=
function(a,b){if("r"==a)return b===Math.round(b)?b.toString():10<this.ndig?b.toExponential(4):b.toFixed(this.ndig+2);b*=180/Math.PI;return b===Math.round(b)?b.toString():b.toFixed(1)};p.prototype.getFrameRect=function(){var a=this.getPadPainter(),b=a.getRootPad(!0),c=a.getPadWidth();a=a.getPadHeight();var d={};b?(d.szx=Math.round(Math.max(.1,.5-Math.max(b.fLeftMargin,b.fRightMargin))*c),d.szy=Math.round(Math.max(.1,.5-Math.max(b.fBottomMargin,b.fTopMargin))*a)):(d.szx=Math.round(.5*c),d.szy=Math.round(.5*
a));d.width=2*d.szx;d.height=2*d.szy;d.midx=Math.round(c/2);d.midy=Math.round(a/2);d.x=d.midx-d.szx;d.y=d.midy-d.szy;d.hint_delta_x=d.szx;d.hint_delta_y=d.szy;d.transform="translate("+d.x+","+d.y+")";return d};p.prototype.mouseEvent=function(a,b){var c=this.getLayerSvg("primitives_layer").select(".interactive_ellipse");if(!c.empty()){var d=null;"leave"!==a&&(a=l.pointer(b,c.node()),d={x:a[0],y:a[1],touch:!1});this.processFrameTooltipEvent(d)}};p.prototype.mouseWheel=function(a){a.stopPropagation();
a.preventDefault();this.processFrameTooltipEvent(null);var b=this.getObject();if(b&&(a=a.wheelDelta?-a.wheelDelta:a.deltaY||a.detail)){var c=this.scale_rmin,d=this.scale_rmax;d+=(0>a?-.2:.2)*(d-c);if(c<b.fRwrmin||d>b.fRwrmax)c=d=0;if(this.zoom_rmin!=c||this.zoom_rmax!=d)this.zoom_rmin=c,this.zoom_rmax=d,this.redrawPad()}};p.prototype.redraw=function(){var a=this;if(this.isMainPainter()){var b=this.getObject(),c=this.getFrameRect();this.createG();this.draw_g.attr("transform","translate("+c.midx+","+
c.midy+")");this.szx=c.szx;this.szy=c.szy;this.scale_rmin=b.fRwrmin;this.scale_rmax=b.fRwrmax;this.zoom_rmin!=this.zoom_rmax&&(this.scale_rmin=this.zoom_rmin,this.scale_rmax=this.zoom_rmax);this.r=l.scaleLinear().domain([this.scale_rmin,this.scale_rmax]).range([0,this.szx]);this.angle=b.fAxisAngle||0;var d=this.r.ticks(5);c=Math.floor(b.fNdivRad%1E4/100);this.createAttLine({attr:b});this.gridatt||(this.gridatt=new JSROOT.TAttLineHandler({color:b.fLineColor,style:2,width:1}));var e=Math.abs(b.fRwrmax-
b.fRwrmin);this.ndig=0>=e?-3:Math.round(Math.log10(d.length/e));e=[];for(var k=0;k<d.length;){var f=this.format(d[k]);if(0<=e.indexOf(f)){if(10<++this.ndig)break;e=[];k=0}else e.push(f),k++}e=!1;d[d.length-1]<b.fRwrmax&&this.zoom_rmin==this.zoom_rmax&&(d.push(b.fRwrmax),e=!0);this.startTextDrawing(b.fRadialLabelFont,Math.round(b.fRadialTextSize*this.szy*2));for(k=0;k<d.length;++k){var h=this.r(d[k]),g=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",
Math.round(g)).style("fill","none").call(this.lineatt.func);(k<d.length-1||!e)&&this.drawText({align:23,x:Math.round(h),y:Math.round(b.fRadialTextSize*this.szy*.5),text:this.format(d[k]),color:this.getColor[b.fRadialLabelColor],latex:0});if(1<c&&(k<d.length-1||!e)){f=(d[1]-d[0])/c;for(var n=1;n<c;++n){h=d[k]+f*n;if(h>this.scale_rmax)break;h=this.r(h);g=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",Math.round(g)).style("fill","none").call(this.gridatt.func)}}}this.finishTextDrawing();
c=Math.round(b.fPolarTextSize*this.szy*2);this.startTextDrawing(b.fPolarLabelFont,c);d=b.fNdivPol%100;8!==d&&3!==d&&(d=8);e=8==d?"0 #frac{#pi}{4} #frac{#pi}{2} #frac{3#pi}{4} #pi #frac{5#pi}{4} #frac{3#pi}{2} #frac{7#pi}{4}".split(" "):["0","#frac{2#pi}{3}","#frac{4#pi}{3}"];k=[12,11,21,31,32,33,23,13];for(f=0;f<d;++f)n=2*-f*Math.PI/d-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(n))).attr("y2",Math.round(this.szy*Math.sin(n))).call(this.lineatt.func),
this.drawText({align:k[Math.round(16-n/Math.PI*4)%8],x:Math.round((this.szx+c)*Math.cos(n)),y:Math.round((this.szy+c/this.szx*this.szy)*Math.sin(n)),text:e[f],color:this.getColor[b.fPolarLabelColor],latex:1});this.finishTextDrawing();c=Math.floor(b.fNdivPol%1E4/100);if(1<c)for(b=0;b<d*c;++b)0!==b%c&&(e=2*-b*Math.PI/d/c-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(e))).attr("y2",Math.round(this.szy*Math.sin(e))).call(this.gridatt.func));JSROOT.batch_mode||
JSROOT.require(["interactive"]).then(function(b){b.TooltipHandler.assign(a);b=a.getLayerSvg("primitives_layer");var c=b.select(".interactive_ellipse");c.empty()&&(c=b.append("g").classed("most_upper_primitives",!0).append("ellipse").classed("interactive_ellipse",!0).attr("cx",0).attr("cy",0).style("fill","none").style("pointer-events","visibleFill").on("mouseenter",function(b){return a.mouseEvent("enter",b)}).on("mousemove",function(b){return a.mouseEvent("move",b)}).on("mouseleave",function(b){return a.mouseEvent("leave",
b)}));c.attr("rx",a.szx).attr("ry",a.szy);l.select(c.node().parentNode).attr("transform",a.draw_g.attr("transform"));if(JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel)c.on("wheel",function(b){return a.mouseWheel(b)})})}};x.prototype=Object.create(JSROOT.ObjectPainter.prototype);x.prototype.redraw=function(){this.drawGraphPolar()};x.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a||"L");this.options||(this.options={});JSROOT.extend(this.options,{mark:b.check("P"),err:b.check("E"),
fill:b.check("F"),line:b.check("L"),curve:b.check("C")});this.storeDrawOpt(a)};x.prototype.drawGraphPolar=function(){var a=this.getObject(),b=this.getMainPainter();if(a&&b&&b.$polargram){this.options.mark&&this.createAttMarker({attr:a});(this.options.err||this.options.line||this.options.curve)&&this.createAttLine({attr:a});this.options.fill&&this.createAttFill({attr:a});this.createG();this.draw_g.attr("transform",b.draw_g.attr("transform"));for(var c="",d="",e="",k=[],f=0;f<a.fNpoints;++f)if(!(a.fY[f]>
b.scale_rmax)){if(this.options.err){var h=b.translate(a.fX[f],a.fY[f]-a.fEY[f]),t=b.translate(a.fX[f],a.fY[f]+a.fEY[f]);d+="M"+h.x+","+h.y+"L"+t.x+","+t.y;h=b.translate(a.fX[f]+a.fEX[f],a.fY[f]);t=b.translate(a.fX[f]-a.fEX[f],a.fY[f]);d+="M"+h.x+","+h.y+"A"+t.rx+","+t.ry+",0,0,1,"+t.x+","+t.y}h=b.translate(a.fX[f],a.fY[f]);this.options.mark&&(c+=this.markeratt.create(h.x,h.y));if(this.options.line||this.options.fill)e+=(e?"L":"M")+h.x+","+h.y;this.options.curve&&(h.grx=h.x,h.gry=h.y,k.push(h))}this.options.fill&&
e&&this.draw_g.append("svg:path").attr("d",e+"Z").style("stroke","none").call(this.fillatt.func);this.options.line&&e&&this.draw_g.append("svg:path").attr("d",e).style("fill","none").call(this.lineatt.func);this.options.curve&&k.length&&this.draw_g.append("svg:path").attr("d",g.buildSvgPath("bezier",k).path).style("fill","none").call(this.lineatt.func);d&&this.draw_g.append("svg:path").attr("d",d).style("fill","none").call(this.lineatt.func);c&&this.draw_g.append("svg:path").attr("d",c).call(this.markeratt.func)}};
x.prototype.createPolargram=function(){for(var a=JSROOT.create("TGraphPolargram"),b=this.getObject(),c=b.fY[0]||0,d=c,e=0;e<b.fNpoints;++e)c=Math.min(c,b.fY[e]-b.fEY[e]),d=Math.max(d,b.fY[e]+b.fEY[e]);a.fRwrmin=c-.1*(d-c);a.fRwrmax=d+.1*(d-c);return a};x.prototype.extractTooltip=function(a){if(!a)return null;for(var b=this.getObject(),c=this.getMainPainter(),d=1E10,e=-1,k=null,f=0;f<b.fNpoints;++f){var h=c.translate(b.fX[f],b.fY[f]),g=(h.x-a.x)*(h.x-a.x)+(h.y-a.y)*(h.y-a.y);g<d&&(d=g,e=f,k=h)}a=5;
this.markeratt&&this.markeratt.used&&(a=this.markeratt.getFullSize());if(Math.sqrt(d)>a)return null;d={name:this.getObject().fName,title:this.getObject().fTitle,x:k.x,y:k.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:4>Math.sqrt(d),lines:[this.getObjectHint()],binindx:e,menu_dist:a,radius:a};d.lines.push("r = "+c.axisAsText("r",b.fY[e]));d.lines.push("phi = "+c.axisAsText("phi",b.fX[e]));b.fEY&&b.fEY[e]&&d.lines.push("error r = "+c.axisAsText("r",b.fEY[e]));
b.fEX&&b.fEX[e]&&d.lines.push("error phi = "+c.axisAsText("phi",b.fEX[e]));return d};x.prototype.showTooltip=function(a){if(this.draw_g){var b=this.draw_g.select(".tooltip_bin");a?(b.empty()&&(b=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),a.changed=b.property("current_bin")!==a.binindx,a.changed&&b.attr("cx",a.x).attr("cy",a.y).attr("rx",Math.round(a.radius)).attr("ry",Math.round(a.radius)).style("fill","none").style("stroke",a.color1).property("current_bin",
a.binindx)):b.remove()}};x.prototype.processTooltipEvent=function(a){var b=this.extractTooltip(a);a&&a.disabled||this.showTooltip(b);return b};u.prototype=Object.create(JSROOT.ObjectPainter.prototype);u.prototype.updateObject=function(a,b){var c=this.getObject();if(c._typename!=a._typename)return!1;c!==a&&JSROOT.extend(c,a);void 0!==b&&this.decodeOptions(b);return!0};u.prototype.eval=function(a,b){b-=a.fX;return"TSplinePoly3"==a._typename?a.fY+b*(a.fB+b*(a.fC+b*a.fD)):"TSplinePoly5"==a._typename?
a.fY+b*(a.fB+b*(a.fC+b*(a.fD+b*(a.fE+b*a.fF)))):a.fY+b};u.prototype.FindX=function(a){var b=this.getObject(),c=0,d=b.fNp-1;if(a<=b.fXmin)return 0;if(a>=b.fXmax)return d;if(b.fKstep)c=Math.round((a-b.fXmin)/b.fDelta),a<b.fPoly[c].fX?c=Math.max(c-1,0):c<d&&a>b.fPoly[c+1].fX&&++c;else for(;1<d-c;){var e=Math.round((c+d)/2);a>b.fPoly[e].fX?c=e:d=e}return c};u.prototype.createDummyHisto=function(){var a=0,b=1,c=0,d=1,e=this.getObject();e&&e.fPoly&&(a=b=e.fPoly[0].fX,c=d=e.fPoly[0].fY,e.fPoly.forEach(function(e){a=
Math.min(e.fX,a);b=Math.max(e.fX,b);c=Math.min(e.fY,c);d=Math.max(e.fY,d)}),0<d&&(d*=1.05),0>c&&(c*=1.05));var k=JSROOT.create("TH1I");k.fName=e.fName+"_hist";k.fTitle=e.fTitle;k.fXaxis.fXmin=a;k.fXaxis.fXmax=b;k.fYaxis.fXmin=c;k.fYaxis.fXmax=d;return k};u.prototype.processTooltipEvent=function(a){var b=!1,c=this.getObject(),d=this.getFramePainter(),e=null,k=0;if(null!==a&&c&&d){var f=d.revertAxis("x",a.x);k=this.FindX(f);e=c.fPoly[k];var h=this.eval(e,f);k<c.fN-1&&Math.abs(c.fPoly[k+1].fX-f)<Math.abs(f-
e.fX)&&(e=c.fPoly[++k]);if(Math.abs(d.grx(e.fX)-a.x)<.5*this.knot_size)f=e.fX,h=e.fY;else if(e=null,f<c.fXmin||f>c.fXmax)b=!0}else b=!0;if(b)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;b=this.draw_g.select(".tooltip_bin");c=this.lineatt.width+3;b.empty()&&(b=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",c).style("fill","none").call(this.lineatt.func));c={name:this.getObject().fName,title:this.getObject().fTitle,x:d.grx(f),
y:d.gry(h),color1:this.lineatt.color,lines:[],exact:null!==e||Math.abs(d.gry(h)-a.y)<c};c.changed=b.property("current_xx")!==f;c.menu=c.exact;c.menu_dist=Math.sqrt((c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y));c.changed&&b.attr("cx",Math.round(c.x)).attr("cy",Math.round(c.y)).property("current_xx",f);a=this.getObjectHint();0<a.length&&c.lines.push(a);c.lines.push("x = "+d.axisAsText("x",f));c.lines.push("y = "+d.axisAsText("y",h));null!==e&&(c.lines.push("knot = "+k),c.lines.push("B = "+g.floatToString(e.fB,
JSROOT.gStyle.fStatFormat)),c.lines.push("C = "+g.floatToString(e.fC,JSROOT.gStyle.fStatFormat)),c.lines.push("D = "+g.floatToString(e.fD,JSROOT.gStyle.fStatFormat)),void 0!==e.fE&&void 0!==e.fF&&(c.lines.push("E = "+g.floatToString(e.fE,JSROOT.gStyle.fStatFormat)),c.lines.push("F = "+g.floatToString(e.fF,JSROOT.gStyle.fStatFormat))));return c};u.prototype.redraw=function(){var a=this.getObject(),b=this.getFramePainter(),c=b.getFrameWidth(),d=b.getFrameHeight();this.createG(!0);this.knot_size=5;this.createAttLine({attr:a});
if(this.options.Line||this.options.Curve){var e=Math.max(10,a.fNpx),k=Math.max(b.scale_xmin,a.fXmin),f=Math.min(b.scale_xmax,a.fXmax),h=this.FindX(k),t=[];b.logx&&(k=Math.log(k),f=Math.log(f));for(var n=0;n<e;++n){var l=k+(f-k)/e*(n-1);for(b.logx&&(l=Math.exp(l));h<a.fNp-1&&l>a.fPoly[h+1].fX;)++h;var m=this.eval(a.fPoly[h],l);t.push({x:l,y:m,grx:b.grx(l),gry:b.gry(m)})}e=d;void 0!==b.hmin&&0<=b.hmin&&(e=Math.round(b.gry(0)),e>d||0>e)&&(e=d);t=g.buildSvgPath("bezier",t,e,2);this.draw_g.append("svg:path").attr("class",
"line").attr("d",t.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){t="";this.createAttMarker({attr:a});this.markeratt.resetPos();this.knot_size=this.markeratt.getFullSize();for(e=0;e<a.fPoly.length;e++)f=a.fPoly[e],k=b.grx(f.fX),k>-this.knot_size&&k<c+this.knot_size&&(f=b.gry(f.fY),f>-this.knot_size&&f<d+this.knot_size&&(t+=this.markeratt.create(k,f)));t&&this.draw_g.append("svg:path").attr("d",t).call(this.markeratt.func)}};u.prototype.canZoomInside=function(a){return"x"===
a&&this.getObject()?!0:!1};u.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a);this.options||(this.options={});JSROOT.extend(this.options,{Same:b.check("SAME"),Line:b.check("L"),Curve:b.check("C"),Mark:b.check("P")});this.storeDrawOpt(a)};g.drawSpline=function(a,b,c){var d=new u(a,b);d.decodeOptions(c);b=Promise.resolve();if(!d.getMainPainter()){if(d.options.Same)return console.warn("TSpline painter requires histogram to be drawn"),null;b=d.createDummyHisto();b=JSROOT.draw(a,b,"AXIS")}return b.then(function(){d.addToPadPrimitives();
d.redraw();return d})};C.prototype=Object.create(JSROOT.ObjectPainter.prototype);C.prototype.redraw=function(){void 0===this.step&&this.startDrawing()};C.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a||"REPEAT");this.options||(this.options={});JSROOT.extend(this.options,{once:b.check("ONCE"),repeat:b.check("REPEAT"),first:b.check("FIRST")});this.storeDrawOpt(a)};C.prototype.drawPrimitives=function(a){var b=this;a||(a=0,this._doing_primitives=!0);var c=this.getObject().fSteps.arr[this.step];
return!c||a>=c.arr.length?(delete this._doing_primitives,Promise.resolve()):JSROOT.draw(this.getDom(),c.arr[a],c.opt[a]).then(function(c){c&&(c.$grtimeid=b.selfid);return b.drawPrimitives(a+1)})};C.prototype.continueDrawing=function(){var a=this;if(this.options){var b=this.getObject();if(this.options.first)delete this.step;else if(this.wait_animation_frame)delete this.wait_animation_frame,(b=this.getPadPainter())?(b.cleanPrimitives(function(b){return b.$grtimeid===a.selfid}),this.drawPrimitives().then(function(){return a.continueDrawing()})):
delete this.step;else if(this.running_timeout)clearTimeout(this.running_timeout),delete this.running_timeout,this.wait_animation_frame=!0,requestAnimationFrame(function(){return a.continueDrawing()});else{var c=b.fSleepTime;if(!c||100>c)c=10;if(++this.step>b.fSteps.arr.length)if(this.options.repeat)this.step=0,c=Math.max(5E3,5*c);else{delete this.step;return}this.running_timeout=setTimeout(function(){return a.continueDrawing()},c)}}};C.prototype.startDrawing=function(){var a=this;this.step=0;return this.drawPrimitives().then(function(){a.continueDrawing();
return a})};B.prototype=Object.create(JSROOT.ObjectPainter.prototype);B.prototype.getEfficiency=function(a){var b=this.getObject(),c=b.fTotalHistogram.getBinContent(a);a=b.fPassedHistogram.getBinContent(a);return c?a/c:0};B.prototype.Normal=function(a,b,c,d){if(0==a)return d?1:0;b/=a;a=JSROOT.Math.normal_quantile(1-(1-c)/2,Math.sqrt(b*(1-b)/a));return d?1<b+a?1:b+a:0>b-a?0:b-a};B.prototype.getEfficiencyErrorLow=function(a){var b=this.getObject(),c=b.fTotalHistogram.getBinContent(a),d=b.fPassedHistogram.getBinContent(a);
return this.getEfficiency(a)-this[this.fBoundary](c,d,b.fConfLevel,!1)};B.prototype.getEfficiencyErrorUp=function(a){var b=this.getObject(),c=b.fTotalHistogram.getBinContent(a),d=b.fPassedHistogram.getBinContent(a);a=this.getEfficiency(a);return this[this.fBoundary](c,d,b.fConfLevel,!0)-a};B.prototype.fillGraph=function(a,b){var c=this.getObject(),d=c.fTotalHistogram.fXaxis.fNbins,e=!1,k=0;0<=b.toLowerCase().indexOf("e0")&&(e=!0);for(b=0;b<d;++b)if(e||0!==c.fTotalHistogram.getBinContent(b+1))a.fX[k]=
c.fTotalHistogram.fXaxis.GetBinCenter(b+1),a.fY[k]=this.getEfficiency(b+1),a.fEXlow[k]=c.fTotalHistogram.fXaxis.GetBinCenter(b+1)-c.fTotalHistogram.fXaxis.GetBinLowEdge(b+1),a.fEXhigh[k]=c.fTotalHistogram.fXaxis.GetBinLowEdge(b+2)-c.fTotalHistogram.fXaxis.GetBinCenter(b+1),a.fEYlow[k]=this.getEfficiencyErrorLow(b+1),a.fEYhigh[k]=this.getEfficiencyErrorUp(b+1),++k;a.fNpoints=k};y.prototype=Object.create(JSROOT.ObjectPainter.prototype);y.prototype.cleanup=function(){this.painters=[];JSROOT.ObjectPainter.prototype.cleanup.call(this)};
y.prototype.updateObject=function(a){if(!this.matchObjectType(a))return!1;var b=this.getObject(),c=a.fGraphs,d=this.getPadPainter();b.fTitle=a.fTitle;b=!1;if(this.firstpainter){var e=a.fHistogram;this.autorange&&!e&&(e=this.scanGraphsRange(c));this.firstpainter.updateObject(e)&&(b=!0)}for(e=0;e<c.arr.length;++e)e<this.painters.length&&this.painters[e].updateObject(c.arr[e])&&(b=!0);if(a.fFunctions)for(c=0;c<a.fFunctions.arr.length;++c)if((e=a.fFunctions.arr[c])&&e._typename&&e.fName){var k=d?d.findPainterFor(null,
e.fName,e._typename):null;k&&k.updateObject(e)}return b};y.prototype.scanGraphsRange=function(a,b,c){function d(a,b){if(0!=b.fNpoints){a.first&&(a.xmin=a.xmax=b.fX[0],a.ymin=a.ymax=b.fY[0],a.first=!1);for(var c=0;c<b.fNpoints;++c)a.xmin=Math.min(a.xmin,b.fX[c]),a.xmax=Math.max(a.xmax,b.fX[c]),a.ymin=Math.min(a.ymin,b.fY[c]),a.ymax=Math.max(a.ymax,b.fY[c]);return a}}function e(a){return c.fLogx&&50>a?Math.exp(2.302585092994*a):a}var k=this.getObject(),f=0;var h=0;var g=!1,n=!1,l=!1,m="",q={xmin:0,
xmax:0,ymin:0,ymax:0,first:!0};c&&(g=c.fLogx,n=c.fLogy,q.xmin=c.fUxmin,q.xmax=c.fUxmax,q.ymin=c.fUymin,q.ymax=c.fUymax,q.first=!1);if(b){a=b.fYaxis.fXmin;var p=b.fYaxis.fXmax;c&&(f=e(q.xmin),h=e(q.xmax))}else{this.autorange=!0;for(f=0;f<a.arr.length;++f)d(q,a.arr[f]);a.arr[0]&&a.arr[0].fHistogram&&a.arr[0].fHistogram.fXaxis.fTimeDisplay&&(l=!0,m=a.arr[0].fHistogram.fXaxis.fTimeFormat);q.xmin==q.xmax&&(q.xmax+=1);q.ymin==q.ymax&&(q.ymax+=1);h=.05*(q.xmax-q.xmin);p=.05*(q.ymax-q.ymin);f=q.xmin-h;h=
q.xmax+h;n?(0>=q.ymin&&(q.ymin=.001*q.ymax),a=q.ymin/(1+.5*Math.log10(q.ymax/q.ymin)),p=q.ymax*(1+.2*Math.log10(q.ymax/q.ymin))):(a=q.ymin-p,p=q.ymax+p);0>a&&0<=q.ymin&&(a=0);0<p&&0>=q.ymax&&(p=0)}0>f&&0<=q.xmin&&(f=g?.9*q.xmin:0);0<h&&0>=q.xmax&&(h=g?1.1*q.xmax:0);-1111!=k.fMinimum&&(q.ymin=a=k.fMinimum);-1111!=k.fMaximum&&(q.ymax=p=k.fMaximum);0>a&&0<=q.ymin&&n&&(a=.9*q.ymin);0<p&&0>=q.ymax&&n&&(p=1.1*q.ymax);0>=a&&n&&(a=.001*p);!n&&0<a&&a<.05*p&&(a=0);0>=f&&g&&(f=1E3<h?1:.001*h);!b&&(b=JSROOT.create("TH1I"),
b.fTitle=k.fTitle,b.fXaxis.fXmin=f,b.fXaxis.fXmax=h,b.fXaxis.fTimeDisplay=l)&&(b.fXaxis.fTimeFormat=m);b.fYaxis.fXmin=a;b.fYaxis.fXmax=p;return b};y.prototype.drawAxis=function(a){var b=this.getObject(),c=this.getPadPainter();b=this.scanGraphsRange(b.fGraphs,b.fHistogram,c?c.getRootPad(!0):null);return JSROOT.draw(this.getDom(),b,"AXIS"+a)};y.prototype.drawNextFunction=function(a){var b=this,c=this.getObject();return!c.fFunctions||a>=c.fFunctions.arr.length?Promise.resolve(this):JSROOT.draw(this.getDom(),
c.fFunctions.arr[a],c.fFunctions.opt[a]).then(function(){return b.drawNextFunction(a+1)})};y.prototype.drawNextGraph=function(a,b){var c=this,d=this.getObject().fGraphs;if(a>=d.arr.length)return this._pfc=this._plc=this._pmc=!1,this.drawNextFunction(0);if(this._pfc||this._plc||this._pmc){var e=this.getMainPainter();e&&e.createAutoColor&&(e=e.createAutoColor(d.arr.length),this._pfc&&(d.arr[a].fFillColor=e),this._plc&&(d.arr[a].fLineColor=e),this._pmc&&(d.arr[a].fMarkerColor=e))}return JSROOT.draw(this.getDom(),
d.arr[a],d.opt[a]||b).then(function(d){d&&c.painters.push(d);return c.drawNextGraph(a+1,b)})};g.drawMultiGraph=function(a,b,c){var d=new y(a,b),e=new JSROOT.DrawOptions(c);e.check("3D");e.check("FB");d._pfc=e.check("PFC");d._plc=e.check("PLC");d._pmc=e.check("PMC");var k="";"USE_PAD_TITLE LOGXY LOGX LOGY LOGZ GRIDXY GRIDX GRIDY TICKXY TICKX TICKY".split(" ").forEach(function(a){e.check(a)&&(k+=";"+a)});a=Promise.resolve(d);if(e.check("A")||!d.getMainPainter())a=d.drawAxis(k).then(function(a){d.firstpainter=
a;return d});return a.then(function(){d.addToPadPrimitives();return d.drawNextGraph(0,e.remain())})};A.prototype=Object.create(JSROOT.ObjectPainter.prototype);A.prototype.decodeOptions=function(a){this.options={Zscale:!1};a&&0<=a.indexOf("z")&&(this.options.Zscale=!0)};A.prototype.createRGBA=function(a){var b=this.getObject();if(!b||!b.fPalette)return null;var c=Array(4*(a+1)),d=1;b=b.fPalette;for(var e=0;e<=a;++e){for(var k=1*e/a;b.fPoints[d]<k&&d<b.fPoints.length-1;)d++;var f=(b.fPoints[d]-k)/(b.fPoints[d]-
b.fPoints[d-1]);k=(k-b.fPoints[d-1])/(b.fPoints[d]-b.fPoints[d-1]);c[4*e]=Math.min(255,Math.round((b.fColorRed[d-1]*f+b.fColorRed[d]*k)/256));c[4*e+1]=Math.min(255,Math.round((b.fColorGreen[d-1]*f+b.fColorGreen[d]*k)/256));c[4*e+2]=Math.min(255,Math.round((b.fColorBlue[d-1]*f+b.fColorBlue[d]*k)/256));c[4*e+3]=Math.min(255,Math.round((b.fColorAlpha[d-1]*f+b.fColorAlpha[d]*k)/256))}return c};A.prototype.drawImage=function(){var a=this,b=this.getObject(),c=!1,d=this.getFramePainter(),e=d?d.getFrameRect():
this.getPadPainter().getPadRect();if(b._blob){if(15!=b._blob.length||b._blob[0])3==b._blob.length&&b._blob[0]?(b.fPngBuf=b._blob[2],b.fPngBuf&&b.fPngBuf.length==b._blob[1]||(console.error("TASImage with png buffer _blob error",b._blob[1],"!=",b.fPngBuf?b.fPngBuf.length:-1),delete b.fPngBuf)):console.error("TASImage _blob len",b._blob.length,"not recognized");else if(b.fImageQuality=b._blob[1],b.fImageCompression=b._blob[2],b.fConstRatio=b._blob[3],b.fPalette={_typename:"TImagePalette",fUniqueID:b._blob[4],
fBits:b._blob[5],fNumPoints:b._blob[6],fPoints:b._blob[7],fColorRed:b._blob[8],fColorGreen:b._blob[9],fColorBlue:b._blob[10],fColorAlpha:b._blob[11]},b.fWidth=b._blob[12],b.fHeight=b._blob[13],b.fImgBuf=b._blob[14],b.fWidth*b.fHeight!=b.fImgBuf.length||b.fPalette.fNumPoints!=b.fPalette.fPoints.length)console.error("TASImage _blob decoding error",b.fWidth*b.fHeight,"!=",b.fImgBuf.length,b.fPalette.fNumPoints,"!=",b.fPalette.fPoints.length),delete b.fImgBuf,delete b.fPalette;delete b._blob}var k=!0;
if(b.fImgBuf&&b.fPalette){c=!0;this.rgba=this.createRGBA(1E3);k=b.fImgBuf[0];var f=b.fImgBuf[0];for(var h=1;h<b.fImgBuf.length;++h){var g=b.fImgBuf[h];k=Math.min(g,k);f=Math.max(g,f)}this.fContour={arr:Array(200),rgba:this.rgba,getLevels:function(){return this.arr},getPaletteColor:function(a,b){if(!this.arr||!this.rgba)return"white";a=4*Math.round((b-this.arr[0])/(this.arr[this.arr.length-1]-this.arr[0])*(this.rgba.length-4)/4);return"rgba("+this.rgba[a]+","+this.rgba[a+1]+","+this.rgba[a+2]+","+
this.rgba[a+3]+")"}};for(h=0;200>h;h++)this.fContour.arr[h]=k+(f-k)/199*h;k>=f&&(f=k+1);h=0;g=b.fWidth;var n=0,l=b.fHeight;d&&d.zoom_xmin!=d.zoom_xmax&&(h=Math.round(d.zoom_xmin*b.fWidth),g=Math.round(d.zoom_xmax*b.fWidth));d&&d.zoom_ymin!=d.zoom_ymax&&(n=Math.round(d.zoom_ymin*b.fHeight),l=Math.round(d.zoom_ymax*b.fHeight));if(JSROOT.nodejs)try{var m=require("canvas").createCanvas;var q=m(g-h,l-n)}catch(D){console.log("canvas is not installed")}else q=document.createElement("canvas"),q.width=g-h,
q.height=l-n;if(!q)return Promise.resolve(null);m=q.getContext("2d");for(var p=m.getImageData(0,0,q.width,q.height),r=p.data;n<l;++n)for(var u=(l-n-1)*(g-h)*4,v=n*b.fWidth,y=h;y<g;++y){var x=4*Math.round((b.fImgBuf[v+y]-k)/(f-k)*1E3);r[u++]=this.rgba[x++];r[u++]=this.rgba[x++];r[u++]=this.rgba[x++];r[u++]=this.rgba[x++]}m.putImageData(p,0,0);f=q.toDataURL();k=b.fConstRatio}else if(b.fPngBuf){q="";if("string"==typeof b.fPngBuf)q=b.fPngBuf;else for(f=0;f<b.fPngBuf.length;++f)q+=String.fromCharCode(0>
b.fPngBuf[f]?256+b.fPngBuf[f]:b.fPngBuf[f]);f="data:image/png;base64,"+(JSROOT.nodejs?require("btoa"):window.btoa)(q)}f&&this.createG(d?!0:!1).append("image").attr("href",f).attr("width",e.width).attr("height",e.height).attr("preserveAspectRatio",k?null:"none");return f&&this.isMainPainter()&&c&&d?this.drawColorPalette(this.options.Zscale,!0).then(function(){d.setAxesRanges(JSROOT.create("TAxis"),0,1,JSROOT.create("TAxis"),0,1,null,0,0);d.createXY({ndim:2,check_pad_range:!1});d.addInteractivity();
return a}):Promise.resolve(this)};A.prototype.canZoomInside=function(a,b,c){var d=this.getObject();return d&&d.fImgBuf?"x"==a&&3<(c-b)*d.fWidth||"y"==a&&3<(c-b)*d.fHeight?!0:!1:!1};A.prototype.drawColorPalette=function(a,b){var c=this;if(!this.isMainPainter())return Promise.resolve(null);if(!this.draw_palette){var d=JSROOT.create("TPave");JSROOT.extend(d,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:JSROOT.create("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});d.fAxis.fChopt=
"+";this.draw_palette=d;this.fPalette=!0}d=this.getPadPainter().findPainterFor(this.draw_palette);if(!a)return d&&(d.Enabled=!1,d.removeG()),Promise.resolve(null);a=this.getFramePainter();b&&a&&(b=this.draw_palette,b.fX2NDC=a.fX2NDC+.01+(b.fX2NDC-b.fX1NDC),b.fX1NDC=a.fX2NDC+.01,b.fY1NDC=a.fY1NDC,b.fY2NDC=a.fY2NDC);if(d)return d.Enabled=!0,d.drawPave("");var e=this.selectCurrentPad(this.getPadName());return JSROOT.draw(this.getDom(),this.draw_palette).then(function(a){c.selectCurrentPad(e);a.$secondary=
!0;a.redraw=function(){};return c})};A.prototype.toggleColz=function(){var a=this.getObject();a&&a.fPalette&&(this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!0))};A.prototype.redraw=function(a){var b=this.draw_g?this.draw_g.select("image"):null,c=this.getFramePainter();b&&!b.empty()&&"zoom"!==a&&c?b.attr("width",c.getFrameWidth()).attr("height",c.getFrameHeight()):this.drawImage()};A.prototype.clickButton=function(a){if(!this.isMainPainter())return!1;switch(a){case "ToggleColorZ":this.toggleColz();
break;default:return!1}return!0};A.prototype.fillToolbar=function(){var a=this.getPadPainter(),b=this.getObject();a&&b&&b.fPalette&&(a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.showPadButtons())};g.drawJSImage=function(a,b,c){a=new JSROOT.BasePainter(a);var d=a.selectDom();b=d.append("img").attr("src",b.fName).attr("title",b.fTitle||b.fName);c&&0<=c.indexOf("scale")?b.style("width","100%").style("height","100%"):c&&0<=c.indexOf("center")&&(d.style("position","relative"),b.attr("style",
"margin: 0; position: absolute;  top: 50%; left: 50%; transform: translate(-50%, -50%);"));a.setTopPainter();return Promise.resolve(a)};E.prototype=Object.create(JSROOT.ObjectPainter.prototype);E.prototype.redraw=function(){var a=this,b=this.getObject(),c=this.getPadPainter(),d=c.findPainterFor(b.fTopPad,"top_pad","TPad");d&&d.disablePadDrawing();var e=(d=c.findPainterFor(b.fUpperPad,"upper_pad","TPad"))?d.getMainPainter():null,k=d?d.getFramePainter():null,f=c.findPainterFor(b.fLowerPad,"lower_pad",
"TPad"),h=f?f.getMainPainter():null,g=f?f.getFramePainter():null,n=20;b=Promise.resolve(!0);d&&e&&k&&g&&!d._ratio_configured&&(d._ratio_configured=!0,e.options.Axis=0,n=e.getHisto().fYaxis.fLabelSize,1>n&&(n=Math.round(n*Math.min(d.getPadWidth(),d.getPadHeight()))),b=e.getHisto(),b.fXaxis.fLabelSize=0,b.fXaxis.fTitle="",b.fYaxis.fLabelSize=n,b.fYaxis.fTitleSize=n,d.getRootPad().fTicky=1,b=d.redrawPad().then(function(){k.o_zoom=k.zoom;k._ratio_low_fp=g;k.zoom=function(a,b,c,d,e,f){this._ratio_low_fp.o_zoom(a,
b);return this.o_zoom(a,b,c,d,e,f)};k.o_sizeChanged=k.sizeChanged;k.sizeChanged=function(){this.o_sizeChanged();this._ratio_low_fp.fX1NDC=this.fX1NDC;this._ratio_low_fp.fX2NDC=this.fX2NDC;this._ratio_low_fp.o_sizeChanged()};return!0}));return b.then(function(){if(f&&h&&g&&k&&!f._ratio_configured){f._ratio_configured=!0;h.options.Axis=0;var b=h.getHisto();b.fXaxis.fTitle="x";b.fXaxis.fLabelSize=n;b.fXaxis.fTitleSize=n;b.fYaxis.fLabelSize=n;b.fYaxis.fTitleSize=n;f.getRootPad().fTicky=1;f.forEachPainterInPad(function(a){"function"==
typeof a.testEditable&&a.testEditable(!1)});return g.zoom(k.scale_xmin,k.scale_xmax).then(function(){g.o_zoom=g.zoom;g._ratio_up_fp=k;g.zoom=function(a,b,c,d,e,f){this._ratio_up_fp.o_zoom(a,b);return this.o_zoom(a,b,c,d,e,f)};g.o_sizeChanged=g.sizeChanged;g.sizeChanged=function(){this.o_sizeChanged();this._ratio_up_fp.fX1NDC=this.fX1NDC;this._ratio_up_fp.fX2NDC=this.fX2NDC;this._ratio_up_fp.o_sizeChanged()};return a})}return a})};g.drawText=function(){var a=this,b=this.getObject(),c=this.getPadPainter(),
d=c.getPadWidth(),e=c.getPadHeight(),k=b.fX,f=b.fY,h=this.getColor(b.fTextColor),g=!1,n=1,l=b.fTextSize||.05,m=this.getFramePainter();b.TestBit(JSROOT.BIT(14))?this.isndc=!0:m&&!m.mode3d?(d=m.getFrameWidth(),e=m.getFrameHeight(),g="upper_layer"):c.getRootPad(!0)||(this.isndc=!0,k=f=.5,b.fTextAlign=22,h||(h="black"));this.createG(g);this.draw_g.attr("transform",null);this.pos_x=this.axisToSvg("x",k,this.isndc);this.pos_y=this.axisToSvg("y",f,this.isndc);c={align:b.fTextAlign,x:this.pos_x,y:this.pos_y,
text:b.fTitle,color:h,latex:0};b.fTextAngle&&(c.rotate=-b.fTextAngle);"TLatex"==b._typename?(c.latex=1,n=.9):"TMathText"==b._typename&&(c.latex=2,n=.8);this.startTextDrawing(b.fTextFont,Math.round(1<l?l:l*Math.min(d,e)*n));this.drawText(c);return this.finishTextDrawing().then(function(){return JSROOT.batch_mode?a:JSROOT.require(["interactive"]).then(function(b){a.pos_dx=a.pos_dy=0;a.moveDrag||(a.moveDrag=function(a,b){this.pos_dx+=a;this.pos_dy+=b;this.draw_g.attr("transform","translate("+this.pos_dx+
","+this.pos_dy+")")});a.moveEnd||(a.moveEnd=function(a){a||(a=this.getObject(),a.fX=this.svgToAxis("x",this.pos_x+this.pos_dx,this.isndc),a.fY=this.svgToAxis("y",this.pos_y+this.pos_dy,this.isndc),this.submitCanvExec("SetX("+a.fX+");;SetY("+a.fY+");;"))});b.addMoveHandler(a);return a})})};g.drawLine=function(){var a=this.getObject(),b=new JSROOT.TAttLineHandler(a),c=JSROOT.BIT(14);c=a.TestBit(c);this.createG();this.draw_g.append("svg:line").attr("x1",this.axisToSvg("x",a.fX1,c)).attr("y1",this.axisToSvg("y",
a.fY1,c)).attr("x2",this.axisToSvg("x",a.fX2,c)).attr("y2",this.axisToSvg("y",a.fY2,c)).call(b.func)};g.drawPolyLine=function(){this.createG();var a=this.getObject(),b=new JSROOT.TAttLineHandler(a),c=this.createAttFill(a),d=JSROOT.BIT(14),e=a.TestBit(d);d="";e=this.getAxisToSvgFunc(e);for(var k=0;k<=a.fLastPoint;++k)d+=(0<k?"L":"M")+e.x(a.fX[k])+","+e.y(a.fY[k]);"TPolyLine"!=a._typename&&c.setSolidColor("none");c.empty()||(d+="Z");this.draw_g.append("svg:path").attr("d",d).call(b.func).call(c.func)};
g.drawArrow=function(){var a=this,b=this.getObject(),c=JSROOT.BIT(14),d=b.fOption,e=this.getPadPainter().getPadRect();this.wsize=Math.max(3,Math.round(Math.max(e.width,e.height)*b.fArrowSize*.8));this.isndc=b.TestBit(c);this.angle2=b.fAngle/2/180*Math.PI;this.beg=this.mid=this.end=0;0==d.indexOf("<")&&(this.beg=0==d.indexOf("<|")?12:2);0<=d.indexOf("->-")?this.mid=1:0<=d.indexOf("-|>-")?this.mid=11:0<=d.indexOf("-<-")?this.mid=2:0<=d.indexOf("-<|-")&&(this.mid=12);c=d.lastIndexOf(">");e=d.lastIndexOf("|>");
d=d.length;0<=c&&c==d-1&&(this.end=0<=e&&e==d-2?11:1);this.createAttLine({attr:b});this.createG();this.x1=this.axisToSvg("x",b.fX1,this.isndc,!0);this.y1=this.axisToSvg("y",b.fY1,this.isndc,!0);this.x2=this.axisToSvg("x",b.fX2,this.isndc,!0);this.y2=this.axisToSvg("y",b.fY2,this.isndc,!0);this.rotate=function(a,b,c){var d=this.wsize*Math.cos(a);a=this.wsize*Math.sin(a);var e="";void 0!==b&&void 0!==c?e="M"+Math.round(b-d)+","+Math.round(c-a):(d=-d,a=-a);e+="l"+Math.round(d)+","+Math.round(a);b&&void 0===
c&&(e+="z");return e};this.createPath=function(){var a=Math.atan2(this.y2-this.y1,this.x2-this.x1),b=this.wsize*Math.cos(this.angle2),c=b*Math.cos(a);b*=Math.sin(a);var d="";this.beg&&(d+=this.rotate(a-Math.PI-this.angle2,this.x1,this.y1)+this.rotate(a-Math.PI+this.angle2,10<this.beg));2==this.mid%10&&(d+=this.rotate(a-Math.PI-this.angle2,(this.x1+this.x2-c)/2,(this.y1+this.y2-b)/2)+this.rotate(a-Math.PI+this.angle2,10<this.mid));1==this.mid%10&&(d+=this.rotate(a-this.angle2,(this.x1+this.x2+c)/2,
(this.y1+this.y2+b)/2)+this.rotate(a+this.angle2,10<this.mid));this.end&&(d+=this.rotate(a-this.angle2,this.x2,this.y2)+this.rotate(a+this.angle2,10<this.end));return"M"+Math.round(this.x1+(10<this.beg?c:0))+","+Math.round(this.y1+(10<this.beg?b:0))+"L"+Math.round(this.x2-(10<this.end?c:0))+","+Math.round(this.y2-(10<this.end?b:0))+d};d=this.draw_g.append("svg:path").attr("d",this.createPath()).call(this.lineatt.func);10<this.beg||10<this.end?(this.createAttFill({attr:b}),d.call(this.fillatt.func)):
d.style("fill","none");JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(b){a.moveStart||(a.moveStart=function(a,b){var c=Math.sqrt(Math.pow(this.x1-this.x2,2)+Math.pow(this.y1-this.y2,2)),d=Math.sqrt(Math.pow(a-this.x2,2)+Math.pow(b-this.y2,2))/c;this.side=.9<Math.sqrt(Math.pow(a-this.x1,2)+Math.pow(b-this.y1,2))/c?1:.9<d?-1:0});a.moveDrag||(a.moveDrag=function(a,b){1!=this.side&&(this.x1+=a,this.y1+=b);-1!=this.side&&(this.x2+=a,this.y2+=b);this.draw_g.select("path").attr("d",this.createPath())});
a.moveEnd||(a.moveEnd=function(a){if(!a){a=this.getObject();var b="";a.fX1=this.svgToAxis("x",this.x1,this.isndc);a.fX2=this.svgToAxis("x",this.x2,this.isndc);a.fY1=this.svgToAxis("y",this.y1,this.isndc);a.fY2=this.svgToAxis("y",this.y2,this.isndc);1!=this.side&&(b+="SetX1("+a.fX1+");;SetY1("+a.fY1+");;");-1!=this.side&&(b+="SetX2("+a.fX2+");;SetY2("+a.fY2+");;");this.submitCanvExec(b+"Notify();;")}});b.addMoveHandler(a)})};g.drawEllipse=function(){var a=this.getObject();this.createAttLine({attr:a});
this.createAttFill({attr:a});this.createG();var b=this.axisToSvg("x",a.fX1),c=this.axisToSvg("y",a.fY1),d=this.axisToSvg("x",a.fX1+a.fR1)-b,e=c-this.axisToSvg("y",a.fY1+a.fR2);if("TCrown"==a._typename)if(0>=a.fR1)d=this.axisToSvg("x",a.fX1+a.fR2)-b;else{var k=c-this.axisToSvg("y",a.fY1+a.fR1),f=this.axisToSvg("x",a.fX1+a.fR2)-b;b=this.draw_g.attr("transform","translate("+b+","+c+")").append("svg:path").call(this.lineatt.func).call(this.fillatt.func);if(0==a.fPhimin&&360==a.fPhimax)b.attr("d","M-"+
d+",0A"+d+","+k+",0,1,0,"+d+",0A"+d+","+k+",0,1,0,-"+d+",0M-"+f+",0A"+f+","+e+",0,1,0,"+f+",0A"+f+","+e+",0,1,0,-"+f+",0");else{c=180<=a.fPhimax-a.fPhimin?1:0;var h=a.fPhimin*Math.PI/180;a=a.fPhimax*Math.PI/180;b.attr("d","M"+Math.round(d*Math.cos(a))+","+Math.round(k*Math.sin(a))+"A"+d+","+k+",0,"+c+",0,"+Math.round(d*Math.cos(h))+","+Math.round(k*Math.sin(h))+"L"+Math.round(f*Math.cos(h))+","+Math.round(e*Math.sin(h))+"A"+f+","+e+",0,"+c+",1,"+Math.round(f*Math.cos(a))+","+Math.round(e*Math.sin(a))+
"Z")}return}if(0==a.fPhimin&&360==a.fPhimax&&0==a.fTheta)this.draw_g.append("svg:ellipse").attr("cx",b).attr("cy",c).attr("rx",d).attr("ry",e).call(this.lineatt.func).call(this.fillatt.func);else{f=Math.cos(a.fTheta*Math.PI/180);h=Math.sin(a.fTheta*Math.PI/180);var g=d*Math.cos(a.fPhimin*Math.PI/180),l=e*Math.sin(a.fPhimin*Math.PI/180);k=g*f-l*h;g=-g*h-l*f;var m=d*Math.cos(a.fPhimax*Math.PI/180),p=e*Math.sin(a.fPhimax*Math.PI/180);l=m*f-p*h;f=-m*h-p*f;this.draw_g.attr("transform","translate("+b+","+
c+")").append("svg:path").attr("d","M0,0L"+Math.round(k)+","+Math.round(g)+"A"+d+","+e+","+Math.round(-a.fTheta)+",1,0,"+Math.round(l)+","+Math.round(f)+"Z").call(this.lineatt.func).call(this.fillatt.func)}};g.drawPie=function(){var a=this.getObject();this.createG();var b=this.axisToSvg("x",a.fX),c=this.axisToSvg("y",a.fY),d=this.axisToSvg("x",a.fX+a.fRadius)-b,e=this.axisToSvg("y",a.fY+a.fRadius)-c;this.draw_g.attr("transform","translate("+b+","+c+")");b=a.fPieSlices.length;c=0;for(var g=a.fAngularOffset*
Math.PI/180,f=Math.round(d*Math.cos(g)),h=Math.round(e*Math.sin(g)),l=0;l<b;l++)c+=a.fPieSlices[l].fValue;for(l=0;l<b;l++){var n=a.fPieSlices[l],m=new JSROOT.TAttLineHandler({attr:n}),p=this.createAttFill(n);g+=n.fValue/c*2*Math.PI;n=Math.round(d*Math.cos(g));var q=Math.round(e*Math.sin(g));this.draw_g.append("svg:path").attr("d","M0,0L"+f+","+h+"A"+d+","+e+",0,0,0,"+n+","+q+"z").call(m.func).call(p.func);f=n;h=q}};g.drawBox=function(){var a=this.getObject(),b=0<=this.getDrawOpt().toUpperCase().indexOf("L"),
c=this.createAttLine(a),d=this.createAttFill(a);this.createG();var e=this.axisToSvg("x",a.fX1),g=this.axisToSvg("x",a.fX2),f=this.axisToSvg("y",a.fY1),h=this.axisToSvg("y",a.fY2),m=Math.min(e,g),n=Math.min(f,h);e=Math.abs(g-e);f=Math.abs(f-h);d.empty()||b||(c.color="none");this.draw_g.append("svg:rect").attr("x",m).attr("y",n).attr("width",e).attr("height",f).call(c.func).call(d.func);a.fBorderMode&&a.fBorderSize&&"none"!==d.color&&(h=c=a.fBorderSize,b="M"+m+","+n+"h"+e+"l"+-c+","+h+"h"+(2*c-e)+"v"+
(f-2*h)+"l"+-c+","+h+"z",m="M"+(m+e)+","+(n+f)+"v"+-f+"l"+-c+","+h+"v"+(f-2*h)+"h"+(2*c-e)+"l"+-c+","+h+"z",0>a.fBorderMode&&(a=b,b=m,m=a),this.draw_g.append("svg:path").attr("d",b).style("stroke","none").call(d.func).style("fill",l.rgb(d.color).brighter(.5).toString()),this.draw_g.append("svg:path").attr("d",m).style("stroke","none").call(d.func).style("fill",l.rgb(d.color).darker(.5).toString()))};g.drawMarker=function(){var a=this.getObject(),b=new JSROOT.TAttMarkerHandler(a),c=JSROOT.BIT(14),
d=a.TestBit(c);this.createG();c=this.axisToSvg("x",a.fX,d);a=this.axisToSvg("y",a.fY,d);(a=b.create(c,a))&&this.draw_g.append("svg:path").attr("d",a).call(b.func)};g.drawPolyMarker=function(){this.createG();for(var a=this.getObject(),b=new JSROOT.TAttMarkerHandler(a),c="",d=this.getAxisToSvgFunc(),e=0;e<a.fN;++e)c+=b.create(d.x(a.fX[e]),d.y(a.fY[e]));c&&this.draw_g.append("svg:path").attr("d",c).call(b.func)};g.drawWebPainting=function(a,b,c){a=new JSROOT.ObjectPainter(a,b,c);a.updateObject=function(a){if(!this.matchObjectType(a))return!1;
this.draw_object=a;return!0};a.ReadAttr=function(a,b){for(var c=0,d={_typename:"any"},e=0;e<b.length;++e){var g=a.indexOf(":",c+1);d[b[e]]=parseInt(a.substr(c+1,g>c?g-c-1:void 0));c=g}return d};a.redraw=function(){function a(a,b){if(b!=m&&(l&&(l.attr("d",p),p="",l=null,m="none"),b))switch(m=b,l=a.draw_g.append("svg:path"),b){case "f":l.call(a.fillatt.func).attr("stroke","none");break;case "l":l.call(a.lineatt.func).attr("fill","none");break;case "m":l.call(a.markeratt.func)}}var b=this.getObject(),
c=this.getAxisToSvgFunc();if(b&&b.fOper&&c){var f=0,h={},l=null,m="none",p="",u,q=b.fOper.split(";");this.createG();for(u=0;u<q.length;++u){var v=q[u][0];switch(v){case "z":this.createAttLine({attr:this.ReadAttr(q[u],["fLineColor","fLineStyle","fLineWidth"]),force:!0});a();continue;case "y":this.createAttFill({attr:this.ReadAttr(q[u],["fFillColor","fFillStyle"]),force:!0});a();continue;case "x":this.createAttMarker({attr:this.ReadAttr(q[u],["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0});
a();continue;case "o":h=this.ReadAttr(q[u],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]);0>h.fTextSize&&(h.fTextSize*=-.001);a();continue;case "r":case "b":a(this,"b"==v?"f":"l");v=c.x(b.fBuf[f++]);var r=c.y(b.fBuf[f++]);var x=c.x(b.fBuf[f++]);var y=c.y(b.fBuf[f++]);p+="M"+v+","+r+"h"+(x-v)+"v"+(y-r)+"h"+(v-x)+"z";continue;case "l":case "f":a(this,v);x=parseInt(q[u].substr(1));for(r=0;r<x;++r)p+=(0<r?"L":"M")+c.x(b.fBuf[f++])+","+c.y(b.fBuf[f++]);"f"==v&&(p+="Z");continue;case "m":a(this,
v);x=parseInt(q[u].substr(1));this.markeratt.resetPos();for(r=0;r<x;++r)p+=this.markeratt.create(c.x(b.fBuf[f++]),c.y(b.fBuf[f++]));continue;case "h":case "t":if(h.fTextSize){a();r=1<h.fTextSize?h.fTextSize:this.getPadPainter().getPadHeight()*h.fTextSize;x=this.draw_g.append("svg:g");this.startTextDrawing(h.fTextFont,r,x);y=h.fTextAngle;360<=y&&(y-=360*Math.floor(y/360));var A=q[u].substr(1);if("h"==v){v="";for(r=0;r<A.length;r+=2)v+=String.fromCharCode(parseInt(A.substr(r,2),16));A=v}this.drawText({align:h.fTextAlign,
x:c.x(b.fBuf[f++]),y:c.y(b.fBuf[f++]),rotate:-y,text:A,color:g.getColor(h.fTextColor),latex:0,draw_g:x});this.finishTextDrawing(x)}continue;default:console.log("unsupported operation "+v)}}a()}};a.addToPadPrimitives();a.redraw();return Promise.resolve(a)};g.drawRooPlot=function(a,b){function c(e){return e>=b._items.arr.length?d:JSROOT.draw(a,b._items.arr[e],b._items.opt[e]).then(function(){return c(e+1)})}var d;return JSROOT.draw(a,b._hist,"hist").then(function(a){d=a;return c(0)})};g.drawGraph=function(a,
b,c){var d=new m(a,b);d.decodeOptions(c);d.createBins();d.createStat();b=Promise.resolve();!d.getMainPainter()&&d.options.HOptions&&(b=d.createHistogram(),b=JSROOT.draw(a,b,d.options.HOptions).then(function(a){a&&(d.axes_draw=!0,d._own_histogram||(d.$primary=!0),a.$secondary=!0)}));return b.then(function(){d.addToPadPrimitives();return d.drawGraph()}).then(function(){return d.drawNextFunction(0)})};g.drawFunction=function(a,b,c){var d=new v(a,b);b=new JSROOT.DrawOptions(c);d.nosave=b.check("NOSAVE");
return JSROOT.require("math").then(function(){if(!d.getMainPainter())return JSROOT.draw(a,d.createDummyHisto(),"AXIS")}).then(function(){d.addToPadPrimitives();d.redraw();return d})};g.drawGraphTime=function(a,b,c){if(!b.fFrame)return console.error("Frame histogram not exists"),null;var d=new C(a,b);if(d.getMainPainter())return console.error("Cannot draw graph time on top of other histograms"),null;d.decodeOptions(c);!b.fFrame.fTitle&&b.fTitle&&(b.fFrame.fTitle=b.fTitle);d.selfid="grtime"+JSROOT._.id_counter++;
return JSROOT.draw(a,b.fFrame,"AXIS").then(function(){d.addToPadPrimitives();return d.startDrawing()})};g.drawGraphPolar=function(a,b,c){var d=new x(a,b);d.decodeOptions(c);if((c=d.getMainPainter())&&!c.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;var e=Promise.resolve(c);c||(b.fPolargram||(b.fPolargram=d.createPolargram()),e=JSROOT.draw(a,b.fPolargram,""));return e.then(function(){d.addToPadPrimitives();d.drawGraphPolar();return d})};g.drawEfficiency=
function(a,b,c){if(!b||!b.fTotalHistogram||0!=b.fTotalHistogram._typename.indexOf("TH1"))return null;var d=new B(a,b);d.options=c;b=JSROOT.create("TGraphAsymmErrors");b.fName="eff_graph";d.fillGraph(b,c);return JSROOT.draw(a,b,c).then(function(){d.addToPadPrimitives();return d})};g.drawGraphPolargram=function(a,b){var c=g.getElementMainPainter(a);if(c)return c.getObject()===b?c:Promise.reject(Error("Cannot superimpose TGraphPolargram with any other drawings"));var d=new p(a,b);return g.ensureTCanvas(d,
!1).then(function(){d.setAsMainPainter();d.redraw();return d})};g.drawASImage=function(a,b,c){var d=new A(a,b,c);d.decodeOptions(c);return g.ensureTCanvas(d,!1).then(function(){return d.drawImage()}).then(function(){d.fillToolbar();return d})};g.drawRatioPlot=function(a,b,c){var d=new E(a,b,c);return g.ensureTCanvas(d,!1).then(function(){return d.redraw()})};JSROOT.TF1Painter=v;JSROOT.TGraphPainter=m;JSROOT.TGraphPolarPainter=x;JSROOT.TMultiGraphPainter=y;JSROOT.TSplinePainter=u;JSROOT.TASImagePainter=
A;JSROOT.TRatioPlotPainter=E;return JSROOT});
