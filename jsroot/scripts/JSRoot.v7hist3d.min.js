var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(n,b,A){n!=Array.prototype&&n!=Object.prototype&&(n[b]=A.value)};$jscomp.getGlobal=function(n){return"undefined"!=typeof window&&window===n?n:"undefined"!=typeof global&&null!=global?global:n};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(n,b,A,P){if(b){A=$jscomp.global;n=n.split(".");for(P=0;P<n.length-1;P++){var B=n[P];B in A||(A[B]={});A=A[B]}n=n[n.length-1];P=A[n];b=b(P);b!=P&&null!=b&&$jscomp.defineProperty(A,n,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Number.isFinite",function(n){return n?n:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(n){return n?n:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6","es3");$jscomp.arrayIteratorImpl=function(n){var b=0;return function(){return b<n.length?{done:!1,value:n[b++]}:{done:!0}}};$jscomp.arrayIterator=function(n){return{next:$jscomp.arrayIteratorImpl(n)}};$jscomp.makeIterator=function(n){var b="undefined"!=typeof Symbol&&Symbol.iterator&&n[Symbol.iterator];return b?b.call(n):$jscomp.arrayIterator(n)};
$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(n){function b(){this.batch_=null}function A(b){return b instanceof B?b:new B(function(a,d){a(b)})}if(n&&!$jscomp.FORCE_POLYFILL_PROMISE)return n;b.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(b)};var P=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(b){P(b,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var d=b[a];b[a]=null;try{d()}catch(c){this.asyncThrow_(c)}}}this.batch_=null};b.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var B=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{b(a.resolve,a.reject)}catch(d){a.reject(d)}};B.prototype.createResolveAndReject_=function(){function b(c){return function(b){d||(d=!0,c.call(a,b))}}var a=this,d=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};B.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof B)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var a=null!=b;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};B.prototype.resolveToNonPromiseObj_=function(b){var a=void 0;try{a=b.then}catch(d){this.reject_(d);return}"function"==typeof a?
this.settleSameAsThenable_(a,b):this.fulfill_(b)};B.prototype.reject_=function(b){this.settle_(2,b)};B.prototype.fulfill_=function(b){this.settle_(1,b)};B.prototype.settle_=function(b,a){if(0!=this.state_)throw Error("Cannot settle("+b+", "+a+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=a;this.executeOnSettledCallbacks_()};B.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)ia.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var ia=new b;B.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};B.prototype.settleSameAsThenable_=function(b,a){var d=this.createResolveAndReject_();try{b.call(a,d.resolve,d.reject)}catch(c){d.reject(c)}};B.prototype.then=function(b,a){function d(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(e){h(e)}}:b}var c,h,F=new B(function(a,b){c=a;h=b});this.callWhenSettled_(d(b,c),d(a,h));
return F};B.prototype.catch=function(b){return this.then(void 0,b)};B.prototype.callWhenSettled_=function(b,a){function d(){switch(c.state_){case 1:b(c.result_);break;case 2:a(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?ia.asyncExecute(d):this.onSettledCallbacks_.push(d)};B.resolve=A;B.reject=function(b){return new B(function(a,d){d(b)})};B.race=function(b){return new B(function(a,d){for(var c=$jscomp.makeIterator(b),h=c.next();!h.done;h=
c.next())A(h.value).callWhenSettled_(a,d)})};B.all=function(b){var a=$jscomp.makeIterator(b),d=a.next();return d.done?A([]):new B(function(b,h){function c(a){return function(d){w[a]=d;r--;0==r&&b(w)}}var w=[],r=0;do w.push(void 0),r++,A(d.value).callWhenSettled_(c(w.length-1),h),d=a.next();while(!d.done)})};return B},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(n,b){this.$jscomp$symbol$id_=n;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function n(A){if(this instanceof n)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(A||"")+"_"+b++,A)}var b=0;return n}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var n=$jscomp.global.Symbol.iterator;n||(n=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[n]&&$jscomp.defineProperty(Array.prototype,n,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var n=$jscomp.global.Symbol.asyncIterator;n||(n=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(n){$jscomp.initSymbolIterator();n={next:n};n[$jscomp.global.Symbol.iterator]=function(){return this};return n};
$jscomp.iteratorFromArray=function(n,b){$jscomp.initSymbolIterator();n instanceof String&&(n+="");var A=0,P={next:function(){if(A<n.length){var B=A++;return{value:b(B,n[B]),done:!1}}P.next=function(){return{done:!0,value:void 0}};return P.next()}};P[Symbol.iterator]=function(){return P};return P};$jscomp.polyfill("Array.prototype.entries",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(b,A){return[b,A]})}},"es6","es3");
JSROOT.define(["d3","base3d","painter","v7hist"],function(n,b,A){function P(a,b,c,h){function d(a,b){a<=m&&(a+=4);return a>m&&a<m+b}if(b&&b.children)for(var w=0;w<b.children.length;++w){var r=b.children[w];if(r.axis_draw)break;r=void 0}if(r)if(a){c=c?!0:!1;h=h?!0:!1;var m=1;a=a.position;0>a.x&&0<=a.y&&(m=2);0<=a.x&&0<=a.y&&(m=3);0<=a.x&&0>a.y&&(m=4);for(a=0;a<r.children.length;++a)if(b=r.children[a],b.grid)b.visible=h&&d(b.grid,3);else if(b.zid)b.visible=d(b.zid,2);else if(b.xyid)b.visible=d(b.xyid,
3);else if(b.xyboxid){w=5;var e=0;h&&!c?(w=3,e=-2):c&&!h?w=3:c||h||(w=b.bottom?3:0);b.visible=d(b.xyboxid+e,w);!b.visible&&b.bottom&&h&&(b.visible=d(b.xyboxid,3))}else b.zboxid&&(w=2,e=0,c&&h?w=5:h&&!c?w=4:!h&&c&&(e=-2,w=4),b.visible=d(b.zboxid+e,w))}else b.remove(r)}function B(a){var b=Math.max(.75*a.size_xy3d,a.size_z3d);a.camera.position.set(-1.6*b,-3.5*b,1.4*a.size_z3d);a.camera.lookAt(a.lookat)}function ia(a,d){if(!a)return null;d||(d="line_");var c=a.v7EvalColor(d+"color","black"),h=a.v7EvalAttr(d+
"style",0);a=a.v7EvalAttr(d+"width",1);c=(h=(h=h?A.root_line_styles[parseInt(h)]:"")?h.split(","):[])&&2<=h.length?new b.LineDashedMaterial({color:c,dashSize:parseInt(h[0]),gapSize:parseInt(h[1])}):new b.LineBasicMaterial({color:c});void 0!==a&&1<a&&(c.linewidth=parseInt(a));return c}function Q(a,b){JSROOT.v7.RHistPainter.call(this,a,b);this.mode3d=!0}JSROOT.v7.RFramePainter.prototype.create3DScene=function(a){if(-1===a)this.mode3d&&(this.clear3dCanvas?(P(null,this.toplevel),this.clear3dCanvas(),
A.disposeThreejsObject(this.scene),this.control&&this.control.cleanup(),this.renderer&&(this.renderer.dispose&&this.renderer.dispose(),this.renderer.forceContextLoss&&this.renderer.forceContextLoss()),delete this.size_xy3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,delete this.toplevel,delete this.camera,delete this.pointLight,delete this.renderer,delete this.control,this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.mode3d=!1):console.error("Strange, why mode3d is configured!!!!",
this.mode3d));else if(this.mode3d=!0,"toplevel"in this)this.scene.remove(this.toplevel),A.disposeThreejsObject(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip(),a=new b.Object3D,this.scene.add(a),this.toplevel=a,this.resize3D();else{A.assign3DHandler(this);a=A.getRender3DKind(a);var d=this.getSizeFor3d(void 0,a);this.size_z3d=100;this.size_xy3d=10<d.height&&10<d.width?Math.round(d.width/d.height*this.size_z3d):this.size_z3d;this.scene=new b.Scene;
this.toplevel=new b.Object3D;this.scene.add(this.toplevel);this.scene_width=d.width;this.scene_height=d.height;this.camera=new b.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size_z3d);this.camera_Theta=this.camera_Phi=30;this.pointLight=new b.PointLight(16777215,1);this.camera.add(this.pointLight);this.pointLight.position.set(this.size_xy3d/2,this.size_xy3d/2,this.size_z3d/2);this.lookat=new b.Vector3(0,0,.8*this.size_z3d);this.camera.up=new b.Vector3(0,0,1);this.scene.add(this.camera);
B(this);this.renderer=A.createRender3D(this.scene_width,this.scene_height,a);this.webgl=a===JSROOT.constants.Render3D.WebGL;this.add3dCanvas(d,this.renderer.jsroot_dom,this.webgl);this.first_render_tm=0;this.enable_highlight=!1;if(!JSROOT.batch_mode&&this.webgl){this.control=A.createOrbitControl(this,this.camera,this.scene,this.renderer,this.lookat);var c=this,h=this.getMainPainter();this.control.ProcessMouseMove=function(a){for(var b=null,d=null,h=null,e=0;e<a.length;++e)if(a[e].object.tooltip){if(b=
a[e].object.tooltip(a[e])){d=a[e].object;break}}else a[e].object.zoom&&!h&&(h=a[e].object);b&&!b.use_itself&&(a=1E-4*c.size_xy3d,e=1E-4*c.size_z3d,(b.x1>b.x2||b.y1>b.y2||b.z1>b.z2)&&console.warn("check 3D hints coordinates"),b.x1-=a,b.x2+=a,b.y1-=a,b.y2+=a,b.z1-=e,b.z2+=e);c.highlightBin3D(b,d);return!b&&h&&c.Get3DZoomCoord?(d=h.GlobalIntersect(this.raycaster),b=h.zoom,d=c.Get3DZoomCoord(d,b),"z"===b&&h.use_y_for_z&&(b="y"),h={name:b,title:"RAxis",line:"any info",only_status:!0},h.line=b+" : "+c.axisAsText(b,
d),h):b&&b.lines?b:""};this.control.ProcessMouseLeave=function(){c.highlightBin3D(null)};this.control.contextMenu=function(a,b){var c="painter",d=h;if(b)for(var e=0;e<b.length;++e){var w=b[e].object;if(w.zoom){c=w.zoom;d=null;break}if(w.painter&&"function"===typeof w.painter.fillContextMenu){d=w.painter;break}}(b=h.getFramePainter())&&b.showContextMenu&&b.showContextMenu(c,a,d)}}}};JSROOT.v7.RFramePainter.prototype.render3D=function(a){var d=this;if(-1111===a){var c=JSROOT._.get_document();a=b.CreateSVGRenderer(!1,
0,c);a.setSize(this.scene_width,this.scene_height);a.render(this.scene,this.camera);return a.makeOuterHTML?(c=c.createElement("div"),c.innerHTML=a.makeOuterHTML(),c.childNodes[0]):a.domElement}void 0===a&&(a=5);0<a&&this.webgl&&JSROOT.batch_mode?this.render_tmout||(this.render_tmout=setTimeout(function(){return d.render3D(0)},a)):(this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.renderer&&(A.beforeRender3D(this.renderer),a=new Date,this.opt3d||(this.opt3d={FrontBox:!0,
BackBox:!0}),P(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),this.renderer.render(this.scene,this.camera),A.afterRender3D(this.renderer),c=new Date,0===this.first_render_tm&&(this.first_render_tm=c.getTime()-a.getTime(),this.enable_highlight=1200>this.first_render_tm&&this.isTooltipAllowed(),console.log("three.js r"+b.REVISION+", first render tm = "+this.first_render_tm))))};JSROOT.v7.RFramePainter.prototype.resize3D=function(){var a=this.getSizeFor3d(this.access3dKind());this.apply3dSize(a);
if(this.scene_width===a.width&&this.scene_height===a.height||10>a.width||10>a.height)return!1;this.scene_width=a.width;this.scene_height=a.height;this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);this.renderer.setJSROOTSize&&this.renderer.setJSROOTSize(this.scene_width,this.scene_height);return!0};JSROOT.v7.RFramePainter.prototype.highlightBin3D=function(a,d){var c=!1,h=null,F=!0,w=!a||void 0===a.x1||
!this.enable_highlight,r=this.getMainPainter();!r||r.provideUserTooltip&&r.hasUserTooltip()||(r=null);this.tooltip_selfmesh&&(F=this.tooltip_selfmesh!==d,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,c=!0);this.tooltip_mesh&&(h=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,c=!0);if(w)c&&this.render3D(),c&&r&&r.provideUserTooltip(null);else{if(a.use_itself)d.save_color=d.material.color,d.material.color=new b.Color(a.color),
this.tooltip_selfmesh=d,c=F;else{c=!0;d=A.Box3D.Indexes;F=A.Box3D.Normals;w=A.Box3D.Vertices;var m=new b.Color(a.color?a.color:16711680),e=a.opacity||1;if(h){var z=h.geometry.attributes.position.array;h.geometry.attributes.position.needsUpdate=!0;h.material.color=m;h.material.opacity=e}else{z=new Float32Array(3*d.length);var k=new Float32Array(3*d.length);h=new b.BufferGeometry;h.setAttribute("position",new b.BufferAttribute(z,3));h.setAttribute("normal",new b.BufferAttribute(k,3));m=new b.MeshBasicMaterial({color:m,
opacity:e,flatShading:!0});h=new b.Mesh(h,m)}a.x1===a.x2&&console.warn("same tip X",a.x1,a.x2);a.y1===a.y2&&console.warn("same tip Y",a.y1,a.y2);a.z1===a.z2&&(a.z2=a.z1+1E-4);m=0;for(e=-3;m<d.length;++m){var u=w[d[m]];z[3*m]=a.x1+u.x*(a.x2-a.x1);z[3*m+1]=a.y1+u.y*(a.y2-a.y1);z[3*m+2]=a.z1+u.z*(a.z2-a.z1);k&&(0===m%6&&(e+=3),k[3*m]=F[e],k[3*m+1]=F[e+1],k[3*m+2]=F[e+2])}this.tooltip_mesh=h;this.toplevel.add(h)}c&&this.render3D();c&&a.$painter&&"function"==typeof a.$painter.redrawProjection&&a.$painter.redrawProjection(a.ix-
1,a.ix,a.iy-1,a.iy);c&&r&&r.getObject()&&r.provideUserTooltip({obj:r.getObject(),name:r.getObject().fName,bin:a.bin,cont:a.value,binx:a.ix,biny:a.iy,binz:a.iz,grx:(a.x1+a.x2)/2,gry:(a.y1+a.y2)/2,grz:(a.z1+a.z2)/2})}};JSROOT.v7.RFramePainter.prototype.set3DOptions=function(a){this.opt3d=a};JSROOT.v7.RFramePainter.prototype.drawXYZ=function(a,d){function c(a,c,d){var f=new b.Geometry;"z"===a?f.vertices.push(new b.Vector3(0,0,0),new b.Vector3(4*L,0,0),new b.Vector3(4*L,0,2*c),new b.Vector3(0,0,2*c)):
f.vertices.push(new b.Vector3(-c,0,0),new b.Vector3(c,0,0),new b.Vector3(c,4*-L,0),new b.Vector3(-c,4*-L,0));f.faces.push(new b.Face3(0,2,1));f.faces.push(new b.Face3(0,3,2));f.computeFaceNormals();var e=new b.MeshBasicMaterial({transparent:!0,vertexColors:b.NoColors,side:b.DoubleSide,opacity:0});f=new b.Mesh(f,e);f.zoom=a;f.size_3d=c;f.use_y_for_z=d;"y"==a&&f.rotateZ(Math.PI/2).rotateX(Math.PI);f.GlobalIntersect=function(a){var c=new b.Plane,d=this.geometry;if(d&&d.vertices&&(c.setFromCoplanarPoints(d.vertices[0],
d.vertices[1],d.vertices[2]),c.applyMatrix4(this.matrixWorld),d=a.ray.origin.clone(),a=d.clone().addScaledVector(a.ray.direction,1E10),c=c.intersectLine(new b.Line3(d,a),new b.Vector3)))return a=-this.size_3d,d=this.size_3d,"z"===this.zoom&&(a=0,d=2*this.size_3d),c[this.zoom]<a?c[this.zoom]=a:c[this.zoom]>d&&(c[this.zoom]=d),c};f.ShowSelection=function(a,c){var d=this.children?this.children[0]:null,f=this.zoom;if(!a||!c)return d&&(this.remove(d),A.disposeThreejsObject(d)),d;if(d)var e=d.geometry;
else e=this.geometry.clone(),"z"===f?e.vertices[1].x=e.vertices[2].x=L:e.vertices[2].y=e.vertices[3].y=-L,d=new b.Mesh(e,new b.MeshBasicMaterial({color:65280,side:b.DoubleSide})),this.add(d);"z"==f?(e.vertices[0].z=e.vertices[1].z=a[f],e.vertices[2].z=e.vertices[3].z=c[f]):(e.vertices[0].x=e.vertices[3].x=a[f],e.vertices[1].x=e.vertices[2].x=c[f]);e.computeFaceNormals();e.verticesNeedUpdate=!0;return e.normalsNeedUpdate=!0};return f}d||(d={});var h=-this.size_xy3d,F=this.size_xy3d,w=-this.size_xy3d,
r=this.size_xy3d,m=0,e=2*this.size_z3d,z=Math.round(.05*this.size_z3d),k=this.xmin,u=this.xmax,x=this.ymin,f=this.ymax,t=this.zmin,p=this.zmax,C=!1,g=!1;this.size_z3d||(h=this.xmin,F=this.xmax,w=this.ymin,r=this.ymax,m=this.zmin,e=this.zmax,z=.05*(e-m));"zoom_xmin"in this&&"zoom_xmax"in this&&this.zoom_xmin!==this.zoom_xmax&&(k=this.zoom_xmin,u=this.zoom_xmax);"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(x=this.zoom_ymin,f=this.zoom_ymax,C=!0);"zoom_zmin"in this&&"zoom_zmax"in
this&&this.zoom_zmin!==this.zoom_zmax&&(t=this.zoom_zmin,p=this.zoom_zmax,g=!0);d.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,t=x,p=f,g=C,x=0,f=1);this.lego_zmin=t;this.lego_zmax=p;void 0===d.zmult||g||(p*=d.zmult);this.x_handle=new JSROOT.v7.RAxisPainter(this.getDom(),this,this.xaxis,"x_");this.x_handle.setPadName(this.getPadName());this.x_handle.snapid=this.snapid;this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,k,u,!1,[h,F]);this.x_handle.assignFrameMembers(this,"x");this.y_handle=
new JSROOT.v7.RAxisPainter(this.getDom(),this,this.yaxis,"y_");this.y_handle.setPadName(this.getPadName());this.y_handle.snapid=this.snapid;this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,x,f,!1,[w,r]);this.y_handle.assignFrameMembers(this,"y");this.z_handle=new JSROOT.v7.RAxisPainter(this.getDom(),this,this.zaxis,"z_");this.z_handle.setPadName(this.getPadName());this.z_handle.snapid=this.snapid;this.z_handle.configureAxis("zaxis",this.zmin,this.zmax,t,p,!1,[m,e]);this.z_handle.assignFrameMembers(this,
"z");var l=new b.MeshBasicMaterial({color:0});k=new b.LineBasicMaterial({color:0});var L=.5*z;x=[];var q=1;p=this.x_handle.createTicks(!1,!0);t=this.y_handle.createTicks(!1,!0);f=this.z_handle.createTicks(!1,!0);u=new b.Object3D;u.axis_draw=!0;a.add(u);a=[];var E=0;for(C=this.xaxis;p.next();){g=p.grpos;var v=1===p.kind,y=this.x_handle.format(p.tick,2);p.last_major()?C&&C.fTitle||(y="x"):null===y&&(v=!1,y="");if(v&&y&&0<y.length){y=new b.TextGeometry(y,{font:JSROOT.threejs_font_helvetiker_regular,
size:z,height:0,curveSegments:5});y.computeBoundingBox();var n=y.boundingBox.max.x-y.boundingBox.min.x,J=y.boundingBox.max.y-y.boundingBox.min.y;y.center=!0;E=Math.max(E,J);y.grx=g;x.push(y);p.last_major()||(J=p.next_major_grpos()-g,0<n&&(q=Math.min(q,.9*J/n)),this.x_handle.isCenteredLabels()&&(y.grx+=J/2))}a.push(g,0,0,g,v?-L:.6*-L,0)}C&&C.fTitle&&(p=new b.TextGeometry(C.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,size:z,height:0,curveSegments:5}),p.computeBoundingBox(),p.center=!1,p.gry=
2,p.grx=(h+F)/2,x.push(p));this.Get3DZoomCoord=function(a,b){a=a[b];var c=this["scale_"+b+"min"],d=this["scale_"+b+"max"];a="z"===b?a/2/this.size_z3d:(a+this.size_xy3d)/2/this.size_xy3d;return a=this["log"+b]?Math.exp(Math.log(c)+a*(Math.log(d)-Math.log(c))):c+a*(d-c)};var K=new b.Object3D;K.position.set(0,w,m);K.rotation.x=.25*Math.PI;K.xyid=2;a=A.createLineSegments(a,k);K.add(a);x.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.grx-c/2:F-c;c=new b.Matrix4;c.set(q,
0,0,d,0,q,0,(-E*q-1.5*L)*(a.gry||1),0,0,1,0,0,0,0,1);a=new b.Mesh(a,l);a.applyMatrix4(c);K.add(a)});d.zoom&&K.add(c("x",this.size_xy3d));u.add(K);K=new b.Object3D;K.position.set(0,r,m);K.rotation.x=.75*Math.PI;K.add(new b.LineSegments(a.geometry,k));x.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.grx+c/2:F;c=new b.Matrix4;c.set(-q,0,0,d,0,q,0,(-E*q-1.5*L)*(a.gry||1),0,0,-1,0,0,0,0,1);a=new b.Mesh(a,l);a.applyMatrix4(c);K.add(a)});K.xyid=4;d.zoom&&K.add(c("x",this.size_xy3d));
u.add(K);x=[];q=1;E=0;a=[];for(p=this.yaxis;t.next();)C=t.grpos,g=1===t.kind,v=this.y_handle.format(t.tick,2),t.last_major()?p&&p.fTitle||(v="y"):null===v&&(g=!1,v=""),g&&(v=new b.TextGeometry(v,{font:JSROOT.threejs_font_helvetiker_regular,size:z,height:0,curveSegments:5}),v.computeBoundingBox(),y=v.boundingBox.max.x-v.boundingBox.min.x,n=v.boundingBox.max.y-v.boundingBox.min.y,v.center=!0,E=Math.max(E,n),v.gry=C,x.push(v),t.last_major()||(n=t.next_major_grpos()-C,0<y&&(q=Math.min(q,.9*n/y)),this.y_handle.isCenteredLabels()&&
(v.gry+=n/2))),a.push(0,C,0,g?-L:.6*-L,C,0);p&&p.fTitle&&(t=new b.TextGeometry(p.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,size:z,height:0,curveSegments:5}),t.computeBoundingBox(),t.center=!1,t.grx=2,t.gry=(w+r)/2,x.push(t));if(!d.use_y_for_z){a=A.createLineSegments(a,k);var M=new b.Object3D;M.position.set(h,0,m);M.rotation.y=-.25*Math.PI;M.add(a);x.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.gry+c/2:r;c=new b.Matrix4;c.set(0,q,0,(-E*q-1.5*L)*(a.grx||1),
-q,0,0,d,0,0,1,0,0,0,0,1);a=new b.Mesh(a,l);a.applyMatrix4(c);M.add(a)});M.xyid=3;d.zoom&&M.add(c("y",this.size_xy3d));u.add(M);M=new b.Object3D;M.position.set(F,0,m);M.rotation.y=-.75*Math.PI;M.add(new b.LineSegments(a.geometry,k));x.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.gry-c/2:r-c;c=new b.Matrix4;c.set(0,q,0,(-E*q-1.5*L)*(a.grx||1),q,0,0,d,0,0,-1,0,0,0,0,1);a=new b.Mesh(a,l);a.applyMatrix4(c);M.add(a)});M.xyid=1;d.zoom&&M.add(c("y",this.size_xy3d));u.add(M)}x=
[];q=1;a=[];v=C=g=null;t=this.zaxis;p=0;this.size_z3d&&(g=[],C=[]);for(;f.next();){y=f.grpos;n=1==f.kind;J=this.z_handle.format(f.tick,2);null===J&&(n=!1,J="");if(n&&J){J=new b.TextGeometry(J,{font:JSROOT.threejs_font_helvetiker_regular,size:z,height:0,curveSegments:5});J.computeBoundingBox();var R=J.boundingBox.max.x-J.boundingBox.min.x,N=J.boundingBox.max.y-J.boundingBox.min.y;J.translate(-R,-N/2,0);J.grz=y;x.push(J);null!==v&&0<N&&(q=Math.min(q,.9*(y-v)/N));p=Math.max(p,R);v=y}g&&n&&g.push(h,0,
y,F,0,y);C&&n&&C.push(0,w,y,0,r,y);a.push(0,0,y,n?L:.6*L,0,y)}g&&0<g.length&&(f=new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),g=A.createLineSegments(g,f),g.position.set(0,r,0),g.grid=2,g.visible=!1,u.add(g),f=new b.LineSegments(g.geometry,f),f.position.set(0,w,0),f.grid=4,f.visible=!1,u.add(f));C&&0<C.length&&(f=new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),C=A.createLineSegments(C,f),C.position.set(F,0,0),C.grid=3,C.visible=!1,u.add(C),f=new b.LineSegments(C.geometry,f),f.position.set(h,
0,0),f.grid=1,f.visible=!1,u.add(f));var H=[];a=A.createLineSegments(a,k);for(f={$jscomp$loop$prop$n$61:0};4>f.$jscomp$loop$prop$n$61;f={$jscomp$loop$prop$n$61:f.$jscomp$loop$prop$n$61},++f.$jscomp$loop$prop$n$61)H.push(new b.Object3D),x.forEach(function(a){return function(c){var d=new b.Matrix4;d.set(-q,0,0,2*L,0,0,1,0,0,q,0,c.grz);c=new b.Mesh(c,l);c.applyMatrix4(d);H[a.$jscomp$loop$prop$n$61].add(c)}}(f)),t&&t.fTitle&&(g=new b.TextGeometry(t.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,
size:z,height:0,curveSegments:5}),g.computeBoundingBox(),v=e-(g.boundingBox.max.x-g.boundingBox.min.x),g.rotateZ(Math.PI/2),C=new b.Matrix4,C.set(-q,0,0,3*L+p,0,0,1,0,0,q,0,v),g=new b.Mesh(g,l),g.applyMatrix4(C),H[f.$jscomp$loop$prop$n$61].add(g)),H[f.$jscomp$loop$prop$n$61].add(0==f.$jscomp$loop$prop$n$61?a:new b.LineSegments(a.geometry,k)),d.zoom&&H[f.$jscomp$loop$prop$n$61].add(c("z",this.size_z3d,d.use_y_for_z)),H[f.$jscomp$loop$prop$n$61].zid=f.$jscomp$loop$prop$n$61+2,u.add(H[f.$jscomp$loop$prop$n$61]);
H[0].position.set(h,r,0);H[0].rotation.z=.75*Math.PI;H[1].position.set(F,r,0);H[1].rotation.z=.25*Math.PI;H[2].position.set(F,w,0);H[2].rotation.z=-.25*Math.PI;H[3].position.set(h,w,0);H[3].rotation.z=-.75*Math.PI;if(0!==this.size_z3d){d=A.createLineSegments([h,0,0,F,0,0],k,null,!0);for(z=0;2>z;++z)x=new b.LineSegments(d,k),x.position.set(0,w,0===z?m:e),x.xyboxid=2,x.bottom=0==z,u.add(x),x=new b.LineSegments(d,k),x.position.set(0,r,0===z?m:e),x.xyboxid=4,x.bottom=0==z,u.add(x);w=A.createLineSegments([0,
w,0,0,r,0],k,null,!0);for(d=0;2>d;++d)z=new b.LineSegments(w,k),z.position.set(h,0,0===d?m:e),z.xyboxid=3,z.bottom=0==d,u.add(z),z=new b.LineSegments(w,k),z.position.set(F,0,0===d?m:e),z.xyboxid=1,z.bottom=0==d,u.add(z);h=A.createLineSegments([0,0,m,0,0,e],k,null,!0);for(m=0;4>m;++m)e=new b.LineSegments(h,k),e.zboxid=H[m].zid,e.position.copy(H[m].position),u.add(e)}};JSROOT.v7.RHistPainter.prototype.drawLego=function(){var a=this;if(this.draw_content){var d=A.Box3D.Vertices,c=A.Box3D.Indexes,h=A.Box3D.Normals,
F=A.Box3D.Segments,w=[0,1,1,2,2,3,3,0],r=[new b.Vector3(0,0,0),new b.Vector3(0,1,0),new b.Vector3(1,1,0),new b.Vector3(1,0,0)],m=this.getFramePainter(),e=m.z_handle.gr.domain()[0],z=m.z_handle.gr.domain()[1],k=this.prepareDraw({rounding:!1,use3d:!0,extra:1}),u=k.i1,x=k.i2,f=k.j1,t=k.j2,p=k.stepi,C=k.stepj,g,l,L,q,E,v,y,B=this.getHisto(),J=B?B.$baseh:null,K=11===this.options.Lego||13===this.options.Lego;if(!(u>=x||f>=t)){var M=function(b,c,d){v=B.getBinContent(b+1,c+1);E=J?J.getBinContent(b+1,c+1):
!1!==a.options.BaseLine?a.options.BaseLine:a.options.Zero?e:0;v<E&&(b=E,E=v,v=b);if(E>=O||v<T)return!1;y=v===T||E>=v;return!y||0<d?!0:B.$baseh?!1:a.options.Zero||0<e?!0:a._show_empty_bins},R=65535>B.getBin(x,t),N=[e,z],H=null;if(12===this.options.Lego||14===this.options.Lego)H=m.getHistPalette(),this.createContour(m,H,{full_z_range:!0}),N=H.getContour(),e=N[0],z=N[N.length-1];for(var I=0;I<N.length-1;++I){var T=N[I];var O=N[I+1];H&&I==N.length-2&&O<z&&(O=z);var U=0,G=0,D=q=0,P=m.grz(T),Q=m.grz(O);
for(g=u;g<x;g+=p)for(l=f;l<t;l+=C)if(M(g,l,I)){var Y=!y&&0<I;var da=!y&&v>O&&I<N.length-2;q+=y?12:c.length;Y&&(q-=6);da&&(q-=6);K&&!y&&(q-=12,D+=12)}var aa=new Float32Array(3*q),ea=new Float32Array(3*q),Z=R?new Uint16Array(q/3):new Uint32Array(q/3),S=L=null,V=null,X=0,W=0,ba=Y=void 0,fa=void 0;0<D&&(L=new Float32Array(3*D),S=new Float32Array(3*D),V=R?new Uint16Array(D/3):new Uint32Array(D/3));for(g=u;g<x;g+=p){q=k.grx[g]+k.xbar1*(k.grx[g+p]-k.grx[g]);var ca=k.grx[g]+k.xbar2*(k.grx[g+p]-k.grx[g]);
for(l=f;l<t;l+=C)if(M(g,l,I)){Y=!y&&0<I;da=!y&&v>O&&I<N.length-2;var ha=k.gry[l]+k.ybar1*(k.gry[l+C]-k.gry[l]);var ja=k.gry[l]+k.ybar2*(k.gry[l+C]-k.gry[l]);U=E<=T?P:m.grz(E);G=v>O?Q:m.grz(v);ba=fa=0;y&&(fa+=12,ba+=24);var ka=c.length,la=B.getBin(g+1,l+1);for(Y&&(ka-=6);ba<ka;)Y=d[c[ba]],K&&12>ba?(L[W]=q+Y.x*(ca-q),L[W+1]=ha+Y.y*(ja-ha),L[W+2]=U+Y.z*(G-U),S[W]=h[fa],S[W+1]=h[fa+1],S[W+2]=h[fa+2],0===W%9&&(V[W/9]=la),W+=3):(aa[X]=q+Y.x*(ca-q),aa[X+1]=ha+Y.y*(ja-ha),aa[X+2]=U+Y.z*(G-U),ea[X]=h[fa],
ea[X+1]=h[fa+1],ea[X+2]=h[fa+2],0===X%9&&(Z[X/9]=la),X+=3),++ba,0===ba%6&&(fa+=3,da&&ba===c.length-12&&(ba+=6,fa+=3))}}g=new b.BufferGeometry;g.setAttribute("position",new b.BufferAttribute(aa,3));g.setAttribute("normal",new b.BufferAttribute(ea,3));l=3;q=this.getColor(l);if(H)q=H.getColor(I);else if(1===this.options.Lego||2>l)l=1,q="white";ca=new b.MeshBasicMaterial({color:q,flatShading:!0});g=new b.Mesh(g,ca);g.face_to_bins_index=Z;g.painter=this;g.zmin=e;g.zmax=z;g.baseline=!1!==this.options.BaseLine?
this.options.BaseLine:this.options.Zero?e:0;g.tip_color=3===l?16711680:65280;g.handle=k;g.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("faceIndex not provided, check three.js version",b.REVISION,"expected r121"),null;if(0>a.faceIndex||a.faceIndex>=this.face_to_bins_index.length)return null;var c=this.painter,d=this.handle,f=c.getFramePainter(),e=c.getHisto();a=c.get3DToolTip(this.face_to_bins_index[a.faceIndex]);var g=a.ix-1,h=g+d.stepi,k=a.iy-1,l=k+d.stepj;a.x1=Math.max(-f.size_xy3d,
d.grx[g]+d.xbar1*(d.grx[h]-d.grx[g]));a.x2=Math.min(f.size_xy3d,d.grx[g]+d.xbar2*(d.grx[h]-d.grx[g]));a.y1=Math.max(-f.size_xy3d,d.gry[k]+d.ybar1*(d.gry[l]-d.gry[k]));a.y2=Math.min(f.size_xy3d,d.gry[k]+d.ybar2*(d.gry[l]-d.gry[k]));d=this.baseline;h=a.value;e.$baseh&&(d=e.$baseh.getBinContent(g+1,k+1));h<d&&(e=d,d=h,h=e);a.z1=f.grz(Math.max(this.zmin,d));a.z2=f.grz(Math.min(this.zmax,h));a.color=this.tip_color;c.is_projection&&2==c.getDimension()&&(a.$painter=c);return a};m.toplevel.add(g);0<D&&(ca=
new b.BufferGeometry,ca.setAttribute("position",new b.BufferAttribute(L,3)),ca.setAttribute("normal",new b.BufferAttribute(S,3)),l=2>l?new b.Color(16711680):new b.Color(n.rgb(q).darker(.5).toString()),l=new b.MeshBasicMaterial({color:l,flatShading:!0}),l=new b.Mesh(ca,l),l.face_to_bins_index=V,l.painter=this,l.handle=g.handle,l.tooltip=g.tooltip,l.zmin=g.zmin,l.zmax=g.zmax,l.baseline=g.baseline,l.tip_color=g.tip_color,m.toplevel.add(l))}if(!(12<this.options.Lego)){q=ca=0;c=!0;O=z;T=e;for(g=u;g<x;g+=
p)for(l=f;l<t;l+=C)M(g,l,0)&&(ca+=y?r.length:d.length,q+=y?w.length:F.length);65520<ca&&(c=!1);c||(ca=3*q);h=new Float32Array(3*ca);K=c?new Uint16Array(q):null;R=m.grz(e);N=m.grz(z);D=V=I=H=0;for(g=u;g<x;g+=p)for(q=k.grx[g]+k.xbar1*(k.grx[g+p]-k.grx[g]),ca=k.grx[g]+k.xbar2*(k.grx[g+p]-k.grx[g]),l=f;l<t;l+=C)if(M(g,l,0))if(ha=k.gry[l]+k.ybar1*(k.gry[l+C]-k.gry[l]),ja=k.gry[l]+k.ybar2*(k.gry[l+C]-k.gry[l]),H=E<=e?R:m.grz(E),I=v>z?N:m.grz(v),S=y?w:F,Z=y?r:d,c){for(u=0;u<S.length;++u)K[D++]=V/3+S[u];
for(u=0;u<Z.length;++u)L=Z[u],h[V]=q+L.x*(ca-q),h[V+1]=ha+L.y*(ja-ha),h[V+2]=H+L.z*(I-H),V+=3}else for(u=0;u<S.length;++u)L=Z[S[u]],h[V]=q+L.x*(ca-q),h[V+1]=ha+L.y*(ja-ha),h[V+2]=H+L.z*(I-H),V+=3;d=this.v7EvalColor("line_color","lightblue");d=new b.LineBasicMaterial({color:new b.Color(d),linewidth:this.v7EvalAttr("line_width",1)});d=A.createLineSegments(h,d,c?K:null);m.toplevel.add(d)}}}};JSROOT.v7.RH1Painter.prototype.draw3D=function(a){var b=this;this.mode3d=!0;var c=this.getFramePainter(),h=this.isMainPainter();
if("resize"==a)return h&&c.resize3D()&&c.render3D(),Promise.resolve(this);this.deleteAttr();this.scanContent(!0);h&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{use_y_for_z:!0,zmult:1.1,zoom:JSROOT.settings.Zooming,ndim:1}));return c.mode3d?this.drawingBins(a).then(function(){var a=b.getFramePainter();b.drawLego();b.updatePaletteDraw();a.render3D();a.addKeysHandler();
return b}):Promise.resolve(this)};JSROOT.v7.RH2Painter.prototype.draw3D=function(a){var b=this;this.mode3d=!0;var c=this.getFramePainter(),h=this.isMainPainter();if("resize"==a)return h&&c.resize3D()&&c.render3D(),Promise.resolve(this);var F=1.1;this.zmin=c.logz?.3*this.gminposbin:this.gminbin;this.zmax=this.gmaxbin;-1111!==this.options.minimum&&(this.zmin=this.options.minimum);-1111!==this.options.maximum&&(this.zmax=this.options.maximum,F=1);c.logz&&0>=this.zmin&&(this.zmin=1E-5*this.zmax);this.deleteAttr();
h&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{zmult:F,zoom:JSROOT.settings.Zooming,ndim:2}));return c.mode3d?this.drawingBins(a).then(function(){var a=b.getFramePainter();b.draw3DBins();a.render3D();a.addKeysHandler();return b}):Promise.resolve(this)};JSROOT.v7.RH2Painter.prototype.draw3DBins=function(){if(this.draw_content){if(this.isRH2Poly())return this.drawPolyLego();
if(this.options.Surf)return this.drawSurf();if(this.options.Error)return this.drawError();if(this.options.Contour)return this.drawContour3D(!0);this.drawLego();this.updatePaletteDraw()}};JSROOT.v7.RH2Painter.prototype.drawContour3D=function(a){var b=this.getFramePainter(),c=this.prepareDraw({rounding:!1,use3d:!0,extra:100,middle:0}),h=b.getHistPalette(),F=2*b.size_z3d,w=[];this.createContour(b,h,{full_z_range:!0});var r=h.getContour();this.buildContour(c,r,h,function(c,d,h,k,u,x){if(!(3>u-k)){if(a&&
(F=b.grz(r[x]),0>F||F>2*b.size_z3d))return;for(c=k;c<u;++c)w.push(d[c],h[c],F),w.push(d[c+1],h[c+1],F)}});c=A.createLineSegments(w,ia(this));b.toplevel.add(c)};JSROOT.v7.RH2Painter.prototype.drawSurf=function(){function a(a,b,c,d,f,e){if(n){var h=0>c?-1:c>2*m.size_z3d?1:0,g=0>e?-1:e>2*m.size_z3d?1:0;if(h!==g||0===h){if(!B)return++R;if(0!==h){var k=e-c;c=0>h?0:2*m.size_z3d;a=d-(d-a)/k*(e-c);b=f-(f-b)/k*(e-c)}0!==g&&(h=c-e,e=0>g?0:2*m.size_z3d,d=a-(a-d)/h*(c-e),f=b-(b-f)/h*(c-e));N[H]=a;N[H+1]=b;N[H+
2]=c;H+=3;N[H]=d;N[H+1]=f;N[H+2]=e;H+=3}}}function d(a,b,c,d,f,e,h,g){D>=G.length&&console.log("more than 6 points???");c=(h-c)/(e-c);e=3;0!==P&&Math.abs(c)<Math.abs(P)&&(G[D]=G[D-3],G[D+1]=G[D-2],G[D+2]=G[D-1],D-=3,e=6);G[D]=a+c*(d-a);G[D+1]=b+c*(f-b);G[D+2]=h;g&&T&&(Q[Y]=G[D],Q[Y+1]=G[D+1],Q[Y+2]=G[D+2],Y+=3);D+=e;P=c}function c(a,b,c){b=8*((b-e.i1)/x*p+(c-e.j1)/f);if(0<=U[b])return console.error("More than 8 vertexes for the bin");c=b+8+U[b];U[b]--;U[c]=a}function h(a){for(var b=e.i1;b<e.i2;b+=
x)for(var c=e.j1;c<e.j2;c+=f){var d=8*((b-e.i1)/x*p+(c-e.j1)/f);if(-1!==U[d]){var h=0<=U[d]?d:d+9+U[d];d+=8;for(var g=0,k=0,l=0,m=h;m<d;++m){var r=U[m];if(0>r)return console.error("FAILURE in NORMALS RECALCULATIONS");g+=a[r];k+=a[r+1];l+=a[r+2]}g/=d-h;k/=d-h;for(l/=d-h;h<d;++h)m=U[h],a[m]=g,a[m+1]=k,a[m+2]=l}}}function F(a,b,e,h,g,m,p,r,u,w){for(var q=1;q<l.length;++q){var v=e<l[q-1]?-1:e>l[q]?1:0,t=m<l[q-1]?-1:m>l[q]?1:0,y=u<l[q-1]?-1:u>l[q]?1:0,F=v+t+y;if(3!==F){if(-3===F)break;if(B){if(D=Y=0,0===
v&&(G[D]=a,G[D+1]=b,G[D+2]=e,D+=3),v!==t&&(P=0,(0>v||0>t)&&d(a,b,e,h,g,m,l[q-1]),(0<v||0<t)&&d(a,b,e,h,g,m,l[q],!0)),0===t&&(G[D]=h,G[D+1]=g,G[D+2]=m,D+=3),t!==y&&(P=0,(0>t||0>y)&&d(h,g,m,p,r,u,l[q-1]),(0<t||0<y)&&d(h,g,m,p,r,u,l[q],!0)),0===y&&(G[D]=p,G[D+1]=r,G[D+2]=u,D+=3),y!==v&&(P=0,(0>y||0>v)&&d(p,r,u,a,b,e,l[q-1]),(0<y||0<v)&&d(p,r,u,a,b,e,l[q],!0)),0!==D)if(9>D)console.log("found less than 3 points",D/3);else{if(T&&6===Y){for(v=0;6>v;++v)T[O+v]=Q[v];O+=6}v=K[q];t=M[q];E&&9===D&&(c(t,z,k),
c(t+3,z+1,w?k+f:k),c(t+6,w?z:z+x,k+f));for(y=3;y<D-3;y+=3)v[t]=G[0],v[t+1]=G[1],v[t+2]=G[2],t+=3,v[t]=G[y],v[t+1]=G[y+1],v[t+2]=G[y+2],t+=3,v[t]=G[y+3],v[t+1]=G[y+4],v[t+2]=G[y+5],t+=3;M[q]=t}}else F=Math.abs(t-v)+Math.abs(y-t)+Math.abs(v-y),0===v&&++F,0===t&&++F,0===y&&++F,1!==F&&2!==F||console.error("FOND npnts",F),2<F&&(void 0===J[q]&&(J[q]=0),J[q]+=F-2),!(0<v||0<t||0<y)||v===t&&t===y&&y===v||++I}}}var w=this,r=this.getHisto(),m=this.getFramePainter(),e=this.prepareDraw({rounding:!1,use3d:!0,extra:1,
middle:.5}),z,k,u,x=e.stepi,f=e.stepj;var t=e.i2-e.i1;var p=e.j2-e.j1,C=m.z_handle.gr.domain()[0];1<x&&(t=Math.round(t/x),t*x<e.i2-e.i1&&t++);1<f&&(p=Math.round(p/f),p*f<e.j2-e.j1&&p++);var g=m.logz?function(a){return a<C?-.1:m.grz(a)}:m.grz;if(!(2>e.i2-e.i1||2>e.j2-e.j1)){var l=u=null,n=!0,q=!1,E=!1,v=null;var y=0;switch(this.options.Surf){case 11:y=2;break;case 12:case 15:case 17:y=2;n=!1;break;case 14:n=!1;E=!0;break;case 16:y=1;q=!0;n=!1;break;default:u=m.z_handle.createTicks(!0),q=!0}0<y&&(v=
m.getHistPalette(),2==y&&this.createContour(m,v,{full_z_range:!0}),u=v.getContour());if(u)for(l=new Float32Array(u.length),y=0;y<u.length;++y)l[y]=g(u[y]);else l=[0,2*m.size_z3d];var B,J=[],K=[],M=[],R=0,N=null,H=0,I=0,T=null,O=0,U=[],G=new Float32Array(18),D=0,P=0,Q=new Float32Array(6),Y=0;if(E)for(U=new Int32Array(t*p*8),t=0;t<U.length;++t)U[t]=-1;for(B=0;2>B;++B){if(B){for(t=1;t<l.length;++t)J[t]&&(K[t]=new Float32Array(9*J[t]),M[t]=0);n&&0<R&&(N=new Float32Array(6*R));q&&0<I&&(T=new Float32Array(6*
I))}for(z=e.i1;z<e.i2-x;z+=x)for(t=e.grx[z],y=e.grx[z+x],k=e.j1;k<e.j2-f;k+=f){u=e.gry[k];var da=e.gry[k+f];var aa=g(r.getBinContent(z+1,k+1));var ea=g(r.getBinContent(z+1,k+1+f));var Z=g(r.getBinContent(z+1+f,k+1));var S=g(r.getBinContent(z+1+f,k+1+f));F(t,u,aa,y,da,S,t,da,ea,!0);F(t,u,aa,y,u,Z,y,da,S,!1);a(t,da,ea,t,u,aa);a(t,u,aa,y,u,Z);z===e.i2-2&&a(y,u,Z,y,da,S);k===e.j2-2&&a(t,da,ea,y,da,S)}}for(r=1;r<l.length;++r)K[r]&&(M[r]!==9*J[r]&&console.error("SURF faces missmatch lvl",r,"faces",J[r],
"index",M[r],"check",9*J[r]-M[r]),g=new b.BufferGeometry,g.setAttribute("position",new b.BufferAttribute(K[r],3)),g.computeVertexNormals(),E&&1===r&&h(g.getAttribute("normal").array),q=q=void 0,q=v?v.getColor(r-1):this.getColor(5),q=14===this.options.Surf?new b.MeshLambertMaterial({color:q,side:b.DoubleSide}):new b.MeshBasicMaterial({color:q,side:b.DoubleSide}),g=new b.Mesh(g,q),m.toplevel.add(g),g.painter=this);N&&(6*R!==H&&console.error("SURF lines mismmatch nsegm",R," lindx",H,"difference",6*R-
H),v=this.getColor(7),v=new b.LineBasicMaterial({color:new b.Color(v),linewidth:this.v7EvalAttr("line_width",1)}),v=A.createLineSegments(N,v),v.painter=this,m.toplevel.add(v));T&&(6*I!==O&&console.error("SURF grid draw mismatch ngridsegm",I,"gindx",O,"diff",6*I-O),v=1===this.options.Surf?new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}):new b.LineBasicMaterial({color:new b.Color(this.v7EvalColor("line_color","lightblue"))}),v=A.createLineSegments(T,v),v.painter=this,m.toplevel.add(v));17===
this.options.Surf&&this.drawContour3D();if(13===this.options.Surf){e=this.prepareDraw({rounding:!1,use3d:!0,extra:100,middle:0});v=this.getContour();var V=this.getHistPalette(),X=-1,W=2*m.size_z3d;this.buildContour(e,v,V,function(a,c,d,e,f){c[f]===c[e]&&d[f]===d[e]&&f--;if(!(3>f-e)){for(var h=[],g=e;g<=f;++g)g!==e&&c[g]===c[g-1]&&d[g]===d[g-1]||h.push(new b.Vector2(c[g],d[g]));if(!(3>h.length)&&(e=b.ShapeUtils.triangulateShape(h,[]))&&0!==e.length){if(0>X||X!==a)X=a,W+=1E-4*m.size_z3d;c=new Float32Array(9*
e.length);d=new Float32Array(9*e.length);for(g=f=0;g<e.length;++g)for(var k=e[g],l=0;3>l;++l){var p=h[k[l]];c[f]=p.x;c[f+1]=p.y;c[f+2]=W;d[f]=0;d[f+1]=0;d[f+2]=1;f+=3}h=new b.BufferGeometry;h.setAttribute("position",new b.BufferAttribute(c,3));h.setAttribute("normal",new b.BufferAttribute(d,3));a=V.getColor(a);a=new b.MeshBasicMaterial({color:a,flatShading:!0,side:b.DoubleSide,opacity:.5});a=new b.Mesh(h,a);a.painter=w;m.toplevel.add(a)}}})}this.updatePaletteDraw()}};JSROOT.v7.RH2Painter.prototype.drawError=
function(){for(var a=this.getFramePainter(),d=this.getHisto(),c=this.prepareDraw({rounding:!1,use3d:!0,extra:1}),h=a.z_handle.gr.domain()[0],F=a.z_handle.gr.domain()[1],w,r,m,e,z,k,u,x,f,t=0,p=null,C=null,g=0,l=c.stepi,n=c.stepj,q=0;2>q;++q){for(w=c.i1;w<c.i2;w+=l)for(z=c.grx[w],u=c.grx[w+l],r=c.j1;r<c.j2;r+=n)if(m=d.getBinContent(w+1,r+1),!(m<h||m>F)){if(k=m===h)k=this.options.Zero||0<h?!1:!this._show_empty_bins;k||(0===q?t+=3:(e=d.getBinError(w+1,r+1),C[g/18]=d.getBin(w+1,r+1),k=c.gry[r],x=c.gry[r+
n],f=a.grz(m-e<h?h:m-e),m=a.grz(m+e>F?F:m+e),p[g]=z,p[g+3]=u,p[g+1]=p[g+4]=(k+x)/2,p[g+2]=p[g+5]=(f+m)/2,g+=6,p[g]=p[g+3]=(z+u)/2,p[g+1]=k,p[g+4]=x,p[g+2]=p[g+5]=(f+m)/2,g+=6,p[g]=p[g+3]=(z+u)/2,p[g+1]=p[g+4]=(k+x)/2,p[g+2]=f,p[g+5]=m,g+=6))}if(0===q){if(0===t)return;p=new Float32Array(6*t);C=new Int32Array(t/3)}}d=new b.Color(this.v7EvalColor("line_color","lightblue"));w=new b.LineBasicMaterial({color:d,linewidth:this.v7EvalAttr("line_width",1)});p=A.createLineSegments(p,w);p.painter=this;p.intersect_index=
C;p.zmin=h;p.zmax=F;p.tip_color=.5>d.g?65280:16711680;p.handle=c;p.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("segment index not provided, check three.js version",b.REVISION,"expected r121"),null;var c=Math.floor(a.index/6);if(0>c||c>=this.intersect_index.length)return null;var d=this.painter;a=d.getFramePainter();c=d.get3DToolTip(this.intersect_index[c]);d=this.handle;var e=c.ix-1,f=e+d.stepi,h=c.iy-1,g=h+d.stepj;c.x1=Math.max(-a.size_xy3d,d.grx[e]);c.x2=Math.min(a.size_xy3d,
d.grx[f]);c.y1=Math.max(-a.size_xy3d,d.gry[h]);c.y2=Math.min(a.size_xy3d,d.gry[g]);c.z1=a.grz(c.value-c.error<this.zmin?this.zmin:c.value-c.error);c.z2=a.grz(c.value+c.error>this.zmax?this.zmax:c.value+c.error);c.color=this.tip_color;return c};a.toplevel.add(p)};JSROOT.v7.RH2Painter.prototype.drawPolyLego=function(){var a=this.getHisto(),d=this.getHistPalette(),c=this.getFramePainter(),h=c.z_handle.gr.domain()[0],F=c.z_handle.gr.domain()[1],w,r=a.fBins.arr.length,m=c.grz(h);this.maxbin=this.gmaxbin;
this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(w=0;w<r;++w){var e=a.fBins.arr[w];if(!(e.fContent<h)){var z=d.getContourIndex(e.fContent);if(null!==z&&!(e.fXmin>c.scale_xmax||e.fXmax<c.scale_xmin||e.fYmin>c.scale_ymax||e.fYmax<c.scale_ymin)){var k=c.grz(e.fContent>F?F:e.fContent);var u=[],x=[],f=1,t=e.fPoly,p=0;"TMultiGraph"==t._typename&&(f=e.fPoly.fGraphs.arr.length,t=null);for(var n=0;n<f;++n){if(!t||0<n)t=e.fPoly.fGraphs.arr[n];for(var g=t.fNpoints,l=t.fX,A=t.fY;2<g&&l[0]===l[g-1]&&
A[0]===A[g-1];)--g;for(var q=void 0,E=void 0,v=0;2>v;++v){var y=void 0,B=void 0,J=void 0,K=void 0,M=c.size_xy3d*c.size_z3d,R=0<v?0:M/1E6;q=[];E=null;for(var N=0;N<g;++N)J=c.grx(l[N]),K=c.gry(A[N]),0<N&&(M=(J-y)*(J-y)+(K-B)*(K-B)),M>R&&(q.push(new b.Vector2(J,K)),y=J,B=K);try{2<q.length&&(E=b.ShapeUtils.triangulateShape(q,[]))}catch(H){E=null}if(E&&E.length>q.length-3)break}E&&E.length&&q&&(u.push(q),x.push(E),p+=2*E.length,k>m&&(p+=2*q.length))}e=new Float32Array(9*p);for(t=f=0;t<u.length;++t){p=
u[t];n=x[t];for(g=0;2>g;++g)for(l=0;l<n.length;++l)E=n[l],A=p[E[0]],q=p[E[0===g?2:1]],E=p[E[0===g?1:2]],e[f]=A.x,e[f+1]=A.y,e[f+2]=g?k:m,f+=3,e[f]=q.x,e[f+1]=q.y,e[f+2]=g?k:m,f+=3,e[f]=E.x,e[f+1]=E.y,e[f+2]=g?k:m,f+=3;if(k>m)for(n=0;n<p.length;++n)g=p[n],l=p[0<n?n-1:p.length-1],e[f]=g.x,e[f+1]=g.y,e[f+2]=m,f+=3,e[f]=l.x,e[f+1]=l.y,e[f+2]=m,f+=3,e[f]=l.x,e[f+1]=l.y,e[f+2]=k,f+=3,e[f]=g.x,e[f+1]=g.y,e[f+2]=m,f+=3,e[f]=l.x,e[f+1]=l.y,e[f+2]=k,f+=3,e[f]=g.x,e[f+1]=g.y,e[f+2]=k,f+=3}u=new b.BufferGeometry;
u.setAttribute("position",new b.BufferAttribute(e,3));u.computeVertexNormals();z=this.fPalette.getColor(z);z=new b.MeshBasicMaterial({color:z,flatShading:!0});z=new b.Mesh(u,z);c.toplevel.add(z);z.painter=this;z.bins_index=w;z.draw_z0=m;z.draw_z1=k;z.tip_color=65280;z.tooltip=function(){var a=this.painter,b=a.getFramePainter(),c=a.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:b.grx(c.fXmin),x2:b.grx(c.fXmax),y1:b.gry(c.fYmin),y2:b.gry(c.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,
value:c.fContent,color:this.tip_color,lines:a.getPolyBinTooltips(this.bins_index)}}}}}};Q.prototype=Object.create(JSROOT.v7.RHistPainter.prototype);Q.prototype.getDimension=function(){return 3};Q.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy&&this.nbinsz)&&(a=this.getHisto())){this.extractAxesProperties(3);if(this.isDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else{this.gminbin=this.gmaxbin=a.getBinContent(1,
1,1);for(var b=0;b<this.nbinsx;++b)for(var c=0;c<this.nbinsy;++c)for(var h=0;h<this.nbinsz;++h){var n=a.getBinContent(b+1,c+1,h+1);n<this.gminbin?this.gminbin=n:n>this.gmaxbin&&(this.gmaxbin=n)}}this.draw_content=0<this.gmaxbin}};Q.prototype.countStat=function(){var a=this.getHisto(),b=this.getAxis("x"),c=this.getAxis("y"),h=this.getAxis("z"),n=0,w=0,r=0,m=0,e=0,z=0,k=0,u=this.getSelectIndex("x","left"),x=this.getSelectIndex("x","right"),f=this.getSelectIndex("y","left"),t=this.getSelectIndex("y",
"right"),p=this.getSelectIndex("z","left"),A=this.getSelectIndex("z","right"),g=this.getFramePainter(),l={name:a.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0},L,q,E;for(L=1;L<=this.nbinsx;++L){var v=b.GetBinCoord(L-.5);var y=L<=u+1?0:L>x+1?2:1;for(q=1;q<=this.nbinsy;++q){var B=c.GetBinCoord(q-.5);var J=q<=f+1?0:q>t+1?2:1;for(E=1;E<=this.nbinsz;++E){var K=h.GetBinCoord(E-.5);var M=E<=p+1?0:E>A+1?2:1;var R=a.getBinContent(L,q,E);l.entries+=R;1==y&&1==J&&1==M&&(n+=R,w+=v*R,
r+=B*R,m+=K*R,e+=v*v*R,z+=B*B*R,k+=K*K*R)}}}0<a.fTsumw&&!g.isAxisZoomed("x")&&!g.isAxisZoomed("y")&&!g.isAxisZoomed("z")&&(n=a.fTsumw,w=a.fTsumwx,e=a.fTsumwx2,r=a.fTsumwy,z=a.fTsumwy2,m=a.fTsumwz,k=a.fTsumwz2);0<n&&(l.meanx=w/n,l.meany=r/n,l.meanz=m/n,l.rmsx=Math.sqrt(Math.abs(e/n-l.meanx*l.meanx)),l.rmsy=Math.sqrt(Math.abs(z/n-l.meany*l.meany)),l.rmsz=Math.sqrt(Math.abs(k/n-l.meanz*l.meanz)));l.integral=n;1<a.fEntries&&(l.entries=a.fEntries);return l};Q.prototype.fillStatistic=function(a,b){var c=
this.countStat(),d=b%10,n=Math.floor(b/10)%10,w=Math.floor(b/100)%10,r=Math.floor(b/1E3)%10;b=Math.floor(b/1E6)%10;a.clearStat();0<d&&a.addText(c.name);0<n&&a.addText("Entries = "+a.format(c.entries,"entries"));0<w&&(a.addText("Mean x = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany)),a.addText("Mean z = "+a.format(c.meanz)));0<r&&(a.addText("Std Dev x = "+a.format(c.rmsx)),a.addText("Std Dev y = "+a.format(c.rmsy)),a.addText("Std Dev z = "+a.format(c.rmsz)));0<b&&a.addText("Integral = "+
a.format(c.integral,"entries"));return!0};Q.prototype.getBinTooltips=function(a,b,c){var d=[],n=this.getHisto(),w=1,r=1,m=1;this.isDisplayItem()&&(w=n.stepx||1,r=n.stepy||1,m=n.stepz||1);d.push(this.getObjectHint());d.push("x = "+this.getAxisBinTip("x",a,w)+"  xbin="+a);d.push("y = "+this.getAxisBinTip("y",b,r)+"  ybin="+b);d.push("z = "+this.getAxisBinTip("z",c,m)+"  zbin="+c);a=n.getBinContent(a+1,b+1,c+1);w="entries = "+(1<w||1<r||1<m?"~":"");a===Math.round(a)?d.push(w+a):d.push(w+A.floatToString(a,
JSROOT.gStyle.fStatFormat));return d};Q.prototype.draw3DScatter=function(a){var d=this.getHisto(),c=this.getFramePainter(),h=a.i1,n=a.i2,w=a.stepi,r=a.j1,m=a.j2,e=a.stepj,z=a.k1,k=a.k2,u=a.stepk,x,f;if(n<=h||m<=r||k<=z)return!0;var t=1E3<this.gmaxbin?1E3/this.gmaxbin:1,p=0,C=0,g=Math.max(0,this.gminbin);for(a=h;a<n;a+=w)for(x=r;x<m;x+=e)for(f=z;f<k;f+=u){var l=d.getBinContent(a+1,x+1,f+1);C+=l;l<=g||(p+=Math.round(l*t))}if(p>(c.webgl?1E5:3E4))return!1;JSROOT.seed(C);C=new A.PointsCreator(p,c.webgl,
c.size_xy3d/200);p=new Int32Array(p);var B=0,q=this.getAxis("x"),E=this.getAxis("y"),v=this.getAxis("z");for(a=h;a<n;a+=w)for(x=r;x<m;x+=e)for(f=z;f<k;f+=u)if(l=d.getBinContent(a+1,x+1,f+1),!(l<=g))for(h=Math.round(l*t),l=0;l<h;++l){var y=q.GetBinCoord(a+JSROOT.random()),P=E.GetBinCoord(x+JSROOT.random()),J=v.GetBinCoord(f+JSROOT.random());p[B++]=d.getBin(a+1,x+1,f+1);C.addPoint(c.grx(y),c.gry(P),c.grz(J))}d=this.v7EvalColor("fill_color","red");d=C.createPoints(d);c.toplevel.add(d);d.bins=p;d.painter=
this;d.tip_color=65280;d.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, check three.js version",b.REVISION,"expected r121"),null;var c=Math.floor(a.index/this.nvertex);if(0>c||c>=this.bins.length)return null;a=this.painter;var d=a.getFramePainter();c=a.get3DToolTip(this.bins[c]);c.x1=d.grx(a.getAxis("x").GetBinLowEdge(c.ix));c.x2=d.grx(a.getAxis("x").GetBinLowEdge(c.ix+w));c.y1=d.gry(a.getAxis("y").GetBinLowEdge(c.iy));c.y2=d.gry(a.getAxis("y").GetBinLowEdge(c.iy+
e));c.z1=d.grz(a.getAxis("z").GetBinLowEdge(c.iz));c.z2=d.grz(a.getAxis("z").GetBinLowEdge(c.iz+u));c.color=this.tip_color;c.opacity=.3;return c};return!0};Q.prototype.draw3DBins=function(){if(this.draw_content){var a=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});if(!this.options.Scatter||!this.draw3DScatter(a)){var d=this.v7EvalColor("fill_color","red"),c=this.getFramePainter(),h=0,n=!1,w=!1,r=!1,m=1,e=!0,z=.5;if(this.options.Sphere){z=.4;n=!0;11===this.options.Sphere&&(r=!0);var k=
c.webgl?new b.SphereGeometry(.5,16,12):new b.SphereGeometry(.5,8,6);k.applyMatrix4((new b.Matrix4).makeRotationX(Math.PI/2));h=9*k.faces.length;var u=new Float32Array(h);var x=new Float32Array(h);for(var f=0;f<k.faces.length;++f)u[9*f]=k.vertices[k.faces[f].a].x,u[9*f+1]=k.vertices[k.faces[f].a].y,u[9*f+2]=k.vertices[k.faces[f].a].z,u[9*f+3]=k.vertices[k.faces[f].b].x,u[9*f+4]=k.vertices[k.faces[f].b].y,u[9*f+5]=k.vertices[k.faces[f].b].z,u[9*f+6]=k.vertices[k.faces[f].c].x,u[9*f+7]=k.vertices[k.faces[f].c].y,
u[9*f+8]=k.vertices[k.faces[f].c].z,x[9*f]=k.faces[f].vertexNormals[0].x,x[9*f+1]=k.faces[f].vertexNormals[0].y,x[9*f+2]=k.faces[f].vertexNormals[0].z,x[9*f+3]=k.faces[f].vertexNormals[1].x,x[9*f+4]=k.faces[f].vertexNormals[1].y,x[9*f+5]=k.faces[f].vertexNormals[1].z,x[9*f+6]=k.faces[f].vertexNormals[2].x,x[9*f+7]=k.faces[f].vertexNormals[2].y,x[9*f+8]=k.faces[f].vertexNormals[2].z}else{k=A.Box3D.Indexes;f=A.Box3D.Normals;var t=A.Box3D.Vertices;h=3*k.length;u=new Float32Array(h);x=new Float32Array(h);
for(var p=0,C=-3;p<k.length;++p){var g=t[k[p]];u[3*p]=g.x-.5;u[3*p+1]=g.y-.5;u[3*p+2]=g.z-.5;0===p%6&&(C+=3);x[3*p]=f[C];x[3*p+1]=f[C+1];x[3*p+2]=f[C+2]}w=!0;11==this.options.Box?r=!0:12==this.options.Box?(r=!0,w=!1):this.options.Color&&(r=!0,m=.5,w=e=!1,n=!0)}e&&(e=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);var l=this.getHisto(),B=a.i1,q=a.i2,E=a.stepi,v=a.j1,y=a.j2,P=a.stepj,J=a.k1,K=a.k2,M=a.stepk;a=null;r&&(a=c.getHistPalette(),this.createContour(c,
a));if(!(q<=B||y<=v||K<=J)){var R=this.getAxis("x"),N=this.getAxis("y"),H=this.getAxis("z");k=(c.grx(R.GetBinCoord(q))-c.grx(R.GetBinCoord(B)))/(q-B)*E;f=(c.gry(N.GetBinCoord(y))-c.gry(N.GetBinCoord(v)))/(y-v)*P;t=(c.grz(H.GetBinCoord(K))-c.grz(H.GetBinCoord(J)))/(K-J)*M;var I=0,T,O,U;p=[];var G=0;C=[];for(T=B;T<q;T+=E)for(O=v;O<y;O+=P)for(U=J;U<K;U+=M){var D=l.getBinContent(T+1,O+1,U+1);if(this.options.Color||!(0===D||D<this.gminbin)){var Q=e?Math.pow(Math.abs(D*e),.3333):1;.001>Q||(I++,r&&(g=a.getContourIndex(D),
0<=g?(void 0===p[g]&&(p[g]=0,C[g]=G++),p[g]+=1):console.error("not found color for",D)))}}r||(p.push(I),G=1,C=[0]);var ia=Array(G);g=Array(G);var Y=Array(G),da=Array(G),aa=Array(G),ea=Array(G);G=Array(G);for(T=0;T<p.length;++T)p[T]&&(I=p[T],O=C[T],ia[O]=0,aa[O]=0,w&&(aa[O]=65520<I*h/3?2:1),g[O]=new Float32Array(I*h),Y[O]=new Float32Array(I*h),da[O]=new Int32Array(I),1===aa[O]&&(ea[O]=new Uint16Array(I*A.Box3D.MeshSegments.length)),2===aa[O]&&(G[O]=new Float32Array(I*A.Box3D.Segments.length*3)));R=
this.getAxis("x");N=this.getAxis("y");H=this.getAxis("z");for(T=B;T<q;T+=E)for(I=R.GetBinCenter(T+1),w=c.grx(I),O=v;O<y;O+=P)for(I=N.GetBinCenter(O+1),B=c.gry(I),U=J;U<K;U+=M)if(D=l.getBinContent(T+1,O+1,U+1),this.options.Color||!(0===D||D<this.gminbin))if(Q=e?Math.pow(Math.abs(D*e),.3333):1,!(.001>Q)){var Z=0;if(r){I=a.getContourIndex(D);if(0>I)continue;Z=C[I]}I=ia[Z];D=H.GetBinCenter(U+1);D=c.grz(D);da[Z][I]=l.getBin(T+1,O+1,U+1);for(var S=I*h,V=g[Z],X=Y[Z],W=0;W<h;W+=3,S+=3)V[S]=w+u[W]*k*Q,V[S+
1]=B+u[W+1]*f*Q,V[S+2]=D+u[W+2]*t*Q,X[S]=x[W],X[S+1]=x[W+1],X[S+2]=x[W+2];if(1===aa[Z]){V=A.Box3D.MeshSegments;S=I*V.length;X=Math.round(I*h/3);W=ea[Z];for(var ba=0;ba<V.length;++ba)W[S+ba]=X+V[ba]}if(2===aa[Z])for(V=A.Box3D.Segments,X=G[Z],S=I*V.length*3,W=0;W<V.length;++W,S+=3)ba=A.Box3D.Vertices[V[W]],X[S]=w+(ba.x-.5)*k*Q,X[S+1]=B+(ba.y-.5)*f*Q,X[S+2]=D+(ba.z-.5)*t*Q;ia[Z]=I+1}for(u=0;u<p.length;++u)p[u]&&(x=C[u],l=new b.BufferGeometry,l.setAttribute("position",new b.BufferAttribute(g[x],3)),l.setAttribute("normal",
new b.BufferAttribute(Y[x],3)),r&&(d=a.getColor(u)),q=n?new b.MeshLambertMaterial({color:d,opacity:m,transparent:1>m}):new b.MeshBasicMaterial({color:d,opacity:m}),l=new b.Mesh(l,q),l.bins=da[x],l.bins_faces=h/9,l.painter=this,l.scalex=z*k,l.scaley=z*f,l.scalez=z*t,l.tip_color=65280,l.use_scale=e,l.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("intersect.faceIndex not provided, check three.js version",b.REVISION,"expected r121"),null;a=Math.floor(a.faceIndex/this.bins_faces);
if(0>a||a>=this.bins.length)return null;var c=this.painter,d=c.getFramePainter();a=c.get3DToolTip(this.bins[a]);var e=d.grx(c.getAxis("x").GetBinCoord(a.ix-.5)),f=d.gry(c.getAxis("y").GetBinCoord(a.iy-.5));c=d.grz(c.getAxis("z").GetBinCoord(a.iz-.5));d=this.use_scale?Math.pow(Math.abs(a.value*this.use_scale),.3333):1;a.x1=e-this.scalex*d;a.x2=e+this.scalex*d;a.y1=f-this.scaley*d;a.y2=f+this.scaley*d;a.z1=c-this.scalez*d;a.z2=c+this.scalez*d;a.color=this.tip_color;return a},c.toplevel.add(l),0<aa[x]&&
(l=this.v7EvalColor("line_color","lightblue"),l=new b.LineBasicMaterial({color:l}),q=null,q=1===aa[x]?A.createLineSegments(g[x],l,ea[x]):A.createLineSegments(G[x],l),c.toplevel.add(q)));r&&this.updatePaletteDraw()}}}};Q.prototype.redraw=function(a){var b=this,c=this.getFramePainter();"resize"==a?c.resize3D()&&c.render3D():(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),c.set3DOptions(this.options),
c.drawXYZ(c.toplevel,{zoom:JSROOT.settings.Zooming,ndim:3}),this.drawingBins(a).then(function(){var a=b.getFramePainter();b.draw3DBins();a.render3D();a.addKeysHandler()}))};Q.prototype.fillToolbar=function(){var a=this.getPadPainter();a&&(a.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&a.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a.showPadButtons())};Q.prototype.canZoomInside=function(a,b,c){var d=this.getHisto();d&&(d=d["f"+a.toUpperCase()+"axis"]);
return!d||1<d.FindBin(c,.5)-d.FindBin(b,0)};Q.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right"),c=this.getSelectIndex("y","left"),h=this.getSelectIndex("y","right"),n=this.getSelectIndex("z","left"),w=this.getSelectIndex("z","right"),r,m,e,z=this.getHisto();if(a!==b&&c!==h&&n!==w){var k=z.getBinContent(a+1,c+1,n+1);for(r=a;r<b;++r)for(m=c;m<h;++m)for(e=n;e<w;++e)k=Math.min(k,z.getBinContent(r+1,m+1,e+1));if(!(0<k)){var u=b,x=a,f=h,t=c,p=w,A=n;for(r=
a;r<b;++r)for(m=c;m<h;++m)for(e=n;e<w;++e)z.getBinContent(r+1,m+1,e+1)>k&&(r<u&&(u=r),r>=x&&(x=r+1),m<f&&(f=m),m>=t&&(t=m+1),e<p&&(p=e),e>=A&&(A=e+1));r=!1;u===x-1&&u>a+1&&x<b-1&&(u--,x++);f===t-1&&f>c+1&&t<h-1&&(f--,t++);p===A-1&&p>n+1&&A<w-1&&(p--,A++);if((u>a||x<b)&&u<x-1){var g=this.getAxis("x").GetBinLowEdge(u+1);var l=this.getAxis("x").GetBinLowEdge(x+1);r=!0}if((f>c||t<h)&&f<t-1){var B=this.getAxis("y").GetBinLowEdge(f+1);var q=this.getAxis("y").GetBinLowEdge(t+1);r=!0}if((p>n||A<w)&&p<A-1){var E=
this.getAxis("z").GetBinLowEdge(p+1);var v=this.getAxis("z").GetBinLowEdge(A+1);r=!0}r&&this.getFramePainter().zoom(g,l,B,q,E,v)}}};Q.prototype.fillHistContextMenu=function(a){var b=this,c=A.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.interactiveRedraw(!0,"drawopt")})};JSROOT.v7.RH3Painter=Q;JSROOT.v7.drawHist3=function(a,b){var c=new Q(a,b);return A.ensureRCanvas(c,"3d").then(function(){c.setAsMainPainter();
c.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};var a=c.v7EvalAttr("kind",""),b=c.v7EvalAttr("sub",0),d=c.options;switch(a){case "box":d.Box=10+b;break;case "sphere":d.Sphere=10+b;break;case "col":d.Color=!0;break;case "scat":d.Scatter=!0;break;default:d.Box=10}c.scanContent();c.redraw();return c})};return JSROOT});
