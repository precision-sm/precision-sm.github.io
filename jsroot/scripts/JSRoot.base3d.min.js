JSROOT.define(["d3","threejs_jsroot","painter"],function(k,f,g){function t(a,b){this.cont=this.tt=null;this.lastlbl="";this.parent=a?a:document.body;this.canvas=b;this.abspos=!a}function n(){}function r(a){this.mesh=a}function v(a,b,c){this.webgl=void 0===b?!0:b;this.scale=c||1;this.pos=new Float32Array(3*a);this.geom=new f.BufferGeometry;this.geom.setAttribute("position",new f.BufferAttribute(this.pos,3));this.indx=0}function w(a,b){if(!a||!b)return null;a=a.getColor(b.fLineColor);var c=b.fLineStyle?
g.root_line_styles[b.fLineStyle]:"";a=(c=c?c.split(","):[])&&2<=c.length?new f.LineDashedMaterial({color:a,dashSize:parseInt(c[0]),gapSize:parseInt(c[1])}):new f.LineBasicMaterial({color:a});void 0!==b.fLineWidth&&1<b.fLineWidth&&(a.linewidth=b.fLineWidth);return a}g.getRender3DKind=function(a){a||(a=JSROOT.batch_mode?JSROOT.settings.Render3DBatch:JSROOT.settings.Render3D);var b=JSROOT.constants.Render3D;a==b.Default&&(a=JSROOT.batch_mode?b.WebGLImage:b.WebGL);JSROOT.batch_mode&&a==b.WebGL&&(a=b.WebGLImage);
return a};var x={access3dKind:function(a){var b=this.getPadSvg();if(b.empty())return-1;var c=b.property("can3d");void 0!==a&&b.property("can3d",a);return null===c||void 0===c?-1:c},getSizeFor3d:function(a,b){void 0===a&&(a=g.getRender3DKind(),a=a!==JSROOT.constants.Render3D.WebGL?JSROOT.constants.Embed3D.EmbedSVG:JSROOT.settings.Embed3D!=JSROOT.constants.Embed3D.Default?JSROOT.settings.Embed3D:JSROOT.browser.isFirefox?JSROOT.constants.Embed3D.Embed:JSROOT.constants.Embed3D.Overlay);var c=this.getPadSvg();
b="draw3d_"+(this.getPadName()||"canvas");if(c.empty())return a=g.getElementRect(this.selectDom()),10>a.height&&10<a.width&&(a.height=Math.round(.66*a.width),this.selectDom().style("height",a.height+"px")),a.x=0,a.y=0,a.clname=b,a.can3d=-1,a;var e=this.getFramePainter();0===a&&(c=this.getCanvSvg());b={x:0,y:0,width:100,height:100,clname:b,can3d:a};e&&!e.mode3d&&(c=this.getFrameSvg(),b.x=c.property("draw_x"),b.y=c.property("draw_y"));b.width=c.property("draw_width");b.height=c.property("draw_height");
(!e||e.mode3d)&&0<a&&(b.x=Math.round(b.x+b.width*JSROOT.gStyle.fPadLeftMargin),b.y=Math.round(b.y+b.height*JSROOT.gStyle.fPadTopMargin),b.width=Math.round(b.width*(1-JSROOT.gStyle.fPadLeftMargin-JSROOT.gStyle.fPadRightMargin)),b.height=Math.round(b.height*(1-JSROOT.gStyle.fPadTopMargin-JSROOT.gStyle.fPadBottomMargin)));c=(c=this.getPadPainter())?c.getPadRect():{width:100,height:100};e=c.width-b.x-b.width;var f=c.height-b.y-b.height;0<=e&&0<=f&&(b.x=Math.round(.3*b.x),b.y=Math.round(.9*b.y),b.width=
c.width-b.x-Math.round(.3*e),b.height=c.height-b.y-Math.round(.5*f));1===a&&(b=g.getAbsPosInCanvas(this.getPadSvg(),b));return b},clear3dCanvas:function(){var a=this.access3dKind(null);if(0>a){var b=this.selectDom().node(),c=b?b.firstChild:null;c&&!c.$jsroot&&(c=c.nextSibling);c&&c.$jsroot&&(delete c.painter,b.removeChild(c));return a}b=this.getSizeFor3d(a);if(0===b.can3d)k.select(this.getCanvSvg().node().nextSibling).remove(),this.getCanvSvg().style("display",null);else{if(this.getPadSvg().empty())return;
this.apply3dSize(b).remove();this.getFrameSvg().style("display",null)}return a},add3dCanvas:function(a,b,c){!b||-1>a.can3d||(-1===a.can3d?(a=this.selectDom().node(),null!==a&&(a.appendChild(b),b.painter=this,b.$jsroot=!0)):(0<a.can3d&&!c&&(a.can3d=JSROOT.constants.Embed3D.EmbedSVG),this.access3dKind(a.can3d),0===a.can3d?(this.getCanvSvg().style("display","none"),this.getCanvSvg().node().parentNode.appendChild(b)):this.getPadSvg().empty()||(this.getFrameSvg().style("display","none"),this.apply3dSize(a).attr("title",
"").node().appendChild(b))))},apply3dSize:function(a,b){if(0>a.can3d)return k.select(null);if(1<a.can3d){var c=this.getLayerSvg(a.clname);if(b)return c;b=this.getPadSvg();a.can3d===JSROOT.constants.Embed3D.EmbedSVG?(c.empty()&&(c=b.insert("g",".primitives_layer").attr("class",a.clname)),c.attr("transform","translate("+a.x+","+a.y+")")):(c.empty()&&(c=b.insert("foreignObject",".primitives_layer").attr("class",a.clname)),c.attr("x",a.x).attr("y",a.y).attr("width",a.width).attr("height",a.height).attr("viewBox",
"0 0 "+a.width+" "+a.height).attr("preserveAspectRatio","xMidYMid"))}else{var e=this.getCanvSvg().node().parentNode;c=k.select(e).select("."+a.clname);if(b)return c;this.getCanvSvg().property("redraw_by_resize",!0);c.empty()&&(c=k.select(e).append("div").attr("class",a.clname+" jsroot_noselect"));for(b=e.getBoundingClientRect();e;){if(e===document){e=null;break}try{if("static"!==getComputedStyle(e).position)break}catch(h){break}e=e.parentNode}var f=e?e.getBoundingClientRect():{top:0,left:0};e=Math.round(b.left-
f.left);b=Math.round(b.top-f.top);c.style("position","absolute").style("left",a.x+e+"px").style("top",a.y+b+"px").style("width",a.width+"px").style("height",a.height+"px")}return c}};g.assign3DHandler=function(a){JSROOT.extend(a,x)};g.createRender3D=function(a,b,c,e){var p=JSROOT.constants.Render3D;c=g.getRender3DKind(c);e||(e={antialias:!0,alpha:!0});var h=!1,u=JSROOT._.get_document();c==p.WebGL?e=new f.WebGLRenderer(e):c==p.SVG?(e=f.CreateSVGRenderer(!1,0,u),JSROOT.batch_mode?h=!0:e.jsroot_dom=
u.createElementNS("http://www.w3.org/2000/svg","svg")):JSROOT.nodejs?(h=require("gl")(a,b,{preserveDrawingBuffer:!0}),p=require("canvas").createCanvas,e.canvas=p(a,b),e.canvas.addEventListener=function(){},e.canvas.style={},e.context=h,h=console.warn,console.warn=function(a){a&&0>a.indexOf("OES_texture_half_float")&&0>a.indexOf("EXT_texture_filter_anisotropic")&&0>a.indexOf("WEBGL_depth_texture")&&0>a.indexOf("OES_vertex_array_object")&&console.log("NEW: "+a)},e=new f.WebGLRenderer(e),e.jsroot_output=
new f.WebGLRenderTarget(a,b),e.setRenderTarget(e.jsroot_output),console.warn=h,h=!0):(e=new f.WebGLRenderer(e),e.jsroot_dom=u.createElementNS("http://www.w3.org/2000/svg","image"),k.select(e.jsroot_dom).attr("width",a).attr("height",b));h?(JSROOT._.svg_3ds||(JSROOT._.svg_3ds=[]),e.workaround_id=JSROOT._.svg_3ds.length,JSROOT._.svg_3ds[e.workaround_id]="<svg></svg>",e.jsroot_dom=u.createElementNS("http://www.w3.org/2000/svg","path"),e.jsroot_dom.setAttribute("jsroot_svg_workaround",e.workaround_id)):
e.jsroot_dom||(e.jsroot_dom=e.domElement);e.setSize(a,b);e.jsroot_render3d=c;e.setJSROOTSize=function(a,b){if(this.jsroot_render3d===JSROOT.constants.Render3D.WebGLImage&&!JSROOT.batch_mode&&!JSROOT.nodejs)return k.select(this.jsroot_dom).attr("width",a).attr("height",b)};return e};g.beforeRender3D=function(a){a.clearHTML&&a.clearHTML()};g.afterRender3D=function(a){var b=JSROOT.constants.Render3D;if(a.jsroot_render3d!=b.WebGL)if(a.jsroot_render3d==b.SVG)if(JSROOT.batch_mode)JSROOT._.svg_3ds[a.workaround_id]=
a.makeOuterHTML();else{if(b=a.jsroot_dom.parentNode)b.innerHTML=a.makeOuterHTML(),a.jsroot_dom=b.firstChild}else if(JSROOT.nodejs){b=a.domElement;var c=b.getContext("2d"),e=new Uint8Array(4*b.width*b.height);a.readRenderTargetPixels(a.jsroot_output,0,0,b.width,b.height,e);for(var f=0,h=4*(b.height-1)*b.width,g,m;f<h;){for(g=0;g<4*b.width;++g)m=e[f+g],e[f+g]=e[h+g],e[h+g]=m;f+=4*b.width;h-=4*b.width}f=c.createImageData(b.width,b.height);f.data.set(e);c.putImageData(f,0,0);c=b.toDataURL("image/png");
JSROOT._.svg_3ds[a.workaround_id]='<image width="'+b.width+'" height="'+b.height+'" xlink:href="'+c+'"></image>'}else b=a.domElement.toDataURL("image/png"),k.select(a.jsroot_dom).attr("xlink:href",b)};g.processSvgWorkarounds=function(a,b){if(!JSROOT._.svg_3ds)return a;for(var c=0;c<JSROOT._.svg_3ds.length;++c)a=a.replace('<path jsroot_svg_workaround="'+c+'"></path>',JSROOT._.svg_3ds[c]);b||(JSROOT._.svg_3ds=void 0);return a};t.prototype.checkParent=function(a){a&&this.parent!==a&&(this.hide(),this.parent=
a)};t.prototype.extract_pos=function(a){if("object"==typeof a&&void 0!==a.u&&void 0!==a.l)return a;var b={u:0,l:0};this.abspos?(b.l=a.pageX,b.u=a.pageY):(b.l=a.offsetX,b.u=a.offsetY);return b};t.prototype.pos=function(a){if(this.tt){a=this.extract_pos(a);if(!this.abspos){var b=this.parent.getBoundingClientRect(),c=this.canvas.getBoundingClientRect();void 0!==b.left&&void 0!==c.left&&(a.l+=c.left-b.left);void 0!==b.top&&void 0!==c.top&&(a.u+=c.top-b.top);a.l+this.tt.offsetWidth+3>=this.parent.offsetWidth&&
(a.l=this.parent.offsetWidth-this.tt.offsetWidth-3);a.u+this.tt.offsetHeight+15>=this.parent.offsetHeight&&(a.u=this.parent.offsetHeight-this.tt.offsetHeight-15);for(c=this.parent;c;){var e=getComputedStyle(c);if(!e||"static"!==e.position)break;if(!c.parentNode||1!=c.parentNode.nodeType)break;c=c.parentNode}c&&c!==this.parent&&(c=c.getBoundingClientRect(),a.l+=b.left-c.left,a.u+=b.top-c.top)}this.tt.style.top=a.u+15+"px";this.tt.style.left=a.l+3+"px"}};t.prototype.show=function(a){if(!a||""===a)return this.hide();
if("object"==typeof a&&(a.lines||a.line)){if(a.only_status)return this.hide();if(a.line)a=a.line;else{for(var b=a.lines[0],c=1;c<a.lines.length;++c)b+="<br/>"+a.lines[c];a=b}}null===this.tt&&(this.tt=document.createElement("div"),this.tt.setAttribute("class","jsroot_tt3d_main"),this.cont=document.createElement("div"),this.cont.setAttribute("class","jsroot_tt3d_cont"),this.tt.appendChild(this.cont),this.parent.appendChild(this.tt));this.lastlbl!==a&&(this.lastlbl=this.cont.innerHTML=a,this.tt.style.width=
"auto")};t.prototype.hide=function(){null!==this.tt&&this.parent.removeChild(this.tt);this.tt=null;this.lastlbl=""};g.createOrbitControl=function(a,b,c,e,g){function h(a){if(d)if(d.mouse_zoom_mesh)a.stopImmediatePropagation(),a.stopPropagation();else if(void 0===a.button||0===a.button)if(void 0===a.buttons||1===a.buttons){if(d.enable_zoom&&(d.mouse_zoom_mesh=d.detectZoomMesh(a),d.mouse_zoom_mesh)){a.stopImmediatePropagation();a.stopPropagation();return}d.enable_select&&(d.mouse_select_pnt=d.getMousePos(a,
{}))}}function p(a){if(d){if(d.mouse_zoom_mesh&&d.mouse_zoom_mesh.point2&&d.painter.Get3DZoomCoord){var b=d.mouse_zoom_mesh.object.zoom,c=d.painter.Get3DZoomCoord(d.mouse_zoom_mesh.point,b),l=d.painter.Get3DZoomCoord(d.mouse_zoom_mesh.point2,b);if(c>l){var e=c;c=l;l=e}"z"===b&&d.mouse_zoom_mesh.object.use_y_for_z&&(b="y");"z"===b&&d.mouse_zoom_mesh.object.use_y_for_z&&(b="y");c<l&&d.painter.zoom(b,c,l)&&(d.mouse_zoom_mesh=null)}d.enable_zoom&&d.removeZoomMesh();d.enable_select&&d.mouse_select_pnt&&
(b=d.getMousePos(a,{}),c=b.x==d.mouse_select_pnt.x&&b.y==d.mouse_select_pnt.y,delete d.mouse_select_pnt,c&&(c=d.getMouseIntersects(b),d.painter.processMouseClick(b,c,a)))}}function m(a){if(d){var b=(b=d.painter)&&void 0!==b.renderer?void 0!==b.render_tmout:!1;if(b||d.mouse_zoom_mesh)a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();else if(b=d.detectZoomMesh(a))if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),d.painter&&"function"==typeof d.painter.analyzeMouseWheelEvent){var c=
b.object.zoom,e=b.point[c],l={name:c,ignore:!1};e="z"!==c?(e+d.painter.size_xy3d)/2/d.painter.size_xy3d:e/2/d.painter.size_z3d;d.painter.analyzeMouseWheelEvent(a,l,e,!1);"z"===c&&b.object.use_y_for_z&&(c="y");d.painter.zoom(c,l.min,l.max)}}}var d=null,q=JSROOT.settings.Zooming&&JSROOT.settings.ZoomMouse,k="function"==typeof a.processMouseClick;JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel&&e.domElement.addEventListener("wheel",m);if(q||k)e.domElement.addEventListener("pointerdown",h),e.domElement.addEventListener("pointerup",
p);d=new f.OrbitControls(b,e.domElement);d.enableDamping=!1;d.dampingFactor=1;d.enableZoom=!0;d.enableKeys=JSROOT.settings.HandleKeys;g&&(d.target.copy(g),d.target0.copy(g),d.update());d.tooltip=new t(a.selectDom().node(),e.domElement);d.painter=a;d.camera=b;d.scene=c;d.renderer=e;d.raycaster=new f.Raycaster;d.raycaster.params.Line.threshold=10;d.raycaster.params.Points.threshold=5;d.mouse_zoom_mesh=null;d.block_ctxt=!1;d.block_mousemove=!1;d.cursor_changed=!1;d.control_changed=!1;d.control_active=
!1;d.mouse_ctxt={x:0,y:0,on:!1};d.enable_zoom=q;d.enable_select=k;d.cleanup=function(){JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel&&this.domElement.removeEventListener("wheel",m);if(this.enable_zoom||this.enable_select)this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointerup",p);this.lstn_click&&this.domElement.removeEventListener("click",this.lstn_click);this.domElement.removeEventListener("dblclick",this.lstn_dblclick);this.domElement.removeEventListener("contextmenu",
this.lstn_contextmenu);this.domElement.removeEventListener("mousemove",this.lstn_mousemove);this.domElement.removeEventListener("mouseleave",this.lstn_mouseleave);this.dispose();this.tooltip.hide();delete this.tooltip;delete this.painter;delete this.camera;delete this.scene;delete this.renderer;delete this.raycaster;delete this.mouse_zoom_mesh};d.HideTooltip=function(){this.tooltip.hide()};d.getMousePos=function(a,b){b.x="offsetX"in a?a.offsetX:a.layerX;b.y="offsetY"in a?a.offsetY:a.layerY;b.clientX=
a.clientX;b.clientY=a.clientY;return b};d.getOriginDirectionIntersects=function(a,b){this.raycaster.set(a,b);a=this.raycaster.intersectObjects(this.scene.children,!0);"function"==typeof this.painter.filterIntersects&&(a=this.painter.filterIntersects(a));return a};d.getMouseIntersects=function(a){if(!this.renderer)return[];var b=this.renderer instanceof f.WebGLRenderer?this.renderer.getSize(new f.Vector2):this.renderer.domElement;a={x:a.x/b.width*2-1,y:-a.y/b.height*2+1};this.camera.updateMatrix();
this.camera.updateMatrixWorld();this.raycaster.setFromCamera(a,this.camera);a=this.raycaster.intersectObjects(this.scene.children,!0);"function"==typeof this.painter.filterIntersects&&(a=this.painter.filterIntersects(a));return a};d.detectZoomMesh=function(a){a=this.getMousePos(a,{});if(a=this.getMouseIntersects(a))for(var b=0;b<a.length;++b)if(a[b].object.zoom)return a[b];return null};d.processDblClick=function(a){(a=this.detectZoomMesh(a))&&this.painter?this.painter.unzoom(a.object.use_y_for_z?
"y":a.object.zoom):this.reset()};d.changeEvent=function(){this.mouse_ctxt.on=!1;this.painter.render3D(0);this.control_changed=!0};d.startEvent=function(){this.control_active=!0;this.block_ctxt=!1;this.mouse_ctxt.on=!1;this.tooltip.hide()};d.endEvent=function(){this.control_active=!1;this.mouse_ctxt.on&&(this.mouse_ctxt.on=!1,this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt)));this.control_changed=!1};d.mainProcessContextMenu=function(a){a.preventDefault();this.getMousePos(a,
this.mouse_ctxt);this.control_active?this.mouse_ctxt.on=!0:this.block_ctxt?this.block_ctxt=!1:this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt))};d.contextMenu=function(){};d.setTooltipEnabled=function(a){this.block_mousemove=!a;!1===a&&(this.tooltip.hide(),this.removeZoomMesh())};d.removeZoomMesh=function(){this.mouse_zoom_mesh&&this.mouse_zoom_mesh.object.ShowSelection()&&this.painter.render3D();this.mouse_zoom_mesh=null};d.mainProcessMouseMove=function(a){var b=this;if(this.painter&&
(this.control_active&&a.buttons&&a.buttons&2&&(this.block_ctxt=!0),!this.control_active&&!this.block_mousemove&&this.ProcessMouseMove))if(this.mouse_zoom_mesh){a=this.detectZoomMesh(a);var c=null;if(c=a&&a.object===this.mouse_zoom_mesh.object?a.point:this.mouse_zoom_mesh.object.GlobalIntersect(this.raycaster))this.mouse_zoom_mesh.point2=c;c&&this.painter.enable_highlight&&this.mouse_zoom_mesh.object.ShowSelection(this.mouse_zoom_mesh.point,c)&&this.painter.render3D(0);this.tooltip.hide()}else a.preventDefault(),
this.tmout_mouse=this.getMousePos(a,{}),this.tmout_ttpos=this.tooltip?this.tooltip.extract_pos(a):null,this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.mouse_tmout?this.tmout_handle=setTimeout(function(){return b.delayedProcessMouseMove()},this.mouse_tmout):this.delayedProcessMouseMove()};d.delayedProcessMouseMove=function(){delete this.tmout_handle;if(this.painter){var a=this.tmout_mouse,b=this.getMouseIntersects(a),c=this.ProcessMouseMove(b);if(c){var d="",e="",
f="",g="";a&&(f=a.x.toFixed(0)+","+a.y.toFixed(0));"string"==typeof c?g=c:(d=c.name,e=c.title,c.line?g=c.line:c.lines&&(g=c.lines.slice(1).join(" "),d=c.lines[0]));this.painter.showObjectStatus(d,e,g,f)}this.cursor_changed=!1;if(c&&this.painter&&this.painter.isTooltipAllowed())this.tooltip.checkParent(this.painter.selectDom().node()),this.tooltip.show(c,a),this.tooltip.pos(this.tmout_ttpos);else if(this.tooltip.hide(),b)for(a=0;a<b.length;++a)b[a].object.zoom&&(this.cursor_changed=!0);document.body.style.cursor=
this.cursor_changed?"pointer":"auto"}};d.mainProcessMouseLeave=function(){this.painter&&(this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.tooltip.hide(),"function"===typeof this.ProcessMouseLeave&&this.ProcessMouseLeave(),this.cursor_changed&&(document.body.style.cursor="auto",this.cursor_changed=!1))};d.mainProcessDblClick=function(a){this.processDblClick(a)};a&&a.options&&a.options.mouse_click&&(d.processClick=function(a){"function"==typeof this.ProcessSingleClick&&
(a=this.getMouseIntersects(a),this.ProcessSingleClick(a))},d.lstn_click=function(a){this.single_click_tm&&(clearTimeout(this.single_click_tm),delete this.single_click_tm);2!=a.detail&&(this.single_click_tmout=setTimeout(this.processClick.bind(this,this.getMousePos(a,{})),300))}.bind(d));d.addEventListener("change",function(){return d.changeEvent()});d.addEventListener("start",function(){return d.startEvent()});d.addEventListener("end",function(){return d.endEvent()});d.lstn_contextmenu=function(a){return d.mainProcessContextMenu(a)};
d.lstn_dblclick=function(a){return d.mainProcessDblClick(a)};d.lstn_mousemove=function(a){return d.mainProcessMouseMove(a)};d.lstn_mouseleave=function(){return d.mainProcessMouseLeave()};d.lstn_click&&e.domElement.addEventListener("click",d.lstn_click);e.domElement.addEventListener("dblclick",d.lstn_dblclick);e.domElement.addEventListener("contextmenu",d.lstn_contextmenu);e.domElement.addEventListener("mousemove",d.lstn_mousemove);e.domElement.addEventListener("mouseleave",d.lstn_mouseleave);return d};
g.disposeThreejsObject=function(a,b){if(a){if(a.children)for(var c=0;c<a.children.length;c++)g.disposeThreejsObject(a.children[c]);b?a.children=[]:(a.children=void 0,a.geometry&&(a.geometry.dispose(),a.geometry=void 0),a.material&&(a.material.map&&(a.material.map.dispose(),a.material.map=void 0),a.material.dispose(),a.material=void 0),delete a.painter,delete a.bins_index,delete a.tooltip,delete a.stack,delete a.drawn_highlight)}};g.createLineSegments=function(a,b,c,e){var g=new f.BufferGeometry;g.setAttribute("position",
a instanceof Float32Array?new f.BufferAttribute(a,3):new f.Float32BufferAttribute(a,3));c&&g.setIndex(new f.BufferAttribute(c,1));if(b.isLineDashedMaterial){var h=new f.Vector3,k=new f.Vector3,m=0;if(c){var d=new Float32Array(c.length);for(var q=0;q<c.length;q+=2){var n=c[q],l=c[q+1];h.set(a[n],a[n+1],a[n+2]);k.set(a[l],a[l+1],a[l+2]);d[q]=m;m+=k.distanceTo(h);d[q+1]=m}}else for(d=new Float32Array(a.length/3),c=0;c<a.length;c+=6)h.set(a[c],a[c+1],a[c+2]),k.set(a[c+3],a[c+4],a[c+5]),d[c/3]=m,m+=k.distanceTo(h),
d[c/3+1]=m;g.setAttribute("lineDistance",new f.BufferAttribute(d,1))}return e?g:new f.LineSegments(g,b)};g.Box3D={Vertices:[new f.Vector3(1,1,1),new f.Vector3(1,1,0),new f.Vector3(1,0,1),new f.Vector3(1,0,0),new f.Vector3(0,1,0),new f.Vector3(0,1,1),new f.Vector3(0,0,0),new f.Vector3(0,0,1)],Indexes:[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4],Normals:[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],Segments:[0,2,2,7,7,5,5,0,1,3,3,6,6,4,4,1,1,0,3,2,6,7,4,5]};g.Box3D.MeshSegments=
function(){for(var a=g.Box3D,b=new Int32Array(a.Segments.length),c=0;c<b.length;++c)for(var e=0;e<a.Indexes.length;++e)if(a.Segments[c]===a.Indexes[e]){b[c]=e;break}return b}();n.prototype.cleanup=function(){};n.prototype.extractIndex=function(){};n.prototype.setSelected=function(){};n.prototype.setHighlight=function(){};n.prototype.checkHighlightIndex=function(){};r.prototype=Object.create(n.prototype);r.prototype.cleanup=function(){this.mesh&&(delete this.mesh.is_selected,this.createSpecial(null),
delete this.mesh)};r.prototype.extractIndex=function(a){return a&&void 0!==a.index?a.index:void 0};r.prototype.setSelected=function(a,b){var c=this.mesh;c.select_col==a&&c.select_indx==b&&(a=null,b=void 0);c.select_col=a;c.select_indx=b;this.createSpecial(a,b);return!0};r.prototype.setHighlight=function(a,b){var c=this.mesh;c.h_index=b;a?this.createSpecial(a,b):this.createSpecial(c.select_col,c.select_indx);return!0};r.prototype.createSpecial=function(a,b){var c=this.mesh;if(a){if(!c.js_special){var e=
new f.BufferGeometry;e.setAttribute("position",c.geometry.getAttribute("position"));var p=new f.PointsMaterial({size:2*c.material.size,color:a});p.sizeAttenuation=c.material.sizeAttenuation;c.js_special=new f.Points(e,p);c.js_special.jsroot_special=!0;c.add(c.js_special)}c.js_special.material.color=new f.Color(a);void 0!==b&&c.js_special.geometry.setDrawRange(b,1)}else c.js_special&&(c.remove(c.js_special),g.disposeThreejsObject(c.js_special),delete c.js_special)};v.prototype.addPoint=function(a,
b,c){this.pos[this.indx]=a;this.pos[this.indx+1]=b;this.pos[this.indx+2]=c;this.indx+=3};v.prototype.createPoints=function(a){"object"!==typeof a&&(a={color:a});a.color||(a.color="black");var b=1;a.style?1===a.style?b=.3:2===a.style?a.style=3:6===a.style?b=.5:7===a.style&&(b=.7):b=1.1;!a.style||1!==b||JSROOT.nodejs?a=new f.PointsMaterial({size:(this.webgl?3:1)*this.scale*b,color:a.color}):(a=new JSROOT.TAttMarkerHandler({style:a.style,color:a.color,size:8}),a='<svg width="70" height="70" xmlns="http://www.w3.org/2000/svg"><path d="'+
a.create(35,35)+'" stroke="'+a.getStrokeColor()+'" stroke-width="4" fill="'+a.getFillColor()+'"/></svg>',a=(new f.TextureLoader).load("data:image/svg+xml;utf8,"+a),a=new f.PointsMaterial({size:(this.webgl?3:1)*this.scale,map:a,transparent:!0}));a=new f.Points(this.geom,a);a.nvertex=1;return a};g.PointsCreator=v;g.InteractiveControl=n;g.PointsControl=r;g.drawPolyLine3D=function(){var a=this.getObject(),b=this.getFramePainter();if(!(b&&b.mode3d&&b.toplevel&&a))return null;var c=[];if(a._blob&&4==a._blob.length){var e=
a._blob[1];var f=a._blob[2]}else e=a.fN,f=a.fP;for(var h=3;h<3*e;h+=3)c.push(b.grx(f[h-3]),b.gry(f[h-2]),b.grz(f[h-1]),b.grx(f[h]),b.gry(f[h+1]),b.grz(f[h+2]));a=g.createLineSegments(c,w(this,a));b.toplevel.add(a);return!0};g.create3DLineMaterial=w;JSROOT.nodejs&&(module.exports=f);return f});
