<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Submit HEPData BaBar 2012 $\sigma(e^+e^- \rightarrow \pi^+\pi^- (\gamma))$ | PrecisionSM</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://precision-sm.github.io/posts/hepdata-subm-babar-2012-pip-pim/">
<link rel="shortcut icon" href="../../favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
<meta name="author" content="PrecisionSM Group">
<link rel="prev" href="../example-root-plot-with-hepdata-submissions/" title="Example Root plot with two HEPData submissions" type="text/html">
<link rel="next" href="../hepdata-check-babar-2012-pip-pim/" title="Check HEPData BaBar 2012 $\sigma(e^+e^- \rightarrow \pi^+\pi^- (\gamma))$" type="text/html">
<meta property="og:site_name" content="PrecisionSM">
<meta property="og:title" content="Submit HEPData BaBar 2012 $\sigma(e^+e^- \rightarrow \pi^+\pi^- (\gamm">
<meta property="og:url" content="https://precision-sm.github.io/posts/hepdata-subm-babar-2012-pip-pim/">
<meta property="og:description" content="HEPData submit BaBar 2012 $\sigma(e^+e^- \to \pi^+ \pi^- (\gamma))$¶Paper¶
Phys.Rev.D 86 (2012) 032013, 2012
InspireHEP 1114155

HEPData documentation for submissions¶
https://hepdata-submission.readt">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-11-22T12:00:00Z">
<meta property="article:tag" content="BaBar">
<meta property="article:tag" content="HEPData">
<link rel="stylesheet" href="../../assets/css/post_ipynb.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md sticky-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">PrecisionSM</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contents</a>
            <div class="dropdown-menu">
                    <a href="../../measurements-db/" class="dropdown-item">Measurements Database</a>
                    <a href="../../categories/submissions" class="dropdown-item">Data Submissions</a>
                    <a href="../../categories/checks" class="dropdown-item">Data Submissions Checks</a>
                    <a href="../../categories/plots" class="dropdown-item">Plots</a>
            </div>
                </li>
<li class="nav-item">
<a href="../../categories/docs/" class="nav-link">Docs</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
            <div class="dropdown-menu">
                    <a href="../../about/" class="dropdown-item">About</a>
                    <a href="../../categories/" class="dropdown-item">Sections</a>
                    <a href="../../tags/" class="dropdown-item">Tags</a>
                    <a href="../" class="dropdown-item">All Posts</a>
                    <a href="../../archive.html" class="dropdown-item">Archive</a>
            </div>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
    <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="Search"><button type="submit" class="btn btn-secondary">
            <i class="fa fa-search"></i>
        </button>
        <input type="hidden" name="sitesearch" value="https://precision-sm.github.io/">
</div>
</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Submit HEPData BaBar 2012 $\sigma(e^+e^- \rightarrow \pi^+\pi^- (\gamma))$</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    PrecisionSM Group
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-11-22T12:00:00Z" itemprop="datePublished" title="2021-11-22 12:00">2021-11-22 12:00</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="cell border-box-sizing text_cell rendered" id="cell-id=fa3874ee-a795-4b7a-ae91-dea7381f83aa">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<!-- TEASER_END -->
<h2 id="HEPData-submit-BaBar-2012-$%5Csigma(e%5E+e%5E--%5Cto-%5Cpi%5E+-%5Cpi%5E--(%5Cgamma))$">HEPData submit BaBar 2012 $\sigma(e^+e^- \to \pi^+ \pi^- (\gamma))$<a class="anchor-link" href="#HEPData-submit-BaBar-2012-$%5Csigma(e%5E+e%5E--%5Cto-%5Cpi%5E+-%5Cpi%5E--(%5Cgamma))$">¶</a>
</h2>
<h3 id="Paper">Paper<a class="anchor-link" href="#Paper">¶</a>
</h3>
<ul>
<li><a href="https://doi.org/10.1103/PhysRevD.86.032013">Phys.Rev.D 86 (2012) 032013, 2012</a></li>
<li><a href="https://inspirehep.net/literature/1114155">InspireHEP 1114155</a></li>
</ul>
<h3 id="HEPData-documentation-for-submissions">HEPData documentation for submissions<a class="anchor-link" href="#HEPData-documentation-for-submissions">¶</a>
</h3>
<ul>
<li><a href="https://hepdata-submission.readthedocs.io/en/latest/">https://hepdata-submission.readthedocs.io/en/latest/</a></li>
</ul>
<h3 id="Requirements">Requirements<a class="anchor-link" href="#Requirements">¶</a>
</h3>
<ul>
<li>
<a href="https://github.com/HEPData/hepdata_lib">hepdata_lib</a> python3 library<ul>
<li>
<a href="https://root.cern.ch">ROOT</a> with Python3 libraries</li>
<li><a href="https://www.imagemagick.org">ImageMagick</a></li>
<li>Make sure that you have <code>ROOT</code> in your <code>$PYTHONPATH</code> and that the <code>convert</code> command is available by adding its location to your <code>$PATH</code> if needed.</li>
</ul>
</li>
</ul>
<h3 id="Notes">Notes<a class="anchor-link" href="#Notes">¶</a>
</h3>
<p>In the supplementary material, numbers are printed into strings. We do not convert these strings to numeric format when reading the supplementary material, since the hepdata_lib code works with strings as well.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=fbe9b162-0f47-41cb-8726-d0f07740d9fe">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">array</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">requote_uri</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=a0ac8a2e-4235-4cb3-b056-9c16a545e842">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">## import hepdata_lib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hepdata_lib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Submission</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hepdata_lib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hepdata_lib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">Uncertainty</span>
<span class="c1">## from hepdata_lib import RootFileReader</span>
<span class="c1">## from hepdata_lib import root_utils</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Welcome to JupyROOT 6.24/06
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=af3bed9c-c99a-41b6-88d1-d3d927ab8033">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## globals</span>
<span class="c1">##</span>

<span class="n">myfolder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"hepdata-babar-2012-pip-pim"</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">myfolder</span><span class="p">):</span>
  <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">myfolder</span><span class="p">)</span>

<span class="n">suppmat_fname</span> <span class="o">=</span> <span class="s2">"BABAR_ISR2pi_EPAPS.txt"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=3980ecde-766a-4321-9e7b-7b3c666fa416">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## procedures</span>
<span class="c1">##</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cd</span><span class="p">(</span><span class="n">newdir</span><span class="p">):</span>
  <span class="n">prevdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
  <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">newdir</span><span class="p">))</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">yield</span>
  <span class="k">finally</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">prevdir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=5a9462e7-0354-4a79-b0e4-9cbd9a281fb1">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## abstract</span>
<span class="c1">##</span>
<span class="n">paper_abstract</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"""A precise measurement of the cross section of the process $e^+e^- \to</span>
<span class="s2">\pi^+\pi^-(\gamma)$ from threshold to an energy of $3$ GeV is obtained with the</span>
<span class="s2">initial-state radiation (ISR) method using $232$ fb$^{-1}$ of data collected</span>
<span class="s2">with the BaBar detector at $e^+e^-$ center-of-mass energies near $10.6$ GeV.</span>
<span class="s2">The ISR luminosity is determined from a study of the leptonic process</span>
<span class="s2">$e^+e^-\to\mu^+\mu^-(\gamma)\gamma_{\rm ISR}$, which is found to agree with the</span>
<span class="s2">next-to-leading-order QED prediction to within 1.1\%. The cross section for the</span>
<span class="s2">process $e^+e^-\to\pi^+\pi^-(\gamma)$ is obtained with a systematic uncertainty</span>
<span class="s2">of 0.5\</span><span class="si">% i</span><span class="s2">n the dominant $\rho$ resonance region. The leading-order hadronic</span>
<span class="s2">contribution to the muon magnetic anomaly calculated using the measured</span>
<span class="s2">$\pi\pi$ cross section from threshold to $1.8$ GeV is $(514.1 \pm 2.2({\rm</span>
<span class="s2">stat}) \pm 3.1({\rm syst}))\times 10^{-10}$."""</span>
<span class="n">paper_abstract</span> <span class="o">=</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paper_abstract</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=3d804c63-dfd6-4a32-9715-ac2064b080f2">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## download BaBar Phys. Rev. D 86 (2012) 032013 suppl. mat.</span>
<span class="c1">##</span>
<span class="c1">## was available without authentication until end 2021</span>
<span class="c1">## but recently became unavailable</span>
<span class="c1">##</span>
<span class="c1"># babar_data_url = """\</span>
<span class="c1"># http://ftp.aip.org/\</span>
<span class="c1"># epaps/phys_rev_lett/E-PRLTAO-103-045950/BABAR_ISR2pi_EPAPS.txt\</span>
<span class="c1"># """</span>
<span class="c1"># tmpfile, headers = urllib.request.urlretrieve(babar_data_url)</span>
<span class="c1"># tmpfile</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=c4001d2a-b87d-479f-adc2-7468be042341">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## download with authentication from PRD supplementary material archive</span>
<span class="c1">## in https://journals.aps.org/prd/supplemental/10.1103/PhysRevD.86.032013</span>
<span class="c1">## and place the file in the location in "tmpfile"</span>
<span class="c1">##</span>
<span class="n">babar_data_url</span> <span class="o">=</span> <span class="s2">"https://journals.aps.org/prd/supplemental/10.1103/PhysRevD.86.032013"</span>
<span class="n">tmpfile</span> <span class="o">=</span> <span class="n">myfolder</span> <span class="o">/</span> <span class="n">suppmat_fname</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=8927a773-1c8c-479b-9435-284e55e6e8cb">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## read cross-section values and uncertainties by energy bins</span>
<span class="c1">##</span>
<span class="n">sigma_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">tmpfile</span><span class="p">,</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"E_lo"</span><span class="p">,</span> <span class="s2">"colon"</span><span class="p">,</span> <span class="s2">"E_hi"</span><span class="p">,</span> <span class="s2">"sigma_val"</span><span class="p">,</span> <span class="s2">"sigma_unc"</span><span class="p">],</span>
  <span class="n">skiprows</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">337</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\s+"</span>
<span class="p">)</span>
<span class="n">sigma_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">"colon"</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sigma_df</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>
<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
<th>E_lo</th>
<th>E_hi</th>
<th>sigma_val</th>
<th>sigma_unc</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>0.30</td>
<td>0.31</td>
<td>25.490436</td>
<td>2.699430</td>
</tr>
<tr>
<th>1</th>
<td>0.31</td>
<td>0.32</td>
<td>35.480116</td>
<td>2.914640</td>
</tr>
<tr>
<th>2</th>
<td>0.32</td>
<td>0.33</td>
<td>45.485797</td>
<td>3.046690</td>
</tr>
<tr>
<th>3</th>
<td>0.33</td>
<td>0.34</td>
<td>51.782467</td>
<td>3.133550</td>
</tr>
<tr>
<th>4</th>
<td>0.34</td>
<td>0.35</td>
<td>64.415646</td>
<td>3.499530</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>332</th>
<td>2.50</td>
<td>2.60</td>
<td>0.047650</td>
<td>0.018634</td>
</tr>
<tr>
<th>333</th>
<td>2.60</td>
<td>2.70</td>
<td>0.024211</td>
<td>0.013667</td>
</tr>
<tr>
<th>334</th>
<td>2.70</td>
<td>2.80</td>
<td>0.013945</td>
<td>0.014118</td>
</tr>
<tr>
<th>335</th>
<td>2.80</td>
<td>2.90</td>
<td>0.009181</td>
<td>0.013260</td>
</tr>
<tr>
<th>336</th>
<td>2.90</td>
<td>3.00</td>
<td>0.010228</td>
<td>0.012373</td>
</tr>
</tbody>
</table>
<p>337 rows × 4 columns</p>
</div></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=7b9eb4e4-29e8-4eef-b470-27898f7ccd70">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## read systematics</span>
<span class="c1">##</span>

<span class="c1">##</span>
<span class="c1">## BaBar data format</span>
<span class="c1">##</span>
<span class="c1">#              Energy Intervals (GeV)</span>
<span class="c1">#          </span>
<span class="c1">#    0.3-0.4  0.4-0.5  0.5-0.6  0.6-0.9  0.9-1.2  1.2-1.4  1.4-2.0  2.0-3.0</span>
<span class="c1">#</span>
<span class="c1"># 1    5.3      2.7      1.9      1.0      0.5      0.4      0.3      0.3 </span>
<span class="c1"># 2    3.8      2.1      2.1      1.1      1.7      3.1      3.1      3.1 </span>
<span class="c1"># 3   10.1      2.5      6.2      2.4      4.2     10.1     10.1     10.1</span>
<span class="c1"># 4    3.5      4.3      5.2      1.0      3.0      7.0     12.0     50.0</span>
<span class="c1"># 5    1.6      1.6      1.0      1.0      1.6      1.6      1.6      1.6</span>
<span class="c1"># 6    0.9      0.9      0.3      0.3      0.9      0.9      0.9      0.9</span>
<span class="c1"># 7    3.0      2.0      3.0      1.3      2.0      3.0     10.0     10.0</span>
<span class="c1"># 8    2.7      1.4      1.6      1.1      1.3      2.7      5.1      5.1</span>
<span class="c1"># 9    1.0      2.7      2.7      1.0      1.3      1.0      1.0      1.0</span>
<span class="c1"># 10   3.4      3.4      3.4      3.4      3.4      3.4      3.4      3.4</span>
<span class="c1">#</span>
<span class="c1">#    (13.8)    (8.1)   (10.2)    (5.0)    (6.5)   (13.9)   (19.8)   (52.4) </span>
<span class="c1">#</span>

<span class="c1">##</span>
<span class="c1">## read edges of E for systematics, in a single line</span>
<span class="c1">## format is space-separated sequence of "&lt;El&gt;-&lt;Eh&gt;"</span>
<span class="c1">## </span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">tmpfile</span><span class="p">,</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">skiprows</span><span class="o">=</span><span class="mi">387</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\s+"</span>
<span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## - get first row of tmp_df</span>
<span class="c1">## - join first row values in a series of lines separated with newline</span>
<span class="c1">## - interpret each line as two numbers separated by "-"</span>
<span class="c1">## - output is data frame with columns El, Eh</span>
<span class="c1">##</span>
<span class="n">sigma_syst_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"E_lo"</span><span class="p">,</span> <span class="s2">"E_hi"</span><span class="p">],</span>
  <span class="n">sep</span><span class="o">=</span><span class="s2">"-"</span>
<span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## read total systematics for E bins in permille</span>
<span class="c1">## sequence of numbers in round brakets</span>
<span class="c1">##</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">tmpfile</span><span class="p">,</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">skiprows</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\s+"</span>
<span class="p">)</span>
<span class="c1">##--- read column with total syst unc</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"[\(\)]"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## - convert total unc in 1st column from permille to percent</span>
<span class="c1">## - add to data frame as 3rd column after El, Eh</span>
<span class="c1">##</span>
<span class="n">sigma_syst_df</span> <span class="o">=</span> <span class="n">sigma_syst_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">unc_syst_perc_tot</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## read systematics contributions table in permille</span>
<span class="c1">## each row is a systematics contribution</span>
<span class="c1">## each column corresponds to an energy bin</span>
<span class="c1">##</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">tmpfile</span><span class="p">,</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">skiprows</span><span class="o">=</span><span class="mi">389</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\s+"</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## - drop first column with number of systematic contribution</span>
<span class="c1">## - transpose to get energy bins in rows, contribution in columns</span>
<span class="c1">## </span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="c1">##--- name columns of the 10 syst contributoins</span>
<span class="n">tmp_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"unc_</span><span class="si">%02d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="c1">##</span>
<span class="c1">## concat columnwise </span>
<span class="c1">## - data frame with energy bins and total syst unc</span>
<span class="c1">## - data frame with syst unc contributions, converted from permille to percent</span>
<span class="c1">##</span>
<span class="n">sigma_syst_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
  <span class="p">[</span>
    <span class="n">sigma_syst_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tmp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">sigma_syst_df</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>
<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
<th>E_lo</th>
<th>E_hi</th>
<th>unc_syst_perc_tot</th>
<th>unc_01</th>
<th>unc_02</th>
<th>unc_03</th>
<th>unc_04</th>
<th>unc_05</th>
<th>unc_06</th>
<th>unc_07</th>
<th>unc_08</th>
<th>unc_09</th>
<th>unc_10</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>0.3</td>
<td>0.4</td>
<td>1.38</td>
<td>0.53</td>
<td>0.38</td>
<td>1.01</td>
<td>0.35</td>
<td>0.16</td>
<td>0.09</td>
<td>0.30</td>
<td>0.27</td>
<td>0.10</td>
<td>0.34</td>
</tr>
<tr>
<th>1</th>
<td>0.4</td>
<td>0.5</td>
<td>0.81</td>
<td>0.27</td>
<td>0.21</td>
<td>0.25</td>
<td>0.43</td>
<td>0.16</td>
<td>0.09</td>
<td>0.20</td>
<td>0.14</td>
<td>0.27</td>
<td>0.34</td>
</tr>
<tr>
<th>2</th>
<td>0.5</td>
<td>0.6</td>
<td>1.02</td>
<td>0.19</td>
<td>0.21</td>
<td>0.62</td>
<td>0.52</td>
<td>0.10</td>
<td>0.03</td>
<td>0.30</td>
<td>0.16</td>
<td>0.27</td>
<td>0.34</td>
</tr>
<tr>
<th>3</th>
<td>0.6</td>
<td>0.9</td>
<td>0.50</td>
<td>0.10</td>
<td>0.11</td>
<td>0.24</td>
<td>0.10</td>
<td>0.10</td>
<td>0.03</td>
<td>0.13</td>
<td>0.11</td>
<td>0.10</td>
<td>0.34</td>
</tr>
<tr>
<th>4</th>
<td>0.9</td>
<td>1.2</td>
<td>0.65</td>
<td>0.05</td>
<td>0.17</td>
<td>0.42</td>
<td>0.30</td>
<td>0.16</td>
<td>0.09</td>
<td>0.20</td>
<td>0.13</td>
<td>0.13</td>
<td>0.34</td>
</tr>
<tr>
<th>5</th>
<td>1.2</td>
<td>1.4</td>
<td>1.39</td>
<td>0.04</td>
<td>0.31</td>
<td>1.01</td>
<td>0.70</td>
<td>0.16</td>
<td>0.09</td>
<td>0.30</td>
<td>0.27</td>
<td>0.10</td>
<td>0.34</td>
</tr>
<tr>
<th>6</th>
<td>1.4</td>
<td>2.0</td>
<td>1.98</td>
<td>0.03</td>
<td>0.31</td>
<td>1.01</td>
<td>1.20</td>
<td>0.16</td>
<td>0.09</td>
<td>1.00</td>
<td>0.51</td>
<td>0.10</td>
<td>0.34</td>
</tr>
<tr>
<th>7</th>
<td>2.0</td>
<td>3.0</td>
<td>5.24</td>
<td>0.03</td>
<td>0.31</td>
<td>1.01</td>
<td>5.00</td>
<td>0.16</td>
<td>0.09</td>
<td>1.00</td>
<td>0.51</td>
<td>0.10</td>
<td>0.34</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=aac1a008-4700-4ebe-9fcf-0ba2ba6fc692">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## get stat unc correlation</span>
<span class="c1">## it is a sequence of 337*337 values</span>
<span class="c1">##</span>

<span class="n">sigma_stat_cov_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="n">tmpfile</span><span class="p">,</span>
  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
  <span class="n">skiprows</span><span class="o">=</span><span class="mi">405</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">337</span><span class="o">*</span><span class="mi">337</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\s+"</span><span class="p">,</span>
  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"cov"</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## insert data frame columns with lo-hi row energy bin, lo-hi column energy bin</span>
<span class="c1">## (very verbose inefficient format but prepared for HEPData format)</span>
<span class="c1">##</span>
<span class="n">sigma_stat_cov_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"E_lo_i"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_lo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_lo</span><span class="p">)))</span>
<span class="n">sigma_stat_cov_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"E_hi_i"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_hi</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_hi</span><span class="p">)))</span>
<span class="n">sigma_stat_cov_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"E_lo_j"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_lo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_lo</span><span class="p">)))</span>
<span class="n">sigma_stat_cov_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"E_hi_j"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_hi</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigma_df</span><span class="o">.</span><span class="n">E_hi</span><span class="p">)))</span>

<span class="n">sigma_stat_cov_df</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>
<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
<th>E_lo_i</th>
<th>E_hi_i</th>
<th>E_lo_j</th>
<th>E_hi_j</th>
<th>cov</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>0.30</td>
<td>0.31</td>
<td>0.3</td>
<td>0.31</td>
<td>7.164117e+00</td>
</tr>
<tr>
<th>1</th>
<td>0.31</td>
<td>0.32</td>
<td>0.3</td>
<td>0.31</td>
<td>8.112126e-01</td>
</tr>
<tr>
<th>2</th>
<td>0.32</td>
<td>0.33</td>
<td>0.3</td>
<td>0.31</td>
<td>2.924933e-02</td>
</tr>
<tr>
<th>3</th>
<td>0.33</td>
<td>0.34</td>
<td>0.3</td>
<td>0.31</td>
<td>2.160734e-01</td>
</tr>
<tr>
<th>4</th>
<td>0.34</td>
<td>0.35</td>
<td>0.3</td>
<td>0.31</td>
<td>5.264122e-02</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>113564</th>
<td>2.50</td>
<td>2.60</td>
<td>2.9</td>
<td>3.00</td>
<td>1.793598e-13</td>
</tr>
<tr>
<th>113565</th>
<td>2.60</td>
<td>2.70</td>
<td>2.9</td>
<td>3.00</td>
<td>1.110301e-13</td>
</tr>
<tr>
<th>113566</th>
<td>2.70</td>
<td>2.80</td>
<td>2.9</td>
<td>3.00</td>
<td>1.148924e-13</td>
</tr>
<tr>
<th>113567</th>
<td>2.80</td>
<td>2.90</td>
<td>2.9</td>
<td>3.00</td>
<td>4.000000e-06</td>
</tr>
<tr>
<th>113568</th>
<td>2.90</td>
<td>3.00</td>
<td>2.9</td>
<td>3.00</td>
<td>1.530000e-04</td>
</tr>
</tbody>
</table>
<p>113569 rows × 5 columns</p>
</div></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=b1844080-765a-4356-a0c6-946187e9b2b7">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## HEPData information that is common across tables</span>
<span class="c1">##</span>

<span class="n">keyw_reaction1</span> <span class="o">=</span> <span class="s2">"E+ E- --&gt; PI+ PI-"</span>

<span class="c1">##</span>
<span class="c1">## configure properties common to all tables</span>
<span class="c1">##</span>
<span class="k">def</span><span class="w"> </span><span class="nf">table_common_config</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
  <span class="n">table</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"Data from "</span> <span class="o">+</span> <span class="n">babar_data_url</span>
  <span class="n">table</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">"observables"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"SIG"</span><span class="p">]</span>
  <span class="n">table</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">"cmenergies"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0.3-3.0"</span><span class="p">]</span>
  <span class="n">table</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">"reactions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">keyw_reaction1</span><span class="p">]</span>
  <span class="n">table</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">"phrases"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"Exclusive"</span><span class="p">,</span>
    <span class="s2">"E+E- Scattering"</span><span class="p">,</span>
    <span class="s2">"Integrated Cross Section"</span><span class="p">,</span>
    <span class="s2">"Cross Section"</span><span class="p">,</span>
  <span class="p">]</span>

<span class="c1">##</span>
<span class="c1">## configure properties common to all dep vars</span>
<span class="c1">##</span>
<span class="k">def</span><span class="w"> </span><span class="nf">var_dep_common_config</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
  <span class="n">var</span><span class="o">.</span><span class="n">add_qualifier</span><span class="p">(</span><span class="s2">"RE"</span><span class="p">,</span> <span class="n">keyw_reaction1</span><span class="p">)</span>
  <span class="n">var</span><span class="o">.</span><span class="n">add_qualifier</span><span class="p">(</span><span class="s2">"SQRT(S)"</span><span class="p">,</span> <span class="s2">"0.3-3.0"</span><span class="p">,</span> <span class="s2">"GeV"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=5abeb86b-895e-4435-9f3b-85c76b6b1371">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## bare cross section value and total uncertainty</span>
<span class="c1">##</span>

<span class="n">table_val</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">"Bare cross-section"</span><span class="p">)</span>
<span class="n">table_val</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"Bare cross-section $e^+e^-\rightarrow\pi^+\pi^-(\gamma)$"</span>
<span class="n">table_common_config</span><span class="p">(</span><span class="n">table_val</span><span class="p">)</span>

<span class="c1">##--- independent variable: energy bins</span>
<span class="n">val_x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">"SQRT(S)"</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">"GeV"</span><span class="p">)</span>
<span class="n">val_x</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sigma_df</span><span class="p">[</span><span class="s2">"E_lo"</span><span class="p">],</span> <span class="n">sigma_df</span><span class="p">[</span><span class="s2">"E_hi"</span><span class="p">]))</span>

<span class="c1">##--- dependent variable: bare cross-section vs. energy bin</span>
<span class="n">val_y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">"$\sigma_{\pi^+\pi^-(\gamma)}$"</span><span class="p">,</span>  <span class="n">is_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">"nb"</span><span class="p">)</span>
<span class="n">val_y</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">sigma_df</span><span class="p">[</span><span class="s2">"sigma_val"</span><span class="p">]</span>
<span class="n">var_dep_common_config</span><span class="p">(</span><span class="n">val_y</span><span class="p">)</span>

<span class="c1">##--- uncertainty of above variable</span>
<span class="n">val_y_unc</span> <span class="o">=</span> <span class="n">Uncertainty</span><span class="p">(</span><span class="s2">"total"</span><span class="p">,</span> <span class="n">is_symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">val_y_unc</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">sigma_df</span><span class="p">[</span><span class="s2">"sigma_unc"</span><span class="p">]</span>
<span class="n">val_y</span><span class="o">.</span><span class="n">add_uncertainty</span><span class="p">(</span><span class="n">val_y_unc</span><span class="p">)</span>

<span class="c1">##--- assemble HEPDATA table</span>
<span class="n">table_val</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">val_x</span><span class="p">)</span>
<span class="n">table_val</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">val_y</span><span class="p">)</span>
<span class="c1">## table_val.add_image("image.eps")</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=4dbc0c02-f10d-4c37-9c86-5dcaef3780be">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## systematic uncertainty</span>
<span class="c1">##</span>

<span class="n">table_syst_unc</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">"Bare cross-section systematic uncertainties"</span><span class="p">)</span>
<span class="n">table_syst_unc</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">Bare cross-section $e^+e^-</span><span class="se">\\</span><span class="s2">rightarrow</span><span class="se">\\</span><span class="s2">pi^+</span><span class="se">\\</span><span class="s2">pi^-(</span><span class="se">\\</span><span class="s2">gamma)$ </span><span class="se">\</span>
<span class="s2">systematic uncertainties</span>
<span class="s2">all systematics contributions are each 100</span><span class="si">% c</span><span class="s2">orrelated in all energy bins</span><span class="se">\</span>
<span class="s2">"""</span>
<span class="n">table_common_config</span><span class="p">(</span><span class="n">table_syst_unc</span><span class="p">)</span>

<span class="c1">##--- independent variable: energy bins</span>
<span class="n">syst_unc_x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">"SQRT(S) [GeV]"</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">syst_unc_x</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sigma_syst_df</span><span class="p">[</span><span class="s2">"E_lo"</span><span class="p">],</span> <span class="n">sigma_syst_df</span><span class="p">[</span><span class="s2">"E_hi"</span><span class="p">]))</span>

<span class="c1">##</span>
<span class="c1">## systematics contributions</span>
<span class="c1">## (and first colums is total unc)</span>
<span class="c1">##</span>
<span class="n">syst_contr_descr</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"trigger / filter"</span><span class="p">,</span>
  <span class="s2">"tracking"</span><span class="p">,</span>
  <span class="s2">"pi-ID"</span><span class="p">,</span>
  <span class="s2">"background"</span><span class="p">,</span>
  <span class="s2">"acceptance"</span><span class="p">,</span>
  <span class="s2">"kinematic fit chi2 cut"</span><span class="p">,</span>
  <span class="s2">"correlated mu mu ID loss"</span><span class="p">,</span>
  <span class="s2">"non cancellation of HO ISR in pi pi gamma/mu mu gamma ratio"</span><span class="p">,</span>
  <span class="s2">"unfolding"</span><span class="p">,</span>
  <span class="s2">"ISR luminosity from mu mu gamma process"</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">##</span>
<span class="c1">## create a HEPData var for syst unc total and contributions</span>
<span class="c1">## they are in columns indices 3-1 .. ncol-1</span>
<span class="c1">##</span>
<span class="nb">vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">icol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
  <span class="p">[</span><span class="s2">"total"</span><span class="p">]</span> <span class="o">+</span> <span class="n">syst_contr_descr</span><span class="p">,</span>
  <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma_syst_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">):</span>
  <span class="n">syst_unc_y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span>
    <span class="n">descr</span><span class="p">,</span>
    <span class="n">is_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">"%"</span>
  <span class="p">)</span>
  <span class="n">syst_unc_y</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">sigma_syst_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">icol</span><span class="p">]</span>
  <span class="n">var_dep_common_config</span><span class="p">(</span><span class="n">syst_unc_y</span><span class="p">)</span>
  <span class="nb">vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">syst_unc_y</span><span class="p">)</span>

<span class="c1">##--- add all defined vars to submission</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">syst_unc_x</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">:</span>
  <span class="n">table_syst_unc</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=045ffa92-c05f-42ed-9e00-e51a2b2e01a6">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## statistical covariance</span>
<span class="c1">##</span>

<span class="n">table_stat_cov</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">"Bare cross-section statistical covariance"</span><span class="p">)</span>
<span class="n">table_stat_cov</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">Bare cross-section $e^+e^-</span><span class="se">\\</span><span class="s2">rightarrow</span><span class="se">\\</span><span class="s2">pi^+</span><span class="se">\\</span><span class="s2">pi^-(</span><span class="se">\\</span><span class="s2">gamma)$ </span><span class="se">\</span>
<span class="s2">statistical covariance</span><span class="se">\</span>
<span class="s2">"""</span>
<span class="n">table_common_config</span><span class="p">(</span><span class="n">table_stat_cov</span><span class="p">)</span>

<span class="c1">##--- independent variables: row and column energy bins</span>
<span class="n">stat_cov_x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">"SQRT(S) [GeV]"</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stat_cov_x</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sigma_stat_cov_df</span><span class="p">[</span><span class="s2">"E_lo_i"</span><span class="p">],</span> <span class="n">sigma_stat_cov_df</span><span class="p">[</span><span class="s2">"E_hi_i"</span><span class="p">]))</span>
<span class="n">stat_cov_y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">"SQRT(S) [GeV]"</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stat_cov_y</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sigma_stat_cov_df</span><span class="p">[</span><span class="s2">"E_lo_j"</span><span class="p">],</span> <span class="n">sigma_stat_cov_df</span><span class="p">[</span><span class="s2">"E_hi_j"</span><span class="p">]))</span>

<span class="c1">##--- correlation of cross section for energy bin i and energy bin j</span>
<span class="n">stat_cov_z</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span>
  <span class="s2">"$\sigma_{\pi^+\pi^-(\gamma)}$ statistical covariance"</span><span class="p">,</span>
  <span class="n">is_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_binned</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">"nb^2"</span>
<span class="p">)</span>
<span class="n">stat_cov_z</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">sigma_stat_cov_df</span><span class="p">[</span><span class="s2">"cov"</span><span class="p">]</span>
<span class="n">var_dep_common_config</span><span class="p">(</span><span class="n">stat_cov_z</span><span class="p">)</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">stat_cov_x</span><span class="p">,</span> <span class="n">stat_cov_y</span><span class="p">,</span> <span class="n">stat_cov_z</span><span class="p">]:</span>
  <span class="n">table_stat_cov</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=7dafcdb9-8ec0-4473-ab4f-3d1a9ed49939">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">##</span>
<span class="c1">## assembly and submission</span>
<span class="c1">##</span>

<span class="c1">##--- all output will go here</span>
<span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="n">myfolder</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"creating submission in "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">myfolder</span> <span class="o">/</span> <span class="s2">"submission.tar.gz"</span><span class="p">))</span>
  <span class="n">hd_subm</span> <span class="o">=</span> <span class="n">Submission</span><span class="p">()</span>

  <span class="c1">##--- general info</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_record_id</span><span class="p">(</span><span class="mi">1114155</span><span class="p">,</span> <span class="s2">"inspire"</span><span class="p">)</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="s2">"arXiv"</span><span class="p">,</span> <span class="s2">"https://arxiv.org/abs/1205.2228"</span><span class="p">)</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="s2">"Webpage with data files"</span><span class="p">,</span> <span class="n">babar_data_url</span><span class="p">)</span>

  <span class="c1">##--- use temp file for abstract</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">'w+t'</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">paper_abstract</span><span class="p">)</span>
  <span class="k">finally</span><span class="p">:</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">read_abstract</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

  <span class="c1">##--- add tables</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="n">table_val</span><span class="p">)</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="n">table_syst_unc</span><span class="p">)</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="n">table_stat_cov</span><span class="p">)</span>

  <span class="c1">##--- create submission</span>
  <span class="n">outdir</span> <span class="o">=</span> <span class="s2">"submission"</span>
  <span class="n">hd_subm</span><span class="o">.</span><span class="n">create_files</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">remove_old</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"submission created"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>creating submission in hepdata-babar-2012-pip-pim/submission.tar.gz
submission created
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" id="cell-id=a544a046-dabc-473a-8748-9d67349a2e5d">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/babar/" rel="tag">BaBar</a></li>
            <li><a class="tag p-category" href="../../tags/hepdata/" rel="tag">HEPData</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../example-root-plot-with-hepdata-submissions/" rel="prev" title="Example Root plot with two HEPData submissions">Previous post</a>
            </li>
            <li class="next">
                <a href="../hepdata-check-babar-2012-pip-pim/" rel="next" title="Check HEPData BaBar 2012 $\sigma(e^+e^- \rightarrow \pi^+\pi^- (\gamma))$">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // can be 'left' or 'center' eq. align
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        // preferredFont: "STIX",
    }
});
</script></article><!--End of body content--><footer id="footer">
            Contents © 2025         <a href="mailto:alusiani%20at%20gmail.com">PrecisionSM Group</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
