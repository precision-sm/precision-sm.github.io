(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.v7hist.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.v7hist.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.v7hist.js")}a(JSROOT,d3)}}}(function(a,b){a.sources.push("v7hist");function e(h){a.TObjectPainter.call(this,h);this.draw_content=true;this.nbinsx=0;this.nbinsy=0;this.accept_drops=true;this.mode3d=false;this.zoom_changed_interactive=0}e.prototype=Object.create(a.TObjectPainter.prototype);e.prototype.PrepareFrame=function(j){this.SetDivId(j,-1);if(!this.frame_painter()){var i=this.root_pad(),h=i?i.fFrame:null;a.v7.drawFrame(j,h)}this.SetDivId(j,1)};e.prototype.GetHImpl=function(h){if(h&&h.fHistImpl){return h.fHistImpl.fIsWeak?h.fHistImpl.fWeakForIO:h.fHistImpl.fUnique}return null};e.prototype.GetHisto=function(){var i=this.GetObject(),h=this.GetHImpl(i);if(h&&!h.getBinContent){if(h.fAxes._1){h.getBin=function(j,k){return(j+this.fAxes._0.fNBins*k)};h.getBinContent=function(j,k){return this.fStatistics.fBinContent[this.getBin(j,k)]};h.getBinError=function(j,l){var k=this.getBin(j,l);if(this.fStatistics.fSumWeightsSquared){return Math.sqrt(this.fStatistics.fSumWeightsSquared[k])}return Math.sqrt(Math.abs(this.fStatistics.fBinContent[k]))}}else{h.getBinContent=function(j){return this.fStatistics.fBinContent[j]};h.getBinError=function(j){if(this.fStatistics.fSumWeightsSquared){return Math.sqrt(this.fStatistics.fSumWeightsSquared[j])}return Math.sqrt(Math.abs(this.getBinContent(j)))}}}return h};e.prototype.IsTProfile=function(){return false};e.prototype.IsTH1K=function(){return false};e.prototype.IsTH2Poly=function(){return false};e.prototype.DecodeOptions=function(h){if(!this.options){this.options={Hist:1}}};e.prototype.Clear3DScene=function(){var h=this.frame_painter();if(h&&typeof h.Create3DScene==="function"){h.Create3DScene(-1)}this.mode3d=false};e.prototype.Cleanup=function(){this.Clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;a.TObjectPainter.prototype.Cleanup.call(this)};e.prototype.Dimension=function(){return 1};e.prototype.ScanContent=function(h){alert("HistPainter.prototype.ScanContent not implemented")};e.prototype.DrawAxes=function(){var h=this.frame_painter();if(!h){return false}if(this.is_main_painter()&&this.draw_content){h.CleanupAxes();h.xmin=h.xmax=0;h.ymin=h.ymax=0;h.zmin=h.zmax=0;h.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax)}return h.DrawAxes(true)};e.prototype.CheckHistDrawAttributes=function(){var i=this.GetObject().fOpts,h=this.canv_painter();this.createAttFill({pattern:0,color:0});var j=h.GetNewColor(i.fLineColor);this.createAttLine({color:j||"black"})};e.prototype.UpdateObject=function(k,j){var h=this.GetObject();if(k!==h){if(!this.MatchObjectType(k)){return false}var l=this.GetHImpl(h),i=this.GetHImpl(k);if(!l||!i){return false}l.fStatistics=i.fStatistics}this.ScanContent();this.histogram_updated=true;return true};e.prototype.GetAxis=function(i){var h=this.GetHisto();if(!h||!h.fAxes){return null}var j=h.fAxes._0;switch(i){case"x":j=h.fAxes._0;break;case"y":j=h.fAxes._1;break;case"z":j=h.fAxes._2;break}if(!j||j.GetBinCoord){return j}if(j._typename=="ROOT::Experimental::RAxisEquidistant"){j.min=j.fLow;j.max=j.fLow+(j.fNBins-2)/j.fInvBinWidth;j.GetBinCoord=function(k){return this.fLow+k/this.fInvBinWidth};j.FindBin=function(k,l){return Math.floor((k-this.fLow)*this.fInvBinWidth+l)}}else{j.min=j.fBinBorders[0];j.max=j.fBinBorders[j.fNBins-2];j.GetBinCoord=function(l){var m=Math.round(l);if(m<=0){return this.fBinBorders[0]}if(m>this.fNBins-2){return this.fBinBorders[this.fNBins-2]}if(m==l){return this.fBinBorders[m]}var k=(l<m)?m-1:m+1;return this.fBinBorders[m]*Math.abs(l-k)+this.fBinBorders[k]*Math.abs(l-m)};j.FindBin=function(l,n){for(var m=1;m<this.fBinBorders.length;++m){if(l<this.fBinBorders[m]){return Math.floor(m-1+n)}}return this.fNBins-2}}return j};e.prototype.CreateAxisFuncs=function(k,j){var h=this.GetHisto();if(!h){return}var i=this.GetAxis("x");this.xmin=i.min;this.xmax=i.max;if(!k||!this.nbinsy){return}i=this.GetAxis("y");this.ymin=i.min;this.ymax=i.max;if(!j||!this.nbinsz){return}i=this.GetAxis("z");this.zmin=i.min;this.zmax=i.max};e.prototype.AddInteractive=function(){if(this.is_main_painter()){var h=this.frame_painter();if(h){h.AddInteractive()}}};e.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};e.prototype.ToggleTitle=function(h){return false};e.prototype.DecomposeTitle=function(){};e.prototype.DrawTitle=function(){};e.prototype.UpdateStatWebCanvas=function(){};e.prototype.ToggleStat=function(h){};e.prototype.GetSelectIndex=function(i,p,o){var m=0,j=this.frame_painter(),h=this.GetAxis(i),l=this["nbins"+i]||0,k=j?j["zoom_"+i+"min"]:0,n=j?j["zoom_"+i+"max"]:0;if((k!==n)&&h){if(p=="left"){m=h.FindBin(k,o||0)}else{m=h.FindBin(n,(o||0)+0.5)}if(m<0){m=0}else{if(m>l){m=l}}}else{m=(p=="left")?0:l}return m};e.prototype.FindStat=function(){return null};e.prototype.IgnoreStatsFill=function(){return true};e.prototype.CreateStat=function(h){return null};e.prototype.ButtonClick=function(h){switch(h){case"ToggleZoom":if((this.zoom_xmin!==this.zoom_xmax)||(this.zoom_ymin!==this.zoom_ymax)||(this.zoom_zmin!==this.zoom_zmax)){this.Unzoom();return true}if(this.draw_content&&(typeof this.AutoZoom==="function")){this.AutoZoom();return true}break;case"ToggleLogX":this.frame_painter().ToggleLog("x");break;case"ToggleLogY":this.frame_painter().ToggleLog("y");break;case"ToggleLogZ":this.frame_painter().ToggleLog("z");break;case"ToggleStatBox":this.ToggleStat();return true;break}return false};e.prototype.FillToolbar=function(i){var h=this.pad_painter();if(!h){return}h.AddButton(a.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *");h.AddButton(a.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown");h.AddButton(a.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp");if(this.Dimension()>1){h.AddButton(a.ToolbarIcons.arrow_diag,"Toggle log z","ToggleLogZ")}if(this.draw_content){h.AddButton(a.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox")}if(!i){h.ShowButtons()}};e.prototype.Get3DToolTip=function(i){var h=this.GetHisto(),j={bin:i,name:h.fName||"histo",title:h.fTitle};switch(this.Dimension()){case 1:j.ix=i;j.iy=1;j.value=h.getBinContent(j.ix);j.error=h.getBinError(i);j.lines=this.GetBinTips(i-1);break;case 2:j.ix=i%(this.nbinsx+2);j.iy=(i-j.ix)/(this.nbinsx+2);j.value=h.getBinContent(j.ix,j.iy);j.error=h.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1);break;case 3:j.ix=i%(this.nbinsx+2);j.iy=((i-j.ix)/(this.nbinsx+2))%(this.nbinsy+2);j.iz=(i-j.ix-j.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2);j.value=this.GetObject().getBinContent(j.ix,j.iy,j.iz);j.error=h.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1,j.iz-1);break}return j};e.prototype.CreateContour=function(k,l,n,m){if(k<1){k=a.gStyle.fNumberContours}this.fContour=[];this.colzmin=l;this.colzmax=n;if(this.root_pad().fLogz){if(this.colzmax<=0){this.colzmax=1}if(this.colzmin<=0){if((m===undefined)||(m<=0)){this.colzmin=0.0001*this.colzmax}else{this.colzmin=((m<3)||(m>100))?0.3*m:1}}if(this.colzmin>=this.colzmax){this.colzmin=0.0001*this.colzmax}var p=Math.log(this.colzmin)/Math.log(10),j=Math.log(this.colzmax)/Math.log(10),o=(j-p)/k;this.fContour.push(this.colzmin);for(var h=1;h<k;h++){this.fContour.push(Math.exp((p+o*h)*Math.log(10)))}this.fContour.push(this.colzmax);this.fCustomContour=true}else{if((this.colzmin===this.colzmax)&&(this.colzmin!==0)){this.colzmax+=0.01*Math.abs(this.colzmax);this.colzmin-=0.01*Math.abs(this.colzmin)}var o=(this.colzmax-this.colzmin)/k;for(var h=0;h<=k;h++){this.fContour.push(this.colzmin+o*h)}}var i=this.frame_painter();if(this.Dimension()<3){i.zmin=this.zmin=this.colzmin;i.zmax=this.zmax=this.colzmax}i.fContour=this.fContour;i.fCustomContour=this.fCustomContour;i.colzmin=this.colzmin;i.colzmax=this.colzmax;return this.fContour};e.prototype.GetContour=function(){if(this.fContour){return this.fContour}var h=this.frame_painter();if(h&&h.fContour){this.fContour=h.fContour;this.fCustomContour=h.fCustomContour;this.colzmin=h.colzmin;this.colzmax=h.colzmax;return this.fContour}var j=this.GetHisto(),m=a.gStyle.fNumberContours,i=this.minbin,l=this.maxbin,k=this.minposbin;if(i===l){i=this.gminbin;l=this.gmaxbin;k=this.gminposbin}if(h.zoom_zmin!=h.zoom_zmax){i=h.zoom_zmin;l=h.zoom_zmax}this.fCustomContour=false;return this.CreateContour(m,i,l,k)};e.prototype.FillContextMenu=function(l){var j=this.GetHisto();l.add("header:v7histo::anyname");if(this.draw_content){l.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()});if(typeof this.FillHistContextMenu=="function"){this.FillHistContextMenu(l)}}if(this.options.Mode3D){if(l.size()>0){l.add("separator")}var h=this.main_painter()||this,k=this.frame_painter(),i=k;l.addchk(h.tooltip_allowed,"Show tooltips",function(){h.tooltip_allowed=!h.tooltip_allowed});l.addchk(i.enable_highlight,"Highlight bins",function(){i.enable_highlight=!i.enable_highlight;if(!i.enable_highlight&&h.BinHighlight3D&&h.mode3d){h.BinHighlight3D(null)}});if(k&&k.Render3D){l.addchk(h.options.FrontBox,"Front box",function(){h.options.FrontBox=!h.options.FrontBox;k.Render3D()});l.addchk(h.options.BackBox,"Back box",function(){h.options.BackBox=!h.options.BackBox;k.Render3D()})}if(this.draw_content){l.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.RedrawPad()});if((this.options.Lego==12)||(this.options.Lego==14)){l.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()});if(this.FillPaletteMenu){this.FillPaletteMenu(l)}}}if(h.control&&typeof h.control.reset==="function"){l.add("Reset camera",function(){h.control.reset()})}}this.FillAttContextMenu(l);if(this.histogram_updated&&this.zoom_changed_interactive){l.add("Let update zoom",function(){this.zoom_changed_interactive=0})}return true};e.prototype.getContourIndex=function(i){var m=this.GetContour();if(this.fCustomContour){var h=0,k=m.length-1,j;if(i<m[0]){return -1}if(i>=m[k]){return k}while(h<k-1){j=Math.round((h+k)/2);if(m[j]>i){k=j}else{h=j}}return h}if(i<this.colzmin){return this.options.Zero?-1:0}if(i===this.colzmin){return((this.colzmin!=0)||!this.options.Zero||this.IsTH2Poly())?0:-1}return Math.floor(0.01+(i-this.colzmin)*(m.length-1)/(this.colzmax-this.colzmin))};e.prototype.getContourColor=function(j,m){var i=this.getContourIndex(j);if(i<0){return null}var l=this.GetContour(),h=this.GetPalette(),k=h.calcColorIndex(i,l.length);return m?k:h.getColor(k)};e.prototype.GetPalette=function(i){if(!this.fPalette||i){var h=this.options.Palette?null:this.canv_painter();this.fPalette=(h&&h.CanvasPalette)?h.CanvasPalette:a.Painter.GetColorPalette(this.options.Palette)}return this.fPalette};e.prototype.FillPaletteMenu=function(k){var j=this.options.Palette,h=this;if((j===null)||(j===0)){j=a.gStyle.Palette}function l(m){h.options.Palette=parseInt(m);h.GetPalette(true);h.Redraw()}function i(o,m,n){k.addchk((o===j)||n,"<nobr>"+m+"</nobr>",o,l)}k.add("sub:Palette");i(50,"ROOT 5",(j>=10)&&(j<51));i(51,"Deep Sea");i(52,"Grayscale",(j>0)&&(j<10));i(53,"Dark body radiator");i(54,"Two-color hue");i(55,"Rainbow");i(56,"Inverted dark body radiator");i(57,"Bird",(j>112));i(58,"Cubehelix");i(59,"Green Red Violet");i(60,"Blue Red Yellow");i(61,"Ocean");i(62,"Color Printable On Grey");i(63,"Alpine");i(64,"Aquamarine");i(65,"Army");i(66,"Atlantic");k.add("endsub:")};e.prototype.DrawColorPalette=function(h,j,i){return null};e.prototype.ToggleColz=function(){var h=this.options.Mode3D?(this.options.Lego===12||this.options.Lego===14||this.options.Surf===11||this.options.Surf===12):this.options.Color||this.options.Contour;if(h){this.options.Zscale=!this.options.Zscale;this.DrawColorPalette(this.options.Zscale,false,true)}};e.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;if(this.options.Mode3D){if(!this.options.Surf&&!this.options.Lego&&!this.options.Error){if((this.nbinsx>=50)||(this.nbinsy>=50)){this.options.Lego=this.options.Color?14:13}else{this.options.Lego=this.options.Color?12:1}this.options.Zero=false}}this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};e.prototype.PrepareColorDraw=function(p){if(!p){p={rounding:true,extra:0,middle:0}}if(p.extra===undefined){p.extra=0}if(p.middle===undefined){p.middle=0}var l=this.GetHisto(),v=this.GetAxis("x"),s=this.GetAxis("y"),n=this.frame_painter(),h=this.Dimension(),m,k,t,r,q,u,o={i1:this.GetSelectIndex("x","left",0-p.extra),i2:this.GetSelectIndex("x","right",1+p.extra),j1:(h===1)?0:this.GetSelectIndex("y","left",0-p.extra),j2:(h===1)?1:this.GetSelectIndex("y","right",1+p.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};o.grx=new Float32Array(o.i2+1);o.gry=new Float32Array(o.j2+1);if(p.original){o.original=true;o.origx=new Float32Array(o.i2+1);o.origy=new Float32Array(o.j2+1)}if(p.pixel_density){p.rounding=true}for(m=o.i1;m<=o.i2;++m){t=v.GetBinCoord(m+p.middle);if(n.logx&&(t<=0)){o.i1=m+1;continue}if(o.origx){o.origx[m]=t}o.grx[m]=n.grx(t);if(p.rounding){o.grx[m]=Math.round(o.grx[m])}if(p.use3d){if(o.grx[m]<-n.size_xy3d){o.i1=m;o.grx[m]=-n.size_xy3d}if(o.grx[m]>n.size_xy3d){o.i2=m;o.grx[m]=n.size_xy3d}}}if(h===1){o.gry[0]=n.gry(0);o.gry[1]=n.gry(1)}else{for(k=o.j1;k<=o.j2;++k){r=s.GetBinCoord(k+p.middle);if(n.logy&&(r<=0)){o.j1=k+1;continue}if(o.origy){o.origy[k]=r}o.gry[k]=n.gry(r);if(p.rounding){o.gry[k]=Math.round(o.gry[k])}if(p.use3d){if(o.gry[k]<-n.size_xy3d){o.j1=k;o.gry[k]=-n.size_xy3d}if(o.gry[k]>n.size_xy3d){o.j2=k;o.gry[k]=n.size_xy3d}}}}q=l.getBinContent(o.i1+1,o.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(m=o.i1;m<o.i2;++m){for(k=o.j1;k<o.j2;++k){q=l.getBinContent(m+1,k+1);o.sumz+=q;if(p.pixel_density){u=(o.grx[m+1]-o.grx[m])*(o.gry[k]-o.gry[k+1]);if(u<=0){continue}o.max=Math.max(o.max,q);if((q>0)&&((q<o.min)||(o.min===0))){o.min=q}q=q/u}if(this.maxbin===null){this.maxbin=this.minbin=q}else{this.maxbin=Math.max(this.maxbin,q);this.minbin=Math.min(this.minbin,q)}if(q>0){if((this.minposbin===null)||(q<this.minposbin)){this.minposbin=q}}}}this.fContour=null;this.fCustomContour=false;return o};function g(h){e.call(this,h);this.wheel_zoomy=false}g.prototype=Object.create(e.prototype);g.prototype.ConvertTH1K=function(){var i=this.GetObject();if(i.fReady){return}var h=i.fArray;i.fNcells=i.fXaxis.fNbins+2;i.fArray=new Float64Array(i.fNcells);for(var j=0;j<i.fNcells;++j){i.fArray[j]=0}for(var j=0;j<i.fNIn;++j){i.Fill(h[j])}i.fReady=true};g.prototype.ScanContent=function(q){var m=this.GetHisto();if(!m){return}if(!this.nbinsx&&q){q=false}if(!q){this.nbinsx=this.GetAxis("x").fNBins-2;this.nbinsy=0;this.CreateAxisFuncs(false)}var j=this.GetSelectIndex("x","left"),t=this.GetSelectIndex("x","right");if(q){if((j===this.scan_xleft)&&(t===this.scan_xright)){return}}this.scan_xleft=j;this.scan_xright=t;var k=0,h=0,r=0,o=0,p=true,s,l;for(var n=0;n<this.nbinsx;++n){s=m.getBinContent(n+1);o+=s;if((n<j)||(n>=t)){continue}if(s>0){if((h==0)||(s<h)){h=s}}if(p){k=r=s;p=false}l=0;k=Math.min(k,s-l);r=Math.max(r,s+l)}o+=m.getBinContent(0)+m.getBinContent(this.nbinsx+1);this.stat_entries=o;this.hmin=k;this.hmax=r;this.ymin_nz=h;if((this.nbinsx==0)||((Math.abs(k)<1e-300&&Math.abs(r)<1e-300))){this.draw_content=false}else{this.draw_content=true}if(this.draw_content){if(k>=r){if(k==0){this.ymin=0;this.ymax=1}else{if(k<0){this.ymin=2*k;this.ymax=0}else{this.ymin=0;this.ymax=k*2}}}else{var u=(r-k)*0.05;this.ymin=k-u;if((this.ymin<0)&&(k>=0)){this.ymin=0}this.ymax=r+u}}};g.prototype.CountStat=function(o){var j=this.IsTProfile(),s=this.GetHisto(),h=this.GetAxis("x"),k=this.GetSelectIndex("x","left"),y=this.GetSelectIndex("x","right"),v=0,r=0,t=0,q=0,z=0,x,l=0,n=0,u=null,p=null,m=this.frame_painter(),A={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(x=k;x<y;++x){l=h.GetBinCoord(x+0.5);if(o&&!o(l)){continue}if(j){n=s.fBinEntries[x+1];q+=s.fArray[x+1];z+=s.fSumw2[x+1]}else{n=s.getBinContent(x+1)}if((u===null)||(n>p)){u=l;p=n}v+=n;r+=n*l;t+=n*l*l}if(!m.IsAxisZoomed("x")&&s.fTsumw){v=s.fTsumw;r=s.fTsumwx;t=s.fTsumwx2}A.integral=v;if(v>0){A.meanx=r/v;A.meany=q/v;A.rmsx=Math.sqrt(Math.abs(t/v-A.meanx*A.meanx));A.rmsy=Math.sqrt(Math.abs(z/v-A.meany*A.meany))}if(u!==null){A.xmax=u;A.wmax=p}return A};g.prototype.FillStatistic=function(m,n,t){if(this.IgnoreStatsFill()){return false}var l=this.CountStat(),q=n%10,r=Math.floor(n/10)%10,p=Math.floor(n/100)%10,s=Math.floor(n/1000)%10,h=Math.floor(n/10000)%10,i=Math.floor(n/100000)%10,j=Math.floor(n/1000000)%10,o=Math.floor(n/10000000)%10,k=Math.floor(n/100000000)%10;m.ClearPave();if(q>0){m.AddText(l.name)}if(this.IsTProfile()){if(r>0){m.AddText("Entries = "+m.Format(l.entries,"entries"))}if(p>0){m.AddText("Mean = "+m.Format(l.meanx));m.AddText("Mean y = "+m.Format(l.meany))}if(s>0){m.AddText("Std Dev = "+m.Format(l.rmsx));m.AddText("Std Dev y = "+m.Format(l.rmsy))}}else{if(r>0){m.AddText("Entries = "+m.Format(l.entries,"entries"))}if(p>0){m.AddText("Mean = "+m.Format(l.meanx))}if(s>0){m.AddText("Std Dev = "+m.Format(l.rmsx))}if(h>0){m.AddText("Underflow = "+m.Format(histo.getBinContent(0),"entries"))}if(i>0){m.AddText("Overflow = "+m.Format(histo.getBinContent(this.nbinsx+1),"entries"))}if(j>0){m.AddText("Integral = "+m.Format(l.integral,"entries"))}if(o>0){m.AddText("Skew = <not avail>")}if(k>0){m.AddText("Kurt = <not avail>")}}return true};g.prototype.DrawBars=function(x,u){this.CreateG(true);var l=this.GetSelectIndex("x","left",-1),E=this.GetSelectIndex("x","right",1),o=this.frame_painter(),m=this,t=this.GetHisto(),j=this.GetAxis("x"),A,C,B,n,k,p,s,r,q,v="",D="",z="",h=(this.options.BarStyle>10)?this.options.BarStyle%10:0;if(h>4){h=4}r=o.swap_xy?0:u;if((this.options.BaseLine!==false)&&!isNaN(this.options.BaseLine)){if(this.options.BaseLine>=o.scale_ymin){r=Math.round(o.gry(this.options.BaseLine))}}for(A=l;A<E;++A){C=j.GetBinCoord(A);B=j.GetBinCoord(A+1);if(o.logx&&(B<=0)){continue}n=Math.round(o.grx(C));k=Math.round(o.grx(B));p=t.getBinContent(A+1);if(o.logy&&(p<o.scale_ymin)){continue}s=Math.round(o.gry(p));q=k-n;n+=Math.round(this.options.fBarOffset/1000*q);q=Math.round(this.options.fBarWidth/1000*q);if(o.swap_xy){v+="M"+r+","+n+"h"+(s-r)+"v"+q+"h"+(r-s)+"z"}else{v+="M"+n+","+s+"h"+q+"v"+(r-s)+"h"+(-q)+"z"}if(h>0){k=n+q;q=Math.round(q*h/10);if(o.swap_xy){D+="M"+r+","+n+"h"+(s-r)+"v"+q+"h"+(r-s)+"z";z+="M"+r+","+k+"h"+(s-r)+"v"+(-q)+"h"+(r-s)+"z"}else{D+="M"+n+","+s+"h"+q+"v"+(r-s)+"h"+(-q)+"z";z+="M"+k+","+s+"h"+(-q)+"v"+(r-s)+"h"+q+"z"}}}if(this.fillatt.empty()){this.fillatt.SetSolidColor("blue")}if(v.length>0){this.draw_g.append("svg:path").attr("d",v).call(this.fillatt.func)}if(D.length>0){this.draw_g.append("svg:path").attr("d",D).call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).brighter(0.5).toString())}if(z.length>0){this.draw_g.append("svg:path").attr("d",z).call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).darker(0.5).toString())}};g.prototype.DrawFilledErrors=function(A,z){this.CreateG(true);var n=this.GetSelectIndex("x","left",-1),C=this.GetSelectIndex("x","right",1),r=this.frame_painter(),w=this.GetHisto(),m=this.GetAxis("x"),B,t,o,s,p,v,u,k=[],h=[];for(B=n;B<C;++B){t=m.GetBinCoord(B+0.5);if(r.logx&&(t<=0)){continue}o=Math.round(r.grx(t));s=w.getBinContent(B+1);p=w.getBinError(B+1);if(r.logy&&(s-p<r.scale_ymin)){continue}v=Math.round(r.gry(s+p));u=Math.round(r.gry(s-p));k.push({grx:o,gry:v});h.unshift({grx:o,gry:u})}var q=(this.options.ErrorKind===4)?"bezier":"line",l=a.Painter.BuildSvgPath(q,k),j=a.Painter.BuildSvgPath("L"+q,h);if(this.fillatt.empty()){this.fillatt.setSolidColor("blue")}this.draw_g.append("svg:path").attr("d",l.path+j.path+"Z").style("stroke","none").call(this.fillatt.func)};g.prototype.DrawBins=function(){var h=this.frame_width(),j=this.frame_height(),G=this.options;if(!this.draw_content||(h<=0)||(j<=0)){return this.RemoveDrawG()}this.CheckHistDrawAttributes();if(G.Bar){return this.DrawBars(h,j)}if((G.ErrorKind===3)||(G.ErrorKind===4)){return this.DrawFilledErrors(h,j)}this.CreateG(true);var p=this.GetSelectIndex("x","left",-1),ag=this.GetSelectIndex("x","right",2),D=this.frame_painter(),E=this,v=this.GetHisto(),R=this.GetAxis("x"),S="",Z=false,n,t,s,ac,Q,ab,P,u,ae,U,V,aj,N,l,an=!G.Zero,o=G.Error,K=G.Mark,k=G.Line,z=G.Text,J=z&&(this.options.TextKind=="E")&&this.IsTProfile()&&v.fBinEntries,O=null,w=null,ad=null,H=null,ai="",af="",A=0,q,C,B,ap,am,aa,Y,X,ao="",W,r,T;if(G.ErrorKind===2){if(this.fillatt.empty()){K=true}else{O=""}}else{if(G.Error){w=""}}if(k){H=""}if(K){this.createAttMarker({attr:v,style:this.options.MarkStyle});if(this.markeratt.size>0){ad="";this.markeratt.reset_pos()}else{K=false}}if(z){W=this.get_color(v.fMarkerColor);r=-1*G.TextAngle;T=20;if((G.fMarkerSize!==1)&&r){T=0.02*j*G.fMarkerSize}if(!r&&!G.TextKind){var al=h/(ag-p+1);if(al<3*T){r=270;T=Math.round(al*0.7)}}this.StartTextDrawing(42,T,this.draw_g,T)}var M=((ag-p)>3*h);if(G.ErrorKind===1){var I=this.lineatt.width+a.gStyle.fEndErrorSize;ai="m0,"+I+"v-"+2*I+"m0,"+I;af="m"+I+",0h-"+2*I+"m"+I+",0";A=Math.floor((this.lineatt.width-1)/2)}var ak=o||K;if(ak||z||k){M=true}function ah(x){ap=v.getBinContent(x+1);if(!an||(ap!==0)){aa=Math.round(D.grx(R.GetBinLowEdge(x+1)));Y=Math.round(D.grx(R.GetBinLowEdge(x+2)));X=Math.round((aa+Y)/2);q=Math.round(D.gry(ap));C=B=20;if(o){am=v.getBinError(x+1);C=Math.round(q-D.gry(ap+am));B=Math.round(D.gry(ap-am)-q)}if(z){var i=J?v.fBinEntries[x+1]:ap;if(i!==0){var y=(i===Math.round(i))?i.toString():a.FFormat(i,a.gStyle.fPaintTextFormat);if(r){E.DrawText({align:12,x:X,y:Math.round(q-2-T/5),width:0,height:0,rotate:r,text:y,color:W,latex:0})}else{E.DrawText({align:22,x:Math.round(aa+(Y-aa)*0.1),y:Math.round(q-2-T),width:Math.round((Y-aa)*0.8),height:T,text:y,color:W,latex:0})}}}if(k&&(H!==null)){H+=((H.length===0)?"M":"L")+X+","+q}if(ak){if((q>=-C)&&(q<=j+B)){if(O!==null){O+="M"+aa+","+(q-C)+"h"+(Y-aa)+"v"+(C+B+1)+"h-"+(Y-aa)+"z"}if(ad!==null){ad+=E.markeratt.create(X,q)}if(w!==null){if(E.options.errorX>0){var ar=Math.round(X-(Y-aa)*E.options.errorX),aq=Math.round(X+(Y-aa)*E.options.errorX);w+="M"+(ar+A)+","+q+ai+"h"+(aq-ar-2*A)+ai}w+="M"+X+","+(q-C+A)+af+"v"+(C+B-2*A)+af}}}}}for(aj=p;aj<=ag;++aj){ac=R.GetBinCoord(aj);if(D.logx&&(ac<=0)){continue}Q=Math.round(D.grx(ac));Z=(aj===ag);if(Z&&(p<ag)){P=s}else{ab=v.getBinContent(aj+1);P=Math.round(D.gry(ab))}if(S.length===0){N=l=aj;V=n=t=Q;U=u=ae=s=P;S="M"+t+","+s}else{if(M){if((Q===t)&&!Z){if(P<u){l=aj}else{if(P>ae){N=aj}}u=Math.min(u,P);ae=Math.max(ae,P);s=P}else{if(ak||z||k){if(N===l){ah(N)}else{if(N<l){ah(N);ah(l)}else{ah(l);ah(N)}}}if(!ak&&((u!==ae)||(U!==u))){if(V!==t){S+="h"+(t-V)}if(s===u){if(ae!==U){S+="v"+(ae-U)}if(u!==ae){S+="v"+(u-ae)}}else{if(u!==U){S+="v"+(u-U)}if(ae!==u){S+="v"+(ae-u)}if(s!==ae){S+="v"+(s-ae)}}V=t;U=s}if(Z&&(V!==Q)){S+="h"+(Q-V)}N=l=aj;u=ae=s=P;t=Q}}else{if((P!==s)||Z){if(Q!==t){S+="h"+(Q-t)}if(P!==s){S+="v"+(P-s)}s=P;t=Q}}}}var F="";if(!this.fillatt.empty()){var L=j+3,m=Math.round(D.gry(0));if(m<=0){L=-3}else{if(m<j){L=m}}F="L"+t+","+L+"L"+n+","+L+"Z";if(S.length>0){S+=F}}if(ak||k){if((O!==null)&&(O.length>0)){this.draw_g.append("svg:path").attr("d",O).call(this.fillatt.func)}if((w!==null)&&(w.length>0)){this.draw_g.append("svg:path").attr("d",w).call(this.lineatt.func)}if((H!==null)&&(H.length>0)){if(!this.fillatt.empty()){this.draw_g.append("svg:path").attr("d",G.Fill?(H+F):S).attr("stroke","none").call(this.fillatt.func)}this.draw_g.append("svg:path").attr("d",H).attr("fill","none").call(this.lineatt.func)}if((ad!==null)&&(ad.length>0)){this.draw_g.append("svg:path").attr("d",ad).call(this.markeratt.func)}}else{if(S&&G.Hist){this.draw_g.append("svg:path").attr("d",S).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}}if(z){this.FinishTextDrawing(this.draw_g)}};g.prototype.GetBinTips=function(r){var n=[],h=this.GetTipName(),m=this.frame_painter(),l=this.GetHisto(),p=this.GetAxis("x"),j=p.GetBinCoord(r),i=p.GetBinCoord(r+1),q=l.getBinContent(r+1),k="",o=false;if(h.length>0){n.push(h)}if(m.x_kind==="labels"){k=m.AxisAsText("x",j)}else{if(m.x_kind==="time"){k=m.AxisAsText("x",(j+i)/2)}else{o=true;k="["+m.AxisAsText("x",j)+", "+m.AxisAsText("x",i)+")"}}if(this.options.Error||this.options.Mark){n.push("x = "+k);n.push("y = "+m.AxisAsText("y",q));if(this.options.Error){if(o){n.push("error x = "+((i-j)/2).toPrecision(4))}n.push("error y = "+l.getBinError(r+1).toPrecision(4))}}else{n.push("bin = "+(r+1));n.push("x = "+k);if(l["$baseh"]){q-=l["$baseh"].getBinContent(r+1)}if(q===Math.round(q)){n.push("entries = "+q)}else{n.push("entries = "+a.FFormat(q,a.gStyle.fStatFormat))}}return n};g.prototype.ProcessTooltip=function(U){if((U===null)||!this.draw_content||this.options.Mode3D){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var h=this.frame_width(),i=this.frame_height(),z=this.frame_painter(),q=this,t=this.GetHisto(),D=this.GetAxis("x"),E=null,y=true,x,J,v,k,H,j,s=2,o=this.GetSelectIndex("x","left",-1),Q=this.GetSelectIndex("x","right",2),S=o,N=Q;function C(l){var m=D.GetBinCoord(l);return(z.logx&&(m<=0))?null:z.grx(m)}function A(l){var m=t.getBinContent(l+1);if(z.logy&&(m<z.scale_ymin)){return z.swap_xy?-1000:10*i}return Math.round(z.gry(m))}var P=z.swap_xy?U.y:U.x,O=z.swap_xy?U.x:U.y;while(S<N-1){var R=Math.round((S+N)*0.5),B=C(R);if((B===null)||(B<P-0.5)){if(z.swap_xy){N=R}else{S=R}}else{if(B>P+0.5){if(z.swap_xy){S=R}else{N=R}}else{S++;N--}}}E=N=S;x=C(E);if(z.swap_xy){while((S>o)&&(C(S-1)<x+2)){--S}while((N<Q)&&(C(N+1)>x-2)){++N}}else{while((S>o)&&(C(S-1)>x-2)){--S}while((N<Q)&&(C(N+1)<x+2)){++N}}if(S<N){var M=i;for(var R=S;R<=N;R++){var p=Math.abs(A(R)-O);if(p<M){M=p;E=R}}if(M>i/10){E=Math.round(S+(N-S)/i*O)}x=C(E)}x=Math.round(x);v=Math.round(C(E+1));if(this.options.Bar){var K=v-x;x+=Math.round(this.options.fBarOffset/1000*K);v=x+Math.round(this.options.fBarWidth/1000*K)}if(x>v){var V=x;x=v;v=V}J=Math.round((x+v)/2);H=k=j=A(E);if(this.options.Bar){y=true;s=0;k=Math.round(z.gry(((this.options.BaseLine!==false)&&(this.options.BaseLine>z.scale_ymin))?this.options.BaseLine:z.scale_ymin));if(k>j){var V=k;k=j;j=V}if(!U.touch&&(U.nproc===1)){if((O<k)||(O>j)){E=null}}}else{if(this.options.Error||this.options.Mark||this.options.Line){y=true;var u=3;if(this.markeratt){u=Math.max(u,this.markeratt.GetFullSize())}if(this.options.Error){var G=t.getBinContent(E+1),T=t.getBinError(E+1);k=Math.round(z.gry(G+T));j=Math.round(z.gry(G-T));if((G==0)&&this.IsTProfile()){E=null}var n=(v-x)*this.options.errorX;x=Math.round(J-n);v=Math.round(J+n)}if(v-x<2*u){x=J-u;v=J+u}k=Math.min(k,H-u);j=Math.max(j,H+u);if(!U.touch&&(U.nproc===1)){if((O<k)||(O>j)){E=null}}}else{y=(U.nproc===1)&&(Q-o<h);if(y){j=i;if(!this.fillatt.empty()){j=Math.round(z.gry(0));if(j<0){j=0}else{if(j>i){j=i}}if(j<k){var V=k;k=j;j=V}}if(((U.y<k)||(U.y>j))&&!U.touch){E=null}}}}if(E!==null){if((E===o)&&(x>P+s)){E=null}else{if((E===Q-1)&&(v<P-s)){E=null}else{if((P<x-s)||(P>v+s)){E=null}else{if(!this.options.Zero&&(t.getBinContent(E+1)===0)){E=null}}}}}var I=this.draw_g.select(".tooltip_bin");if((E===null)||((j<=0)||(k>=i))){I.remove();return null}var F={name:"histo",title:t.fTitle,x:J,y:H,exact:true,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(E)};if(U.disabled){I.remove();F.changed=true}else{if(y){if(I.empty()){I=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}F.changed=I.property("current_bin")!==E;if(F.changed){I.attr("x",z.swap_xy?k:x).attr("width",z.swap_xy?j-k:v-x).attr("y",z.swap_xy?x:k).attr("height",z.swap_xy?v-x:j-k).style("opacity","0.3").property("current_bin",E)}F.exact=(Math.abs(H-O)<=5)||((O>=k)&&(O<=j));F.menu=true;F.menu_dist=Math.sqrt((J-P)*(J-P)+(H-O)*(H-O))}else{var L=this.lineatt.width+3;if(I.empty()){I=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",L).call(this.lineatt.func).call(this.fillatt.func)}F.exact=(Math.abs(J-U.x)<=L)&&(Math.abs(H-U.y)<=L);F.menu=F.exact;F.menu_dist=Math.sqrt((J-U.x)*(J-U.x)+(H-U.y)*(H-U.y));F.changed=I.property("current_bin")!==E;if(F.changed){I.attr("cx",J).attr("cy",H).property("current_bin",E)}}}if(F.changed){F.user_info={obj:t,name:"histo",bin:E,cont:t.getBinContent(E+1),grx:J,gry:H}}return F};g.prototype.FillHistContextMenu=function(i){i.add("Auto zoom-in",this.AutoZoom);var h=a.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");i.addDrawMenu("Draw with",h.opts,function(j){if(j==="inspect"){return a.draw(this.divid,this.GetObject(),j)}this.DecodeOptions(j);if(this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()){this.fillatt.Change(5,1001)}this.InteractiveRedraw("pad","drawopt")})};g.prototype.AutoZoom=function(){var l=this.GetSelectIndex("x","left",-1),j=this.GetSelectIndex("x","right",1),m=j-l,h=this.GetHisto(),n=this.GetAxis("x");if(m==0){return}var i=h.getBinContent(l+1);for(var k=l;k<j;++k){i=Math.min(i,h.getBinContent(k+1))}if(i>0){return}while((l<j)&&(h.getBinContent(l+1)<=i)){++l}while((l<j)&&(h.getBinContent(j)<=i)){--j}if((l===j-1)&&(l>2)&&(j<this.nbinsx-2)){--l;++j}if((j-l<m)&&(l<j)){this.frame_painter().Zoom(n.GetBinCoord(l),n.GetBinCoord(j))}};g.prototype.CanZoomIn=function(j,i,h){var k=this.GetAxis("x");if((j=="x")&&(k.FindBin(h,0.5)-k.FindBin(i,0)>1)){return true}if((j=="y")&&(Math.abs(h-i)>Math.abs(this.ymax-this.ymin)*0.000001)){return true}return false};g.prototype.CallDrawFunc=function(k,j){var i=this.frame_painter();if(i&&(i.mode3d!==this.options.Mode3D)){this.options.Mode3D=i.mode3d}var h=this.options.Mode3D?"Draw3D":"Draw2D";this[h](k,j)};g.prototype.Draw2D=function(h){this.Clear3DScene();this.mode3d=false;if(typeof this.DrawColorPalette==="function"){this.DrawColorPalette(false)}if(this.DrawAxes()){this.DrawBins()}else{console.log("FAIL DARWING AXES")}this.AddInteractive();a.CallBack(h)};g.prototype.Draw3D=function(i,h){this.mode3d=true;a.AssertPrerequisites("hist3d",function(){this.Draw3D(i,h)}.bind(this))};g.prototype.Redraw=function(h){this.CallDrawFunc(null,h)};function d(k,i,j){var h=new g(i);h.PrepareFrame(k);h.options={Hist:true,Bar:false,Error:false,ErrorKind:-1,errorX:0,Zero:false,Mark:false,Line:false,Fill:false,Lego:0,Surf:0,Text:false,TextAngle:0,TextKind:"",AutoColor:0,fBarOffset:0,fBarWidth:1000,fMarkerSize:1,BaseLine:false,Mode3D:false};h.ScanContent();h.CallDrawFunc(function(){h.DrawingReady()});return h}function f(h){e.call(this,h);this.fContour=null;this.fCustomContour=false;this.fPalette=null;this.wheel_zoomy=true}f.prototype=Object.create(e.prototype);f.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;e.prototype.Cleanup.call(this)};f.prototype.Dimension=function(){return 2};f.prototype.ToggleProjection=function(j,i){if(j=="Projections"){j=""}if((typeof j=="string")&&(j.length>1)){i=parseInt(j.substr(1));j=j[0]}if(!i){i=1}if(j&&(this.is_projection==j)){if(this.projection_width===i){j=""}else{this.projection_width=i;return}}delete this.proj_hist;this.is_projection=(this.is_projection===j)?"":j;this.projection_width=i;var h=this.canv_painter();if(h){h.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this))}};f.prototype.RedrawProjection=function(k,j,i,h){};f.prototype.ExecuteMenuCommand=function(i,h){if(e.prototype.ExecuteMenuCommand.call(this,i,h)){return true}if((i.fName=="SetShowProjectionX")||(i.fName=="SetShowProjectionY")){this.ToggleProjection(i.fName[17],h&&parseInt(h)?parseInt(h):1);return true}return false};f.prototype.FillHistContextMenu=function(m){m.add("sub:Projections",this.ToggleProjection);var l=this.is_projection||"";if(l){l+=this.projection_width}var j=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(var h=0;h<j.length;++h){m.addchk(l==j[h],j[h],j[h],this.ToggleProjection)}m.add("endsub:");m.add("Auto zoom-in",this.AutoZoom);var i=a.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");m.addDrawMenu("Draw with",i.opts,function(k){if(k==="inspect"){return a.draw(this.divid,this.GetObject(),k)}this.DecodeOptions(k);this.InteractiveRedraw("pad","drawopt")});if(this.options.Color){this.FillPaletteMenu(m)}};f.prototype.ButtonClick=function(h){if(e.prototype.ButtonClick.call(this,h)){return true}switch(h){case"ToggleColor":this.ToggleColor();break;case"ToggleColorZ":this.ToggleColz();break;case"Toggle3D":this.ToggleMode3D();break;default:return false}return true};f.prototype.FillToolbar=function(){e.prototype.FillToolbar.call(this,true);var h=this.pad_painter();if(!h){return}if(!this.IsTH2Poly()){h.AddButton(a.ToolbarIcons.th2color,"Toggle color","ToggleColor")}h.AddButton(a.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ");h.AddButton(a.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D");h.ShowButtons()};f.prototype.ToggleColor=function(){if(this.options.Mode3D){this.options.Mode3D=false;this.options.Color=true}else{this.options.Color=!this.options.Color}this._can_move_colz=true;this.Redraw()};f.prototype.AutoZoom=function(){if(this.IsTH2Poly()){return}var t=this.GetSelectIndex("x","left",-1),r=this.GetSelectIndex("x","right",1),k=this.GetSelectIndex("y","left",-1),h=this.GetSelectIndex("y","right",1),x,v,n=this.GetHisto(),l=this.GetAxis("x"),z=this.GetAxis("y");if((t==r)||(k==h)){return}var s=n.getBinContent(t+1,k+1);for(x=t;x<r;++x){for(v=k;v<h;++v){s=Math.min(s,n.getBinContent(x+1,v+1))}}if(s>0){return}var B=r,w=t,p=h,A=k;for(x=t;x<r;++x){for(v=k;v<h;++v){if(n.getBinContent(x+1,v+1)>s){if(x<B){B=x}if(x>=w){w=x+1}if(v<p){p=v}if(v>=A){A=v+1}}}}var o,q,u,y,m=false;if((B===w-1)&&(B>t+1)&&(w<r-1)){B--;w++}if((p===A-1)&&(p>k+1)&&(A<h-1)){p--;A++}if((B>t||w<r)&&(B<w-1)){o=l.GetBinCoord(B);q=l.GetBinCoord(w);m=true}if((p>k||A<h)&&(p<A-1)){u=z.GetBinCoord(p);y=z.GetBinCoord(A);m=true}if(m){this.frame_painter().Zoom(o,q,u,y)}};f.prototype.ScanContent=function(o){if(o&&this.nbinsx&&this.nbinsy){return}var m,l,k=this.GetHisto();this.nbinsx=this.GetAxis("x").fNBins-2;this.nbinsy=this.GetAxis("y").fNBins-2;this.CreateAxisFuncs(true);if(this.IsTH2Poly()){this.gminposbin=null;this.gminbin=this.gmaxbin=0;for(var q=0,h=k.fBins.arr.length;q<h;++q){var p=k.fBins.arr[q].fContent;if(q===0){this.gminbin=this.gmaxbin=p}if(p<this.gminbin){this.gminbin=p}else{if(p>this.gmaxbin){this.gmaxbin=p}}if(p>0){if((this.gminposbin===null)||(this.gminposbin>p)){this.gminposbin=p}}}}else{this.gminbin=this.gmaxbin=k.getBinContent(1,1);this.gminposbin=null;for(m=0;m<this.nbinsx;++m){for(l=0;l<this.nbinsy;++l){var p=k.getBinContent(m+1,l+1);if(p<this.gminbin){this.gminbin=p}else{if(p>this.gmaxbin){this.gmaxbin=p}}if(p>0){if((this.gminposbin===null)||(this.gminposbin>p)){this.gminposbin=p}}}}}if(this.gminposbin===null){this.gminposbin=this.gmaxbin*0.0001}if(this.options.Axis>0){this.draw_content=false}else{this.draw_content=this.gmaxbin>0;if(!this.draw_content&&this.options.Zero&&this.IsTH2Poly()){this.draw_content=true;this.options.Line=1}}};f.prototype.CountStat=function(t){var v=this.GetObject(),m=0,r=0,E=0,q=0,D=0,K=0,j,G,o,z,M,p=this.frame_painter(),O={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var J=v.fBins.arr.length,F,y,C,A,u,x,h,s=this.frame_painter();for(F=0;F<J;++F){y=v.fBins.arr[F];j=1;G=1;if(y.fXmin>s.scale_xmax){j=2}else{if(y.fXmax<s.scale_xmin){j=0}}if(y.fYmin>s.scale_ymax){G=2}else{if(y.fYmax<s.scale_ymin){G=0}}o=z=h=0;A=y.fPoly;x=1;if(A._typename==="TMultiGraph"){x=y.fPoly.fGraphs.arr.length;A=null}for(u=0;u<x;++u){if(!A||(u>0)){A=y.fPoly.fGraphs.arr[u]}for(C=0;C<A.fNpoints;++C){++h;o+=A.fX[C];z+=A.fY[C]}}if(h>1){o=o/h;z=z/h}M=y.fContent;O.entries+=M;O.matrix[G*3+j]+=M;if((j!=1)||(G!=1)){continue}if((t!=null)&&!t(o,z)){continue}if((O.wmax==null)||(M>O.wmax)){O.wmax=M;O.xmax=o;O.ymax=z}m+=M;r+=o*M;E+=z*M;q+=o*o*M;D+=z*z*M;K+=o*z*M}}else{var l=this.GetSelectIndex("x","left"),B=this.GetSelectIndex("x","right"),L=this.GetSelectIndex("y","left"),I=this.GetSelectIndex("y","right"),w,N,k=this.GetAxis("x"),H=this.GetAxis("y");for(w=0;w<=this.nbinsx+1;++w){j=(w<=l)?0:(w>B?2:1);o=k.GetBinCoord(w-0.5);for(N=0;N<=this.nbinsy+1;++N){G=(N<=L)?0:(N>I?2:1);z=H.GetBinCoord(N-0.5);M=v.getBinContent(w,N);O.entries+=M;O.matrix[G*3+j]+=M;if((j!=1)||(G!=1)){continue}if((t!=null)&&!t(o,z)){continue}if((O.wmax==null)||(M>O.wmax)){O.wmax=M;O.xmax=o;O.ymax=z}m+=M;r+=o*M;E+=z*M;q+=o*o*M;D+=z*z*M;K+=o*z*M}}}if(!p.IsAxisZoomed("x")&&!p.IsAxisZoomed("y")&&(v.fTsumw>0)){m=v.fTsumw;r=v.fTsumwx;q=v.fTsumwx2;E=v.fTsumwy;D=v.fTsumwy2;K=v.fTsumwxy}if(m>0){O.meanx=r/m;O.meany=E/m;O.rmsx=Math.sqrt(Math.abs(q/m-O.meanx*O.meanx));O.rmsy=Math.sqrt(Math.abs(D/m-O.meany*O.meany))}if(O.wmax===null){O.wmax=0}O.integral=m;if(v.fEntries>1){O.entries=v.fEntries}return O};f.prototype.FillStatistic=function(o,p,v){if(this.IgnoreStatsFill()){return false}var n=this.CountStat(),s=Math.floor(p%10),t=Math.floor(p/10)%10,r=Math.floor(p/100)%10,u=Math.floor(p/1000)%10,h=Math.floor(p/10000)%10,i=Math.floor(p/100000)%10,k=Math.floor(p/1000000)%10,q=Math.floor(p/10000000)%10,l=Math.floor(p/100000000)%10;o.ClearPave();if(s>0){o.AddText(n.name)}if(t>0){o.AddText("Entries = "+o.Format(n.entries,"entries"))}if(r>0){o.AddText("Mean x = "+o.Format(n.meanx));o.AddText("Mean y = "+o.Format(n.meany))}if(u>0){o.AddText("Std Dev x = "+o.Format(n.rmsx));o.AddText("Std Dev y = "+o.Format(n.rmsy))}if(k>0){o.AddText("Integral = "+o.Format(n.matrix[4],"entries"))}if(q>0){o.AddText("Skewness x = <undef>");o.AddText("Skewness y = <undef>")}if(l>0){o.AddText("Kurt = <undef>")}if((h>0)||(i>0)){var j=n.matrix;o.AddText(""+j[6].toFixed(0)+" | "+j[7].toFixed(0)+" | "+j[7].toFixed(0));o.AddText(""+j[3].toFixed(0)+" | "+j[4].toFixed(0)+" | "+j[5].toFixed(0));o.AddText(""+j[0].toFixed(0)+" | "+j[1].toFixed(0)+" | "+j[2].toFixed(0))}return true};f.prototype.DrawBinsColor=function(t,o){var m=this.GetHisto(),p=this.PrepareColorDraw(),k=[],s=[],r=[],v,x,u,n,l,q;for(n=p.i1;n<p.i2;++n){for(l=p.j1;l<p.j2;++l){q=m.getBinContent(n+1,l+1);v=this.getContourColor(q,true);if(q===0){if(!this.options.Zero){continue}if((v===null)&&this._show_empty_bins){v=0}}if(v===null){continue}x="M"+p.grx[n]+","+p.gry[l+1];if(k[v]===undefined){k[v]=x}else{u="m"+(p.grx[n]-s[v])+","+(p.gry[l+1]-r[v]);k[v]+=(u.length<x.length)?u:x}s[v]=p.grx[n];r[v]=p.gry[l+1];k[v]+="v"+(p.gry[l]-p.gry[l+1])+"h"+(p.grx[n+1]-p.grx[n])+"v"+(p.gry[l+1]-p.gry[l])+"z"}}for(v=0;v<k.length;++v){if(k[v]!==undefined){this.draw_g.append("svg:path").attr("palette-index",v).attr("fill",this.fPalette.getColor(v)).attr("d",k[v])}}return p};f.prototype.BuildContour=function(M,L,ak,E){var G=this.GetHisto(),ad=0,t=this,T=2004,o=2000,W=new Float32Array(2*T),h=new Float32Array(2*T),D=new Int32Array(2*T),X=0,ai,U,aa=[],am,J=0,ac=[0,0,0,0],ab=[0,0,0,0],r=[0,0,0,0],P=[0,0,0,0],al,aj,ah,af,ag,O,l,ae,Q,F,C,O,q;function w(i){for(var j=0;j<L.length;++j){if(i<L[j]){return j-1}}return L.length-1}function u(an,ax,aA,k,y,aw,az,j){var ay=(aA===az),i=ay?(j-k):(az-aA),av=ax+1,x=y-an,ao=X-1,ar=T/2-3+X,m=0,au,aq,ap,at;while(av<=aw&&ao<=ar){at=L[av];ap=at-an;aq=ap/x;au=i*aq;if(ay){W[ao]=aA;h[ao]=k+au}else{W[ao]=aA+au;h[ao]=k}D[ao]=av;m++;ao+=2;av++}return m}var s=M.original?M.origx:M.grx,p=M.original?M.origy:M.gry;for(aj=M.j1;aj<M.j2-1;++aj){ab[1]=ab[0]=(p[aj]+p[aj+1])/2;ab[3]=ab[2]=(p[aj+1]+p[aj+2])/2;for(al=M.i1;al<M.i2-1;++al){r[0]=G.getBinContent(al+1,aj+1);r[1]=G.getBinContent(al+2,aj+1);r[2]=G.getBinContent(al+2,aj+2);r[3]=G.getBinContent(al+1,aj+2);for(ah=0;ah<4;ah++){P[ah]=w(r[ah])}if((P[0]!==P[1])||(P[1]!==P[2])||(P[2]!==P[3])||(P[3]!==P[0])){ac[3]=ac[0]=(s[al]+s[al+1])/2;ac[2]=ac[1]=(s[al+1]+s[al+2])/2;if(r[0]<=r[1]){af=0}else{af=1}if(r[2]<=r[3]){ag=2}else{ag=3}if(r[af]>r[ag]){af=ag}af++;X=1;for(O=1;O<=4;O++){ag=af%4+1;l=u(r[af-1],P[af-1],ac[af-1],ab[af-1],r[ag-1],P[ag-1],ac[ag-1],ab[ag-1]);X+=2*l;af=ag}if(r[0]<=r[1]){af=0}else{af=1}if(r[2]<=r[3]){ag=2}else{ag=3}if(r[af]>r[ag]){af=ag}af++;X=2;for(O=1;O<=4;O++){if(af==1){ag=4}else{ag=af-1}l=u(r[af-1],P[af-1],ac[af-1],ab[af-1],r[ag-1],P[ag-1],ac[ag-1],ab[ag-1]);X+=2*l;af=ag}ae=0;for(O=1;O<=X-5;O+=2){while(D[O-1]!=D[O]){Q=W[O];F=h[O];C=D[O];for(q=O;q<=X-5;q+=2){W[q]=W[q+2];h[q]=h[q+2];D[q]=D[q+2]}W[X-3]=Q;h[X-3]=F;D[X-3]=C;if(ae>o){break}ae++}}if(ae>o){continue}for(O=1;O<=X-2;O+=2){ai=D[O-1];if((ai>=0)&&(ai<L.length)){U=aa[ai];if(!U){U=aa[ai]=a.CreateTPolyLine(T*4,true)}am=U.fLastPoint;if(am<U.fN-2){U.fX[am+1]=Math.round(W[O-1]);U.fY[am+1]=Math.round(h[O-1]);U.fX[am+2]=Math.round(W[O]);U.fY[am+2]=Math.round(h[O]);U.fLastPoint=am+2;J=Math.max(J,U.fLastPoint+1)}else{}}}}}}var S=new Int32Array(L.length),B=0;for(ai=0;ai<L.length;ai++){if(L[ai]>=0){B=ai;break}}ah=0;for(ai=B-1;ai>=0;ai--){S[ah]=ai;ah++}for(ai=B;ai<L.length;ai++){S[ah]=ai;ah++}var Y=new Float32Array(2*J),I=new Float32Array(2*J);for(ah=0;ah<L.length;++ah){ai=S[ah];U=aa[ai];if(!U){continue}var N=ak.calcColorIndex(ai,L.length),R=U.fX,A=U.fY,am=U.fLastPoint+1,Z=0,H,K,v=0,V=0,z;while(true){H=J;K=H+1;Y[H]=R[Z];I[H]=A[Z];Y[K]=R[Z+1];I[K]=A[Z+1];R[Z]=R[Z+1]=v;A[Z]=A[Z+1]=V;while(true){z=0;for(al=2;al<am;al+=2){if((K<2*J-1)&&(R[al]===Y[K])&&(A[al]===I[K])){K++;Y[K]=R[al+1];I[K]=A[al+1];R[al]=R[al+1]=v;A[al]=A[al+1]=V;z++}if((H>0)&&(R[al+1]===Y[H])&&(A[al+1]===I[H])){H--;Y[H]=R[al];I[H]=A[al];R[al]=R[al+1]=v;A[al]=A[al+1]=V;z++}}if(z==0){break}}if((H+1<K)&&(H>=0)){E(N,Y,I,H,K,ai)}Z=0;for(al=2;al<am;al+=2){if(R[al]!==v&&A[al]!==V){Z=al;break}}if(Z===0){break}}}};f.prototype.DrawBinsContour=function(h,q){var o=this.PrepareColorDraw({rounding:false,extra:100,original:this.options.Proj!=0}),u=this.GetContour(),j=this.GetPalette(),r=this,l=this.frame_painter();function k(z,C,w,v){var B="",y=null,A=null,x;for(x=w;x<=v;++x){A=null;switch(r.options.Proj){case 1:A=l.ProjectAitoff2xy(z[x],C[x]);break;case 2:A=l.ProjectMercator2xy(z[x],C[x]);break;case 3:A=l.ProjectSinusoidal2xy(z[x],C[x]);break;case 4:A=l.ProjectParabolic2xy(z[x],C[x]);break}if(A){A.x=l.grx(A.x);A.y=l.gry(A.y)}else{A={x:z[x],y:C[x]}}A.x=Math.round(A.x);A.y=Math.round(A.y);if(!B){B="M"+A.x+","+A.y}else{if((A.x!=y.x)&&(A.y!=y.y)){B+="l"+(A.x-y.x)+","+(A.y-y.y)}else{if(A.x!=y.x){B+="h"+(A.x-y.x)}else{if(A.y!=y.y){B+="v"+(A.y-y.y)}}}}y=A}return B}if(this.options.Contour===14){var s="M0,0h"+h+"v"+q+"h-"+h;if(this.options.Proj){var p=o.j2-o.j1,t=new Float32Array(p*2),n=new Float32Array(p*2);for(var m=0;m<p;++m){t[m]=o.origx[o.i1];n[m]=(o.origy[o.j1]*(m+0.5)+o.origy[o.j2]*(p-0.5-m))/p;t[m+p]=o.origx[o.i2];n[m+p]=(o.origy[o.j2]*(m+0.5)+o.origy[o.j1]*(p-0.5-m))/p}s=k(t,n,0,2*p-1)}this.draw_g.append("svg:path").attr("d",s+"z").style("stroke","none").style("fill",j.calcColor(0,u.length))}this.BuildContour(o,u,j,function(C,x,i,z,y){var B=j.getColor(C),w=B,A=null;switch(r.options.Contour){case 1:break;case 11:w="none";A=new a.TAttLineHandler({color:B});break;case 12:w="none";A=new a.TAttLineHandler({color:1,style:(C%5+1),width:1});break;case 13:w="none";A=r.lineatt;break;case 14:break}var v=r.draw_g.append("svg:path").attr("class","th2_contour").attr("d",k(x,i,z,y)+(w=="none"?"":"z")).style("fill",w);if(A!==null){v.call(A.func)}else{v.style("stroke","none")}});o.hide_only_zeros=true;return o};f.prototype.CreatePolyBin=function(r,v){var l="",i,h=1,k=null;if(v.fPoly._typename=="TMultiGraph"){h=v.fPoly.fGraphs.arr.length}else{k=v.fPoly}for(i=0;i<h;++i){if(!k||(i>0)){k=v.fPoly.fGraphs.arr[i]}var u=k.fNpoints,j,t=k.fX,s=k.fY,o=Math.round(r.grx(t[0])),m=Math.round(r.gry(s[0])),q,p;if((u>2)&&(t[0]==t[u-1])&&(s[0]==s[u-1])){u--}l+="M"+o+","+m;for(j=1;j<u;++j){q=Math.round(r.grx(t[j]));p=Math.round(r.gry(s[j]));if((o!==q)||(m!==p)){if(o===q){l+="v"+(p-m)}else{if(m===p){l+="h"+(q-o)}else{l+="l"+(q-o)+","+(p-m)}}}o=q;m=p}l+="z"}return l};f.prototype.DrawPolyBinsColor=function(p,z){var q=this.GetHisto(),m=this.frame_painter(),C=[],n=[],k,u,r,B,v,y=q.fBins.arr.length;this.fContour=null;this.fCustomContour=false;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(v=0;v<y;++v){r=q.fBins.arr[v];k=this.getContourColor(r.fContent,true);if(k===null){continue}if(r.fContent===0){if(!this.options.Zero||!this.options.Line){continue}k=0}if((r.fXmin>m.scale_xmax)||(r.fXmax<m.scale_xmin)||(r.fYmin>m.scale_ymax)||(r.fYmax<m.scale_ymin)){continue}u=this.CreatePolyBin(m,r);if(C[k]===undefined){C[k]=u}else{C[k]+=u}if(this.options.Text){n.push(r)}}for(k=0;k<C.length;++k){if(C[k]){B=this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",k?this.fPalette.getColor(k):"none").attr("d",C[k]);if(this.options.Line){B.call(this.lineatt.func)}}}if(n.length>0){var j=this.get_color(q.fMarkerColor),l=-1*this.options.TextAngle,x=this.draw_g.append("svg:g").attr("class","th2poly_text"),o=12;if((q.fMarkerSize!==1)&&l){o=Math.round(0.02*z*q.fMarkerSize)}this.StartTextDrawing(42,o,x,o);for(v=0;v<n.length;++v){r=n[v];var t=Math.round(m.x((r.fXmin+r.fXmax)/2)),s=Math.round(m.y((r.fYmin+r.fYmax)/2)),A="";if(!this.options.TextKind){A=(Math.round(r.fContent)===r.fContent)?r.fContent.toString():a.FFormat(r.fContent,a.gStyle.fPaintTextFormat)}else{if(r.fPoly){A=r.fPoly.fName}if(A==="Graph"){A=""}if(!A){A=r.fNumber}}this.DrawText({align:22,x:t,y:s,rotate:l,text:A,color:j,latex:0,draw_g:x})}this.FinishTextDrawing(x,null)}return{poly:true}};f.prototype.DrawBinsText=function(p,A,D){var r=this.GetHisto(),z,x,q,m,s,F,B,u,t,E,C;if(D===null){D=this.PrepareColorDraw({rounding:false})}var k=this.get_color(r.fMarkerColor),n=-1*this.options.TextAngle,y=this.draw_g.append("svg:g").attr("class","th2_text"),o=20,l=0,v=(this.options.TextKind=="E")&&this.MatchObjectType("TProfile2D")&&(typeof r.getBinEntries=="function");if((r.fMarkerSize!==1)&&n){o=Math.round(0.02*A*r.fMarkerSize)}if(this.options.fBarOffset!==0){l=this.options.fBarOffset*0.001}this.StartTextDrawing(42,o,y,o);for(z=D.i1;z<D.i2;++z){for(x=D.j1;x<D.j2;++x){q=r.getBinContent(z+1,x+1);if((q===0)&&!this._show_empty_bins){continue}s=D.grx[z+1]-D.grx[z];F=D.gry[x]-D.gry[x+1];if(v){q=r.getBinEntries(z+1,x+1)}B=(q===Math.round(q))?q.toString():a.FFormat(q,a.gStyle.fPaintTextFormat);if(n){u=Math.round(D.grx[z]+s*0.5);t=Math.round(D.gry[x+1]+F*(0.5+l));E=0;C=0}else{u=Math.round(D.grx[z]+s*0.1);t=Math.round(D.gry[x+1]+F*(0.1+l));E=Math.round(s*0.8);C=Math.round(F*0.8)}this.DrawText({align:22,x:u,y:t,width:E,height:C,rotate:n,text:B,color:k,latex:0,draw_g:y})}}this.FinishTextDrawing(y,null);D.hide_only_zeros=true;return D};f.prototype.DrawBinsArrow=function(r,G){var u=this.GetHisto(),B="",D,A,t,p,v,N,I,L,y=1e-30,s,q,z,k,J,n,H,F,m,l,x,M,o,K=this.PrepareColorDraw({rounding:false}),E=(K.grx[K.i2]-K.grx[K.i1])/(K.i2-K.i1+1-0.03)/2,C=(K.gry[K.j2]-K.gry[K.j1])/(K.j2-K.j1+1-0.03)/2;for(var L=0;L<2;++L){for(D=K.i1;D<K.i2;++D){for(A=K.j1;A<K.j2;++A){if(D===K.i1){s=u.getBinContent(D+2,A+1)-u.getBinContent(D+1,A+1)}else{if(D===K.i2-1){s=u.getBinContent(D+1,A+1)-u.getBinContent(D,A+1)}else{s=0.5*(u.getBinContent(D+2,A+1)-u.getBinContent(D,A+1))}}if(A===K.j1){q=u.getBinContent(D+1,A+2)-u.getBinContent(D+1,A+1)}else{if(A===K.j2-1){q=u.getBinContent(D+1,A+1)-u.getBinContent(D+1,A)}else{q=0.5*(u.getBinContent(D+1,A+2)-u.getBinContent(D+1,A))}}if(L===0){y=Math.max(y,Math.abs(s),Math.abs(q))}else{z=(K.grx[D]+K.grx[D+1])/2;k=(K.gry[A]+K.gry[A+1])/2;J=E*s/y;n=C*q/y;H=z-J;F=z+J;m=k-n;l=k+n;s=Math.round(F-H);q=Math.round(l-m);if((s!==0)||(q!==0)){B+="M"+Math.round(H)+","+Math.round(m)+"l"+s+","+q;if(Math.abs(s)>5||Math.abs(q)>5){x=Math.sqrt(2/(s*s+q*q));M=Math.round(x*(s+q));o=Math.round(x*(s-q));if((M!==0)&&(o!==0)){B+="l"+(-M)+","+o+"m"+M+","+(-o)+"l"+(-o)+","+(-M)}}}}}}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",B).style("fill","none").call(this.lineatt.func);return K};f.prototype.DrawBinsBox=function(D,K){var F=this.GetHisto(),P=this.PrepareColorDraw({rounding:false}),B=this.frame_painter();if(B.maxbin===B.minbin){B.maxbin=this.gmaxbin;B.minbin=this.gminbin;B.minposbin=this.gminposbin}if(B.maxbin===B.minbin){B.minbin=Math.min(0,B.maxbin-1)}var u=Math.max(Math.abs(B.maxbin),Math.abs(B.minbin)),o=Math.max(0,B.minbin),J,H,E,v,S="",r="",s="",q="",C,L,n,m,A,G,R,t,l,k,y=1,O=false,I=0,M=1;if(this.root_pad().fLogz&&(u>0)){O=true;M=Math.log(u);if(o>0){I=Math.log(o)}else{if((B.minposbin>=1)&&(B.minposbin<100)){I=Math.log(0.7)}else{I=(B.minposbin>0)?Math.log(0.7*B.minposbin):M-10}}if(I>=M){I=M-10}y=1/(M-I)}else{y=1/(u-o)}for(J=P.i1;J<P.i2;++J){for(H=P.j1;H<P.j2;++H){E=F.getBinContent(J+1,H+1);v=Math.abs(E);if((v===0)||(v<o)){continue}L=O?((v>0)?Math.log(v)-I:0):(v-o);L=0.5*((L<0)?1:(1-Math.sqrt(L*y)));if(L<0){L=0}R=P.grx[J+1]-P.grx[J];t=P.gry[H]-P.gry[H+1];n=L*R;m=L*t;A=Math.round(P.grx[J]+n);G=Math.round(P.gry[H+1]+m);R=Math.max(Math.round(R-2*n),1);t=Math.max(Math.round(t-2*m),1);S+="M"+A+","+G+"v"+t+"h"+R+"v-"+t+"z";if((E<0)&&(this.options.BoxStyle===10)){r+="M"+A+","+G+"l"+R+","+t+"M"+(A+R)+","+G+"l-"+R+","+t}if((this.options.BoxStyle===11)&&(R>5)&&(t>5)){var Q=Math.round(R*0.1),p=Math.round(t*0.1),z="M"+A+","+G+"h"+R+"l"+(-Q)+","+p+"h"+(2*Q-R)+"v"+(t-2*p)+"l"+(-Q)+","+p+"z",x="M"+(A+R)+","+(G+t)+"v"+(-t)+"l"+(-Q)+","+p+"v"+(t-2*p)+"h"+(2*Q-R)+"l"+(-Q)+","+p+"z";if(E<0){q+=z;s+=x}else{s+=z;q+=x}}}}if(S.length>0){var N=this.draw_g.append("svg:path").attr("d",S).call(this.fillatt.func);if((this.options.BoxStyle===11)||!this.fillatt.empty()){N.style("stroke","none")}else{N.call(this.lineatt.func)}}if((s.length>0)&&(this.fillatt.color!=="none")){this.draw_g.append("svg:path").attr("d",s).style("stroke","none").call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).brighter(0.5).toString())}if(q.length>0){this.draw_g.append("svg:path").attr("d",q).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.color==="none"?"red":b.rgb(this.fillatt.color).darker(0.5).toString())}if(r.length>0){var N=this.draw_g.append("svg:path").attr("d",r).style("fill","none");if(this.lineatt.color!=="none"){N.call(this.lineatt.func)}else{N.style("stroke","black")}}return P};f.prototype.DrawCandle=function(p,x){var q=this.GetHisto(),v=this.GetAxis("y"),A=this.PrepareColorDraw(),m=this.frame_painter(),u,t,n,E,C,B,l,D,o,k,p,F,r="",z="",s;if(q.fMarkerColor===1){q.fMarkerColor=q.fLineColor}this.createAttMarker({attr:q,style:5});this.markeratt.reset_pos();A.candle=[];for(u=A.i1;u<A.i2;++u){C=0;k=0;o=0;for(t=0;t<this.nbinsy;++t){k+=q.getBinContent(u+1,t+1)}F={bin:u,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(t=0;t<this.nbinsy;++t){l=q.getBinContent(u+1,t+1);s=v.GetBinCoord(t+0.5);if(o/k<0.001&&(o+l)/k>=0.001){F.whiskerm=s}if(o/k<0.25&&(o+l)/k>=0.25){F.m25y=s}if(o/k<0.5&&(o+l)/k>=0.5){F.median=s}if(o/k<0.75&&(o+l)/k>=0.75){F.p25y=s}if(o/k<0.999&&(o+l)/k>=0.999){F.whiskerp=s}o+=l;n=s;C+=l*n}if(o>0){F.meany=C/o}F.iqr=F.p25y-F.m25y;if((F.m25y-1.5*F.iqr)>F.whsikerm){F.whiskerm=F.m25y-1.5*F.iqr}if((F.p25y+1.5*F.iqr)<F.whiskerp){F.whiskerp=F.p25y+1.5*F.iqr}if(m.logy&&(F.whiskerm<=0)){continue}p=A.grx[u+1]-A.grx[u];p*=0.66;D=(A.grx[u+1]+A.grx[u])/2+this.options.fBarOffset/1000*p;if(this.options.fBarWidth>0){p=p*this.options.fBarWidth/1000}F.x1=Math.round(D-p/2);F.x2=Math.round(D+p/2);D=Math.round(D);F.y0=Math.round(m.gry(F.median));r+="M"+F.x1+","+F.y0+"h"+(F.x2-F.x1);F.y1=Math.round(m.gry(F.p25y));F.y2=Math.round(m.gry(F.m25y));r+="M"+F.x1+","+F.y1+"v"+(F.y2-F.y1)+"h"+(F.x2-F.x1)+"v-"+(F.y2-F.y1)+"z";F.yy1=Math.round(m.gry(F.whiskerp));F.yy2=Math.round(m.gry(F.whiskerm));r+="M"+D+","+F.y1+"v"+(F.yy1-F.y1);r+="M"+F.x1+","+F.yy1+"h"+(F.x2-F.x1);r+="M"+D+","+F.y2+"v"+(F.yy2-F.y2);r+="M"+F.x1+","+F.yy2+"h"+(F.x2-F.x1);for(t=0;t<this.nbinsy;++t){l=q.getBinContent(u+1,t+1);s=v.GetBinCoord(t+0.5);if(l>0&&s<F.whiskerm){z+=this.markeratt.create(D,s)}if(l>0&&s>F.whiskerp){z+=this.markeratt.create(D,s)}}A.candle.push(F)}if(r.length>0){this.draw_g.append("svg:path").attr("d",r).call(this.lineatt.func).call(this.fillatt.func)}if(z.length>0){this.draw_g.append("svg:path").attr("d",z).call(this.markeratt.func)}return A};f.prototype.DrawBinsScatter=function(t,J){var y=this.GetHisto(),N=this.PrepareColorDraw({rounding:true,pixel_density:true}),O=[],M=[],L=[],p=[],s=[],r,o,l,I,G,x,q,u,z=1,Q=this.options.ScatCoef*((this.gmaxbin)>2000?2000/this.gmaxbin:1);a.seed(N.sumz);if(Q*N.sumz<100000){this.createAttMarker({attr:y});this.markeratt.reset_pos();var A="",C,v;for(I=N.i1;I<N.i2;++I){q=N.grx[I+1]-N.grx[I];for(G=N.j1;G<N.j2;++G){u=N.gry[G]-N.gry[G+1];x=y.getBinContent(I+1,G+1);v=Math.round(Q*x);if(v<=0){continue}for(C=0;C<v;++C){A+=this.markeratt.create(Math.round(N.grx[I]+q*a.random()),Math.round(N.gry[G+1]+u*a.random()))}}}this.draw_g.append("svg:path").attr("d",A).call(this.markeratt.func);return N}if(this.maxbin>0.7){z=0.7/this.maxbin}var F=Math.round(N.max-N.min);this.CreateContour((F>50)?50:F,this.minposbin,this.maxbin,this.minposbin);for(I=N.i1;I<N.i2;++I){for(G=N.j1;G<N.j2;++G){x=y.getBinContent(I+1,G+1);if((x<=0)||(x<this.minbin)){continue}q=N.grx[I+1]-N.grx[I];u=N.gry[G]-N.gry[G+1];if(q*u<=0){continue}r=this.getContourIndex(x/q/u);if(r<0){continue}o="M"+N.grx[I]+","+N.gry[G+1];if(O[r]===undefined){O[r]=o;p[r]=q;s[r]=u}else{l="m"+(N.grx[I]-M[r])+","+(N.gry[G+1]-L[r]);O[r]+=(l.length<o.length)?l:o;p[r]=Math.max(p[r],q);s[r]=Math.max(s[r],u)}M[r]=N.grx[I];L[r]=N.gry[G+1];O[r]+="v"+u+"h"+q+"v-"+u+"z"}}var P=this.svg_frame().select(".main_layer"),m=P.select("defs");if(m.empty()&&(O.length>0)){m=P.insert("svg:defs",":first-child")}this.createAttMarker({attr:y});for(r=0;r<O.length;++r){if((O[r]!==undefined)&&(r<this.fContour.length)){var E="scatter_"+r,K=m.select("."+E);if(K.empty()){K=m.append("svg:pattern").attr("class",E).attr("id","jsroot_scatter_pattern_"+a.id_counter++).attr("patternUnits","userSpaceOnUse")}else{K.selectAll("*").remove()}var v=Math.round(z*this.fContour[r]*p[r]*s[r]);if(v<1){v=1}var H=new Float32Array(v),D=new Float32Array(v);if(v===1){H[0]=D[0]=0.5}else{for(var B=0;B<v;++B){H[B]=a.random();D[B]=a.random()}}this.markeratt.reset_pos();var A="";for(var B=0;B<v;++B){A+=this.markeratt.create(H[B]*p[r],D[B]*s[r])}K.attr("width",p[r]).attr("height",s[r]).append("svg:path").attr("d",A).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",r).attr("fill","url(#"+K.attr("id")+")").attr("d",O[r])}}return N};f.prototype.DrawBins=function(){if(!this.draw_content){return this.RemoveDrawG()}this.CheckHistDrawAttributes();this.CreateG(true);var i=this.frame_width(),j=this.frame_height(),k=null;if(this.IsTH2Poly()){k=this.DrawPolyBinsColor(i,j)}else{if(this.options.Scat){k=this.DrawBinsScatter(i,j)}else{if(this.options.Color){k=this.DrawBinsColor(i,j)}else{if(this.options.Box){k=this.DrawBinsBox(i,j)}else{if(this.options.Arrow){k=this.DrawBinsArrow(i,j)}else{if(this.options.Contour>0){k=this.DrawBinsContour(i,j)}else{if(this.options.Candle){k=this.DrawCandle(i,j)}}}}}}}if(this.options.Text){k=this.DrawBinsText(i,j,k)}if(!k){k=this.DrawBinsScatter(i,j)}this.tt_handle=k};f.prototype.GetBinTips=function(n,m){var k=[],h=this.frame_painter(),q=this.GetAxis("y"),o=this.GetAxis("y"),l=this.GetHisto(),p=l.getBinContent(n+1,m+1);k.push(this.GetTipName()||"histo<2>");if(h.x_kind=="labels"){k.push("x = "+h.AxisAsText("x",q.GetBinCoord(n)))}else{k.push("x = ["+h.AxisAsText("x",q.GetBinCoord(n))+", "+h.AxisAsText("x",q.GetBinCoord(n+1))+")")}if(h.y_kind=="labels"){k.push("y = "+h.AxisAsText("y",o.GetBinCoord(m)))}else{k.push("y = ["+h.AxisAsText("y",o.GetBinCoord(m))+", "+h.AxisAsText("y",o.GetBinCoord(m+1))+")")}k.push("bin = "+n+", "+m);if(l.$baseh){p-=l.$baseh.getBinContent(n+1,m+1)}if(p===Math.round(p)){k.push("entries = "+p)}else{k.push("entries = "+a.FFormat(p,a.gStyle.fStatFormat))}return k};f.prototype.GetCandleTips=function(j){var i=[],h=this.frame_painter(),k=this.GetAxis("y");i.push(this.GetTipName()||"histo");i.push("x = "+h.AxisAsText("x",k.GetBinCoord(j.bin)));i.push("mean y = "+a.FFormat(j.meany,a.gStyle.fStatFormat));i.push("m25 = "+a.FFormat(j.m25y,a.gStyle.fStatFormat));i.push("p25 = "+a.FFormat(j.p25y,a.gStyle.fStatFormat));return i};f.prototype.ProvidePolyBinHints=function(m,h,s){var o=this.GetHisto(),t=o.fBins.arr[m],q=this.frame_painter(),r=t.fPoly.fName,u=[],p=0;if(r==="Graph"){r=""}if(r.length===0){r=t.fNumber}if((h===undefined)&&(s===undefined)){h=s=0;var l=t.fPoly,j=1;if(l._typename==="TMultiGraph"){j=t.fPoly.fGraphs.arr.length;l=null}for(var i=0;i<j;++i){if(!l||(i>0)){l=t.fPoly.fGraphs.arr[i]}for(var k=0;k<l.fNpoints;++k){++p;h+=l.fX[k];s+=l.fY[k]}}if(p>1){h=h/p;s=s/p}}u.push(this.GetTipName()||"histo");u.push("x = "+q.AxisAsText("x",h));u.push("y = "+q.AxisAsText("y",s));if(p>0){u.push("npnts = "+p)}u.push("bin = "+r);if(t.fContent===Math.round(t.fContent)){u.push("content = "+t.fContent)}else{u.push("content = "+a.FFormat(t.fContent,a.gStyle.fStatFormat))}return u};f.prototype.ProcessTooltip=function(M){if(!M||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var w=this.GetHisto(),I=this.tt_handle,F,L=this.draw_g.select(".tooltip_bin");if(I.poly){var t=this.frame_painter(),r,q,m=-1;if(t.grx===t.x){r=t.x.invert(M.x)}if(t.gry===t.y){q=t.y.invert(M.y)}if((r!==undefined)&&(q!==undefined)){var F,H=w.fBins.arr.length,y;for(F=0;(F<H)&&(m<0);++F){y=w.fBins.arr[F];if((r<y.fXmin)||(r>y.fXmax)||(q<y.fYmin)||(q>y.fYmax)){continue}if((y.fContent===0)&&!this.options.Zero){continue}var B=y.fPoly,z=1;if(B._typename==="TMultiGraph"){z=y.fPoly.fGraphs.arr.length;B=null}for(var u=0;u<z;++u){if(!B||(u>0)){B=y.fPoly.fGraphs.arr[u]}if(B.IsInside(r,q)){m=F;break}}}}if(m<0){L.remove();return null}var N={name:"histo",title:w.fTitle||"title",x:M.x,y:M.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:true,menu:true,lines:this.ProvidePolyBinHints(m,r,q)};if(M.disabled){L.remove();N.changed=true}else{if(L.empty()){L=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")}N.changed=L.property("current_bin")!==m;if(N.changed){L.attr("d",this.CreatePolyBin(t,y)).style("opacity","0.7").property("current_bin",m)}}if(N.changed){N.user_info={obj:w,name:w.fName||"histo",bin:m,cont:y.fContent,grx:M.x,gry:M.y}}return N}else{if(I.candle){var A;for(F=0;F<I.candle.length;++F){A=I.candle[F];if((A.x1<=M.x)&&(M.x<=A.x2)&&(A.yy1<=M.y)&&(M.y<=A.yy2)){break}}if(F>=I.candle.length){L.remove();return null}var N={name:w.fName||"histo",title:w.fTitle||"title",x:M.x,y:M.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(A),exact:true,menu:true};if(M.disabled){L.remove();N.changed=true}else{if(L.empty()){L=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}N.changed=L.property("current_bin")!==F;if(N.changed){L.attr("x",A.x1).attr("width",A.x2-A.x1).attr("y",A.yy1).attr("height",A.yy2-A.yy1).style("opacity","0.7").property("current_bin",F)}}if(N.changed){N.user_info={obj:w,name:w.fName||"histo",bin:F+1,cont:A.median,binx:F+1,biny:1,grx:M.x,gry:M.y}}return N}}var F,E,v=0,s=null;for(F=I.i1;F<I.i2;++F){if((M.x>=I.grx[F])&&(M.x<=I.grx[F+1])){break}}for(E=I.j1;E<I.j2;++E){if((M.y>=I.gry[E+1])&&(M.y<=I.gry[E])){break}}if((F<I.i2)&&(E<I.j2)){v=w.getBinContent(F+1,E+1);if(this.is_projection){s=0}else{if(I.hide_only_zeros){s=(v===0)&&!this._show_empty_bins?null:0}else{s=this.getContourColor(v,true);if((s===null)&&(v===0)&&this._show_empty_bins){s=0}}}}if(s===null){L.remove();return null}var N={name:w.fName||"histo",title:w.fTitle||"title",x:M.x,y:M.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(F,E),exact:true,menu:true};if(this.options.Color){N.color2=this.GetPalette().getColor(s)}if(M.disabled&&!this.is_projection){L.remove();N.changed=true}else{if(L.empty()){L=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}var D=F,C=F+1,l=E,k=E+1,J=I.grx[D],G=I.grx[C],o=I.gry[k],n=I.gry[l],x=F*10000+E;if(this.is_projection=="X"){J=0;G=this.frame_width();if(this.projection_width>1){var K=(this.projection_width-1)/2;if(k+K>=I.j2){k=Math.min(Math.round(k+K),I.j2);l=Math.max(k-this.projection_width,I.j1)}else{l=Math.max(Math.round(l-K),I.j1);k=Math.min(l+this.projection_width,I.j2)}}o=I.gry[k];n=I.gry[l];x=l*777+k*333}else{if(this.is_projection=="Y"){o=0;n=this.frame_height();if(this.projection_width>1){var K=(this.projection_width-1)/2;if(C+K>=I.i2){C=Math.min(Math.round(C+K),I.i2);D=Math.max(C-this.projection_width,I.i1)}else{D=Math.max(Math.round(D-K),I.i1);C=Math.min(D+this.projection_width,I.i2)}}J=I.grx[D],G=I.grx[C],x=D*777+C*333}}N.changed=L.property("current_bin")!==x;if(N.changed){L.attr("x",J).attr("width",G-J).attr("y",o).attr("height",n-o).style("opacity","0.7").property("current_bin",x)}if(this.is_projection&&N.changed){this.RedrawProjection(D,C,l,k)}}if(N.changed){N.user_info={obj:w,name:w.fName||"histo",bin:w.getBin(F+1,E+1),cont:v,binx:F+1,biny:E+1,grx:M.x,gry:M.y}}return N};f.prototype.CanZoomIn=function(j,i,h){if(j=="z"){return true}var k=this.GetAxis(j);return(k.FindBin(h,0.5)-k.FindBin(i,0)>1)};f.prototype.Draw2D=function(i,h){this.mode3d=false;this.Clear3DScene();if(this.DrawAxes()){}this.DrawBins();this.AddInteractive();a.CallBack(i)};f.prototype.Draw3D=function(i,h){this.mode3d=true;a.AssertPrerequisites("hist3d",function(){this.Draw3D(i,h)}.bind(this))};f.prototype.CallDrawFunc=function(k,j){var i=this.frame_painter();if(this.options.Mode3D!==i.mode3d){this.options.Mode3D=i.mode3d}var h=this.options.Mode3D?"Draw3D":"Draw2D";this[h](k,j)};f.prototype.Redraw=function(h){this.CallDrawFunc(null,h)};function c(k,j,i){var h=new f(j);h.PrepareFrame(k);h.options={Hist:false,Bar:false,Error:false,ErrorKind:-1,errorX:0,Zero:false,Mark:false,Line:false,Fill:false,Lego:0,Surf:0,Text:true,TextAngle:0,TextKind:"",fBarOffset:0,fBarWidth:1000,BaseLine:false,Mode3D:false,AutoColor:0,Color:false,Scat:false,ScatCoef:1,Candle:"",Box:false,BoxStyle:0,Arrow:false,Contour:0,Proj:0};if(j.fOpts.fStyle.fIdx==1){h.options.Box=true}else{h.options.Color=true}h.DecodeOptions(i);if(h.IsTH2Poly()){if(h.options.Mode3D){h.options.Lego=12}else{if(!h.options.Color){h.options.Color=true}}}h._show_empty_bins=false;h._can_move_colz=true;h.ScanContent();h.CallDrawFunc(function(){h.DrawingReady()});return h}a.v7.THistPainter=e;a.v7.TH1Painter=g;a.v7.TH2Painter=f;a.v7.drawHist1=d;a.v7.drawHist2=c;return a}));