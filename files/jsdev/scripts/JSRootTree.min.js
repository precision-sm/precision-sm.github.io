(function(a){if(typeof define==="function"&&define.amd){define(["JSRootCore","JSRootIOEvolution","JSRootMath"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./JSRootIOEvolution.js"),require("./JSRootMath.js"))}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootTree.js")}if(typeof JSROOT.IO!="object"){throw new Error("JSROOT.IO not defined","JSRootTree.js")}a(JSROOT)}}}(function(c){c.sources.push("tree");c.BranchType={kLeafNode:0,kBaseClassNode:1,kObjectNode:2,kClonesNode:3,kSTLNode:4,kClonesMemberNode:31,kSTLMemberNode:41};c.IO.BranchBits={kDoNotProcess:c.BIT(10),kIsClone:c.BIT(11),kBranchObject:c.BIT(12),kBranchAny:c.BIT(17),kAutoDelete:c.BIT(15),kDoNotUseBufferMap:c.BIT(22)};function e(){this.branches=[];this.names=[];this.directs=[];this.break_execution=0;this.tgtobj={}}e.prototype.AddBranch=function(g,f,h){if(!f){f=(typeof g==="string")?g:("br"+this.branches.length)}this.branches.push(g);this.names.push(f);this.directs.push(h);return this.branches.length-1};e.prototype.indexOfBranch=function(f){return this.branches.indexOf(f)};e.prototype.nameOfBranch=function(f){return this.names[f]};e.prototype.ShowProgress=function(f){};e.prototype.Abort=function(){this.break_execution=-1111};e.prototype.Begin=function(f){};e.prototype.Process=function(f){};e.prototype.Terminate=function(f){};c.CheckArrayPrototype=function(g,f){if(typeof g!=="object"){return 0}var m=Object.prototype.toString.apply(g);if(m.indexOf("[object")!==0){return 0}var n=m.indexOf("Array]");if(n<0){return 0}if(n>8){return 2}if(!f){return 1}var l,i=true;for(var h=0;h<g.length;++h){var j=typeof g[h];if(!l){l=j}if(j!==l){i=false;break}if((j=="object")&&c.CheckArrayPrototype(g[h])){i=false;break}}return i?2:1};function b(g,f,h){this.object=g;this.value=0;this.arr=[];this.indx=[];this.cnt=-1;this.tgtobj=h;if(typeof f==="object"){this.select=f}else{this.select=[]}}b.prototype.next=function(){var h,g,f=this.cnt,i;if(f>=0){if(++this.fastindx<this.fastlimit){this.value=this.fastarr[this.fastindx];return true}while(--f>=0){if((this.select[f]===undefined)&&(++this.indx[f]<this.arr[f].length)){break}}if(f<0){return false}}while(true){h=(f<0)?this.object:(this.arr[f])[this.indx[f]];g=h?typeof h:"any";if(g==="object"){if(h._typename!==undefined){if(c.IsRootCollection(h)){h=h.arr;g="array"}else{g="any"}}else{if(!isNaN(h.length)&&(c.CheckArrayPrototype(h)>0)){g="array"}else{g="any"}}}if(this.select[f+1]=="$self$"){this.value=h;this.fastindx=this.fastlimit=0;this.cnt=f+1;return true}if((g=="any")&&(typeof this.select[f+1]==="string")){this.arr[++f]=h;this.indx[f]=this.select[f];continue}if((g==="array")&&((h.length>0)||(this.select[f+1]==="$size$"))){this.arr[++f]=h;switch(this.select[f]){case undefined:this.indx[f]=0;break;case"$last$":this.indx[f]=h.length-1;break;case"$size$":this.value=h.length;this.fastindx=this.fastlimit=0;this.cnt=f;return true;break;default:if(!isNaN(this.select[f])){this.indx[f]=this.select[f];if(this.indx[f]<0){this.indx[f]=h.length-1}}else{this.select[f].Produce(this.tgtobj);this.indx[f]=Math.round(this.select[f].get(0))}}}else{if(f<0){return false}this.value=h;if(this.select[f]===undefined){this.fastarr=this.arr[f];this.fastindx=this.indx[f];this.fastlimit=this.fastarr.length}else{this.fastindx=this.fastlimit=0}this.cnt=f;return true}}return false};b.prototype.reset=function(){this.arr=[];this.indx=[];delete this.fastarr;this.cnt=-1;this.value=0};function d(f){this.globals=f;this.code="";this.brindex=[];this.branches=[];this.brarray=[];this.func=null;this.kind=undefined;this.buf=[]}d.prototype.Parse=function(l,r,f,h,g){function p(y){if((y>="A")&&(y<="Z")){return true}if((y>="a")&&(y<="z")){return true}return(y==="_")}function o(y){if(p(y)){return true}if((y>="0")&&(y<="9")){return true}return false}if(!f){f=""}this.code=(h?h.fName:"")+f;var j=0,i=0,w=null;while((j<f.length)||h){var u=[];if(h){w=h;h=undefined}else{while((j<f.length)&&!p(f[j])){j++}i=j;while((i<f.length)&&(o(f[i])||f[i]===".")){i++}if(f[i]=="$"){var q="";switch(f.substr(j,i-j)){case"LocalEntry":case"Entry":q="arg.$globals.entry";break;case"Entries":q="arg.$globals.entries";break}if(q){f=f.substr(0,j)+q+f.substr(i+1);j=j+q.length;continue}}w=l.FindBranch(f.substr(j,i-j),true);if(!w){j=i+1;continue}if(w.branch&&(w.rest!==undefined)){i-=w.rest.length;g=w.read_mode;w=w.branch}if((i>=f.length-1)&&(f[f.length-1]===".")){u.push("$self$");i=f.length}}while(i<f.length){if((f[i]==="@")&&(f.substr(i,5)=="@size")&&(u.length==0)){i+=5;g=true;break}if(f[i]==="."){var n=++i;if((f[n]==="@")&&(f.substr(n,5)==="@size")){u.push("$size$");i+=5;break}if(!p(f[n])){u.push("$self$");break}while((i<f.length)&&o(f[i])){i++}if(f[i]=="("){i=n-1;break}if((u.length===0)&&w){if((w.fType===c.BranchType.kClonesNode)||(w.fType===c.BranchType.kSTLNode)){u.push(undefined)}else{var m=c.IO.GetBranchObjectClass(w,l,false,true);if(m&&c.IsRootCollection(null,m)){u.push(undefined)}}}u.push(f.substr(n,i-n));continue}if(f[i]!=="["){break}if(f[i+1]=="]"){u.push(undefined);i+=2;continue}var n=i++,s=0;while((i<f.length)&&((f[i]!="]")||(s>0))){if(f[i]=="["){s++}else{if(f[i]=="]"){s--}}i++}var k=f.substr(n+1,i-n-1);switch(k){case"":case"$all$":u.push(undefined);break;case"$last$":u.push("$last$");break;case"$size$":u.push("$size$");break;case"$first$":u.push(0);break;default:if(!isNaN(parseInt(k))){u.push(parseInt(k))}else{var t=new d(this.globals);if(!t.Parse(l,r,k)){return false}u.push(t)}}i++}if(u.length===0){u=undefined}else{if((u.length===1)&&(u[0]===undefined)){u=true}}var x=r.indexOfBranch(w);if(x<0){x=r.AddBranch(w,undefined,g)}g=undefined;this.brindex.push(x);this.branches.push(r.nameOfBranch(x));this.brarray.push(u);if((j===0)&&(i===f.length)&&(this.branches.length===1)){this.direct_branch=true;return true}var v="arg.var"+(this.branches.length-1);f=f.substr(0,j)+v+f.substr(i);j=j+v.length}f=f.replace(/TMath::Exp\(/g,"Math.exp(").replace(/TMath::Abs\(/g,"Math.abs(").replace(/TMath::Prob\(/g,"arg.$math.Prob(").replace(/TMath::Gaus\(/g,"arg.$math.Gaus(");this.func=new Function("arg","return ("+f+")");return true};d.prototype.is_dummy=function(){return(this.branches.length===0)&&!this.func};d.prototype.Produce=function(m){this.length=1;this.isarray=false;if(this.is_dummy()){this.value=1;this.kind="number";return}var f={$globals:this.globals,$math:c.Math},h=-1,l=[];for(var o=0;o<this.branches.length;++o){var j="var"+o;f[j]=m[this.branches[o]];if(this.brarray[o]===undefined){this.brarray[o]=(c.CheckArrayPrototype(f[j])>0)||c.IsRootCollection(f[j])}if(this.brarray[o]===false){continue}if((this.brarray[o]===true)&&(c.CheckArrayPrototype(f[j],true)===2)){l[o]=f[j]}else{var g=new b(f[j],this.brarray[o],m);l[o]=[];while(g.next()){l[o].push(g.value)}}if((h<0)||(h<l[o].length)){h=l[o].length}}if(h<0){this.value=this.direct_branch?f.var0:this.func(f);if(!this.kind){this.kind=typeof this.value}return}if(h==0){this.length=0;this.value=0;return}this.length=h;this.isarray=true;if(this.direct_branch){this.value=l[0]}else{this.value=new Array(h);for(var i=0;i<h;++i){for(var o=0;o<this.branches.length;++o){if(l[o]){f["var"+o]=l[o][i]}}this.value[i]=this.func(f)}}if(!this.kind){this.kind=typeof this.value[0]}};d.prototype.get=function(f){return this.isarray?this.value[f]:this.value};d.prototype.AppendArray=function(f){this.buf=this.buf.concat(f[this.branches[0]])};function a(f){e.call(this);this.ndim=0;this.vars=[];this.cut=null;this.hist=null;this.histo_callback=f;this.histo_drawopt="";this.hist_name="$htemp";this.hist_title="Result of TTree::Draw";this.graph=false;this.hist_args=[];this.arr_limit=1000;this.htype="F";this.monitoring=0;this.globals={};this.last_progress=0;this.aver_diff=0}a.prototype=Object.create(e.prototype);a.prototype.ParseParameters=function(q,l,p){if(!p||(typeof p!=="string")){return""}var m=p.lastIndexOf(";");while(m>=0){var k=p.substr(m+1),h=undefined;p=p.substr(0,m);m=p.lastIndexOf(";");var g=k.indexOf(":");if(g>0){h=k.substr(g+1);k=k.substr(0,g)}var i=parseInt(h);if(!h||isNaN(i)){i=undefined}switch(k){case"num":case"entries":case"numentries":if(h==="all"){l.numentries=q.fEntries}else{if(h==="half"){l.numentries=Math.round(q.fEntries/2)}else{if(i!==undefined){l.numentries=i}}}break;case"first":if(i!==undefined){l.firstentry=i}break;case"mon":case"monitor":l.monitoring=(i!==undefined)?i:5000;break;case"player":l.player=true;break;case"dump":l.dump=true;break;case"maxseg":case"maxrange":if(i){q.$file.fMaxRanges=i}break;case"accum":if(i){this.arr_limit=i}break;case"htype":if(h&&(h.length===1)){this.htype=h.toUpperCase();if((this.htype!=="C")&&(this.htype!=="S")&&(this.htype!=="I")&&(this.htype!=="F")&&(this.htype!=="L")&&(this.htype!=="D")){this.htype="F"}}break;case"hbins":this.hist_nbins=parseInt(h);if(isNaN(this.hist_nbins)||(this.hist_nbins<=3)){delete this.hist_nbins}break;case"drawopt":l.drawopt=h;break;case"graph":l.graph=i||true;break}}m=p.lastIndexOf(">>");if(m>=0){var o=p.substr(m+2).trim();p=p.substr(0,m).trim();m=o.indexOf("(");if(m>0){this.hist_name=o.substr(0,m);o=o.substr(m)}if(o==="dump"){l.dump=true}else{if(o.indexOf("Graph")==0){l.graph=true}else{if(m<0){this.hist_name=o}else{if((o[0]=="(")&&(o[o.length-1]==")")){o=o.substr(1,o.length-2).split(",");var j=true;for(var f=0;f<o.length;++f){o[f]=(f%3===0)?parseInt(o[f]):parseFloat(o[f]);if(isNaN(o[f])){j=false}}if(j){this.hist_args=o}}}}}}if(l.dump){this.dump_values=true;l.reallocate_objects=true;if(l.numentries===undefined){l.numentries=10}}return p};a.prototype.ParseDrawExpression=function(q,i){var o=this.ParseParameters(q,i,i.expr),l="";this.hist_title="drawing '"+o+"' from "+q.fName;var k=0;if(i.cut){l=i.cut}else{k=o.replace(/TMath::/g,"TMath__").lastIndexOf("::");if(k>0){l=o.substr(k+2).trim();o=o.substr(0,k).trim()}}i.parse_expr=o;i.parse_cut=l;var j=[],p=0,m=0,g=0;for(k=0;k<o.length;++k){switch(o[k]){case"(":p++;break;case")":p--;break;case"[":m++;break;case"]":m--;break;case":":if(o[k+1]==":"){k++;continue}if(!p&&!m&&(k>g)){j.push(o.substr(g,k-g))}g=k+1;break}}if(!p&&!m&&(k>g)){j.push(o.substr(g,k-g))}if((j.length<1)||(j.length>3)){return false}this.ndim=j.length;var h=!l;for(var f=0;f<this.ndim;++f){this.vars[f]=new d(this.globals);if(!this.vars[f].Parse(q,this,j[f])){return false}if(!this.vars[f].direct_branch){h=false}}this.cut=new d(this.globals);if(l){if(!this.cut.Parse(q,this,l)){return false}}if(!this.branches.length){console.warn("no any branch is selected");return false}if(h){this.ProcessArrays=this.ProcessArraysFunc}this.monitoring=i.monitoring;this.graph=i.graph;if(i.drawopt!==undefined){this.histo_drawopt=i.drawopt}else{this.histo_drawopt=(this.ndim===2)?"col":""}return true};a.prototype.DrawOnlyBranch=function(f,h,i,g){this.ndim=1;if(i.indexOf("dump")==0){i=";"+i}i=this.ParseParameters(f,g,i);this.monitoring=g.monitoring;if(g.dump){this.dump_values=true;g.reallocate_objects=true}if(this.dump_values){this.hist=[];this.leaf=g.leaf;this.copy_fields=((g.branch.fLeaves&&(g.branch.fLeaves.arr.length>1))||(g.branch.fBranches&&(g.branch.fBranches.arr.length>0)))&&!g.leaf;this.AddBranch(h,"br0",g.direct_branch);this.Process=this.ProcessDump;return true}this.vars[0]=new d(this.globals);if(!this.vars[0].Parse(f,this,i,h,g.direct_branch)){return false}this.hist_title="drawing branch '"+h.fName+(i?"' expr:'"+i:"")+"'  from "+f.fName;this.cut=new d(this.globals);if(this.vars[0].direct_branch){this.ProcessArrays=this.ProcessArraysFunc}return true};a.prototype.Begin=function(f){this.globals.entries=f.fEntries;if(this.monitoring){this.lasttm=new Date().getTime()}};a.prototype.ShowProgress=function(j){if(typeof document=="undefined"||!c.progress){return}if((j===undefined)||isNaN(j)){return c.progress()}if(this.last_progress!==j){var k=j-this.last_progress;if(!this.aver_diff){this.aver_diff=k}this.aver_diff=k*0.3+this.aver_diff*0.7}var h=0;if(this.aver_diff<=0){h=0}else{if(this.aver_diff<0.0001){h=3}else{if(this.aver_diff<0.001){h=2}else{if(this.aver_diff<0.01){h=1}}}}var i=document.createElement("p"),g=document.createTextNode("TTree draw "+(j*100).toFixed(h)+" %  "),f=this;i.appendChild(g);i.title="Click on element to break drawing";i.onclick=function(){if(++f.break_execution<3){i.title="Tree draw will break after next I/O operation";return g.nodeValue="Breaking ... "}f.Abort();c.progress()};c.progress(i);this.last_progress=j};a.prototype.GetBitsBins=function(i,g){g.nbins=g.max=i;g.fLabels=c.Create("THashList");for(var f=0;f<i;++f){var h=c.Create("TObjString");h.fString=f.toString();h.fUniqueID=f+1;g.fLabels.Add(h)}return g};a.prototype.GetMinMaxBins=function(f,l){var p={min:0,max:0,nbins:l,k:1,fLabels:null,title:""};if(f>=this.ndim){return p}var o=this.vars[f].buf;p.title=this.vars[f].code||"";if(this.vars[f].kind==="object"){var m,i=true,j=8;for(var h=0;h<o.length;++h){if(!o[h]){continue}if(!m){m=o[h]._typename}if(m!==o[h]._typename){i=false}if(o[h].fNbits){j=Math.max(j,o[h].fNbits+1)}}if(m&&i){if((m==="TBits")&&(f===0)){this.Fill1DHistogram=this.FillTBitsHistogram;if(j%8){j=(j&65520)+8}if((this.hist_name==="bits")&&(this.hist_args.length==1)&&this.hist_args[0]){j=this.hist_args[0]}return this.GetBitsBins(j,p)}}}if(this.vars[f].kind==="string"){p.lbls=[];for(var h=0;h<o.length;++h){if(p.lbls.indexOf(o[h])<0){p.lbls.push(o[h])}}p.lbls.sort();p.max=p.nbins=p.lbls.length;p.fLabels=c.Create("THashList");for(var h=0;h<p.lbls.length;++h){var q=c.Create("TObjString");q.fString=p.lbls[h];q.fUniqueID=h+1;if(q.fString===""){q.fString="<empty>"}p.fLabels.Add(q)}}else{if((f===0)&&(this.hist_name==="bits")&&(this.hist_args.length<=1)){this.Fill1DHistogram=this.FillBitsHistogram;return this.GetBitsBins(this.hist_args[0]||32,p)}else{if(f*3+2<this.hist_args.length){p.nbins=this.hist_args[f*3];p.min=this.hist_args[f*3+1];p.max=this.hist_args[f*3+2]}else{p.min=Math.min.apply(null,o);p.max=Math.max.apply(null,o);if(this.hist_nbins){l=p.nbins=this.hist_nbins}p.isinteger=(Math.round(p.min)===p.min)&&(Math.round(p.max)===p.max);if(p.isinteger){for(var h=0;h<o.length;++h){if(o[h]!==Math.round(o[h])){p.isinteger=false;break}}}if(p.isinteger){p.min=Math.round(p.min);p.max=Math.round(p.max);if(p.max-p.min<l*5){p.min-=1;p.max+=2;p.nbins=Math.round(p.max-p.min)}else{var n=(p.max-p.min+2),g=Math.floor(n/l);while(g*l<n){g++}p.max=p.min+l*g}}else{if(p.min>=p.max){p.max=p.min;if(Math.abs(p.min)<100){p.min-=1;p.max+=1}else{if(p.min>0){p.min*=0.9;p.max*=1.1}else{p.min*=1.1;p.max*=0.9}}}else{p.max+=(p.max-p.min)/p.nbins}}}}}p.k=p.nbins/(p.max-p.min);p.GetBin=function(r){var k=this.lbls?this.lbls.indexOf(r):Math.floor((r-this.min)*this.k);return(k<0)?0:((k>this.nbins)?this.nbins+1:k+1)};return p};a.prototype.CreateHistogram=function(){if(this.hist||!this.vars[0].buf){return}if(this.dump_values){this.hist=[];this.Fill1DHistogram=this.Fill2DHistogram=this.Fill3DHistogram=this.DumpValue}else{if(this.graph){var k=this.vars[0].buf.length;if(this.ndim==1){this.hist=c.CreateTGraph(k,Array.from(Array(k).keys()),this.vars[0].buf)}else{if(this.ndim==2){this.hist=c.CreateTGraph(k,this.vars[0].buf,this.vars[1].buf);delete this.vars[1].buf}}this.hist.fTitle=this.hist_title;this.hist.fName="Graph"}else{this.x=this.GetMinMaxBins(0,(this.ndim>1)?50:200);this.y=this.GetMinMaxBins(1,50);this.z=this.GetMinMaxBins(2,50);switch(this.ndim){case 1:this.hist=c.CreateHistogram("TH1"+this.htype,this.x.nbins);break;case 2:this.hist=c.CreateHistogram("TH2"+this.htype,this.x.nbins,this.y.nbins);break;case 3:this.hist=c.CreateHistogram("TH3"+this.htype,this.x.nbins,this.y.nbins,this.z.nbins);break}this.hist.fXaxis.fTitle=this.x.title;this.hist.fXaxis.fXmin=this.x.min;this.hist.fXaxis.fXmax=this.x.max;this.hist.fXaxis.fLabels=this.x.fLabels;if(this.ndim>1){this.hist.fYaxis.fTitle=this.y.title}this.hist.fYaxis.fXmin=this.y.min;this.hist.fYaxis.fXmax=this.y.max;this.hist.fYaxis.fLabels=this.y.fLabels;if(this.ndim>2){this.hist.fZaxis.fTitle=this.z.title}this.hist.fZaxis.fXmin=this.z.min;this.hist.fZaxis.fXmax=this.z.max;this.hist.fZaxis.fLabels=this.z.fLabels;this.hist.fName=this.hist_name;this.hist.fTitle=this.hist_title;this.hist.$custom_stat=(this.hist_name=="$htemp")?111110:111111}}var j=this.vars[0].buf,h=this.cut.buf,f=j.length;if(!this.graph){switch(this.ndim){case 1:for(var l=0;l<f;++l){this.Fill1DHistogram(j[l],h?h[l]:1)}break;case 2:var i=this.vars[1].buf;for(var l=0;l<f;++l){this.Fill2DHistogram(j[l],i[l],h?h[l]:1)}delete this.vars[1].buf;break;case 3:var i=this.vars[1].buf,g=this.vars[2].buf;for(var l=0;l<f;++l){this.Fill2DHistogram(j[l],i[l],g[l],h?h[l]:1)}delete this.vars[1].buf;delete this.vars[2].buf;break}}delete this.vars[0].buf;delete this.cut.buf};a.prototype.FillTBitsHistogram=function(k,h){if(!h||!k||!k.fNbits||!k.fAllBits){return}var i=Math.min(k.fNbits+1,k.fNbytes*8);for(var j=0,g=1,f=0;j<i;++j){if(k.fAllBits[f]&&g){if(j<=this.x.nbins){this.hist.fArray[j+1]+=h}else{this.hist.fArray[this.x.nbins+1]+=h}}g*=2;if(g>=256){g=1;++f}}};a.prototype.FillBitsHistogram=function(i,g){if(!g){return}for(var h=0,f=1;h<this.x.nbins;++h){if(i&f){this.hist.fArray[h+1]+=g}f*=2}};a.prototype.Fill1DHistogram=function(h,g){var f=this.x.GetBin(h);this.hist.fArray[f]+=g;if(!this.x.lbls){this.hist.fTsumw+=g;this.hist.fTsumwx+=g*h;this.hist.fTsumwx2+=g*h*h}};a.prototype.Fill2DHistogram=function(j,i,h){var g=this.x.GetBin(j),f=this.y.GetBin(i);this.hist.fArray[g+(this.x.nbins+2)*f]+=h;if(!this.x.lbls&&!this.y.lbls){this.hist.fTsumw+=h;this.hist.fTsumwx+=h*j;this.hist.fTsumwy+=h*i;this.hist.fTsumwx2+=h*j*j;this.hist.fTsumwxy+=h*j*i;this.hist.fTsumwy2+=h*i*i}};a.prototype.Fill3DHistogram=function(l,k,j,i){var h=this.x.GetBin(l),g=this.y.GetBin(k),f=this.z.GetBin(j);this.hist.fArray[h+(this.x.nbins+2)*(g+(this.y.nbins+2)*f)]+=i;if(!this.x.lbls&&!this.y.lbls&&!this.z.lbls){this.hist.fTsumw+=i;this.hist.fTsumwx+=i*l;this.hist.fTsumwy+=i*k;this.hist.fTsumwz+=i*j;this.hist.fTsumwx2+=i*l*l;this.hist.fTsumwy2+=i*k*k;this.hist.fTsumwz2+=i*j*j;this.hist.fTsumwxy+=i*l*k;this.hist.fTsumwxz+=i*l*j;this.hist.fTsumwyz+=i*k*j}};a.prototype.DumpValue=function(j,i,h,f){var g;switch(this.ndim){case 1:g={x:j,weight:i};break;case 2:g={x:j,y:i,weight:h};break;case 3:g={x:j,y:i,z:h,weight:f};break}if(this.cut.is_dummy()){if(this.ndim===1){g=j}else{delete g.weight}}this.hist.push(g)};a.prototype.ProcessArraysFunc=function(o){if(this.arr_limit||this.graph){var l=this.vars[0],n=this.tgtarr.br0.length,i=this.vars[1],h=this.vars[2];if((l.buf.length===0)&&(n>=this.arr_limit)&&!this.graph){l.buf=this.tgtarr.br0;if(i){i.buf=this.tgtarr.br1}if(h){h.buf=this.tgtarr.br2}}else{for(var f=0;f<n;++f){l.buf.push(this.tgtarr.br0[f]);if(i){i.buf.push(this.tgtarr.br1[f])}if(h){h.buf.push(this.tgtarr.br2[f])}}}l.kind="number";if(i){i.kind="number"}if(h){h.kind="number"}this.cut.buf=null;if(!this.graph&&(l.buf.length>=this.arr_limit)){this.CreateHistogram();this.arr_limit=0}}else{var m=this.tgtarr.br0,n=m.length;switch(this.ndim){case 1:for(var f=0;f<n;++f){this.Fill1DHistogram(m[f],1)}break;case 2:var j=this.tgtarr.br1;for(var f=0;f<n;++f){this.Fill2DHistogram(m[f],j[f],1)}break;case 3:var j=this.tgtarr.br1,g=this.tgtarr.br2;for(var f=0;f<n;++f){this.Fill3DHistogram(m[f],j[f],g[f],1)}break}}};a.prototype.ProcessDump=function(g){var f=this.leaf?this.tgtobj.br0[this.leaf]:this.tgtobj.br0;if(f&&this.copy_fields){if(c.CheckArrayPrototype(f)===0){this.hist.push(c.extend({},f))}else{this.hist.push(f)}}else{this.hist.push(f)}};a.prototype.Process=function(p){this.globals.entry=p;this.cut.Produce(this.tgtobj);if(!this.dump_values&&!this.cut.value){return}for(var g=0;g<this.ndim;++g){this.vars[g].Produce(this.tgtobj)}var k=this.vars[0],i=this.vars[1],h=this.vars[2],o=this.cut;if(this.graph||this.arr_limit){switch(this.ndim){case 1:for(var m=0;m<k.length;++m){k.buf.push(k.get(m));o.buf.push(o.value)}break;case 2:for(var m=0;m<k.length;++m){for(var l=0;l<i.length;++l){k.buf.push(k.get(m));i.buf.push(i.get(l));o.buf.push(o.value)}}break;case 3:for(var m=0;m<k.length;++m){for(var l=0;l<i.length;++l){for(var j=0;j<h.length;++j){k.buf.push(k.get(m));i.buf.push(i.get(l));h.buf.push(h.get(j));o.buf.push(o.value)}}}break}if(!this.graph&&k.buf.length>=this.arr_limit){this.CreateHistogram();this.arr_limit=0}}else{if(this.hist){switch(this.ndim){case 1:for(var m=0;m<k.length;++m){this.Fill1DHistogram(k.get(m),o.value)}break;case 2:for(var m=0;m<k.length;++m){for(var l=0;l<i.length;++l){this.Fill2DHistogram(k.get(m),i.get(l),o.value)}}break;case 3:for(var m=0;m<k.length;++m){for(var l=0;l<i.length;++l){for(var j=0;j<h.length;++j){this.Fill3DHistogram(k.get(m),i.get(l),h.get(j),o.value)}}}break}}}if(this.monitoring&&this.hist&&!this.dump_values){var f=new Date().getTime();if(f-this.lasttm>this.monitoring){this.lasttm=f;c.CallBack(this.histo_callback,this.hist,this.histo_drawopt,true)}}};a.prototype.Terminate=function(f){if(f&&!this.hist){this.CreateHistogram()}this.ShowProgress();return c.CallBack(this.histo_callback,this.hist,this.dump_values?"inspect":this.histo_drawopt)};c.IO.FindBrachStreamerElement=function(j,i){if(!j||!i||(j._typename!=="TBranchElement")||(j.fID<0)||(j.fStreamerType<0)){return null}var m=i.FindStreamerInfo(j.fClassName,j.fClassVersion,j.fCheckSum),f=(m&&m.fElements)?m.fElements.arr:null;if(!f){return null}var h=j.fName,n=h.indexOf("[");if(n>0){h=h.substr(0,n)}n=h.lastIndexOf(".");if(n>0){h=h.substr(n+1)}function l(k){if(!k){return false}if(k.fName!==h){return false}if(k.fType===j.fStreamerType){return true}if((k.fType===c.IO.kBool)&&(j.fStreamerType===c.IO.kUChar)){return true}if(((j.fStreamerType===c.IO.kSTL)||(j.fStreamerType===c.IO.kSTL+c.IO.kOffsetL)||(j.fStreamerType===c.IO.kSTLp)||(j.fStreamerType===c.IO.kSTLp+c.IO.kOffsetL))&&(k.fType===c.IO.kStreamer)){return true}console.warn("Should match element",k.fType,"with branch",j.fStreamerType);return false}if(l(f[j.fID])){return f[j.fID]}for(var g=0;g<f.length;++g){if((g!==j.fID)&&l(f[g])){return f[g]}}console.error("Did not found/match element for branch",j.fName,"class",j.fClassName);return null};c.IO.DefineMemberTypeName=function(i,o,g){var l=i.FindStreamerInfo(o),m=(l&&l.fElements)?l.fElements.arr:null,h=null;if(!m){return""}for(var j=0;j<m.length;++j){if(m[j].fTypeName==="BASE"){var n=c.IO.DefineMemberTypeName(i,m[j].fName,g);if(n){return n}}else{if(m[j].fName===g){h=m[j];break}}}if(!h){return""}var f=h.fTypeName;if(f[f.length-1]==="*"){f=f.substr(0,f.length-1)}return f};c.IO.GetBranchObjectClass=function(i,f,h,j){if(!i||(i._typename!=="TBranchElement")){return""}if((i.fType===c.BranchType.kLeafNode)&&(i.fID===-2)&&(i.fStreamerType===-1)){return i.fClassName}if(h&&i.fClonesName&&((i.fType===c.BranchType.kClonesNode)||(i.fType===c.BranchType.kSTLNode))){return i.fClonesName}var g=c.IO.FindBrachStreamerElement(i,f.$file);if((i.fType===c.BranchType.kBaseClassNode)&&g&&(g.fTypeName==="BASE")){return g.fName}if(i.fType===c.BranchType.kObjectNode){if(g&&((g.fType===c.IO.kObject)||(g.fType===c.IO.kAny))){return g.fTypeName}return"TObject"}if((i.fType===c.BranchType.kLeafNode)&&g&&j){if((g.fType===c.IO.kObject)||(g.fType===c.IO.kAny)){return g.fTypeName}if(g.fType===c.IO.kObjectp){return g.fTypeName.substr(0,g.fTypeName.length-1)}}return""};c.IO.MakeMethodsList=function(i){var f=c.getMethods(i);var h={names:[],values:[],Create:function(){var j={};for(var k=0;k<this.names.length;++k){j[this.names[k]]=this.values[k]}return j}};h.names.push("_typename");h.values.push(i);for(var g in f){h.names.push(g);h.values.push(f[g])}return h};c.IO.DetectBranchMemberClass=function(g,i,j){var f="";for(var h=(j||0);h<g.arr.length;++h){if((g.arr[h].fName.indexOf(i)===0)&&g.arr[h].fClassName){f=g.arr[h].fClassName}}return f};c.TreeMethods={};c.TreeMethods.Process=function(u,l){if(!l){l={}}if(!u||!this.$file||!u.branches){console.error("required parameter missing for TTree::Process");if(u){u.Terminate(false)}return false}var A={tree:this,file:this.$file,selector:u,arr:[],curr:-1,current_entry:-1,simple_read:true,process_arrays:true};var p=0;function q(h,k){var n=0;switch(h._typename){case"TLeafF":n=c.IO.kFloat;break;case"TLeafD":n=c.IO.kDouble;break;case"TLeafO":n=c.IO.kBool;break;case"TLeafB":n=h.fIsUnsigned?c.IO.kUChar:c.IO.kChar;break;case"TLeafS":n=h.fIsUnsigned?c.IO.kUShort:c.IO.kShort;break;case"TLeafI":n=h.fIsUnsigned?c.IO.kUInt:c.IO.kInt;break;case"TLeafL":n=h.fIsUnsigned?c.IO.kULong64:c.IO.kLong64;break;case"TLeafC":n=c.IO.kTString;break;default:return null}return c.IO.CreateStreamerElement(k||h.fName,n)}function m(n){for(var h=0;h<A.arr.length;++h){if(A.arr[h].branch===n){return A.arr[h]}}return null}function x(C,N,ae,Z){if(typeof C==="string"){C=A.tree.FindBranch(C)}if(!C){console.error("Did not found branch");return null}var X=m(C);if(X){console.error("Branch already configured for reading",C.fName);if(X.tgt!==N){console.error("Target object differs")}return W}if(!C.fEntries){console.warn("Branch ",C.fName," does not have entries");return null}X={branch:C,tgt:N,name:ae,index:-1,member:null,type:0,curr_entry:-1,raw:null,basket:null,curr_basket:0,read_entry:-1,staged_entry:-1,first_readentry:-1,staged_basket:0,numentries:C.fEntries,numbaskets:C.fWriteBasket,counters:null,ascounter:[],baskets:[],staged_prev:0,staged_now:0,progress_showtm:0,GetBasketEntry:function(af){if(!this.branch||(af>this.branch.fMaxBaskets)){return 0}var ah=(af<this.branch.fMaxBaskets)?this.branch.fBasketEntry[af]:0;if(ah){return ah}var ag=(af>0)?this.branch.fBaskets.arr[af-1]:null;return ag?(this.branch.fBasketEntry[af-1]+ag.fNevBuf):0},GetTarget:function(ah){if(!this.tgt){return ah}for(var af=0;af<this.tgt.length;++af){var ag=this.tgt[af];if(!ah[ag.name]){ah[ag.name]=ag.lst.Create()}ah=ah[ag.name]}return ah},GetEntry:function(af){var k=af-this.first_entry,ag;if(!this.branch.TestBit(c.IO.BranchBits.kDoNotUseBufferMap)){this.raw.ClearObjectMap()}if(this.basket.fEntryOffset){ag=this.basket.fEntryOffset[k];if(this.basket.fDisplacement){this.raw.fDisplacement=this.basket.fDisplacement[k]}}else{ag=this.basket.fKeylen+this.basket.fNevBufSize*k}this.raw.locate(ag-this.raw.raw_shift)}};while(X.GetBasketEntry(X.numbaskets+1)){X.numbaskets++}var Y=C.fBranches?C.fBranches.arr.length:0,ab=C.fLeaves?C.fLeaves.arr.length:0,U=(ab>0)?C.fLeaves.arr[0]:null,W=null,D=null,ac=(C._typename==="TBranchElement"),K=0,L=null,J=null,M="";if(C.fBranchCount){L=m(C.fBranchCount);if(!L){L=x(C.fBranchCount,N,"$counter"+p++,true)}if(!L){console.error("Cannot add counter branch",C.fBranchCount.fName);return null}var aa=C.fBranchCount2;if(!aa&&(C.fBranchCount.fStreamerType===c.IO.kSTL)&&((C.fStreamerType===c.IO.kStreamLoop)||(C.fStreamerType===c.IO.kOffsetL+c.IO.kStreamLoop))){var H=c.IO.FindBrachStreamerElement(C,A.file),G=C.fBranchCount.fBranches.arr;if(H&&H.fCountName&&G){for(var S=0;S<G.length;++S){if(G[S].fName===C.fBranchCount.fName+"."+H.fCountName){aa=G[S];break}}}if(!aa){console.error("Did not found branch for second counter of kStreamLoop element")}}if(aa){J=m(aa);if(!J){J=x(aa,N,"$counter"+p++,true)}if(!J){console.error("Cannot add counter branch2",aa.fName);return null}}}else{if(ab===1&&U&&U.fLeafCount){var F=A.tree.FindBranch(U.fLeafCount.fName);if(F){L=m(F);if(!L){L=x(F,N,"$counter"+p++,true)}if(!L){console.error("Cannot add counter branch",F.fName);return null}}}}function n(al,af,am){if(!al||!al.arr.length){return true}var ap=C.fName;if(ap[ap.length-1]==="."){ap=ap.substr(0,ap.length-1)}if((typeof Z==="string")&&(Z[0]==".")){ap+=Z}ap+=".";for(var aj=0;aj<al.arr.length;++aj){var ao=al.arr[aj];if((am>0)&&(ao.fType!==am)){continue}if(ao.fType===c.BranchType.kBaseClassNode){if(!n(ao.fBranches,af,am)){return false}continue}var ai=c.IO.FindBrachStreamerElement(ao,A.file);if(ai&&(ai.fTypeName==="BASE")){if(ao.fTotBytes&&!x(ao,N,ae,Z)){return false}if(!n(ao.fBranches,af,am)){return false}continue}var an=ao.fName,ak=1;if(ao.fName.indexOf(ap)===0){an=an.substr(ap.length)}else{if(am>0){continue}}var ag=an.indexOf("[");if(ag>0){an=an.substr(0,ag)}ag=an.indexOf("<");if(ag>0){an=an.substr(0,ag)}if(am>0){ak="$child$";var ah=an.indexOf(".");if(ah>0){ak=c.IO.DetectBranchMemberClass(al,C.fName+"."+an.substr(0,ah+1),aj)||"TObject"}}if(!x(ao,af,an,ak)){return false}}return true}if(C._typename==="TBranchObject"){D={name:ae,typename:C.fClassName,virtual:U.fVirtual,func:function(k,ag){var af=this.typename;if(this.virtual){af=k.ReadFastString(k.ntou1()+1)}ag[this.name]=k.ClassStreamer({},af)}}}else{if((C.fType===c.BranchType.kClonesNode)||(C.fType===c.BranchType.kSTLNode)){W=c.IO.CreateStreamerElement(ae,c.IO.kInt);if(!Z||((typeof Z==="string")&&(Z[0]==="."))||(Z===1)){A.process_arrays=false;D={name:ae,conttype:C.fClonesName||"TObject",reallocate:l.reallocate_objects,func:function(k,ag){var af=k.ntoi4(),ah=0;if(!ag[this.name]||this.reallocate){ag[this.name]=new Array(af)}else{ah=ag[this.name].length;ag[this.name].length=af}while(ah<af){ag[this.name][ah++]=this.methods.Create()}}};if((typeof Z==="string")&&(Z[0]===".")){D.conttype=c.IO.DetectBranchMemberClass(C.fBranches,C.fName+Z);if(!D.conttype){console.error("Cannot select object",Z,"in the branch",C.fName);return null}}D.methods=c.IO.MakeMethodsList(D.conttype);K=(C.fType===c.BranchType.kClonesNode)?c.BranchType.kClonesMemberNode:c.BranchType.kSTLMemberNode}}else{if((M=c.IO.GetBranchObjectClass(C,A.tree))){if(Z===true){console.warn("Object branch "+M+" can not have data to be read directly");return null}A.process_arrays=false;var I=new Array(N?(N.length+1):1);for(var Q=0;Q<I.length-1;++Q){I[Q]=N[Q]}I[I.length-1]={name:ae,lst:c.IO.MakeMethodsList(M)};if(!n(C.fBranches,I,0)){return null}return X}else{if(ac&&(ab===1)&&(U.fName===C.fName)&&(C.fID==-1)){W=c.IO.CreateStreamerElement(ae,C.fClassName);if(W.fType===c.IO.kAny){var ad=A.file.GetStreamer(C.fClassName,{val:C.fClassVersion,checksum:C.fCheckSum});if(!ad){W=null;console.warn("not found streamer!")}else{D={name:ae,typename:C.fClassName,streamer:ad,func:function(k,ag){var af={_typename:this.typename};for(var ah=0;ah<this.streamer.length;++ah){this.streamer[ah].func(k,af)}ag[this.name]=af}}}}}else{if(ac&&(ab<=1)){W=c.IO.FindBrachStreamerElement(C,A.file);if(!W&&C.fStreamerType&&(C.fStreamerType<20)){W=c.IO.CreateStreamerElement(ae,C.fStreamerType)}}else{if(ab===1){W=q(U,ae)}else{if((C._typename==="TBranch")&&(ab>1)){var h=new Array(ab),T=true;for(var Q=0;Q<ab;++Q){h[Q]=q(C.fLeaves.arr[Q]);h[Q]=c.IO.CreateMember(h[Q],A.file);if(!h[Q]){T=false}}if(T){D={name:ae,leaves:h,func:function(af,ag){var ah=ag[this.name],k=0;if(!ah){ag[this.name]=ah={}}while(k<this.leaves.length){this.leaves[k++].func(af,ah)}}}}}}}}}}}if(!W&&!D){console.warn("Not supported branch kind",C.fName,C._typename);return null}if(!D){D=c.IO.CreateMember(W,A.file);if((D.base!==undefined)&&D.basename){D.func=function(k,af){if(!af[this.name]){af[this.name]={_typename:this.basename}}k.ClassStreamer(af[this.name],this.basename)}}}if(L&&(typeof Z==="string")){D.name0=L.name;var P=ae.split(".");if(P.length===1){D.get=function(k,af){return k[af]}}else{if(Z==="$child$"){console.error("target name contains point, but suppose to be direct child",ae);return null}else{if(P.length===2){ae=D.name=P[1];D.name1=P[0];D.subtype1=Z;D.methods1=c.IO.MakeMethodsList(D.subtype1);D.get=function(k,ag){var af=k[ag][this.name1];if(!af){af=k[ag][this.name1]=this.methods1.Create()}return af}}else{if(!C.fParentName){console.error("Not possible to provide more than 2 parts in the target name",ae);return null}ae=D.name=P.pop();D.snames=P;D.smethods=[];var R=C.fParentName;for(var S=0;S<P.length;++S){var E=c.IO.DefineMemberTypeName(A.file,R,P[S]);D.smethods[S]=c.IO.MakeMethodsList(E||"AbstractClass");R=E}D.get=function(af,aj){var ai=af[aj][this.snames[0]];if(!ai){ai=af[aj][this.snames[0]]=this.smethods[0].Create()}for(var ag=1;ag<this.snames.length;++ag){var ah=ai[this.snames[ag]];if(!ah){ah=ai[this.snames[ag]]=this.smethods[ag].Create()}ai=ah}return ai}}}}if(D.objs_branch_func){D.func=D.objs_branch_func}else{D.func0=D.func;D.func=function(af,ag){var k=ag[this.name0],ah=0;while(ah<k.length){this.func0(af,this.get(k,ah++))}}}}else{if(L){A.process_arrays=false;if((W.fType===c.IO.kDouble32)||(W.fType===c.IO.kFloat16)){D.stl_size=L.name;D.func=function(k,af){af[this.name]=this.readarr(k,af[this.stl_size])}}else{if(((W.fType===c.IO.kOffsetP+c.IO.kDouble32)||(W.fType===c.IO.kOffsetP+c.IO.kFloat16))&&C.fBranchCount2){D.stl_size=L.name;D.arr_size=J.name;D.func=function(af,ag){var aj=ag[this.stl_size],ah=ag[this.arr_size],k=new Array(aj);for(var ai=0;ai<aj;++ai){k[ai]=(af.ntou1()===1)?this.readarr(af,ah[ai]):[]}ag[this.name]=k}}else{if(((W.fType>0)&&(W.fType<c.IO.kOffsetL))||(W.fType===c.IO.kTString)||(((W.fType>c.IO.kOffsetP)&&(W.fType<c.IO.kOffsetP+c.IO.kOffsetL))&&C.fBranchCount2)){D={name:ae,stl_size:L.name,type:W.fType,func:function(k,af){af[this.name]=k.ReadFastArray(af[this.stl_size],this.type)}};if(C.fBranchCount2){D.type-=c.IO.kOffsetP;D.arr_size=J.name;D.func=function(af,ag){var aj=ag[this.stl_size],ah=ag[this.arr_size],k=new Array(aj);for(var ai=0;ai<aj;++ai){k[ai]=(af.ntou1()===1)?af.ReadFastArray(ah[ai],this.type):[]}ag[this.name]=k}}}else{if((W.fType>c.IO.kOffsetP)&&(W.fType<c.IO.kOffsetP+c.IO.kOffsetL)&&D.cntname){D.cntname=L.name}else{if(W.fType==c.IO.kStreamer){if(J){throw new Error("Second branch counter not supported yet with JSROOT.IO.kStreamer")}D.func=D.branch_func;D.stl_size=L.name}else{if((W.fType===c.IO.kStreamLoop)||(W.fType===c.IO.kOffsetL+c.IO.kStreamLoop)){if(J){D.stl_size=L.name;D.cntname=J.name;D.func=D.branch_func}else{D.cntname=L.name}}else{D.name="$stl_member";var O;if(J){if(D.cntname){O=J.name;D.cntname="$loop_size"}else{throw new Error("Second branch counter not used - very BAD")}}var V={name:ae,stl_size:L.name,loop_size:O,member0:D,func:function(af,ah){var ag=ah[this.stl_size],k=new Array(ag),ai=0;for(var ai=0;ai<ag;++ai){if(this.loop_size){ah.$loop_size=ah[this.loop_size][ai]}this.member0.func(af,ah);k[ai]=ah.$stl_member}delete ah.$stl_member;delete ah.$loop_size;ah[this.name]=k}};D=V}}}}}}}}D.name=ae;X.member=D;if(W){X.type=W.fType}X.index=A.arr.length;if(L){X.counters=[L.index];L.ascounter.push(X.index);if(J){X.counters.push(J.index);J.ascounter.push(X.index)}}A.arr.push(X);if(K){if(!n(C.fBranches,N,K)){return null}}return X}for(var j=0;j<u.branches.length;++j){var z=x(u.branches[j],undefined,u.names[j],u.directs[j]);if(!z){u.Terminate(false);return false}}for(var w=1;(w<A.arr.length)&&A.simple_read;++w){var z=A.arr[w],g=A.arr[0];if((z.numentries!==g.numentries)||(z.numbaskets!==g.numbaskets)){A.simple_read=false}for(var s=0;s<z.numbaskets;++s){if(z.GetBasketEntry(s)!==g.GetBasketEntry(s)){A.simple_read=false}}}A.firstentry=A.lastentry=0;for(var j=0;j<A.arr.length;++j){var i=A.arr[j].branch,r=i.fFirstEntry;if(r===undefined){r=(i.fBasketBytes[0]?i.fBasketEntry[0]:0)}A.firstentry=Math.max(A.firstentry,r);A.lastentry=(j===0)?(r+i.fEntries):Math.min(A.lastentry,r+i.fEntries)}if(A.firstentry>=A.lastentry){console.warn("No any common events for selected branches");u.Terminate(false);return false}A.process_min=A.firstentry;A.process_max=A.lastentry;if(!isNaN(l.firstentry)&&(l.firstentry>A.firstentry)&&(l.firstentry<A.lastentry)){A.process_min=l.firstentry}A.current_entry=A.staged_now=A.process_min;if(!isNaN(l.numentries)&&(l.numentries>0)){var v=A.process_min+l.numentries;if(v<A.process_max){A.process_max=v}}if((typeof u.ProcessArrays==="function")&&A.simple_read){for(var t=0;t<A.arr.length;++t){var y=A.arr[t];if((y.type<=0)||(y.type>=c.IO.kOffsetL)||(y.type===c.IO.kCharStar)){A.process_arrays=false}}if(A.process_arrays){u.tgtarr={};for(var j=0;j<A.arr.length;++j){var z=A.arr[j],y=c.IO.CreateStreamerElement(z.name,z.type);y.fType=z.type+c.IO.kOffsetL;y.fArrayLength=10;y.fArrayDim=1;y.fMaxIndex[0]=10;z.arrmember=c.IO.CreateMember(y,A.file)}}}else{A.process_arrays=false}function o(D,h){var C=[],k="";function n(){C=[];k="";for(var H=0;H<D.length;++H){if(D[H].done){continue}var G=D[H].branch;if(C.length===0){k=G.fFileName}else{if(k!==G.fFileName){continue}}D[H].selected=true;C.push(G.fBasketSeek[D[H].basket],G.fBasketBytes[D[H].basket])}return C.length>0}function E(I){if((A.staged_prev===A.staged_now)||(A.process_max<=A.process_min)){return}var G=new Date().getTime();if(G-A.progress_showtm<500){return}A.progress_showtm=G;var H=(A.staged_prev+I*(A.staged_now-A.staged_prev))/(A.process_max-A.process_min);A.selector.ShowProgress(H)}function F(N){if(!N||((C.length>2)&&(N.length*2!==C.length))){return c.CallBack(h,null)}var L=[],M=0;for(var H=0;H<D.length;++H){if(!D[H].selected){continue}D[H].selected=false;D[H].done=true;var G=(C.length>2)?N[M++]:N,I=c.CreateTBuffer(G,0,A.file),J=I.ClassStreamer({},"TBasket");if(J.fNbytes!==D[H].branch.fBasketBytes[D[H].basket]){console.error("mismatch in read basket sizes",D[H].branch.fBasketBytes[D[H].basket])}D[H].bskt_obj=J;if(J.fKeylen+J.fObjlen===J.fNbytes){I.raw_shift=0}else{var K=c.R__unzip(G,J.fObjlen,false,I.o);if(K){I=c.CreateTBuffer(K,0,A.file);I.raw_shift=J.fKeylen;I.fTagOffset=J.fKeylen}else{throw new Error("FAIL TO UNPACK")}}D[H].raw=I;if(D[H].branch.fEntryOffsetLen>0){I.ReadBasketEntryOffset(J,I.raw_shift)}}if(n()){A.file.ReadBuffer(C,F,k,E)}else{c.CallBack(h,D)}}if(n()){A.file.ReadBuffer(C,F,k,E)}else{c.CallBack(h,null)}}function f(){var L=0,J=[],G=true,I=false,K=A.process_max;while((L<1000000)&&G){G=false;for(var C=A.arr.length-1;C>=0;--C){var D=A.arr[C];while(D.staged_basket<D.numbaskets){var E=D.staged_basket++;if(D.GetBasketEntry(E)>=A.process_max){break}if(D.first_readentry<0){var H=D.GetBasketEntry(E+1),M=(H<=A.process_min);if(M){continue}D.curr_basket=E;D.first_readentry=D.GetBasketEntry(E)}var F={id:C,branch:D.branch,basket:E,raw:null};var h=D.branch.fBaskets.arr[E];if(h){F.raw=h.fBufferRef;if(F.raw){F.raw.locate(0)}else{F.raw=c.CreateTBuffer(null,0,A.file)}F.raw.raw_shift=h.fKeylen;if(h.fBufferRef&&(D.branch.fEntryOffsetLen>0)){F.raw.ReadBasketEntryOffset(h,F.raw.raw_shift)}F.bskt_obj=h;I=true;D.baskets[E]=F}else{J.push(F);L+=D.branch.fBasketBytes[E];G=true}D.staged_entry=D.GetBasketEntry(E+1);K=Math.min(K,D.staged_entry);break}}}if((L===0)&&!I){return A.selector.Terminate(true)}A.staged_prev=A.staged_now;A.staged_now=K;var N=0;if(A.process_max>A.process_min){N=(A.staged_prev-A.process_min)/(A.process_max-A.process_min)}A.selector.ShowProgress(N);A.progress_showtm=new Date().getTime();if(L>0){return o(J,B)}if(I){return B([])}throw new Error("No any data is requested - never come here")}function B(E){if((A.selector.break_execution!==0)||(E===null)){return A.selector.Terminate(false)}for(var G=0;G<E.length;++G){A.arr[E[G].id].baskets[E[G].basket]=E[G]}var D=false;while(true){var C=100000000,k=A.process_max,G,F;for(G=0;G<A.arr.length;++G){F=A.arr[G];if(!F.raw||!F.basket||(F.first_entry+F.basket.fNevBuf<=A.current_entry)){delete F.raw;delete F.basket;if((F.curr_basket>=F.numbaskets)){if(G==0){return A.selector.Terminate(true)}continue}var h=F.baskets[F.curr_basket];if(!h){if(!D){console.warn("no data?",F.branch.fName,F.curr_basket);return A.selector.Terminate(false)}return f()}F.raw=h.raw;F.basket=h.bskt_obj;F.first_entry=F.GetBasketEntry(h.basket);h.raw=null;h.branch=null;h.bskt_obj=null;F.baskets[F.curr_basket++]=undefined}C=Math.min(C,F.first_entry+F.basket.fNevBuf-A.current_entry)}if(A.current_entry+C>A.process_max){C=A.process_max-A.current_entry}if(A.process_arrays&&(C>1)){for(G=0;G<A.arr.length;++G){F=A.arr[G];F.GetEntry(A.current_entry);F.arrmember.arrlength=C;F.arrmember.func(F.raw,A.selector.tgtarr);F.raw=null}A.selector.ProcessArrays(A.current_entry);A.current_entry+=C;D=true}else{while(C--){for(G=0;G<A.arr.length;++G){F=A.arr[G];F.GetEntry(A.current_entry);F.member.func(F.raw,F.GetTarget(A.selector.tgtobj))}A.selector.Process(A.current_entry);A.current_entry++;D=true}}if(A.current_entry>=A.process_max){return A.selector.Terminate(true)}}}A.selector.Begin(this);f();return true};c.TreeMethods.FindBranch=function(h,j,l){var g=false,r=h,m=null;if(l===undefined){g=true;l=this.fBranches;var o=r.indexOf("[");if(o>0){r=r.substr(0,o)}}if(!l||(l.arr.length===0)){return null}for(var i=0;i<l.arr.length;++i){var k=l.arr[i].fName;if(k[k.length-1]=="]"){k=k.substr(0,k.indexOf("["))}if((r.indexOf(k)!==0)&&(k.indexOf("<")>0)){var q=k.indexOf("<"),p=k.lastIndexOf(">");k=k.substr(0,q)+k.substr(p+1)}if(k===r){m={branch:l.arr[i],rest:""};break}if(r.indexOf(k)!==0){continue}var f=k.length;if(k[f-1]==="."){f--}if(r[f]!=="."){continue}m=this.FindBranch(r,j,l.arr[i].fBranches);if(!m){m=this.FindBranch(r.substr(f+1),j,l.arr[i].fBranches)}if(!m){m={branch:l.arr[i],rest:r.substr(f)}}break}if(!g||!m){return m}if(h.length>r.length){m.rest+=h.substr(r.length)}if(!j&&(m.rest.length>0)){return null}return j?m:m.branch};c.TreeMethods.Draw=function(g,h){if(typeof g==="string"){g={expr:g}}if(!g.expr){g.expr=""}if(g.expr==="testio"){return this.IOTest(g,h)}var f=new a(h);if(g.branch){if(!f.DrawOnlyBranch(this,g.branch,g.expr,g)){f=null}}else{if(!f.ParseDrawExpression(this,g)){f=null}}if(!f){return c.CallBack(h,null)}return this.Process(f,g)};c.TreeMethods.IOTest=function(h,k){if(!h.names&&!h.bracnhes){h.branches=[];h.names=[];h.nchilds=[];h.nbr=0;function j(r,l){if(!r||!r.fBranches){return 0}var p=0;for(var t=0;t<r.fBranches.arr.length;++t){var o=r.fBranches.arr[t],m=(l?l+"/":"")+o.fName;h.branches.push(o);h.names.push(m);h.nchilds.push(0);var s=h.nchilds.length-1;p+=o.fLeaves?o.fLeaves.arr.length:0;var q=j(o,m);p+=q;h.nchilds[s]=q}return p}var g=j(this);h.names.push("Total are "+h.branches.length+" branches with "+g+" leaves")}h.lasttm=new Date().getTime();h.lastnbr=h.nbr;var f=this;function i(){var l=new e;l.AddBranch(h.branches[h.nbr],"br0");l.Process=function(){if(this.tgtobj.br0===undefined){this.fail=true}};l.Terminate=function(u){if(typeof u!=="string"){u=(!u||this.fails)?"FAIL":"ok"}h.names[h.nbr]=u+" "+h.names[h.nbr];h.nbr++;if(h.nbr>=h.branches.length){c.progress();return c.CallBack(k,h.names,"inspect")}var t=new Date().getTime();if((t-h.lasttm>5000)||(h.nbr-h.lastnbr>50)){setTimeout(f.IOTest.bind(f,h,k),100)}else{i()}};c.progress("br "+h.nbr+"/"+h.branches.length+" "+h.names[h.nbr]);var q=h.branches[h.nbr],p=c.IO.GetBranchObjectClass(q,f),n=q.fEntries,m=(!q.fLeaves||(q.fLeaves.arr.length===0));if(p){m=(h.nchilds[h.nbr]>100)}if(m||(n<=0)){l.Terminate("ignore")}else{var o={numentries:10},s=q.fFirstEntry||0,r=q.fEntryNumber||(s+n);if(n<o.numentries){o.numentries=n}else{o.firstentry=s+Math.round((r-s-o.numentries)*Math.random())}console.log("test branch",q.fName,"first",(o.firstentry||0),"num",o.numentries);f.Process(l,o)}}i()};c.TSelector=e;c.TDrawVariable=d;c.TDrawSelector=a;return c}));