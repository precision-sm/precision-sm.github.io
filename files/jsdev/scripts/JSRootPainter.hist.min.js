(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.hist.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.hist.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.hist.js")}a(JSROOT,d3)}}}(function(g,o){g.sources.push("hist");g.ToolbarIcons.th2color={recs:[{x:0,y:256,w:13,h:39,f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]};g.ToolbarIcons.th2colorz={recs:[{x:128,y:486,w:256,h:26,f:"rgb(38,62,168)"},{y:461,f:"rgb(22,82,205)"},{y:435,f:"rgb(16,100,220)"},{y:410,f:"rgb(18,114,217)"},{y:384,f:"rgb(20,129,214)"},{y:358,f:"rgb(14,143,209)"},{y:333,f:"rgb(9,157,204)"},{y:307,f:"rgb(13,167,195)"},{y:282,f:"rgb(30,175,179)"},{y:256,f:"rgb(46,183,164)"},{y:230,f:"rgb(82,186,146)"},{y:205,f:"rgb(116,189,129)"},{y:179,f:"rgb(149,190,113)"},{y:154,f:"rgb(179,189,101)"},{y:128,f:"rgb(209,187,89)"},{y:102,f:"rgb(226,192,75)"},{y:77,f:"rgb(244,198,59)"},{y:51,f:"rgb(253,210,43)"},{y:26,f:"rgb(251,230,29)"},{y:0,f:"rgb(249,249,15)"}]};g.ToolbarIcons.th2draw3d={path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"};g.Painter.CreateDefaultPalette=function(){function x(E,D,H){var z,F,G;if(H<1e-100){z=F=G=D}else{function C(K,J,I){if(I<0){I+=1}if(I>1){I-=1}if(I<1/6){return K+(J-K)*6*I}if(I<1/2){return J}if(I<2/3){return K+(J-K)*(2/3-I)*6}return K}var A=(D<0.5)?D*(1+H):D+H-D*H,B=2*D-A;z=C(B,A,E+1/3);F=C(B,A,E);G=C(B,A,E-1/3)}return"rgb("+Math.round(z*255)+","+Math.round(F*255)+","+Math.round(G*255)+")"}var q=[],t=1,y=0.5,r=280,p=0,w=50;for(var s=0;s<w;++s){var u=(r-(s+1)*((r-p)/w))/360,v=x(u,y,t);q.push(v)}return new g.ColorPalette(q)};g.Painter.CreateGrayPalette=function(){var p=[];for(var q=0;q<50;++q){var r=Math.round((q+2)/60*255);p.push("rgb("+r+","+r+","+r+")")}return new g.ColorPalette(p)};g.Painter.CreateGradientColorTable=function(z,v,p,q,x,u){var t=[];for(var w=1;w<z.length;w++){var s=parseInt(Math.floor(x*z[w])-Math.floor(x*z[w-1]));for(var y=0;y<s;y++){var r=Math.round(v[w-1]+y*(v[w]-v[w-1])/s)+","+Math.round(p[w-1]+y*(p[w]-p[w-1])/s)+","+Math.round(q[w-1]+y*(q[w]-q[w-1])/s);t.push("rgb("+r+")")}}return new g.ColorPalette(t)};g.Painter.GetColorPalette=function(q,u){q=q||g.gStyle.Palette;if((q>0)&&(q<10)){return g.Painter.CreateGrayPalette()}if(q<51){return g.Painter.CreateDefaultPalette()}if(q>113){q=57}var t,s,p,r=[0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,1];switch(q){case 51:t=[0,9,13,17,24,32,27,25,29];s=[0,0,0,2,37,74,113,160,221];p=[28,42,59,78,98,129,154,184,221];break;case 52:t=[0,32,64,96,128,160,192,224,255];s=[0,32,64,96,128,160,192,224,255];p=[0,32,64,96,128,160,192,224,255];break;case 53:t=[0,45,99,156,212,230,237,234,242];s=[0,0,0,45,101,168,238,238,243];p=[0,1,1,3,9,8,11,95,230];break;case 54:t=[0,22,44,68,93,124,160,192,237];s=[0,16,41,67,93,125,162,194,241];p=[97,100,99,99,93,68,44,26,74];break;case 55:t=[0,5,15,35,102,196,208,199,110];s=[0,48,124,192,206,226,97,16,0];p=[99,142,198,201,90,22,13,8,2];break;case 56:t=[242,234,237,230,212,156,99,45,0];s=[243,238,238,168,101,45,0,0,0];p=[230,95,11,8,9,3,1,1,0];break;case 57:t=[0.2082*255,0.0592*255,0.078*255,0.0232*255,0.1802*255,0.5301*255,0.8186*255,0.9956*255,0.9764*255];s=[0.1664*255,0.3599*255,0.5041*255,0.6419*255,0.7178*255,0.7492*255,0.7328*255,0.7862*255,0.9832*255];p=[0.5293*255,0.8684*255,0.8385*255,0.7914*255,0.6425*255,0.4662*255,0.3499*255,0.1968*255,0.0539*255];break;case 58:t=[0,0.0956*255,0.0098*255,0.2124*255,0.6905*255,0.9242*255,0.7914*255,0.7596*255,1*255];s=[0,0.1147*255,0.3616*255,0.5041*255,0.4577*255,0.4691*255,0.6905*255,0.9237*255,1*255];p=[0,0.2669*255,0.3121*255,0.1318*255,0.2236*255,0.6741*255,0.9882*255,0.9593*255,1*255];break;case 59:t=[13,23,25,63,76,104,137,161,206];s=[95,67,37,21,0,12,35,52,79];p=[4,3,2,6,11,22,49,98,208];break;case 60:t=[0,61,89,122,143,160,185,204,231];s=[0,0,0,0,14,37,72,132,235];p=[0,140,224,144,4,5,6,9,13];break;case 61:t=[14,7,2,0,5,11,55,131,229];s=[105,56,26,1,42,74,131,171,229];p=[2,21,35,60,92,113,160,185,229];break;case 62:t=[0,0,0,70,148,231,235,237,244];s=[0,0,0,0,0,69,67,216,244];p=[0,102,228,231,177,124,137,20,244];break;case 63:t=[50,56,63,68,93,121,165,192,241];s=[66,81,91,96,111,128,155,189,241];p=[97,91,75,65,77,103,143,167,217];break;case 64:t=[145,166,167,156,131,114,101,112,132];s=[158,178,179,181,163,154,144,152,159];p=[190,199,201,192,176,169,160,166,190];break;case 65:t=[93,91,99,108,130,125,132,155,174];s=[126,124,128,129,131,121,119,153,173];p=[103,94,87,85,80,85,107,120,146];break;case 66:t=[24,40,69,90,104,114,120,132,103];s=[29,52,94,127,150,162,159,151,101];p=[29,52,96,132,162,181,184,186,131];break;case 67:t=[46,38,61,92,113,121,132,150,191];s=[46,36,40,69,110,135,131,92,34];p=[46,80,74,70,81,105,165,211,225];break;case 68:t=[0,4,12,30,52,101,142,190,237];s=[0,40,86,121,140,172,187,213,240];p=[0,9,14,18,21,23,27,35,101];break;case 69:t=[198,206,206,211,198,181,161,171,244];s=[103,133,150,172,178,174,163,175,244];p=[49,54,55,66,91,130,184,224,244];break;case 70:t=[243,243,240,240,241,239,186,151,129];s=[0,46,99,149,194,220,183,166,147];p=[6,8,36,91,169,235,246,240,233];break;case 71:t=[22,19,19,25,35,53,88,139,210];s=[0,32,69,108,135,159,183,198,215];p=[77,96,110,116,110,100,90,78,70];break;case 72:t=[68,116,165,182,189,180,145,111,71];s=[37,82,135,178,204,225,221,202,147];p=[16,55,105,147,196,226,232,224,178];break;case 73:t=[61,99,136,181,213,225,198,136,24];s=[149,140,96,83,132,178,190,135,22];p=[214,203,168,135,110,100,111,113,22];break;case 74:t=[76,120,156,183,197,180,162,154,140];s=[34,35,42,69,102,137,164,188,197];p=[64,69,78,105,142,177,205,217,198];break;case 75:t=[37,102,157,188,196,214,223,235,251];s=[37,29,25,37,67,91,132,185,251];p=[37,32,33,45,66,98,137,187,251];break;case 76:t=[79,100,119,137,153,172,192,205,250];s=[63,79,93,103,115,135,167,196,250];p=[51,59,66,61,62,70,110,160,250];break;case 77:t=[43,44,50,66,125,172,178,155,157];s=[63,63,85,101,138,163,122,51,39];p=[121,101,58,44,47,55,57,44,43];break;case 78:t=[0,41,62,79,90,87,99,140,228];s=[0,57,81,93,85,70,71,125,228];p=[95,91,91,82,60,43,44,112,228];break;case 79:t=[49,59,72,88,114,141,176,205,222];s=[78,72,66,57,59,75,106,142,173];p=[78,55,46,40,39,39,40,41,47];break;case 80:t=[243,222,201,185,165,158,166,187,219];s=[94,108,132,135,125,96,68,51,61];p=[7,9,12,19,45,89,118,146,118];break;case 81:t=[19,44,74,105,137,166,194,206,220];s=[19,28,40,55,82,110,159,181,220];p=[19,42,68,96,129,157,188,203,220];break;case 82:t=[33,44,70,99,140,165,199,211,216];s=[38,50,76,105,140,165,191,189,167];p=[55,67,97,124,140,166,163,129,52];break;case 83:t=[0,33,73,124,136,152,159,171,223];s=[0,43,92,124,134,126,121,144,223];p=[0,43,68,76,73,64,72,114,223];break;case 84:t=[5,18,45,124,193,223,205,128,49];s=[48,134,207,230,193,113,28,0,7];p=[6,15,41,121,193,226,208,130,49];break;case 85:t=[180,106,104,135,164,188,189,165,144];s=[72,126,154,184,198,207,205,190,179];p=[41,120,158,188,194,181,145,100,62];break;case 86:t=[57,72,94,117,136,154,174,192,215];s=[0,33,68,109,140,171,192,196,209];p=[116,137,173,201,200,201,203,190,187];break;case 87:t=[31,71,123,160,210,222,214,199,183];s=[40,117,171,211,231,220,190,132,65];p=[234,214,228,222,210,160,105,60,34];break;case 88:t=[123,108,109,126,154,172,188,196,218];s=[184,138,130,133,154,175,188,196,218];p=[208,130,109,99,110,122,150,171,218];break;case 89:t=[105,106,122,143,159,172,176,181,207];s=[252,197,194,187,174,162,153,136,125];p=[146,133,144,155,163,167,166,162,174];break;case 90:t=[171,141,145,152,154,159,163,158,177];s=[236,143,100,63,53,55,44,31,6];p=[59,48,46,44,42,54,82,112,179];break;case 91:t=[180,190,209,223,204,228,205,152,91];s=[93,125,147,172,181,224,233,198,158];p=[236,218,160,133,114,132,162,220,218];break;case 92:t=[225,183,162,135,115,111,119,145,211];s=[205,177,166,135,124,117,117,132,172];p=[186,165,155,135,126,130,150,178,226];break;case 93:t=[39,43,59,63,80,116,153,177,223];s=[39,43,59,74,91,114,139,165,223];p=[39,50,59,70,85,115,151,176,223];break;case 94:t=[0,38,60,76,84,89,101,128,204];s=[0,10,15,23,35,57,83,123,199];p=[0,11,22,40,63,86,97,94,85];break;case 95:t=[94,112,141,165,167,140,91,49,27];s=[27,46,88,135,166,161,135,97,58];p=[42,52,81,106,139,158,155,137,116];break;case 96:t=[30,49,79,117,135,151,146,138,147];s=[63,60,72,90,94,94,68,46,16];p=[18,28,41,56,62,63,50,36,21];break;case 97:t=[0,30,63,101,143,152,169,187,230];s=[0,14,28,42,58,61,67,74,91];p=[39,26,21,18,15,14,14,13,13];break;case 98:t=[149,140,164,179,182,181,131,87,61];s=[62,70,107,136,144,138,117,87,74];p=[40,38,45,49,49,49,38,32,34];break;case 99:t=[99,112,148,165,179,182,183,183,208];s=[39,40,57,79,104,127,148,161,198];p=[15,16,18,33,51,79,103,129,177];break;case 100:t=[99,116,154,174,200,196,201,201,230];s=[0,0,8,32,58,83,119,136,173];p=[5,6,7,9,9,14,17,19,24];break;case 101:t=[82,106,126,141,155,163,142,107,66];s=[62,44,69,107,135,152,149,132,119];p=[39,25,31,60,73,68,49,72,188];break;case 102:t=[18,29,44,72,116,158,184,208,221];s=[27,46,71,105,146,177,189,190,183];p=[39,55,80,108,130,133,124,100,76];break;case 103:t=[0,48,119,173,212,224,228,228,245];s=[0,13,30,47,79,127,167,205,245];p=[0,68,75,43,16,22,55,128,245];break;case 104:t=[34,70,129,187,225,226,216,193,179];s=[48,91,147,194,226,229,196,110,12];p=[234,212,216,224,206,110,53,40,29];break;case 105:t=[30,55,103,147,174,203,188,151,105];s=[0,65,138,182,187,175,121,53,9];p=[191,202,212,208,171,140,97,57,30];break;case 106:t=[112,97,113,125,138,159,178,188,225];s=[16,17,24,37,56,81,110,136,189];p=[38,35,46,59,78,103,130,152,201];break;case 107:t=[18,72,5,23,29,201,200,98,29];s=[0,0,43,167,211,117,0,0,0];p=[51,203,177,26,10,9,8,3,0];break;case 108:t=[19,42,64,88,118,147,175,187,205];s=[19,55,89,125,154,169,161,129,70];p=[19,32,47,70,100,128,145,130,75];break;case 109:t=[33,31,42,68,86,111,141,172,227];s=[255,175,145,106,88,55,15,0,0];p=[255,205,202,203,208,205,203,206,231];break;case 110:t=[0,25,50,79,110,145,181,201,254];s=[0,16,30,46,63,82,101,124,179];p=[0,12,21,29,39,49,61,74,103];break;case 111:t=[0,13,30,44,72,120,156,200,247];s=[0,36,84,117,141,153,151,158,247];p=[0,94,100,82,56,66,76,131,247];break;case 112:t=[26,51,43,33,28,35,74,144,246];s=[9,24,55,87,118,150,180,200,222];p=[30,96,112,114,112,101,72,35,0];break;case 113:t=[0,5,65,97,124,156,189,224,255];s=[32,54,77,100,123,148,175,203,234];p=[77,110,107,111,120,119,111,94,70];break;default:return g.Painter.CreateDefaultPalette()}return g.Painter.CreateGradientColorTable(r,t,s,p,255,u)};function k(p){g.TObjectPainter.call(this,p);this.Enabled=true;this.UseContextMenu=true;this.UseTextColor=false;this.FirstRun=1;this.AssignFinishPave()}k.prototype=Object.create(g.TObjectPainter.prototype);k.prototype.AssignFinishPave=function(){function p(){if(this.FirstRun<=0){return}this.FirstRun--;if(this.FirstRun!==0){return}delete this.FinishPave;this.DrawingReady()}this.FinishPave=p.bind(this)};k.prototype.DrawPave=function(t){this.UseTextColor=false;if(!this.Enabled){return this.RemoveDrawG()}var B=this.GetObject(),r=B.fOption.toUpperCase();if(B.fInit===0){this.stored=g.extend({},B);B.fInit=1;var F=this.root_pad();if(r.indexOf("NDC")>=0){B.fX1NDC=B.fX1;B.fX2NDC=B.fX2;B.fY1NDC=B.fY1;B.fY2NDC=B.fY2}else{if(F){if(F.fLogx){if(B.fX1>0){B.fX1=g.log10(B.fX1)}if(B.fX2>0){B.fX2=g.log10(B.fX2)}}if(F.fLogy){if(B.fY1>0){B.fY1=g.log10(B.fY1)}if(B.fY2>0){B.fY2=g.log10(B.fY2)}}B.fX1NDC=(B.fX1-F.fX1)/(F.fX2-F.fX1);B.fY1NDC=(B.fY1-F.fY1)/(F.fY2-F.fY1);B.fX2NDC=(B.fX2-F.fX1)/(F.fX2-F.fX1);B.fY2NDC=(B.fY2-F.fY1)/(F.fY2-F.fY1)}else{B.fX1NDC=B.fY1NDC=0.1;B.fX2NDC=B.fY2NDC=0.9}}if((B.fX1NDC==B.fX2NDC)&&(B.fY1NDC==B.fY2NDC)&&(B._typename=="TLegend")){B.fX1NDC=Math.max(F?F.fLeftMargin:0,B.fX2NDC-0.3);B.fX2NDC=Math.min(B.fX1NDC+0.3,F?1-F.fRightMargin:1);var w=Math.max(B.fPrimitives?B.fPrimitives.arr.length*0.05:0,0.2);B.fY2NDC=Math.min(F?1-F.fTopMargin:1,B.fY1NDC+w);B.fY1NDC=Math.max(B.fY2NDC-w,F?F.fBottomMargin:0)}}var q=Math.round(B.fX1NDC*this.pad_width()),p=Math.round((1-B.fY2NDC)*this.pad_height()),D=Math.round((B.fX2NDC-B.fX1NDC)*this.pad_width()),A=Math.round((B.fY2NDC-B.fY1NDC)*this.pad_height()),G=B.fBorderSize,z=(r.indexOf("L")>=0)?-1:((r.indexOf("R")>=0)?1:0),y=(r.indexOf("T")>=0)?-1:((r.indexOf("B")>=0)?1:0);this.CreateG();this.draw_g.attr("transform","translate("+q+","+p+")");this.createAttLine({attr:B,width:G>0?1:0});this.createAttFill({attr:B});if(B._typename=="TDiamond"){var v=Math.round(A/2),x=Math.round(D/2),u="l"+x+",-"+v+"l"+x+","+v+"l-"+x+","+v+"z";if((G>1)&&(B.fShadowColor>0)&&(z||y)){this.draw_g.append("svg:path").attr("d","M0,"+(v+G)+u).style("fill",this.get_color(B.fShadowColor)).style("stroke",this.get_color(B.fShadowColor)).style("stroke-width","1px")}this.draw_g.append("svg:path").attr("d","M0,"+v+u).call(this.fillatt.func).call(this.lineatt.func);var E=this.draw_g.append("svg:g").attr("transform","translate("+Math.round(D/4)+","+Math.round(A/4)+")");this.DrawPaveText(x,v,t,E);return}if((G>1)&&(B.fShadowColor>0)&&!B.fNpaves&&(z||y)){this.draw_g.append("svg:path").attr("d","M"+(z*G)+","+(y*G)+"v"+A+"h"+D+"v-"+A+"z").style("fill",this.get_color(B.fShadowColor)).style("stroke",this.get_color(B.fShadowColor)).style("stroke-width","1px")}if(B.fNpaves){for(var C=B.fNpaves-1;C>0;--C){this.draw_g.append("svg:path").attr("d","M"+(z*4*C)+","+(y*4*C)+"h"+D+"v"+A+"h-"+D+"z").call(this.fillatt.func).call(this.lineatt.func)}}var s=this.draw_g.append("svg:path").attr("d","M0,0h"+D+"v"+A+"h-"+D+"z").call(this.fillatt.func).call(this.lineatt.func);if("PaveDrawFunc" in this){this.PaveDrawFunc(D,A,t)}if(g.BatchMode||(B._typename=="TPave")){return}s.style("pointer-events","visibleFill").on("mouseenter",this.ShowObjectStatus.bind(this));this.draw_g.attr("x",q).attr("y",p).attr("width",D).attr("height",A);this.AddDrag({obj:B,minwidth:10,minheight:20,canselect:true,redraw:this.DrawPave.bind(this),ctxmenu:g.touches&&g.gStyle.ContextMenu&&this.UseContextMenu});if(this.UseContextMenu&&g.gStyle.ContextMenu){this.draw_g.on("contextmenu",this.ShowContextMenu.bind(this))}};k.prototype.DrawPaveLabel=function(p,r){this.UseTextColor=true;var q=this.GetObject();this.StartTextDrawing(q.fTextFont,r/1.2);this.DrawText({align:q.fTextAlign,width:p,height:r,text:q.fLabel,color:this.get_color(q.fTextColor)});this.FinishTextDrawing(null,this.FinishPave)};k.prototype.DrawPaveStats=function(E,x,q){if(q&&this.IsStats()){this.FillStatistic()}var B=this.GetObject(),p=[],L=this.get_color(B.fTextColor),K=0,I=0,J=0;for(var H=0;H<B.fLines.arr.length;++H){var r=B.fLines.arr[H];if((r._typename=="TText")||(r._typename=="TLatex")){p.push(r.fTitle)}}var w=p.length;for(var H=0;H<w;++H){var v=p[H];if(H>0){J=Math.max(J,v.length)}if((H==0)||(v.indexOf("|")<0)){continue}if(K===0){K=H}var D=v.split("|");if(D.length>I){I=D.length}}var C=x/w,s=false,M=B.fMargin*E;this.StartTextDrawing(B.fTextFont,x/(w*1.2));this.UseTextColor=true;if(w==1){this.DrawText({align:B.fTextAlign,width:E,height:x,text:p[0],color:L,latex:1})}else{for(var H=0;H<w;++H){var A=H*C,G=L;this.UseTextColor=true;if(K&&(H>=K)){var D=p[H].split("|");for(var z=0;z<D.length;++z){this.DrawText({align:"middle",x:E*z/I,y:A,latex:0,width:E/I,height:C,text:D[z],color:G})}}else{if(p[H].indexOf("=")<0){if(H==0){s=true;if(p[H].length>J+5){p[H]=p[H].substr(0,J+2)+"..."}}this.DrawText({align:(H==0)?"middle":"start",x:M,y:A,width:E-2*M,height:C,text:p[H],color:G})}else{var D=p[H].split("="),u=0;for(var z=0;z<2;++z){u+=this.DrawText({align:(z==0)?"start":"end",x:M,y:A,width:E-2*M,height:C,text:D[z],color:G})}this.TextScaleFactor(1.05*u/(E-2*M),this.draw_g)}}}}var t="";if((B.fBorderSize>0)&&s){t+="M0,"+Math.round(C)+"h"+E}if((K>0)&&(I>1)){for(var F=K;F<w;++F){t+="M0,"+Math.round(F*C)+"h"+E}for(var y=0;y<I-1;++y){t+="M"+Math.round(E/I*(y+1))+","+Math.round(K*C)+"V"+x}}if(t){this.draw_g.append("svg:path").attr("d",t).call(this.lineatt.func)}this.FinishTextDrawing(undefined,this.FinishPave);this.draw_g.classed("most_upper_primitives",true)};k.prototype.DrawPaveText=function(p,r,Q,ab){var v=this.GetObject(),C=this.get_color(v.fTextColor),D=0,P=[],U=this.pad_height(),A=this.pad_painter(),X=false,B=(v.fLabel.length>0);if(B){this.FirstRun++}if(!ab){ab=this.draw_g}for(var Y=0;Y<v.fLines.arr.length;++Y){var M=v.fLines.arr[Y];if((M._typename=="TText")||(M._typename=="TLatex")){D++;if((M.fX>0)||(M.fY>0)){X=true}}}var u=(D==1)&&A&&A._fast_drawing,t=0;for(var Y=0;Y<v.fLines.arr.length;++Y){var M=v.fLines.arr[Y],E=(D>0)?Math.round((1-(t-0.5)/D)*r):0;switch(M._typename){case"TText":case"TLatex":t++;if(X){var J=M.fX,H=M.fY;if((J>0)&&(J<1)){J=Math.round(J*p)}else{J=v.fMargin*p}if((H>0)&&(H<1)){H=Math.round((1-H)*r)}else{H=E}var z=M.fTextColor?this.get_color(M.fTextColor):"";if(!z){z=C;this.UseTextColor=true}this.StartTextDrawing(v.fTextFont,(M.fTextSize||v.fTextSize)*U,ab);this.DrawText({align:M.fTextAlign||v.fTextAlign,x:J,y:H,text:M.fTitle,color:z,latex:(M._typename=="TText")?0:1,draw_g:ab,fast:u});this.FinishTextDrawing(ab,this.FinishPave);this.FirstRun++}else{P.push(M)}break;case"TLine":case"TBox":var W=M.fX1,V=M.fX2,I=M.fY1,F=M.fY2;if(W!==0){W=Math.round(W*p)}V=V?Math.round(V*p):p;I=I?Math.round((1-I)*r):E;F=F?Math.round((1-F)*r):E;if(M._typename=="TLine"){var K=new g.TAttLineHandler(M);ab.append("svg:line").attr("x1",W).attr("y1",I).attr("x2",V).attr("y2",F).call(K.func)}else{var aa=this.createAttFill(M);ab.append("svg:rect").attr("x",W).attr("y",F).attr("width",V-W).attr("height",I-F).call(aa.func)}break}}if(X){if(this.FinishPave){this.FinishPave()}}else{var N=r/D,q=false,L=v.fMargin*p;this.StartTextDrawing(v.fTextFont,r/(D*1.2),ab);for(var Y=0;Y<D;++Y){var G=null,O=P[Y];if(D==1){G={align:v.fTextAlign,x:0,y:0,width:p,height:r}}else{G={align:v.fTextAlign,x:L,y:Y*N,width:p-2*L,height:N};if(O.fTextColor){G.color=this.get_color(O.fTextColor)}if(O.fTextSize){G.font_size=Math.round(O.fTextSize*U)}}G.draw_g=ab;G.latex=(O._typename=="TText"?0:1);G.text=O.fTitle;G.fast=u;if(!G.color){this.UseTextColor=true;G.color=C}this.DrawText(G)}this.FinishTextDrawing(ab,this.FinishPave)}if(B){var S=Math.round(p*0.25),R=Math.round(-r*0.02),T=Math.round(p*0.5),Z=Math.round(r*0.04),s=ab.append("svg:g");s.append("svg:path").attr("d","M"+S+","+R+"h"+T+"v"+Z+"h-"+T+"z").call(this.fillatt.func).call(this.lineatt.func);this.StartTextDrawing(v.fTextFont,Z/1.5,s);this.DrawText({align:22,x:S,y:R,width:T,height:Z,text:v.fLabel,color:C,draw_g:s});this.FinishTextDrawing(s,this.FinishPave);this.UseTextColor=true}};k.prototype.Format=function(s,p){if(!p){p="stat"}var r=this.GetObject();switch(p){case"stat":p=r.fStatFormat||g.gStyle.fStatFormat;break;case"fit":p=r.fFitFormat||g.gStyle.fFitFormat;break;case"entries":if(s<1000000000){return s.toFixed(0)}p="14.7g";break;case"last":p=this.lastformat;break}delete this.lastformat;var q=g.FFormat(s,p||"6.4g");this.lastformat=g.lastFFormat;return q};k.prototype.DrawPaveLegend=function(S,X){var R=this.GetObject(),G=R.fPrimitives.arr.length,s=R.fNColumns,T=G;if(s<2){s=1}else{while((T-1)*s>=G){T--}}function D(w){return !w.fObject&&!w.fOption&&(!w.fLabel||(w.fLabel==" "))}if(s==1){for(var W=0;W<G;++W){if(D(R.fPrimitives.arr[W])){T--}}}if(T<1){T=1}var F=this.get_color(R.fTextColor),Z=Math.round(S/s),H=Math.round(0.03*S/s),E=Math.round(0.03*X),U=(X-2*E)/T,L=0.9*U,v=0,C=this.pad_height(),u,x=false,W=-1;if(R.fTextSize&&(C*R.fTextSize>2)&&(C*R.fTextSize<L)){L=v=Math.round(C*R.fTextSize)}this.StartTextDrawing(R.fTextFont,L,this.draw_g,v);for(var P=0;P<G;++P){var K=R.fPrimitives.arr[P];if(D(K)){continue}if(s==1){++W}else{W=P}var Q=K.fOption.toLowerCase(),y=W%s,J=(W-y)/s,B=y*Z,r=B+Math.round(R.fMargin*Z),z=Math.round(E+J*U),I=Math.round(E+(J+0.5)*U),O=K,V=K,M=K,t=K.fObject,q=null,p=false;if((t!==null)&&(typeof t=="object")){if("fLineColor" in t){M=t}if("fFillColor" in t){O=t}if("fMarkerColor" in t){V=t}q=this.FindPainterFor(t)}if(Q.indexOf("f")!=-1){var Y=(q&&q.fillatt)?q.fillatt:this.createAttFill(O);this.draw_g.append("svg:rect").attr("x",B+H).attr("y",Math.round(z+U*0.1)).attr("width",r-2*H-B).attr("height",Math.round(U*0.8)).call(Y.func);if(!Y.empty()){p=true}}if(Q.indexOf("l")!=-1){var N=(q&&q.lineatt)?q.lineatt:new g.TAttLineHandler(M);this.draw_g.append("svg:line").attr("x1",B+H).attr("y1",I).attr("x2",r-H).attr("y2",I).call(N.func);if(N.color!=="none"){p=true}}if(Q.indexOf("e")!=-1&&(Q.indexOf("l")==-1||Q.indexOf("f")!=-1)){}if(Q.indexOf("p")!=-1){var aa=(q&&q.markeratt)?q.markeratt:new g.TAttMarkerHandler(V);this.draw_g.append("svg:path").attr("d",aa.create((B+r)/2,I)).call(aa.func);if(aa.color!=="none"){p=true}}if(!p&&q&&q.lineatt&&(q.lineatt.color!=="none")){this.draw_g.append("svg:rect").attr("x",B+H).attr("y",Math.round(z+U*0.1)).attr("width",r-2*H-B).attr("height",Math.round(U*0.8)).attr("fill","none").call(q.lineatt.func)}var A=r;if(Q.length>0){x=true}else{if(!x){A=B+H}}if(K.fLabel){this.DrawText({align:"start",x:A,y:z,width:B+Z-A-H,height:U,text:K.fLabel,color:F})}}this.FinishTextDrawing(this.draw_g,this.FinishPave)};k.prototype.FillContextMenu=function(r){var q=this.GetObject();r.add("header: "+q._typename+"::"+q.fName);if(this.IsStats()){r.add("Default position",function(){q.fX2NDC=g.gStyle.fStatX;q.fX1NDC=q.fX2NDC-g.gStyle.fStatW;q.fY2NDC=g.gStyle.fStatY;q.fY1NDC=q.fY2NDC-g.gStyle.fStatH;q.fInit=1;this.Redraw()});r.add("SetStatFormat",function(){var s=prompt("Enter StatFormat",q.fStatFormat);if(s!=null){q.fStatFormat=s;this.Redraw()}});r.add("SetFitFormat",function(){var s=prompt("Enter FitFormat",q.fFitFormat);if(s!=null){q.fFitFormat=s;this.Redraw()}});r.add("separator");r.add("sub:SetOptStat",function(){var s=prompt("Enter OptStat",q.fOptStat);if(s!=null){q.fOptStat=parseInt(s);this.Redraw()}});function p(u,s){var t=(u<10)?q.fOptStat:q.fOptFit;t=parseInt(parseInt(t)/parseInt(Math.pow(10,u%10)))%10;r.addchk(t,s,t*100+u,function(v){var x=(v%100<10)?q.fOptStat:q.fOptFit;var w=parseInt(v/100);x-=(w>0?w:-1)*parseInt(Math.pow(10,v%10));if(v%100<10){q.fOptStat=x}else{q.fOptFit=x}this.Redraw()})}p(0,"Histogram name");p(1,"Entries");p(2,"Mean");p(3,"Std Dev");p(4,"Underflow");p(5,"Overflow");p(6,"Integral");p(7,"Skewness");p(8,"Kurtosis");r.add("endsub:");r.add("sub:SetOptFit",function(){var s=prompt("Enter OptStat",q.fOptFit);if(s!=null){q.fOptFit=parseInt(s);this.Redraw()}});p(10,"Fit parameters");p(11,"Par errors");p(12,"Chi square / NDF");p(13,"Probability");r.add("endsub:");r.add("separator")}else{if(q.fName==="title"){r.add("Default position",function(){q.fX1NDC=0.28;q.fY1NDC=0.94;q.fX2NDC=0.72;q.fY2NDC=0.99;q.fInit=1;this.Redraw()})}}if(this.UseTextColor){this.TextAttContextMenu(r)}this.FillAttContextMenu(r);return r.size()>0};k.prototype.ShowContextMenu=function(p){if(!p){o.event.stopPropagation();o.event.preventDefault();p=o.event}g.Painter.createMenu(this,function(q){q.painter.FillContextMenu(q);q.show(p)})};k.prototype.IsStats=function(){return this.MatchObjectType("TPaveStats")};k.prototype.ClearPave=function(){this.GetObject().Clear()};k.prototype.AddText=function(p){this.GetObject().AddText(p)};k.prototype.FillFunctionStat=function(t,x){if(!x||!t){return false}var q=x%10,u=Math.floor(x/10)%10,s=Math.floor(x/100)%10,y=Math.floor(x/1000)%10;if(s>0){this.AddText("#chi^2 / ndf = "+this.Format(t.fChisquare,"fit")+" / "+t.fNDF)}if(y>0){this.AddText("Prob = "+(("Math" in g)?this.Format(g.Math.Prob(t.fChisquare,t.fNDF)):"<not avail>"))}if(q>0){for(var p=0;p<t.GetNumPars();++p){var w=t.GetParName(p),r=t.GetParValue(p),v=t.GetParError(p);r=(r===undefined)?"<not avail>":this.Format(Number(r),"fit");if(v!==undefined){v=this.Format(v,"last");if((Number(v)===0)&&(t.GetParError(p)!=0)){v=this.Format(t.GetParError(p),"4.2g")}}if((u>0)&&v){this.AddText(w+" = "+r+" #pm "+v)}else{this.AddText(w+" = "+r)}}}return true};k.prototype.FillStatistic=function(){var r=this.pad_painter();if(r&&r._fast_drawing){return false}var u=this.GetObject(),p=u.$main_painter||this.main_painter();if(u.fName!=="stats"){return false}if(!p||(typeof p.FillStatistic!=="function")){return false}var q=parseInt(u.fOptStat),v=parseInt(u.fOptFit);if(isNaN(q)){q=g.gStyle.fOptStat}if(isNaN(v)){v=g.gStyle.fOptFit}if(!p.FillStatistic(this,q,v)){return false}var s=u.fLines.arr.length,t=s*g.gStyle.StatFontSize;if((t<=0)||(g.gStyle.StatFont%10===3)){t=0.25*s*g.gStyle.StatH;u.fY1NDC=u.fY2NDC-t}return true};k.prototype.UpdateObject=function(q){if(!this.MatchObjectType(q)){return false}var p=this.GetObject();if(!p.modified_NDC){if(this.stored&&!q.fInit&&(this.stored.fX1==q.fX1)&&(this.stored.fX2==q.fX2)&&(this.stored.fY1==q.fY1)&&(this.stored.fY2==q.fY2)){if(this.stored.fX1NDC!=q.fX1NDC){p.fX1NDC=q.fX1NDC}if(this.stored.fX2NDC!=q.fX2NDC){p.fX2NDC=q.fX2NDC}if(this.stored.fY1NDC!=q.fY1NDC){p.fY1NDC=q.fY1NDC}if(this.stored.fY2NDC!=q.fY2NDC){p.fY2NDC=q.fY2NDC}}else{p.fOption=q.fOption;p.fInit=q.fInit;p.fX1=q.fX1;p.fX2=q.fX2;p.fY1=q.fY1;p.fY2=q.fY2;p.fX1NDC=q.fX1NDC;p.fX2NDC=q.fX2NDC;p.fY1NDC=q.fY1NDC;p.fY2NDC=q.fY2NDC}this.stored=g.extend({},q)}switch(q._typename){case"TPaveText":p.fLines=g.clone(q.fLines);return true;case"TPavesText":p.fLines=g.clone(q.fLines);p.fNpaves=q.fNpaves;return true;case"TPaveLabel":p.fLabel=q.fLabel;return true;case"TPaveStats":p.fOptStat=q.fOptStat;p.fOptFit=q.fOptFit;return true;case"TLegend":p.fPrimitives=q.fPrimitives;p.fNColumns=q.fNColumns;return true}return false};k.prototype.Redraw=function(){this.DrawPave(true)};function b(t,s,r){var q=new g.TPavePainter(s);q.SetDivId(t,2,((typeof r=="string")&&(r.indexOf("onpad:")==0))?r.substr(6):undefined);if((s.fName==="title")&&(s._typename==="TPaveText")){var p=q.FindPainterFor(null,"title");if(p&&(p!==q)){p.DeleteThis()}}switch(s._typename){case"TPaveLabel":q.PaveDrawFunc=q.DrawPaveLabel;break;case"TPaveStats":q.PaveDrawFunc=q.DrawPaveStats;q.$secondary=true;break;case"TPaveText":case"TPavesText":case"TDiamond":q.PaveDrawFunc=q.DrawPaveText;break;case"TLegend":q.PaveDrawFunc=q.DrawPaveLegend;break}q.Redraw();return q.PaveDrawFunc?q:q.DrawingReady()}function d(s,q,r){q.fBorderSize=1;q.fShadowColor=0;var p=new g.TPavePainter(q);p.SetDivId(s);p.z_handle=new g.TAxisPainter(q.fAxis,true);p.z_handle.SetDivId(s,-1);p.Cleanup=function(){if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}g.TObjectPainter.prototype.Cleanup.call(this)};p.PaveDrawFunc=function(C,B,I){var G=this,aa=this.GetObject(),H=aa.fAxis,w=(typeof I=="string")&&(I.indexOf("canmove")>0),F=(typeof I=="string")&&(I.indexOf("postpone")>0),x=H.fNdiv%100,E=parseInt(this.draw_g.attr("x")),D=parseInt(this.draw_g.attr("y")),t=this.pad_width(),v=this.pad_height(),ad=H.fLabelOffset*t,y=this.main_painter(),J=this.frame_painter(),u=0,K=100,Z=y.fContour;if(x<=0){x=8}H.fTickSize=0.6*C/t;if(Z){u=Math.min(Z[0],J.zmin);K=Math.max(Z[Z.length-1],J.zmax)}else{if((y.gmaxbin!==undefined)&&(y.gminbin!==undefined)){u=y.gminbin;K=y.gmaxbin}else{if((y.hmin!==undefined)&&(y.hmax!==undefined)){u=y.hmin;K=y.hmax}}}var S=null,W="normal";if(this.root_pad().fLogz){S=o.scaleLog();W="log"}else{S=o.scaleLinear()}S.domain([u,K]).range([B,0]);this.draw_g.selectAll("rect").style("fill","white");if(!Z||F){this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",C).attr("height",B).style("fill","white")}else{for(var ab=0;ab<Z.length-1;++ab){var Q=S(Z[ab]),P=S(Z[ab+1]),A=y.getContourColor((Z[ab]+Z[ab+1])/2);var X=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(P)).attr("width",C).attr("height",Math.round(Q)-Math.round(P)).style("fill",A).style("stroke",A).property("fill0",A).property("fill1",o.rgb(A).darker(0.5).toString());if(J&&J.tooltip_allowed){X.on("mouseover",function(){o.select(this).transition().duration(100).style("fill",o.select(this).property("fill1"))}).on("mouseout",function(){o.select(this).transition().duration(100).style("fill",o.select(this).property("fill0"))}).append("svg:title").text(Z[ab].toFixed(2)+" - "+Z[ab+1].toFixed(2))}if(g.gStyle.Zooming){X.on("dblclick",function(){G.frame_painter().Unzoom("z")})}}}this.z_handle.SetAxisConfig("zaxis",W,S,u,K,u,K);this.z_handle.max_tick_size=Math.round(C*0.7);this.z_handle.DrawAxis(true,this.draw_g,C,B,"translate("+C+", 0)");if(w&&("getBoundingClientRect" in this.draw_g.node())){var O=this.draw_g.node().getBoundingClientRect();var M=(E+parseInt(O.width))-Math.round(0.995*t)+3;if(M>0){this.draw_g.attr("x",E-M).attr("y",D).attr("transform","translate("+(E-M)+", "+D+")");aa.fX1NDC-=M/t;aa.fX2NDC-=M/t}}if(!g.gStyle.Zooming){return}var R=null,N=false,U=0,T=0,V=null;function ac(){if(!N){return}o.event.preventDefault();var z=o.mouse(R);if(z[1]<U){U=z[1]}else{T=z[1]}V.attr("y",U).attr("height",Math.abs(T-U))}function Y(){if(!N){return}o.event.preventDefault();o.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);V.remove();V=null;N=false;var z=Math.min(S.invert(U),S.invert(T)),ae=Math.max(S.invert(U),S.invert(T));G.frame_painter().Zoom("z",z,ae)}function L(){if(N){return}N=true;o.event.preventDefault();R=this;var z=o.mouse(R);U=T=z[1];V=G.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",C).attr("y",U).attr("height",5);o.select(window).on("mousemove.colzoomRect",ac).on("mouseup.colzoomRect",Y,true);o.event.stopPropagation()}this.draw_g.select(".axis_zoom").on("mousedown",L).on("dblclick",function(){G.frame_painter().Unzoom("z")})};p.ShowContextMenu=function(t){this.frame_painter().ShowContextMenu("z",t,this.GetObject().fAxis)};p.UseContextMenu=true;p.DrawPave(r);return p.DrawingReady()}function f(x,p){var w=g.GetMainPainter(x);if(!w){return}var q=w.pad_painter(),r=w.root_pad();if(!q||!r){return}var A=g.Create("TLegend");for(var u=0;u<q.painters.length;++u){var y=q.painters[u],v=y.GetObject();if(!v){continue}var z=g.Create("TLegendEntry");z.fObject=v;z.fLabel=(p=="all")?v.fName:y.GetItemName();z.fOption="";if(!z.fLabel){continue}if(y.lineatt&&y.lineatt.used){z.fOption+="l"}if(y.fillatt&&y.fillatt.used){z.fOption+="f"}if(y.markeratt&&y.markeratt.used){z.fOption+="m"}if(!z.fOption){z.fOption="l"}A.fPrimitives.Add(z)}var t=0.4,s=A.fPrimitives.arr.length;if(!s){return}if(s>8){s=8}s*=0.1;g.extend(A,{fX1NDC:t*r.fLeftMargin+(1-t)*(1-r.fRightMargin),fY1NDC:(1-s)*(1-r.fTopMargin)+s*r.fBottomMargin,fX2NDC:0.99-r.fRightMargin,fY2NDC:0.99-r.fTopMargin});A.fFillStyle=1001;return b(x,A)}function n(p){this.Reset()}n.prototype.Reset=function(){g.extend(this,{Axis:0,RevX:false,RevY:false,Bar:false,BarStyle:0,Curve:false,Hist:true,Line:false,Fill:false,Error:false,ErrorKind:-1,errorX:g.gStyle.fErrorX,Mark:false,Same:false,Scat:false,ScatCoef:1,Func:true,Arrow:false,Box:false,BoxStyle:0,Text:false,TextAngle:0,TextKind:"",Char:0,Color:false,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:false,Pie:false,List:false,Zscale:false,Candle:"",GLBox:0,GLColor:false,Project:"",System:g.Painter.Coord.kCARTESIAN,AutoColor:false,NoStat:false,ForceStat:false,AutoZoom:false,HighRes:0,Zero:true,Palette:0,BaseLine:false,Optimize:g.gStyle.OptimizeDraw,Mode3D:false,FrontBox:true,BackBox:true,_pmc:false,_plc:false,_pfc:false,need_fillcol:false,minimum:-1111,maximum:-1111})};n.prototype.Decode=function(p,t,u,s,w){this.orginal=p;var v=new g.DrawOptions(p),x="";if((t===1)&&(u.fSumw2.length>0)){for(var r=0;r<u.fSumw2.length;++r){if(u.fSumw2[r]>0){this.Error=true;this.Hist=false;this.Zero=false;break}}}this.ndim=t||1;if(v.check("PAL",true)){this.Palette=v.partAsInt()}if(v.check("MINIMUM:",true)){this.minimum=parseFloat(v.part)}else{this.minimum=u.fMinimum}if(v.check("MAXIMUM:",true)){this.maximum=parseFloat(v.part)}else{this.maximum=u.fMaximum}if(v.check("NOOPTIMIZE")){this.Optimize=0}if(v.check("OPTIMIZE")){this.Optimize=2}if(v.check("AUTOCOL")){this.AutoColor=true}if(v.check("AUTOZOOM")){this.AutoZoom=true}if(v.check("OPTSTAT",true)){this.optstat=v.partAsInt()}if(v.check("OPTFIT",true)){this.optfit=v.partAsInt()}if(v.check("NOSTAT")){this.NoStat=true}if(v.check("STAT")){this.ForceStat=true}if(v.check("NOTOOLTIP")&&w){w.tooltip_allowed=false}if(v.check("TOOLTIP")&&w){w.tooltip_allowed=true}if(v.check("LOGX")&&s){s.fLogx=1;s.fUxmin=0;s.fUxmax=1;s.fX1=0;s.fX2=1}if(v.check("LOGY")&&s){s.fLogy=1;s.fUymin=0;s.fUymax=1;s.fY1=0;s.fY2=1}if(v.check("LOGZ")&&s){s.fLogz=1}if(v.check("GRIDXY")&&s){s.fGridx=s.fGridy=1}if(v.check("GRIDX")&&s){s.fGridx=1}if(v.check("GRIDY")&&s){s.fGridy=1}if(v.check("TICKXY")&&s){s.fTickx=s.fTicky=1}if(v.check("TICKX")&&s){s.fTickx=1}if(v.check("TICKY")&&s){s.fTicky=1}if(v.check("FILL_",true)){if(v.partAsInt(1)>0){this.histoFillColor=v.partAsInt()}else{for(var q=0;q<8;++q){if(g.Painter.root_colors[q].toUpperCase()===v.part){this.histoFillColor=q}}}}if(v.check("LINE_",true)){if(v.partAsInt(1)>0){this.histoLineColor=g.Painter.root_colors[v.partAsInt()]}else{for(var q=0;q<8;++q){if(g.Painter.root_colors[q].toUpperCase()===v.part){this.histoLineColor=v.part}}}}if(v.check("X+")){this.AxisPos=10}if(v.check("Y+")){this.AxisPos+=1}if(v.check("SAMES")){this.Same=true;this.ForceStat=true}if(v.check("SAME")){this.Same=true;this.Func=true}if(v.check("SPEC")){this.Spec=true}if(v.check("BASE0")){this.BaseLine=0}else{if(g.gStyle.fHistMinimumZero){this.BaseLine=0}}if(v.check("PIE")){this.Pie=true}if(v.check("CANDLE",true)){this.Candle=v.part}if(v.check("GLBOX",true)){this.GLBox=10+v.partAsInt()}if(v.check("GLCOL")){this.GLColor=true}v.check("GL");if(v.check("LEGO",true)){this.Lego=1;if(v.part.indexOf("0")>=0){this.Zero=false}if(v.part.indexOf("1")>=0){this.Lego=11}if(v.part.indexOf("2")>=0){this.Lego=12}if(v.part.indexOf("3")>=0){this.Lego=13}if(v.part.indexOf("4")>=0){this.Lego=14}x=v.part;if(v.part.indexOf("Z")>=0){this.Zscale=true}}if(v.check("SURF",true)){this.Surf=v.partAsInt(10,1);x=v.part;if(v.part.indexOf("Z")>=0){this.Zscale=true}}if(v.check("TF3",true)){x=v.part}if(v.check("ISO",true)){x=v.part}if(v.check("LIST")){this.List=true}if(v.check("CONT",true)&&(t>1)){this.Contour=1;if(v.part.indexOf("Z")>=0){this.Zscale=true}if(v.part.indexOf("1")>=0){this.Contour=11}else{if(v.part.indexOf("2")>=0){this.Contour=12}else{if(v.part.indexOf("3")>=0){this.Contour=13}else{if(v.part.indexOf("4")>=0){this.Contour=14}}}}}if(v.check("HBAR",true)){this.BarStyle=20}else{if(v.check("BAR",true)){this.BarStyle=10}}if(this.BarStyle>0){this.Hist=false;this.need_fillcol=true;this.BarStyle+=v.partAsInt()}if(v.check("ARR")){this.Arrow=true}if(v.check("BOX",true)){this.BoxStyle=10+v.partAsInt()}this.Box=this.BoxStyle>0;if(v.check("COL")){this.Color=true}if(v.check("CHAR")){this.Char=1}if(v.check("FUNC")){this.Func=true;this.Hist=false}if(v.check("AXIS")){this.Axis=1}if(v.check("AXIG")){this.Axis=2}if(v.check("TEXT",true)){this.Text=true;this.Hist=false;this.TextAngle=Math.min(v.partAsInt(),90);if(v.part.indexOf("N")>=0){this.TextKind="N"}if(v.part.indexOf("E")>=0){this.TextKind="E"}}if(v.check("SCAT=",true)){this.Scat=true;this.ScatCoef=parseFloat(v.part);if(isNaN(this.ScatCoef)||(this.ScatCoef<=0)){this.ScatCoef=1}}if(v.check("SCAT")){this.Scat=true}if(v.check("POL")){this.System=g.Painter.Coord.kPOLAR}if(v.check("CYL")){this.System=g.Painter.Coord.kCYLINDRICAL}if(v.check("SPH")){this.System=g.Painter.Coord.kSPHERICAL}if(v.check("PSR")){this.System=g.Painter.Coord.kRAPIDITY}if(v.check("TRI",true)){this.Color=false;this.Tri=1;x=v.part;if(v.part.indexOf("ERR")>=0){this.Error=true}}if(v.check("AITOFF")){this.Proj=1}if(v.check("MERCATOR")){this.Proj=2}if(v.check("SINUSOIDAL")){this.Proj=3}if(v.check("PARABOLIC")){this.Proj=4}if(this.Proj>0){this.Contour=14}if(v.check("PROJX",true)){this.Project="X"+v.partAsInt(0,1)}if(v.check("PROJY",true)){this.Project="Y"+v.partAsInt(0,1)}if(x){if(x.indexOf("FB")>=0){this.FrontBox=false}if(x.indexOf("BB")>=0){this.BackBox=false}}if((t==3)&&v.check("FB")){this.FrontBox=false}if((t==3)&&v.check("BB")){this.BackBox=false}this._pfc=v.check("PFC");this._plc=v.check("PLC")||this.AutoColor;this._pmc=v.check("PMC");if(v.check("L")){this.Line=true;this.Hist=false;this.Error=false}if(v.check("F")){this.Fill=true;this.need_fillcol=true}if(v.check("A")){this.Axis=-1}if(this.Axis&&v.check("RX")){this.RevX=true}if(this.Axis&&v.check("RY")){this.RevY=true}if(v.check("B1")){this.BarStyle=1;this.BaseLine=0;this.Hist=false;this.need_fillcol=true}if(v.check("B")){this.BarStyle=1;this.Hist=false;this.need_fillcol=true}if(v.check("C")){this.Curve=true;this.Hist=false}if(v.check("][")){this.Off=1;this.Hist=true}if(v.check("HIST")){this.Hist=true;this.Func=true;this.Error=false}this.Bar=(this.BarStyle>0);delete this.MarkStyle;if(v.check("P0")){this.Mark=true;this.Hist=false;this.Zero=true}if(v.check("P")){this.Mark=true;this.Hist=false;this.Zero=false}if(v.check("Z")){this.Zscale=true}if(v.check("*")){this.Mark=true;this.MarkStyle=3;this.Hist=false}if(v.check("H")){this.Hist=true}if(v.check("E",true)){this.Error=true;if(t==1){this.Zero=false;this.Hist=false;if(!isNaN(parseInt(v.part[0]))){this.ErrorKind=parseInt(v.part[0])}if((this.ErrorKind===3)||(this.ErrorKind===4)){this.need_fillcol=true}if(this.ErrorKind===0){this.Zero=true}if(v.part.indexOf("X0")>=0){this.errorX=0}}}if(v.check("9")){this.HighRes=1}if(v.check("0")){this.Zero=false}if(this.Color&&v.check("1")){this.Zero=false}if((this.Lego>0)||(t==3)||((this.Surf>0)||this.Error&&(t==2))){this.Mode3D=true}};n.prototype.asString=function(p){var q=p?p.frame_painter():null;var r="";if(this.Mode3D){if(this.Lego){r="LEGO";if(!this.Zero){r+="0"}if(this.Lego>10){r+=(this.Lego-10)}if(this.Zscale){r+="Z"}}else{if(this.Surf){r="SURF"+(this.Surf-10);if(this.Zscale){r+="Z"}}}if(!this.FrontBox){r+="FB"}if(!this.BackBox){r+="BB"}}else{if(this.Scat){r="SCAT"}else{if(this.Color){r="COL";if(!this.Zero){r+="0"}if(this.Zscale){r+="Z"}if(this.Axis<0){r+="A"}}else{if(this.Contour){r="CONT";if(this.Contour>10){r+=(this.Contour-10)}if(this.Zscale){r+="Z"}}else{if(this.Bar){r=(this.BaseLine===false)?"B":"B1"}else{if(this.Mark){r=this.Zero?"P0":"P"}else{if(this.Scat){r="SCAT"}else{if(this.Error){r="E";if(this.ErrorKind>=0){r+=this.ErrorKind}}else{if(this.Line){r+="L";if(this.Fill){r+="F"}}}}}}}}}if(this.Text){r+="TEXT";if(this.TextAngle){r+=this.TextAngle}r+=this.TextKind}}return r};function m(p){g.TObjectPainter.call(this,p);this.histo=p;this.draw_content=true;this.nbinsx=0;this.nbinsy=0;this.accept_drops=true;this.mode3d=false;this.DecomposeTitle()}m.prototype=Object.create(g.TObjectPainter.prototype);m.prototype.GetHisto=function(){return this.GetObject()};m.prototype.GetAxis=function(q){var p=this.GetObject();if(p){switch(q){case"x":return p.fXaxis;case"y":return p.fYaxis;case"z":return p.fZaxis}}return null};m.prototype.IsTProfile=function(){return this.MatchObjectType("TProfile")};m.prototype.IsTH1K=function(){return this.MatchObjectType("TH1K")};m.prototype.IsTH2Poly=function(){return this.MatchObjectType(/^TH2Poly/)};m.prototype.Clear3DScene=function(){var p=this.frame_painter();if(p&&typeof p.Create3DScene==="function"){p.Create3DScene(-1)}this.mode3d=false};m.prototype.Cleanup=function(){this.Clear3DScene();this.histo=null;delete this.fPalette;delete this.fContour;delete this.options;g.TObjectPainter.prototype.Cleanup.call(this)};m.prototype.Dimension=function(){var p=this.GetHisto();if(!p){return 0}if(p._typename.match(/^TH2/)){return 2}if(p._typename.match(/^TProfile2D/)){return 2}if(p._typename.match(/^TH3/)){return 3}return 1};m.prototype.DecodeOptions=function(s){var p=this.GetHisto(),r=this.Dimension(),t=this.root_pad(),q=this.frame_painter();if(!this.options){this.options=new n}else{this.options.Reset()}this.options.Decode(s||p.fOption,r,p,t,q);this.OptionsStore(s)};m.prototype.CopyOptionsFrom=function(r){if(r===this){return}var q=this.options,p=r.options;q.Mode3D=p.Mode3D;q.Zero=p.Zero;if(p.Mode3D){q.Lego=p.Lego;q.Surf=p.Surf}else{q.Color=p.Color;q.Contour=p.Contour}};m.prototype.CopyOptionsToOthers=function(){var p=this;this.ForEachPainter(function(q){if(q===p){return}if(typeof q.CopyOptionsFrom=="function"){q.CopyOptionsFrom(p)}},"objects")};m.prototype.ScanContent=function(p){alert("HistPainter.prototype.ScanContent not implemented")};m.prototype.CheckPadRange=function(p){if(this.is_main_painter()){this.check_pad_range=p?"pad_range":true}};m.prototype.CheckHistDrawAttributes=function(){var q=this.GetHisto(),p=this.pad_painter();if(p&&(this.options._pfc||this.options._plc||this.options._pmc)){var r=p.CreateAutoColor();if(this.options._pfc){q.fFillColor=r;delete this.fillatt}if(this.options._plc){q.fLineColor=r;delete this.lineatt}if(this.options._pmc){q.fMarkerColor=r;delete this.markeratt}this.options._pfc=this.options._plc=this.options._pmc=false}this.createAttFill({attr:q,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:q,color0:this.options.histoLineColor})};m.prototype.UpdateObject=function(v,q){var u=this.GetHisto(),z=this.frame_painter();if(v!==u){if(!this.MatchObjectType(v)){return false}if(u.TestBit(g.TH1StatusBits.kNoStats)!=v.TestBit(g.TH1StatusBits.kNoStats)){u.fBits=v.fBits;var w=this.FindPainterFor(this.FindStat());if(w){w.Enabled=!u.TestBit(g.TH1StatusBits.kNoStats)}}if(this.snapid!==undefined){u.fName=v.fName}u.fFillColor=v.fFillColor;u.fFillStyle=v.fFillStyle;u.fLineColor=v.fLineColor;u.fLineStyle=v.fLineStyle;u.fLineWidth=v.fLineWidth;u.fEntries=v.fEntries;u.fTsumw=v.fTsumw;u.fTsumwx=v.fTsumwx;u.fTsumwx2=v.fTsumwx2;u.fXaxis.fNbins=v.fXaxis.fNbins;if(this.Dimension()>1){u.fTsumwy=v.fTsumwy;u.fTsumwy2=v.fTsumwy2;u.fTsumwxy=v.fTsumwxy;u.fYaxis.fNbins=v.fYaxis.fNbins;if(this.Dimension()>2){u.fTsumwz=v.fTsumwz;u.fTsumwz2=v.fTsumwz2;u.fTsumwxz=v.fTsumwxz;u.fTsumwyz=v.fTsumwyz;u.fZaxis.fNbins=v.fZaxis.fNbins}}u.fArray=v.fArray;u.fNcells=v.fNcells;u.fTitle=v.fTitle;u.fMinimum=v.fMinimum;u.fMaximum=v.fMaximum;function x(B,A){B.fTitle=A.fTitle;B.fLabels=A.fLabels;B.fXmin=A.fXmin;B.fXmax=A.fXmax}x(u.fXaxis,v.fXaxis);x(u.fYaxis,v.fYaxis);x(u.fZaxis,v.fZaxis);if(!z.zoom_changed_interactive){function t(B,A){B.fFirst=A.fFirst;B.fLast=A.fLast;B.fBits=A.fBits}t(u.fXaxis,v.fXaxis);t(u.fYaxis,v.fYaxis);t(u.fZaxis,v.fZaxis)}u.fSumw2=v.fSumw2;if(this.IsTProfile()){u.fBinEntries=v.fBinEntries}if(this.IsTH1K()){u.fNIn=v.fNIn;u.fReady=false}this.DecomposeTitle();if(v.fFunctions&&this.options.Func){for(var r=0;r<v.fFunctions.arr.length;++r){var s=v.fFunctions.arr[r];if(!s||!s._typename){continue}var p=s.fName?this.FindPainterFor(null,s.fName,s._typename):null;if(p){p.UpdateObject(s)}else{if((s._typename!="TPaletteAxis")&&(s._typename!="TPaveStats")){console.log("Get "+s._typename+" in histogram functions list, need to use?")}}}}var y=(u.fOption!=v.fOption);u.fOption=v.fOption;if(((q!==undefined)&&(this.options.original!==q))||y){this.DecodeOptions(q||u.fOption)}}this.ScanContent();this.histogram_updated=true;return true};m.prototype.CreateAxisFuncs=function(s,r){var p=this.GetHisto();function q(t){if(t.fXbins.length>=t.fNbins){t.regular=false;t.GetBinCoord=function(v){var w=Math.round(v);if(w<=0){return this.fXmin}if(w>this.fNbins){return this.fXmax}if(w==v){return this.fXbins[w]}var u=(v<w)?w-1:w+1;return this.fXbins[w]*Math.abs(v-u)+this.fXbins[u]*Math.abs(v-w)};t.FindBin=function(u,w){for(var v=1;v<this.fXbins.length;++v){if(u<this.fXbins[v]){return Math.floor(v-1+w)}}return this.fNbins}}else{t.regular=true;t.binwidth=(t.fXmax-t.fXmin)/(t.fNbins||1);t.GetBinCoord=function(u){return this.fXmin+u*this.binwidth};t.FindBin=function(u,v){return Math.floor((u-this.fXmin)/this.binwidth+v)}}}this.xmin=p.fXaxis.fXmin;this.xmax=p.fXaxis.fXmax;q(p.fXaxis);this.ymin=p.fYaxis.fXmin;this.ymax=p.fYaxis.fXmax;if(!s||(this.nbinsy==0)){return}q(p.fYaxis);if(!r||(this.nbinsz==0)){return}q(p.fZaxis)};m.prototype.CreateXY=function(){if(!this.is_main_painter()){return}var p=this.GetHisto(),q=this.frame_painter();if(!q){return console.warn("histogram drawn without frame - not supported")}if(this.ymin===this.ymax){this.ymax+=1}q.SetAxesRanges(p.fXaxis,this.xmin,this.xmax,p.fYaxis,this.ymin,this.ymax,p.fZaxis,0,0);q.CreateXY({ndim:this.Dimension(),check_pad_range:this.check_pad_range,create_canvas:this.create_canvas,ymin_nz:this.ymin_nz,swap_xy:(this.options.BarStyle>=20),reverse_x:this.options.RevX,reverse_y:this.options.RevY,Proj:this.options.Proj,extra_y_space:this.options.Text&&(this.options.BarStyle>0)});delete this.check_pad_range};m.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};m.prototype.DrawAxes=function(){if(!this.is_main_painter()||this.options.Same){return}var p=this.frame_painter();if(!p){return}p.DrawAxes(false,this.options.Axis<0,this.options.AxisPos,this.options.Zscale);p.DrawGrids()};m.prototype.ToggleTitle=function(p){var q=this.GetHisto();if(!this.is_main_painter()||!q){return false}if(p==="only-check"){return !q.TestBit(g.TH1StatusBits.kNoTitle)}q.InvertBit(g.TH1StatusBits.kNoTitle);this.DrawTitle()};m.prototype.DecomposeTitle=function(){var q=this.GetHisto();if(!q||!q.fTitle){return}var p=q.fTitle.split(";");if(p.length===3){q.fTitle=p[0];q.fXaxis.fTitle=p[1];q.fYaxis.fTitle=p[2]}};m.prototype.DrawTitle=function(){if(!this.is_main_painter()||this.options.Same){return}var r=this.GetHisto(),q=this.FindPainterFor(null,"title"),s=q?q.GetObject():null;if(!s){s=this.FindInPrimitives("title")}if(s&&(s._typename!=="TPaveText")){s=null}var p=!r.TestBit(g.TH1StatusBits.kNoTitle)&&(g.gStyle.fOptTitle>0);if(s){s.Clear();if(p){s.AddText(r.fTitle)}if(q){q.Redraw()}}else{if(p&&!q&&r.fTitle){s=g.Create("TPaveText");g.extend(s,{fName:"title",fX1NDC:0.28,fY1NDC:0.94,fX2NDC:0.72,fY2NDC:0.99});s.AddText(r.fTitle);q=g.Painter.drawPave(this.divid,s);if(q){q.$secondary=true}}}};m.prototype.processTitleChange=function(p){var r=this.GetHisto(),q=this.FindPainterFor(null,"title");if(!r||!q){return null}if(p==="check"){return(!this.is_main_painter()||this.options.Same)?null:r}var s=q.GetObject();s.Clear();s.AddText(r.fTitle);q.Redraw()};m.prototype.UpdateStatWebCanvas=function(){if(!this.snapid){return}var p=this.FindStat(),q=this.FindPainterFor(p);if(q&&!q.snapid){q.Redraw()}};m.prototype.ToggleStat=function(p){var q=this.FindStat(),r=null;if(!p){p=""}if(q==null){if(p.indexOf("-check")>0){return false}q=this.CreateStat(true)}else{r=this.FindPainterFor(q)}if(p=="only-check"){return r?r.Enabled:false}if(p=="fitpar-check"){return q?q.fOptFit:false}if(p=="fitpar-toggle"){if(!q){return false}q.fOptFit=q.fOptFit?0:1111;if(r){r.Redraw()}return true}if(r){r.Enabled=!r.Enabled;r.Redraw();return r.Enabled}g.draw(this.divid,q,"onpad:"+this.pad_name);return true};m.prototype.GetSelectIndex=function(q,v,x){var u=0,s=this.frame_painter(),r=this["nbins"+q]||0,p=this.GetAxis(q),t=s?s["zoom_"+q+"min"]:0,w=s?s["zoom_"+q+"max"]:0;if((t!==w)&&p){if(v=="left"){u=p.FindBin(t,x||0)}else{u=p.FindBin(w,(x||0)+0.5)}if(u<0){u=0}else{if(u>r){u=r}}}else{u=(v=="left")?0:r}if(p){if((p.fFirst===p.fLast)||!p.TestBit(g.EAxisBits.kAxisRange)||((p.fFirst<=1)&&(p.fLast>=r))){p=undefined}}if(v=="left"){if(u<0){u=0}if(p&&(p.fFirst>1)&&(u<p.fFirst)){u=p.fFirst-1}}else{if(u>r){u=r}if(p&&(p.fLast<=r)&&(u>p.fLast)){u=p.fLast}}return u};m.prototype.FindFunction=function(t,p){var r=this.GetObject(),q=r&&r.fFunctions?r.fFunctions.arr:null;if(!q){return null}for(var s=0;s<q.length;++s){if(p&&(q[s].fName!==p)){continue}if(q[s]._typename===t){return q[s]}}return null};m.prototype.FindStat=function(){return this.FindFunction("TPaveStats","stats")};m.prototype.IgnoreStatsFill=function(){return !this.GetObject()||(!this.draw_content&&!this.create_stats)||(this.options.Axis>0)};m.prototype.CreateStat=function(s){if(!s&&!this.options.ForceStat){if(this.options.NoStat||this.histo.TestBit(g.TH1StatusBits.kNoStats)||!g.gStyle.AutoStat){return null}if(!this.draw_content||!this.is_main_painter()){return null}}this.create_stats=true;var r=this.FindStat(),q=g.gStyle,p=this.options.optstat,t=this.options.optfit;if(p!==undefined){if(r){r.fOptStat=p}delete this.options.optstat}else{p=this.histo.$custom_stat||q.fOptStat}if(t!==undefined){if(r){r.fOptFit=t}delete this.options.optfit}else{t=q.fOptFit}if(r){return r}r=g.Create("TPaveStats");g.extend(r,{fName:"stats",fOptStat:p,fOptFit:t,fBorderSize:1});r.fX1NDC=q.fStatX-q.fStatW;r.fY1NDC=q.fStatY-q.fStatH;r.fX2NDC=q.fStatX;r.fY2NDC=q.fStatY;r.fFillColor=q.fStatColor;r.fFillStyle=q.fStatStyle;r.fTextAngle=0;r.fTextSize=q.fStatFontSize;r.fTextAlign=12;r.fTextColor=q.fStatTextColor;r.fTextFont=q.fStatFont;if(this.histo._typename.match(/^TProfile/)||this.histo._typename.match(/^TH2/)){r.fY1NDC=0.67}r.AddText(this.histo.fName);this.AddFunction(r);return r};m.prototype.AddFunction=function(r,q){var p=this.GetObject();if(!p||!r){return}if(!p.fFunctions){p.fFunctions=g.Create("TList")}if(q){p.fFunctions.AddFirst(r)}else{p.fFunctions.Add(r)}};m.prototype.DrawNextFunction=function(t,u){if(!this.options.Func||!this.histo.fFunctions||(t>=this.histo.fFunctions.arr.length)){return g.CallBack(u)}var s=this.histo.fFunctions.arr[t],p=this.histo.fFunctions.opt[t],r=false,q=this.FindPainterFor(s);if(q===null){if(s._typename==="TPaveText"||s._typename==="TPaveStats"){r=!this.histo.TestBit(g.TH1StatusBits.kNoStats)&&!this.options.NoStat}else{if(s._typename==="TF1"){r=!s.TestBit(g.BIT(9))}else{r=(s._typename!=="TPaletteAxis")}}}if(r){return g.draw(this.divid,s,p,this.DrawNextFunction.bind(this,t+1,u))}this.DrawNextFunction(t+1,u)};m.prototype.UnzoomUserRange=function(v,u,t){if(!this.histo){return false}var s=false,q=this;function r(w){if(!w){return false}if(!w.TestBit(g.EAxisBits.kAxisRange)){return false}if(w.fFirst===w.fLast){return false}if((w.fFirst<=1)&&(w.fLast>=w.fNbins)){return false}w.InvertBit(g.EAxisBits.kAxisRange);return true}function p(x,w){if(q.Dimension()!==x){return false}if((q.options.minimum===-1111)&&(q.options.maximum===-1111)){return false}if(!q.draw_content){return false}q.options.minimum=q.options.maximum=-1111;q.ScanContent(true);return true}if(v&&r(this.histo.fXaxis)){s=true}if(u&&(r(this.histo.fYaxis)||p(1,this.histo))){s=true}if(t&&(r(this.histo.fZaxis)||p(2,this.histo))){s=true}return s};m.prototype.AllowDefaultYZooming=function(){if(this.Dimension()>1){return true}if(this.draw_content){return false}var r=this.pad_painter();if(r&&r.painters){for(var q=0;q<r.painters.length;++q){var p=r.painters[q];if((p!==this)&&p.wheel_zoomy!==undefined){return p.wheel_zoomy}}}return false};m.prototype.ShowAxisStatus=function(s){var r=this.GetShowStatusFunc();if(!r){return}var t=this.histo?this.histo["f"+s.toUpperCase()+"axis"]:null;var w=s,q="TAxis";if(t){w=t.fName;q=t.fTitle||"histogram TAxis object"}var p=o.mouse(this.svg_frame().node());var v=(s=="x")?0:1;if(this.swap_xy){v=1-v}var u=(s=="x")?this.RevertX(p[v]):this.RevertY(p[v]);r(w,q,s+" : "+this.AxisAsText(s,u),p[0].toFixed(0)+","+p[1].toFixed(0))};m.prototype.AddInteractive=function(){if(this.is_main_painter()){var p=this.frame_painter();if(p){p.AddInteractive()}}};m.prototype.ShowContextMenu=function(w,D,x){var B=this,y=false,z=null;if(!D){o.event.preventDefault();o.event.stopPropagation();D=o.event;if(w===undefined){var q=o.mouse(this.svg_frame().node()),v=o.touches(this.svg_frame().node()),t=this.pad_painter(),p=null,s=null;z=this.frame_painter();if(v.length===1){p={x:v[0][0],y:v[0][1],touch:true}}else{if(q.length===2){p={x:q[0],y:q[1],touch:false}}}if((p!==null)&&(t!==null)){p.painters=true;var r=t.GetTooltips(p),C=1000;for(var u=0;u<r.length;++u){if(r[u]&&r[u].menu){var A=("menu_dist" in r[u])?r[u].menu_dist:7;if(A<C){s=r[u].painter;C=A}}}}if(s!==null){B=s}else{if(z!==null){w="frame"}}if(p!==null){y=(p.x>0)&&(p.x<20)&&(p.y>0)&&(p.y<20)}if(z){z.SetLastEventPos(p)}}}B.ctx_menu_evnt=D;g.Painter.createMenu(B,function(F){var E=F.painter.FillContextMenu(F,w,x);if(z&&(!E||(y&&(w!=="frame")))){E=z.FillContextMenu(F)}if(E){F.painter.FillObjectExecMenu(F,w,function(){F.painter.SwitchTooltip(false);F.show(F.painter.ctx_menu_evnt,F.painter.SwitchTooltip.bind(F.painter,true))})}})};m.prototype.ChangeUserRange=function(p){var t=this.histo["f"+p+"axis"];if(!t){return}var s="[1,"+t.fNbins+"]";if(t.TestBit(g.EAxisBits.kAxisRange)){s="["+t.fFirst+","+t.fLast+"]"}var r=prompt("Enter user range for axis "+p+" like [1,"+t.fNbins+"]",s);if(!r){return}r=JSON.parse(r);if(!r||(r.length!=2)||isNaN(r[0])||isNaN(r[1])){return}t.fFirst=parseInt(r[0]);t.fLast=parseInt(r[1]);var q=(t.fFirst<t.fLast)&&(t.fFirst>=1)&&(t.fLast<=t.fNbins);if(q!=t.TestBit(g.EAxisBits.kAxisRange)){t.InvertBit(g.EAxisBits.kAxisRange)}this.Redraw()};m.prototype.FillContextMenu=function(s){var q=this.GetHisto(),r=this.frame_painter();if(!q){return}s.add("header:"+q._typename+"::"+q.fName);if(this.draw_content){s.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()});if(this.Dimension()==1){s.add("User range X","X",this.ChangeUserRange)}else{s.add("sub:User ranges");s.add("X","X",this.ChangeUserRange);s.add("Y","Y",this.ChangeUserRange);if(this.Dimension()>2){s.add("Z","Z",this.ChangeUserRange)}s.add("endsub:")}if(typeof this.FillHistContextMenu=="function"){this.FillHistContextMenu(s)}}if(this.options.Mode3D){if(s.size()>0){s.add("separator")}var p=this.main_painter()||this;s.addchk(r.tooltip_allowed,"Show tooltips",function(){r.tooltip_allowed=!r.tooltip_allowed});s.addchk(r.enable_highlight,"Highlight bins",function(){r.enable_highlight=!r.enable_highlight;if(!r.enable_highlight&&r.BinHighlight3D&&r.mode3d){r.BinHighlight3D(null)}});if(r&&r.Render3D){s.addchk(p.options.FrontBox,"Front box",function(){p.options.FrontBox=!p.options.FrontBox;r.Render3D()});s.addchk(p.options.BackBox,"Back box",function(){p.options.BackBox=!p.options.BackBox;r.Render3D()})}if(this.draw_content){s.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.InteractiveRedraw("pad")});if((this.options.Lego==12)||(this.options.Lego==14)){s.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()});if(this.FillPaletteMenu){this.FillPaletteMenu(s)}}}if(p.control&&typeof p.control.reset==="function"){s.add("Reset camera",function(){p.control.reset()})}}this.FillAttContextMenu(s);if(this.histogram_updated&&r.zoom_changed_interactive){s.add("Let update zoom",function(){r.zoom_changed_interactive=0})}return true};m.prototype.ButtonClick=function(p){var q=this.frame_painter();if(!this.is_main_painter()||!q){return false}switch(p){case"ToggleZoom":if((q.zoom_xmin!==q.zoom_xmax)||(q.zoom_ymin!==q.zoom_ymax)||(q.zoom_zmin!==q.zoom_zmax)){q.Unzoom();return true}if(this.draw_content&&(typeof this.AutoZoom==="function")){this.AutoZoom();return true}break;case"ToggleLogX":q.ToggleLog("x");break;case"ToggleLogY":q.ToggleLog("y");break;case"ToggleLogZ":q.ToggleLog("z");break;case"ToggleStatBox":this.ToggleStat();return true;break}return false};m.prototype.FillToolbar=function(q){var p=this.pad_painter();if(!p){return}p.AddButton(g.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *");p.AddButton(g.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown");p.AddButton(g.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp");if(this.Dimension()>1){p.AddButton(g.ToolbarIcons.arrow_diag,"Toggle log z","ToggleLogZ")}if(this.draw_content){p.AddButton(g.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox")}if(!q){p.ShowButtons()}};m.prototype.Get3DToolTip=function(p){var q={bin:p,name:this.GetObject().fName,title:this.GetObject().fTitle};switch(this.Dimension()){case 1:q.ix=p;q.iy=1;q.value=this.histo.getBinContent(q.ix);q.error=this.histo.getBinError(p);q.lines=this.GetBinTips(p-1);break;case 2:q.ix=p%(this.nbinsx+2);q.iy=(p-q.ix)/(this.nbinsx+2);q.value=this.histo.getBinContent(q.ix,q.iy);q.error=this.histo.getBinError(p);q.lines=this.GetBinTips(q.ix-1,q.iy-1);break;case 3:q.ix=p%(this.nbinsx+2);q.iy=((p-q.ix)/(this.nbinsx+2))%(this.nbinsy+2);q.iz=(p-q.ix-q.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2);q.value=this.GetObject().getBinContent(q.ix,q.iy,q.iz);q.error=this.histo.getBinError(p);q.lines=this.GetBinTips(q.ix-1,q.iy-1,q.iz-1);break}return q};m.prototype.CreateContour=function(r,s,v,u){if(r<1){r=g.gStyle.fNumberContours}this.fContour=[];this.colzmin=s;this.colzmax=v;if(this.root_pad().fLogz){if(this.colzmax<=0){this.colzmax=1}if(this.colzmin<=0){if((u===undefined)||(u<=0)){this.colzmin=0.0001*this.colzmax}else{this.colzmin=((u<3)||(u>100))?0.3*u:1}}if(this.colzmin>=this.colzmax){this.colzmin=0.0001*this.colzmax}var x=Math.log(this.colzmin)/Math.log(10),q=Math.log(this.colzmax)/Math.log(10),w=(q-x)/r;this.fContour.push(this.colzmin);for(var p=1;p<r;p++){this.fContour.push(Math.exp((x+w*p)*Math.log(10)))}this.fContour.push(this.colzmax);this.fCustomContour=true}else{if((this.colzmin===this.colzmax)&&(this.colzmin!==0)){this.colzmax+=0.01*Math.abs(this.colzmax);this.colzmin-=0.01*Math.abs(this.colzmin)}var w=(this.colzmax-this.colzmin)/r;for(var p=0;p<=r;p++){this.fContour.push(this.colzmin+w*p)}}var t=this.frame_painter();if((this.Dimension()<3)&&t){t.zmin=this.colzmin;t.zmax=this.colzmax}return this.fContour};m.prototype.GetContour=function(){if(this.fContour){return this.fContour}var p=this.main_painter(),s=this.frame_painter();if((p!==this)&&p.fContour){this.fContour=p.fContour;this.fCustomContour=p.fCustomContour;this.colzmin=p.colzmin;this.colzmax=p.colzmax;return this.fContour}var r=this.GetObject(),v=g.gStyle.fNumberContours,q=this.minbin,u=this.maxbin,t=this.minposbin;if(q===u){q=this.gminbin;u=this.gmaxbin;t=this.gminposbin}if(r.fContour){v=r.fContour.length}if((this.options.minimum!==-1111)&&(this.options.maximum!=-1111)){q=this.options.minimum;u=this.options.maximum}if(s&&(s.zoom_zmin!=s.zoom_zmax)){q=s.zoom_zmin;u=s.zoom_zmax}if(r.fContour&&(r.fContour.length>1)&&r.TestBit(g.TH1StatusBits.kUserContour)){this.fContour=g.clone(r.fContour);this.fCustomContour=true;this.colzmin=q;this.colzmax=u;if(u>this.fContour[this.fContour.length-1]){this.fContour.push(u)}if((this.Dimension()<3)&&s){s.zmin=this.colzmin;s.zmax=this.colzmax}return this.fContour}this.fCustomContour=false;return this.CreateContour(v,q,u,t)};m.prototype.getContourIndex=function(q){var u=this.GetContour();if(this.fCustomContour){var p=0,t=u.length-1,s;if(q<u[0]){return -1}if(q>=u[t]){return t}while(p<t-1){s=Math.round((p+t)/2);if(u[s]>q){t=s}else{p=s}}return p}if(q<this.colzmin){return this.options.Zero?-1:0}if(q===this.colzmin){return((this.colzmin!=0)||!this.options.Zero||this.IsTH2Poly())?0:-1}return Math.floor(0.01+(q-this.colzmin)*(u.length-1)/(this.colzmax-this.colzmin))};m.prototype.getContourColor=function(r,u){var q=this.getContourIndex(r);if(q<0){return null}var t=this.GetContour(),p=this.GetPalette(),s=p.calcColorIndex(q,t.length);return u?s:p.getColor(s)};m.prototype.GetPalette=function(q){if(!this.fPalette||q){var p=this.options.Palette?null:this.canv_painter();this.fPalette=(p&&p.CanvasPalette)?p.CanvasPalette:g.Painter.GetColorPalette(this.options.Palette)}return this.fPalette};m.prototype.FillPaletteMenu=function(s){var r=this.options.Palette,p=this;if((r===null)||(r===0)){r=g.gStyle.Palette}function t(u){p.options.Palette=parseInt(u);p.GetPalette(true);p.Redraw()}function q(w,u,v){s.addchk((w===r)||v,"<nobr>"+u+"</nobr>",w,t)}s.add("sub:Palette");q(50,"ROOT 5",(r>=10)&&(r<51));q(51,"Deep Sea");q(52,"Grayscale",(r>0)&&(r<10));q(53,"Dark body radiator");q(54,"Two-color hue");q(55,"Rainbow");q(56,"Inverted dark body radiator");q(57,"Bird",(r>113));q(58,"Cubehelix");q(59,"Green Red Violet");q(60,"Blue Red Yellow");q(61,"Ocean");q(62,"Color Printable On Grey");q(63,"Alpine");q(64,"Aquamarine");q(65,"Army");q(66,"Atlantic");s.add("endsub:")};m.prototype.DrawColorPalette=function(t,q,s){if(!this.is_main_painter()){return null}var w=this.FindFunction("TPaletteAxis"),p=this.FindPainterFor(w);if(this._can_move_colz){s=true;delete this._can_move_colz}if(!p&&!w){p=this.FindPainterFor(undefined,undefined,"TPaletteAxis");if(p){w=p.GetObject();this.AddFunction(w,true)}}if(!t){if(p){p.Enabled=false;p.RemoveDrawG()}return null}if(!w){w=g.Create("TPave");g.extend(w,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:g.Create("TGaxis"),fX1NDC:0.91,fX2NDC:0.95,fY1NDC:0.1,fY2NDC:0.9,fInit:1});var u=this.GetHisto().fZaxis;g.extend(w.fAxis,{fTitle:u.fTitle,fTitleSize:u.fTitleSize,fTextColor:u.fTitleColor,fChopt:"+",fLineColor:u.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:u.fLabelSize,fTextAlign:11,fTextColor:u.fLabelColor,fTextFont:u.fLabelFont});this.AddFunction(w,true);s=true}else{if(w.fAxis){if(!w.fAxis.fChopt){w.fAxis.fChopt="+"}if(!w.fAxis.fNdiv){w.fAxis.fNdiv=12}if(!w.fAxis.fLabelOffset){w.fAxis.fLabelOffset=0.005}}}var v=this.frame_painter();if(s&&v){w.fX2NDC=v.fX2NDC+0.01+(w.fX2NDC-w.fX1NDC);w.fX1NDC=v.fX2NDC+0.01;w.fY1NDC=v.fY1NDC;w.fY2NDC=v.fY2NDC}var x="";if(q){x+=";postpone"}if(s&&!this.do_redraw_palette){x+=";canmove"}if(p===null){var r=this.CurrentPadName(this.pad_name);p=g.draw(this.divid,w,x);this.CurrentPadName(r)}else{p.Enabled=true;p.DrawPave(x)}p.$secondary=true;p.Redraw=function(){};if(s&&v&&(w.fX1NDC-0.005<v.fX2NDC)&&!this.do_redraw_palette){this.do_redraw_palette=true;v.fX2NDC=w.fX1NDC-0.01;v.Redraw();if(!q){this.Redraw()}delete this.do_redraw_palette}return p};m.prototype.ToggleColz=function(){var p=this.options.Mode3D?(this.options.Lego===12||this.options.Lego===14||this.options.Surf===11||this.options.Surf===12):this.options.Color||this.options.Contour;if(p){this.options.Zscale=!this.options.Zscale;this.DrawColorPalette(this.options.Zscale,false,true)}};m.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;if(this.options.Mode3D){if(!this.options.Surf&&!this.options.Lego&&!this.options.Error){if((this.nbinsx>=50)||(this.nbinsy>=50)){this.options.Lego=this.options.Color?14:13}else{this.options.Lego=this.options.Color?12:1}this.options.Zero=false}}this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};m.prototype.PrepareColorDraw=function(v){if(!v){v={rounding:true,extra:0,middle:0}}if(v.extra===undefined){v.extra=0}if(v.middle===undefined){v.middle=0}var r=this.GetHisto(),D=r.fXaxis,A=r.fYaxis,t=this.frame_painter(),p=this.Dimension(),s,q,B,z,w,C,u={i1:this.GetSelectIndex("x","left",0-v.extra),i2:this.GetSelectIndex("x","right",1+v.extra),j1:(p===1)?0:this.GetSelectIndex("y","left",0-v.extra),j2:(p===1)?1:this.GetSelectIndex("y","right",1+v.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};u.grx=new Float32Array(u.i2+1);u.gry=new Float32Array(u.j2+1);if(typeof r.fBarOffset=="number"&&typeof r.fBarWidth=="number"&&(r.fBarOffset||r.fBarWidth!==1000)){if(r.fBarOffset<=1000){u.xbar1=u.ybar1=0.001*r.fBarOffset}else{if(r.fBarOffset<=3000){u.xbar1=0.001*(r.fBarOffset-2000)}else{if(r.fBarOffset<=5000){u.ybar1=0.001*(r.fBarOffset-4000)}}}if(r.fBarWidth<=1000){u.xbar2=Math.min(1,u.xbar1+0.001*r.fBarWidth);u.ybar2=Math.min(1,u.ybar1+0.001*r.fBarWidth)}else{if(r.fBarWidth<=3000){u.xbar2=Math.min(1,u.xbar1+0.001*(r.fBarWidth-2000))}else{if(r.fBarWidth<=5000){u.ybar2=Math.min(1,u.ybar1+0.001*(r.fBarWidth-4000))}}}}if(v.original){u.original=true;u.origx=new Float32Array(u.i2+1);u.origy=new Float32Array(u.j2+1)}if(v.pixel_density){v.rounding=true}if(!t){console.warn("cannot draw histogram without frame");return u}for(s=u.i1;s<=u.i2;++s){B=D.GetBinCoord(s+v.middle);if(t.logx&&(B<=0)){u.i1=s+1;continue}if(u.origx){u.origx[s]=B}u.grx[s]=t.grx(B);if(v.rounding){u.grx[s]=Math.round(u.grx[s])}if(v.use3d){if(u.grx[s]<-t.size_xy3d){u.i1=s;u.grx[s]=-t.size_xy3d}if(u.grx[s]>t.size_xy3d){u.i2=s;u.grx[s]=t.size_xy3d}}}if(p===1){u.gry[0]=t.gry(0);u.gry[1]=t.gry(1)}else{for(q=u.j1;q<=u.j2;++q){z=A.GetBinCoord(q+v.middle);if(t.logy&&(z<=0)){u.j1=q+1;continue}if(u.origy){u.origy[q]=z}u.gry[q]=t.gry(z);if(v.rounding){u.gry[q]=Math.round(u.gry[q])}if(v.use3d){if(u.gry[q]<-t.size_xy3d){u.j1=q;u.gry[q]=-t.size_xy3d}if(u.gry[q]>t.size_xy3d){u.j2=q;u.gry[q]=t.size_xy3d}}}}w=r.getBinContent(u.i1+1,u.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(s=u.i1;s<u.i2;++s){for(q=u.j1;q<u.j2;++q){w=r.getBinContent(s+1,q+1);u.sumz+=w;if(v.pixel_density){C=(u.grx[s+1]-u.grx[s])*(u.gry[q]-u.gry[q+1]);if(C<=0){continue}u.max=Math.max(u.max,w);if((w>0)&&((w<u.min)||(u.min===0))){u.min=w}w=w/C}if(this.maxbin===null){this.maxbin=this.minbin=w}else{this.maxbin=Math.max(this.maxbin,w);this.minbin=Math.min(this.minbin,w)}if(w>0){if((this.minposbin===null)||(w<this.minposbin)){this.minposbin=w}}}}this.fContour=null;this.fCustomContour=false;return u};function e(p){m.call(this,p)}e.prototype=Object.create(m.prototype);e.prototype.ConvertTH1K=function(){var q=this.GetObject();if(q.fReady){return}var p=q.fArray;q.fNcells=q.fXaxis.fNbins+2;q.fArray=new Float64Array(q.fNcells);for(var r=0;r<q.fNcells;++r){q.fArray[r]=0}for(var r=0;r<q.fNIn;++r){q.Fill(p[r])}q.fReady=true};e.prototype.ScanContent=function(y){if(!this.nbinsx&&y){y=false}if(this.IsTH1K()){this.ConvertTH1K()}if(!y){this.nbinsx=this.histo.fXaxis.fNbins;this.nbinsy=0;this.CreateAxisFuncs(false)}var r=this.GetSelectIndex("x","left"),B=this.GetSelectIndex("x","right");if(y){if((r===this.scan_xleft)&&(B===this.scan_xright)){return}}this.draw_content=true;if(this.options.Axis>0){this.draw_content=false}this.scan_xleft=r;this.scan_xright=B;var s=0,p=0,z=0,w=0,x=true,q=this.IsTProfile(),A,t;for(var v=0;v<this.nbinsx;++v){A=this.histo.getBinContent(v+1);w+=q?this.histo.fBinEntries[v+1]:A;if((v<r)||(v>=B)){continue}if((A>0)&&((p==0)||(A<p))){p=A}if(x){s=z=A;x=false}t=this.options.Error?this.histo.getBinError(v+1):0;s=Math.min(s,A-t);z=Math.max(z,A+t)}if(q){w+=this.histo.fBinEntries[0]+this.histo.fBinEntries[this.nbinsx+1]}else{w+=this.histo.getBinContent(0)+this.histo.getBinContent(this.nbinsx+1)}this.stat_entries=w;if(this.histo.fEntries>1){this.stat_entries=this.histo.fEntries}this.hmin=s;this.hmax=z;this.ymin_nz=p;if((this.nbinsx==0)||((Math.abs(s)<1e-300&&Math.abs(z)<1e-300))){this.draw_content=false;s=this.ymin;z=this.ymax}if(this.draw_content){if(s>=z){if(s==0){this.ymin=0;this.ymax=1}else{if(s<0){this.ymin=2*s;this.ymax=0}else{this.ymin=0;this.ymax=s*2}}}else{var C=(z-s)*0.05;this.ymin=s-C;if((this.ymin<0)&&(s>=0)){this.ymin=0}this.ymax=z+C}}s=this.options.minimum;z=this.options.maximum;var u=false;if((s===z)&&(s!==-1111)){s=s<0?2*s:0;z=z<0?0:2*z}if((s!=-1111)&&(z!=-1111)&&!this.draw_content){this.ymin=s;this.ymax=z}else{if(s!=-1111){if(s<this.ymin){this.ymin=s}else{u=true}}if(z!=-1111){if(z>this.ymax){this.ymax=z}else{u=true}}}if(u&&this.draw_content){this.zoom_ymin=(s==-1111)?this.ymin:s;this.zoom_ymax=(z==-1111)?this.ymax:z}if(this.Dimension()>1){this.wheel_zoomy=true}else{if(this.draw_content){this.wheel_zoomy=false}}};e.prototype.CountStat=function(v){var q=this.IsTProfile(),A=this.GetHisto(),p=A.fXaxis,r=this.GetSelectIndex("x","left"),F=this.GetSelectIndex("x","right"),D=0,z=0,B=0,y=0,G=0,E,s=0,u=0,C=null,x=null,t=this.frame_painter(),H={name:A.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(E=r;E<F;++E){s=p.GetBinCoord(E+0.5);if(v&&!v(s)){continue}if(q){u=A.fBinEntries[E+1];y+=A.fArray[E+1];G+=A.fSumw2[E+1]}else{u=A.getBinContent(E+1)}if((C===null)||(u>x)){C=s;x=u}D+=u;z+=u*s;B+=u*s*s}if(!t.IsAxisZoomed("x")&&(A.fTsumw>0)){D=A.fTsumw;z=A.fTsumwx;B=A.fTsumwx2}H.integral=D;if(D>0){H.meanx=z/D;H.meany=y/D;H.rmsx=Math.sqrt(Math.abs(B/D-H.meanx*H.meanx));H.rmsy=Math.sqrt(Math.abs(G/D-H.meany*H.meany))}if(C!==null){H.xmax=C;H.wmax=x}return H};e.prototype.FillStatistic=function(u,v,B){if(this.IgnoreStatsFill()){return false}var t=this.CountStat(),y=v%10,z=Math.floor(v/10)%10,x=Math.floor(v/100)%10,A=Math.floor(v/1000)%10,p=Math.floor(v/10000)%10,q=Math.floor(v/100000)%10,r=Math.floor(v/1000000)%10,w=Math.floor(v/10000000)%10,s=Math.floor(v/100000000)%10;u.ClearPave();if(y>0){u.AddText(t.name)}if(this.IsTProfile()){if(z>0){u.AddText("Entries = "+u.Format(t.entries,"entries"))}if(x>0){u.AddText("Mean = "+u.Format(t.meanx));u.AddText("Mean y = "+u.Format(t.meany))}if(A>0){u.AddText("Std Dev = "+u.Format(t.rmsx));u.AddText("Std Dev y = "+u.Format(t.rmsy))}}else{if(z>0){u.AddText("Entries = "+u.Format(t.entries,"entries"))}if(x>0){u.AddText("Mean = "+u.Format(t.meanx))}if(A>0){u.AddText("Std Dev = "+u.Format(t.rmsx))}if(p>0){u.AddText("Underflow = "+u.Format((this.histo.fArray.length>0)?this.histo.fArray[0]:0,"entries"))}if(q>0){u.AddText("Overflow = "+u.Format((this.histo.fArray.length>0)?this.histo.fArray[this.histo.fArray.length-1]:0,"entries"))}if(r>0){u.AddText("Integral = "+u.Format(t.integral,"entries"))}if(w>0){u.AddText("Skew = <not avail>")}if(s>0){u.AddText("Kurt = <not avail>")}}if(B){u.FillFunctionStat(this.FindFunction("TF1"),B)}return true};e.prototype.DrawBars=function(J,H){this.CreateG(true);var t=this.GetSelectIndex("x","left",-1),R=this.GetSelectIndex("x","right",1),A=this.frame_painter(),Q=this.root_pad(),G=this.GetHisto(),r=G.fXaxis,u=this,x=this.options.Text,q,z,C,L,O,M,v,s,B,F,E,D,I="",P="",K="",p=(this.options.BarStyle>10)?this.options.BarStyle%10:0;if(p>4){p=4}E=A.swap_xy?0:H;if((this.options.BaseLine!==false)&&!isNaN(this.options.BaseLine)){if(this.options.BaseLine>=A.scale_ymin){E=Math.round(A.gry(this.options.BaseLine))}}if(x){q=this.get_color(G.fMarkerColor);z=-1*this.options.TextAngle;C=20;if((G.fMarkerSize!==1)&&z){C=0.02*H*G.fMarkerSize}this.StartTextDrawing(42,C,this.draw_g,C)}for(L=t;L<R;++L){O=r.GetBinLowEdge(L+1);M=r.GetBinLowEdge(L+2);if(A.logx&&(M<=0)){continue}v=Math.round(A.grx(O));s=Math.round(A.grx(M));B=G.getBinContent(L+1);if(A.logy&&(B<A.scale_ymin)){continue}F=Math.round(A.gry(B));D=s-v;v+=Math.round(G.fBarOffset/1000*D);D=Math.round(G.fBarWidth/1000*D);if(A.swap_xy){I+="M"+E+","+v+"h"+(F-E)+"v"+D+"h"+(E-F)+"z"}else{I+="M"+v+","+F+"h"+D+"v"+(E-F)+"h"+(-D)+"z"}if(p>0){s=v+D;D=Math.round(D*p/10);if(A.swap_xy){P+="M"+E+","+v+"h"+(F-E)+"v"+D+"h"+(E-F)+"z";K+="M"+E+","+s+"h"+(F-E)+"v"+(-D)+"h"+(E-F)+"z"}else{P+="M"+v+","+F+"h"+D+"v"+(E-F)+"h"+(-D)+"z";K+="M"+s+","+F+"h"+(-D)+"v"+(E-F)+"h"+D+"z"}}if(x&&B){var N=(B===Math.round(B))?B.toString():g.FFormat(B,g.gStyle.fPaintTextFormat);if(A.swap_xy){this.DrawText({align:12,x:Math.round(F+C/2),y:Math.round(v+0.1),height:Math.round(D*0.8),text:N,color:q,latex:0})}else{if(z){this.DrawText({align:12,x:v+D/2,y:Math.round(F-2-C/5),width:0,height:0,rotate:z,text:N,color:q,latex:0})}else{this.DrawText({align:22,x:Math.round(v+D*0.1),y:Math.round(F-2-C),width:Math.round(D*0.8),height:C,text:N,color:q,latex:0})}}}}if(I){this.draw_g.append("svg:path").attr("d",I).call(this.fillatt.func)}if(P){this.draw_g.append("svg:path").attr("d",P).call(this.fillatt.func).style("fill",o.rgb(this.fillatt.color).brighter(0.5).toString())}if(K){this.draw_g.append("svg:path").attr("d",K).call(this.fillatt.func).style("fill",o.rgb(this.fillatt.color).darker(0.5).toString())}if(x){this.FinishTextDrawing(this.draw_g)}};e.prototype.DrawFilledErrors=function(H,G){this.CreateG(true);var u=this.GetSelectIndex("x","left",-1),J=this.GetSelectIndex("x","right",1),A=this.frame_painter(),F=this.GetHisto(),t=F.fXaxis,I,C,v,B,w,E,D,r=[],p=[];for(I=u;I<J;++I){C=t.GetBinCoord(I+0.5);if(A.logx&&(C<=0)){continue}v=Math.round(A.grx(C));B=F.getBinContent(I+1);w=F.getBinError(I+1);if(A.logy&&(B-w<A.scale_ymin)){continue}E=Math.round(A.gry(B+w));D=Math.round(A.gry(B-w));r.push({grx:v,gry:E});p.unshift({grx:v,gry:D})}var z=(this.options.ErrorKind===4)?"bezier":"line",s=g.Painter.BuildSvgPath(z,r),q=g.Painter.BuildSvgPath("L"+z,p);this.draw_g.append("svg:path").attr("d",s.path+q.path+"Z").style("stroke","none").call(this.fillatt.func)};e.prototype.DrawBins=function(){this.CheckHistDrawAttributes();var p=this.frame_width(),q=this.frame_height();if(!this.draw_content||(p<=0)||(q<=0)){return this.RemoveDrawG()}if(this.options.Bar){return this.DrawBars(p,q)}if((this.options.ErrorKind===3)||(this.options.ErrorKind===4)){return this.DrawFilledErrors(p,q)}var z=this.GetSelectIndex("x","left",-1),av=this.GetSelectIndex("x","right",2),P=this.frame_painter(),J=this.root_pad(),H=this.GetHisto(),ae=H.fXaxis,R=this,ag="",an=false,u,F,E,aq,ad,ap,ac,G,at,ai,aj,ay,aa,s,aC=!this.options.Zero,w=this.options.Error,X=this.options.Mark,r=this.options.Line||this.options.Curve,K=this.options.Text,W=K&&(this.options.TextKind=="E")&&this.IsTProfile()&&H.fBinEntries,ab=null,I=null,ar=null,U=null,T=false,v=false,ax="",au="",L=0,A,N,M,aF,aB,ao,am,al,Q,O,aD="",ak,D,ah;if(w&&!X&&(H.fMarkerStyle>1)){X=true}if(this.options.ErrorKind===2){if(this.fillatt.empty()){X=true}else{ab=""}}else{if(this.options.Error){I="";v=true}}if(r){U=""}if(X){this.createAttMarker({attr:H,style:this.options.MarkStyle});if(this.markeratt.size>0){ar="";T=true;this.markeratt.reset_pos()}else{X=false}}var aA=w||X,af=aA||K||r,aE=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!aE&&!af){return this.RemoveDrawG()}this.CreateG(true);if(K){ak=this.get_color(H.fMarkerColor);D=-1*this.options.TextAngle;ah=20;if((H.fMarkerSize!==1)&&D){ah=0.02*q*H.fMarkerSize}if(!D&&!this.options.TextKind){var az=p/(av-z+1);if(az<3*ah){D=270;ah=Math.round(az*0.7)}}this.StartTextDrawing(42,ah,this.draw_g,ah)}var Z=((av-z)>3*p);if(this.options.ErrorKind===1){var V=this.lineatt.width+g.gStyle.fEndErrorSize;ax="m0,"+V+"v-"+2*V+"m0,"+V;au="m"+V+",0h-"+2*V+"m"+V+",0";L=Math.floor((this.lineatt.width-1)/2)}if(af){Z=true}function C(x){aF=H.getBinContent(x+1);if(aC&&(aF===0)){return false}ao=Math.round(P.grx(ae.GetBinLowEdge(x+1)));am=Math.round(P.grx(ae.GetBinLowEdge(x+2)));al=Math.round((ao+am)/2);A=Math.round(P.gry(aF));N=M=20;if(w){aB=H.getBinError(x+1);N=Math.round(A-P.gry(aF+aB));M=Math.round(P.gry(aF-aB)-A)}return true}function B(x){if(R.options.errorX>0){Q=Math.round(al-(am-ao)*R.options.errorX);O=Math.round(al+(am-ao)*R.options.errorX);I+="M"+(Q+L)+","+A+ax+"h"+(O-Q-2*L)+ax}I+="M"+al+","+(A-N+L)+au+"v"+(N+M-2*L)+au}function aw(y){if(C(y)){if(K){var x=W?H.fBinEntries[y+1]:aF;if(x!==0){var aG=(x===Math.round(x))?x.toString():g.FFormat(x,g.gStyle.fPaintTextFormat);if(D){R.DrawText({align:12,x:al,y:Math.round(A-2-ah/5),width:0,height:0,rotate:D,text:aG,color:ak,latex:0})}else{R.DrawText({align:22,x:Math.round(ao+(am-ao)*0.1),y:Math.round(A-2-ah),width:Math.round((am-ao)*0.8),height:ah,text:aG,color:ak,latex:0})}}}if(r&&(U!==null)){U+=((U.length===0)?"M":"L")+al+","+A}if(aA){if((A>=-N)&&(A<=q+M)){if(ab!==null){ab+="M"+ao+","+(A-N)+"h"+(am-ao)+"v"+(N+M+1)+"h-"+(am-ao)+"z"}if((ar!==null)&&T){ar+=R.markeratt.create(al,A)}if((I!==null)&&v){B(y)}}}}}if(T||v){if(!g.gStyle.OptimizeDraw||((av-z<50000)&&(g.gStyle.OptimizeDraw==1))){for(ay=z;ay<av;++ay){if(C(ay)){if(ar!==null){ar+=R.markeratt.create(al,A)}if(I!==null){B(ay)}}}v=T=false}}for(ay=z;ay<=av;++ay){aq=ae.GetBinLowEdge(ay+1);if(this.logx&&(aq<=0)){continue}ad=Math.round(P.grx(aq));an=(ay===av);if(an&&(z<av)){ac=E}else{ap=H.getBinContent(ay+1);ac=Math.round(P.gry(ap))}if(ag.length===0){aa=s=ay;aj=u=F=ad;ai=G=at=E=ac;ag="M"+F+","+E}else{if(Z){if((ad===F)&&!an){if(ac<G){s=ay}else{if(ac>at){aa=ay}}G=Math.min(G,ac);at=Math.max(at,ac);E=ac}else{if(af){if(aa===s){aw(aa)}else{if(aa<s){aw(aa);aw(s)}else{aw(s);aw(aa)}}}if(aE&&((G!==at)||(ai!==G))){if(aj!==F){ag+="h"+(F-aj)}if(E===G){if(at!==ai){ag+="v"+(at-ai)}if(G!==at){ag+="v"+(G-at)}}else{if(G!==ai){ag+="v"+(G-ai)}if(at!==G){ag+="v"+(at-G)}if(E!==at){ag+="v"+(E-at)}}aj=F;ai=E}if(an&&(aj!==ad)){ag+="h"+(ad-aj)}aa=s=ay;G=at=E=ac;F=ad}}else{if((ac!==E)||an){if(ad!==F){ag+="h"+(ad-F)}if(ac!==E){ag+="v"+(ac-E)}E=ac;F=ad}}}}var S="";if(!this.fillatt.empty()){var Y=q+3,t=Math.round(P.gry(0));if(t<=0){Y=-3}else{if(t<q){Y=t}}S="L"+F+","+Y+"L"+u+","+Y+"Z";if(ag.length>0){ag+=S}}if(aA||r){if((ab!==null)&&(ab.length>0)){this.draw_g.append("svg:path").attr("d",ab).call(this.fillatt.func)}if((I!==null)&&(I.length>0)){this.draw_g.append("svg:path").attr("d",I).call(this.lineatt.func)}if((U!==null)&&(U.length>0)){if(!this.fillatt.empty()){this.draw_g.append("svg:path").attr("d",this.options.Fill?(U+S):ag).attr("stroke","none").call(this.fillatt.func)}this.draw_g.append("svg:path").attr("d",U).attr("fill","none").call(this.lineatt.func)}if((ar!==null)&&(ar.length>0)){this.draw_g.append("svg:path").attr("d",ar).call(this.markeratt.func)}}if((ag.length>0)&&aE){this.draw_g.append("svg:path").attr("d",ag).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}if(K){this.FinishTextDrawing(this.draw_g)}};e.prototype.GetBinTips=function(x){var v=[],p=this.GetTipName(),u=this.frame_painter(),t=this.GetHisto(),r=t.fXaxis.GetBinLowEdge(x+1),q=t.fXaxis.GetBinLowEdge(x+2),y=t.getBinContent(x+1),s="",w=false;if(p.length>0){v.push(p)}if(u.x_kind==="labels"){s=u.AxisAsText("x",r)}else{if(u.x_kind==="time"){s=u.AxisAsText("x",(r+q)/2)}else{w=true;s="["+u.AxisAsText("x",r)+", "+u.AxisAsText("x",q)+")"}}if(this.options.Error||this.options.Mark){v.push("x = "+s);v.push("y = "+u.AxisAsText("y",y));if(this.options.Error){if(w){v.push("error x = "+((q-r)/2).toPrecision(4))}v.push("error y = "+t.getBinError(x+1).toPrecision(4))}}else{v.push("bin = "+(x+1));v.push("x = "+s);if(t["$baseh"]){y-=t["$baseh"].getBinContent(x+1)}if(y===Math.round(y)){v.push("entries = "+y)}else{v.push("entries = "+g.FFormat(y,g.gStyle.fStatFormat))}}return v};e.prototype.ProcessTooltip=function(aa){if((aa===null)||!this.draw_content||!this.draw_g||this.options.Mode3D){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var p=this.frame_width(),q=this.frame_height(),G=this.frame_painter(),B=this.root_pad(),y=this,A=this.GetHisto(),K=null,F=true,E,P,D,t,N,s,z=2,v=this.GetSelectIndex("x","left",-1),W=this.GetSelectIndex("x","right",2),Y=v,T=W,V=aa.x,U=aa.y;function J(r){var w=A.fXaxis.GetBinLowEdge(r+1);return(G.logx&&(w<=0))?null:G.grx(w)}function H(r){var w=A.getBinContent(r+1);if(G.logy&&(w<G.scale_ymin)){return G.swap_xy?-1000:10*q}return Math.round(G.gry(w))}if(G.swap_xy){var ab=aa.x;V=U;U=ab;ab=q;q=p;p=ab}while(Y<T-1){var X=Math.round((Y+T)*0.5),I=J(X);if((I===null)||(I<V-0.5)){if(G.swap_xy){T=X}else{Y=X}}else{if(I>V+0.5){if(G.swap_xy){Y=X}else{T=X}}else{Y++;T--}}}K=T=Y;E=J(K);if(G.swap_xy){while((Y>v)&&(J(Y-1)<E+2)){--Y}while((T<W)&&(J(T+1)>E-2)){++T}}else{while((Y>v)&&(J(Y-1)>E-2)){--Y}while((T<W)&&(J(T+1)<E+2)){++T}}if(Y<T){var S=q;for(var X=Y;X<=T;X++){var x=Math.abs(H(X)-U);if(x<S){S=x;K=X}}if(S>q/10){K=Math.round(Y+(T-Y)/q*U)}E=J(K)}E=Math.round(E);D=Math.round(J(K+1));if(this.options.Bar){var Q=D-E;E+=Math.round(A.fBarOffset/1000*Q);D=E+Math.round(A.fBarWidth/1000*Q)}if(E>D){var ab=E;E=D;D=ab}P=Math.round((E+D)/2);N=t=s=H(K);if(this.options.Bar){F=true;z=0;t=Math.round(G.gry(((this.options.BaseLine!==false)&&(this.options.BaseLine>G.scale_ymin))?this.options.BaseLine:G.scale_ymin));if(t>s){var ab=t;t=s;s=ab}if(!aa.touch&&(aa.nproc===1)){if((U<t)||(U>s)){K=null}}}else{if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve){F=true;var C=3;if(this.markeratt){C=Math.max(C,this.markeratt.GetFullSize())}if(this.options.Error){var M=A.getBinContent(K+1),Z=A.getBinError(K+1);t=Math.round(G.gry(M+Z));s=Math.round(G.gry(M-Z));if((M==0)&&this.IsTProfile()){K=null}var u=(D-E)*this.options.errorX;E=Math.round(P-u);D=Math.round(P+u)}if(D-E<2*C){E=P-C;D=P+C}t=Math.min(t,N-C);s=Math.max(s,N+C);if(!aa.touch&&(aa.nproc===1)){if((U<t)||(U>s)){K=null}}}else{F=(aa.nproc===1)&&(W-v<p);if(F){s=q;if(!this.fillatt.empty()){s=Math.round(G.gry(0));if(s<0){s=0}else{if(s>q){s=q}}if(s<t){var ab=t;t=s;s=ab}}if(((aa.y<t)||(aa.y>s))&&!aa.touch){K=null}}}}if(K!==null){if((K===v)&&(E>V+z)){K=null}else{if((K===W-1)&&(D<V-z)){K=null}else{if((V<E-z)||(V>D+z)){K=null}else{if(!this.options.Zero&&(this.histo.getBinContent(K+1)===0)){K=null}}}}}var O=this.draw_g.select(".tooltip_bin");if((K===null)||((s<=0)||(t>=q))){O.remove();return null}var L={name:A.fName,title:A.fTitle,x:P,y:N,exact:true,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(K)};if(aa.disabled){O.remove();L.changed=true}else{if(F){if(O.empty()){O=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}L.changed=O.property("current_bin")!==K;if(L.changed){O.attr("x",G.swap_xy?t:E).attr("width",G.swap_xy?s-t:D-E).attr("y",G.swap_xy?E:t).attr("height",G.swap_xy?D-E:s-t).style("opacity","0.3").property("current_bin",K)}L.exact=(Math.abs(N-U)<=5)||((U>=t)&&(U<=s));L.menu=true;L.menu_dist=Math.sqrt((P-V)*(P-V)+(N-U)*(N-U))}else{var R=this.lineatt.width+3;if(O.empty()){O=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",R).call(this.lineatt.func).call(this.fillatt.func)}L.exact=(Math.abs(P-aa.x)<=R)&&(Math.abs(N-aa.y)<=R);L.menu=L.exact;L.menu_dist=Math.sqrt((P-aa.x)*(P-aa.x)+(N-aa.y)*(N-aa.y));L.changed=O.property("current_bin")!==K;if(L.changed){O.attr("cx",P).attr("cy",N).property("current_bin",K)}}}if(L.changed){L.user_info={obj:this.histo,name:this.histo.fName,bin:K,cont:this.histo.getBinContent(K+1),grx:P,gry:N}}return L};e.prototype.FillHistContextMenu=function(q){q.add("Auto zoom-in",this.AutoZoom);var p=g.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");q.addDrawMenu("Draw with",p.opts,function(r){if(r==="inspect"){return g.draw(this.divid,this.GetObject(),r)}this.DecodeOptions(r);if(this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()){this.fillatt.Change(5,1001)}this.InteractiveRedraw("pad","drawopt")})};e.prototype.AutoZoom=function(){var t=this.GetSelectIndex("x","left",-1),r=this.GetSelectIndex("x","right",1),u=r-t,p=this.GetHisto();if((u==0)||!p){return}var q=p.getBinContent(t+1);for(var s=t;s<r;++s){q=Math.min(q,p.getBinContent(s+1))}if(q>0){return}while((t<r)&&(p.getBinContent(t+1)<=q)){++t}while((t<r)&&(p.getBinContent(r)<=q)){--r}if((t===r-1)&&(t>2)&&(r<this.nbinsx-2)){--t;++r}if((r-t<u)&&(t<r)){this.frame_painter().Zoom(p.fXaxis.GetBinLowEdge(t+1),p.fXaxis.GetBinLowEdge(r+1))}};e.prototype.CanZoomIn=function(s,r,p){var q=this.GetHisto();if((s=="x")&&q&&(q.fXaxis.FindBin(p,0.5)-q.fXaxis.FindBin(r,0)>1)){return true}if((s=="y")&&(Math.abs(p-r)>Math.abs(this.ymax-this.ymin)*0.000001)){return true}return false};e.prototype.CallDrawFunc=function(t,s){var q=this.main_painter(),r=this.frame_painter();if((q!==this)&&r&&(r.mode3d!==this.options.Mode3D)){this.CopyOptionsFrom(q)}var p=this.options.Mode3D?"Draw3D":"Draw2D";this[p](t,s)};e.prototype.Draw2D=function(p){this.Clear3DScene();this.mode3d=false;this.ScanContent(true);this.CreateXY();if(typeof this.DrawColorPalette==="function"){this.DrawColorPalette(false)}this.DrawAxes();this.DrawBins();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();g.CallBack(p)};e.prototype.Draw3D=function(q,p){this.mode3d=true;g.AssertPrerequisites("hist3d",function(){this.Draw3D(q,p)}.bind(this))};e.prototype.Redraw=function(p){this.CallDrawFunc(null,p)};function l(s,q,r){var p=new e(q);p.SetDivId(s,1);p.DecodeOptions(r);p.CheckPadRange(!p.options.Mode3D);p.ScanContent();p.CreateStat();p.CallDrawFunc(function(){p.DrawNextFunction(0,function(){if(!p.options.Mode3D&&p.options.AutoZoom){p.AutoZoom()}p.FillToolbar();p.DrawingReady()})});return p}function c(p){m.call(this,p);this.fContour=null;this.fCustomContour=false;this.fPalette=null;this.wheel_zoomy=true}c.prototype=Object.create(m.prototype);c.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;m.prototype.Cleanup.call(this)};c.prototype.ToggleProjection=function(r,q){if(r=="Projections"){r=""}if((typeof r=="string")&&(r.length>1)){q=parseInt(r.substr(1));r=r[0]}if(!q){q=1}if(r&&(this.is_projection==r)){if(this.projection_width===q){r=""}else{this.projection_width=q;return}}delete this.proj_hist;this.is_projection=(this.is_projection===r)?"":r;this.projection_width=q;var p=this.canv_painter();if(p){p.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this))}};c.prototype.RedrawProjection=function(s,r,p,x){if(!this.is_projection){return}if(x==undefined){if(!this.tt_handle){return}s=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);r=s+1;p=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);x=p+1}var q=this.canv_painter();if(q&&(this.snapid!==undefined)){var t="EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":";if(this.is_projection=="X"){t+='ProjectionX("_projx",'+(p+1)+","+x+',"")'}else{t+='ProjectionY("_projy",'+(s+1)+","+r+',"")'}q.SendWebsocket(t);return}if(!this.proj_hist){if(this.is_projection=="X"){this.proj_hist=g.CreateHistogram("TH1D",this.nbinsx);g.extend(this.proj_hist.fXaxis,this.histo.fXaxis);this.proj_hist.fName="xproj";this.proj_hist.fTitle="X projection"}else{this.proj_hist=g.CreateHistogram("TH1D",this.nbinsy);g.extend(this.proj_hist.fXaxis,this.histo.fYaxis);this.proj_hist.fName="yproj";this.proj_hist.fTitle="Y projection"}}if(this.is_projection=="X"){for(var v=0;v<this.nbinsx;++v){var w=0;for(var u=p;u<x;++u){w+=this.histo.getBinContent(v+1,u+1)}this.proj_hist.setBinContent(v+1,w)}}else{for(var u=0;u<this.nbinsy;++u){var w=0;for(var v=s;v<r;++v){w+=this.histo.getBinContent(v+1,u+1)}this.proj_hist.setBinContent(u+1,w)}}return q.DrawProjection(this.is_projection,this.proj_hist)};c.prototype.ExecuteMenuCommand=function(q,p){if(m.prototype.ExecuteMenuCommand.call(this,q,p)){return true}if((q.fName=="SetShowProjectionX")||(q.fName=="SetShowProjectionY")){this.ToggleProjection(q.fName[17],p&&parseInt(p)?parseInt(p):1);return true}return false};c.prototype.FillHistContextMenu=function(t){t.add("sub:Projections",this.ToggleProjection);var s=this.is_projection||"";if(s){s+=this.projection_width}var r=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(var p=0;p<r.length;++p){t.addchk(s==r[p],r[p],r[p],this.ToggleProjection)}t.add("endsub:");t.add("Auto zoom-in",this.AutoZoom);var q=g.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");t.addDrawMenu("Draw with",q.opts,function(u){if(u==="inspect"){return g.draw(this.divid,this.GetObject(),u)}this.DecodeOptions(u);this.InteractiveRedraw("pad","drawopt")});if(this.options.Color){this.FillPaletteMenu(t)}};c.prototype.ButtonClick=function(p){if(m.prototype.ButtonClick.call(this,p)){return true}if(this!==this.main_painter()){return false}switch(p){case"ToggleColor":this.ToggleColor();break;case"ToggleColorZ":this.ToggleColz();break;case"Toggle3D":this.ToggleMode3D();break;default:return false}return true};c.prototype.FillToolbar=function(){m.prototype.FillToolbar.call(this,true);var p=this.pad_painter();if(!p){return}if(!this.IsTH2Poly()){p.AddButton(g.ToolbarIcons.th2color,"Toggle color","ToggleColor")}p.AddButton(g.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ");p.AddButton(g.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D");p.ShowButtons()};c.prototype.ToggleColor=function(){if(this.options.Mode3D){this.options.Mode3D=false;this.options.Color=true}else{this.options.Color=!this.options.Color}this._can_move_colz=true;this.CopyOptionsToOthers();this.RedrawPad()};c.prototype.AutoZoom=function(){if(this.IsTH2Poly()){return}var v=this.GetSelectIndex("x","left",-1),u=this.GetSelectIndex("x","right",1),F=this.GetSelectIndex("y","left",-1),E=this.GetSelectIndex("y","right",1),C,y,z=this.GetObject();if((v==u)||(F==E)){return}var x=z.getBinContent(v+1,F+1);for(C=v;C<u;++C){for(y=F;y<E;++y){x=Math.min(x,z.getBinContent(C+1,y+1))}}if(x>0){return}var s=u,r=v,p=E,w=F;for(C=v;C<u;++C){for(y=F;y<E;++y){if(z.getBinContent(C+1,y+1)>x){if(C<s){s=C}if(C>=r){r=C+1}if(y<p){p=y}if(y>=w){w=y+1}}}}var q,B,D,t,A=false;if((s===r-1)&&(s>v+1)&&(r<u-1)){s--;r++}if((p===w-1)&&(p>F+1)&&(w<E-1)){p--;w++}if((s>v||r<u)&&(s<r-1)){q=z.fXaxis.GetBinLowEdge(s+1);B=z.fXaxis.GetBinLowEdge(r+1);A=true}if((p>F||w<E)&&(p<w-1)){D=z.fYaxis.GetBinLowEdge(p+1);t=z.fYaxis.GetBinLowEdge(w+1);A=true}if(A){this.frame_painter().Zoom(q,B,D,t)}};c.prototype.ScanContent=function(t){if(t&&this.nbinsx&&this.nbinsy){return}var s,r,q=this.GetObject();this.nbinsx=q.fXaxis.fNbins;this.nbinsy=q.fYaxis.fNbins;this.CreateAxisFuncs(true);if(this.IsTH2Poly()){this.gminposbin=null;this.gminbin=this.gmaxbin=0;for(var v=0,p=q.fBins.arr.length;v<p;++v){var u=q.fBins.arr[v].fContent;if(v===0){this.gminbin=this.gmaxbin=u}if(u<this.gminbin){this.gminbin=u}else{if(u>this.gmaxbin){this.gmaxbin=u}}if(u>0){if((this.gminposbin===null)||(this.gminposbin>u)){this.gminposbin=u}}}}else{this.gminbin=this.gmaxbin=q.getBinContent(1,1);this.gminposbin=null;for(s=0;s<this.nbinsx;++s){for(r=0;r<this.nbinsy;++r){var u=q.getBinContent(s+1,r+1);if(u<this.gminbin){this.gminbin=u}else{if(u>this.gmaxbin){this.gmaxbin=u}}if(u>0){if((this.gminposbin===null)||(this.gminposbin>u)){this.gminposbin=u}}}}}if(this.gminposbin===null){this.gminposbin=this.gmaxbin*0.0001}if(this.options.Axis>0){this.draw_content=false}else{this.draw_content=(this.gmaxbin>0);if(!this.draw_content&&this.options.Zero&&this.IsTH2Poly()){this.draw_content=true;this.options.Line=1}}};c.prototype.CountStat=function(z){var B=this.GetHisto(),r=B.fXaxis,P=B.fYaxis,t=0,x=0,K=0,w=0,J=0,Q=0,q,M,u,F,S,v=this.frame_painter(),U={name:B.fName,entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var O=B.fBins.arr.length,L,E,I,G,A,D,p,y=this.frame_painter();for(L=0;L<O;++L){E=B.fBins.arr[L];q=1;M=1;if(E.fXmin>y.scale_xmax){q=2}else{if(E.fXmax<y.scale_xmin){q=0}}if(E.fYmin>y.scale_ymax){M=2}else{if(E.fYmax<y.scale_ymin){M=0}}u=F=p=0;G=E.fPoly;D=1;if(G._typename==="TMultiGraph"){D=E.fPoly.fGraphs.arr.length;G=null}for(A=0;A<D;++A){if(!G||(A>0)){G=E.fPoly.fGraphs.arr[A]}for(I=0;I<G.fNpoints;++I){++p;u+=G.fX[I];F+=G.fY[I]}}if(p>1){u=u/p;F=F/p}S=E.fContent;U.entries+=S;U.matrix[M*3+q]+=S;if((q!=1)||(M!=1)){continue}if(z&&!z(u,F)){continue}if((U.wmax===null)||(S>U.wmax)){U.wmax=S;U.xmax=u;U.ymax=F}t+=S;x+=u*S;K+=F*S;w+=u*u*S;J+=F*F*S;Q+=u*F*S}}else{var s=this.GetSelectIndex("x","left"),H=this.GetSelectIndex("x","right"),R=this.GetSelectIndex("y","left"),N=this.GetSelectIndex("y","right"),C,T;for(C=0;C<=this.nbinsx+1;++C){q=(C<=s)?0:(C>H?2:1);u=r.GetBinCoord(C-0.5);for(T=0;T<=this.nbinsy+1;++T){M=(T<=R)?0:(T>N?2:1);F=P.GetBinCoord(T-0.5);S=B.getBinContent(C,T);U.entries+=S;U.matrix[M*3+q]+=S;if((q!=1)||(M!=1)){continue}if((z!=null)&&!z(u,F)){continue}if((U.wmax===null)||(S>U.wmax)){U.wmax=S;U.xmax=u;U.ymax=F}t+=S;x+=u*S;K+=F*S;w+=u*u*S;J+=F*F*S;Q+=u*F*S}}}if(!v.IsAxisZoomed("x")&&!v.IsAxisZoomed("y")&&(B.fTsumw>0)){t=B.fTsumw;x=B.fTsumwx;w=B.fTsumwx2;K=B.fTsumwy;J=B.fTsumwy2;Q=B.fTsumwxy}if(t>0){U.meanx=x/t;U.meany=K/t;U.rmsx=Math.sqrt(Math.abs(w/t-U.meanx*U.meanx));U.rmsy=Math.sqrt(Math.abs(J/t-U.meany*U.meany))}if(U.wmax===null){U.wmax=0}U.integral=t;if(B.fEntries>1){U.entries=B.fEntries}return U};c.prototype.FillStatistic=function(v,w,C){if(this.IgnoreStatsFill()){return false}var u=this.CountStat(),z=Math.floor(w%10),A=Math.floor(w/10)%10,y=Math.floor(w/100)%10,B=Math.floor(w/1000)%10,p=Math.floor(w/10000)%10,q=Math.floor(w/100000)%10,s=Math.floor(w/1000000)%10,x=Math.floor(w/10000000)%10,t=Math.floor(w/100000000)%10;v.ClearPave();if(z>0){v.AddText(u.name)}if(A>0){v.AddText("Entries = "+v.Format(u.entries,"entries"))}if(y>0){v.AddText("Mean x = "+v.Format(u.meanx));v.AddText("Mean y = "+v.Format(u.meany))}if(B>0){v.AddText("Std Dev x = "+v.Format(u.rmsx));v.AddText("Std Dev y = "+v.Format(u.rmsy))}if(s>0){v.AddText("Integral = "+v.Format(u.matrix[4],"entries"))}if(x>0){v.AddText("Skewness x = <undef>");v.AddText("Skewness y = <undef>")}if(t>0){v.AddText("Kurt = <undef>")}if((p>0)||(q>0)){var r=u.matrix;v.AddText(""+r[6].toFixed(0)+" | "+r[7].toFixed(0)+" | "+r[7].toFixed(0));v.AddText(""+r[3].toFixed(0)+" | "+r[4].toFixed(0)+" | "+r[5].toFixed(0));v.AddText(""+r[0].toFixed(0)+" | "+r[1].toFixed(0)+" | "+r[2].toFixed(0))}if(C){v.FillFunctionStat(this.FindFunction("TF1"),C)}return true};c.prototype.DrawBinsColor=function(B,u){var s=this.GetHisto(),v=this.PrepareColorDraw(),q=[],A=[],z=[],D,F,C,t,r,x,p,G,y,E;for(t=v.i1;t<v.i2;++t){G=v.grx[t+1]-v.grx[t];p=Math.round(v.grx[t]+G*v.xbar1);G=Math.round(G*(v.xbar2-v.xbar1));for(r=v.j1;r<v.j2;++r){x=s.getBinContent(t+1,r+1);D=this.getContourColor(x,true);if(x===0){if(!this.options.Zero){continue}if((D===null)&&this._show_empty_bins){D=0}}if(D===null){continue}E=v.gry[r]-v.gry[r+1];y=Math.round(v.gry[r+1]+E*v.ybar1);E=Math.round(E*(v.ybar2-v.ybar1));F="M"+p+","+y;if(q[D]===undefined){q[D]=F}else{C="m"+(p-A[D])+","+(y-z[D]);q[D]+=(C.length<F.length)?C:F}A[D]=p;z[D]=y;q[D]+="v"+E+"h"+G+"v"+(-E)+"z"}}for(D=0;D<q.length;++D){if(q[D]!==undefined){this.draw_g.append("svg:path").attr("palette-index",D).attr("fill",this.fPalette.getColor(D)).attr("d",q[D])}}return v};c.prototype.BuildContour=function(P,O,an,H){var J=this.GetObject(),ag=0,w=this,W=2004,r=2000,Z=new Float32Array(2*W),p=new Float32Array(2*W),G=new Int32Array(2*W),aa=0,al,X,ad=[],ap,M=0,af=[0,0,0,0],ae=[0,0,0,0],u=[0,0,0,0],S=[0,0,0,0],ao,am,ak,ai,aj,R,q,ah,T,I,F,R,t;function B(x){for(var y=0;y<O.length;++y){if(x<O[y]){return y-1}}return O.length-1}function z(av,aE,aH,aq,au,aD,aG,y){var aF=(aH===aG),x=aF?(y-aq):(aG-aH),aC=aE+1,at=au-av,aw=aa-1,az=W/2-3+aa,ar=0,aB,ay,ax,aA;while(aC<=aD&&aw<=az){aA=O[aC];ax=aA-av;ay=ax/at;aB=x*ay;if(aF){Z[aw]=aH;p[aw]=aq+aB}else{Z[aw]=aH+aB;p[aw]=aq}G[aw]=aC;ar++;aw+=2;aC++}return ar}var v=P.original?P.origx:P.grx,s=P.original?P.origy:P.gry;for(am=P.j1;am<P.j2-1;++am){ae[1]=ae[0]=(s[am]+s[am+1])/2;ae[3]=ae[2]=(s[am+1]+s[am+2])/2;for(ao=P.i1;ao<P.i2-1;++ao){u[0]=J.getBinContent(ao+1,am+1);u[1]=J.getBinContent(ao+2,am+1);u[2]=J.getBinContent(ao+2,am+2);u[3]=J.getBinContent(ao+1,am+2);for(ak=0;ak<4;ak++){S[ak]=B(u[ak])}if((S[0]!==S[1])||(S[1]!==S[2])||(S[2]!==S[3])||(S[3]!==S[0])){af[3]=af[0]=(v[ao]+v[ao+1])/2;af[2]=af[1]=(v[ao+1]+v[ao+2])/2;if(u[0]<=u[1]){ai=0}else{ai=1}if(u[2]<=u[3]){aj=2}else{aj=3}if(u[ai]>u[aj]){ai=aj}ai++;aa=1;for(R=1;R<=4;R++){aj=ai%4+1;q=z(u[ai-1],S[ai-1],af[ai-1],ae[ai-1],u[aj-1],S[aj-1],af[aj-1],ae[aj-1]);aa+=2*q;ai=aj}if(u[0]<=u[1]){ai=0}else{ai=1}if(u[2]<=u[3]){aj=2}else{aj=3}if(u[ai]>u[aj]){ai=aj}ai++;aa=2;for(R=1;R<=4;R++){if(ai==1){aj=4}else{aj=ai-1}q=z(u[ai-1],S[ai-1],af[ai-1],ae[ai-1],u[aj-1],S[aj-1],af[aj-1],ae[aj-1]);aa+=2*q;ai=aj}ah=0;for(R=1;R<=aa-5;R+=2){while(G[R-1]!=G[R]){T=Z[R];I=p[R];F=G[R];for(t=R;t<=aa-5;t+=2){Z[t]=Z[t+2];p[t]=p[t+2];G[t]=G[t+2]}Z[aa-3]=T;p[aa-3]=I;G[aa-3]=F;if(ah>r){break}ah++}}if(ah>r){continue}for(R=1;R<=aa-2;R+=2){al=G[R-1];if((al>=0)&&(al<O.length)){X=ad[al];if(!X){X=ad[al]=g.CreateTPolyLine(W*4,true)}ap=X.fLastPoint;if(ap<X.fN-2){X.fX[ap+1]=Math.round(Z[R-1]);X.fY[ap+1]=Math.round(p[R-1]);X.fX[ap+2]=Math.round(Z[R]);X.fY[ap+2]=Math.round(p[R]);X.fLastPoint=ap+2;M=Math.max(M,X.fLastPoint+1)}else{}}}}}}var V=new Int32Array(O.length),E=0;for(al=0;al<O.length;al++){if(O[al]>=0){E=al;break}}ak=0;for(al=E-1;al>=0;al--){V[ak]=al;ak++}for(al=E;al<O.length;al++){V[ak]=al;ak++}var ab=new Float32Array(2*M),L=new Float32Array(2*M);for(ak=0;ak<O.length;++ak){al=V[ak];X=ad[al];if(!X){continue}var Q=an.calcColorIndex(al,O.length),U=X.fX,D=X.fY,ap=X.fLastPoint+1,ac=0,K,N,A=0,Y=0,C;while(true){K=M;N=K+1;ab[K]=U[ac];L[K]=D[ac];ab[N]=U[ac+1];L[N]=D[ac+1];U[ac]=U[ac+1]=A;D[ac]=D[ac+1]=Y;while(true){C=0;for(ao=2;ao<ap;ao+=2){if((N<2*M-1)&&(U[ao]===ab[N])&&(D[ao]===L[N])){N++;ab[N]=U[ao+1];L[N]=D[ao+1];U[ao]=U[ao+1]=A;D[ao]=D[ao+1]=Y;C++}if((K>0)&&(U[ao+1]===ab[K])&&(D[ao+1]===L[K])){K--;ab[K]=U[ao];L[K]=D[ao];U[ao]=U[ao+1]=A;D[ao]=D[ao+1]=Y;C++}}if(C==0){break}}if((K+1<N)&&(K>=0)){H(Q,ab,L,K,N,al)}ac=0;for(ao=2;ao<ap;ao+=2){if(U[ao]!==A&&D[ao]!==Y){ac=ao;break}}if(ac===0){break}}}};c.prototype.DrawBinsContour=function(p,x){var v=this.PrepareColorDraw({rounding:false,extra:100,original:this.options.Proj!=0});var B=this.GetContour(),q=this.GetPalette(),y=this,s=this.frame_painter();function r(G,J,D,C){var I="",F=null,H=null,E;for(E=D;E<=C;++E){H=null;switch(s.projection){case 1:H=s.ProjectAitoff2xy(G[E],J[E]);break;case 2:H=s.ProjectMercator2xy(G[E],J[E]);break;case 3:H=s.ProjectSinusoidal2xy(G[E],J[E]);break;case 4:H=s.ProjectParabolic2xy(G[E],J[E]);break}if(H){H.x=s.grx(H.x);H.y=s.gry(H.y)}else{H={x:G[E],y:J[E]}}H.x=Math.round(H.x);H.y=Math.round(H.y);if(!I){I="M"+H.x+","+H.y}else{if((H.x!=F.x)&&(H.y!=F.y)){I+="l"+(H.x-F.x)+","+(H.y-F.y)}else{if(H.x!=F.x){I+="h"+(H.x-F.x)}else{if(H.y!=F.y){I+="v"+(H.y-F.y)}}}}F=H}return I}if(this.options.Contour===14){var z="M0,0h"+p+"v"+x+"h-"+p;if(this.options.Proj){var w=v.j2-v.j1,A=new Float32Array(w*2),u=new Float32Array(w*2);for(var t=0;t<w;++t){A[t]=v.origx[v.i1];u[t]=(v.origy[v.j1]*(t+0.5)+v.origy[v.j2]*(w-0.5-t))/w;A[t+w]=v.origx[v.i2];u[t+w]=(v.origy[v.j2]*(t+0.5)+v.origy[v.j1]*(w-0.5-t))/w}z=r(A,u,0,2*w-1)}this.draw_g.append("svg:path").attr("d",z+"z").style("stroke","none").style("fill",q.calcColor(0,B.length))}this.BuildContour(v,B,q,function(K,F,C,H,G){var J=q.getColor(K),E=J,I=null;switch(y.options.Contour){case 1:break;case 11:E="none";I=new g.TAttLineHandler({color:J});break;case 12:E="none";I=new g.TAttLineHandler({color:1,style:(K%5+1),width:1});break;case 13:E="none";I=y.lineatt;break;case 14:break}var D=y.draw_g.append("svg:path").attr("class","th2_contour").attr("d",r(F,C,H,G)+(E=="none"?"":"z")).style("fill",E);if(I!==null){D.call(I.func)}else{D.style("stroke","none")}});v.hide_only_zeros=true;return v};c.prototype.CreatePolyBin=function(A,E){var t="",q,p=1,s=null;if(E.fPoly._typename=="TMultiGraph"){p=E.fPoly.fGraphs.arr.length}else{s=E.fPoly}for(q=0;q<p;++q){if(!s||(q>0)){s=E.fPoly.fGraphs.arr[q]}var D=s.fNpoints,r,C=s.fX,B=s.fY,v=Math.round(A.grx(C[0])),u=Math.round(A.gry(B[0])),z,w;if((D>2)&&(C[0]==C[D-1])&&(B[0]==B[D-1])){D--}t+="M"+v+","+u;for(r=1;r<D;++r){z=Math.round(A.grx(C[r]));w=Math.round(A.gry(B[r]));if((v!==z)||(u!==w)){if(v===z){t+="v"+(w-u)}else{if(u===w){t+="h"+(z-v)}else{t+="l"+(z-v)+","+(w-u)}}}v=z;u=w}t+="z"}return t};c.prototype.DrawPolyBinsColor=function(v,F){var x=this.GetObject(),s=this.frame_painter(),I=[],t=[],q,B,y,H,C,E=x.fBins.arr.length;this.fContour=null;this.fCustomContour=false;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(C=0;C<E;++C){y=x.fBins.arr[C];q=this.getContourColor(y.fContent,true);if(q===null){continue}if(y.fContent===0){if(!this.options.Zero||!this.options.Line){continue}q=0}if((y.fXmin>s.scale_xmax)||(y.fXmax<s.scale_xmin)||(y.fYmin>s.scale_ymax)||(y.fYmax<s.scale_ymin)){continue}B=this.CreatePolyBin(s,y);if(I[q]===undefined){I[q]=B}else{I[q]+=B}if(this.options.Text&&y.fContent){t.push(y)}}for(q=0;q<I.length;++q){if(I[q]){H=this.draw_g.append("svg:path").attr("palette-index",q).attr("fill",q?this.fPalette.getColor(q):"none").attr("d",I[q]);if(this.options.Line){H.call(this.lineatt.func)}}}if(t.length>0){var p=this.get_color(x.fMarkerColor),r=-1*this.options.TextAngle,D=this.draw_g.append("svg:g").attr("class","th2poly_text"),u=12;if((x.fMarkerSize!==1)&&r){u=Math.round(0.02*F*x.fMarkerSize)}this.StartTextDrawing(42,u,D,u);for(C=0;C<t.length;++C){y=t[C];var A=Math.round(s.x((y.fXmin+y.fXmax)/2)),z=Math.round(s.y((y.fYmin+y.fYmax)/2)),G="";if(!this.options.TextKind){G=(Math.round(y.fContent)===y.fContent)?y.fContent.toString():g.FFormat(y.fContent,g.gStyle.fPaintTextFormat)}else{if(y.fPoly){G=y.fPoly.fName}if(G==="Graph"){G=""}if(!G){G=y.fNumber}}this.DrawText({align:22,x:A,y:z,rotate:r,text:G,color:p,latex:0,draw_g:D})}this.FinishTextDrawing(D,null)}return{poly:true}};c.prototype.DrawBinsText=function(u,F,I){var x=this.GetObject(),E,C,v,r,y,K,G,A,z,J,H,p=this.get_color(x.fMarkerColor),s=-1*this.options.TextAngle,D=this.draw_g.append("svg:g").attr("class","th2_text"),t=20,q=0,B=(this.options.TextKind=="E")&&this.MatchObjectType("TProfile2D")&&(typeof x.getBinEntries=="function");if(I===null){I=this.PrepareColorDraw({rounding:false})}if((x.fMarkerSize!==1)&&s){t=Math.round(0.02*F*x.fMarkerSize)}if(x.fBarOffset!==0){q=x.fBarOffset*0.001}this.StartTextDrawing(42,t,D,t);for(E=I.i1;E<I.i2;++E){for(C=I.j1;C<I.j2;++C){v=x.getBinContent(E+1,C+1);if((v===0)&&!this._show_empty_bins){continue}y=I.grx[E+1]-I.grx[E];K=I.gry[C]-I.gry[C+1];if(B){v=x.getBinEntries(E+1,C+1)}G=(v===Math.round(v))?v.toString():g.FFormat(v,g.gStyle.fPaintTextFormat);if(s){A=Math.round(I.grx[E]+y*0.5);z=Math.round(I.gry[C+1]+K*(0.5+q));J=0;H=0}else{A=Math.round(I.grx[E]+y*0.1);z=Math.round(I.gry[C+1]+K*(0.1+q));J=Math.round(y*0.8);H=Math.round(K*0.8)}this.DrawText({align:22,x:A,y:z,width:J,height:H,rotate:s,text:G,color:p,latex:0,draw_g:D})}}this.FinishTextDrawing(D,null);I.hide_only_zeros=true;return I};c.prototype.DrawBinsArrow=function(x,L){var A=this.GetObject(),G="",I,F,z,u,B,S,N,Q,D=1e-30,y,v,E,p,O,s,M,K,r,q,C,R,t,P=this.PrepareColorDraw({rounding:false}),J=(P.grx[P.i2]-P.grx[P.i1])/(P.i2-P.i1+1-0.03)/2,H=(P.gry[P.j2]-P.gry[P.j1])/(P.j2-P.j1+1-0.03)/2;for(var Q=0;Q<2;++Q){for(I=P.i1;I<P.i2;++I){for(F=P.j1;F<P.j2;++F){if(I===P.i1){y=A.getBinContent(I+2,F+1)-A.getBinContent(I+1,F+1)}else{if(I===P.i2-1){y=A.getBinContent(I+1,F+1)-A.getBinContent(I,F+1)}else{y=0.5*(A.getBinContent(I+2,F+1)-A.getBinContent(I,F+1))}}if(F===P.j1){v=A.getBinContent(I+1,F+2)-A.getBinContent(I+1,F+1)}else{if(F===P.j2-1){v=A.getBinContent(I+1,F+1)-A.getBinContent(I+1,F)}else{v=0.5*(A.getBinContent(I+1,F+2)-A.getBinContent(I+1,F))}}if(Q===0){D=Math.max(D,Math.abs(y),Math.abs(v))}else{E=(P.grx[I]+P.grx[I+1])/2;p=(P.gry[F]+P.gry[F+1])/2;O=J*y/D;s=H*v/D;M=E-O;K=E+O;r=p-s;q=p+s;y=Math.round(K-M);v=Math.round(q-r);if((y!==0)||(v!==0)){G+="M"+Math.round(M)+","+Math.round(r)+"l"+y+","+v;if(Math.abs(y)>5||Math.abs(v)>5){C=Math.sqrt(2/(y*y+v*v));R=Math.round(C*(y+v));t=Math.round(C*(y-v));if((R!==0)&&(t!==0)){G+="l"+(-R)+","+t+"m"+R+","+(-t)+"l"+(-t)+","+(-R)}}}}}}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",G).style("fill","none").call(this.lineatt.func);return P};c.prototype.DrawBinsBox=function(I,P){var K=this.GetObject(),U=this.PrepareColorDraw({rounding:false}),G=this.main_painter();if(G===this){if(G.maxbin===G.minbin){G.maxbin=G.gmaxbin;G.minbin=G.gminbin;G.minposbin=G.gminposbin}if(G.maxbin===G.minbin){G.minbin=Math.min(0,G.maxbin-1)}}var A=Math.max(Math.abs(G.maxbin),Math.abs(G.minbin)),t=Math.max(0,G.minbin),O,M,J,B,X="",x="",y="",v="",H,Q,s,r,F,L,W,z,q,p,D=1,T=false,N=0,R=1;if(this.root_pad().fLogz&&(A>0)){T=true;R=Math.log(A);if(t>0){N=Math.log(t)}else{if((G.minposbin>=1)&&(G.minposbin<100)){N=Math.log(0.7)}else{N=(G.minposbin>0)?Math.log(0.7*G.minposbin):R-10}}if(N>=R){N=R-10}D=1/(R-N)}else{D=1/(A-t)}for(O=U.i1;O<U.i2;++O){for(M=U.j1;M<U.j2;++M){J=K.getBinContent(O+1,M+1);B=Math.abs(J);if((B===0)||(B<t)){continue}Q=T?((B>0)?Math.log(B)-N:0):(B-t);Q=0.5*((Q<0)?1:(1-Math.sqrt(Q*D)));if(Q<0){Q=0}W=U.grx[O+1]-U.grx[O];z=U.gry[M]-U.gry[M+1];s=Q*W;r=Q*z;F=Math.round(U.grx[O]+s);L=Math.round(U.gry[M+1]+r);W=Math.max(Math.round(W-2*s),1);z=Math.max(Math.round(z-2*r),1);X+="M"+F+","+L+"v"+z+"h"+W+"v-"+z+"z";if((J<0)&&(this.options.BoxStyle===10)){x+="M"+F+","+L+"l"+W+","+z+"M"+(F+W)+","+L+"l-"+W+","+z}if((this.options.BoxStyle===11)&&(W>5)&&(z>5)){var V=Math.round(W*0.1),u=Math.round(z*0.1),E="M"+F+","+L+"h"+W+"l"+(-V)+","+u+"h"+(2*V-W)+"v"+(z-2*u)+"l"+(-V)+","+u+"z",C="M"+(F+W)+","+(L+z)+"v"+(-z)+"l"+(-V)+","+u+"v"+(z-2*u)+"h"+(2*V-W)+"l"+(-V)+","+u+"z";if(J<0){v+=E;y+=C}else{y+=E;v+=C}}}}if(X.length>0){var S=this.draw_g.append("svg:path").attr("d",X).call(this.fillatt.func);if((this.options.BoxStyle===11)||!this.fillatt.empty()){S.style("stroke","none")}else{S.call(this.lineatt.func)}}if((y.length>0)&&(this.fillatt.color!=="none")){this.draw_g.append("svg:path").attr("d",y).style("stroke","none").call(this.fillatt.func).style("fill",o.rgb(this.fillatt.color).brighter(0.5).toString())}if(v.length>0){this.draw_g.append("svg:path").attr("d",v).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.color==="none"?"red":o.rgb(this.fillatt.color).darker(0.5).toString())}if(x.length>0){var S=this.draw_g.append("svg:path").attr("d",x).style("fill","none");if(this.lineatt.color!=="none"){S.call(this.lineatt.func)}else{S.style("stroke","black")}}return U};c.prototype.DrawCandle=function(u,C){var v=this.GetHisto(),E=this.PrepareColorDraw(),r=this.frame_painter(),B,A,s,I,G,F,q,H,t,p,u,J,x="",D="",z;if(v.fMarkerColor===1){v.fMarkerColor=v.fLineColor}this.createAttMarker({attr:v,style:5});this.markeratt.reset_pos();E.candle=[];for(B=E.i1;B<E.i2;++B){G=0;p=0;t=0;for(A=0;A<this.nbinsy;++A){p+=v.getBinContent(B+1,A+1)}J={bin:B,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(A=0;A<this.nbinsy;++A){q=v.getBinContent(B+1,A+1);z=v.fYaxis.GetBinCenter(A+1);if(t/p<0.001&&(t+q)/p>=0.001){J.whiskerm=z}if(t/p<0.25&&(t+q)/p>=0.25){J.m25y=z}if(t/p<0.5&&(t+q)/p>=0.5){J.median=z}if(t/p<0.75&&(t+q)/p>=0.75){J.p25y=z}if(t/p<0.999&&(t+q)/p>=0.999){J.whiskerp=z}t+=q;s=z;G+=q*s}if(t>0){J.meany=G/t}J.iqr=J.p25y-J.m25y;if((J.m25y-1.5*J.iqr)>J.whsikerm){J.whiskerm=J.m25y-1.5*J.iqr}if((J.p25y+1.5*J.iqr)<J.whiskerp){J.whiskerp=J.p25y+1.5*J.iqr}if(r.logy&&(J.whiskerm<=0)){continue}u=E.grx[B+1]-E.grx[B];u*=0.66;H=(E.grx[B+1]+E.grx[B])/2+v.fBarOffset/1000*u;if(v.fBarWidth>0){u=u*v.fBarWidth/1000}J.x1=Math.round(H-u/2);J.x2=Math.round(H+u/2);H=Math.round(H);J.y0=Math.round(r.gry(J.median));x+="M"+J.x1+","+J.y0+"h"+(J.x2-J.x1);J.y1=Math.round(r.gry(J.p25y));J.y2=Math.round(r.gry(J.m25y));x+="M"+J.x1+","+J.y1+"v"+(J.y2-J.y1)+"h"+(J.x2-J.x1)+"v-"+(J.y2-J.y1)+"z";J.yy1=Math.round(r.gry(J.whiskerp));J.yy2=Math.round(r.gry(J.whiskerm));x+="M"+H+","+J.y1+"v"+(J.yy1-J.y1);x+="M"+J.x1+","+J.yy1+"h"+(J.x2-J.x1);x+="M"+H+","+J.y2+"v"+(J.yy2-J.y2);x+="M"+J.x1+","+J.yy2+"h"+(J.x2-J.x1);for(A=0;A<this.nbinsy;++A){q=v.getBinContent(B+1,A+1);z=v.fYaxis.GetBinCenter(A+1);if(q>0&&z<J.whiskerm){D+=this.markeratt.create(H,z)}if(q>0&&z>J.whiskerp){D+=this.markeratt.create(H,z)}}E.candle.push(J)}if(x.length>0){this.draw_g.append("svg:path").attr("d",x).call(this.lineatt.func).call(this.fillatt.func)}if(D.length>0){this.draw_g.append("svg:path").attr("d",D).call(this.markeratt.func)}return E};c.prototype.DrawBinsScatter=function(x,M){var B=this.GetObject(),Q=this.PrepareColorDraw({rounding:true,pixel_density:true}),R=[],P=[],O=[],s=[],v=[],u,r,p,L,J,A,t,y,C=1,T=this.options.ScatCoef*((this.gmaxbin)>2000?2000/this.gmaxbin:1);g.seed(Q.sumz);if(T*Q.sumz<100000){this.createAttMarker({attr:B});this.markeratt.reset_pos();var D="",F,z;for(L=Q.i1;L<Q.i2;++L){t=Q.grx[L+1]-Q.grx[L];for(J=Q.j1;J<Q.j2;++J){y=Q.gry[J]-Q.gry[J+1];A=B.getBinContent(L+1,J+1);z=Math.round(T*A);if(z<=0){continue}for(F=0;F<z;++F){D+=this.markeratt.create(Math.round(Q.grx[L]+t*g.random()),Math.round(Q.gry[J+1]+y*g.random()))}}}this.draw_g.append("svg:path").attr("d",D).call(this.markeratt.func);return Q}if(this.maxbin>0.7){C=0.7/this.maxbin}var I=Math.round(Q.max-Q.min);this.CreateContour((I>50)?50:I,this.minposbin,this.maxbin,this.minposbin);for(L=Q.i1;L<Q.i2;++L){for(J=Q.j1;J<Q.j2;++J){A=B.getBinContent(L+1,J+1);if((A<=0)||(A<this.minbin)){continue}t=Q.grx[L+1]-Q.grx[L];y=Q.gry[J]-Q.gry[J+1];if(t*y<=0){continue}u=this.getContourIndex(A/t/y);if(u<0){continue}r="M"+Q.grx[L]+","+Q.gry[J+1];if(R[u]===undefined){R[u]=r;s[u]=t;v[u]=y}else{p="m"+(Q.grx[L]-P[u])+","+(Q.gry[J+1]-O[u]);R[u]+=(p.length<r.length)?p:r;s[u]=Math.max(s[u],t);v[u]=Math.max(v[u],y)}P[u]=Q.grx[L];O[u]=Q.gry[J+1];R[u]+="v"+y+"h"+t+"v-"+y+"z"}}var S=this.svg_frame().select(".main_layer"),q=S.select("defs");if(q.empty()&&(R.length>0)){q=S.insert("svg:defs",":first-child")}this.createAttMarker({attr:B});for(u=0;u<R.length;++u){if((R[u]!==undefined)&&(u<this.fContour.length)){var H="scatter_"+u,N=q.select("."+H);if(N.empty()){N=q.append("svg:pattern").attr("class",H).attr("id","jsroot_scatter_pattern_"+g.id_counter++).attr("patternUnits","userSpaceOnUse")}else{N.selectAll("*").remove()}var z=Math.round(C*this.fContour[u]*s[u]*v[u]);if(z<1){z=1}var K=new Float32Array(z),G=new Float32Array(z);if(z===1){K[0]=G[0]=0.5}else{for(var E=0;E<z;++E){K[E]=g.random();G[E]=g.random()}}this.markeratt.reset_pos();var D="";for(var E=0;E<z;++E){D+=this.markeratt.create(K[E]*s[u],G[E]*v[u])}N.attr("width",s[u]).attr("height",v[u]).append("svg:path").attr("d",D).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",u).attr("fill","url(#"+N.attr("id")+")").attr("d",R[u])}}return Q};c.prototype.DrawBins=function(){if(!this.draw_content){return this.RemoveDrawG()}this.CheckHistDrawAttributes();this.CreateG(true);var p=this.frame_width(),q=this.frame_height(),r=null;if(this.IsTH2Poly()){r=this.DrawPolyBinsColor(p,q)}else{if(this.options.Scat){r=this.DrawBinsScatter(p,q)}else{if(this.options.Color){r=this.DrawBinsColor(p,q)}else{if(this.options.Box){r=this.DrawBinsBox(p,q)}else{if(this.options.Arrow){r=this.DrawBinsArrow(p,q)}else{if(this.options.Contour){r=this.DrawBinsContour(p,q)}else{if(this.options.Candle){r=this.DrawCandle(p,q)}}}}}}}if(this.options.Text){r=this.DrawBinsText(p,q,r)}if(!r){r=this.DrawBinsScatter(p,q)}this.tt_handle=r};c.prototype.GetBinTips=function(t,s){var q=[],p=this.frame_painter(),r=this.GetHisto(),u=r.getBinContent(t+1,s+1);q.push(this.GetTipName());if(p.x_kind=="labels"){q.push("x = "+p.AxisAsText("x",r.fXaxis.GetBinLowEdge(t+1)))}else{q.push("x = ["+p.AxisAsText("x",r.fXaxis.GetBinLowEdge(t+1))+", "+p.AxisAsText("x",r.fXaxis.GetBinLowEdge(t+2))+")")}if(p.y_kind=="labels"){q.push("y = "+p.AxisAsText("y",r.fYaxis.GetBinLowEdge(s+1)))}else{q.push("y = ["+p.AxisAsText("y",r.fYaxis.GetBinLowEdge(s+1))+", "+p.AxisAsText("y",r.fYaxis.GetBinLowEdge(s+2))+")")}q.push("bin = "+t+", "+s);if(r.$baseh){u-=r.$baseh.getBinContent(t+1,s+1)}if(u===Math.round(u)){q.push("entries = "+u)}else{q.push("entries = "+g.FFormat(u,g.gStyle.fStatFormat))}return q};c.prototype.GetCandleTips=function(t){var r=[],q=this.frame_painter(),s=this.GetHisto();r.push(this.GetTipName());r.push("x = "+q.AxisAsText("x",s.fXaxis.GetBinLowEdge(t.bin+1)));r.push("mean y = "+g.FFormat(t.meany,g.gStyle.fStatFormat));r.push("m25 = "+g.FFormat(t.m25y,g.gStyle.fStatFormat));r.push("p25 = "+g.FFormat(t.p25y,g.gStyle.fStatFormat));return r};c.prototype.ProvidePolyBinHints=function(u,p,z){var v=this.GetHisto(),A=v.fBins.arr[u],x=this.frame_painter(),y=A.fPoly.fName,B=[],w=0;if(y==="Graph"){y=""}if(y.length===0){y=A.fNumber}if((p===undefined)&&(z===undefined)){p=z=0;var t=A.fPoly,r=1;if(t._typename==="TMultiGraph"){r=A.fPoly.fGraphs.arr.length;t=null}for(var q=0;q<r;++q){if(!t||(q>0)){t=A.fPoly.fGraphs.arr[q]}for(var s=0;s<t.fNpoints;++s){++w;p+=t.fX[s];z+=t.fY[s]}}if(w>1){p=p/w;z=z/w}}B.push(this.GetTipName());B.push("x = "+x.AxisAsText("x",p));B.push("y = "+x.AxisAsText("y",z));if(w>0){B.push("npnts = "+w)}B.push("bin = "+y);if(A.fContent===Math.round(A.fContent)){B.push("content = "+A.fContent)}else{B.push("content = "+g.FFormat(A.fContent,g.gStyle.fStatFormat))}return B};c.prototype.ProcessTooltip=function(U){if(!U||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var E=this.GetHisto(),Q=this.tt_handle,T=this.draw_g.select(".tooltip_bin");if(Q.poly){var z=this.frame_painter(),w,v,s=-1;if(z.grx===z.x){w=z.x.invert(U.x)}if(z.gry===z.y){v=z.y.invert(U.y)}if((w!==undefined)&&(v!==undefined)){var N,P=E.fBins.arr.length,G;for(N=0;(N<P)&&(s<0);++N){G=E.fBins.arr[N];if((w<G.fXmin)||(w>G.fXmax)||(v<G.fYmin)||(v>G.fYmax)){continue}if((G.fContent===0)&&!this.options.Zero){continue}var J=G.fPoly,H=1;if(J._typename==="TMultiGraph"){H=G.fPoly.fGraphs.arr.length;J=null}for(var C=0;C<H;++C){if(!J||(C>0)){J=G.fPoly.fGraphs.arr[C]}if(J.IsInside(w,v)){s=N;break}}}}if(s<0){T.remove();return null}var V={name:E.fName,title:E.fTitle,x:U.x,y:U.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:true,menu:true,lines:this.ProvidePolyBinHints(s,w,v)};if(U.disabled){T.remove();V.changed=true}else{if(T.empty()){T=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")}V.changed=T.property("current_bin")!==s;if(V.changed){T.attr("d",this.CreatePolyBin(z,G)).style("opacity","0.7").property("current_bin",s)}}if(V.changed){V.user_info={obj:E,name:E.fName,bin:s,cont:G.fContent,grx:U.x,gry:U.y}}return V}else{if(Q.candle){var I,N;for(N=0;N<Q.candle.length;++N){I=Q.candle[N];if((I.x1<=U.x)&&(U.x<=I.x2)&&(I.yy1<=U.y)&&(U.y<=I.yy2)){break}}if(N>=Q.candle.length){T.remove();return null}var V={name:E.fName,title:E.fTitle,x:U.x,y:U.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(I),exact:true,menu:true};if(U.disabled){T.remove();V.changed=true}else{if(T.empty()){T=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}V.changed=T.property("current_bin")!==N;if(V.changed){T.attr("x",I.x1).attr("width",I.x2-I.x1).attr("y",I.yy1).attr("height",I.yy2-I.yy1).style("opacity","0.7").property("current_bin",N)}}if(V.changed){V.user_info={obj:E,name:E.fName,bin:N+1,cont:I.median,binx:N+1,biny:1,grx:U.x,gry:U.y}}return V}}var N,M,D=0,x=null,L,K,r,q,R,O,u,t;for(N=Q.i1;N<Q.i2;++N){if((U.x>=Q.grx[N])&&(U.x<=Q.grx[N+1])){break}}for(M=Q.j1;M<Q.j2;++M){if((U.y>=Q.gry[M+1])&&(U.y<=Q.gry[M])){break}}if((N<Q.i2)&&(M<Q.j2)){L=N;K=N+1;r=M;q=M+1;R=Q.grx[L];O=Q.grx[K];u=Q.gry[q];t=Q.gry[r];var y=true;if(this.options.Color){var B=O-R,A=t-u;O=Math.round(R+B*Q.xbar2);R=Math.round(R+B*Q.xbar1);t=Math.round(u+A*Q.ybar2);u=Math.round(u+A*Q.ybar1);if((U.x<R)||(U.x>=O)||(U.y<u)||(U.y>=t)){y=false}}D=E.getBinContent(N+1,M+1);if(this.is_projection){x=0}else{if(!y){x=null}else{if(Q.hide_only_zeros){x=(D===0)&&!this._show_empty_bins?null:0}else{x=this.getContourColor(D,true);if((x===null)&&(D===0)&&this._show_empty_bins){x=0}}}}}if(x===null){T.remove();return null}var V={name:E.fName,title:E.fTitle,x:U.x,y:U.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(N,M),exact:true,menu:true};if(this.options.Color){V.color2=this.GetPalette().getColor(x)}if(U.disabled&&!this.is_projection){T.remove();V.changed=true}else{if(T.empty()){T=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}var F=N*10000+M;if(this.is_projection=="X"){R=0;O=this.frame_width();if(this.projection_width>1){var S=(this.projection_width-1)/2;if(q+S>=Q.j2){q=Math.min(Math.round(q+S),Q.j2);r=Math.max(q-this.projection_width,Q.j1)}else{r=Math.max(Math.round(r-S),Q.j1);q=Math.min(r+this.projection_width,Q.j2)}}u=Q.gry[q];t=Q.gry[r];F=r*777+q*333}else{if(this.is_projection=="Y"){u=0;t=this.frame_height();if(this.projection_width>1){var S=(this.projection_width-1)/2;if(K+S>=Q.i2){K=Math.min(Math.round(K+S),Q.i2);L=Math.max(K-this.projection_width,Q.i1)}else{L=Math.max(Math.round(L-S),Q.i1);K=Math.min(L+this.projection_width,Q.i2)}}R=Q.grx[L],O=Q.grx[K],F=L*777+K*333}}V.changed=T.property("current_bin")!==F;if(V.changed){T.attr("x",R).attr("width",O-R).attr("y",u).attr("height",t-u).style("opacity","0.7").property("current_bin",F)}if(this.is_projection&&V.changed){this.RedrawProjection(L,K,r,q)}}if(V.changed){V.user_info={obj:E,name:E.fName,bin:E.getBin(N+1,M+1),cont:D,binx:N+1,biny:M+1,grx:U.x,gry:U.y}}return V};c.prototype.CanZoomIn=function(r,q,p){if(r=="z"){return true}var s=this.GetHisto();if(s){s=(r=="y")?s.fYaxis:s.fXaxis}return !s||(s.FindBin(p,0.5)-s.FindBin(q,0)>1)};c.prototype.Draw2D=function(r,q){this.Clear3DScene();this.mode3d=false;this.CreateXY();var p=this.DrawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),true);this.DrawAxes();this.DrawBins();if(p){p.DrawPave()}this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();g.CallBack(r)};c.prototype.Draw3D=function(q,p){this.mode3d=true;g.AssertPrerequisites("hist3d",function(){this.Draw3D(q,p)}.bind(this))};c.prototype.CallDrawFunc=function(t,s){var q=this.main_painter(),r=this.frame_painter();if((q!==this)&&r&&(r.mode3d!==this.options.Mode3D)){this.CopyOptionsFrom(q)}var p=this.options.Mode3D?"Draw3D":"Draw2D";this[p](t,s)};c.prototype.Redraw=function(p){this.CallDrawFunc(null,p)};function i(s,q,r){var p=new g.TH2Painter(q);p.SetDivId(s,1);p.DecodeOptions(r);if(p.IsTH2Poly()){if(p.options.Mode3D){p.options.Lego=12}else{if(!p.options.Color){p.options.Color=true}}}p._show_empty_bins=false;p._can_move_colz=true;p.CheckPadRange(!p.options.Mode3D&&(p.options.Contour!=14));p.ScanContent();p.CreateStat();p.CallDrawFunc(function(){this.DrawNextFunction(0,function(){if(!this.Mode3D&&this.options.AutoZoom){this.AutoZoom()}this.FillToolbar();if(this.options.Project&&!this.mode3d){this.ToggleProjection(this.options.Project)}this.DrawingReady()}.bind(this))}.bind(p));return p}function j(p){g.TObjectPainter.call(this,p);this.nostack=false;this.firstpainter=null;this.painters=[]}j.prototype=Object.create(g.TObjectPainter.prototype);j.prototype.Cleanup=function(){delete this.firstpainter;delete this.painters;g.TObjectPainter.prototype.Cleanup.call(this)};j.prototype.HasErrors=function(p){if(p.fSumw2&&(p.fSumw2.length>0)){for(var q=0;q<p.fSumw2.length;++q){if(p.fSumw2[q]>0){return true}}}return false};j.prototype.BuildStack=function(){var r=this.GetObject();if(!r.fHists){return false}var q=r.fHists.arr.length;if(q<=0){return false}var p=g.Create("TList");p.Add(g.clone(r.fHists.arr[0]),r.fHists.opt[0]);this.haserrors=this.HasErrors(r.fHists.arr[0]);for(var u=1;u<q;++u){var s=g.clone(r.fHists.arr[u]),w=r.fHists.opt[u],t=p.arr[u-1];if((s.fNbins!=t.fNbins)||(s.fXaxis.fXmin!=t.fXaxis.fXmin)||(s.fXaxis.fXmax!=t.fXaxis.fXmax)){g.console("When drawing THStack, cannot sum-up histograms "+s.fName+" and "+t.fName);p.Clear();return false}this.haserrors=this.haserrors||this.HasErrors(r.fHists.arr[u]);for(var v=0;v<s.fArray.length;++v){s.fArray[v]+=t.fArray[v]}p.Add(s,w)}r.fStack=p;return true};j.prototype.GetHistMinMax=function(x,A){var y={min:0,max:0},z=true,p=true;if(x.fMinimum!==-1111){y.min=x.fMinimum;z=false}if(x.fMaximum!==-1111){y.max=x.fMaximum;p=false}if(!z&&!p){return y}var t=1,r=x.fXaxis.fNbins,C=1,B=1,w=true;if(x.fXaxis.TestBit(g.EAxisBits.kAxisRange)){t=x.fXaxis.fFirst;r=x.fXaxis.fLast}if(x._typename.indexOf("TH2")===0){B=x.fYaxis.fNbins;if(x.fYaxis.TestBit(g.EAxisBits.kAxisRange)){C=x.fYaxis.fFirst;B=x.fYaxis.fLast}}for(var u=C;u<=B;++u){for(var v=t;v<=r;++v){var q=x.getBinContent(v,u),s=A?x.getBinError(x.getBin(v,u)):0;if(z&&(w||(q-s<y.min))){y.min=q-s}if(p&&(w||(q+s>y.max))){y.max=q+s}w=false}}return y};j.prototype.GetMinMax=function(s,u){var r={min:0,max:0},p=this.GetObject();if(this.nostack){for(var q=0;q<p.fHists.arr.length;++q){var t=this.GetHistMinMax(p.fHists.arr[q],s);if(q==0){r=t}else{r.min=Math.min(r.min,t.min);r.max=Math.max(r.max,t.max)}}}else{r.min=this.GetHistMinMax(p.fStack.arr[0],s).min;r.max=this.GetHistMinMax(p.fStack.arr[p.fStack.arr.length-1],s).max}if(p.fMaximum!=-1111){r.max=p.fMaximum}r.max*=1.05;if(p.fMinimum!=-1111){r.min=p.fMinimum}if(u){if(u.fLogy){if(r.min<0){r.min=r.max*0.0001}}else{if((r.min>0)&&(r.min<0.05*r.max)){r.min=0}}}return r};j.prototype.DrawNextHisto=function(v,p,s,t,u){if(s==="callback"){s=null;if(v<0){this.firstpainter=t}else{this.painters.push(t)}v++}var z=this.GetObject(),y=z.fHistogram,B="",q=this.nostack?z.fHists:z.fStack,A=(q&&q.arr)?q.arr.length:0,x=0;if(v>=A){this._pfc=this._plc=this._pmc=false;return this.DrawingReady()}if((v%500===499)&&!u){return setTimeout(this.DrawNextHisto.bind(this,v,p,s,t,true),0)}if(v>=0){x=this.horder?v:A-v-1;y=q.arr[x];B=q.opt[x]||y.fOption||p;if(B.toUpperCase().indexOf(p)<0){B+=p}if(this.draw_errors&&!B){B="E"}B+=" same nostat";if(this._pfc||this._plc||this._pmc){if(!this.pallette&&g.Painter.GetColorPalette){this.palette=g.Painter.GetColorPalette()}if(this.palette){var r=this.palette.calcColor(x,A+1);var w=this.add_color(r);if(this._pfc){y.fFillColor=w}if(this._plc){y.fLineColor=w}if(this._pmc){y.fMarkerColor=w}}}}else{B=(p||"")+" axis";if(s){B+=";minimum:"+s.min+";maximum:"+s.max}}if((x>0)&&!this.nostack){y.$baseh=q.arr[x-1]}g.draw(this.divid,y,B,this.DrawNextHisto.bind(this,v,p,"callback"))};j.prototype.drawStack=function(p){var E=this.root_pad(),s=this.GetObject(),r=s.fHists,G=r.arr.length,q=1;if((G>0)&&(r.arr[0]._typename.indexOf("TH2")==0)){q=2}if((q==2)&&!p){p="lego1"}var F=new g.DrawOptions(p),t=F.check("SAME");this.nostack=F.check("NOSTACK");if(F.check("STACK")){this.nostack=false}this._pfc=F.check("PFC");this._plc=F.check("PLC");this._pmc=F.check("PMC");p=F.remain();if(!this.nostack){this.nostack=!this.BuildStack()}this.dolego=F.check("LEGO");if(!this.nostack&&this.haserrors&&!this.dolego&&!F.check("HIST")&&(p.indexOf("E")<0)){this.draw_errors=true}this.horder=this.nostack||this.dolego;var C=this.GetMinMax(F.check("E"),E);var u=s.fHistogram;if(!u){var v=0,x=0,z=0,D=0;for(var A=0;A<G;++A){var B=r.arr[A];if(A==0||B.fXaxis.fXmin<v){v=B.fXaxis.fXmin}if(A==0||B.fXaxis.fXmax>x){x=B.fXaxis.fXmax}if(A==0||B.fYaxis.fXmin<z){z=B.fYaxis.fXmin}if(A==0||B.fYaxis.fXmax>D){D=B.fYaxis.fXmax}}var B=s.fHists.arr[0];u=g.CreateHistogram((q==1)?"TH1I":"TH2I",B.fXaxis.fNbins,B.fYaxis.fNbins);u.fName="axis_hist";u.fXaxis=g.clone(B.fXaxis);u.fYaxis=g.clone(B.fYaxis);u.fXaxis.fXmin=v;u.fXaxis.fXmax=x;u.fYaxis.fXmin=z;u.fYaxis.fXmax=D;s.fHistogram=u}u.fTitle=s.fTitle;if(E&&E.fLogy){if(C.max<=0){C.max=1}if(C.min<=0){C.min=0.0001*C.max}var w=1/(1+0.5*g.log10(C.max/C.min)),y=1+0.2*g.log10(C.max/C.min);C.min*=w;C.max*=y}this.DrawNextHisto(!t?-1:0,p,C);return this};j.prototype.UpdateObject=function(u){if(!this.MatchObjectType(u)){return false}var q=this.nostack?u.fHists:u.fStack;if(!q){return false}var s=false;if(this.firstpainter){if(this.firstpainter.UpdateObject(u.fHistogram)){s=true}}var p=Math.min(q.arr.length,this.painters.length);for(var r=0;r<p;++r){var t=q.arr[this.horder?r:p-r-1];if(this.painters[r].UpdateObject(t)){s=true}}return s};function a(s,p,r){var q=new j(p);q.SetDivId(s,-1);if(!p.fHists||(p.fHists.arr.length==0)){return q.DrawingReady()}q.drawStack(r);q.SetDivId(s);return q}function h(z,r,q){var w=null,C=0,A=0,p=1,v=new g.DrawOptions(q);if(v.check("NOSAVE")){p=0}if(!r.fSave||r.fSave.length<7||!p){p=0}else{p=r.fSave.length;C=Math.round(r.fSave[p-2]);A=Math.round(r.fSave[p-1]);if(p!==(C+1)*(A+1)+6){p=0}}if(p>6){var F=(r.fSave[p-5]-r.fSave[p-6])/C/2,E=(r.fSave[p-3]-r.fSave[p-4])/A/2;w=g.CreateHistogram("TH2F",C+1,A+1);w.fXaxis.fXmin=r.fSave[p-6]-F;w.fXaxis.fXmax=r.fSave[p-5]+F;w.fYaxis.fXmin=r.fSave[p-4]-E;w.fYaxis.fXmax=r.fSave[p-3]+E;for(var s=0,t=0;t<=A;++t){for(var u=0;u<=C;++u){w.setBinContent(w.getBin(u+1,t+1),r.fSave[s++])}}}else{C=Math.max(r.fNpx,2);A=Math.max(r.fNpy,2);w=g.CreateHistogram("TH2F",C,A);w.fXaxis.fXmin=r.fXmin;w.fXaxis.fXmax=r.fXmax;w.fYaxis.fXmin=r.fYmin;w.fYaxis.fXmax=r.fYmax;for(var t=0;t<A;++t){for(var u=0;u<C;++u){var D=r.fXmin+(u+0.5)*(r.fXmax-r.fXmin)/C,B=r.fYmin+(t+0.5)*(r.fYmax-r.fYmin)/A;w.setBinContent(w.getBin(u+1,t+1),r.evalPar(D,B))}}}w.fName="Func";w.fTitle=r.fTitle;w.fMinimum=r.fMinimum;w.fMaximum=r.fMaximum;w.fLineColor=r.fLineColor;w.fLineStyle=r.fLineStyle;w.fLineWidth=r.fLineWidth;w.fFillColor=r.fFillColor;w.fFillStyle=r.fFillStyle;w.fMarkerColor=r.fMarkerColor;w.fMarkerStyle=r.fMarkerStyle;w.fMarkerSize=r.fMarkerSize;w.fBits|=g.TH1StatusBits.kNoStats;if(v.empty()){q="cont3"}else{if(v.opt==="SAME"){q="cont2 same"}else{q=v.opt}}return i(z,w,q)}g.Painter.drawLegend=b;g.Painter.drawPaveText=b;g.Painter.drawPave=b;g.Painter.produceLegend=f;g.Painter.drawPaletteAxis=d;g.Painter.drawHistogram1D=l;g.Painter.drawHistogram2D=i;g.Painter.drawHStack=a;g.Painter.drawTF2=h;g.TPavePainter=k;g.THistPainter=m;g.TH1Painter=e;g.TH2Painter=c;g.THStackPainter=j;return g}));