(function(a){if(typeof define==="function"&&define.amd){define(["JSRootCore","d3","JSRootPainter"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"),require("./JSRootPainter.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.hierarchy.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.hierarchy.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.hierarchy.js")}a(JSROOT,d3)}}}(function(f,m){f.sources.push("hierarchy");function e(r,n,o,q){if(!n||!n.arr){return f.CallBack(q)}var p={divid:r,lst:n,opt:o,indx:-1,callback:q,draw_next:function(){while(++this.indx<this.lst.arr.length){var u={func:this.draw_bind},t=this.lst.arr[this.indx],s=(this.lst.opt&&this.lst.opt[this.indx])?this.lst.opt[this.indx]:this.opt;if(!t){continue}f.draw(this.divid,t,s,u);if(!u.completed){return}}return f.CallBack(this.callback)}};p.draw_bind=p.draw_next.bind(p);p.draw_next()}function j(o,q){if(!q||!("fFolders" in q)||(q.fFolders===null)){return false}if(q.fFolders.arr.length===0){o._more=false;return true}o._childs=[];for(var n=0;n<q.fFolders.arr.length;++n){var p=q.fFolders.arr[n];o._childs.push({_name:p.fName,_kind:"ROOT."+p._typename,_obj:p})}return true}function k(o,q){if(!q||!("fTasks" in q)||(q.fTasks===null)){return false}l(o,q,{exclude:["fTasks","fName"]});if((q.fTasks.arr.length===0)&&(o._childs.length==0)){o._more=false;return true}for(var n=0;n<q.fTasks.arr.length;++n){var p=q.fTasks.arr[n];o._childs.push({_name:p.fName,_kind:"ROOT."+p._typename,_obj:p})}return true}function g(o,v){if(!f.IsRootCollection(v)){return false}if((v.arr===undefined)||(v.arr.length===0)){o._more=false;return true}var n=false,r=o;while(r){if(r._do_context){n=true}r=r._parent}var z=(v._typename=="TMap"),x=[],q=[],s=[];for(var u=0;u<v.arr.length;++u){var t=z?v.arr[u].first:v.arr[u];if(!t){continue}var p=t.fName||t.name;if(!p){continue}var w=x.indexOf(p);if(w>=0){q[w]++}else{q[x.length]=s[x.length]=1;x.push(p)}}o._childs=[];for(var u=0;u<v.arr.length;++u){var t=z?v.arr[u].first:v.arr[u];var y;if(!t||!t._typename){y={_name:u.toString(),_kind:"ROOT.NULL",_title:"NULL",_value:"null",_obj:null}}else{y={_name:t.fName||t.name,_kind:"ROOT."+t._typename,_title:(t.fTitle||"")+" type:"+t._typename,_obj:t};switch(t._typename){case"TColor":y._value=f.Painter.MakeColorRGB(t);break;case"TText":y._value=t.fTitle;break;case"TLatex":y._value=t.fTitle;break;case"TObjString":y._value=t.fString;break;default:if(v.opt&&v.opt[u]&&v.opt[u].length){y._value=v.opt[u]}}if(n&&f.canDraw(t._typename)){y._direct_context=true}if(!y._name||(!isNaN(parseInt(y._name))&&(parseInt(y._name)!==u))||(v.arr.indexOf(t)<u)){y._name=u.toString()}else{var w=x.indexOf(t.fName);if((w>=0)&&(q[w]>1)){y._cycle=s[w]++;y._keyname=y._name;y._name=y._keyname+";"+y._cycle}}}o._childs.push(y)}return true}function a(t,s,q,u){if(s===undefined){return false}t._childs=[];for(var p=0;p<s.length;++p){var o=s[p];var r={_name:o.fName+";"+o.fCycle,_cycle:o.fCycle,_kind:"ROOT."+o.fClassName,_title:o.fTitle,_keyname:o.fName,_readobj:null,_parent:t};if(o.fObjlen>100000){r._title+=" (size: "+(o.fObjlen/1000000).toFixed(1)+"MB)"}if("fRealName" in o){r._realname=o.fRealName+";"+o.fCycle}if(o.fClassName=="TDirectory"||o.fClassName=="TDirectoryFile"){var n=null;if((u!=null)&&(q!=null)){n=q.GetDir(u+o.fName)}if(n==null){r._more=true;r._expand=function(v,w){return a(v,w.fKeys)}}else{r._name=o.fName;a(r,n.fKeys,q,u+o.fName+"/")}}else{if((o.fClassName=="TList")&&(o.fName=="StreamerInfo")){r._name="StreamerInfo";r._kind="ROOT.TStreamerInfoList";r._title="List of streamer infos for binary I/O";r._readobj=q.fStreamerInfos}}t._childs.push(r)}return true}function l(x,v,p){if(!x||(v===null)){return false}x._childs=[];var y=Object.prototype.toString.apply(v);if(y==="[object DataView]"){var I={_parent:x,_name:"size",_value:v.byteLength.toString(),_vclass:"h_value_num"};x._childs.push(I);var t=(v.byteLength<10)?1:f.log10(v.byteLength);for(var A=0;A<v.byteLength;++A){if(A%16===0){I={_parent:x,_name:A.toString(),_value:"",_vclass:"h_value_num"};while(I._name.length<t){I._name="0"+I._name}x._childs.push(I)}var O=v.getUint8(A).toString(16);while(O.length<2){O="0"+O}if(I._value.length>0){I._value+=(A%4===0)?" | ":" "}I._value+=O}return true}var N=true,J=false,B=x;while(B){if(B._do_context){J=true}if("_nosimple" in B){N=B._nosimple;break}B=B._parent}var q=(y.lastIndexOf("Array]")==y.length-6)&&(y.indexOf("[object")==0)&&!isNaN(v.length),E=q&&(v.length>f.gStyle.HierarchyLimit),L=false;if(q&&(x._name==="Object")&&!x._parent){x._name="Array"}if(E){L=true;for(var A=0;A<v.length;++A){var K=typeof v[A];if((K==="number")||(K==="boolean")||(K=="string"&&(v[A].length<16))){continue}L=false;break}}if(!("_obj" in x)){x._obj=v}else{if(x._obj!==v){alert("object missmatch")}}if(!x._title){if(v._typename){x._title="ROOT."+v._typename}else{if(q){x._title="Array len: "+v.length}}}if(L){for(var A=0;A<v.length;){var w=Math.min(A+10,v.length),u=true,G=A;while(u){u=true;for(var H=G;H<w;++H){if(v[A]!==v[H]){u=false}}if(u){if(w===v.length){break}G=w;w=Math.min(w+10,v.length)}else{if(G!==A){w=G;u=true;break}}}var I={_parent:x,_name:A+".."+(w-1),_vclass:"h_value_num"};if(u){I._value=v[A].toString()}else{I._value="";for(var H=A;H<w;++H){I._value+=((H===A)?"[ ":", ")+v[H].toString()}I._value+=" ]"}x._childs.push(I);A=w}return true}var r,o,s,D;for(var M in v){if((M=="_typename")||(M[0]=="$")){continue}var n=v[M];if(typeof n=="function"){continue}if(p&&p.exclude&&(p.exclude.indexOf(M)>=0)){continue}if(E&&r){if(s===n){++D;o=M;continue}if(D>0){r._name+=".."+o}}var I={_parent:x,_name:M};if(E){r=I;o=M;s=n;D=0}if(n===null){I._value=I._title="null";if(!N){x._childs.push(I)}continue}var z=false;if(typeof n=="object"){y=Object.prototype.toString.apply(n);if((y.lastIndexOf("Array]")==y.length-6)&&(y.indexOf("[object")==0)){I._title="array len="+n.length;z=(y!="[object Array]");if(n.length===0){I._value="[ ]";I._more=false}else{I._value="[...]";I._more=true;I._expand=l;I._obj=n}}else{if(y==="[object DataView]"){I._title="DataView len="+n.byteLength;I._value="[...]";I._more=true;I._expand=l;I._obj=n}else{if(y==="[object Date]"){I._more=false;I._title="Date";I._value=n.toString();I._vclass="h_value_num"}else{if(n.$kind||n._typename){I._kind=I._title="ROOT."+(n.$kind||n._typename)}if(n._typename){I._title=n._typename;if(J&&f.canDraw(n._typename)){I._direct_context=true}}var F=x,C=false;while(F&&!C){C=(F._obj===n);F=F._parent}if(C){I._value="{ prnt }";I._vclass="h_value_num";I._more=false;z=true}else{I._obj=n;I._more=false;switch(n._typename){case"TColor":I._value=f.Painter.MakeColorRGB(n);break;case"TText":I._value=n.fTitle;break;case"TLatex":I._value=n.fTitle;break;case"TObjString":I._value=n.fString;break;default:if(f.IsRootCollection(n)&&(typeof n.arr==="object")){I._value=n.arr.length?"[...]":"[]";I._title+=", size:"+n.arr.length;if(n.arr.length>0){I._more=true}}else{I._more=true;I._value="{ }"}}}}}}}else{if((typeof n==="number")||(typeof n==="boolean")){z=true;if(M=="fBits"){I._value="0x"+n.toString(16)}else{I._value=n.toString()}I._vclass="h_value_num"}else{if(typeof n==="string"){z=true;I._value="&quot;"+n.replace(/\&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"&quot;";I._vclass="h_value_str"}else{if(typeof n==="undefined"){z=true;I._value="undefined";I._vclass="h_value_num"}else{z=true;alert("miss "+M+"  "+typeof n)}}}}if(!z||!N){x._childs.push(I)}}if(E&&r&&(D>0)){r._name+=".."+o}return true}function d(p,n,o){this.gui_div=p;this.hpainter=n;this.objpainter=o;this.browser_kind=null}d.prototype.main=function(){return m.select("#"+this.gui_div)};d.prototype.drawing_divid=function(){return this.gui_div+"_drawing"};d.prototype.CheckResize=function(){if(this.hpainter&&(typeof this.hpainter.CheckResize=="function")){this.hpainter.CheckResize()}else{if(this.objpainter&&(typeof this.objpainter.CheckResize=="function")){this.objpainter.CheckResize(true)}}};d.prototype.Create=function(o){var n=this.main();n.append("div").attr("id",this.drawing_divid()).classed("jsroot_draw_area",true).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0);if(o){n.append("div").classed("jsroot_browser",true)}};d.prototype.CreateBrowserBtns=function(){var n=this.main().select(".jsroot_browser");if(n.empty()){return}var o=n.append("div").classed("jsroot_browser_btns",true).classed("jsroot",true);o.style("position","absolute").style("left","7px").style("top","7px");if(f.touches){o.style("opacity","0.2")}return o};d.prototype.RemoveBrowserBtns=function(){this.main().select(".jsroot_browser").select(".jsroot_browser_btns").remove()};d.prototype.SetBrowserContent=function(o){var n=m.select("#"+this.gui_div+" .jsroot_browser");if(n.empty()){return}n.insert("div",".jsroot_browser_btns").classed("jsroot_browser_area",true).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("width","250px").style("padding-left","5px").style("display","flex").style("flex-direction","column").html("<p class='jsroot_browser_title'>title</p>"+o)};d.prototype.HasContent=function(){var n=m.select("#"+this.gui_div+" .jsroot_browser");if(n.empty()){return false}return !n.select(".jsroot_browser_area").empty()};d.prototype.DeleteContent=function(){var n=m.select("#"+this.gui_div+" .jsroot_browser");if(n.empty()){return}n.selectAll("*").remove();delete this.browser_visible};d.prototype.HasStatus=function(){var n=m.select("#"+this.gui_div+" .jsroot_browser");if(n.empty()){return false}var p=this.gui_div+"_status",o=m.select("#"+p);return !o.empty()};d.prototype.CreateStatusLine=function(n,p){if(!this.gui_div){return""}var o=this;f.AssertPrerequisites("jq2d",function(){o.CreateStatusLine(n,p)});return this.gui_div+"_status"};f.hpainter=null;function c(n,o,p){f.TBasePainter.call(this);this.name=n;this.h=null;this.with_icons=true;this.background=p;this.files_monitoring=(o==null);this.nobrowser=(o===null);if(!this.nobrowser){this.SetDivId(o)}if(!f.hpainter){f.hpainter=this}}c.prototype=Object.create(f.TBasePainter.prototype);c.prototype.Cleanup=function(){this.clear(true);f.TBasePainter.prototype.Cleanup.call(this);if(f.hpainter===this){f.hpainter=null}};c.prototype.FileHierarchy=function(o){var n=this;var p={_name:o.fFileName,_title:(o.fTitle?(o.fTitle+", path "):"")+o.fFullURL,_kind:"ROOT.TFile",_file:o,_fullurl:o.fFullURL,_localfile:o.fLocalFile,_had_direct_read:false,_get:function(r,u,t){var q=this;if(r&&r._readobj){return f.CallBack(t,r,r._readobj)}if(r!=null){u=n.itemFullName(r,q)}function s(v){if(!q._file){q._file=v}if(v==null){return f.CallBack(t,r,null)}v.ReadObject(u,function(y){if(!r&&y){var z=n.Find({name:u,top:q,last_exists:true,check_keys:true});if((z!=null)&&("last" in z)&&(z.last!=q)){var w=v.GetDir(n.itemFullName(z.last,q));if(w){z.last._name=z.last._keyname;var x=n.itemFullName(z.last,q);a(z.last,w.fKeys,v,x+"/")}}else{a(q,v.fKeys,v,"")}r=n.Find({name:u,top:q})}if(r){r._readobj=y;if("_expand" in r){r._name=r._keyname}}f.CallBack(t,r,y)})}if(q._file){s(q._file)}else{if(q._localfile){new f.TLocalFile(q._localfile,s)}else{if(q._fullurl){new f.TFile(q._fullurl,s)}}}}};a(p,o.fKeys,o,"");return p};c.prototype.ForEach=function(p,o){if(!o){o=this.h}if(!o||(typeof p!="function")){return}function n(q){p(q);if("_childs" in q){for(var r=0;r<q._childs.length;++r){q._childs[r]._parent=q;n(q._childs[r])}}}n(o)};c.prototype.Find=function(n){function o(w,A){if(!A||(A.length==0)||!w){return w}var v=A.length;if(!w._parent&&(w._kind!=="TopFolder")&&(A.indexOf(w._name)===0)){if(A===w._name){return w}var u=w._name.length;if(A[u]=="/"){A=A.substr(u+1);v=A.length}}function x(D,C){if(!C){D._parent=w}if((v>=A.length-1)||(v<0)){return D}return o(D,A.substr(v+1))}while(v>0){var z=(v>=A.length)?A:A.substr(0,v);if(w._childs){for(var s=0;s<w._childs.length;++s){if(w._childs[s]._name==z){return x(w._childs[s])}}if((w._kind==="TopFolder")&&(w._childs[0]._online!==undefined)){for(var s=0;s<w._childs[0]._childs.length;++s){if(w._childs[0]._childs[s]._name==z){return x(w._childs[0]._childs[s],true)}}}if(n.check_keys){var y=null;for(var s=0;s<w._childs.length;++s){if(w._childs[s]._keyname===z){if(!y||(y._cycle<w._childs[s]._cycle)){y=w._childs[s]}}}if(y){return x(y)}}var B=n.allow_index;if((z[0]==="[")&&(z[z.length-1]==="]")&&!isNaN(parseInt(z.substr(1,z.length-2)))){B=true;z=z.substr(1,z.length-2)}if(B){var t=parseInt(z);if(!isNaN(t)&&(t>=0)&&(t<w._childs.length)){return x(w._childs[t])}}}v=A.lastIndexOf("/",v-1)}if(n.force){if(w._childs===undefined){w._childs=[]}v=A.indexOf("/");var r={_name:((v<0)?A:A.substr(0,v))};w._childs.push(r);return x(r)}return(n.last_exists&&w)?{last:w,rest:A}:null}var p=this.h,q="";if(n===null){return null}else{if(typeof n=="string"){q=n;n={}}else{if(typeof n=="object"){q=n.name;if("top" in n){p=n.top}}else{return null}}}if(q==="__top_folder__"){return p}if((typeof q=="string")&&(q.indexOf("img:")==0)){return null}return o(p,q)};c.prototype.itemFullName=function(p,q,o){if(p&&p._kind==="TopFolder"){return"__top_folder__"}var n="";while(p){if((p._online!==undefined)&&!q){return n}if((p===q)||(p._kind==="TopFolder")){break}if(o&&!p._parent){break}if(n.length>0){n="/"+n}n=p._name+n;p=p._parent}return n};c.prototype.ExecuteCommand=function(s,v){var w=this.Find(s),o=this.GetOnlineItemUrl(w)+"/cmd.json",p=this,r=m.select((typeof v=="function")?undefined:v);if("_numargs" in w){for(var q=0;q<w._numargs;++q){var t="arg"+(q+1),u=null;if(q+2<arguments.length){u=arguments[q+2]}if(!u&&(typeof v=="object")){u=prompt("Input argument "+t+" for command "+w._name,"")}if(!u){return}o+=((q==0)?"?":"&")+t+"="+u}}if(!r.empty()){r.style("background","yellow");if(w&&w._title){r.attr("title","Executing "+w._title)}}f.NewHttpRequest(o,"text",function(x){if(typeof v=="function"){return v(x)}if(r.empty()){return}var n=((x!=null)&&(x!="false"))?"green":"red";if(w&&w._title){r.attr("title",w._title+" lastres="+x)}r.style("background",n);setTimeout(function(){r.style("background","")},2000);if((n=="green")&&("_hreload" in w)){p.reload()}if((n=="green")&&("_update_item" in w)){p.updateItems(w._update_item.split(";"))}}).send()};c.prototype.RefreshHtml=function(o){if(!this.divid){return f.CallBack(o)}var n=this;f.AssertPrerequisites("jq2d",function(){n.RefreshHtml(o)})};c.prototype.get=function(s,o,v){if(s===null){return f.CallBack(o,null,null)}var p,r,n=this;if(typeof s==="string"){p=s}else{if(typeof s==="object"){if((s._parent!==undefined)&&(s._name!==undefined)&&(s._kind!==undefined)){r=s}else{if(s.name!==undefined){p=s.name}else{if(s.arg!==undefined){p=s.arg}else{if(s.item!==undefined){r=s.item}}}}}}if((typeof p=="string")&&(p.indexOf("img:")==0)){return f.CallBack(o,null,{_typename:"TJSImage",fName:p.substr(4)})}if(r){p=this.itemFullName(r)}else{r=this.Find({name:p,allow_index:true,check_keys:true})}var q=(r!=null)?null:this.Find({name:p,last_exists:true,check_keys:true,allow_index:true});if((q!==null)&&("last" in q)&&(q.last!==null)){var t=this.itemFullName(q.last);if((typeof s=="object")&&("rest" in s)){if((s.rest==q.rest)||(s.rest.length<=q.rest.length)){return f.CallBack(o)}}return this.expand(t,function(x){if(!x){f.CallBack(o)}var w=n.itemFullName(q.last);if(w.length>0){w+="/"}n.get({name:w+q.rest,rest:q.rest},o,v)},null,true)}if((r!==null)&&(typeof r._obj=="object")){return f.CallBack(o,r,r._obj)}var u=r;while(u){if(("_get" in u)&&(typeof u._get=="function")){return u._get(r,null,o,v)}u=("_parent" in u)?u._parent:null}f.CallBack(o,r,null)};c.prototype.draw=function(p,o,n){return f.draw(p,o,n)};c.prototype.redraw=function(p,o,n){return f.redraw(p,o,n)};c.prototype.player=function(r,n,q){var o=this.Find(r);if(!o||!o._player){return f.CallBack(q,null)}var p=this;f.AssertPrerequisites(o._prereq||"",function(){var s=f.findFunction(o._player);if(!s){return f.CallBack(q,null)}p.CreateDisplay(function(u){var t=u?s(p,r,n):null;f.CallBack(q,t)})})};c.prototype.canDisplay=function(o,n){if(!o){return false}if(o._player){return true}if(o._can_draw!==undefined){return o._can_draw}if(n=="inspect"){return true}var p=f.getDrawHandle(o._kind,n);return p&&(("func" in p)||("draw_field" in p))};c.prototype.isItemDisplayed=function(o){var n=this.GetDisplay();if(!n){return false}return n.FindFrame(o)!==null};c.prototype.display=function(u,w,o){var r=this,x=null,v=false,z=null,s=u,t=u,q="::_display_on_frame_::",n=w?w.indexOf(q):-1;if(n>=0){t=w.substr(n+q.length);w=w.substr(0,n)}function y(p){if(!v){f.progress()}if(p&&(typeof p==="object")&&(typeof p.SetItemName==="function")){p.SetItemName(s,v?null:w,r);if(z&&!z._painter){z._painter=p}}f.CallBack(o,p||x,s)}r.CreateDisplay(function(B){if(!B){return y()}z=r.Find(s);if(z&&("_player" in z)){return r.player(s,w,y)}v=(typeof(w)=="string")&&(w.indexOf("update:")==0);if(v){w=w.substr(7);if(!z||z._doing_update){return y()}z._doing_update=true}if(z&&!r.canDisplay(z,w)){return y()}var A="";if((typeof(w)=="string")&&(w.indexOf("divid:")>=0)){var p=w.indexOf("divid:");A=w.slice(p+6);w=w.slice(0,p)}if(!v){f.progress("Loading "+s)}r.get(s,function(C,D){if(!v){f.progress()}if(!z){z=C}if(v&&z){delete z._doing_update}if(!D){return y()}if(!v){f.progress("Drawing "+s)}if(A.length>0){return(v?f.redraw:f.draw)(A,D,w,y)}B.ForEachPainter(function(G,H){if(G.GetItemName()!=s){return}if(!v&&(w!=null)&&(G.GetItemDrawOpt()!=w)){return}B.ActivateFrame(H);var F=null;if(D._typename){F=f.getDrawHandle("ROOT."+D._typename)}if(F&&F.draw_field&&D[F.draw_field]){D=D[F.draw_field]}if(G.RedrawObject(D)){x=G}});if(x){return y()}if(v){f.console("something went wrong - did not found painter when doing update of "+s);return y()}var E=B.FindFrame(t,true);m.select(E).html("");B.ActivateFrame(E);f.draw(m.select(E).attr("id"),D,w,y);if(f.gStyle.DragAndDrop){r.enable_dropping(E,s)}},w)})};c.prototype.enable_dragging=function(n,o){};c.prototype.enable_dropping=function(n,o){};c.prototype.dropitem=function(s,r,n,p){var o=this;if(n&&typeof n==="function"){p=n;n=""}if(n===undefined){n=""}function q(t){if(t&&(typeof t==="object")){t.SetItemName(s,null,o)}f.CallBack(p)}if(s=="$legend"){return f.AssertPrerequisites("v6;hist",function(){var t=f.Painter.produceLegend(r,n);f.CallBack(q,t)})}o.get(s,function(t,u){if(!u){return f.CallBack(p)}var v=f.GetMainPainter(r);if(v&&(typeof v.PerformDrop==="function")){return v.PerformDrop(u,s,t,n,q)}if(v&&v.accept_drops){return f.draw(r,u,"same "+n,q)}o.CleanupFrame(r);return f.draw(r,u,n,q)});return true};c.prototype.updateItems=function(n){if(!this.disp||!n){return}var o=[],p=[];this.disp.ForEachPainter(function(q){var r=q.GetItemName();if(!r||(o.indexOf(r)>=0)){return}if(typeof n=="array"){if(n.indexOf(r)<0){return}}else{if(n!=r){return}}o.push(r);p.push("update:"+q.GetItemDrawOpt())},true);if(o.length>0){this.displayAll(o,p)}};c.prototype.updateAll=function(p,q){if(!this.disp){return}if(p==="monitoring"){p=!this._monitoring_on}var s=[],o=[],r=this;this.disp.ForEachPainter(function(x){var y=x.GetItemName(),t=x.GetItemDrawOpt();if((typeof y!="string")||(s.indexOf(y)>=0)){return}var v=r.Find(y),u=false;if(!v||("_not_monitor" in v)||("_player" in v)){return}if("_always_monitor" in v){u=true}else{var w=f.getDrawHandle(v._kind);if(w&&("monitor" in w)){if((w.monitor===false)||(w.monitor=="never")){return}if(w.monitor==="always"){u=true}}}if(u||!p){s.push(y);o.push("update:"+t)}},true);var n=this;if(this.files_monitoring&&!p){this.ForEachRootFile(function(t){n.ForEach(function(u){delete u._readobj},t);delete t._file})}if(s.length>0){this.displayAll(s,o)}};c.prototype.displayAll=function(y,r,A){if(!y||(y.length==0)){return f.CallBack(A)}var G=this;if(!r){r=[]}while(r.length<y.length){r.push("")}if((r.length==1)&&(r[0]=="iotest")){G.clear();m.select("#"+G.disp_frameid).html("<h2>Start I/O test</h2>");var t=new Date();return G.get(y[0],function(p,L){var n=new Date();m.select("#"+G.disp_frameid).append("h2").html("Item "+y[0]+" reading time = "+(n.getTime()-t.getTime())+"ms");return f.CallBack(A)})}var s=new Array(y.length),I=new Array(y.length),v=new Array(y.length);for(var F=0;F<y.length;++F){s[F]=I[F]=null;var J=y[F],C=true;if(J&&J.indexOf("img:")==0){v[F]=true;continue}if(J&&(J.length>1)&&(J[0]=="'")&&(J[J.length-1]=="'")){y[F]=J.substr(1,J.length-2);C=false}var H=G.Find({name:y[F],check_keys:true});if(H){y[F]=G.itemFullName(H);continue}if(C&&(y[F][0]=="[")&&(y[F][y[F].length-1]=="]")){s[F]=f.ParseAsArray(y[F]);y[F]=s[F].shift()}else{if(C&&(y[F].indexOf("+")>0)){s[F]=y[F].split("+");y[F]=s[F].shift()}}if(s[F]&&s[F].length>0){for(var E=0;E<s[F].length;++E){var u=s[F][E].indexOf("_same_");if((u>0)&&(G.Find(s[F][E])===null)){s[F][E]=s[F][E].substr(0,u)+y[F].substr(u)}H=G.Find({name:s[F][E],check_keys:true});if(H){s[F][E]=G.itemFullName(H)}}if((r[F][0]=="[")&&(r[F][r[F].length-1]=="]")){I[F]=f.ParseAsArray(r[F]);r[F]=I[F].shift()}else{if(r[F].indexOf("+")>0){I[F]=r[F].split("+");r[F]=I[F].shift()}else{I[F]=[]}}while(I[F].length<s[F].length){I[F].push("")}}var u=y[F].indexOf("_same_");if((u>0)&&!G.Find(y[F])&&(F>0)){y[F]=y[F].substr(0,u)+y[0].substr(u)}H=G.Find({name:y[F],check_keys:true});if(H){y[F]=G.itemFullName(H)}}for(var B=y.length-1;B>=0;--B){if(v[B]){continue}var q=G.Find(y[B]);if(!q||G.canDisplay(q,r[B])){continue}G.expand(y[B],null,null,true);y.splice(B,1);r.splice(B,1);s.splice(B,1)}if(y.length==0){return f.CallBack(A)}var w=new Array(y.length),o=new Array(y.length);for(var B=0;B<y.length;++B){o[B]=0;var K=y[B],D=0;if(y.indexOf(K)<B){o[B]=true}var z=r[B].indexOf("frameid:");if(z>=0){K=r[B].substr(z+8);r[B]=r[B].substr(0,z)}else{while(w.indexOf(K)>=0){K=y[B]+"_"+D++}}w[B]=K}for(var B=0;B<y.length;++B){if(o[B]!==0){continue}var x=B;for(var D=0;D<y.length;++D){if((y[B]===y[D])&&(r[D].indexOf("main")>=0)){x=D}}for(var D=0;D<y.length;++D){if(y[B]===y[D]){o[D]=(x!=D)}}}G.CreateDisplay(function(L){if(!L){return f.CallBack(A)}for(var p=0;p<y.length;++p){if(r[p].indexOf("update:")!==0){L.CreateFrame(w[p]);r[p]+="::_display_on_frame_::"+w[p]}}function n(P,M){if(M&&s[P]&&(s[P].length>0)){return G.dropitem(s[P].shift(),M.divid,I[P].shift(),n.bind(G,P,M))}s[P]=null;y[P]=null;var O=false;for(var N=0;N<y.length;++N){if(s[N]){O=true}if(y[N]===null){continue}O=true;if(o[N]&&y.indexOf(y[N])===N){o[N]=false;G.display(y[N],r[N],n.bind(G,N))}}if(!O&&A){f.CallBack(A);A=null}}for(var p=0;p<y.length;++p){if(!o[p]){G.display(y[p],r[p],n.bind(G,p))}}})};c.prototype.reload=function(){var n=this;if("_online" in this.h){this.OpenOnline(this.h._online,function(){n.RefreshHtml()})}};c.prototype.UpdateTreeNode=function(){};c.prototype.actiavte=function(o,q){if(typeof o=="string"){o=[o]}var s=[],n=this,t=[];this.ForEach(function(u){if(u._background){s.push(u);delete u._background}});function p(){if(typeof n.UpdateBackground!=="function"){return}for(var u=t.length-1;u>=0;--u){n.UpdateTreeNode(t[u])}for(var u=0;u<s.length;++u){n.UpdateBackground(s[u],q)}}function r(y,u){if(y===undefined){if(o.length==0){return p()}y=o.shift()}var v=n.Find(y);if(!v){var x=n.Find({name:y,last_exists:true,check_keys:true,allow_index:true});if(!x||!x.last){return r()}x.now_found=n.itemFullName(x.last);if(q){if((u!==undefined)&&(x.now_found===u)){return r()}return n.expand(x.now_found,function(A){if(!A){return r()}var z=n.itemFullName(x.last);if(z.length>0){z+="/"}r(z+x.rest,x.now_found)})}v=x.last}if(v){var w=v._parent;while(w){if(!w._isopen){if(q){w._isopen=true;if(t.indexOf(w)<0){t.push(w)}}else{v=w;break}}w=w._parent}v._background="grey";if(s.indexOf(v)<0){s.push(v)}}r()}if(q&&this.brlayout){if(!this.brlayout.browser_kind){return this.CreateBrowser("float",true,r)}if(!this.brlayout.browser_visible){this.brlayout.ToggleBrowserVisisbility()}}r()};c.prototype.expand=function(t,q,s,n){var p=this,o=this.Find(t);if(!o&&s){return f.CallBack(q)}function r(v,x,u){if(!u){u=p.itemFullName(v)}var w=v._expand?null:f.getDrawHandle(v._kind,"::expand");if(x&&w&&w.expand_item){x=x[w.expand_item];if(x&&x._typename){w=f.getDrawHandle("ROOT."+x._typename,"::expand")}}if(w&&w.expand){f.AssertPrerequisites(w.prereq,function(){v._expand=f.findFunction(w.expand);if(v._expand){return r(v,x,u)}f.CallBack(q)});return true}if(x&&v&&(typeof v._expand==="function")){if(v._expand(v,x)){v._isopen=true;if(v._parent&&!v._parent._isopen){v._parent._isopen=true;if(!n){p.UpdateTreeNode(v._parent)}}else{if(!n){p.UpdateTreeNode(v,s)}}f.CallBack(q,v);return true}}if(x&&l(v,x)){v._isopen=true;if(v._parent&&!v._parent._isopen){v._parent._isopen=true;if(!n){p.UpdateTreeNode(v._parent)}}else{if(!n){p.UpdateTreeNode(v,s)}}f.CallBack(q,v);return true}return false}if(o){if((o._more===false)||(!o._parent&&o._childs)){return f.CallBack(q)}if(o._childs&&o._isopen){o._isopen=false;if(!n){p.UpdateTreeNode(o,s)}return f.CallBack(q)}if(o._obj&&r(o,o._obj,t)){return}}f.progress("Loading "+t);this.get(t,function(u,v){f.progress();if(v&&r(u,v)){return}f.CallBack(q)},"hierarchy_expand")};c.prototype.GetTopOnlineItem=function(n){if(n){while(n&&(!("_online" in n))){n=n._parent}return n}if(!this.h){return null}if("_online" in this.h){return this.h}if(this.h._childs&&("_online" in this.h._childs[0])){return this.h._childs[0]}return null};c.prototype.ForEachJsonFile=function(p){if(!this.h){return}if("_jsonfile" in this.h){return f.CallBack(p,this.h)}if(this.h._childs){for(var q=0;q<this.h._childs.length;++q){var o=this.h._childs[q];if("_jsonfile" in o){f.CallBack(p,o)}}}};c.prototype.OpenJsonFile=function(q,p){var o=false;this.ForEachJsonFile(function(r){if(r._jsonfile==q){o=true}});if(o){return f.CallBack(p)}var n=this;f.NewHttpRequest(q,"object",function(t){if(!t){return f.CallBack(p)}var s={_jsonfile:q,_kind:"ROOT."+t._typename,_jsontmp:t,_name:q.split("/").pop()};if(t.fTitle){s._title=t.fTitle}s._get=function(v,x,w){if(v._jsontmp){return f.CallBack(w,v,v._jsontmp)}f.NewHttpRequest(v._jsonfile,"object",function(y){v._jsontmp=y;f.CallBack(w,v,v._jsontmp)}).send()};if(n.h==null){n.h=s}else{if(n.h._kind=="TopFolder"){n.h._childs.push(s)}else{var u=n.h,r=("_jsonfile" in u)?"Files":"Items";n.h={_name:r,_kind:"TopFolder",_childs:[u,s]}}}n.RefreshHtml(p)}).send(null)};c.prototype.ForEachRootFile=function(p){if(!this.h){return}if((this.h._kind=="ROOT.TFile")&&this.h._file){return f.CallBack(p,this.h)}if(this.h._childs){for(var q=0;q<this.h._childs.length;++q){var o=this.h._childs[q];if((o._kind=="ROOT.TFile")&&("_fullurl" in o)){f.CallBack(p,o)}}}};c.prototype.OpenRootFile=function(q,p){var o=false;this.ForEachRootFile(function(r){if(r._fullurl===q){o=true}});if(o){return f.CallBack(p)}var n=this;f.progress("Opening "+q+" ...");f.OpenFile(q,function(t){f.progress();if(!t){if(!m.select("#gui_fileCORS").style("background","red").empty()){setTimeout(function(){m.select("#gui_fileCORS").style("background","")},5000)}return f.CallBack(p,false)}var s=n.FileHierarchy(t);s._isopen=true;if(n.h==null){n.h=s;if(n._topname){s._name=n._topname}}else{if(n.h._kind=="TopFolder"){n.h._childs.push(s)}else{var u=n.h,r=(u._kind=="ROOT.TFile")?"Files":"Items";n.h={_name:r,_kind:"TopFolder",_childs:[u,s],_isopen:true}}}n.RefreshHtml(p)})};c.prototype.ApplyStyle=function(n,q){if(!n){return f.CallBack(q)}if(typeof n==="object"){if(n._typename==="TStyle"){f.extend(f.gStyle,n)}return f.CallBack(q)}if(typeof n==="string"){var p=this,o=this.Find({name:n,allow_index:true,check_keys:true});if(o!==null){return this.get(o,function(r,s){p.ApplyStyle(s,q)})}if(n.indexOf(".json")>0){return f.NewHttpRequest(n,"object",function(r){p.ApplyStyle(r,q)}).send(null)}}return f.CallBack(q)};c.prototype.GetFileProp=function(p){var n=this.Find(p);if(n==null){return null}var o=n._name;while(n._parent){n=n._parent;if("_file" in n){return{kind:"file",fileurl:n._file.fURL,itemname:o,localfile:!!n._file.fLocalFile}}if("_jsonfile" in n){return{kind:"json",fileurl:n._jsonfile,itemname:o}}o=n._name+"/"+o}return null};f.MarkAsStreamerInfo=function(n,o,p){if(p&&(p._typename=="TList")){p._typename="TStreamerInfoList"}};c.prototype.GetOnlineItemUrl=function(o){if(typeof o=="string"){o=this.Find(o)}var n=o;while(n&&(n._online===undefined)){n=n._parent}return n?(n._online+this.itemFullName(o,n)):null};c.prototype.isOnlineItem=function(n){return this.GetOnlineItemUrl(n)!==null};c.prototype.GetOnlineItem=function(z,v,x,t){var o=v,r=false,w="",A="object",n=this,q=null;if(t==="hierarchy_expand"){r=true;t=undefined}if(z){o=this.GetOnlineItemUrl(z);var p=null;if("_kind" in z){q=f.getDrawHandle(z._kind)}if(r){w="h.json?compact=3";z._expand=f.Painter.OnlineHierarchy}else{if("_make_request" in z){p=f.findFunction(z._make_request)}else{if((q!=null)&&("make_request" in q)){p=q.make_request}}}if(typeof p=="function"){var u=p(n,z,o,t);if(u!=null){if(typeof u=="string"){w=u}else{if("req" in u){w=u.req}if("kind" in u){A=u.kind}}}}if((w.length==0)&&(z._kind.indexOf("ROOT.")!=0)){w="item.json.gz?compact=3"}}if(!v&&z&&("_cached_draw_object" in this)&&(w.length==0)){var s=this._cached_draw_object;delete this._cached_draw_object;return f.CallBack(x,z,s)}if(w.length==0){w="root.json.gz?compact=23"}if(o.length>0){o+="/"}o+=w;var y=f.NewHttpRequest(o,A,function(D){var C=null;if(!r&&z&&("_after_request" in z)){C=f.findFunction(z._after_request)}else{if(q&&("after_request" in q)){C=q.after_request}}if(typeof C=="function"){var B=C(n,z,D,t,y);if((B!=null)&&(typeof B=="object")){D=B}}f.CallBack(x,z,D)});y.send(null)};f.Painter.OnlineHierarchy=function(o,p){if(p&&o&&("_childs" in p)){for(var q=0;q<p._childs.length;++q){if(p._childs[q]._more||p._childs[q]._childs){p._childs[q]._expand=f.Painter.OnlineHierarchy}}o._childs=p._childs;p._childs=null;return true}return false};c.prototype.OpenOnline=function(p,q){var n=this;function r(t){n.h=t;if(n.h==null){return}if(("_title" in n.h)&&(n.h._title!="")){document.title=n.h._title}t._isopen=true;n.h._online=p;n.h._get=function(w,y,x,v){n.GetOnlineItem(w,y,x,v)};n.h._expand=f.Painter.OnlineHierarchy;var s="",u="";n.ForEach(function(w){if("_childs" in w){w._expand=f.Painter.OnlineHierarchy}if("_autoload" in w){var v=w._autoload.split(";");for(var x=0;x<v.length;++x){if((v[x].length>3)&&((v[x].lastIndexOf(".js")==v[x].length-3)||(v[x].lastIndexOf(".css")==v[x].length-4))){if(s.indexOf(v[x])<0){s+=v[x]+";"}}else{if(u.indexOf(v[x])<0){u+=v[x]+";"}}}}});if(s.length>0){s="user:"+s}f.AssertPrerequisites(u+s,function(){n.ForEach(function(x){if(!("_drawfunc" in x)||!("_kind" in x)){return}var w="kind:"+x._kind;if(x._kind.indexOf("ROOT.")==0){w=x._kind.slice(5)}var v=x._drawopt;if(!f.canDraw(w)||(v!=null)){f.addDrawFunc({name:w,func:x._drawfunc,script:x._drawscript,opt:v})}});f.CallBack(q,n)})}if(!p){p=""}if(typeof p=="object"){var o=p;p="";return r(o)}f.NewHttpRequest(p+"h.json?compact=3","object",r).send(null)};c.prototype.GetOnlineProp=function(p){var n=this.Find(p);if(!n){return null}var o=n._name;while(n._parent){n=n._parent;if("_online" in n){return{server:n._online,itemname:o}}o=n._name+"/"+o}return null};c.prototype.FillOnlineMenu=function(n,v,t){var w=this,o=this.Find(t),r=f.getDrawSettings(o._kind,"nosame;noinspect"),q=f.getDrawHandle(o._kind),s=(typeof o._kind=="string")?o._kind.indexOf("ROOT.")==0:false;if(r.opts&&(o._can_draw!==false)){r.opts.push("inspect");n.addDrawMenu("Draw",r.opts,function(x){w.display(t,x)})}if(!o._childs&&(o._more!==false)&&(o._more||s||r.expand)){n.add("Expand",function(){w.expand(t)})}if(q&&("execute" in q)){n.add("Execute",function(){w.ExecuteCommand(t,n.tree_node)})}var u=v.server+v.itemname+"/draw.htm",p="?";if(this.IsMonitoring()){u+=p+"monitoring="+this.MonitoringInterval();p="&"}if(r.opts&&(o._can_draw!==false)){n.addDrawMenu("Draw in new window",r.opts,function(x){window.open(u+p+"opt="+x)})}if(r.opts&&(r.opts.length>0)&&s&&(o._can_draw!==false)){n.addDrawMenu("Draw as png",r.opts,function(x){window.open(v.server+v.itemname+"/root.png?w=400&h=300&opt="+x)})}if("_player" in o){n.add("Player",function(){w.player(t)})}};c.prototype.Adopt=function(n){this.h=n;this.RefreshHtml()};c.prototype.SetMonitoring=function(o,n){if(o!==undefined){this._monitoring_on=false;this._monitoring_interval=3000;o=!o?0:parseInt(o);if(!isNaN(o)&&(o>0)){this._monitoring_on=true;this._monitoring_interval=Math.max(100,o)}}if(n!==undefined){this._monitoring_on=n}if(this._monitoring_handle){clearInterval(this._monitoring_handle)}this._monitoring_handle=setInterval(this.updateAll.bind(this,"monitoring"),this._monitoring_interval)};c.prototype.MonitoringInterval=function(n){return("_monitoring_interval" in this)?this._monitoring_interval:3000};c.prototype.EnableMonitoring=function(n){this._monitoring_on=n};c.prototype.IsMonitoring=function(){return this._monitoring_on};c.prototype.SetDisplay=function(o,n){if(!n&&(typeof o=="object")){this.disp=o;this.disp_kind="custom";this.disp_frameid=null}else{this.disp_kind=o;this.disp_frameid=n}if(!this.register_resize){this.register_resize=true;f.RegisterForResize(this)}};c.prototype.GetLayout=function(){return this.disp_kind};c.prototype.ClearPainter=function(n){this.ForEach(function(o){if(o._painter===n){delete o._painter}})};c.prototype.clear=function(n){if(this.disp){this.disp.Reset();delete this.disp}var o=[];this.ForEach(function(p){delete p._painter;if(!n&&(typeof p.clear=="function")){p.clear()}if(n){o.push(p)}});if(n){if(this._monitoring_handle){clearInterval(this._monitoring_handle);delete this._monitoring_handle}this.select_main().html("");o.forEach(function(p){delete p._parent;delete p._childs;delete p._obj;delete p._d3cont});delete this.h}};c.prototype.GetDisplay=function(){return("disp" in this)?this.disp:null};c.prototype.CleanupFrame=function(o){var n=f.cleanup(o);if(n&&(n.length>0)){this.ForEach(function(p){if(p._painter&&n.indexOf(p._painter)>=0){delete p._painter}})}};c.prototype.CreateDisplay=function(n){if("disp" in this){if((this.disp.NumDraw()>0)||(this.disp_kind=="custom")){return f.CallBack(n,this.disp)}this.disp.Reset();delete this.disp}if(document.getElementById(this.disp_frameid)==null){return f.CallBack(n,null)}if((this.disp_kind=="simple")||((this.disp_kind.indexOf("grid")==0)&&(this.disp_kind.indexOf("gridi")<0))){this.disp=new b(this.disp_frameid,this.disp_kind)}else{return f.AssertPrerequisites("jq2d",this.CreateDisplay.bind(this,n))}if(this.disp){this.disp.CleanupFrame=this.CleanupFrame.bind(this)}f.CallBack(n,this.disp)};c.prototype.CreateCustomDisplay=function(q,o,p){if(this.disp_kind!="simple"){return this.CreateDisplay(p)}this.disp_kind=o;if(this.disp){var n=this.disp.NumDraw();if((n>1)||((n==1)&&!this.disp.FindFrame(q))){return this.CreateDisplay(p)}this.disp.Reset();delete this.disp}this.CreateDisplay(p)};c.prototype.updateOnOtherFrames=function(n,q){var r=this.disp,p=null,o=false;if(!r){return false}if(q._typename){p=f.getDrawHandle("ROOT."+q._typename)}if(p&&p.draw_field&&q[p.draw_field]){q=q[p.draw_field]}r.ForEachPainter(function(s,t){if((s===n)||(s.GetItemName()!=n.GetItemName())){return}r.ActivateFrame(t);if(s.RedrawObject(q)){o=true}});return o};c.prototype.CheckResize=function(n){if(this.disp){this.disp.CheckMDIResize(null,n)}};c.prototype.StartGUI=function(F,n,u){function A(P){var O=f.GetUrlOption(P,u);if(!O&&F&&!F.empty()&&F.node().hasAttribute(P)){O=F.attr(P)}return O}function y(Q){var P=f.GetUrlOptionAsArray(Q,u);if(P.length>0||!F||F.empty()){return P}while(Q.length>0){var S=Q.indexOf(";");var O=S>0?Q.substr(0,S):Q;if(S>0){Q=Q.substr(S+1)}else{Q=""}var R=true;if(O[0]=="#"){O=O.substr(1);R=false}if(O==="files"){continue}if(!F.node().hasAttribute(O)){continue}var T=F.attr(O);if(R){P=P.concat(f.ParseAsArray(T))}else{if(T!==null){P.push(T)}}}return P}var v=this,r=A("prereq")||"",z=f.GetUrlOption("path",u)||"",M=y("#file;files"),K=A("localfile"),s=y("#json;jsons"),C=y("expand"),G=y("#item;items"),D=y("#opt;opts"),p=A("monitoring"),L=A("layout"),J=y("#style"),B=0,E=A("status"),t=A("browser"),q=!!t,N=A("title");if(A("float")!==null){t="float";q=true}else{if(A("fix")!==null){t="fix";q=true}}this.no_select=A("noselect");if(A("files_monitoring")!==null){this.files_monitoring=true}if(N){document.title=N}var x=A("load");if(x){r+=";io;2d;load:"+x}if(C.length==0&&(A("expand")==="")){C.push("")}if(z){for(var I=0;I<M.length;++I){M[I]=z+M[I]}for(var I=0;I<s.length;++I){s[I]=z+s[I]}}if((G.length==0)&&A("item")===""){G.push("")}if((s.length==1)&&(G.length==0)&&(C.length==0)){G.push("")}if(!this.disp_kind){if((typeof L=="string")&&(L.length>0)){this.disp_kind=L}else{switch(G.length){case 0:case 1:this.disp_kind="simple";break;case 2:this.disp_kind="vert2";break;case 3:this.disp_kind="vert21";break;case 4:this.disp_kind="vert22";break;case 5:this.disp_kind="vert32";break;case 6:this.disp_kind="vert222";break;case 7:this.disp_kind="vert322";break;case 8:this.disp_kind="vert332";break;case 9:this.disp_kind="vert333";break;default:this.disp_kind="flex"}}}if(E==="no"){E=null}else{if(E==="off"){this.status_disabled=true;E=null}else{if(E==="on"){E=true}else{if(E!==null){B=parseInt(E);if(isNaN(B)||(B<5)){B=0}E=true}}}}if(this.no_select===""){this.no_select=true}if(!t){t="fix"}else{if(t==="no"){t=""}else{if(t==="off"){t="";E=null;this.exclude_browser=true}}}if(A("nofloat")!==null){this.float_browser_disabled=true}if(this.start_without_browser){t=""}if(E||t){r="jq2d;"+r}this._topname=A("topname");function o(O){if(t){v.CreateBrowser(t);t=""}if(E!==null){v.CreateStatusLine(B,E);E=null}if(s.length>0){v.OpenJsonFile(s.shift(),o)}else{if(M.length>0){v.OpenRootFile(M.shift(),o)}else{if((K!==null)&&(typeof v.SelectLocalFile=="function")){K=null;v.SelectLocalFile(o)}else{if(C.length>0){v.expand(C.shift(),o)}else{if(J.length>0){v.ApplyStyle(J.shift(),o)}else{v.displayAll(G,D,function(){v.RefreshHtml();v.SetMonitoring(p);f.CallBack(n)})}}}}}}function H(){if(("_browser" in v.h)&&!q){t=v.h._browser;if(t==="off"){t="";E=null;v.exclude_browser=true}}if(("_monitoring" in v.h)&&!p){p=v.h._monitoring}if(("_layout" in v.h)&&!L){v.disp_kind=v.h._layout}if(("_loadfile" in v.h)&&(M.length==0)){M=f.ParseAsArray(v.h._loadfile)}if(("_drawitem" in v.h)&&(G.length==0)){G=f.ParseAsArray(v.h._drawitem);D=f.ParseAsArray(v.h._drawopt)}if(("_toptitle" in v.h)&&v.exclude_browser&&document){document.title=v.h._toptitle}if(F){v.PrepareGuiDiv(F,v.disp_kind)}o()}var w=null;if(this.is_online){if(typeof GetCachedHierarchy=="function"){w=GetCachedHierarchy()}if(typeof w!=="object"){w=""}}if(w!==null){return this.OpenOnline(w,H)}if(F){this.PrepareGuiDiv(F,this.disp_kind)}if(r.length>0){f.AssertPrerequisites(r,o)}else{o()}};c.prototype.PrepareGuiDiv=function(n,p){this.gui_div=n.attr("id");this.brlayout=new d(this.gui_div,this);this.brlayout.Create(!this.exclude_browser);if(!this.exclude_browser){var o=this.brlayout.CreateBrowserBtns();f.ToolbarIcons.CreateSVG(o,f.ToolbarIcons.diamand,15,"toggle fix-pos browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"fix",true));if(!this.float_browser_disabled){f.ToolbarIcons.CreateSVG(o,f.ToolbarIcons.circle,15,"toggle float browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"float",true))}if(!this.status_disabled){f.ToolbarIcons.CreateSVG(o,f.ToolbarIcons.three_circles,15,"toggle status line").style("margin","3px").on("click",this.CreateStatusLine.bind(this,0,"toggle"))}}this.SetDisplay(p,this.brlayout.drawing_divid())};c.prototype.CreateStatusLine=function(n,o){if(this.status_disabled||!this.gui_div||!this.brlayout){return""}return this.brlayout.CreateStatusLine(n,o)};c.prototype.CreateBrowser=function(o,n,q){if(!this.gui_div){return}var p=this;f.AssertPrerequisites("jq2d",function(){p.CreateBrowser(o,n,q)})};f.BuildNobrowserGUI=function(){var n=m.select("#simpleGUI"),o=false,p=false;if(n.empty()){o=true;n=m.select("#onlineGUI");if(n.empty()){n=m.select("#drawGUI");p=true}if(n.empty()){return alert("no div for simple nobrowser gui found")}}if(n.attr("ignoreurl")==="true"){f.gStyle.IgnoreUrlOptions=true}f.Painter.readStyleFromURL();var r=f.GetUrlOption("divsize");if(r){r=r.split("x");if(r.length!=2){r=null}}if(r){n.style("position","relative").style("width",r[0]+"px").style("height",r[1]+"px")}else{m.select("html").style("height","100%");m.select("body").style("min-height","100%").style("margin",0).style("overflow","hidden");n.style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0).style("padding",1)}var q=new f.HierarchyPainter("root",null);q.is_online=o;if(p){q.exclude_browser=true}q.start_without_browser=true;q.StartGUI(n,function(){if(!p){return}var t=f.findFunction("GetCachedObject");var u=(typeof t=="function")?f.JSONR_unref(t()):null;if(u){q._cached_draw_object=u}var s=f.GetUrlOption("opt")||"";if(f.GetUrlOption("websocket")!==null){s+=";websocket"}q.display("",s)})};f.Painter.drawStreamerInfo=function(t,r){var v=new f.HierarchyPainter("sinfo",t,"white");v.h={_name:"StreamerInfo",_childs:[]};for(var q=0;q<r.arr.length;++q){var w=r.arr[q];if(w._typename=="TList"){continue}if(typeof(w.fName)=="undefined"){f.console("strange element in StreamerInfo with type "+w._typename);continue}var x={_name:w.fName+";"+w.fClassVersion,_kind:"class "+w.fName,_title:"class:"+w.fName+" version:"+w.fClassVersion+" checksum:"+w.fCheckSum,_icon:"img_class",_childs:[]};if(w.fTitle!=""){x._title+="  "+w.fTitle}v.h._childs.push(x);if(typeof w.fElements=="undefined"){continue}for(var p=0;p<w.fElements.arr.length;++p){var o=w.fElements.arr[p];if(!o||!o.fName){continue}var n=o.fTypeName+" "+o.fName,u=o.fTypeName+" type:"+o.fType;if(o.fArrayDim===1){n+="["+o.fArrayLength+"]"}else{for(var s=0;s<o.fArrayDim;++s){n+="["+o.fMaxIndex[s]+"]"}}if(o.fBaseVersion===4294967295){n+=":-1"}else{if(o.fBaseVersion!==undefined){n+=":"+o.fBaseVersion}}n+=";";if(o.fTitle!=""){n+=" // "+o.fTitle}x._childs.push({_name:n,_title:u,_kind:o.fTypeName,_icon:(o.fTypeName=="BASE")?"img_class":"img_member"})}if(x._childs.length==0){delete x._childs}}v.RefreshHtml(function(){v.SetDivId(t);v.DrawingReady()});return v};f.Painter.drawInspector=function(p,o){f.cleanup(p);var n=new f.HierarchyPainter("inspector",p,"white");n.default_by_click="expand";n.with_icons=false;n.h={_name:"Object",_title:"",_click_action:"expand",_nosimple:false,_do_context:true};if((typeof o.fTitle==="string")&&(o.fTitle.length>0)){n.h._title=o.fTitle}if(o._typename){n.h._title+="  type:"+o._typename}if((typeof o.fName==="string")&&(o.fName.length>0)){n.h._name=o.fName}n.fill_context=function(s,q){var r=f.getDrawSettings(q._kind,"nosame");if(r.opts){s.addDrawMenu("nosub:Draw",r.opts,function(t){if(!q||!q._obj){return}var u=q._obj,v=this.divid;f.cleanup(v);f.draw(v,u,t)})}};if(f.IsRootCollection(o)){n.h._name=o.name||o._typename;g(n.h,o)}else{l(n.h,o)}n.RefreshHtml(function(){n.SetDivId(p);n.DrawingReady()});return n};function h(n){f.TBasePainter.call(this);this.frameid=n;this.SetDivId(n);this.select_main().property("mdi",this);this.CleanupFrame=f.cleanup;this.active_frame_title=""}h.prototype=Object.create(f.TBasePainter.prototype);h.prototype.BeforeCreateFrame=function(n){this.active_frame_title=n};h.prototype.ForEachFrame=function(n,o){console.warn("ForEachFrame not implemented in MDIDisplay")};h.prototype.ForEachPainter=function(n,o){this.ForEachFrame(function(q){var p=new f.TObjectPainter();p.SetDivId(q,-1);p.ForEachPainter(function(r){n(r,q)})},o)};h.prototype.NumDraw=function(){var n=0;this.ForEachFrame(function(){++n});return n};h.prototype.FindFrame=function(o,p){var n=null;this.ForEachFrame(function(q){if(m.select(q).attr("frame_title")==o){n=q}});if((n==null)&&p){n=this.CreateFrame(o)}return n};h.prototype.ActivateFrame=function(n){this.active_frame_title=m.select(n).attr("frame_title")};h.prototype.GetActiveFrame=function(){return this.FindFrame(this.active_frame_title)};h.prototype.CheckMDIResize=function(o,p){var n=null;this.ForEachPainter(function(q,r){if(o&&(m.select(r).attr("id")!=o)){return}if((q.GetItemName()!==null)&&(typeof q.CheckResize=="function")){if(n===r){return}q.CheckResize(p);n=r}})};h.prototype.Reset=function(){this.active_frame_title="";this.ForEachFrame(this.CleanupFrame);this.select_main().html("").property("mdi",null)};h.prototype.Draw=function(q,o,n){if(!o){return}if(!f.canDraw(o._typename,n)){return}var p=this.FindFrame(q,true);this.ActivateFrame(p);return f.redraw(p,o,n)};function i(){f.MDIDisplay.call(this,"dummy");this.frames={}}i.prototype=Object.create(h.prototype);i.prototype.AddFrame=function(o,n){if(!(o in this.frames)){this.frames[o]=""}this.frames[o]+=(n+";")};i.prototype.ForEachFrame=function(o,r){var q=Object.keys(this.frames);for(var n=0;n<q.length;++n){var p=m.select("#"+q[n]);if(!p.empty()){f.CallBack(o,p.node())}}};i.prototype.CreateFrame=function(p){this.BeforeCreateFrame(p);var q=Object.keys(this.frames);for(var o=0;o<q.length;++o){var n=this.frames[q[o]];if(n.indexOf(p+";")>=0){return m.select("#"+q[o]).node()}}return null};i.prototype.Reset=function(){h.prototype.Reset.call(this);this.ForEachFrame(function(n){m.select(n).html("")})};function b(r,p,n){f.MDIDisplay.call(this,r);this.framecnt=0;this.getcnt=0;this.groups=[];this.vertical=p&&(p[0]=="v");this.use_separarators=!p||(p.indexOf("x")<0);this.simple_layout=false;this.select_main().style("overflow","hidden");if(p==="simple"){this.simple_layout=true;this.use_separarators=false;this.framecnt=1;return}var s=2,t=undefined,x=undefined;if((p.indexOf("grid")==0)||n){if(n){p=p+"x"+n}else{p=p.substr(4).trim()}this.use_separarators=false;if(p[0]==="i"){this.use_separarators=true;p=p.substr(1)}var o=p.indexOf("x"),v=3,u=3;if(o>0){u=parseInt(p.substr(o+1));v=parseInt(p.substr(0,o))}else{v=u=parseInt(p)}if(isNaN(v)){v=3}if(isNaN(u)){u=3}if(u>1){this.vertical=true;s=u;if(v>1){t=new Array(s);for(var q=0;q<s;++q){t[q]=v}}}else{if(v>1){this.vertical=false;s=v}else{this.simple_layout=true;this.use_separarators=false;this.framecnt=1;return}}p=""}if(p&&p.indexOf("_")>0){var w=parseInt(p.substr(p.indexOf("_")+1),10);if(!isNaN(w)&&(w>10)){p=p.substr(0,p.indexOf("_"));x=[];while(w>0){x.unshift(Math.max(w%10,1));w=Math.round((w-x[0])/10);if(x[0]===0){x[0]=1}}}}p=p?parseInt(p.replace(/^\D+/g,""),10):0;if(p&&(p>1)){if(p<10){s=p}else{t=[];while(p>0){t.unshift(p%10);p=Math.round((p-t[0])/10);if(t[0]==0){t[0]=1}}s=t.length}}if(x&&(x.length!==s)){x=undefined}if(!this.simple_layout){this.CreateGroup(this,this.select_main(),s,t,x)}}b.prototype=Object.create(h.prototype);b.prototype.CreateGroup=function(v,s,u,w,y){if(!y){y=new Array(u)}var t=0,r=0;for(var p=0;p<u;++p){t+=(y[p]||1)}for(var p=0;p<u;++p){y[p]=Math.round(100*(y[p]||1)/t);r+=y[p];if(p==u-1){y[p]+=(100-r)}}for(var o=0;o<u;++o){var x={id:o,drawid:-1,position:0,size:y[o]};if(o>0){x.position=v.groups[o-1].position+v.groups[o-1].size}x.position0=x.position;if(!w||!w[o]||w[o]<2){x.drawid=this.framecnt++}v.groups.push(x);var q=s.append("div").attr("groupid",x.id);if(v.vertical){q.style("float","bottom").style("height",x.size+"%").style("width","100%")}else{q.style("float","left").style("width",x.size+"%").style("height","100%")}if(x.drawid>=0){q.classed("jsroot_newgrid",true);if(typeof this.frameid==="string"){q.attr("id",this.frameid+"_"+x.drawid)}}else{q.style("display","flex").style("flex-direction",v.vertical?"row":"column")}if(w&&(w[o]>1)){x.vertical=!v.vertical;x.groups=[];q.style("overflow","hidden");this.CreateGroup(x,q,w[o])}}if(this.use_separarators&&this.CreateSeparator){for(var o=1;o<u;++o){this.CreateSeparator(v,s,v.groups[o])}}};b.prototype.ForEachFrame=function(o,p){var n=this.select_main();if(this.simple_layout){o(n.node())}else{n.selectAll(".jsroot_newgrid").each(function(){o(m.select(this).node())})}};b.prototype.GetActiveFrame=function(){if(this.simple_layout){return this.select_main().node()}var n=h.prototype.GetActiveFrame.call(this);if(n){return n}this.ForEachFrame(function(o){if(!n){n=o}},true);return n};b.prototype.ActivateFrame=function(n){this.active_frame_title=m.select(n).attr("frame_title")};b.prototype.GetFrame=function(p){var n=this.select_main();if(this.simple_layout){return n.node()}var o=null;n.selectAll(".jsroot_newgrid").each(function(){if(p--===0){o=this}});return o};b.prototype.NumGridFrames=function(){return this.framecnt};b.prototype.CreateFrame=function(o){this.BeforeCreateFrame(o);var n=null,p=this.framecnt||2;while(!n&&p--){n=this.GetFrame(this.getcnt);if(!this.simple_layout&&this.framecnt){this.getcnt=(this.getcnt+1)%this.framecnt}if(m.select(n).classed("jsroot_fixed_frame")){n=null}}if(n){this.CleanupFrame(n);m.select(n).attr("frame_title",o)}return n};f.Painter.drawList=e;f.Painter.FolderHierarchy=j;f.Painter.ObjectHierarchy=l;f.Painter.TaskHierarchy=k;f.Painter.ListHierarchy=g;f.Painter.KeysHierarchy=a;f.BrowserLayout=d;f.HierarchyPainter=c;f.MDIDisplay=h;f.CustomDisplay=i;f.GridDisplay=b;return f}));