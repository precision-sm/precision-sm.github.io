var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,A,C){k!=Array.prototype&&k!=Object.prototype&&(k[A]=C.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(k,A,C,H){if(A){C=$jscomp.global;k=k.split(".");for(H=0;H<k.length-1;H++){var J=k[H];J in C||(C[J]={});C=C[J]}k=k[k.length-1];H=C[k];A=A(H);A!=H&&null!=A&&$jscomp.defineProperty(C,k,{configurable:!0,writable:!0,value:A})}};$jscomp.arrayIteratorImpl=function(k){var A=0;return function(){return A<k.length?{done:!1,value:k[A++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(k,A){this.$jscomp$symbol$id_=k;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:A})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function k(C){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(C||"")+"_"+A++,C)}var A=0;return k}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.asyncIterator;k||(k=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};
$jscomp.iteratorFromArray=function(k,A){$jscomp.initSymbolIterator();k instanceof String&&(k+="");var C=0,H={next:function(){if(C<k.length){var J=C++;return{value:A(J,k[J]),done:!1}}H.next=function(){return{done:!0,value:void 0}};return H.next()}};H[Symbol.iterator]=function(){return H};return H};$jscomp.polyfill("Array.prototype.entries",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(k,C){return[k,C]})}},"es6","es3");
(function(k){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],k);else if("object"===typeof exports&&"undefined"!==typeof module)k(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.hist.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.hist.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.hist.js");k(JSROOT,d3)}})(function(k,
A){function C(a){k.TObjectPainter.call(this,a);this.UseContextMenu=this.Enabled=!0;this.UseTextColor=!1}function H(a,b,c){if("string"==typeof c&&0==c.indexOf("onpad:")){var d=c.substr(6);c=""}var e=new k.TPavePainter(b);e.SetDivId(a,2,d);e.AssignFinishPave();if("title"===b.fName&&"TPaveText"===b._typename)if((a=e.FindPainterFor(null,"title"))&&a!==e)a.DeleteThis();else{if("postitle"==c||e.IsDummyPos(b)){var g=k.gStyle;a=e.frame_painter();if(g&&a){d=g.fTitleX;var h=g.fTitleY,f=g.fTitleW;g=g.fTitleH;
!g&&a&&(g=.7*(h-a.fY2NDC));!f&&a&&(f=a.fX2NDC-a.fX1NDC);if(!g||isNaN(g)||0>g)g=.06;if(!f||isNaN(f)||0>f)f=.44;b.fX1NDC=d-f/2;b.fY1NDC=h-g;b.fX2NDC=d+f/2;b.fY2NDC=h;b.fInit=1}}}else"TPaletteAxis"===b._typename&&(b.fBorderSize=1,b.fShadowColor=0,b.fAxis&&(b.fAxis.fChopt||(b.fAxis.fChopt="+"),b.fAxis.fNdiv||(b.fAxis.fNdiv=12),b.fAxis.fLabelOffset||(b.fAxis.fLabelOffset=.005)),e.z_handle=new k.TAxisPainter(b.fAxis,!0),e.z_handle.SetDivId(a,-1),e.UseContextMenu=!0);switch(b._typename){case "TPaveLabel":e.PaveDrawFunc=
e.DrawPaveLabel;break;case "TPaveStats":e.PaveDrawFunc=e.DrawPaveStats;e.$secondary=!0;break;case "TPaveText":case "TPavesText":case "TDiamond":e.PaveDrawFunc=e.DrawPaveText;break;case "TLegend":e.PaveDrawFunc=e.DrawPaveLegend;break;case "TPaletteAxis":e.PaveDrawFunc=e.DrawPaletteAxis}e.DrawPave(c);e.FinishPave();return e}function J(a){this.Reset()}function y(a){k.TObjectPainter.call(this,a);this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.hist_painter_id=k.id_counter++}
function G(a){y.call(this,a)}function F(a){y.call(this,a);this.fContour=null;this.fCustomContour=!1;this.fPalette=null;this.wheel_zoomy=!0}function W(a,b,c){b=new k.TH2Painter(b);if(!b.SetDivId(a,1))return null;b.DecodeOptions(c);b.IsTH2Poly()&&(b.options.Mode3D?b.options.Lego=12:b.options.Color||(b.options.Color=!0));b._show_empty_bins=!1;b._can_move_colz=!0;b.CheckPadRange(!b.options.Mode3D&&14!=b.options.Contour);b.ScanContent();b.CreateStat();b.CallDrawFunc(function(){this.DrawNextFunction(0,
function(){!this.Mode3D&&this.options.AutoZoom&&this.AutoZoom();this.FillToolbar();this.options.Project&&!this.mode3d&&this.ToggleProjection(this.options.Project);this.DrawingReady()}.bind(this))}.bind(b));return b}function X(a,b,c){var d=0,e=0,g=0;b||(d=a.fSave.length,e=Math.round(a.fSave[d-2]),g=Math.round(a.fSave[d-1]),d!==(e+1)*(g+1)+6&&(d=0));if(6<d){b=(a.fSave[d-5]-a.fSave[d-6])/e/2;var h=(a.fSave[d-3]-a.fSave[d-4])/g/2;c||(c=k.CreateHistogram("TH2F",e+1,g+1));c.fXaxis.fXmin=a.fSave[d-6]-b;
c.fXaxis.fXmax=a.fSave[d-5]+b;c.fYaxis.fXmin=a.fSave[d-4]-h;c.fYaxis.fXmax=a.fSave[d-3]+h;for(d=h=0;d<=g;++d)for(b=0;b<=e;++b)c.setBinContent(c.getBin(b+1,d+1),a.fSave[h++])}else for(e=Math.max(a.fNpx,2),g=Math.max(a.fNpy,2),c||(c=k.CreateHistogram("TH2F",e,g)),c.fXaxis.fXmin=a.fXmin,c.fXaxis.fXmax=a.fXmax,c.fYaxis.fXmin=a.fYmin,c.fYaxis.fXmax=a.fYmax,d=0;d<g;++d)for(b=0;b<e;++b){h=a.fXmin+(b+.5)*(a.fXmax-a.fXmin)/e;var f=a.fYmin+(d+.5)*(a.fYmax-a.fYmin)/g;c.setBinContent(c.getBin(b+1,d+1),a.evalPar(h,
f))}c.fName="Func";c.fTitle=a.fTitle;c.fMinimum=a.fMinimum;c.fMaximum=a.fMaximum;c.fLineColor=a.fLineColor;c.fLineStyle=a.fLineStyle;c.fLineWidth=a.fLineWidth;c.fFillColor=a.fFillColor;c.fFillStyle=a.fFillStyle;c.fMarkerColor=a.fMarkerColor;c.fMarkerStyle=a.fMarkerStyle;c.fMarkerSize=a.fMarkerSize;c.fBits|=k.TH1StatusBits.kNoStats;return c}function I(a,b){k.TObjectPainter.call(this,a,b);this.firstpainter=null;this.painters=[]}k.sources.push("hist");k.ToolbarIcons.th2color={recs:[{x:0,y:256,w:13,h:39,
f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},
{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},
{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},
{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},
{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},
{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]};k.ToolbarIcons.th2draw3d={path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"};
k.Painter.CreateDefaultPalette=function(){function a(a,b,c){if(1E-100>c)b=c=a=b;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},e=.5>b?b*(1+c):b+c-b*c,g=2*b-e;b=d(g,e,a+1/3);c=d(g,e,a);a=d(g,e,a-1/3)}return"rgb("+Math.round(255*b)+","+Math.round(255*c)+","+Math.round(255*a)+")"}for(var b=[],c=0;50>c;++c){var d=a((280-5.6*(c+1))/360,.5,1);b.push(d)}return new k.ColorPalette(b)};k.Painter.CreateGrayPalette=function(){for(var a=[],b=0;50>b;++b){var c=
Math.round((b+2)/60*255);a.push("rgb("+c+","+c+","+c+")")}return new k.ColorPalette(a)};k.Painter.CreateGradientColorTable=function(a,b,c,d,e,g){g=[];for(var h=1;h<a.length;h++)for(var f=parseInt(Math.floor(e*a[h])-Math.floor(e*a[h-1])),u=0;u<f;u++)g.push("rgb("+(Math.round(b[h-1]+u*(b[h]-b[h-1])/f)+","+Math.round(c[h-1]+u*(c[h]-c[h-1])/f)+","+Math.round(d[h-1]+u*(d[h]-d[h-1])/f))+")");return new k.ColorPalette(g)};k.Painter.GetColorPalette=function(a,b){a=a||k.gStyle.Palette;if(0<a&&10>a)return k.Painter.CreateGrayPalette();
if(51>a)return k.Painter.CreateDefaultPalette();113<a&&(a=57);switch(a){case 51:a=[[0,9,13,17,24,32,27,25,29],[0,0,0,2,37,74,113,160,221],[28,42,59,78,98,129,154,184,221]];break;case 52:a=[[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255]];break;case 53:a=[[0,45,99,156,212,230,237,234,242],[0,0,0,45,101,168,238,238,243],[0,1,1,3,9,8,11,95,230]];break;case 54:a=[[0,22,44,68,93,124,160,192,237],[0,16,41,67,93,125,162,194,241],[97,100,99,99,93,68,44,26,
74]];break;case 55:a=[[0,5,15,35,102,196,208,199,110],[0,48,124,192,206,226,97,16,0],[99,142,198,201,90,22,13,8,2]];break;case 56:a=[[242,234,237,230,212,156,99,45,0],[243,238,238,168,101,45,0,0,0],[230,95,11,8,9,3,1,1,0]];break;case 57:a=[[53.091,15.096,19.89,5.916,45.951,135.1755,208.743,253.878,248.982],[42.432,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,250.716],[134.9715,221.442,213.8175,201.807,163.8375,118.881,89.2245,50.184,13.7445]];break;case 58:a=[[0,24,2,54,176,236,202,194,
255],[0,29,92,129,117,120,176,236,255],[0,68,80,34,57,172,252,245,255]];break;case 59:a=[[13,23,25,63,76,104,137,161,206],[95,67,37,21,0,12,35,52,79],[4,3,2,6,11,22,49,98,208]];break;case 60:a=[[0,61,89,122,143,160,185,204,231],[0,0,0,0,14,37,72,132,235],[0,140,224,144,4,5,6,9,13]];break;case 61:a=[[14,7,2,0,5,11,55,131,229],[105,56,26,1,42,74,131,171,229],[2,21,35,60,92,113,160,185,229]];break;case 62:a=[[0,0,0,70,148,231,235,237,244],[0,0,0,0,0,69,67,216,244],[0,102,228,231,177,124,137,20,244]];
break;case 63:a=[[50,56,63,68,93,121,165,192,241],[66,81,91,96,111,128,155,189,241],[97,91,75,65,77,103,143,167,217]];break;case 64:a=[[145,166,167,156,131,114,101,112,132],[158,178,179,181,163,154,144,152,159],[190,199,201,192,176,169,160,166,190]];break;case 65:a=[[93,91,99,108,130,125,132,155,174],[126,124,128,129,131,121,119,153,173],[103,94,87,85,80,85,107,120,146]];break;case 66:a=[[24,40,69,90,104,114,120,132,103],[29,52,94,127,150,162,159,151,101],[29,52,96,132,162,181,184,186,131]];break;
case 67:a=[[46,38,61,92,113,121,132,150,191],[46,36,40,69,110,135,131,92,34],[46,80,74,70,81,105,165,211,225]];break;case 68:a=[[0,4,12,30,52,101,142,190,237],[0,40,86,121,140,172,187,213,240],[0,9,14,18,21,23,27,35,101]];break;case 69:a=[[198,206,206,211,198,181,161,171,244],[103,133,150,172,178,174,163,175,244],[49,54,55,66,91,130,184,224,244]];break;case 70:a=[[243,243,240,240,241,239,186,151,129],[0,46,99,149,194,220,183,166,147],[6,8,36,91,169,235,246,240,233]];break;case 71:a=[[22,19,19,25,
35,53,88,139,210],[0,32,69,108,135,159,183,198,215],[77,96,110,116,110,100,90,78,70]];break;case 72:a=[[68,116,165,182,189,180,145,111,71],[37,82,135,178,204,225,221,202,147],[16,55,105,147,196,226,232,224,178]];break;case 73:a=[[61,99,136,181,213,225,198,136,24],[149,140,96,83,132,178,190,135,22],[214,203,168,135,110,100,111,113,22]];break;case 74:a=[[76,120,156,183,197,180,162,154,140],[34,35,42,69,102,137,164,188,197],[64,69,78,105,142,177,205,217,198]];break;case 75:a=[[37,102,157,188,196,214,
223,235,251],[37,29,25,37,67,91,132,185,251],[37,32,33,45,66,98,137,187,251]];break;case 76:a=[[79,100,119,137,153,172,192,205,250],[63,79,93,103,115,135,167,196,250],[51,59,66,61,62,70,110,160,250]];break;case 77:a=[[43,44,50,66,125,172,178,155,157],[63,63,85,101,138,163,122,51,39],[121,101,58,44,47,55,57,44,43]];break;case 78:a=[[0,41,62,79,90,87,99,140,228],[0,57,81,93,85,70,71,125,228],[95,91,91,82,60,43,44,112,228]];break;case 79:a=[[49,59,72,88,114,141,176,205,222],[78,72,66,57,59,75,106,142,
173],[78,55,46,40,39,39,40,41,47]];break;case 80:a=[[243,222,201,185,165,158,166,187,219],[94,108,132,135,125,96,68,51,61],[7,9,12,19,45,89,118,146,118]];break;case 81:a=[[19,44,74,105,137,166,194,206,220],[19,28,40,55,82,110,159,181,220],[19,42,68,96,129,157,188,203,220]];break;case 82:a=[[33,44,70,99,140,165,199,211,216],[38,50,76,105,140,165,191,189,167],[55,67,97,124,140,166,163,129,52]];break;case 83:a=[[0,33,73,124,136,152,159,171,223],[0,43,92,124,134,126,121,144,223],[0,43,68,76,73,64,72,
114,223]];break;case 84:a=[[5,18,45,124,193,223,205,128,49],[48,134,207,230,193,113,28,0,7],[6,15,41,121,193,226,208,130,49]];break;case 85:a=[[180,106,104,135,164,188,189,165,144],[72,126,154,184,198,207,205,190,179],[41,120,158,188,194,181,145,100,62]];break;case 86:a=[[57,72,94,117,136,154,174,192,215],[0,33,68,109,140,171,192,196,209],[116,137,173,201,200,201,203,190,187]];break;case 87:a=[[31,71,123,160,210,222,214,199,183],[40,117,171,211,231,220,190,132,65],[234,214,228,222,210,160,105,60,
34]];break;case 88:a=[[123,108,109,126,154,172,188,196,218],[184,138,130,133,154,175,188,196,218],[208,130,109,99,110,122,150,171,218]];break;case 89:a=[[105,106,122,143,159,172,176,181,207],[252,197,194,187,174,162,153,136,125],[146,133,144,155,163,167,166,162,174]];break;case 90:a=[[171,141,145,152,154,159,163,158,177],[236,143,100,63,53,55,44,31,6],[59,48,46,44,42,54,82,112,179]];break;case 91:a=[[180,190,209,223,204,228,205,152,91],[93,125,147,172,181,224,233,198,158],[236,218,160,133,114,132,
162,220,218]];break;case 92:a=[[225,183,162,135,115,111,119,145,211],[205,177,166,135,124,117,117,132,172],[186,165,155,135,126,130,150,178,226]];break;case 93:a=[[39,43,59,63,80,116,153,177,223],[39,43,59,74,91,114,139,165,223],[39,50,59,70,85,115,151,176,223]];break;case 94:a=[[0,38,60,76,84,89,101,128,204],[0,10,15,23,35,57,83,123,199],[0,11,22,40,63,86,97,94,85]];break;case 95:a=[[94,112,141,165,167,140,91,49,27],[27,46,88,135,166,161,135,97,58],[42,52,81,106,139,158,155,137,116]];break;case 96:a=
[[30,49,79,117,135,151,146,138,147],[63,60,72,90,94,94,68,46,16],[18,28,41,56,62,63,50,36,21]];break;case 97:a=[[0,30,63,101,143,152,169,187,230],[0,14,28,42,58,61,67,74,91],[39,26,21,18,15,14,14,13,13]];break;case 98:a=[[149,140,164,179,182,181,131,87,61],[62,70,107,136,144,138,117,87,74],[40,38,45,49,49,49,38,32,34]];break;case 99:a=[[99,112,148,165,179,182,183,183,208],[39,40,57,79,104,127,148,161,198],[15,16,18,33,51,79,103,129,177]];break;case 100:a=[[99,116,154,174,200,196,201,201,230],[0,0,
8,32,58,83,119,136,173],[5,6,7,9,9,14,17,19,24]];break;case 101:a=[[82,106,126,141,155,163,142,107,66],[62,44,69,107,135,152,149,132,119],[39,25,31,60,73,68,49,72,188]];break;case 102:a=[[18,29,44,72,116,158,184,208,221],[27,46,71,105,146,177,189,190,183],[39,55,80,108,130,133,124,100,76]];break;case 103:a=[[0,48,119,173,212,224,228,228,245],[0,13,30,47,79,127,167,205,245],[0,68,75,43,16,22,55,128,245]];break;case 104:a=[[34,70,129,187,225,226,216,193,179],[48,91,147,194,226,229,196,110,12],[234,
212,216,224,206,110,53,40,29]];break;case 105:a=[[30,55,103,147,174,203,188,151,105],[0,65,138,182,187,175,121,53,9],[191,202,212,208,171,140,97,57,30]];break;case 106:a=[[112,97,113,125,138,159,178,188,225],[16,17,24,37,56,81,110,136,189],[38,35,46,59,78,103,130,152,201]];break;case 107:a=[[18,72,5,23,29,201,200,98,29],[0,0,43,167,211,117,0,0,0],[51,203,177,26,10,9,8,3,0]];break;case 108:a=[[19,42,64,88,118,147,175,187,205],[19,55,89,125,154,169,161,129,70],[19,32,47,70,100,128,145,130,75]];break;
case 109:a=[[33,31,42,68,86,111,141,172,227],[255,175,145,106,88,55,15,0,0],[255,205,202,203,208,205,203,206,231]];break;case 110:a=[[0,25,50,79,110,145,181,201,254],[0,16,30,46,63,82,101,124,179],[0,12,21,29,39,49,61,74,103]];break;case 111:a=[[0,13,30,44,72,120,156,200,247],[0,36,84,117,141,153,151,158,247],[0,94,100,82,56,66,76,131,247]];break;case 112:a=[[26,51,43,33,28,35,74,144,246],[9,24,55,87,118,150,180,200,222],[30,96,112,114,112,101,72,35,0]];break;case 113:a=[[0,5,65,97,124,156,189,224,
255],[32,54,77,100,123,148,175,203,234],[77,110,107,111,120,119,111,94,70]];break;default:return k.Painter.CreateDefaultPalette()}return k.Painter.CreateGradientColorTable([0,.125,.25,.375,.5,.625,.75,.875,1],a[0],a[1],a[2],255,b)};C.prototype=Object.create(k.TObjectPainter.prototype);C.prototype.AssignFinishPave=function(){this.FirstRun=1;this.FinishPave=function(){0>=this.FirstRun||(this.FirstRun--,0===this.FirstRun&&(delete this.FinishPave,this.DrawingReady()))}.bind(this)};C.prototype.DrawPave=
function(a){this.UseTextColor=!1;if(!this.Enabled)return this.RemoveDrawG();var b=this.GetObject(),c=b.fOption.toUpperCase();if(0===b.fInit){this.stored=k.extend({},b);b.fInit=1;var d=this.root_pad();if("TPaletteAxis"!=b._typename||b.fX1||b.fX2||b.fY1||b.fY2)0<=c.indexOf("NDC")?(b.fX1NDC=b.fX1,b.fX2NDC=b.fX2,b.fY1NDC=b.fY1,b.fY2NDC=b.fY2):d?(d.fLogx&&(0<b.fX1&&(b.fX1=k.log10(b.fX1)),0<b.fX2&&(b.fX2=k.log10(b.fX2))),d.fLogy&&(0<b.fY1&&(b.fY1=k.log10(b.fY1)),0<b.fY2&&(b.fY2=k.log10(b.fY2))),b.fX1NDC=
(b.fX1-d.fX1)/(d.fX2-d.fX1),b.fY1NDC=(b.fY1-d.fY1)/(d.fY2-d.fY1),b.fX2NDC=(b.fX2-d.fX1)/(d.fX2-d.fX1),b.fY2NDC=(b.fY2-d.fY1)/(d.fY2-d.fY1)):(b.fX1NDC=b.fY1NDC=.1,b.fX2NDC=b.fY2NDC=.9);else{var e=this.frame_painter();e?(b.fX1NDC=e.fX2NDC+.01,b.fX2NDC=Math.min(.96,e.fX2NDC+.06),b.fY1NDC=e.fY1NDC,b.fY2NDC=e.fY2NDC):(b.fX2NDC=.8,b.fX1NDC=.9,b.fY1NDC=.1,b.fY2NDC=.9)}b.fX1NDC==b.fX2NDC&&b.fY1NDC==b.fY2NDC&&"TLegend"==b._typename&&(b.fX1NDC=Math.max(d?d.fLeftMargin:0,b.fX2NDC-.3),b.fX2NDC=Math.min(b.fX1NDC+
.3,d?1-d.fRightMargin:1),e=Math.max(b.fPrimitives?.05*b.fPrimitives.arr.length:0,.2),b.fY2NDC=Math.min(d?1-d.fTopMargin:1,b.fY1NDC+e),b.fY1NDC=Math.max(b.fY2NDC-e,d?d.fBottomMargin:0))}var g=Math.round(b.fX1NDC*this.pad_width()),h=Math.round((1-b.fY2NDC)*this.pad_height());d=Math.round((b.fX2NDC-b.fX1NDC)*this.pad_width());e=Math.round((b.fY2NDC-b.fY1NDC)*this.pad_height());var f=b.fBorderSize,u=0<=c.indexOf("L")?-1:0<=c.indexOf("R")?1:0;c=0<=c.indexOf("T")?-1:0<=c.indexOf("B")?1:0;this.CreateG();
this.draw_g.attr("transform","translate("+g+","+h+")");this.createAttLine({attr:b,width:0<f?b.fLineWidth:0});this.createAttFill({attr:b});if("TDiamond"==b._typename){g=Math.round(e/2);h=Math.round(d/2);var n="l"+h+",-"+g+"l"+h+","+g+"l-"+h+","+g+"z";1<f&&0<b.fShadowColor&&(u||c)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d","M0,"+(g+f)+n).style("fill",this.get_color(b.fShadowColor)).style("stroke",this.get_color(b.fShadowColor)).style("stroke-width","1px");this.draw_g.append("svg:path").attr("d",
"M0,"+g+n).call(this.fillatt.func).call(this.lineatt.func);b=this.draw_g.append("svg:g").attr("transform","translate("+Math.round(d/4)+","+Math.round(e/4)+")");this.DrawPaveText(h,g,a,b)}else{1<f&&0<b.fShadowColor&&!b.fNpaves&&(u||c)&&(n=this.get_color(b.fShadowColor),f=this.fillatt.empty()?0>u&&0>c?"M0,0v"+(e-f)+"h-"+f+"v-"+e+"h"+d+"v"+f:"M0,"+e+"v-"+(e-f)+"h-"+f+"v"+e+"h"+d+"v-"+f:"M"+u*f+","+c*f+"v"+e+"h"+d+"v-"+e,this.draw_g.append("svg:path").attr("d",f+"z").style("fill",n).style("stroke",n).style("stroke-width",
"1px"));if(b.fNpaves)for(f=b.fNpaves-1;0<f;--f)this.draw_g.append("svg:path").attr("d","M"+4*u*f+","+4*c*f+"h"+d+"v"+e+"h-"+d+"z").call(this.fillatt.func).call(this.lineatt.func);u=this.draw_g.append("svg:path").attr("d","M0,0h"+d+"v"+e+"h-"+d+"z").call(this.fillatt.func).call(this.lineatt.func);"PaveDrawFunc"in this&&this.PaveDrawFunc(d,e,a);if(!k.BatchMode&&"TPave"!=b._typename&&(u.style("pointer-events","visibleFill").on("mouseenter",this.ShowObjectStatus.bind(this)),this.draw_g.attr("x",g).attr("y",
h).attr("width",d).attr("height",e),this.AddDrag({obj:b,minwidth:10,minheight:20,canselect:!0,redraw:this.DragRedraw.bind(this),ctxmenu:k.touches&&k.gStyle.ContextMenu&&this.UseContextMenu}),this.UseContextMenu&&k.gStyle.ContextMenu))this.draw_g.on("contextmenu",this.ShowContextMenu.bind(this))}};C.prototype.DragRedraw=function(){this.InteractiveRedraw(!1,"pave_moved");this.DrawPave()};C.prototype.FillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;a={_typename:"TWebObjectOptions",
snapid:this.snapid.toString(),opt:this.OptionsAsString(),fcust:"",fopt:[]}}var b=this.GetObject();b&&b.fInit&&(a.fcust="pave",a.fopt=[b.fX1NDC,b.fY1NDC,b.fX2NDC,b.fY2NDC]);return a};C.prototype.DrawPaveLabel=function(a,b){this.UseTextColor=!0;var c=this.GetObject();this.StartTextDrawing(c.fTextFont,b/1.2);this.DrawText({align:c.fTextAlign,width:a,height:b,text:c.fLabel,color:this.get_color(c.fTextColor)});this.FirstRun++;this.FinishTextDrawing(null,this.FinishPave)};C.prototype.DrawPaveStats=function(a,
b){this.IsStats()&&this.FillStatistic();for(var c=this.GetObject(),d=[],e=this.get_color(c.fTextColor),g=0,h=0,f=0,k=0;k<c.fLines.arr.length;++k){var n=c.fLines.arr[k];"TText"!=n._typename&&"TLatex"!=n._typename||d.push(n.fTitle)}n=d.length;for(k=0;k<n;++k){var l=d[k];0<k&&(f=Math.max(f,l.length));if(!(0==k||0>l.indexOf("|"))){0===g&&(g=k);var p=l.split("|");p.length>h&&(h=p.length)}}l=b/n;var m=!1,q=c.fMargin*a;this.StartTextDrawing(c.fTextFont,b/(1.2*n));this.UseTextColor=!0;if(1==n)this.DrawText({align:c.fTextAlign,
width:a,height:b,text:d[0],color:e,latex:1});else for(k=0;k<n;++k){var r=k*l;this.UseTextColor=!0;if(g&&k>=g){p=d[k].split("|");for(var t=0;t<p.length;++t)this.DrawText({align:"middle",x:a*t/h,y:r,latex:0,width:a/h,height:l,text:p[t],color:e})}else if(0>d[k].indexOf("="))0==k&&(m=!0,d[k].length>f+5&&(d[k]=d[k].substr(0,f+2)+"...")),this.DrawText({align:0==k?"middle":"start",x:q,y:r,width:a-2*q,height:l,text:d[k],color:e});else{p=d[k].split("=");var x=0;for(t=0;2>t;++t)x+=this.DrawText({align:0==t?
"start":"end",x:q,y:r,width:a-2*q,height:l,text:p[t],color:e});this.TextScaleFactor(1.05*x/(a-2*q),this.draw_g)}}d="";0<c.fBorderSize&&m&&(d+="M0,"+Math.round(l)+"h"+a);if(0<g&&1<h){for(c=g;c<n;++c)d+="M0,"+Math.round(c*l)+"h"+a;for(c=0;c<h-1;++c)d+="M"+Math.round(a/h*(c+1))+","+Math.round(g*l)+"V"+b}d&&this.draw_g.append("svg:path").attr("d",d).call(this.lineatt.func);this.FirstRun++;this.FinishTextDrawing(void 0,this.FinishPave);this.draw_g.classed("most_upper_primitives",!0)};C.prototype.DrawPaveText=
function(a,b,c,d){c=this.GetObject();var e=this.get_color(c.fTextColor),g=0,h=[],f=this.pad_height(),u=this.pad_painter(),n=!1,l=0<c.fLabel.length;d||(d=this.draw_g);for(var p=0;p<c.fLines.arr.length;++p){var m=c.fLines.arr[p];if("TText"==m._typename||"TLatex"==m._typename)if(g++,0<m.fX||0<m.fY)n=!0}u=1==g&&u&&u._fast_drawing;var q=0;for(p=0;p<c.fLines.arr.length;++p){m=c.fLines.arr[p];var r=0<g?Math.round((1-(q-.5)/g)*b):0;switch(m._typename){case "TText":case "TLatex":q++;if(n){var t=m.fX,x=m.fY;
t=0<t&&1>t?Math.round(t*a):c.fMargin*a;x=0<x&&1>x?Math.round((1-x)*b):r;r=m.fTextColor?this.get_color(m.fTextColor):"";r||(r=e,this.UseTextColor=!0);var v=d.append("svg:g");this.StartTextDrawing(c.fTextFont,(m.fTextSize||c.fTextSize)*f,v);this.DrawText({align:m.fTextAlign||c.fTextAlign,x:t,y:x,text:m.fTitle,color:r,latex:"TText"==m._typename?0:1,draw_g:v,fast:u});this.FirstRun++;this.FinishTextDrawing(v,this.FinishPave)}else h.push(m);break;case "TLine":case "TBox":t=m.fX1;x=m.fX2;v=m.fY1;var w=m.fY2;
0!==t&&(t=Math.round(t*a));x=x?Math.round(x*a):a;v=v?Math.round((1-v)*b):r;w=w?Math.round((1-w)*b):r;"TLine"==m._typename?(m=new k.TAttLineHandler(m),d.append("svg:line").attr("x1",t).attr("y1",v).attr("x2",x).attr("y2",w).call(m.func)):(m=this.createAttFill(m),d.append("svg:rect").attr("x",t).attr("y",w).attr("width",x-t).attr("height",v-w).call(m.func))}}if(!n){n=b/g;q=c.fMargin*a;p=0;1==g&&0<c.fTextSize&&(p=Math.round(c.fTextSize*f),3>p&&(p=3));this.StartTextDrawing(c.fTextFont,b/(1.2*g),d,p);
for(p=0;p<g;++p)r=h[p],1==g?m={x:0,y:0,width:a,height:b}:(m={x:q,y:p*n,width:a-2*q,height:n},r.fTextColor&&(m.color=this.get_color(r.fTextColor)),r.fTextSize&&(m.font_size=Math.round(r.fTextSize*f))),m.align=c.fTextAlign,m.draw_g=d,m.latex="TText"==r._typename?0:1,m.text=r.fTitle,m.fast=u,m.color||(this.UseTextColor=!0,m.color=e),this.DrawText(m);this.FirstRun++;this.FinishTextDrawing(d,this.FinishPave)}l&&(g=Math.round(.25*a),h=Math.round(.02*-b),a=Math.round(.5*a),b=Math.round(.04*b),d=d.append("svg:g"),
d.append("svg:path").attr("d","M"+g+","+h+"h"+a+"v"+b+"h-"+a+"z").call(this.fillatt.func).call(this.lineatt.func),this.StartTextDrawing(c.fTextFont,b/1.5,d),this.DrawText({align:22,x:g,y:h,width:a,height:b,text:c.fLabel,color:e,draw_g:d}),this.FirstRun++,this.FinishTextDrawing(d,this.FinishPave),this.UseTextColor=!0)};C.prototype.Format=function(a,b){b||(b="stat");var c=this.GetObject();switch(b){case "stat":b=c.fStatFormat||k.gStyle.fStatFormat;break;case "fit":b=c.fFitFormat||k.gStyle.fFitFormat;
break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);b="14.7g";break;case "last":b=this.lastformat}delete this.lastformat;a=k.FFormat(a,b||"6.4g");this.lastformat=k.lastFFormat;return a};C.prototype.DrawPaveLegend=function(a,b){function c(a){return!a.fObject&&!a.fOption&&(!a.fLabel||" "==a.fLabel)}var d=this.GetObject(),e=d.fPrimitives.arr.length,g=d.fNColumns,h=e;if(2>g)g=1;else for(;(h-1)*g>=e;)h--;if(1==g)for(var f=0;f<e;++f)c(d.fPrimitives.arr[f])&&h--;1>h&&(h=1);var u=
this.get_color(d.fTextColor),n=Math.round(a/g);a=Math.round(.03*a/g);var l=Math.round(.03*b);b=(b-2*l)/h;var p=.9*b,m=0,q=this.pad_height();h=!1;f=-1;d.fTextSize&&2<q*d.fTextSize&&q*d.fTextSize<p&&(p=m=Math.round(q*d.fTextSize));this.StartTextDrawing(d.fTextFont,p,this.draw_g,m);for(p=0;p<e;++p)if(m=d.fPrimitives.arr[p],!c(m)){1==g?++f:f=p;q=m.fOption.toLowerCase();var r=f%g,t=(f-r)/g;r*=n;var x=r+Math.round(d.fMargin*n),v=Math.round((r+x)/2),w=Math.round(t*b+l);t=Math.round((t+.5)*b+l);var z=m,y=
m,M=m,E=m.fObject,B=null,D=!1;null!==E&&"object"==typeof E&&("fLineColor"in E&&(M=E),"fFillColor"in E&&(z=E),"fMarkerColor"in E&&(y=E),B=this.FindPainterFor(E));-1!=q.indexOf("f")&&(E=B&&B.fillatt?B.fillatt:this.createAttFill(z),z=this.draw_g.append("svg:rect").attr("x",r+a).attr("y",Math.round(w+.1*b)).attr("width",x-2*a-r).attr("height",Math.round(.8*b)).call(E.func),E.empty()||(D=!0),0>q.indexOf("l")&&0>q.indexOf("e")&&0>q.indexOf("p")&&(E=B&&B.lineatt?B.lineatt:new k.TAttLineHandler(M),z.call(E.func),
"none"!==E.color&&(D=!0)));if(-1!=q.indexOf("l")||-1!=q.indexOf("e"))E=B&&B.lineatt?B.lineatt:new k.TAttLineHandler(M),this.draw_g.append("svg:line").attr("x1",r+a).attr("y1",t).attr("x2",x-a).attr("y2",t).call(E.func),"none"!==E.color&&(D=!0);-1!=q.indexOf("e")&&(E=B&&B.lineatt?B.lineatt:new k.TAttLineHandler(M),this.draw_g.append("svg:line").attr("x1",v).attr("y1",Math.round(w+.1*b)).attr("x2",v).attr("y2",Math.round(w+.9*b)).call(E.func),"none"!==E.color&&(D=!0));-1!=q.indexOf("p")&&(v=B&&B.markeratt?
B.markeratt:new k.TAttMarkerHandler(y),this.draw_g.append("svg:path").attr("d",v.create((r+x)/2,t)).call(v.func),"none"!==v.color&&(D=!0));!D&&B&&B.lineatt&&"none"!==B.lineatt.color&&this.draw_g.append("svg:rect").attr("x",r+a).attr("y",Math.round(w+.1*b)).attr("width",x-2*a-r).attr("height",Math.round(.8*b)).attr("fill","none").call(B.lineatt.func);0<q.length?h=!0:h||(x=r+a);m.fLabel&&this.DrawText({align:"start",x:x,y:w,width:r+n-x-a,height:b,text:m.fLabel,color:u})}this.FirstRun++;this.FinishTextDrawing(this.draw_g,
this.FinishPave)};C.prototype.DrawPaletteAxis=function(a,b,c){function d(){if(E){A.event.preventDefault();var a=A.mouse(M);a[1]<B?B=a[1]:D=a[1];C.attr("y",B).attr("height",Math.abs(D-B))}}function e(){if(E){A.event.preventDefault();A.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);C.remove();C=null;E=!1;var a=Math.min(z.invert(B),z.invert(D)),b=Math.max(z.invert(B),z.invert(D));h.frame_painter().Zoom("z",a,b)}}function g(){E||(E=!0,A.event.preventDefault(),M=this,B=
D=A.mouse(M)[1],C=h.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",a).attr("y",B).attr("height",5),A.select(window).on("mousemove.colzoomRect",d).on("mouseup.colzoomRect",e,!0),A.event.stopPropagation())}var h=this,f=this.GetObject(),u=f.fAxis,n="string"==typeof c&&0<c.indexOf("can_move"),l="string"==typeof c&&0<c.indexOf("postpone"),p=u.fNdiv%100;c=parseInt(this.draw_g.attr("x"));var m=parseInt(this.draw_g.attr("y")),q=this.pad_width();this.pad_height();
var r=this.main_painter(),t=this.frame_painter(),x=0,v=100,w=r.fContour;0>=p&&(p=8);u.fTickSize=.6*a/q;w&&t?(x=Math.min(w[0],t.zmin),v=Math.max(w[w.length-1],t.zmax)):void 0!==r.gmaxbin&&void 0!==r.gminbin?(x=r.gminbin,v=r.gmaxbin):void 0!==r.hmin&&void 0!==r.hmax&&(x=r.hmin,v=r.hmax);var z=null;u="normal";this.root_pad().fLogz?(z=A.scaleLog(),u="log"):z=A.scaleLinear();z.domain([x,v]).range([b,0]);this.draw_g.selectAll("rect").style("fill","white");if(!w||l)this.draw_g.append("svg:rect").attr("x",
0).attr("y",0).attr("width",a).attr("height",b).style("fill","white");else for(l=0;l<w.length-1;++l){p=z(w[l]);t=z(w[l+1]);var y=r.getContourColor((w[l]+w[l+1])/2);p=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(t)).attr("width",a).attr("height",Math.round(p)-Math.round(t)).style("fill",y).style("stroke",y).property("fill0",y).property("fill1",A.rgb(y).darker(.5).toString());this.IsTooltipAllowed()&&p.on("mouseover",function(){A.select(this).transition().duration(100).style("fill",
A.select(this).property("fill1"))}).on("mouseout",function(){A.select(this).transition().duration(100).style("fill",A.select(this).property("fill0"))}).append("svg:title").text(w[l].toFixed(2)+" - "+w[l+1].toFixed(2));if(k.gStyle.Zooming)p.on("dblclick",function(){h.frame_painter().Unzoom("z")})}this.z_handle.SetAxisConfig("zaxis",u,z,x,v,x,v);this.z_handle.max_tick_size=Math.round(.7*a);this.z_handle.DrawAxis(!0,this.draw_g,a,b,"translate("+a+", 0)");n&&"getBoundingClientRect"in this.draw_g.node()&&
(b=this.draw_g.node().getBoundingClientRect(),b=c+parseInt(b.width)-Math.round(.995*q)+3,0<b&&(this.draw_g.attr("x",c-b).attr("y",m).attr("transform","translate("+(c-b)+", "+m+")"),f.fX1NDC-=b/q,f.fX2NDC-=b/q));var M=null,E=!1,B=0,D=0,C=null;if(k.gStyle.Zooming)this.draw_g.select(".axis_zoom").on("mousedown",g).on("dblclick",function(){h.frame_painter().Unzoom("z")})};C.prototype.FillContextMenu=function(a){var b=this.GetObject();a.add("header: "+b._typename+"::"+b.fName);if(this.IsStats()){var c=
function(c,e){var d=10>c?b.fOptStat:b.fOptFit;d=parseInt(parseInt(d)/parseInt(Math.pow(10,c%10)))%10;a.addchk(d,e,100*d+c,function(a){var c=10>a%100?b.fOptStat:b.fOptFit,d=parseInt(a/100);c-=(0<d?d:-1)*parseInt(Math.pow(10,a%10));10>a%100?(b.fOptStat=c,this.InteractiveRedraw(!0,"exec:SetOptStat("+c+")")):(b.fOptFit=c,this.InteractiveRedraw(!0,"exec:SetOptFit("+c+")"))})};a.add("Default position",function(){b.fX2NDC=k.gStyle.fStatX;b.fX1NDC=b.fX2NDC-k.gStyle.fStatW;b.fY2NDC=k.gStyle.fStatY;b.fY1NDC=
b.fY2NDC-k.gStyle.fStatH;b.fInit=1;this.InteractiveRedraw(!0,"pave_moved")});a.add("SetStatFormat",function(){var a=prompt("Enter StatFormat",b.fStatFormat);a&&(b.fStatFormat=a,this.InteractiveRedraw(!0,'exec:SetStatFormat("'+a+'")'))});a.add("SetFitFormat",function(){var a=prompt("Enter FitFormat",b.fFitFormat);a&&(b.fFitFormat=a,this.InteractiveRedraw(!0,'exec:SetFitFormat("'+a+'")'))});a.add("separator");a.add("sub:SetOptStat",function(){var a=prompt("Enter OptStat",b.fOptStat);a&&(a=parseInt(a),
!isNaN(a)&&0<=a&&(b.fOptStat=parseInt(a),this.InteractiveRedraw(!0,"exec:SetOptStat("+a+")")))});c(0,"Histogram name");c(1,"Entries");c(2,"Mean");c(3,"Std Dev");c(4,"Underflow");c(5,"Overflow");c(6,"Integral");c(7,"Skewness");c(8,"Kurtosis");a.add("endsub:");a.add("sub:SetOptFit",function(){var a=prompt("Enter OptStat",b.fOptFit);a&&(a=parseInt(a),!isNaN(a)&&0<=a&&(b.fOptFit=a,this.InteractiveRedraw(!0,"exec:SetOptFit("+a+")")))});c(10,"Fit parameters");c(11,"Par errors");c(12,"Chi square / NDF");
c(13,"Probability");a.add("endsub:");a.add("separator")}else"title"===b.fName&&a.add("Default position",function(){b.fX1NDC=.28;b.fY1NDC=.94;b.fX2NDC=.72;b.fY2NDC=.99;b.fInit=1;this.InteractiveRedraw(!0,"pave_moved")});this.UseTextColor&&this.TextAttContextMenu(a);this.FillAttContextMenu(a);0<a.size()&&a.add("Inspect",this.ShowInspector);return 0<a.size()};C.prototype.ShowContextMenu=function(a){if(this.z_handle)return this.frame_painter().ShowContextMenu("z",a,this.GetObject().fAxis);a||(A.event.stopPropagation(),
A.event.preventDefault(),a=A.event);k.Painter.createMenu(this,function(a){a.painter.FillContextMenu(a);a.painter.FillObjectExecMenu(a,"title",function(){a.show()})},a)};C.prototype.IsStats=function(){return this.MatchObjectType("TPaveStats")};C.prototype.ClearPave=function(){this.GetObject().Clear()};C.prototype.AddText=function(a){this.GetObject().AddText(a)};C.prototype.FillFunctionStat=function(a,b){if(!b||!a)return!1;var c=b%10,d=Math.floor(b/10)%10,e=Math.floor(b/1E3)%10;0<Math.floor(b/100)%
10&&this.AddText("#chi^2 / ndf = "+this.Format(a.fChisquare,"fit")+" / "+a.fNDF);0<e&&this.AddText("Prob = "+("Math"in k?this.Format(k.Math.Prob(a.fChisquare,a.fNDF)):"<not avail>"));if(0<c)for(b=0;b<a.GetNumPars();++b){c=a.GetParName(b);e=a.GetParValue(b);var g=a.GetParError(b);e=void 0===e?"<not avail>":this.Format(Number(e),"fit");void 0!==g&&(g=this.Format(g,"last"),0===Number(g)&&0!=a.GetParError(b)&&(g=this.Format(a.GetParError(b),"4.2g")));0<d&&g?this.AddText(c+" = "+e+" #pm "+g):this.AddText(c+
" = "+e)}return!0};C.prototype.FillStatistic=function(){var a=this.pad_painter();if(a&&a._fast_drawing)return!1;a=this.GetObject();var b=a.$main_painter||this.main_painter();if("stats"!==a.fName||!b||"function"!==typeof b.FillStatistic)return!1;var c=parseInt(a.fOptStat),d=parseInt(a.fOptFit);isNaN(c)&&(c=k.gStyle.fOptStat);isNaN(d)&&(d=k.gStyle.fOptFit);if(!b.FillStatistic(this,c,d))return!1;b=a.fLines.arr.length;c=b*k.gStyle.StatFontSize;if(0>=c||3===k.gStyle.StatFont%10)c=.25*b*k.gStyle.StatH,
a.fY1NDC=a.fY2NDC-c;return!0};C.prototype.IsDummyPos=function(a){return a?!a.fInit&&!a.fX1&&!a.fX2&&!a.fY1&&!a.fY2&&!a.fX1NDC&&!a.fX2NDC&&!a.fY1NDC&&!a.fY2NDC:!0};C.prototype.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;var b=this.GetObject();b.modified_NDC||this.IsDummyPos(a)||(this.stored&&!a.fInit&&this.stored.fX1==a.fX1&&this.stored.fX2==a.fX2&&this.stored.fY1==a.fY1&&this.stored.fY2==a.fY2?(this.stored.fX1NDC!=a.fX1NDC&&(b.fX1NDC=a.fX1NDC),this.stored.fX2NDC!=a.fX2NDC&&(b.fX2NDC=
a.fX2NDC),this.stored.fY1NDC!=a.fY1NDC&&(b.fY1NDC=a.fY1NDC),this.stored.fY2NDC!=a.fY2NDC&&(b.fY2NDC=a.fY2NDC)):(b.fInit=a.fInit,b.fX1=a.fX1,b.fX2=a.fX2,b.fY1=a.fY1,b.fY2=a.fY2,b.fX1NDC=a.fX1NDC,b.fX2NDC=a.fX2NDC,b.fY1NDC=a.fY1NDC,b.fY2NDC=a.fY2NDC),this.stored=k.extend({},a));b.fOption=a.fOption;b.fBorderSize=a.fBorderSize;switch(a._typename){case "TPaveText":return b.fLines=k.clone(a.fLines),!0;case "TPavesText":return b.fLines=k.clone(a.fLines),b.fNpaves=a.fNpaves,!0;case "TPaveLabel":return b.fLabel=
a.fLabel,!0;case "TPaveStats":return b.fOptStat=a.fOptStat,b.fOptFit=a.fOptFit,!0;case "TLegend":var c=b.fPrimitives;b.fPrimitives=a.fPrimitives;b.fNColumns=a.fNColumns;if(c&&c.arr&&b.fPrimitives&&b.fPrimitives.arr&&c.arr.length==b.fPrimitives.arr.length)for(a=0;a<c.arr.length;++a){var d=c.arr[a].fObject,e=b.fPrimitives.arr[a].fObject;d&&e&&d._typename==e._typename&&d.fName==e.fName&&(b.fPrimitives.arr[a].fObject=d)}return!0;case "TPaletteAxis":return b.fBorderSize=1,b.fShadowColor=0,!0}return!1};
C.prototype.Redraw=function(){this.DrawPave()};C.prototype.Cleanup=function(){this.z_handle&&(this.z_handle.Cleanup(),delete this.z_handle);k.TObjectPainter.prototype.Cleanup.call(this)};J.prototype.Reset=function(){k.extend(this,{Axis:0,RevX:!1,RevY:!1,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:k.gStyle.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,
Proj:0,AxisPos:0,Spec:!1,Pie:!1,List:!1,Zscale:!1,PadPalette:!1,Candle:"",GLBox:0,GLColor:!1,Project:"",System:k.Painter.Coord.kCARTESIAN,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:k.gStyle.OptimizeDraw,Mode3D:!1,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,minimum:-1111,maximum:-1111,ymin:0,ymax:0})};J.prototype.Decode=function(a,b,c,d,e){this.orginal=a;a=new k.DrawOptions(a);var g="";if(1===b&&0<c.fSumw2.length)for(var h=
0;h<c.fSumw2.length;++h)if(0<c.fSumw2[h]){this.Error=!0;this.Zero=this.Hist=!1;break}this.ndim=b||1;this.PadStats=a.check("USE_PAD_STATS");this.PadPalette=a.check("USE_PAD_PALETTE");this.PadTitle=a.check("USE_PAD_TITLE");a.check("PAL",!0)&&(this.Palette=a.partAsInt());a.check("MINIMUM:",!0)?this.minimum=parseFloat(a.part):this.minimum=c.fMinimum;a.check("MAXIMUM:",!0)?this.maximum=parseFloat(a.part):this.maximum=c.fMaximum;a.check("YMIN:",!0)&&(this.ymin=parseFloat(a.part));a.check("YMAX:",!0)&&(this.ymax=
parseFloat(a.part));a.check("NOOPTIMIZE")&&(this.Optimize=0);a.check("OPTIMIZE")&&(this.Optimize=2);a.check("AUTOCOL")&&(this.AutoColor=!0);a.check("AUTOZOOM")&&(this.AutoZoom=!0);a.check("OPTSTAT",!0)&&(this.optstat=a.partAsInt());a.check("OPTFIT",!0)&&(this.optfit=a.partAsInt());a.check("NOSTAT")&&(this.NoStat=!0);a.check("STAT")&&(this.ForceStat=!0);a.check("NOTOOLTIP")&&e&&e.SetTooltipAllowed(!1);a.check("TOOLTIP")&&e&&e.SetTooltipAllowed(!0);a.check("LOGX")&&d&&(d.fLogx=1,d.fUxmin=0,d.fUxmax=
1,d.fX1=0,d.fX2=1);a.check("LOGY")&&d&&(d.fLogy=1,d.fUymin=0,d.fUymax=1,d.fY1=0,d.fY2=1);a.check("LOGZ")&&d&&(d.fLogz=1);a.check("GRIDXY")&&d&&(d.fGridx=d.fGridy=1);a.check("GRIDX")&&d&&(d.fGridx=1);a.check("GRIDY")&&d&&(d.fGridy=1);a.check("TICKXY")&&d&&(d.fTickx=d.fTicky=1);a.check("TICKX")&&d&&(d.fTickx=1);a.check("TICKY")&&d&&(d.fTicky=1);if(a.check("FILL_",!0))if(0<a.partAsInt(1))this.histoFillColor=a.partAsInt();else for(c=0;8>c;++c)k.Painter.root_colors[c].toUpperCase()===a.part&&(this.histoFillColor=
c);if(a.check("LINE_",!0))if(0<a.partAsInt(1))this.histoLineColor=k.Painter.root_colors[a.partAsInt()];else for(c=0;8>c;++c)k.Painter.root_colors[c].toUpperCase()===a.part&&(this.histoLineColor=a.part);a.check("X+")&&(this.AxisPos=10);a.check("Y+")&&(this.AxisPos+=1);a.check("SAMES")&&(this.ForceStat=this.Same=!0);a.check("SAME")&&(this.Func=this.Same=!0);a.check("SPEC")&&(this.Spec=!0);a.check("BASE0")||a.check("MIN0")?this.BaseLine=0:k.gStyle.fHistMinimumZero&&(this.BaseLine=0);a.check("PIE")&&
(this.Pie=!0);a.check("CANDLE",!0)&&(this.Candle=a.part);a.check("GLBOX",!0)&&(this.GLBox=10+a.partAsInt());a.check("GLCOL")&&(this.GLColor=!0);a.check("GL");a.check("LEGO",!0)&&(this.Lego=1,0<=a.part.indexOf("0")&&(this.Zero=!1),0<=a.part.indexOf("1")&&(this.Lego=11),0<=a.part.indexOf("2")&&(this.Lego=12),0<=a.part.indexOf("3")&&(this.Lego=13),0<=a.part.indexOf("4")&&(this.Lego=14),g=a.part,0<=a.part.indexOf("Z")&&(this.Zscale=!0));a.check("SURF",!0)&&(this.Surf=a.partAsInt(10,1),g=a.part,0<=a.part.indexOf("Z")&&
(this.Zscale=!0));a.check("TF3",!0)&&(g=a.part);a.check("ISO",!0)&&(g=a.part);a.check("LIST")&&(this.List=!0);a.check("CONT",!0)&&1<b&&(this.Contour=1,0<=a.part.indexOf("Z")&&(this.Zscale=!0),0<=a.part.indexOf("1")?this.Contour=11:0<=a.part.indexOf("2")?this.Contour=12:0<=a.part.indexOf("3")?this.Contour=13:0<=a.part.indexOf("4")&&(this.Contour=14));a.check("HBAR",!0)?this.BarStyle=20:a.check("BAR",!0)&&(this.BarStyle=10);0<this.BarStyle&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=a.partAsInt());
a.check("ARR")&&(this.Arrow=!0);a.check("BOX",!0)&&(this.BoxStyle=10+a.partAsInt());this.Box=0<this.BoxStyle;a.check("COL")&&(this.Color=!0);a.check("CHAR")&&(this.Char=1);a.check("FUNC")&&(this.Func=!0,this.Hist=!1);a.check("AXIS")&&(this.Axis=1);a.check("AXIG")&&(this.Axis=2);a.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(a.partAsInt(),90),0<=a.part.indexOf("N")&&(this.TextKind="N"),0<=a.part.indexOf("E0")&&(this.TextLine=!0),0<=a.part.indexOf("E")&&(this.TextKind="E"));
a.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(a.part),isNaN(this.ScatCoef)||0>=this.ScatCoef)&&(this.ScatCoef=1);a.check("SCAT")&&(this.Scat=!0);a.check("POL")&&(this.System=k.Painter.Coord.kPOLAR);a.check("CYL")&&(this.System=k.Painter.Coord.kCYLINDRICAL);a.check("SPH")&&(this.System=k.Painter.Coord.kSPHERICAL);a.check("PSR")&&(this.System=k.Painter.Coord.kRAPIDITY);a.check("TRI",!0)&&(this.Color=!1,this.Tri=1,g=a.part,0<=a.part.indexOf("ERR")&&(this.Error=!0));a.check("AITOFF")&&(this.Proj=
1);a.check("MERCATOR")&&(this.Proj=2);a.check("SINUSOIDAL")&&(this.Proj=3);a.check("PARABOLIC")&&(this.Proj=4);0<this.Proj&&(this.Contour=14);a.check("PROJX",!0)&&(this.Project="X"+a.partAsInt(0,1));a.check("PROJY",!0)&&(this.Project="Y"+a.partAsInt(0,1));g&&(0<=g.indexOf("FB")&&(this.FrontBox=!1),0<=g.indexOf("BB")&&(this.BackBox=!1));3==b&&a.check("FB")&&(this.FrontBox=!1);3==b&&a.check("BB")&&(this.BackBox=!1);this._pfc=a.check("PFC");this._plc=a.check("PLC")||this.AutoColor;this._pmc=a.check("PMC");
a.check("L")&&(this.Line=!0,this.Error=this.Hist=!1);a.check("F")&&(this.need_fillcol=this.Fill=!0);a.check("A")&&(this.Axis=-1);(this.Axis||this.Color)&&a.check("RX")&&(this.RevX=!0);(this.Axis||this.Color)&&a.check("RY")&&(this.RevY=!0);a.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0);a.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0);a.check("C")&&(this.Curve=!0,this.Hist=!1);a.check("][")&&(this.Off=1,this.Hist=!0);a.check("HIST")&&(this.Func=this.Hist=
!0,this.Error=!1);this.Bar=0<this.BarStyle;delete this.MarkStyle;a.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0);a.check("P")&&(this.Mark=!0,this.Zero=this.Hist=!1);a.check("Z")&&(this.Zscale=!0);a.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1);a.check("H")&&(this.Hist=!0);if(a.check("E",!0)&&(this.Error=!0,1==b)){this.Hist=this.Zero=!1;isNaN(parseInt(a.part[0]))||(this.ErrorKind=parseInt(a.part[0]));if(3===this.ErrorKind||4===this.ErrorKind)this.need_fillcol=!0;0===this.ErrorKind&&
(this.Zero=!0);0<=a.part.indexOf("X0")&&(this.errorX=0)}a.check("9")&&(this.HighRes=1);a.check("0")&&(this.Zero=!1);this.Color&&a.check("1")&&(this.Zero=!1);if(0<this.Lego||3==b||0<this.Surf||this.Error&&2==b)this.Mode3D=!0};J.prototype.asString=function(a){a&&a.frame_painter();a="";this.Mode3D?(this.Lego?(a="LEGO",this.Zero||(a+="0"),10<this.Lego&&(a+=this.Lego-10),this.Zscale&&(a+="Z")):this.Surf&&(a="SURF"+(this.Surf-10),this.Zscale&&(a+="Z")),this.FrontBox||(a+="FB"),this.BackBox||(a+="BB")):
(this.Scat?a="SCAT":this.Color?(a="COL",this.Zero||(a+="0"),this.Zscale&&(a+="Z"),0>this.Axis&&(a+="A")):this.Contour?(a="CONT",10<this.Contour&&(a+=this.Contour-10),this.Zscale&&(a+="Z")):this.Bar?a=!1===this.BaseLine?"B":"B1":this.Mark?a=this.Zero?"P0":"P":this.Scat?a="SCAT":this.Error?(a="E",0<=this.ErrorKind&&(a+=this.ErrorKind)):this.Line&&(a+="L",this.Fill&&(a+="F")),this.Text&&(a+="TEXT",this.TextAngle&&(a+=this.TextAngle),a+=this.TextKind));return a};y.prototype=Object.create(k.TObjectPainter.prototype);
y.prototype.GetHisto=function(){return this.GetObject()};y.prototype.GetAxis=function(a){var b=this.GetObject();if(b)switch(a){case "x":return b.fXaxis;case "y":return b.fYaxis;case "z":return b.fZaxis}return null};y.prototype.IsTProfile=function(){return this.MatchObjectType("TProfile")};y.prototype.IsTH1K=function(){return this.MatchObjectType("TH1K")};y.prototype.IsTH2Poly=function(){return this.MatchObjectType(/^TH2Poly/)||this.MatchObjectType(/^TProfile2Poly/)};y.prototype.Clear3DScene=function(){var a=
this.frame_painter();a&&"function"===typeof a.Create3DScene&&a.Create3DScene(-1);this.mode3d=!1};y.prototype.Cleanup=function(){this.Clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;k.TObjectPainter.prototype.Cleanup.call(this)};y.prototype.Dimension=function(){var a=this.GetHisto();return a?a._typename.match(/^TH2/)||a._typename.match(/^TProfile2D/)?2:a._typename.match(/^TH3/)?3:this.IsTH2Poly()?2:1:0};y.prototype.DecodeOptions=function(a){var b=this.GetHisto(),c=this.Dimension(),
d=this.root_pad();this.options?this.options.Reset():this.options=new J;this.options.Decode(a||b.fOption,c,b,d,this);this.OptionsStore(a)};y.prototype.CopyOptionsFrom=function(a){if(a!==this){var b=this.options;a=a.options;b.Mode3D=a.Mode3D;b.Zero=a.Zero;a.Mode3D?(b.Lego=a.Lego,b.Surf=a.Surf):(b.Color=a.Color,b.Contour=a.Contour)}};y.prototype.CopyOptionsToOthers=function(){var a=this;this.ForEachPainter(function(b){b!==a&&"function"==typeof b.CopyOptionsFrom&&b.CopyOptionsFrom(a)},"objects")};y.prototype.ScanContent=
function(a){alert("HistPainter.prototype.ScanContent not implemented")};y.prototype.CheckPadRange=function(a){this.is_main_painter()&&(this.check_pad_range=a?"pad_range":!0)};y.prototype.CheckHistDrawAttributes=function(){var a=this.GetHisto(),b=this.pad_painter();b&&(this.options._pfc||this.options._plc||this.options._pmc)&&(b=b.CreateAutoColor(),this.options._pfc&&(a.fFillColor=b,delete this.fillatt),this.options._plc&&(a.fLineColor=b,delete this.lineatt),this.options._pmc&&(a.fMarkerColor=b,delete this.markeratt),
this.options._pfc=this.options._plc=this.options._pmc=!1);this.createAttFill({attr:a,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:a,color0:this.options.histoLineColor})};y.prototype.UpdateObject=function(a,b){var c=this.GetHisto(),d=this.frame_painter();if(a!==c){var e=function(a,b){a.fTitle=b.fTitle;a.fLabels=b.fLabels;a.fXmin=b.fXmin;a.fXmax=b.fXmax;a.fTimeDisplay=b.fTimeDisplay;a.fTimeFormat=b.fTimeFormat;a.fAxisColor=b.fAxisColor;a.fLabelColor=b.fLabelColor;a.fLabelFont=
b.fLabelFont;a.fLabelOffset=b.fLabelOffset;a.fLabelSize=b.fLabelSize;a.fNdivisions=b.fNdivisions;a.fTickLength=b.fTickLength;a.fTitleColor=b.fTitleColor;a.fTitleFont=b.fTitleFont;a.fTitleOffset=b.fTitleOffset;a.fTitleSize=b.fTitleSize};if(!this.MatchObjectType(a))return!1;var g=this.FindPainterFor(this.FindStat());c.TestBit(k.TH1StatusBits.kNoStats)!=a.TestBit(k.TH1StatusBits.kNoStats)&&(c.fBits=a.fBits,g&&(g.Enabled=!c.TestBit(k.TH1StatusBits.kNoStats)));void 0!==this.snapid&&(c.fName=a.fName);c.fFillColor=
a.fFillColor;c.fFillStyle=a.fFillStyle;c.fLineColor=a.fLineColor;c.fLineStyle=a.fLineStyle;c.fLineWidth=a.fLineWidth;c.fEntries=a.fEntries;c.fTsumw=a.fTsumw;c.fTsumwx=a.fTsumwx;c.fTsumwx2=a.fTsumwx2;c.fXaxis.fNbins=a.fXaxis.fNbins;1<this.Dimension()&&(c.fTsumwy=a.fTsumwy,c.fTsumwy2=a.fTsumwy2,c.fTsumwxy=a.fTsumwxy,c.fYaxis.fNbins=a.fYaxis.fNbins,2<this.Dimension()&&(c.fTsumwz=a.fTsumwz,c.fTsumwz2=a.fTsumwz2,c.fTsumwxz=a.fTsumwxz,c.fTsumwyz=a.fTsumwyz,c.fZaxis.fNbins=a.fZaxis.fNbins));c.fArray=a.fArray;
c.fNcells=a.fNcells;c.fTitle=a.fTitle;c.fMinimum=a.fMinimum;c.fMaximum=a.fMaximum;e(c.fXaxis,a.fXaxis);e(c.fYaxis,a.fYaxis);e(c.fZaxis,a.fZaxis);!this.snapid&&d&&d.zoom_changed_interactive||(e=function(a,b){a.fFirst=b.fFirst;a.fLast=b.fLast;a.fBits=b.fBits},e(c.fXaxis,a.fXaxis),e(c.fYaxis,a.fYaxis),e(c.fZaxis,a.fZaxis));c.fSumw2=a.fSumw2;this.IsTProfile()?c.fBinEntries=a.fBinEntries:this.IsTH1K()?(c.fNIn=a.fNIn,c.fReady=!1):this.IsTH2Poly()&&(c.fBins=a.fBins);if(this.options.Func){var h=[];e=[];var f=
this.pad_painter(),u=this.hist_painter_id;f&&f.ForEachPainterInPad(function(a){a.child_painter_id===u&&h.push(a)},"objects");if(a.fFunctions)for(var n=0;n<a.fFunctions.arr.length;++n){var l=a.fFunctions.arr[n];if(l&&l._typename){for(var p=null,m=-1,q=0;q<h.length;++q)if(h[q].MatchObjectType(l._typename)&&h[q].GetObject().fName===l.fName){p=h[q];m=q;break}!p&&l.fName&&(p=this.FindPainterFor(null,l.fName,l._typename));p?(p.UpdateObject(l),0<=m&&h.splice(m,1)):e.push(l)}}g&&(g=h.indexOf(g),0<=g&&h.splice(g,
1));f&&0<h.length&&f.CleanPrimitives(function(a){return 0<=h.indexOf(a)});if(f&&0<e.length){g=f.has_canvas?f.CurrentPadName(f.this_pad_name):void 0;for(n=0;n<e.length;++n)k.draw(this.divid,e[n],"",function(a){a.child_painter_id=u});f.CurrentPadName(g)}}e=c.fOption!=a.fOption;c.fOption=a.fOption;(void 0!==b&&this.options.original!==b||e)&&this.DecodeOptions(b||c.fOption)}!this.snapid&&d&&d.zoom_changed_interactive||this.CheckPadRange();this.ScanContent();return this.histogram_updated=!0};y.prototype.CreateAxisFuncs=
function(a,b){function c(a){a.fXbins.length>=a.fNbins?(a.regular=!1,a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fXmin;if(b>this.fNbins)return this.fXmax;if(b==a)return this.fXbins[b];var c=a<b?b-1:b+1;return this.fXbins[b]*Math.abs(a-c)+this.fXbins[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fXbins.length;++c)if(a<this.fXbins[c])return Math.floor(c-1+b);return this.fNbins}):(a.regular=!0,a.binwidth=(a.fXmax-a.fXmin)/(a.fNbins||1),a.GetBinCoord=function(a){return this.fXmin+
a*this.binwidth},a.FindBin=function(a,b){return Math.floor((a-this.fXmin)/this.binwidth+b)})}var d=this.GetHisto();this.xmin=d.fXaxis.fXmin;this.xmax=d.fXaxis.fXmax;c(d.fXaxis);this.ymin=d.fYaxis.fXmin;this.ymax=d.fYaxis.fXmax;a&&0!=this.nbinsy&&(c(d.fYaxis),b&&0!=this.nbinsz&&c(d.fZaxis))};y.prototype.CreateXY=function(){if(this.is_main_painter()){var a=this.GetHisto(),b=this.frame_painter();if(!b)return console.warn("histogram drawn without frame - not supported");this.ymin===this.ymax&&(this.ymax+=
1);b.SetAxesRanges(a.fXaxis,this.xmin,this.xmax,a.fYaxis,this.ymin,this.ymax,a.fZaxis,0,0);b.CreateXY({ndim:this.Dimension(),check_pad_range:this.check_pad_range,create_canvas:this.create_canvas,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,ymin_nz:this.ymin_nz,swap_xy:20<=this.options.BarStyle,reverse_x:this.options.RevX,reverse_y:this.options.RevY,Proj:this.options.Proj,extra_y_space:this.options.Text&&0<this.options.BarStyle});delete this.check_pad_range}};y.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};
y.prototype.DrawAxes=function(){if(this.is_main_painter()&&!this.options.Same){var a=this.frame_painter();a&&a.DrawAxes(!1,0>this.options.Axis,this.options.AxisPos,this.options.Zscale)}};y.prototype.ToggleTitle=function(a){var b=this.GetHisto();if(!this.is_main_painter()||!b)return!1;if("only-check"===a)return!b.TestBit(k.TH1StatusBits.kNoTitle);b.InvertBit(k.TH1StatusBits.kNoTitle);this.DrawTitle()};y.prototype.DrawTitle=function(){if(this.is_main_painter()&&!this.options.Same){var a=this.GetHisto(),
b=k.gStyle,c=this.FindPainterFor(null,"title"),d=c?c.GetObject():null;d||(d=this.FindInPrimitives("title"));d&&"TPaveText"!==d._typename&&(d=null);var e=!a.TestBit(k.TH1StatusBits.kNoTitle)&&0<b.fOptTitle;d?(d.Clear(),e&&d.AddText(a.fTitle),c&&c.Redraw()):e&&!c&&a.fTitle&&!this.options.PadTitle&&(d=k.Create("TPaveText"),d.fName="title",d.fTextFont=b.fTitleFont,d.fTextSize=b.fTitleFontSize,d.fTextColor=b.fTitleTextColor,d.fTextAlign=b.fTitleAlign,d.fFillColor=b.fTitleColor,d.fFillStyle=b.fTitleStyle,
d.fBorderSize=b.fTitleBorderSize,d.AddText(a.fTitle),c=k.Painter.drawPave(this.divid,d,"postitle"))&&(c.$secondary=!0)}};y.prototype.processTitleChange=function(a){var b=this.GetHisto(),c=this.FindPainterFor(null,"title");if(!b||!c)return null;if("check"===a)return!this.is_main_painter()||this.options.Same?null:b;a=c.GetObject();a.Clear();a.AddText(b.fTitle);c.Redraw();this.WebCanvasExec('SetTitle("'+b.fTitle+'")')};y.prototype.UpdateStatWebCanvas=function(){if(this.snapid){var a=this.FindStat();
(a=this.FindPainterFor(a))&&!a.snapid&&a.Redraw()}};y.prototype.ToggleStat=function(a){var b=this.FindStat(),c=null;a||(a="");if(b)c=this.FindPainterFor(b);else{if(0<a.indexOf("-check"))return!1;b=this.CreateStat(!0)}if("only-check"==a)return c?c.Enabled:!1;if("fitpar-check"==a)return b?b.fOptFit:!1;if("fitpar-toggle"==a){if(!b)return!1;b.fOptFit=b.fOptFit?0:1111;c&&c.Redraw();return!0}if(c)return c.Enabled=!c.Enabled,c.Redraw(),c.Enabled;k.draw(this.divid,b,"onpad:"+this.pad_name);return!0};y.prototype.GetSelectIndex=
function(a,b,c){var d=this.frame_painter(),e=this["nbins"+a]||0,g=this.GetAxis(a),h=d?d["zoom_"+a+"min"]:0;a=d?d["zoom_"+a+"max"]:0;h!==a&&g?(c="left"==b?g.FindBin(h,c||0):g.FindBin(a,(c||0)+.5),0>c?c=0:c>e&&(c=e)):c="left"==b?0:e;g&&(g.fFirst===g.fLast||!g.TestBit(k.EAxisBits.kAxisRange)||1>=g.fFirst&&g.fLast>=e)&&(g=void 0);"left"==b?(0>c&&(c=0),g&&1<g.fFirst&&c<g.fFirst&&(c=g.fFirst-1)):(c>e&&(c=e),g&&g.fLast<=e&&c>g.fLast&&(c=g.fLast));return c};y.prototype.FindFunction=function(a,b){var c=this.GetObject();
c=c&&c.fFunctions?c.fFunctions.arr:null;if(!c)return null;for(var d=0;d<c.length;++d)if((!b||c[d].fName===b)&&c[d]._typename===a)return c[d];return null};y.prototype.FindStat=function(){if(this.options.PadStats){var a=this.FindPainterFor(null,"stats","TPaveStats");return a?a.GetObject():null}return this.FindFunction("TPaveStats","stats")};y.prototype.IgnoreStatsFill=function(){return!this.GetObject()||!this.draw_content&&!this.create_stats||0<this.options.Axis};y.prototype.CreateStat=function(a){var b=
this.GetHisto();if(this.options.PadStats||!b||!(a||this.options.ForceStat||!this.options.NoStat&&!b.TestBit(k.TH1StatusBits.kNoStats)&&k.gStyle.AutoStat&&this.draw_content&&this.is_main_painter()))return null;a=this.FindStat();var c=k.gStyle,d=this.options.optstat,e=this.options.optfit;void 0!==d?(a&&(a.fOptStat=d),delete this.options.optstat):d=b.$custom_stat||c.fOptStat;void 0!==e?(a&&(a.fOptFit=e),delete this.options.optfit):e=c.fOptFit;if(!a&&!d&&!e)return null;this.create_stats=!0;if(a)return a;
a=k.Create("TPaveStats");k.extend(a,{fName:"stats",fOptStat:d,fOptFit:e,fBorderSize:1});a.fX1NDC=c.fStatX-c.fStatW;a.fY1NDC=c.fStatY-c.fStatH;a.fX2NDC=c.fStatX;a.fY2NDC=c.fStatY;a.fFillColor=c.fStatColor;a.fFillStyle=c.fStatStyle;a.fTextAngle=0;a.fTextSize=c.fStatFontSize;a.fTextAlign=12;a.fTextColor=c.fStatTextColor;a.fTextFont=c.fStatFont;if(b._typename.match(/^TProfile/)||b._typename.match(/^TH2/))a.fY1NDC=.67;a.AddText(b.fName);this.AddFunction(a);return a};y.prototype.AddFunction=function(a,
b){var c=this.GetObject();c&&a&&(c.fFunctions||(c.fFunctions=k.Create("TList")),b?c.fFunctions.AddFirst(a):c.fFunctions.Add(a))};y.prototype.DrawNextFunction=function(a,b,c){c&&"object"==typeof c&&(c.child_painter_id=this.hist_painter_id);c=this.GetHisto();if(!this.options.Func||!c.fFunctions||a>=c.fFunctions.arr.length)return k.CallBack(b);var d=c.fFunctions.arr[a],e=c.fFunctions.opt[a],g=!1;null===this.FindPainterFor(d)&&(g="TPaveText"===d._typename||"TPaveStats"===d._typename?!c.TestBit(k.TH1StatusBits.kNoStats)&&
!this.options.NoStat:"TF1"===d._typename?!d.TestBit(k.BIT(9)):"TPaletteAxis"!==d._typename);if(g)return k.draw(this.divid,d,e,this.DrawNextFunction.bind(this,a+1,b));this.DrawNextFunction(a+1,b)};y.prototype.UnzoomUserRange=function(a,b,c){function d(a){if(!a||!a.TestBit(k.EAxisBits.kAxisRange)||a.fFirst===a.fLast||1>=a.fFirst&&a.fLast>=a.fNbins)return!1;a.InvertBit(k.EAxisBits.kAxisRange);return!0}function e(a,b){if(h.Dimension()!==a||-1111===h.options.minimum&&-1111===h.options.maximum||!h.draw_content)return!1;
h.options.minimum=h.options.maximum=-1111;h.ScanContent(!0);return!0}var g=!1,h=this,f=this.GetHisto();if(!f)return!1;a&&d(f.fXaxis)&&(g=!0);b&&(d(f.fYaxis)||e(1,f))&&(g=!0);c&&(d(f.fZaxis)||e(2,f))&&(g=!0);return g};y.prototype.AllowDefaultYZooming=function(){if(1<this.Dimension())return!0;if(this.draw_content)return!1;var a=this.pad_painter();if(a&&a.painters)for(var b=0;b<a.painters.length;++b){var c=a.painters[b];if(c!==this&&void 0!==c.wheel_zoomy)return c.wheel_zoomy}return!1};y.prototype.AddInteractive=
function(){if(this.is_main_painter()){var a=this.frame_painter();a&&a.AddInteractive()}};y.prototype.ShowContextMenu=function(a,b,c){var d=this,e=!1,g=null;if(!b&&(A.event.preventDefault(),A.event.stopPropagation(),b=A.event,void 0===a)){var h=A.mouse(this.svg_frame().node()),f=A.touches(this.svg_frame().node()),u=this.pad_painter(),n=null,l=null;g=this.frame_painter();1===f.length?n={x:f[0][0],y:f[0][1],touch:!0}:2===h.length&&(n={x:h[0],y:h[1],touch:!1});if(null!==n&&null!==u)for(n.painters=!0,
h=u.GetTooltips(n),f=1E3,u=0;u<h.length;++u)if(h[u]&&h[u].menu){var p="menu_dist"in h[u]?h[u].menu_dist:7;p<f&&(l=h[u].painter,f=p)}null!==l?d=l:null!==g&&(a="frame");null!==n&&(e=0<n.x&&20>n.x&&0<n.y&&20>n.y);g&&g.SetLastEventPos(n)}k.Painter.createMenu(d,function(b){var d=b.painter.FillContextMenu(b,a,c);g&&(!d||e&&"frame"!==a)&&(d=g.FillContextMenu(b));d&&b.painter.FillObjectExecMenu(b,a,function(){b.painter.SwitchTooltip(!1);b.show(null,b.painter.SwitchTooltip.bind(b.painter,!0))})},b)};y.prototype.ChangeUserRange=
function(a){var b=this.GetHisto();if(b=b?b["f"+a+"axis"]:null){var c="[1,"+b.fNbins+"]";b.TestBit(k.EAxisBits.kAxisRange)&&(c="["+b.fFirst+","+b.fLast+"]");if(a=prompt("Enter user range for axis "+a+" like [1,"+b.fNbins+"]",c))!(a=JSON.parse(a))||2!=a.length||isNaN(a[0])||isNaN(a[1])||(b.fFirst=parseInt(a[0]),b.fLast=parseInt(a[1]),(b.fFirst<b.fLast&&1<=b.fFirst&&b.fLast<=b.fNbins)!=b.TestBit(k.EAxisBits.kAxisRange)&&b.InvertBit(k.EAxisBits.kAxisRange),this.Redraw())}};y.prototype.ChangeValuesRange=
function(){var a=prompt("Enter min/max hist values or empty string to reset",-1111!=this.options.minimum&&-1111!=this.options.maximum?"["+this.options.minimum+","+this.options.maximum+"]":"["+this.gminbin+","+this.gmaxbin+"]");a=a?JSON.parse(a):[];!a||"object"!=typeof a||2!=a.length||isNaN(a[0])||isNaN(a[1])?this.options.minimum=this.options.maximum=-1111:(this.options.minimum=a[0],this.options.maximum=a[1]);this.RedrawPad()};y.prototype.FillContextMenu=function(a){var b=this.GetHisto(),c=this.frame_painter();
if(b){a.add("header:"+b._typename+"::"+b.fName);this.draw_content&&(a.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()}),1==this.Dimension()?a.add("User range X","X",this.ChangeUserRange):(a.add("sub:User ranges"),a.add("X","X",this.ChangeUserRange),a.add("Y","Y",this.ChangeUserRange),2<this.Dimension()?a.add("Z","Z",this.ChangeUserRange):a.add("Values",this.ChangeValuesRange),a.add("endsub:")),"function"==typeof this.FillHistContextMenu&&this.FillHistContextMenu(a));
if(this.options.Mode3D){0<a.size()&&a.add("separator");var d=this.main_painter()||this;a.addchk(d.IsTooltipAllowed(),"Show tooltips",function(){d.SetTooltipAllowed("toggle")});a.addchk(c.enable_highlight,"Highlight bins",function(){c.enable_highlight=!c.enable_highlight;!c.enable_highlight&&c.BinHighlight3D&&c.mode3d&&c.BinHighlight3D(null)});c&&c.Render3D&&(a.addchk(d.options.FrontBox,"Front box",function(){d.options.FrontBox=!d.options.FrontBox;c.Render3D()}),a.addchk(d.options.BackBox,"Back box",
function(){d.options.BackBox=!d.options.BackBox;c.Render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.InteractiveRedraw("pad")}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()}),this.FillPaletteMenu&&this.FillPaletteMenu(a));d.control&&"function"===typeof d.control.reset&&a.add("Reset camera",function(){d.control.reset()})}this.FillAttContextMenu(a);
this.histogram_updated&&c.zoom_changed_interactive&&a.add("Let update zoom",function(){c.zoom_changed_interactive=0});return!0}};y.prototype.ButtonClick=function(a){var b=this.frame_painter();if(!this.is_main_painter()||!b)return!1;switch(a){case "ToggleZoom":if(b.zoom_xmin!==b.zoom_xmax||b.zoom_ymin!==b.zoom_ymax||b.zoom_zmin!==b.zoom_zmax)return b.Unzoom(),b.zoom_changed_interactive=0,!0;if(this.draw_content&&"function"===typeof this.AutoZoom)return this.AutoZoom(),!0;break;case "ToggleLogX":b.ToggleLog("x");
break;case "ToggleLogY":b.ToggleLog("y");break;case "ToggleLogZ":b.ToggleLog("z");break;case "ToggleStatBox":return this.ToggleStat(),!0}return!1};y.prototype.FillToolbar=function(a){var b=this.pad_painter();b&&(b.AddButton(k.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),b.AddButton(k.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown"),b.AddButton(k.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp"),1<this.Dimension()&&b.AddButton(k.ToolbarIcons.arrow_diag,
"Toggle log z","ToggleLogZ"),this.draw_content&&b.AddButton(k.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox"),a||b.ShowButtons())};y.prototype.Get3DToolTip=function(a){var b=this.GetHisto(),c={bin:a,name:b.fName,title:b.fTitle};switch(this.Dimension()){case 1:c.ix=a;c.iy=1;c.value=b.getBinContent(c.ix);c.error=b.getBinError(a);c.lines=this.GetBinTips(a-1);break;case 2:c.ix=a%(this.nbinsx+2);c.iy=(a-c.ix)/(this.nbinsx+2);c.value=b.getBinContent(c.ix,c.iy);c.error=b.getBinError(a);c.lines=this.GetBinTips(c.ix-
1,c.iy-1);break;case 3:c.ix=a%(this.nbinsx+2),c.iy=(a-c.ix)/(this.nbinsx+2)%(this.nbinsy+2),c.iz=(a-c.ix-c.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),c.value=b.getBinContent(c.ix,c.iy,c.iz),c.error=b.getBinError(a),c.lines=this.GetBinTips(c.ix-1,c.iy-1,c.iz-1)}return c};y.prototype.CreateContour=function(a,b,c,d){1>a&&(a=k.gStyle.fNumberContours);this.fContour=[];this.colzmin=b;this.colzmax=c;if(this.root_pad().fLogz){0>=this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===
d||0>=d?1E-4*this.colzmax:3>d||100<d?.3*d:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);b=Math.log(this.colzmin)/Math.log(10);c=(Math.log(this.colzmax)/Math.log(10)-b)/a;this.fContour.push(this.colzmin);for(d=1;d<a;d++)this.fContour.push(Math.exp((b+c*d)*Math.log(10)));this.fContour.push(this.colzmax);this.fCustomContour=!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin)),c=(this.colzmax-this.colzmin)/
a,d=0;d<=a;d++)this.fContour.push(this.colzmin+c*d);a=this.frame_painter();3>this.Dimension()&&a&&(a.zmin=this.colzmin,a.zmax=this.colzmax);return this.fContour};y.prototype.GetContour=function(){if(this.fContour)return this.fContour;var a=this.main_painter(),b=this.frame_painter();if(a&&a!==this&&a.fContour)return this.fContour=a.fContour,this.fCustomContour=a.fCustomContour,this.colzmin=a.colzmin,this.colzmax=a.colzmax,this.fContour;a=this.GetObject();var c=k.gStyle.fNumberContours,d=this.minbin,
e=this.maxbin,g=this.minposbin;d===e&&(d=this.gminbin,e=this.gmaxbin,g=this.gminposbin);a.fContour&&(c=a.fContour.length);-1111!==this.options.minimum&&-1111!=this.options.maximum&&(d=this.options.minimum,e=this.options.maximum);b&&b.zoom_zmin!=b.zoom_zmax&&(d=b.zoom_zmin,e=b.zoom_zmax);if(a.fContour&&1<a.fContour.length&&a.TestBit(k.TH1StatusBits.kUserContour)){this.fContour=[];for(c=0;c<a.fContour.length;++c)this.fContour.push(a.fContour[c]);this.fCustomContour=!0;this.colzmin=d;this.colzmax=e;
e>this.fContour[this.fContour.length-1]&&this.fContour.push(e);3>this.Dimension()&&b&&(b.zmin=this.colzmin,b.zmax=this.colzmax);return this.fContour}this.fCustomContour=!1;return this.CreateContour(c,d,e,g)};y.prototype.getContourIndex=function(a){var b=this.GetContour();if(this.fCustomContour){var c=0,d=b.length-1;if(a<b[0])return-1;if(a>=b[d])return d;for(;c<d-1;){var e=Math.round((c+d)/2);b[e]>a?d=e:c=e}return c}return a<this.colzmin?this.options.Zero?-1:0:a===this.colzmin?0!=this.colzmin||!this.options.Zero||
this.IsTH2Poly()?0:-1:Math.floor(.01+(a-this.colzmin)*(b.length-1)/(this.colzmax-this.colzmin))};y.prototype.getContourColor=function(a,b){var c=this.getContourIndex(a);if(0>c)return null;var d=this.GetContour();a=this.GetPalette();c=a.calcColorIndex(c,d.length);return b?c:a.getColor(c)};y.prototype.GetPalette=function(a){if(!this.fPalette||a)this.fPalette=this.get_palette(!0,this.options.Palette);return this.fPalette};y.prototype.FillPaletteMenu=function(a){function b(a){e.options.Palette=parseInt(a);
e.GetPalette(!0);e.Redraw()}function c(c,e,f){a.addchk(c===d||f,"<nobr>"+e+"</nobr>",c,b)}var d=this.options.Palette,e=this;if(null===d||0===d)d=k.gStyle.Palette;a.add("sub:Palette");c(50,"ROOT 5",10<=d&&51>d);c(51,"Deep Sea");c(52,"Grayscale",0<d&&10>d);c(53,"Dark body radiator");c(54,"Two-color hue");c(55,"Rainbow");c(56,"Inverted dark body radiator");c(57,"Bird",113<d);c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,"Alpine");
c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");a.add("endsub:")};y.prototype.DrawColorPalette=function(a,b,c){if(!this.is_main_painter())return null;var d=this.FindFunction("TPaletteAxis"),e=this.FindPainterFor(d);this._can_move_colz&&(c=!0,delete this._can_move_colz);e||d||!(e=this.FindPainterFor(void 0,void 0,"TPaletteAxis"))||(d=e.GetObject(),this.AddFunction(d,!0));if(!a)return e&&(e.Enabled=!1,e.RemoveDrawG()),null;if(!d){if(this.options.PadPalette)return null;d=k.Create("TPave");k.extend(d,
{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:k.Create("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});c=this.GetHisto().fZaxis;k.extend(d.fAxis,{fTitle:c.fTitle,fTitleSize:c.fTitleSize,fChopt:"+",fLineColor:c.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:c.fLabelSize,fTextAlign:11,fTextColor:c.fLabelColor,fTextFont:c.fLabelFont});this.AddFunction(d,!0);c=!0}a=this.frame_painter();c&&a&&(d.fX2NDC=a.fX2NDC+.01+(d.fX2NDC-d.fX1NDC),d.fX1NDC=a.fX2NDC+.01,d.fY1NDC=a.fY1NDC,
d.fY2NDC=a.fY2NDC);var g="";b&&(g+=";postpone");c&&!this.do_redraw_palette&&(g+=";can_move");if(e)e.Enabled=!0,e.DrawPave(g);else{var h=this.CurrentPadName(this.pad_name);e=k.draw(this.divid,d,g);this.CurrentPadName(h)}e.$secondary=!0;e.Redraw=function(){};c&&a&&d.fX1NDC-.005<a.fX2NDC&&!this.do_redraw_palette&&(this.do_redraw_palette=!0,a.fX2NDC=d.fX1NDC-.01,a.Redraw(),b||this.Redraw(),delete this.do_redraw_palette);return e};y.prototype.ToggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||
14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.DrawColorPalette(this.options.Zscale,!1,!0)};y.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.CopyOptionsToOthers();
this.InteractiveRedraw("pad","drawopt")};y.prototype.PrepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var b=this.GetHisto(),c=b.fXaxis,d=b.fYaxis,e=this.frame_painter(),g=this.Dimension(),h,f={i1:this.GetSelectIndex("x","left",0-a.extra),i2:this.GetSelectIndex("x","right",1+a.extra),j1:1===g?0:this.GetSelectIndex("y","left",0-a.extra),j2:1===g?1:this.GetSelectIndex("y","right",1+a.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,
ybar1:0,ybar2:1};f.grx=new Float32Array(f.i2+1);f.gry=new Float32Array(f.j2+1);"number"!=typeof b.fBarOffset||"number"!=typeof b.fBarWidth||!b.fBarOffset&&1E3===b.fBarWidth||(1E3>=b.fBarOffset?f.xbar1=f.ybar1=.001*b.fBarOffset:3E3>=b.fBarOffset?f.xbar1=.001*(b.fBarOffset-2E3):5E3>=b.fBarOffset&&(f.ybar1=.001*(b.fBarOffset-4E3)),1E3>=b.fBarWidth?(f.xbar2=Math.min(1,f.xbar1+.001*b.fBarWidth),f.ybar2=Math.min(1,f.ybar1+.001*b.fBarWidth)):3E3>=b.fBarWidth?f.xbar2=Math.min(1,f.xbar1+.001*(b.fBarWidth-
2E3)):5E3>=b.fBarWidth&&(f.ybar2=Math.min(1,f.ybar1+.001*(b.fBarWidth-4E3))));a.original&&(f.original=!0,f.origx=new Float32Array(f.i2+1),f.origy=new Float32Array(f.j2+1));a.pixel_density&&(a.rounding=!0);if(!e)return console.warn("cannot draw histogram without frame"),f;for(h=f.i1;h<=f.i2;++h){var k=c.GetBinCoord(h+a.middle);e.logx&&0>=k?f.i1=h+1:(f.origx&&(f.origx[h]=k),f.grx[h]=e.grx(k),a.rounding&&(f.grx[h]=Math.round(f.grx[h])),a.use3d&&(f.grx[h]<-e.size_xy3d&&(f.i1=h,f.grx[h]=-e.size_xy3d),
f.grx[h]>e.size_xy3d&&(f.i2=h,f.grx[h]=e.size_xy3d)))}if(1===g)f.gry[0]=e.gry(0),f.gry[1]=e.gry(1);else for(c=f.j1;c<=f.j2;++c)h=d.GetBinCoord(c+a.middle),e.logy&&0>=h?f.j1=c+1:(f.origy&&(f.origy[c]=h),f.gry[c]=e.gry(h),a.rounding&&(f.gry[c]=Math.round(f.gry[c])),a.use3d&&(f.gry[c]<-e.size_xy3d&&(f.j1=c,f.gry[c]=-e.size_xy3d),f.gry[c]>e.size_xy3d&&(f.j2=c,f.gry[c]=e.size_xy3d)));b.getBinContent(f.i1+1,f.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(h=f.i1;h<f.i2;++h)for(c=f.j1;c<f.j2;++c){d=
b.getBinContent(h+1,c+1);f.sumz+=d;if(a.pixel_density){e=(f.grx[h+1]-f.grx[h])*(f.gry[c]-f.gry[c+1]);if(0>=e)continue;f.max=Math.max(f.max,d);0<d&&(d<f.min||0===f.min)&&(f.min=d);d/=e}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}this.fContour=null;this.fCustomContour=!1;return f};G.prototype=Object.create(y.prototype);G.prototype.ConvertTH1K=function(){var a=
this.GetObject();if(!a.fReady){var b=a.fArray,c=a.fEntries;a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var d=0;d<a.fNcells;++d)a.fArray[d]=0;for(d=0;d<a.fNIn;++d)a.Fill(b[d]);a.fReady=!0;a.fEntries=c}};G.prototype.ScanContent=function(a){a&&!this.nbinsx&&(a=!1);this.IsTH1K()&&this.ConvertTH1K();var b=this.GetHisto();a||(this.nbinsx=b.fXaxis.fNbins,this.nbinsy=0,this.CreateAxisFuncs(!1));var c=this.GetSelectIndex("x","left"),d=this.GetSelectIndex("x","right");if(!a||c!==this.scan_xleft||
d!==this.scan_xright){this.draw_content=!(0<this.options.Axis);this.scan_xleft=c;this.scan_xright=d;for(var e=0,g=0,h=0,f=0,k=!0,n=this.IsTProfile(),l,p,m=0;m<this.nbinsx;++m)l=b.getBinContent(m+1),f+=n?b.fBinEntries[m+1]:l,m<c||m>=d||(0<l&&(0==g||l<g)&&(g=l),k&&(e=h=l,k=!1),p=this.options.Error?b.getBinError(m+1):0,e=Math.min(e,l-p),h=Math.max(h,l+p));this.stat_entries=f=n?f+(b.fBinEntries[0]+b.fBinEntries[this.nbinsx+1]):f+(b.getBinContent(0)+b.getBinContent(this.nbinsx+1));1<b.fEntries&&(this.stat_entries=
b.fEntries);this.hmin=e;this.hmax=h;this.ymin_nz=g;if(0==this.nbinsx||1E-300>Math.abs(e)&&1E-300>Math.abs(h))this.draw_content=!1;c=b=!1;this.draw_content?e>=h?0==e?(this.ymin=0,this.ymax=1):0>e?(this.ymin=2*e,this.ymax=0):(this.ymin=0,this.ymax=2*e):(d=.05*(h-e),this.ymin=e-d,0>this.ymin&&0<=e&&(this.ymin=0),this.ymax=h+d):this.options.ymin!==this.options.ymax&&(this.ymin=this.options.ymin,this.ymax=this.options.ymax,c=!0);e=this.options.minimum;h=this.options.maximum;e===h&&-1111!==e&&(0>e?(e*=
2,h=0):(e=0,(h*=2)||(h=1)));-1111==e||-1111==h||this.draw_content||c?(-1111!=e&&(e<this.ymin?this.ymin=e:b=!0),-1111!=h&&(h>this.ymax?this.ymax=h:b=!0)):(this.ymin=e,this.ymax=h);a||(b&&(this.draw_content||c)?(this.zoom_ymin=-1111==e?this.ymin:e,this.zoom_ymax=-1111==h?this.ymax:h):(delete this.zoom_ymin,delete this.zoom_ymax));1<this.Dimension()?this.wheel_zoomy=!0:this.draw_content&&(this.wheel_zoomy=!1)}};G.prototype.CountStat=function(a){for(var b=this.IsTProfile(),c=this.GetHisto(),d=c.fXaxis,
e=this.GetSelectIndex("x","left"),g=this.GetSelectIndex("x","right"),h=0,f=0,k=0,n=0,l=0,p,m,q=null,r=null,t=this.frame_painter(),x={name:c.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};e<g;++e)if(p=d.GetBinCoord(e+.5),!a||a(p)){b?(m=c.fBinEntries[e+1],n+=c.fArray[e+1],l+=c.fSumw2[e+1]):m=c.getBinContent(e+1);if(null===q||m>r)q=p,r=m;h+=m;f+=m*p;k+=m*p*p}!t.IsAxisZoomed("x")&&0<c.fTsumw&&(h=c.fTsumw,f=c.fTsumwx,k=c.fTsumwx2);x.integral=h;0<h&&(x.meanx=f/h,
x.meany=n/h,x.rmsx=Math.sqrt(Math.abs(k/h-x.meanx*x.meanx)),x.rmsy=Math.sqrt(Math.abs(l/h-x.meany*x.meany)));null!==q&&(x.xmax=q,x.wmax=r);return x};G.prototype.FillStatistic=function(a,b,c){if(this.IgnoreStatsFill())return!1;var d=this.GetHisto(),e=this.CountStat(),g=b%10,h=Math.floor(b/10)%10,f=Math.floor(b/100)%10,k=Math.floor(b/1E3)%10,n=Math.floor(b/1E4)%10,l=Math.floor(b/1E5)%10,p=Math.floor(b/1E6)%10,m=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.ClearPave();0<g&&a.AddText(e.name);this.IsTProfile()?
(0<h&&a.AddText("Entries = "+a.Format(e.entries,"entries")),0<f&&(a.AddText("Mean = "+a.Format(e.meanx)),a.AddText("Mean y = "+a.Format(e.meany))),0<k&&(a.AddText("Std Dev = "+a.Format(e.rmsx)),a.AddText("Std Dev y = "+a.Format(e.rmsy)))):(0<h&&a.AddText("Entries = "+a.Format(e.entries,"entries")),0<f&&a.AddText("Mean = "+a.Format(e.meanx)),0<k&&a.AddText("Std Dev = "+a.Format(e.rmsx)),0<n&&a.AddText("Underflow = "+a.Format(0<d.fArray.length?d.fArray[0]:0,"entries")),0<l&&a.AddText("Overflow = "+
a.Format(0<d.fArray.length?d.fArray[d.fArray.length-1]:0,"entries")),0<p&&a.AddText("Integral = "+a.Format(e.integral,"entries")),0<m&&a.AddText("Skew = <not avail>"),0<b&&a.AddText("Kurt = <not avail>"));c&&a.FillFunctionStat(this.FindFunction("TF1"),c);return!0};G.prototype.DrawBars=function(a,b){this.CreateG(!0);var c=this.GetSelectIndex("x","left",-1);a=this.GetSelectIndex("x","right",1);var d=this.frame_painter();this.root_pad();var e=this.GetHisto(),g=e.fXaxis,h=this.options.Text,f="",u="",
n="",l=10<this.options.BarStyle?this.options.BarStyle%10:0;4<l&&(l=4);var p=d.swap_xy?0:b;!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=d.scale_ymin&&(p=Math.round(d.gry(this.options.BaseLine)));if(h){var m=this.get_color(e.fMarkerColor);var q=-1*this.options.TextAngle;var r=20;1!==e.fMarkerSize&&q&&(r=.02*b*e.fMarkerSize);this.StartTextDrawing(42,r,this.draw_g,r)}for(b=c;b<a;++b){c=g.GetBinLowEdge(b+1);var t=g.GetBinLowEdge(b+2);if(!(d.logx&&0>=t)){c=Math.round(d.grx(c));
var x=Math.round(d.grx(t));var v=e.getBinContent(b+1);if(!(d.logy&&v<d.scale_ymin)){t=Math.round(d.gry(v));var w=x-c;c+=Math.round(e.fBarOffset/1E3*w);w=Math.round(e.fBarWidth/1E3*w);f=d.swap_xy?f+("M"+p+","+c+"h"+(t-p)+"v"+w+"h"+(p-t)+"z"):f+("M"+c+","+t+"h"+w+"v"+(p-t)+"h"+-w+"z");0<l&&(x=c+w,w=Math.round(w*l/10),d.swap_xy?(u+="M"+p+","+c+"h"+(t-p)+"v"+w+"h"+(p-t)+"z",n+="M"+p+","+x+"h"+(t-p)+"v"+-w+"h"+(p-t)+"z"):(u+="M"+c+","+t+"h"+w+"v"+(p-t)+"h"+-w+"z",n+="M"+x+","+t+"h"+-w+"v"+(p-t)+"h"+w+
"z"));h&&v&&(x=v===Math.round(v)?v.toString():k.FFormat(v,k.gStyle.fPaintTextFormat),d.swap_xy?this.DrawText({align:12,x:Math.round(t+r/2),y:Math.round(c+.1),height:Math.round(.8*w),text:x,color:m,latex:0}):q?this.DrawText({align:12,x:c+w/2,y:Math.round(t-2-r/5),width:0,height:0,rotate:q,text:x,color:m,latex:0}):this.DrawText({align:22,x:Math.round(c+.1*w),y:Math.round(t-2-r),width:Math.round(.8*w),height:r,text:x,color:m,latex:0}))}}}f&&this.draw_g.append("svg:path").attr("d",f).call(this.fillatt.func);
u&&this.draw_g.append("svg:path").attr("d",u).call(this.fillatt.func).style("fill",A.rgb(this.fillatt.color).brighter(.5).toString());n&&this.draw_g.append("svg:path").attr("d",n).call(this.fillatt.func).style("fill",A.rgb(this.fillatt.color).darker(.5).toString());h&&this.FinishTextDrawing(this.draw_g)};G.prototype.DrawFilledErrors=function(a,b){this.CreateG(!0);var c=this.GetSelectIndex("x","left",-1),d=this.GetSelectIndex("x","right",1),e=this.frame_painter(),g=this.GetHisto(),h=g.fXaxis;b=[];
for(a=[];c<d;++c){var f=h.GetBinCoord(c+.5);if(!(e.logx&&0>=f)){f=Math.round(e.grx(f));var u=g.getBinContent(c+1);var n=g.getBinError(c+1);if(!(e.logy&&u-n<e.scale_ymin)){var l=Math.round(e.gry(u+n));u=Math.round(e.gry(u-n));b.push({grx:f,gry:l});a.unshift({grx:f,gry:u})}}}d=4===this.options.ErrorKind?"bezier":"line";b=k.Painter.BuildSvgPath(d,b);a=k.Painter.BuildSvgPath("L"+d,a);this.draw_g.append("svg:path").attr("d",b.path+a.path+"Z").style("stroke","none").call(this.fillatt.func)};G.prototype.DrawBins=
function(){function a(a){U=u.getBinContent(a+1);if(y&&0===U)return!1;N=Math.round(f.grx(n.GetBinLowEdge(a+1)));O=Math.round(f.grx(n.GetBinLowEdge(a+2)));P=Math.round((N+O)/2);L=Math.round(f.gry(U));S=Y=20;M&&(da=u.getBinError(a+1),S=Math.round(L-f.gry(U+da)),Y=Math.round(f.gry(U-da)-L));return!0}function b(a){0<l.options.errorX&&(ea=Math.round(P-(O-N)*l.options.errorX),W=Math.round(P+(O-N)*l.options.errorX),F+="M"+(ea+Z)+","+L+fa+"h"+(W-ea-2*Z)+fa);F+="M"+P+","+(L-S+Z)+ha+"v"+(S+Y-2*Z)+ha}function c(c){if(a(c)){if(D){var d=
C?u.fBinEntries[c+1]:U;0!==d&&(d=d===Math.round(d)?d.toString():k.FFormat(d,k.gStyle.fPaintTextFormat),aa?l.DrawText({align:12,x:P,y:Math.round(L-2-Q/5),width:0,height:0,rotate:aa,text:d,color:X,latex:0}):l.DrawText({align:22,x:Math.round(N+.1*(O-N)),y:Math.round(L-2-Q),width:Math.round(.8*(O-N)),height:Q,text:d,color:X,latex:0}))}B&&null!==H&&(H+=(0===H.length?"M":"L")+P+","+L);ca&&L>=-S&&L<=e+Y&&(null!==A&&(A+="M"+N+","+(L-S)+"h"+(O-N)+"v"+(S+Y+1)+"h-"+(O-N)+"z"),null!==G&&I&&(G+=l.markeratt.create(P,
L)),null!==F&&J&&b(c))}}this.CheckHistDrawAttributes();var d=this.frame_width(),e=this.frame_height();if(!this.draw_content||0>=d||0>=e)return this.RemoveDrawG();if(this.options.Bar)return this.DrawBars(d,e);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.DrawFilledErrors(d,e);var g=this.GetSelectIndex("x","left",-1),h=this.GetSelectIndex("x","right",2),f=this.frame_painter();this.root_pad();var u=this.GetHisto(),n=u.fXaxis,l=this,p="",m=!1,q,r,t,x,v,w,z,y=!this.options.Zero,
M=this.options.Error,E=this.options.Mark,B=this.options.Line||this.options.Curve,D=this.options.Text,C=D&&"E"==this.options.TextKind&&this.IsTProfile()&&u.fBinEntries,A=null,F=null,G=null,H=null,I=!1,J=!1,fa="",ha="",Z=0,L,S,Y,U,da,N,O,P,ea,W;M&&!E&&1<u.fMarkerStyle&&(E=!0);2===this.options.ErrorKind?this.fillatt.empty()?E=!0:A="":this.options.Error&&(F="",J=!0);B&&(H="");E&&(this.createAttMarker({attr:u,style:this.options.MarkStyle}),0<this.markeratt.size?(G="",I=!0,this.markeratt.reset_pos()):E=
!1);var ca=M||E,ia=ca||D||B;E=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!E&&!ia)return this.RemoveDrawG();this.CreateG(!0);if(D){var X=this.get_color(u.fMarkerColor);var aa=-1*this.options.TextAngle;var Q=20;1!==u.fMarkerSize&&aa&&(Q=.02*e*u.fMarkerSize);aa||this.options.TextKind||(m=d/(h-g+1),m<3*Q&&(aa=270,Q=Math.round(.7*m)));this.StartTextDrawing(42,Q,this.draw_g,Q)}d=h-g>3*d;1===this.options.ErrorKind&&(m=this.lineatt.width+k.gStyle.fEndErrorSize,fa="m0,"+m+"v-"+2*
m+"m0,"+m,ha="m"+m+",0h-"+2*m+"m"+m+",0",Z=Math.floor((this.lineatt.width-1)/2));ia&&(d=!0);if(I||J)if(!k.gStyle.OptimizeDraw||5E4>h-g&&1==k.gStyle.OptimizeDraw){for(w=g;w<h;++w)a(w)&&(null!==G&&(G+=l.markeratt.create(P,L)),null!==F&&b(w));J=I=!1}for(w=g;w<=h;++w)if(m=n.GetBinLowEdge(w+1),!(this.logx&&0>=m)){var R=Math.round(f.grx(m));if((m=w===h)&&g<h)var K=t;else K=u.getBinContent(w+1),K=Math.round(f.gry(K));if(0===p.length){var T=z=w;var ba=q=r=R;var V=x=v=t=K;p="M"+r+","+t}else if(d)R!==r||m?
(ia&&(T===z?c(T):T<z?(c(T),c(z)):(c(z),c(T))),!E||x===v&&V===x||(ba!==r&&(p+="h"+(r-ba)),t===x?(v!==V&&(p+="v"+(v-V)),x!==v&&(p+="v"+(x-v))):(x!==V&&(p+="v"+(x-V)),v!==x&&(p+="v"+(v-x)),t!==v&&(p+="v"+(t-v))),ba=r,V=t),m&&ba!==R&&(p+="h"+(R-ba)),T=z=w,x=v=t=K,r=R):(K<x?z=w:K>v&&(T=w),x=Math.min(x,K),v=Math.max(v,K),t=K);else if(K!==t||m)R!==r&&(p+="h"+(R-r)),K!==t&&(p+="v"+(K-t)),t=K,r=R}g=!k.BatchMode&&this.fillatt.empty()&&E&&0<k.gStyle.Tooltip&&!ca&&!B;h=e+3;g||(t=Math.round(f.gry(0)),0>=t?h=-3:
t<e&&(h=t));q="L"+r+","+h+"L"+q+","+h+"Z";if(ca||B)null!==A&&0<A.length&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func),null!==F&&0<F.length&&this.draw_g.append("svg:path").attr("d",F).call(this.lineatt.func),null!==H&&0<H.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",(this.options.Fill?H:p)+q).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",H).attr("fill","none").call(this.lineatt.func)),null!==G&&0<G.length&&this.draw_g.append("svg:path").attr("d",
G).call(this.markeratt.func);if(0<p.length&&E){if(!this.fillatt.empty()||g)p+=q;this.draw_g.append("svg:path").attr("d",p).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}D&&this.FinishTextDrawing(this.draw_g)};G.prototype.GetBinTips=function(a){var b=[],c=this.GetTipName(),d=this.frame_painter(),e=this.GetHisto(),g=e.fXaxis.GetBinLowEdge(a+1),h=e.fXaxis.GetBinLowEdge(a+2),f=e.getBinContent(a+1),u=!1;0<c.length&&b.push(c);"labels"===d.x_kind?c=d.AxisAsText("x",g):
"time"===d.x_kind?c=d.AxisAsText("x",(g+h)/2):(u=!0,c="["+d.AxisAsText("x",g)+", "+d.AxisAsText("x",h)+")");this.options.Error||this.options.Mark?(b.push("x = "+c),b.push("y = "+d.AxisAsText("y",f)),this.options.Error&&(u&&b.push("error x = "+((h-g)/2).toPrecision(4)),b.push("error y = "+e.getBinError(a+1).toPrecision(4)))):(b.push("bin = "+(a+1)),b.push("x = "+c),e.$baseh&&(f-=e.$baseh.getBinContent(a+1)),f===Math.round(f)?b.push("entries = "+f):b.push("entries = "+k.FFormat(f,k.gStyle.fStatFormat)));
return b};G.prototype.ProcessTooltip=function(a){function b(a){a=h.fXaxis.GetBinLowEdge(a+1);return g.logx&&0>=a?null:g.grx(a)}function c(a){a=h.getBinContent(a+1);return g.logy&&a<g.scale_ymin?g.swap_xy?-1E3:10*e:Math.round(g.gry(a))}if(null===a||!this.draw_content||!this.draw_g||this.options.Mode3D)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.frame_width(),e=this.frame_height(),g=this.frame_painter();this.root_pad();var h=this.GetHisto(),f=null,k=!0,n,l=
2,p=this.GetSelectIndex("x","left",-1),m=this.GetSelectIndex("x","right",2);var q=p;var r=m;var t=a.x,x=a.y;if(g.swap_xy){var v=a.x;t=x;x=v;v=e;e=d;d=v}for(;q<r-1;){var w=Math.round(.5*(q+r));f=b(w);null===f||f<t-.5?g.swap_xy?r=w:q=w:f>t+.5?g.swap_xy?q=w:r=w:(q++,r--)}f=r=q;w=b(f);if(g.swap_xy){for(;q>p&&b(q-1)<w+2;)--q;for(;r<m&&b(r+1)>w-2;)++r}else{for(;q>p&&b(q-1)>w-2;)--q;for(;r<m&&b(r+1)<w+2;)++r}if(q<r){k=e;for(w=q;w<=r;w++){var z=Math.abs(c(w)-x);z<k&&(k=z,f=w)}k>e/10&&(f=Math.round(q+(r-q)/
e*x));w=b(f)}w=Math.round(w);var y=Math.round(b(f+1));this.options.Bar&&(q=y-w,w+=Math.round(h.fBarOffset/1E3*q),y=w+Math.round(h.fBarWidth/1E3*q));w>y&&(v=w,w=y,y=v);q=Math.round((w+y)/2);r=z=n=c(f);if(this.options.Bar)k=!0,l=0,z=Math.round(g.gry(!1!==this.options.BaseLine&&this.options.BaseLine>g.scale_ymin?this.options.BaseLine:g.scale_ymin)),z>n&&(v=z,z=n,n=v),!a.touch&&1===a.nproc&&(x<z||x>n)&&(f=null);else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve)k=!0,
d=3,this.markeratt&&(d=Math.max(d,this.markeratt.GetFullSize())),this.options.Error&&(v=h.getBinContent(f+1),n=h.getBinError(f+1),z=Math.round(g.gry(v+n)),n=Math.round(g.gry(v-n)),0==v&&this.IsTProfile()&&(f=null),y=(y-w)*this.options.errorX,w=Math.round(q-y),y=Math.round(q+y)),y-w<2*d&&(w=q-d,y=q+d),z=Math.min(z,r-d),n=Math.max(n,r+d),!a.touch&&1===a.nproc&&(x<z||x>n)&&(f=null);else if(k=1===a.nproc&&m-p<d)n=e,this.fillatt.empty()||(n=Math.round(g.gry(0)),0>n?n=0:n>e&&(n=e),n<z&&(v=z,z=n,n=v)),(a.y<
z||a.y>n)&&!a.touch&&(f=null);null!==f&&(f===p&&w>t+l?f=null:f===m-1&&y<t-l?f=null:t<w-l||t>y+l?f=null:this.options.Zero||0!==h.getBinContent(f+1)||(f=null));l=this.draw_g.select(".tooltip_bin");if(null===f||0>=n||z>=e)return l.remove(),null;p={name:h.fName,title:h.fTitle,x:q,y:r,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(f)};a.disabled?(l.remove(),p.changed=!0):k?(l.empty()&&(l=this.draw_g.append("svg:rect").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),p.changed=l.property("current_bin")!==f,p.changed&&l.attr("x",g.swap_xy?z:w).attr("width",g.swap_xy?n-z:y-w).attr("y",g.swap_xy?w:z).attr("height",g.swap_xy?y-w:n-z).style("opacity","0.3").property("current_bin",f),p.exact=5>=Math.abs(r-x)||x>=z&&x<=n,p.menu=!0,p.menu_dist=Math.sqrt((q-t)*(q-t)+(r-x)*(r-x))):(t=this.lineatt.width+3,l.empty()&&(l=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",
t).call(this.lineatt.func).call(this.fillatt.func)),p.exact=Math.abs(q-a.x)<=t&&Math.abs(r-a.y)<=t,p.menu=p.exact,p.menu_dist=Math.sqrt((q-a.x)*(q-a.x)+(r-a.y)*(r-a.y)),p.changed=l.property("current_bin")!==f,p.changed&&l.attr("cx",q).attr("cy",r).property("current_bin",f));p.changed&&(p.user_info={obj:h,name:h.fName,bin:f,cont:h.getBinContent(f+1),grx:q,gry:r});return p};G.prototype.FillHistContextMenu=function(a){a.add("Auto zoom-in",this.AutoZoom);var b=k.getDrawSettings("ROOT."+this.GetObject()._typename,
"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.Change(5,1001);this.InteractiveRedraw("pad","drawopt")})};G.prototype.AutoZoom=function(){var a=this.GetSelectIndex("x","left",-1),b=this.GetSelectIndex("x","right",1),c=b-a,d=this.GetHisto();if(0!=c&&d){for(var e=d.getBinContent(a+1),g=a;g<b;++g)e=Math.min(e,d.getBinContent(g+1));if(!(0<e)){for(;a<b&&
d.getBinContent(a+1)<=e;)++a;for(;a<b&&d.getBinContent(b)<=e;)--b;a===b-1&&2<a&&b<this.nbinsx-2&&(--a,++b);b-a<c&&a<b&&this.frame_painter().Zoom(d.fXaxis.GetBinLowEdge(a+1),d.fXaxis.GetBinLowEdge(b+1))}}};G.prototype.CanZoomIn=function(a,b,c){var d=this.GetHisto();return"x"==a&&d&&1<d.fXaxis.FindBin(c,.5)-d.fXaxis.FindBin(b,0)||"y"==a&&Math.abs(c-b)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};G.prototype.CallDrawFunc=function(a,b){var c=this.main_painter(),d=this.frame_painter();c!==this&&d&&d.mode3d!==
this.options.Mode3D&&this.CopyOptionsFrom(c);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,b)};G.prototype.Draw2D=function(a,b){this.Clear3DScene();this.mode3d=!1;this.ScanContent(!0);this.CreateXY();"function"===typeof this.DrawColorPalette&&this.DrawColorPalette(!1);this.DrawAxes();this.DrawBins();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();k.CallBack(a)};G.prototype.Draw3D=function(a,b){this.mode3d=!0;k.AssertPrerequisites("hist3d",function(){this.Draw3D(a,b)}.bind(this))};
G.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};F.prototype=Object.create(y.prototype);F.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;y.prototype.Cleanup.call(this)};F.prototype.ToggleProjection=function(a,b){if("Projections"==a||"Off"==a)a="";"string"==typeof a&&1<a.length&&(b=parseInt(a.substr(1)),a=a[0]);b||(b=1);if(a&&this.is_projection==a)if(this.projection_width===b)a="";else{this.projection_width=b;return}delete this.proj_hist;a=this.is_projection===
a?"":a;this.is_projection="";this.projection_width=b;(b=this.canv_painter())&&b.ToggleProjection(a,this.RedrawProjection.bind(this,"toggling",a))};F.prototype.RedrawProjection=function(a,b,c,d){"toggling"===a&&(this.is_projection=b,a=b=void 0);if(this.is_projection){if(void 0==d){if(!this.tt_handle)return;a=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);b=a+1;c=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);d=c+1}var e=this.canv_painter(),g=this.GetHisto();if(e&&!e._readonly&&void 0!==this.snapid)g=
"EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":",g="X"==this.is_projection?g+('ProjectionX("_projx",'+(c+1)+","+d+',"")'):g+('ProjectionY("_projy",'+(a+1)+","+b+',"")'),e.SendWebsocket(g);else{this.proj_hist||("X"==this.is_projection?(this.proj_hist=k.CreateHistogram("TH1D",this.nbinsx),k.extend(this.proj_hist.fXaxis,g.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=k.CreateHistogram("TH1D",this.nbinsy),k.extend(this.proj_hist.fXaxis,g.fYaxis),
this.proj_hist.fName="yproj",this.proj_hist.fTitle="Y projection"));if("X"==this.is_projection)for(var h=0;h<this.nbinsx;++h){for(var f=0,u=c;u<d;++u)f+=g.getBinContent(h+1,u+1);this.proj_hist.setBinContent(h+1,f)}else for(u=0;u<this.nbinsy;++u){f=0;for(h=a;h<b;++h)f+=g.getBinContent(h+1,u+1);this.proj_hist.setBinContent(u+1,f)}return e.DrawProjection(this.is_projection,this.proj_hist)}}};F.prototype.ExecuteMenuCommand=function(a,b){return y.prototype.ExecuteMenuCommand.call(this,a,b)?!0:"SetShowProjectionX"==
a.fName||"SetShowProjectionY"==a.fName?(this.ToggleProjection(a.fName[17],b&&parseInt(b)?parseInt(b):1),!0):!1};F.prototype.FillHistContextMenu=function(a){if(!this.IsTH2Poly()){a.add("sub:Projections",this.ToggleProjection);var b=this.is_projection||"";b&&(b+=this.projection_width);var c="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" ");this.is_projection&&c.push("Off");for(var d=0;d<c.length;++d)a.addchk(b==c[d],c[d],c[d],this.ToggleProjection);a.add("endsub:");a.add("Auto zoom-in",this.AutoZoom)}b=
k.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.InteractiveRedraw("pad","drawopt")});this.options.Color&&this.FillPaletteMenu(a)};F.prototype.ButtonClick=function(a){if(y.prototype.ButtonClick.call(this,a))return!0;if(this!==this.main_painter())return!1;switch(a){case "ToggleColor":this.ToggleColor();break;case "ToggleColorZ":this.ToggleColz();break;case "Toggle3D":this.ToggleMode3D();
break;default:return!1}return!0};F.prototype.FillToolbar=function(){y.prototype.FillToolbar.call(this,!0);var a=this.pad_painter();a&&(this.IsTH2Poly()||a.AddButton(k.ToolbarIcons.th2color,"Toggle color","ToggleColor"),a.AddButton(k.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ"),a.AddButton(k.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D"),a.ShowButtons())};F.prototype.ToggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;
this._can_move_colz=!0;this.CopyOptionsToOthers();this.RedrawPad()};F.prototype.AutoZoom=function(){if(!this.IsTH2Poly()){var a=this.GetSelectIndex("x","left",-1),b=this.GetSelectIndex("x","right",1),c=this.GetSelectIndex("y","left",-1),d=this.GetSelectIndex("y","right",1),e,g,h=this.GetObject();if(a!=b&&c!=d){var f=h.getBinContent(a+1,c+1);for(e=a;e<b;++e)for(g=c;g<d;++g)f=Math.min(f,h.getBinContent(e+1,g+1));if(!(0<f)){var k=b,n=a,l=d,p=c;for(e=a;e<b;++e)for(g=c;g<d;++g)h.getBinContent(e+1,g+1)>
f&&(e<k&&(k=e),e>=n&&(n=e+1),g<l&&(l=g),g>=p&&(p=g+1));e=!1;k===n-1&&k>a+1&&n<b-1&&(k--,n++);l===p-1&&l>c+1&&p<d-1&&(l--,p++);if((k>a||n<b)&&k<n-1){var m=h.fXaxis.GetBinLowEdge(k+1);var q=h.fXaxis.GetBinLowEdge(n+1);e=!0}if((l>c||p<d)&&l<p-1){var r=h.fYaxis.GetBinLowEdge(l+1);var t=h.fYaxis.GetBinLowEdge(p+1);e=!0}e&&this.frame_painter().Zoom(m,q,r,t)}}}};F.prototype.ScanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var b;a=this.GetObject();this.nbinsx=a.fXaxis.fNbins;this.nbinsy=a.fYaxis.fNbins;
this.CreateAxisFuncs(!0);if(this.IsTH2Poly()){this.gminposbin=null;var c=this.gminbin=this.gmaxbin=0;for(b=a.fBins.arr.length;c<b;++c){var d=a.fBins.arr[c].fContent;0===c&&(this.gminbin=this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,c=0;c<this.nbinsx;++c)for(b=0;b<this.nbinsy;++b)d=a.getBinContent(c+1,b+1),d<this.gminbin?
this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.IsTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};F.prototype.CountStat=function(a){var b=this.GetHisto(),c=b.fXaxis,d=b.fYaxis,e=0,g=0,h=0,f=0,k=0,n,l,p=this.frame_painter(),m={name:b.fName,entries:0,
integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){c=b.fBins.arr.length;var q,r,t,x=this.frame_painter();for(d=0;d<c;++d){var v=b.fBins.arr[d];var w=n=1;v.fXmin>x.scale_xmax?n=2:v.fXmax<x.scale_xmin&&(n=0);v.fYmin>x.scale_ymax?w=2:v.fYmax<x.scale_ymin&&(w=0);var z=l=t=0;var y=v.fPoly;var A=1;"TMultiGraph"===y._typename&&(A=v.fPoly.fGraphs.arr.length,y=null);for(r=0;r<A;++r){if(!y||0<r)y=v.fPoly.fGraphs.arr[r];for(q=0;q<y.fNpoints;++q)++t,
z+=y.fX[q],l+=y.fY[q]}1<t&&(z/=t,l/=t);v=v.fContent;m.entries+=v;m.matrix[3*w+n]+=v;if(1==n&&1==w&&(!a||a(z,l))){if(null===m.wmax||v>m.wmax)m.wmax=v,m.xmax=z,m.ymax=l;e+=v;g+=z*v;h+=l*v;f+=z*z*v;k+=l*l*v}}}else for(x=this.GetSelectIndex("x","left"),q=this.GetSelectIndex("x","right"),y=this.GetSelectIndex("y","left"),r=this.GetSelectIndex("y","right"),A=0;A<=this.nbinsx+1;++A)for(n=A<=x?0:A>q?2:1,z=c.GetBinCoord(A-.5),t=0;t<=this.nbinsy+1;++t)if(w=t<=y?0:t>r?2:1,l=d.GetBinCoord(t-.5),v=b.getBinContent(A,
t),m.entries+=v,m.matrix[3*w+n]+=v,1==n&&1==w&&(null==a||a(z,l))){if(null===m.wmax||v>m.wmax)m.wmax=v,m.xmax=z,m.ymax=l;e+=v;g+=z*v;h+=l*v;f+=z*z*v;k+=l*l*v}!p.IsAxisZoomed("x")&&!p.IsAxisZoomed("y")&&0<b.fTsumw&&(e=b.fTsumw,g=b.fTsumwx,f=b.fTsumwx2,h=b.fTsumwy,k=b.fTsumwy2);0<e&&(m.meanx=g/e,m.meany=h/e,m.rmsx=Math.sqrt(Math.abs(f/e-m.meanx*m.meanx)),m.rmsy=Math.sqrt(Math.abs(k/e-m.meany*m.meany)));null===m.wmax&&(m.wmax=0);m.integral=e;1<b.fEntries&&(m.entries=b.fEntries);return m};F.prototype.FillStatistic=
function(a,b,c){if(this.IgnoreStatsFill())return!1;var d=this.CountStat(),e=Math.floor(b%10),g=Math.floor(b/10)%10,h=Math.floor(b/100)%10,f=Math.floor(b/1E3)%10,k=Math.floor(b/1E4)%10,n=Math.floor(b/1E5)%10,l=Math.floor(b/1E6)%10,p=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.ClearPave();0<e&&a.AddText(d.name);0<g&&a.AddText("Entries = "+a.Format(d.entries,"entries"));0<h&&(a.AddText("Mean x = "+a.Format(d.meanx)),a.AddText("Mean y = "+a.Format(d.meany)));0<f&&(a.AddText("Std Dev x = "+a.Format(d.rmsx)),
a.AddText("Std Dev y = "+a.Format(d.rmsy)));0<l&&a.AddText("Integral = "+a.Format(d.matrix[4],"entries"));0<p&&(a.AddText("Skewness x = <undef>"),a.AddText("Skewness y = <undef>"));0<b&&a.AddText("Kurt = <undef>");if(0<k||0<n)d=d.matrix,a.AddText(""+d[6].toFixed(0)+" | "+d[7].toFixed(0)+" | "+d[7].toFixed(0)),a.AddText(""+d[3].toFixed(0)+" | "+d[4].toFixed(0)+" | "+d[5].toFixed(0)),a.AddText(""+d[0].toFixed(0)+" | "+d[1].toFixed(0)+" | "+d[2].toFixed(0));c&&a.FillFunctionStat(this.FindFunction("TF1"),
c);return!0};F.prototype.DrawBinsColor=function(a,b){a=this.GetHisto();b=this.PrepareColorDraw();var c=[],d=[],e=[],g,h;for(g=b.i1;g<b.i2;++g){var f=b.grx[g+1]-b.grx[g];var k=Math.round(b.grx[g]+f*b.xbar1);f=Math.round(f*(b.xbar2-b.xbar1))||1;for(h=b.j1;h<b.j2;++h){var n=a.getBinContent(g+1,h+1);var l=this.getContourColor(n,!0);if(0===n){if(!this.options.Zero)continue;null===l&&this._show_empty_bins&&(l=0)}if(null!==l){var p=b.gry[h]-b.gry[h+1];var m=Math.round(b.gry[h+1]+p*b.ybar1);p=Math.round(p*
(b.ybar2-b.ybar1))||1;n="M"+k+","+m;if(void 0===c[l])c[l]=n;else{var q="m"+(k-d[l])+","+(m-e[l]);c[l]+=q.length<n.length?q:n}d[l]=k;e[l]=m;c[l]+="v"+p+"h"+f+"v"+-p+"z"}}}for(l=0;l<c.length;++l)void 0!==c[l]&&this.draw_g.append("svg:path").attr("palette-index",l).attr("fill",this.fPalette.getColor(l)).attr("d",c[l]);return b};F.prototype.BuildContour=function(a,b,c,d){function e(a){for(var c=0;c<b.length;++c)if(a<b[c])return c-1;return b.length-1}function g(a,c,d,e,g,h,k,m){var p=d===k;k=p?m-e:k-d;
c+=1;g-=a;m=l-1;for(var t=999+l,q=0,r;c<=h&&m<=t;)r=b[c],r-=a,r/=g,r*=k,p?(f[m]=d,u[m]=e+r):(f[m]=d+r,u[m]=e),n[m]=c,q++,m+=2,c++;return q}var h=this.GetObject(),f=new Float32Array(4008),u=new Float32Array(4008),n=new Int32Array(4008),l=0,p=[],m=0,q=[0,0,0,0],r=[0,0,0,0],t=[0,0,0,0],x=[0,0,0,0],v,w,z,y,A=a.original?a.origx:a.grx,E=a.original?a.origy:a.gry;for(w=a.j1;w<a.j2-1;++w)for(r[1]=r[0]=(E[w]+E[w+1])/2,r[3]=r[2]=(E[w+1]+E[w+2])/2,v=a.i1;v<a.i2-1;++v){t[0]=h.getBinContent(v+1,w+1);t[1]=h.getBinContent(v+
2,w+1);t[2]=h.getBinContent(v+2,w+2);t[3]=h.getBinContent(v+1,w+2);for(z=0;4>z;z++)x[z]=e(t[z]);if(x[0]!==x[1]||x[1]!==x[2]||x[2]!==x[3]||x[3]!==x[0]){q[3]=q[0]=(A[v]+A[v+1])/2;q[2]=q[1]=(A[v+1]+A[v+2])/2;var B=t[0]<=t[1]?0:1;var D=t[2]<=t[3]?2:3;t[B]>t[D]&&(B=D);B++;for(z=l=1;4>=z;z++)D=B%4+1,B=g(t[B-1],x[B-1],q[B-1],r[B-1],t[D-1],x[D-1],q[D-1],r[D-1]),l+=2*B,B=D;B=t[0]<=t[1]?0:1;D=t[2]<=t[3]?2:3;t[B]>t[D]&&(B=D);B++;l=2;for(z=1;4>=z;z++)D=1==B?4:B-1,B=g(t[B-1],x[B-1],q[B-1],r[B-1],t[D-1],x[D-1],
q[D-1],r[D-1]),l+=2*B,B=D;D=0;for(z=1;z<=l-5;z+=2)for(;n[z-1]!=n[z];){B=f[z];var C=u[z];var F=n[z];for(y=z;y<=l-5;y+=2)f[y]=f[y+2],u[y]=u[y+2],n[y]=n[y+2];f[l-3]=B;u[l-3]=C;n[l-3]=F;if(2E3<D)break;D++}if(!(2E3<D))for(z=1;z<=l-2;z+=2)D=n[z-1],0<=D&&D<b.length&&((C=p[D])||(C=p[D]=k.CreateTPolyLine(8016,!0)),B=C.fLastPoint,B<C.fN-2&&(C.fX[B+1]=Math.round(f[z-1]),C.fY[B+1]=Math.round(u[z-1]),C.fX[B+2]=Math.round(f[z]),C.fY[B+2]=Math.round(u[z]),C.fLastPoint=B+2,m=Math.max(m,C.fLastPoint+1)))}}a=new Int32Array(b.length);
for(D=v=0;D<b.length;D++)if(0<=b[D]){v=D;break}z=0;for(D=v-1;0<=D;D--)a[z]=D,z++;for(D=v;D<b.length;D++)a[z]=D,z++;h=new Float32Array(2*m);q=new Float32Array(2*m);for(z=0;z<b.length;++z)if(D=a[z],C=p[D])for(r=c.calcColorIndex(D,b.length),t=C.fX,x=C.fY,B=C.fLastPoint+1,E=0;;){w=m;A=w+1;h[w]=t[E];q[w]=x[E];h[A]=t[E+1];q[A]=x[E+1];t[E]=t[E+1]=0;for(x[E]=x[E+1]=0;;){E=0;for(v=2;v<B;v+=2)A<2*m-1&&t[v]===h[A]&&x[v]===q[A]&&(A++,h[A]=t[v+1],q[A]=x[v+1],t[v]=t[v+1]=0,x[v]=x[v+1]=0,E++),0<w&&t[v+1]===h[w]&&
x[v+1]===q[w]&&(w--,h[w]=t[v],q[w]=x[v],t[v]=t[v+1]=0,x[v]=x[v+1]=0,E++);if(0==E)break}w+1<A&&0<=w&&d(r,h,q,w,A,D);E=0;for(v=2;v<B;v+=2)if(0!==t[v]&&0!==x[v]){E=v;break}if(0===E)break}};F.prototype.DrawBinsContour=function(a,b){function c(a,b,c,d){var e="",g=null,h;for(h=c;h<=d;++h){c=null;switch(f.projection){case 1:c=f.ProjectAitoff2xy(a[h],b[h]);break;case 2:c=f.ProjectMercator2xy(a[h],b[h]);break;case 3:c=f.ProjectSinusoidal2xy(a[h],b[h]);break;case 4:c=f.ProjectParabolic2xy(a[h],b[h])}c?(c.x=
f.grx(c.x),c.y=f.gry(c.y)):c={x:a[h],y:b[h]};c.x=Math.round(c.x);c.y=Math.round(c.y);e?c.x!=g.x&&c.y!=g.y?e+="l"+(c.x-g.x)+","+(c.y-g.y):c.x!=g.x?e+="h"+(c.x-g.x):c.y!=g.y&&(e+="v"+(c.y-g.y)):e="M"+c.x+","+c.y;g=c}return e}var d=this.PrepareColorDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),e=this.GetContour(),g=this.GetPalette(),h=this,f=this.frame_painter();if(14===this.options.Contour){a="M0,0h"+a+"v"+b+"h-"+a;if(this.options.Proj){a=d.j2-d.j1;b=new Float32Array(2*a);for(var u=new Float32Array(2*
a),n=0;n<a;++n)b[n]=d.origx[d.i1],u[n]=(d.origy[d.j1]*(n+.5)+d.origy[d.j2]*(a-.5-n))/a,b[n+a]=d.origx[d.i2],u[n+a]=(d.origy[d.j2]*(n+.5)+d.origy[d.j1]*(a-.5-n))/a;a=c(b,u,0,2*a-1)}this.draw_g.append("svg:path").attr("d",a+"z").style("stroke","none").style("fill",g.calcColor(0,e.length))}this.BuildContour(d,e,g,function(a,b,d,e,f){var l=g.getColor(a),m=l,n=null;switch(h.options.Contour){case 11:m="none";n=new k.TAttLineHandler({color:l});break;case 12:m="none";n=new k.TAttLineHandler({color:1,style:a%
5+1,width:1});break;case 13:m="none",n=h.lineatt}a=h.draw_g.append("svg:path").attr("class","th2_contour").attr("d",c(b,d,e,f)+("none"==m?"":"z")).style("fill",m);null!==n?a.call(n.func):a.style("stroke","none")});d.hide_only_zeros=!0;return d};F.prototype.CreatePolyBin=function(a,b,c){function d(a,c,d,e){var f=Math.sqrt((a-d)*(a-d)+(c-e)*(c-e));b._sumx+=(a+d)*f/2;b._sumy+=(c+e)*f/2;b._suml+=f}var e="",g,h=1,f=null;"TMultiGraph"==b.fPoly._typename?h=b.fPoly.fGraphs.arr.length:f=b.fPoly;c&&(b._sumx=
b._sumy=b._suml=0);for(g=0;g<h;++g){if(!f||0<g)f=b.fPoly.fGraphs.arr[g];var k=f.fNpoints,n,l=f.fX,p=f.fY,m=Math.round(a.grx(l[0])),q=Math.round(a.gry(p[0]));2<k&&l[0]==l[k-1]&&p[0]==p[k-1]&&k--;e+="M"+m+","+q;for(n=1;n<k;++n){var r=Math.round(a.grx(l[n]));var t=Math.round(a.gry(p[n]));c&&d(m,q,r,t);if(m!==r||q!==t)e=m===r?e+("v"+(t-q)):q===t?e+("h"+(r-m)):e+("l"+(r-m)+","+(t-q));m=r;q=t}c&&d(m,q,Math.round(a.grx(l[0])),Math.round(a.gry(p[0])));e+="z"}c&&(0<b._suml?(b._midx=Math.round(b._sumx/b._suml),
b._midy=Math.round(b._sumy/b._suml)):(b._midx=Math.round(a.grx((b.fXmin+b.fXmax)/2)),b._midy=Math.round(a.gry((b.fYmin+b.fYmax)/2))));return e};F.prototype.DrawPolyBinsColor=function(a,b){var c=this.GetObject(),d=this.frame_painter(),e=[];a=[];var g,h=c.fBins.arr.length;this.fContour=null;this.fCustomContour=!1;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(g=0;g<h;++g){var f=c.fBins.arr[g];var u=this.getContourColor(f.fContent,!0);if(null!==u){if(0===f.fContent){if(!this.options.Zero||
!this.options.Line)continue;u=0}if(!(f.fXmin>d.scale_xmax||f.fXmax<d.scale_xmin||f.fYmin>d.scale_ymax||f.fYmax<d.scale_ymin)){var n=this.CreatePolyBin(d,f,this.options.Text&&f.fContent);e[u]=void 0===e[u]?n:e[u]+n;this.options.Text&&f.fContent&&a.push(f)}}}for(u=0;u<e.length;++u)e[u]&&(f=this.draw_g.append("svg:path").attr("palette-index",u).attr("fill",u?this.fPalette.getColor(u):"none").attr("d",e[u]),this.options.Line&&f.call(this.lineatt.func));if(0<a.length){e=this.get_color(c.fMarkerColor);
u=-1*this.options.TextAngle;d=this.draw_g.append("svg:g").attr("class","th2poly_text");f=12;1!==c.fMarkerSize&&u&&(f=Math.round(.02*b*c.fMarkerSize));this.StartTextDrawing(42,f,d,f);for(g=0;g<a.length;++g)f=a[g],b="",this.options.TextKind?(f.fPoly&&(b=f.fPoly.fName),"Graph"===b&&(b=""),b||(b=f.fNumber)):b=Math.round(f.fContent)===f.fContent?f.fContent.toString():k.FFormat(f.fContent,k.gStyle.fPaintTextFormat),this.DrawText({align:22,x:f._midx,y:f._midy,rotate:u,text:b,color:e,latex:0,draw_g:d});this.FinishTextDrawing(d,
null)}return{poly:!0}};F.prototype.DrawBinsText=function(a,b,c){a=this.GetObject();var d=this.get_color(a.fMarkerColor),e=-1*this.options.TextAngle,g=this.draw_g.append("svg:g").attr("class","th2_text");var h=20;var f=0,u=this.MatchObjectType("TProfile2D")&&"function"==typeof a.getBinEntries,n="E"==this.options.TextKind,l=n&&!this.options.TextLine?1:0;null===c&&(c=this.PrepareColorDraw({rounding:!1}));1!==a.fMarkerSize&&e&&(h=Math.round(.02*b*a.fMarkerSize));0!==a.fBarOffset&&(f=.001*a.fBarOffset);
this.StartTextDrawing(42,h,g,h);for(b=c.i1;b<c.i2;++b)for(h=c.j1;h<c.j2;++h){var p=a.getBinContent(b+1,h+1);if(0!==p||this._show_empty_bins){var m=c.grx[b+1]-c.grx[b];var q=c.gry[h]-c.gry[h+1];u&&(p=a.getBinEntries(b+1,h+1));p=p===Math.round(p)?p.toString():k.FFormat(p,k.gStyle.fPaintTextFormat);if(n){var r=a.getBinError(a.getBin(b+1,h+1));r=r===Math.round(r)?r.toString():k.FFormat(r,k.gStyle.fPaintTextFormat);p=this.options.TextLine?p+("\u00b1"+r):"#splitline{"+p+"}{#pm"+r+"}"}if(e){r=Math.round(c.grx[b]+
.5*m);var t=Math.round(c.gry[h+1]+q*(.5+f));q=m=0}else r=Math.round(c.grx[b]+.1*m),t=Math.round(c.gry[h+1]+q*(.1+f)),m=Math.round(.8*m),q=Math.round(.8*q);this.DrawText({align:22,x:r,y:t,width:m,height:q,rotate:e,text:p,color:d,latex:l,draw_g:g})}}this.FinishTextDrawing(g,null);c.hide_only_zeros=!0;return c};F.prototype.DrawBinsArrow=function(a,b){a=this.GetObject();b="";var c,d,e,g=1E-30,h=this.PrepareColorDraw({rounding:!1}),f=(h.grx[h.i2]-h.grx[h.i1])/(h.i2-h.i1+1-.03)/2,k=(h.gry[h.j2]-h.gry[h.j1])/
(h.j2-h.j1+1-.03)/2;for(e=0;2>e;++e)for(c=h.i1;c<h.i2;++c)for(d=h.j1;d<h.j2;++d){var n=c===h.i1?a.getBinContent(c+2,d+1)-a.getBinContent(c+1,d+1):c===h.i2-1?a.getBinContent(c+1,d+1)-a.getBinContent(c,d+1):.5*(a.getBinContent(c+2,d+1)-a.getBinContent(c,d+1));var l=d===h.j1?a.getBinContent(c+1,d+2)-a.getBinContent(c+1,d+1):d===h.j2-1?a.getBinContent(c+1,d+1)-a.getBinContent(c+1,d):.5*(a.getBinContent(c+1,d+2)-a.getBinContent(c+1,d));if(0===e)g=Math.max(g,Math.abs(n),Math.abs(l));else{var p=(h.grx[c]+
h.grx[c+1])/2;var m=(h.gry[d]+h.gry[d+1])/2;var q=f*n/g;n=k*l/g;var r=p-q;l=p+q;p=m-n;m+=n;n=Math.round(l-r);l=Math.round(m-p);if(0!==n||0!==l)if(b+="M"+Math.round(r)+","+Math.round(p)+"l"+n+","+l,5<Math.abs(n)||5<Math.abs(l))m=Math.sqrt(2/(n*n+l*l)),r=Math.round(m*(n+l)),n=Math.round(m*(n-l)),0!==r&&0!==n&&(b+="l"+-r+","+n+"m"+r+","+-n+"l"+-n+","+-r)}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",b).style("fill","none").call(this.lineatt.func);return h};F.prototype.DrawBinsBox=
function(a,b){var c=this.GetObject();a=this.PrepareColorDraw({rounding:!1});var d=this.main_painter();d===this&&(d.maxbin===d.minbin&&(d.maxbin=d.gmaxbin,d.minbin=d.gminbin,d.minposbin=d.gminposbin),d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1)));var e=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),g=Math.max(0,d.minbin),h="",f=b="",k="",n=!1,l=0;if(this.root_pad().fLogz&&0<e){n=!0;e=Math.log(e);l=0<g?Math.log(g):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):
e-10;l>=e&&(l=e-10);var p=1/(e-l)}else p=1/(e-g);for(d=a.i1;d<a.i2;++d)for(e=a.j1;e<a.j2;++e){var m=c.getBinContent(d+1,e+1);var q=Math.abs(m);if(!(0===q||q<g)){var r=n?0<q?Math.log(q)-l:0:q-g;r=.5*(0>r?1:1-Math.sqrt(r*p));0>r&&(r=0);q=a.grx[d+1]-a.grx[d];var t=a.gry[e]-a.gry[e+1];var x=r*q;var v=r*t;r=Math.round(a.grx[d]+x);var w=Math.round(a.gry[e+1]+v);q=Math.max(Math.round(q-2*x),1);t=Math.max(Math.round(t-2*v),1);h+="M"+r+","+w+"v"+t+"h"+q+"v-"+t+"z";0>m&&10===this.options.BoxStyle&&(b+="M"+
r+","+w+"l"+q+","+t+"M"+(r+q)+","+w+"l-"+q+","+t);if(11===this.options.BoxStyle&&5<q&&5<t){v=Math.round(.1*q);var y=Math.round(.1*t);x="M"+r+","+w+"h"+q+"l"+-v+","+y+"h"+(2*v-q)+"v"+(t-2*y)+"l"+-v+","+y+"z";q="M"+(r+q)+","+(w+t)+"v"+-t+"l"+-v+","+y+"v"+(t-2*y)+"h"+(2*v-q)+"l"+-v+","+y+"z";0>m?(k+=x,f+=q):(f+=x,k+=q)}}}0<h.length&&(c=this.draw_g.append("svg:path").attr("d",h).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?c.call(this.lineatt.func):c.style("stroke","none"));
0<f.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",f).style("stroke","none").call(this.fillatt.func).style("fill",A.rgb(this.fillatt.color).brighter(.5).toString());0<k.length&&this.draw_g.append("svg:path").attr("d",k).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":A.rgb(this.fillatt.color).darker(.5).toString());0<b.length&&(c=this.draw_g.append("svg:path").attr("d",b).style("fill","none"),"none"!==this.lineatt.color?c.call(this.lineatt.func):
c.style("stroke","black"));return a};F.prototype.DrawCandle=function(a,b){b=this.GetHisto();var c=this.PrepareColorDraw(),d=this.frame_painter(),e,g,h,f,k="",n="";1===b.fMarkerColor&&(b.fMarkerColor=b.fLineColor);this.createAttMarker({attr:b,style:5});this.markeratt.reset_pos();c.candle=[];for(e=c.i1;e<c.i2;++e){for(a=h=f=g=0;a<this.nbinsy;++a)f+=b.getBinContent(e+1,a+1);var l={bin:e,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var p=b.getBinContent(e+1,a+
1);var m=b.fYaxis.GetBinCenter(a+1);.001>h/f&&.001<=(h+p)/f&&(l.whiskerm=m);.25>h/f&&.25<=(h+p)/f&&(l.m25y=m);.5>h/f&&.5<=(h+p)/f&&(l.median=m);.75>h/f&&.75<=(h+p)/f&&(l.p25y=m);.999>h/f&&.999<=(h+p)/f&&(l.whiskerp=m);h+=p;g+=p*m}0<h&&(l.meany=g/h);l.iqr=l.p25y-l.m25y;l.m25y-1.5*l.iqr>l.whsikerm&&(l.whiskerm=l.m25y-1.5*l.iqr);l.p25y+1.5*l.iqr<l.whiskerp&&(l.whiskerp=l.p25y+1.5*l.iqr);if(!(d.logy&&0>=l.whiskerm)){a=c.grx[e+1]-c.grx[e];a*=.66;g=(c.grx[e+1]+c.grx[e])/2+b.fBarOffset/1E3*a;0<b.fBarWidth&&
(a=a*b.fBarWidth/1E3);l.x1=Math.round(g-a/2);l.x2=Math.round(g+a/2);g=Math.round(g);l.y0=Math.round(d.gry(l.median));k+="M"+l.x1+","+l.y0+"h"+(l.x2-l.x1);l.y1=Math.round(d.gry(l.p25y));l.y2=Math.round(d.gry(l.m25y));k+="M"+l.x1+","+l.y1+"v"+(l.y2-l.y1)+"h"+(l.x2-l.x1)+"v-"+(l.y2-l.y1)+"z";l.yy1=Math.round(d.gry(l.whiskerp));l.yy2=Math.round(d.gry(l.whiskerm));k+="M"+g+","+l.y1+"v"+(l.yy1-l.y1);k+="M"+l.x1+","+l.yy1+"h"+(l.x2-l.x1);k+="M"+g+","+l.y2+"v"+(l.yy2-l.y2);k+="M"+l.x1+","+l.yy2+"h"+(l.x2-
l.x1);for(a=0;a<this.nbinsy;++a)p=b.getBinContent(e+1,a+1),m=b.fYaxis.GetBinCenter(a+1),0<p&&m<l.whiskerm&&(n+=this.markeratt.create(g,m)),0<p&&m>l.whiskerp&&(n+=this.markeratt.create(g,m));c.candle.push(l)}}0<k.length&&this.draw_g.append("svg:path").attr("d",k).call(this.lineatt.func).call(this.fillatt.func);0<n.length&&this.draw_g.append("svg:path").attr("d",n).call(this.markeratt.func);return c};F.prototype.DrawBinsScatter=function(a,b){var c=this.GetObject();a=this.PrepareColorDraw({rounding:!0,
pixel_density:!0});b=[];var d=[],e=[],g=[],h=[],f,u,n=1;var l=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);k.seed(a.sumz);if(1E5>l*a.sumz){this.createAttMarker({attr:c});this.markeratt.reset_pos();d="";for(f=a.i1;f<a.i2;++f){var p=a.grx[f+1]-a.grx[f];for(u=a.j1;u<a.j2;++u){var m=a.gry[u]-a.gry[u+1];var q=c.getBinContent(f+1,u+1);e=Math.round(l*q);if(!(0>=e))for(b=0;b<e;++b)d+=this.markeratt.create(Math.round(a.grx[f]+p*k.random()),Math.round(a.gry[u+1]+m*k.random()))}}this.draw_g.append("svg:path").attr("d",
d).call(this.markeratt.func);return a}.7<this.maxbin&&(n=.7/this.maxbin);l=Math.round(a.max-a.min);this.CreateContour(50<l?50:l,this.minposbin,this.maxbin,this.minposbin);for(f=a.i1;f<a.i2;++f)for(u=a.j1;u<a.j2;++u)if(q=c.getBinContent(f+1,u+1),!(0>=q||q<this.minbin||(p=a.grx[f+1]-a.grx[f],m=a.gry[u]-a.gry[u+1],0>=p*m||(l=this.getContourIndex(q/p/m),0>l)))){q="M"+a.grx[f]+","+a.gry[u+1];if(void 0===b[l])b[l]=q,g[l]=p,h[l]=m;else{var r="m"+(a.grx[f]-d[l])+","+(a.gry[u+1]-e[l]);b[l]+=r.length<q.length?
r:q;g[l]=Math.max(g[l],p);h[l]=Math.max(h[l],m)}d[l]=a.grx[f];e[l]=a.gry[u+1];b[l]+="v"+m+"h"+p+"v-"+m+"z"}l=this.svg_frame().select(".main_layer");f=l.select("defs");f.empty()&&0<b.length&&(f=l.insert("svg:defs",":first-child"));this.createAttMarker({attr:c});for(l=0;l<b.length;++l)if(void 0!==b[l]&&l<this.fContour.length){d="scatter_"+l;c=f.select("."+d);c.empty()?c=f.append("svg:pattern").attr("class",d).attr("id","jsroot_scatter_pattern_"+k.id_counter++).attr("patternUnits","userSpaceOnUse"):
c.selectAll("*").remove();e=Math.round(n*this.fContour[l]*g[l]*h[l]);1>e&&(e=1);u=new Float32Array(e);p=new Float32Array(e);if(1===e)u[0]=p[0]=.5;else for(m=0;m<e;++m)u[m]=k.random(),p[m]=k.random();this.markeratt.reset_pos();d="";for(m=0;m<e;++m)d+=this.markeratt.create(u[m]*g[l],p[m]*h[l]);c.attr("width",g[l]).attr("height",h[l]).append("svg:path").attr("d",d).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",l).attr("fill","url(#"+c.attr("id")+")").attr("d",b[l])}return a};
F.prototype.DrawBins=function(){if(!this.draw_content)return this.RemoveDrawG();this.CheckHistDrawAttributes();this.CreateG(!0);var a=this.frame_width(),b=this.frame_height(),c=null;this.IsTH2Poly()?c=this.DrawPolyBinsColor(a,b):(this.options.Scat?c=this.DrawBinsScatter(a,b):this.options.Color?c=this.DrawBinsColor(a,b):this.options.Box?c=this.DrawBinsBox(a,b):this.options.Arrow?c=this.DrawBinsArrow(a,b):this.options.Contour?c=this.DrawBinsContour(a,b):this.options.Candle&&(c=this.DrawCandle(a,b)),
this.options.Text&&(c=this.DrawBinsText(a,b,c)),c||(c=this.DrawBinsScatter(a,b)));this.tt_handle=c};F.prototype.GetBinTips=function(a,b){var c=[],d=this.frame_painter(),e=this.GetHisto(),g=e.getBinContent(a+1,b+1);c.push(this.GetTipName());"labels"==d.x_kind?c.push("x = "+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+1))):c.push("x = ["+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+1))+", "+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+2))+")");"labels"==d.y_kind?c.push("y = "+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+
1))):c.push("y = ["+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+1))+", "+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+2))+")");c.push("bin = "+a+", "+b);e.$baseh&&(g-=e.$baseh.getBinContent(a+1,b+1));c.push("entries = "+(g===Math.round(g)?g:k.FFormat(g,k.gStyle.fStatFormat)));if("E"==this.options.TextKind||this.MatchObjectType("TProfile2D"))a=e.getBinError(e.getBin(a+1,b+1)),c.push("error = "+(a===Math.round(a)?a.toString():k.FFormat(a,k.gStyle.fPaintTextFormat)));return c};F.prototype.GetCandleTips=function(a){var b=
[],c=this.frame_painter(),d=this.GetHisto();b.push(this.GetTipName());b.push("x = "+c.AxisAsText("x",d.fXaxis.GetBinLowEdge(a.bin+1)));b.push("mean y = "+k.FFormat(a.meany,k.gStyle.fStatFormat));b.push("m25 = "+k.FFormat(a.m25y,k.gStyle.fStatFormat));b.push("p25 = "+k.FFormat(a.p25y,k.gStyle.fStatFormat));return b};F.prototype.ProvidePolyBinHints=function(a,b,c){a=this.GetHisto().fBins.arr[a];var d=this.frame_painter(),e=a.fPoly.fName,g=[],h=0;"Graph"===e&&(e="");0===e.length&&(e=a.fNumber);if(void 0===
b&&void 0===c){b=c=0;var f=a.fPoly,u=1;"TMultiGraph"===f._typename&&(u=a.fPoly.fGraphs.arr.length,f=null);for(var n=0;n<u;++n){if(!f||0<n)f=a.fPoly.fGraphs.arr[n];for(var l=0;l<f.fNpoints;++l)++h,b+=f.fX[l],c+=f.fY[l]}1<h&&(b/=h,c/=h)}g.push(this.GetTipName());g.push("x = "+d.AxisAsText("x",b));g.push("y = "+d.AxisAsText("y",c));0<h&&g.push("npnts = "+h);g.push("bin = "+e);a.fContent===Math.round(a.fContent)?g.push("content = "+a.fContent):g.push("content = "+k.FFormat(a.fContent,k.gStyle.fStatFormat));
return g};F.prototype.ProcessTooltip=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var b=this.GetHisto(),c=this.tt_handle,d=this.draw_g.select(".tooltip_bin");if(c.poly){var e=this.frame_painter(),g,h;c=-1;e.grx===e.x&&(g=e.x.invert(a.x));e.gry===e.y&&(h=e.y.invert(a.y));if(void 0!==g&&void 0!==h){var f,k=b.fBins.arr.length;for(f=0;f<k&&0>c;++f){var n=b.fBins.arr[f];if(!(g<n.fXmin||
g>n.fXmax||h<n.fYmin||h>n.fYmax||0===n.fContent&&!this.options.Zero)){var l=n.fPoly,p=1;"TMultiGraph"===l._typename&&(p=n.fPoly.fGraphs.arr.length,l=null);for(var m=0;m<p;++m){if(!l||0<m)l=n.fPoly.fGraphs.arr[m];if(l.IsInside(g,h)){c=f;break}}}}}if(0>c)return d.remove(),null;g={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:!0,menu:!0,lines:this.ProvidePolyBinHints(c,g,h)};a.disabled?(d.remove(),
g.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),g.changed=d.property("current_bin")!==c,g.changed&&d.attr("d",this.CreatePolyBin(e,n)).style("opacity","0.7").property("current_bin",c));g.changed&&(g.user_info={obj:b,name:b.fName,bin:c,cont:n.fContent,grx:a.x,gry:a.y});return g}if(c.candle){for(f=0;f<c.candle.length&&!(e=c.candle[f],e.x1<=a.x&&a.x<=e.x2&&e.yy1<=a.y&&a.y<=e.yy2);++f);if(f>=c.candle.length)return d.remove(),
null;g={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(e),exact:!0,menu:!0};a.disabled?(d.remove(),g.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),g.changed=d.property("current_bin")!==f,g.changed&&d.attr("x",e.x1).attr("width",e.x2-e.x1).attr("y",e.yy1).attr("height",e.yy2-e.yy1).style("opacity",
"0.7").property("current_bin",f));g.changed&&(g.user_info={obj:b,name:b.fName,bin:f+1,cont:e.median,binx:f+1,biny:1,grx:a.x,gry:a.y});return g}h=0;var q=null;e=this.frame_painter();if(e.reverse_x)for(f=c.i1;f<c.i2&&!(a.x<=c.grx[f]&&a.x>=c.grx[f+1]);++f);else for(f=c.i1;f<c.i2&&!(a.x>=c.grx[f]&&a.x<=c.grx[f+1]);++f);if(e.reverse_y)for(n=c.j1;n<c.j2&&!(a.y<=c.gry[n+1]&&a.y>=c.gry[n]);++n);else for(n=c.j1;n<c.j2&&!(a.y>=c.gry[n+1]&&a.y<=c.gry[n]);++n);if(f<c.i2&&n<c.j2){k=f;l=f+1;p=n;m=n+1;var r=c.grx[k];
var t=c.grx[l];var x=c.gry[m];var v=c.gry[p];g=!0;if(this.options.Color){h=t-r;q=v-x;t=Math.round(r+h*c.xbar2);r=Math.round(r+h*c.xbar1);v=Math.round(x+q*c.ybar2);x=Math.round(x+q*c.ybar1);if(e.reverse_x){if(a.x>r||a.x<=t)g=!1}else if(a.x<r||a.x>=t)g=!1;if(e.reverse_y){if(a.y>x||a.y<=v)g=!1}else if(a.y<x||a.y>=v)g=!1}h=b.getBinContent(f+1,n+1);this.is_projection?q=0:g?c.hide_only_zeros?q=0!==h||this._show_empty_bins?0:null:(q=this.getContourColor(h,!0),null===q&&0===h&&this._show_empty_bins&&(q=0)):
q=null}if(null===q)return d.remove(),null;g={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(f,n),exact:!0,menu:!0};this.options.Color&&(g.color2=this.GetPalette().getColor(q));a.disabled&&!this.is_projection?(d.remove(),g.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),e=1E4*f+n,"X"==this.is_projection?
(r=0,t=this.frame_width(),1<this.projection_width&&(e=(this.projection_width-1)/2,m+e>=c.j2?(m=Math.min(Math.round(m+e),c.j2),p=Math.max(m-this.projection_width,c.j1)):(p=Math.max(Math.round(p-e),c.j1),m=Math.min(p+this.projection_width,c.j2))),x=c.gry[m],v=c.gry[p],e=777*p+333*m):"Y"==this.is_projection&&(x=0,v=this.frame_height(),1<this.projection_width&&(e=(this.projection_width-1)/2,l+e>=c.i2?(l=Math.min(Math.round(l+e),c.i2),k=Math.max(l-this.projection_width,c.i1)):(k=Math.max(Math.round(k-
e),c.i1),l=Math.min(k+this.projection_width,c.i2))),r=c.grx[k],t=c.grx[l],e=777*k+333*l),g.changed=d.property("current_bin")!==e,g.changed&&d.attr("d","M"+r+","+x+"h"+(t-r)+"v"+(v-x)+"h"+(r-t)+"z").style("opacity","0.7").property("current_bin",e),this.is_projection&&g.changed&&this.RedrawProjection(k,l,p,m));g.changed&&(g.user_info={obj:b,name:b.fName,bin:b.getBin(f+1,n+1),cont:h,binx:f+1,biny:n+1,grx:a.x,gry:a.y});return g};F.prototype.CanZoomIn=function(a,b,c){if("z"==a)return!0;var d=this.GetHisto();
d&&(d="y"==a?d.fYaxis:d.fXaxis);return!d||1<d.FindBin(c,.5)-d.FindBin(b,0)};F.prototype.Draw2D=function(a,b){this.Clear3DScene();this.mode3d=!1;this.CreateXY();b=this.DrawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),!0);this.DrawAxes();this.DrawBins();b&&b.DrawPave();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();k.CallBack(a)};F.prototype.Draw3D=function(a,b){this.mode3d=!0;k.AssertPrerequisites("hist3d",function(){this.Draw3D(a,b)}.bind(this))};
F.prototype.CallDrawFunc=function(a,b){var c=this.main_painter(),d=this.frame_painter();c!==this&&d&&d.mode3d!==this.options.Mode3D&&this.CopyOptionsFrom(c);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,b)};F.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};I.prototype=Object.create(k.TObjectPainter.prototype);I.prototype.Cleanup=function(){var a=this.pad_painter();a&&a.CleanPrimitives(this.Selector.bind(this,!0));delete this.firstpainter;delete this.painters;k.TObjectPainter.prototype.Cleanup.call(this)};
I.prototype.HasErrors=function(a){if(a.fSumw2&&0<a.fSumw2.length)for(var b=0;b<a.fSumw2.length;++b)if(0<a.fSumw2[b])return!0;return!1};I.prototype.BuildStack=function(a){if(!a.fHists)return!1;var b=a.fHists.arr.length;if(0>=b)return!1;var c=k.Create("TList");c.Add(k.clone(a.fHists.arr[0]),a.fHists.opt[0]);for(var d=1;d<b;++d){var e=k.clone(a.fHists.arr[d]),g=a.fHists.opt[d],h=c.arr[d-1];if(e.fNbins!=h.fNbins||e.fXaxis.fXmin!=h.fXaxis.fXmin||e.fXaxis.fXmax!=h.fXaxis.fXmax)return k.console("When drawing THStack, cannot sum-up histograms "+
e.fName+" and "+h.fName),c.Clear(),!1;for(var f=0;f<e.fArray.length;++f)e.fArray[f]+=h.fArray[f];c.Add(e,g)}a.fStack=c;return!0};I.prototype.GetHistMinMax=function(a,b){var c={min:0,max:0},d=!0,e=!0;-1111!==a.fMinimum&&(c.min=a.fMinimum,d=!1);-1111!==a.fMaximum&&(c.max=a.fMaximum,e=!1);if(!d&&!e)return c;var g=1,h=a.fXaxis.fNbins,f=1,u=1,n=!0;a.fXaxis.TestBit(k.EAxisBits.kAxisRange)&&(g=a.fXaxis.fFirst,h=a.fXaxis.fLast);0===a._typename.indexOf("TH2")&&(u=a.fYaxis.fNbins,a.fYaxis.TestBit(k.EAxisBits.kAxisRange)&&
(f=a.fYaxis.fFirst,u=a.fYaxis.fLast));for(;f<=u;++f)for(var l=g;l<=h;++l){var p=a.getBinContent(l,f),m=b?a.getBinError(a.getBin(l,f)):0;d&&(n||p-m<c.min)&&(c.min=p-m);e&&(n||p+m>c.max)&&(c.max=p+m);n=!1}return c};I.prototype.GetMinMax=function(a,b){var c={min:0,max:0},d=this.GetObject();if(this.options.nostack)for(var e=0;e<d.fHists.arr.length;++e){var g=this.GetHistMinMax(d.fHists.arr[e],a);0==e?c=g:(c.min=Math.min(c.min,g.min),c.max=Math.max(c.max,g.max))}else c.min=this.GetHistMinMax(d.fStack.arr[0],
a).min,c.max=this.GetHistMinMax(d.fStack.arr[d.fStack.arr.length-1],a).max;-1111!=d.fMaximum&&(c.max=d.fMaximum);c.max*=1.05;-1111!=d.fMinimum&&(c.min=d.fMinimum);b&&(1==this.options.ndim?b.fLogy:b.fLogz)?(0>=c.max&&(c.max=1),0>=c.min&&(c.min=1E-4*c.max),a=1/(1+.5*k.log10(c.max/c.min)),b=1+.2*k.log10(c.max/c.min),c.min*=a,c.max*=b):0<c.min&&c.min<.05*c.max&&(c.min=0);return c};I.prototype.DrawNextHisto=function(a,b,c,d){"callback"===b&&(b=null,0>a?this.firstpainter=c:this.painters.push(c),a++);var e=
this.GetObject(),g=e.fHistogram,h=(e=this.options.nostack?e.fHists:e.fStack)&&e.arr?e.arr.length:0,f=0;if(a>=h)return this.DrawingReady();if(499===a%500&&!d)return setTimeout(this.DrawNextHisto.bind(this,a,b,c,!0),0);if(0<=a){if(f=this.options.horder?a:h-a-1,g=e.arr[f],c=e.opt[f]||g.fOption||this.options.hopt,0>c.toUpperCase().indexOf(this.options.hopt)&&(c+=this.options.hopt),this.options.draw_errors&&!c&&(c="E"),c+=" same nostat",this.options._pfc||this.options._plc||this.options._pmc)!this.palette&&
k.Painter.GetColorPalette&&(this.palette=k.Painter.GetColorPalette()),this.palette&&(b=this.palette.calcColor(f,h+1),b=this.add_color(b),this.options._pfc&&(g.fFillColor=b),this.options._plc&&(g.fLineColor=b),this.options._pmc&&(g.fMarkerColor=b))}else c=this.options.hopt+" axis",b&&(c+=";minimum:"+b.min+";maximum:"+b.max);0<f&&!this.options.nostack&&(g.$baseh=e.arr[f-1]);k.draw(this.divid,g,c,this.DrawNextHisto.bind(this,a,"callback"))};I.prototype.DecodeOptions=function(a){this.options||(this.options=
{});k.extend(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});var b=this.GetObject(),c=b.fHistogram||(b.fHists?b.fHists.arr[0]:null)||(b.fStack?b.fStack.arr[0]:null);c&&0==c._typename.indexOf("TH2")&&(this.options.ndim=2);2!=this.options.ndim||a||(a="lego1");if(b.fHists&&!this.options.nostack)for(c=0;c<b.fHists.arr.length;++c)this.options.has_errors=this.options.has_errors||this.HasErrors(b.fHists.arr[c]);a=new k.DrawOptions(a);this.options.nostack=a.check("NOSTACK");
a.check("STACK")&&(this.options.nostack=!1);this.options.same=a.check("SAME");this.options._pfc=a.check("PFC");this.options._plc=a.check("PLC");this.options._pmc=a.check("PMC");this.options.hopt=a.remain();b=a.check("LEGO");this.options.errors=a.check("E");!this.options.nostack&&this.options.has_errors&&!b&&!a.check("HIST")&&0>this.options.hopt.indexOf("E")&&(this.options.draw_errors=!0);this.options.horder=this.options.nostack||b};I.prototype.CreateHistogram=function(a){var b=a.fHists,c=b?b.arr.length:
0;if(!c){var d=k.CreateHistogram("TH1I",100);d.fTitle=a.fTitle;return d}var e=b.arr[0];d=k.CreateHistogram(1==this.options.ndim?"TH1I":"TH2I",e.fXaxis.fNbins,e.fYaxis.fNbins);d.fName="axis_hist";k.extend(d.fXaxis,e.fXaxis);2==this.options.ndim&&k.extend(d.fYaxis,e.fYaxis);for(e=1;e<c;++e){var g=b.arr[e];d.fXaxis.fLabels||(d.fXaxis.fXmin=Math.min(d.fXaxis.fXmin,g.fXaxis.fXmin),d.fXaxis.fXmax=Math.max(d.fXaxis.fXmax,g.fXaxis.fXmax));2!=this.options.ndim||d.fYaxis.fLabels||(d.fYaxis.fXmin=Math.min(d.fYaxis.fXmin,
g.fYaxis.fXmin),d.fYaxis.fXmax=Math.max(d.fYaxis.fXmax,g.fYaxis.fXmax))}d.fTitle=a.fTitle;return d};I.prototype.drawStack=function(){var a=this.GetObject();this.options.nostack||(this.options.nostack=!this.BuildStack(a));a.fHistogram||this.options.same||(a.fHistogram=this.CreateHistogram(a));a=this.GetMinMax(this.options.errors||this.options.draw_errors,this.root_pad());this.DrawNextHisto(this.options.same?0:-1,a);return this};I.prototype.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;
var b=this.GetObject();b.fHists=a.fHists;b.fStack=a.fStack;this.options.nostack||(this.options.nostack=!this.BuildStack(b));var c=!1;this.firstpainter&&(c=a.fHistogram,c||(c=b.fHistogram=this.CreateHistogram(b)),this.firstpainter.UpdateObject(c),b=this.GetMinMax(this.options.errors||this.options.draw_errors,this.root_pad()),this.firstpainter.options.minimum=b.min,this.firstpainter.options.maximum=b.max,1==this.options.ndim&&(this.firstpainter.ymin=b.min,this.firstpainter.ymax=b.max),c=!0);(b=this.pad_painter())&&
b.CleanPrimitives(this.Selector.bind(this,!1));this.painters=[];return this.did_update=c};I.prototype.Selector=function(a,b){return a&&b===this.firstpainter?!0:0<=this.painters.indexOf(b)};I.prototype.Redraw=function(){this.did_update&&(delete this.did_update,this.firstpainter&&this.firstpainter.Redraw(),this.DrawNextHisto(0,null))};k.Painter.drawLegend=H;k.Painter.drawPaveText=H;k.Painter.drawPave=H;k.Painter.produceLegend=function(a,b){var c=k.GetMainPainter(a);if(c){var d=c.pad_painter();c=c.root_pad();
if(d&&c){for(var e=k.Create("TLegend"),g=0;g<d.painters.length;++g){var h=d.painters[g],f=h.GetObject();if(f){var u=k.Create("TLegendEntry");u.fObject=f;u.fLabel="all"==b?f.fName:h.GetItemName();u.fOption="";u.fLabel&&(h.lineatt&&h.lineatt.used&&(u.fOption+="l"),h.fillatt&&h.fillatt.used&&(u.fOption+="f"),h.markeratt&&h.markeratt.used&&(u.fOption+="m"),u.fOption||(u.fOption="l"),e.fPrimitives.Add(u))}}if(b=e.fPrimitives.arr.length)return 8<b&&(b=8),b*=.1,k.extend(e,{fX1NDC:.4*c.fLeftMargin+.6*(1-
c.fRightMargin),fY1NDC:(1-b)*(1-c.fTopMargin)+b*c.fBottomMargin,fX2NDC:.99-c.fRightMargin,fY2NDC:.99-c.fTopMargin}),e.fFillStyle=1001,H(a,e)}}};k.Painter.drawHistogram1D=function(a,b,c){var d=new G(b);if(!d.SetDivId(a,1))return null;d.DecodeOptions(c);d.CheckPadRange(!d.options.Mode3D);d.ScanContent();d.CreateStat();d.CallDrawFunc(function(){d.DrawNextFunction(0,function(){!d.options.Mode3D&&d.options.AutoZoom&&d.AutoZoom();d.FillToolbar();d.DrawingReady()})});return d};k.Painter.drawHistogram2D=
W;k.Painter.drawTF2=function(a,b,c){var d=new k.DrawOptions(c),e=X(b,d.check("NOSAVE"));c=d.empty()?"cont3":"SAME"===d.opt?"cont2 same":d.opt;a=W(a,e,c);a.tf2_typename=b._typename;a.tf2_nosave=d.check("NOSAVE");a.UpdateObject=function(a,b){if(!a||this.tf2_typename!=a._typename)return!1;X(a,this.tf2_nosave,this.GetHisto());return!0};return a};k.Painter.drawHStack=function(a,b,c){var d=new I(b,c);d.SetDivId(a,-1);d.DecodeOptions(c);if(!b.fHists||0==b.fHists.arr.length)return d.DrawingReady();d.drawStack();
d.SetDivId(a);return d};k.TPavePainter=C;k.THistPainter=y;k.TH1Painter=G;k.TH2Painter=F;k.THStackPainter=I;return k});
