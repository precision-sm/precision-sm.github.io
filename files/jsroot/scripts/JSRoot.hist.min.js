var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(k){var v=0;return function(){return v<k.length?{done:!1,value:k[v++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.makeIterator=function(k){var v="undefined"!=typeof Symbol&&Symbol.iterator&&k[Symbol.iterator];return v?v.call(k):$jscomp.arrayIterator(k)};
$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,v,F){k!=Array.prototype&&k!=Object.prototype&&(k[v]=F.value)};
$jscomp.polyfill=function(k,v,F,x){if(v){F=$jscomp.global;k=k.split(".");for(x=0;x<k.length-1;x++){var B=k[x];B in F||(F[B]={});F=F[B]}k=k[k.length-1];x=F[k];v=v(x);v!=x&&null!=v&&$jscomp.defineProperty(F,k,{configurable:!0,writable:!0,value:v})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(k){function v(){this.batch_=null}function F(m){return m instanceof B?m:new B(function(k,v){k(m)})}if(k&&!$jscomp.FORCE_POLYFILL_PROMISE)return k;v.prototype.asyncExecute=function(m){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(m)};var x=$jscomp.global.setTimeout;v.prototype.asyncExecuteFunction=function(m){x(m,0)};v.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var m=
this.batch_;this.batch_=[];for(var k=0;k<m.length;++k){var v=m[k];m[k]=null;try{v()}catch(O){this.asyncThrow_(O)}}}this.batch_=null};v.prototype.asyncThrow_=function(m){this.asyncExecuteFunction(function(){throw m;})};var B=function(m){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var k=this.createResolveAndReject_();try{m(k.resolve,k.reject)}catch(D){k.reject(D)}};B.prototype.createResolveAndReject_=function(){function m(m){return function(D){v||(v=!0,m.call(k,D))}}var k=this,v=!1;
return{resolve:m(this.resolveTo_),reject:m(this.reject_)}};B.prototype.resolveTo_=function(m){if(m===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(m instanceof B)this.settleSameAsPromise_(m);else{a:switch(typeof m){case "object":var k=null!=m;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(m):this.fulfill_(m)}};B.prototype.resolveToNonPromiseObj_=function(m){var k=void 0;try{k=m.then}catch(D){this.reject_(D);return}"function"==typeof k?
this.settleSameAsThenable_(k,m):this.fulfill_(m)};B.prototype.reject_=function(m){this.settle_(2,m)};B.prototype.fulfill_=function(m){this.settle_(1,m)};B.prototype.settle_=function(m,k){if(0!=this.state_)throw Error("Cannot settle("+m+", "+k+"): Promise already settled in state"+this.state_);this.state_=m;this.result_=k;this.executeOnSettledCallbacks_()};B.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var m=0;m<this.onSettledCallbacks_.length;++m)I.asyncExecute(this.onSettledCallbacks_[m]);
this.onSettledCallbacks_=null}};var I=new v;B.prototype.settleSameAsPromise_=function(m){var k=this.createResolveAndReject_();m.callWhenSettled_(k.resolve,k.reject)};B.prototype.settleSameAsThenable_=function(m,k){var v=this.createResolveAndReject_();try{m.call(k,v.resolve,v.reject)}catch(O){v.reject(O)}};B.prototype.then=function(m,k){function v(m,k){return"function"==typeof m?function(k){try{x(m(k))}catch(a){E(a)}}:k}var x,E,F=new B(function(m,k){x=m;E=k});this.callWhenSettled_(v(m,x),v(k,E));return F};
B.prototype.catch=function(m){return this.then(void 0,m)};B.prototype.callWhenSettled_=function(m,k){function v(){switch(x.state_){case 1:m(x.result_);break;case 2:k(x.result_);break;default:throw Error("Unexpected state: "+x.state_);}}var x=this;null==this.onSettledCallbacks_?I.asyncExecute(v):this.onSettledCallbacks_.push(v)};B.resolve=F;B.reject=function(m){return new B(function(k,v){v(m)})};B.race=function(m){return new B(function(k,v){for(var x=$jscomp.makeIterator(m),D=x.next();!D.done;D=x.next())F(D.value).callWhenSettled_(k,
v)})};B.all=function(m){var k=$jscomp.makeIterator(m),v=k.next();return v.done?F([]):new B(function(m,x){function D(k){return function(a){B[k]=a;E--;0==E&&m(B)}}var B=[],E=0;do B.push(void 0),E++,F(v.value).callWhenSettled_(D(B.length-1),x),v=k.next();while(!v.done)})};return B},"es6","es3");$jscomp.polyfill("Math.log10",function(k){return k?k:function(k){return Math.log(k)/Math.LN10}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(k){return k?k:function(k){return"number"!==typeof k?!1:!isNaN(k)&&Infinity!==k&&-Infinity!==k}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(k){return k?k:function(k){return Number.isFinite(k)?k===Math.floor(k):!1}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(k,v){this.$jscomp$symbol$id_=k;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:v})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function k(F){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(F||"")+"_"+v++,F)}var v=0;return k}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.asyncIterator;k||(k=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};
$jscomp.iteratorFromArray=function(k,v){$jscomp.initSymbolIterator();k instanceof String&&(k+="");var F=0,x={next:function(){if(F<k.length){var B=F++;return{value:v(B,k[B]),done:!1}}x.next=function(){return{done:!0,value:void 0}};return x.next()}};x[Symbol.iterator]=function(){return x};return x};$jscomp.polyfill("Array.prototype.entries",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(k,F){return[k,F]})}},"es6","es3");
JSROOT.define(["d3","painter","gpad"],function(k,v){function F(a){a=a||JSROOT.settings.Palette;if(0<a&&10>a){var c=[];for(a=0;50>a;++a){var d=Math.round((a+2)/60*255);c.push("rgb("+d+","+d+","+d+")")}return new JSROOT.ColorPalette(c)}if(51>a)return ca();113<a&&(a=57);c=[0,.125,.25,.375,.5,.625,.75,.875,1];switch(a){case 51:var b=[[0,9,13,17,24,32,27,25,29],[0,0,0,2,37,74,113,160,221],[28,42,59,78,98,129,154,184,221]];break;case 52:b=[[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255],
[0,32,64,96,128,160,192,224,255]];break;case 53:b=[[0,45,99,156,212,230,237,234,242],[0,0,0,45,101,168,238,238,243],[0,1,1,3,9,8,11,95,230]];break;case 54:b=[[0,22,44,68,93,124,160,192,237],[0,16,41,67,93,125,162,194,241],[97,100,99,99,93,68,44,26,74]];break;case 55:b=[[0,5,15,35,102,196,208,199,110],[0,48,124,192,206,226,97,16,0],[99,142,198,201,90,22,13,8,2]];break;case 56:b=[[242,234,237,230,212,156,99,45,0],[243,238,238,168,101,45,0,0,0],[230,95,11,8,9,3,1,1,0]];break;case 57:b=[[53.091,15.096,
19.89,5.916,45.951,135.1755,208.743,253.878,248.982],[42.432,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,250.716],[134.9715,221.442,213.8175,201.807,163.8375,118.881,89.2245,50.184,13.7445]];break;case 58:b=[[0,24,2,54,176,236,202,194,255],[0,29,92,129,117,120,176,236,255],[0,68,80,34,57,172,252,245,255]];break;case 59:b=[[13,23,25,63,76,104,137,161,206],[95,67,37,21,0,12,35,52,79],[4,3,2,6,11,22,49,98,208]];break;case 60:b=[[0,61,89,122,143,160,185,204,231],[0,0,0,0,14,37,72,132,235],
[0,140,224,144,4,5,6,9,13]];break;case 61:b=[[14,7,2,0,5,11,55,131,229],[105,56,26,1,42,74,131,171,229],[2,21,35,60,92,113,160,185,229]];break;case 62:b=[[0,0,0,70,148,231,235,237,244],[0,0,0,0,0,69,67,216,244],[0,102,228,231,177,124,137,20,244]];break;case 63:b=[[50,56,63,68,93,121,165,192,241],[66,81,91,96,111,128,155,189,241],[97,91,75,65,77,103,143,167,217]];break;case 64:b=[[145,166,167,156,131,114,101,112,132],[158,178,179,181,163,154,144,152,159],[190,199,201,192,176,169,160,166,190]];break;
case 65:b=[[93,91,99,108,130,125,132,155,174],[126,124,128,129,131,121,119,153,173],[103,94,87,85,80,85,107,120,146]];break;case 66:b=[[24,40,69,90,104,114,120,132,103],[29,52,94,127,150,162,159,151,101],[29,52,96,132,162,181,184,186,131]];break;case 67:b=[[46,38,61,92,113,121,132,150,191],[46,36,40,69,110,135,131,92,34],[46,80,74,70,81,105,165,211,225]];break;case 68:b=[[0,4,12,30,52,101,142,190,237],[0,40,86,121,140,172,187,213,240],[0,9,14,18,21,23,27,35,101]];break;case 69:b=[[198,206,206,211,
198,181,161,171,244],[103,133,150,172,178,174,163,175,244],[49,54,55,66,91,130,184,224,244]];break;case 70:b=[[243,243,240,240,241,239,186,151,129],[0,46,99,149,194,220,183,166,147],[6,8,36,91,169,235,246,240,233]];break;case 71:b=[[22,19,19,25,35,53,88,139,210],[0,32,69,108,135,159,183,198,215],[77,96,110,116,110,100,90,78,70]];break;case 72:b=[[68,116,165,182,189,180,145,111,71],[37,82,135,178,204,225,221,202,147],[16,55,105,147,196,226,232,224,178]];break;case 73:b=[[61,99,136,181,213,225,198,
136,24],[149,140,96,83,132,178,190,135,22],[214,203,168,135,110,100,111,113,22]];break;case 74:b=[[76,120,156,183,197,180,162,154,140],[34,35,42,69,102,137,164,188,197],[64,69,78,105,142,177,205,217,198]];break;case 75:b=[[37,102,157,188,196,214,223,235,251],[37,29,25,37,67,91,132,185,251],[37,32,33,45,66,98,137,187,251]];break;case 76:b=[[79,100,119,137,153,172,192,205,250],[63,79,93,103,115,135,167,196,250],[51,59,66,61,62,70,110,160,250]];break;case 77:b=[[43,44,50,66,125,172,178,155,157],[63,
63,85,101,138,163,122,51,39],[121,101,58,44,47,55,57,44,43]];break;case 78:b=[[0,41,62,79,90,87,99,140,228],[0,57,81,93,85,70,71,125,228],[95,91,91,82,60,43,44,112,228]];break;case 79:b=[[49,59,72,88,114,141,176,205,222],[78,72,66,57,59,75,106,142,173],[78,55,46,40,39,39,40,41,47]];break;case 80:b=[[243,222,201,185,165,158,166,187,219],[94,108,132,135,125,96,68,51,61],[7,9,12,19,45,89,118,146,118]];break;case 81:b=[[19,44,74,105,137,166,194,206,220],[19,28,40,55,82,110,159,181,220],[19,42,68,96,129,
157,188,203,220]];break;case 82:b=[[33,44,70,99,140,165,199,211,216],[38,50,76,105,140,165,191,189,167],[55,67,97,124,140,166,163,129,52]];break;case 83:b=[[0,33,73,124,136,152,159,171,223],[0,43,92,124,134,126,121,144,223],[0,43,68,76,73,64,72,114,223]];break;case 84:b=[[5,18,45,124,193,223,205,128,49],[48,134,207,230,193,113,28,0,7],[6,15,41,121,193,226,208,130,49]];break;case 85:b=[[180,106,104,135,164,188,189,165,144],[72,126,154,184,198,207,205,190,179],[41,120,158,188,194,181,145,100,62]];break;
case 86:b=[[57,72,94,117,136,154,174,192,215],[0,33,68,109,140,171,192,196,209],[116,137,173,201,200,201,203,190,187]];break;case 87:b=[[31,71,123,160,210,222,214,199,183],[40,117,171,211,231,220,190,132,65],[234,214,228,222,210,160,105,60,34]];break;case 88:b=[[123,108,109,126,154,172,188,196,218],[184,138,130,133,154,175,188,196,218],[208,130,109,99,110,122,150,171,218]];break;case 89:b=[[105,106,122,143,159,172,176,181,207],[252,197,194,187,174,162,153,136,125],[146,133,144,155,163,167,166,162,
174]];break;case 90:b=[[171,141,145,152,154,159,163,158,177],[236,143,100,63,53,55,44,31,6],[59,48,46,44,42,54,82,112,179]];break;case 91:b=[[180,190,209,223,204,228,205,152,91],[93,125,147,172,181,224,233,198,158],[236,218,160,133,114,132,162,220,218]];break;case 92:b=[[225,183,162,135,115,111,119,145,211],[205,177,166,135,124,117,117,132,172],[186,165,155,135,126,130,150,178,226]];break;case 93:b=[[39,43,59,63,80,116,153,177,223],[39,43,59,74,91,114,139,165,223],[39,50,59,70,85,115,151,176,223]];
break;case 94:b=[[0,38,60,76,84,89,101,128,204],[0,10,15,23,35,57,83,123,199],[0,11,22,40,63,86,97,94,85]];break;case 95:b=[[94,112,141,165,167,140,91,49,27],[27,46,88,135,166,161,135,97,58],[42,52,81,106,139,158,155,137,116]];break;case 96:b=[[30,49,79,117,135,151,146,138,147],[63,60,72,90,94,94,68,46,16],[18,28,41,56,62,63,50,36,21]];break;case 97:b=[[0,30,63,101,143,152,169,187,230],[0,14,28,42,58,61,67,74,91],[39,26,21,18,15,14,14,13,13]];break;case 98:b=[[149,140,164,179,182,181,131,87,61],[62,
70,107,136,144,138,117,87,74],[40,38,45,49,49,49,38,32,34]];break;case 99:b=[[99,112,148,165,179,182,183,183,208],[39,40,57,79,104,127,148,161,198],[15,16,18,33,51,79,103,129,177]];break;case 100:b=[[99,116,154,174,200,196,201,201,230],[0,0,8,32,58,83,119,136,173],[5,6,7,9,9,14,17,19,24]];break;case 101:b=[[82,106,126,141,155,163,142,107,66],[62,44,69,107,135,152,149,132,119],[39,25,31,60,73,68,49,72,188]];break;case 102:b=[[18,29,44,72,116,158,184,208,221],[27,46,71,105,146,177,189,190,183],[39,
55,80,108,130,133,124,100,76]];break;case 103:b=[[0,48,119,173,212,224,228,228,245],[0,13,30,47,79,127,167,205,245],[0,68,75,43,16,22,55,128,245]];break;case 104:b=[[34,70,129,187,225,226,216,193,179],[48,91,147,194,226,229,196,110,12],[234,212,216,224,206,110,53,40,29]];break;case 105:b=[[30,55,103,147,174,203,188,151,105],[0,65,138,182,187,175,121,53,9],[191,202,212,208,171,140,97,57,30]];break;case 106:b=[[112,97,113,125,138,159,178,188,225],[16,17,24,37,56,81,110,136,189],[38,35,46,59,78,103,
130,152,201]];break;case 107:b=[[18,72,5,23,29,201,200,98,29],[0,0,43,167,211,117,0,0,0],[51,203,177,26,10,9,8,3,0]];break;case 108:b=[[19,42,64,88,118,147,175,187,205],[19,55,89,125,154,169,161,129,70],[19,32,47,70,100,128,145,130,75]];break;case 109:b=[[33,31,42,68,86,111,141,172,227],[255,175,145,106,88,55,15,0,0],[255,205,202,203,208,205,203,206,231]];break;case 110:b=[[0,25,50,79,110,145,181,201,254],[0,16,30,46,63,82,101,124,179],[0,12,21,29,39,49,61,74,103]];break;case 111:b=[[0,13,30,44,72,
120,156,200,247],[0,36,84,117,141,153,151,158,247],[0,94,100,82,56,66,76,131,247]];break;case 112:b=[[26,51,43,33,28,35,74,144,246],[9,24,55,87,118,150,180,200,222],[30,96,112,114,112,101,72,35,0]];break;case 113:b=[[0,5,65,97,124,156,189,224,255],[32,54,77,100,123,148,175,203,234],[77,110,107,111,120,119,111,94,70]];break;default:return ca()}a=b[0];d=b[1];b=b[2];for(var f=[],e=1;e<c.length;e++)for(var g=Math.round(Math.floor(255*c[e])-Math.floor(255*c[e-1])),h=0;h<g;h++)f.push("rgb("+(Math.round(a[e-
1]+h*(a[e]-a[e-1])/g)+","+Math.round(d[e-1]+h*(d[e]-d[e-1])/g)+","+Math.round(b[e-1]+h*(b[e]-b[e-1])/g))+")");return new JSROOT.ColorPalette(f)}function x(a,c){JSROOT.ObjectPainter.call(this,a,c);this.UseContextMenu=this.Enabled=!0;this.UseTextColor=!1}function B(){this.reset()}function I(a,c){this.arr=[];this.colzmin=a;this.colzmax=c;this.below_min_indx=-1;this.exact_min_indx=0}function m(a,c){JSROOT.ObjectPainter.call(this,a,c);this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;
this.mode3d=!1;this.hist_painter_id=JSROOT._.id_counter++}function E(a,c){m.call(this,a,c)}function D(a,c){m.call(this,a,c);this.fPalette=null;this.wheel_zoomy=!0}function O(a,c,d){var b=0,f=0,e=0;c||(b=a.fSave.length,f=Math.round(a.fSave[b-2]),e=Math.round(a.fSave[b-1]),b!==(f+1)*(e+1)+6&&(b=0));if(6<b){c=(a.fSave[b-5]-a.fSave[b-6])/f/2;var g=(a.fSave[b-3]-a.fSave[b-4])/e/2;d||(d=JSROOT.createHistogram("TH2F",f+1,e+1));d.fXaxis.fXmin=a.fSave[b-6]-c;d.fXaxis.fXmax=a.fSave[b-5]+c;d.fYaxis.fXmin=a.fSave[b-
4]-g;d.fYaxis.fXmax=a.fSave[b-3]+g;for(c=b=0;c<=e;++c)for(g=0;g<=f;++g)d.setBinContent(d.getBin(g+1,c+1),a.fSave[b++])}else for(f=Math.max(a.fNpx,2),e=Math.max(a.fNpy,2),d||(d=JSROOT.createHistogram("TH2F",f,e)),d.fXaxis.fXmin=a.fXmin,d.fXaxis.fXmax=a.fXmax,d.fYaxis.fXmin=a.fYmin,d.fYaxis.fXmax=a.fYmax,b=0;b<e;++b)for(c=0;c<f;++c){g=a.fXmin+(c+.5)*(a.fXmax-a.fXmin)/f;var h=a.fYmin+(b+.5)*(a.fYmax-a.fYmin)/e;d.setBinContent(d.getBin(c+1,b+1),a.evalPar(g,h))}d.fName="Func";d.fTitle=a.fTitle;d.fMinimum=
a.fMinimum;d.fMaximum=a.fMaximum;d.fLineColor=a.fLineColor;d.fLineStyle=a.fLineStyle;d.fLineWidth=a.fLineWidth;d.fFillColor=a.fFillColor;d.fFillStyle=a.fFillStyle;d.fMarkerColor=a.fMarkerColor;d.fMarkerStyle=a.fMarkerStyle;d.fMarkerSize=a.fMarkerSize;d.fBits|=K.kNoStats;return d}function H(a,c,d){JSROOT.ObjectPainter.call(this,a,c,d);this.firstpainter=null;this.painters=[]}var ca=function(){function a(a,b,d){if(1E-100>d)b=d=a=b;else{var c=function(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*
d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a},e=.5>b?b*(1+d):b+d-b*d,f=2*b-e;b=c(f,e,a+1/3);d=c(f,e,a);a=c(f,e,a-1/3)}return"rgb("+Math.round(255*b)+","+Math.round(255*d)+","+Math.round(255*a)+")"}for(var c=[],d=0;50>d;++d){var b=a((280-5.6*(d+1))/360,.5,1);c.push(b)}return new JSROOT.ColorPalette(c)};x.prototype=Object.create(JSROOT.ObjectPainter.prototype);x.prototype.drawPave=function(a){var c=this;this.UseTextColor=!1;var d=Promise.resolve(this);if(!this.Enabled)return this.removeG(),d;var b=this.getObject(),
f=b.fOption.toUpperCase();if(0===b.fInit){this.stored=JSROOT.extend({},b);b.fInit=1;var e=this.getPadPainter().getRootPad(!0);if("TPaletteAxis"!=b._typename||b.fX1||b.fX2||b.fY1||b.fY2)0<=f.indexOf("NDC")?(b.fX1NDC=b.fX1,b.fX2NDC=b.fX2,b.fY1NDC=b.fY1,b.fY2NDC=b.fY2):e?(e.fLogx&&(0<b.fX1&&(b.fX1=Math.log10(b.fX1)),0<b.fX2&&(b.fX2=Math.log10(b.fX2))),e.fLogy&&(0<b.fY1&&(b.fY1=Math.log10(b.fY1)),0<b.fY2&&(b.fY2=Math.log10(b.fY2))),b.fX1NDC=(b.fX1-e.fX1)/(e.fX2-e.fX1),b.fY1NDC=(b.fY1-e.fY1)/(e.fY2-e.fY1),
b.fX2NDC=(b.fX2-e.fX1)/(e.fX2-e.fX1),b.fY2NDC=(b.fY2-e.fY1)/(e.fY2-e.fY1)):(b.fX1NDC=b.fY1NDC=.1,b.fX2NDC=b.fY2NDC=.9);else{var g=this.getFramePainter();g?(b.fX1NDC=g.fX2NDC+.01,b.fX2NDC=Math.min(.96,g.fX2NDC+.06),b.fY1NDC=g.fY1NDC,b.fY2NDC=g.fY2NDC):(b.fX2NDC=.8,b.fX1NDC=.9,b.fY1NDC=.1,b.fY2NDC=.9)}b.fX1NDC==b.fX2NDC&&b.fY1NDC==b.fY2NDC&&"TLegend"==b._typename&&(b.fX1NDC=Math.max(e?e.fLeftMargin:0,b.fX2NDC-.3),b.fX2NDC=Math.min(b.fX1NDC+.3,e?1-e.fRightMargin:1),g=Math.max(b.fPrimitives?.05*b.fPrimitives.arr.length:
0,.2),b.fY2NDC=Math.min(e?1-e.fTopMargin:1,b.fY1NDC+g),b.fY1NDC=Math.max(b.fY2NDC-g,e?e.fBottomMargin:0))}e=this.getPadPainter().getPadRect();var h=Math.round(b.fX1NDC*e.width),t=Math.round((1-b.fY2NDC)*e.height),q=Math.round((b.fX2NDC-b.fX1NDC)*e.width),l=Math.round((b.fY2NDC-b.fY1NDC)*e.height);g=b.fBorderSize;e=0<=f.indexOf("L")?-1:0<=f.indexOf("R")?1:0;f=0<=f.indexOf("T")?-1:0<=f.indexOf("B")?1:0;this.createG();this.draw_g.attr("transform","translate("+h+","+t+")");this.createAttLine({attr:b,
width:0<g?b.fLineWidth:0});this.createAttFill({attr:b});if("TDiamond"==b._typename){d=Math.round(l/2);var u=Math.round(q/2),r="l"+u+",-"+d+"l"+u+","+d+"l-"+u+","+d+"z";1<g&&0<b.fShadowColor&&(e||f)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d","M0,"+(d+g)+r).style("fill",this.getColor(b.fShadowColor)).style("stroke",this.getColor(b.fShadowColor)).style("stroke-width","1px");this.draw_g.append("svg:path").attr("d","M0,"+d+r).call(this.fillatt.func).call(this.lineatt.func);e=this.draw_g.append("svg:g").attr("transform",
"translate("+Math.round(q/4)+","+Math.round(l/4)+")");return this.drawPaveText(u,d,a,e)}1<g&&0<b.fShadowColor&&!b.fNpaves&&(e||f)&&(u="",r=this.getColor(b.fShadowColor),u=this.fillatt.empty()?0>e&&0>f?"M0,0v"+(l-g)+"h-"+g+"v-"+l+"h"+q+"v"+g:"M0,"+l+"v-"+(l-g)+"h-"+g+"v"+l+"h"+q+"v-"+g:"M"+e*g+","+f*g+"v"+l+"h"+q+"v-"+l,this.draw_g.append("svg:path").attr("d",u+"z").style("fill",r).style("stroke",r).style("stroke-width","1px"));if(b.fNpaves)for(g=b.fNpaves-1;0<g;--g)this.draw_g.append("svg:path").attr("d",
"M"+4*e*g+","+4*f*g+"h"+q+"v"+l+"h-"+q+"z").call(this.fillatt.func).call(this.lineatt.func);var n=this.draw_g.append("svg:path").attr("d","M0,0h"+q+"v"+l+"h-"+q+"z").call(this.fillatt.func).call(this.lineatt.func);"function"==typeof this.paveDrawFunc&&(d=this.paveDrawFunc(q,l,a));return JSROOT.batch_mode||"TPave"==b._typename?d:d.then(function(){return JSROOT.require(["interactive"])}).then(function(a){n.style("pointer-events","visibleFill").on("mouseenter",function(){return c.showObjectStatus()});
c.draw_g.attr("x",h).attr("y",t).attr("width",q).attr("height",l);a.addDragHandler(c,{obj:b,minwidth:10,minheight:20,canselect:!0,redraw:function(){c.interactiveRedraw(!1,"pave_moved");c.drawPave()},ctxmenu:JSROOT.browser.touches&&JSROOT.settings.ContextMenu&&c.UseContextMenu});if(c.UseContextMenu&&JSROOT.settings.ContextMenu)c.draw_g.on("contextmenu",function(a){return c.paveContextMenu(a)});"TPaletteAxis"==b._typename&&c.interactivePaletteAxis(q,l);return c})};x.prototype.fillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;
a={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}var c=this.getObject();c&&c.fInit&&(a.fcust="pave",a.fopt=[c.fX1NDC,c.fY1NDC,c.fX2NDC,c.fY2NDC]);return a};x.prototype.drawPaveLabel=function(a,c){this.UseTextColor=!0;var d=this.getObject();this.startTextDrawing(d.fTextFont,c/1.2);this.drawText({align:d.fTextAlign,width:a,height:c,text:d.fLabel,color:this.getColor(d.fTextColor)});return this.finishTextDrawing()};x.prototype.drawPaveStats=function(a,
c){this.isStats()&&this.fillStatistic();for(var d=this.getObject(),b=[],f=this.getColor(d.fTextColor),e=0,g=0,h=0,t=0;t<d.fLines.arr.length;++t){var q=d.fLines.arr[t];"TText"!=q._typename&&"TLatex"!=q._typename||b.push(q.fTitle)}t=b.length;for(q=0;q<t;++q){var l=b[q];0<q&&(h=Math.max(h,l.length));0==q||0>l.indexOf("|")||(0===e&&(e=q),l=l.split("|"),l.length>g&&(g=l.length))}q=c/t;l=!1;var u=d.fMargin*a;this.startTextDrawing(d.fTextFont,c/(1.2*t));this.UseTextColor=!0;if(1==t)this.drawText({align:d.fTextAlign,
width:a,height:c,text:b[0],color:f,latex:1});else for(var r=0;r<t;++r){var n=r*q;this.UseTextColor=!0;if(e&&r>=e)for(var y=b[r].split("|"),p=0;p<y.length;++p)this.drawText({align:"middle",x:a*p/g,y:n,latex:0,width:a/g,height:q,text:y[p],color:f});else if(0>b[r].indexOf("="))0==r&&(l=!0,b[r].length>h+5&&(b[r]=b[r].substr(0,h+2)+"...")),this.drawText({align:0==r?"middle":"start",x:u,y:n,width:a-2*u,height:q,text:b[r],color:f});else{p=b[r].split("=");y=[];for(var z=0;2>z;++z)y.push({align:0==z?"start":
"end",x:u,y:n,width:a-2*u,height:q,text:p[z],color:f,_expected_width:a-2*u,_args:y,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,a.draw_g)}});for(n=0;2>n;++n)this.drawText(y[n])}}b="";0<d.fBorderSize&&l&&(b+="M0,"+Math.round(q)+"h"+a);if(0<e&&1<g){for(d=e;d<t;++d)b+="M0,"+Math.round(d*q)+"h"+a;for(d=0;d<g-1;++d)b+="M"+Math.round(a/g*(d+1))+","+Math.round(e*q)+"V"+c}b&&this.draw_g.append("svg:path").attr("d",
b).call(this.lineatt.func);this.draw_g.classed("most_upper_primitives",!0);return this.finishTextDrawing()};x.prototype.drawPaveText=function(a,c,d,b){var f=this;d=this.getObject();var e=this.getColor(d.fTextColor),g=0,h=[],t=this.getPadPainter(),q=t.getPadHeight(),l=!1,u=0<d.fLabel.length,r=[];b||(b=this.draw_g);for(var n=0;n<d.fLines.arr.length;++n){var y=d.fLines.arr[n];if("TText"==y._typename||"TLatex"==y._typename)if(g++,0<y.fX||0<y.fY)l=!0}t=1==g&&t&&t._fast_drawing;for(y=n=0;y<d.fLines.arr.length;++y){var p=
d.fLines.arr[y],z=0<g?Math.round((1-(n-.5)/g)*c):0;switch(p._typename){case "TText":case "TLatex":n++;if(l){var w=p.fX,k=p.fY;w=0<w&&1>w?Math.round(w*a):d.fMargin*a;k=0<k&&1>k?Math.round((1-k)*c):z;z=p.fTextColor?this.getColor(p.fTextColor):"";z||(z=e,this.UseTextColor=!0);var m=b.append("svg:g");this.startTextDrawing(d.fTextFont,(p.fTextSize||d.fTextSize)*q,m);this.drawText({align:p.fTextAlign||d.fTextAlign,x:w,y:k,text:p.fTitle,color:z,latex:"TText"==p._typename?0:1,draw_g:m,fast:t});r.push(this.finishTextDrawing(m))}else h.push(p);
break;case "TLine":case "TBox":w=p.fX1;k=p.fX2;m=p.fY1;var v=p.fY2;0!==w&&(w=Math.round(w*a));k=k?Math.round(k*a):a;m=m?Math.round((1-m)*c):z;v=v?Math.round((1-v)*c):z;"TLine"==p._typename?(p=new JSROOT.TAttLineHandler(p),b.append("svg:line").attr("x1",w).attr("y1",m).attr("x2",k).attr("y2",v).call(p.func)):(p=this.createAttFill(p),b.append("svg:rect").attr("x",w).attr("y",v).attr("width",k-w).attr("height",m-v).call(p.func))}}if(!l){l=c/g;n=d.fMargin*a;y=0;1==g&&0<d.fTextSize&&(y=Math.round(d.fTextSize*
q),3>y&&(y=3));this.startTextDrawing(d.fTextFont,c/(1.2*g),b,y);for(y=0;y<g;++y)p=null,z=h[y],1==g?p={x:0,y:0,width:a,height:c}:(p={x:n,y:y*l,width:a-2*n,height:l},z.fTextColor&&(p.color=this.getColor(z.fTextColor)),z.fTextSize&&(p.font_size=Math.round(z.fTextSize*q))),p.align=d.fTextAlign,p.draw_g=b,p.latex="TText"==z._typename?0:1,p.text=z.fTitle,p.fast=t,p.color||(this.UseTextColor=!0,p.color=e),this.drawText(p);r.push(this.finishTextDrawing(b))}u&&(g=Math.round(.25*a),h=Math.round(.02*-c),a=Math.round(.5*
a),c=Math.round(.04*c),b=b.append("svg:g"),b.append("svg:path").attr("d","M"+g+","+h+"h"+a+"v"+c+"h-"+a+"z").call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawing(d.fTextFont,c/1.5,b),this.drawText({align:22,x:g,y:h,width:a,height:c,text:d.fLabel,color:e,draw_g:b}),r.push(this.finishTextDrawing(b)),this.UseTextColor=!0);return Promise.all(r).then(function(){return f})};x.prototype.format=function(a,c){c||(c="stat");var d=this.getObject();switch(c){case "stat":c=d.fStatFormat||JSROOT.gStyle.fStatFormat;
break;case "fit":c=d.fFitFormat||JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);c="14.7g";break;case "last":c=this.lastformat}a=v.floatToString(a,c||"6.4g",!0);this.lastformat=a[1];return a[0]};x.prototype.drawPaveLegend=function(a,c){function d(a){return!a.fObject&&!a.fOption&&(!a.fLabel||" "==a.fLabel)}var b=this.getObject(),f=b.fPrimitives.arr.length,e=b.fNColumns,g=f;if(2>e)e=1;else for(;(g-1)*e>=f;)g--;if(1==e)for(var h=0;h<f;++h)d(b.fPrimitives.arr[h])&&
g--;1>g&&(g=1);h=this.getColor(b.fTextColor);var t=Math.round(a/e);a=Math.round(.03*a/e);var q=Math.round(.03*c);c=(c-2*q)/g;var l=.9*c,u=0;g=this.getPadPainter();var r=g.getPadHeight(),n=!1,y=-1;b.fTextSize&&2<r*b.fTextSize&&r*b.fTextSize<l&&(l=u=Math.round(r*b.fTextSize));this.startTextDrawing(b.fTextFont,l,this.draw_g,u);for(l=0;l<f;++l)if(u=b.fPrimitives.arr[l],!d(u)){1==e?++y:y=l;r=u.fOption.toLowerCase();var p=y%e,z=(y-p)/e;p*=t;var w=p+Math.round(b.fMargin*t),k=Math.round((p+w)/2),m=Math.round(z*
c+q);z=Math.round((z+.5)*c+q);var v=u,G=u,V=u,C=u.fObject,A=null,x=!1;null!==C&&"object"==typeof C&&("fLineColor"in C&&(V=C),"fFillColor"in C&&(v=C),"fMarkerColor"in C&&(G=C),A=g.findPainterFor(C));-1!=r.indexOf("f")&&(C=A&&A.fillatt?A.fillatt:this.createAttFill(v),v=this.draw_g.append("svg:rect").attr("x",p+a).attr("y",Math.round(m+.1*c)).attr("width",w-2*a-p).attr("height",Math.round(.8*c)).call(C.func),C.empty()||(x=!0),0>r.indexOf("l")&&0>r.indexOf("e")&&0>r.indexOf("p")&&(C=A&&A.lineatt?A.lineatt:
new JSROOT.TAttLineHandler(V),v.call(C.func),"none"!==C.color&&(x=!0)));if(-1!=r.indexOf("l")||-1!=r.indexOf("e"))v=A&&A.lineatt?A.lineatt:new JSROOT.TAttLineHandler(V),this.draw_g.append("svg:line").attr("x1",p+a).attr("y1",z).attr("x2",w-a).attr("y2",z).call(v.func),"none"!==v.color&&(x=!0);-1!=r.indexOf("e")&&(V=A&&A.lineatt?A.lineatt:new JSROOT.TAttLineHandler(V),this.draw_g.append("svg:line").attr("x1",k).attr("y1",Math.round(m+.1*c)).attr("x2",k).attr("y2",Math.round(m+.9*c)).call(V.func),"none"!==
V.color&&(x=!0));-1!=r.indexOf("p")&&(k=A&&A.markeratt?A.markeratt:new JSROOT.TAttMarkerHandler(G),this.draw_g.append("svg:path").attr("d",k.create((p+w)/2,z)).call(k.func),"none"!==k.color&&(x=!0));!x&&A&&A.lineatt&&"none"!==A.lineatt.color&&this.draw_g.append("svg:rect").attr("x",p+a).attr("y",Math.round(m+.1*c)).attr("width",w-2*a-p).attr("height",Math.round(.8*c)).attr("fill","none").call(A.lineatt.func);0<r.length?n=!0:n||(w=p+a);u.fLabel&&this.drawText({align:"start",x:w,y:m,width:p+t-w-a,height:c,
text:u.fLabel,color:h})}return this.finishTextDrawing()};x.prototype.drawPaletteAxis=function(a,c,d){var b=this,f=this.getObject(),e=f.fAxis,g="string"==typeof d&&0<d.indexOf("can_move"),h="string"==typeof d&&0<d.indexOf("postpone"),t=parseInt(this.draw_g.attr("x")),q=parseInt(this.draw_g.attr("y")),l=this.getPadPainter().getPadWidth(),u=this.getPadPainter().getRootPad(!0),r=this.getMainPainter(),n=this.getFramePainter(),y=0,p=100,z=(d=r.fContour)?d.getLevels():null,w=r.fPalette;e.fTickSize=.6*a/
l;d&&n?(y=Math.min(z[0],n.zmin),p=Math.max(z[z.length-1],n.zmax)):void 0!==r.gmaxbin&&void 0!==r.gminbin?(y=r.gminbin,p=r.gmaxbin):void 0!==r.hmin&&void 0!==r.hmax&&(y=r.hmin,p=r.hmax);this.draw_g.selectAll("rect").style("fill","white");this.z_handle.configureAxis("zaxis",y,p,y,p,!0,[0,c],{log:u?u.fLogz:0});if(d&&w&&!h)for(e=0;e<z.length-1;++e){if(h=this.z_handle.gr(z[e]),u=this.z_handle.gr(z[e+1]),r=d.getPaletteColor(w,(z[e]+z[e+1])/2),h=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(u)).attr("width",
a).attr("height",Math.round(h)-Math.round(u)).style("fill",r).style("stroke",r).property("fill0",r).property("fill1",k.rgb(r).darker(.5).toString()),this.isTooltipAllowed()&&h.on("mouseover",function(){k.select(this).transition().duration(100).style("fill",k.select(this).property("fill1"))}).on("mouseout",function(){k.select(this).transition().duration(100).style("fill",k.select(this).property("fill0"))}).append("svg:title").text(z[e].toFixed(2)+" - "+z[e+1].toFixed(2)),JSROOT.settings.Zooming)h.on("dblclick",
function(){return b.getFramePainter().unzoom("z")})}else this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",a).attr("height",c).style("fill","white");this.z_handle.max_tick_size=Math.round(.7*a);return this.z_handle.drawAxis(this.draw_g,a,c,"translate("+a+", 0)").then(function(){if(g&&"getBoundingClientRect"in b.draw_g.node()){var a=b.draw_g.node().getBoundingClientRect();a=t+parseInt(a.width)-Math.round(.995*l)+3;0<a&&(b.draw_g.attr("x",t-a).attr("y",q).attr("transform","translate("+
(t-a)+", "+q+")"),f.fX1NDC-=a/l,f.fX2NDC-=a/l)}return b})};x.prototype.interactivePaletteAxis=function(a,c){var d=this,b=!1,f=0,e=0,g=null,h=function(a){b&&(a.preventDefault(),a=k.pointer(a,d.draw_g.node()),e=Math.min(Math.max(a[1],0),c),g.attr("y",Math.min(f,e)).attr("height",Math.abs(e-f)))},t=function(a){if(b){a.preventDefault();k.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);g.remove();g=null;b=!1;var c=d.z_handle.gr;a=c.invert(f);c=c.invert(e);d.getFramePainter().zoom("z",
Math.min(a,c),Math.max(a,c))}},q=function(c){b||(b=!0,c.preventDefault(),c.stopPropagation(),f=e=k.pointer(c,d.draw_g.node())[1],g=d.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",a).attr("y",f).attr("height",1),k.select(window).on("mousemove.colzoomRect",h).on("mouseup.colzoomRect",t,!0))};if(JSROOT.settings.Zooming)this.draw_g.selectAll(".axis_zoom").on("mousedown",q).on("dblclick",function(){return d.getFramePainter().unzoom("z")});if(JSROOT.settings.ZoomWheel)this.draw_g.on("wheel",
function(a){var b=1-k.pointer(a,d.draw_g.node())[1]/c;a=d.z_handle.analyzeWheelEvent(a,b);a.changed&&d.getFramePainter().zoom("z",a.min,a.max)})};x.prototype.fillContextMenu=function(a){var c=this,d=this.getObject();a.add("header: "+d._typename+"::"+d.fName);if(this.isStats()){var b=function(b,c){var e=10>b?d.fOptStat:d.fOptFit;e=parseInt(parseInt(e)/parseInt(Math.pow(10,b%10)))%10;a.addchk(e,c,100*e+b,function(a){var b=10>a%100?d.fOptStat:d.fOptFit,c=parseInt(a/100);b-=(0<c?c:-1)*parseInt(Math.pow(10,
a%10));10>a%100?(d.fOptStat=b,this.interactiveRedraw(!0,"exec:SetOptStat("+b+")")):(d.fOptFit=b,this.interactiveRedraw(!0,"exec:SetOptFit("+b+")"))})};a.add("Default position",function(){d.fX2NDC=JSROOT.gStyle.fStatX;d.fX1NDC=d.fX2NDC-JSROOT.gStyle.fStatW;d.fY2NDC=JSROOT.gStyle.fStatY;d.fY1NDC=d.fY2NDC-JSROOT.gStyle.fStatH;d.fInit=1;this.interactiveRedraw(!0,"pave_moved")});a.add("SetStatFormat",function(){a.input("Enter StatFormat",d.fStatFormat).then(function(a){a&&(d.fStatFormat=a,c.interactiveRedraw(!0,
'exec:SetStatFormat("'+a+'")'))})});a.add("SetFitFormat",function(){a.input("Enter FitFormat",d.fFitFormat).then(function(a){a&&(d.fFitFormat=a,c.interactiveRedraw(!0,'exec:SetFitFormat("'+a+'")'))})});a.add("separator");a.add("sub:SetOptStat",function(){a.input("Enter OptStat",d.fOptStat,"int").then(function(a){d.fOptStat=a;c.interactiveRedraw(!0,"exec:SetOptStat("+a)})});b(0,"Histogram name");b(1,"Entries");b(2,"Mean");b(3,"Std Dev");b(4,"Underflow");b(5,"Overflow");b(6,"Integral");b(7,"Skewness");
b(8,"Kurtosis");a.add("endsub:");a.add("sub:SetOptFit",function(){a.input("Enter OptStat",d.fOptFit,"int").then(function(a){d.fOptFit=a;c.interactiveRedraw(!0,"exec:SetOptFit("+a+")")})});b(10,"Fit parameters");b(11,"Par errors");b(12,"Chi square / NDF");b(13,"Probability");a.add("endsub:");a.add("separator")}else"title"===d.fName&&a.add("Default position",function(){d.fX1NDC=.28;d.fY1NDC=.94;d.fX2NDC=.72;d.fY2NDC=.99;d.fInit=1;this.interactiveRedraw(!0,"pave_moved")});this.UseTextColor&&a.addTextAttributesMenu(this);
a.addAttributesMenu(this);0<a.size()&&a.add("Inspect",this.showInspector);return 0<a.size()};x.prototype.paveContextMenu=function(a){var c=this;if(this.z_handle){var d=this.getFramePainter();d&&d.showContextMenu&&d.showContextMenu("z",a)}else a.stopPropagation(),a.preventDefault(),v.createMenu(a,this).then(function(a){c.fillContextMenu(a);return c.fillObjectExecMenu(a,"title")}).then(function(a){return a.show()})};x.prototype.isStats=function(){return this.matchObjectType("TPaveStats")};x.prototype.clearPave=
function(){this.getObject().Clear()};x.prototype.addText=function(a){this.getObject().AddText(a)};x.prototype.fillFunctionStat=function(a,c){if(!c||!a)return!1;var d=c%10,b=Math.floor(c/10)%10,f=Math.floor(c/1E3)%10;0<Math.floor(c/100)%10&&this.addText("#chi^2 / ndf = "+this.format(a.fChisquare,"fit")+" / "+a.fNDF);0<f&&this.addText("Prob = "+("Math"in JSROOT?this.format(JSROOT.Math.Prob(a.fChisquare,a.fNDF)):"<not avail>"));if(0<d)for(c=0;c<a.GetNumPars();++c){d=a.GetParName(c);f=a.GetParValue(c);
var e=a.GetParError(c);f=void 0===f?"<not avail>":this.format(Number(f),"fit");void 0!==e&&(e=this.format(e,"last"),0===Number(e)&&0!=a.GetParError(c)&&(e=this.format(a.GetParError(c),"4.2g")));0<b&&e?this.addText(d+" = "+f+" #pm "+e):this.addText(d+" = "+f)}return!0};x.prototype.fillStatistic=function(){var a=this.getPadPainter();if(a&&a._fast_drawing)return!1;a=this.getObject();var c=a.$main_painter||this.getMainPainter();if("stats"!==a.fName||!c||"function"!==typeof c.fillStatistic)return!1;var d=
parseInt(a.fOptStat),b=parseInt(a.fOptFit);Number.isInteger(d)||(d=JSROOT.gStyle.fOptStat);Number.isInteger(b)||(b=JSROOT.gStyle.fOptFit);if(!c.fillStatistic(this,d,b))return!1;c=a.fLines.arr.length;d=c*JSROOT.gStyle.StatFontSize;if(0>=d||3===JSROOT.gStyle.StatFont%10)d=.25*c*JSROOT.gStyle.StatH,a.fY1NDC=a.fY2NDC-d;return!0};x.prototype.isDummyPos=function(a){return a?!a.fInit&&!a.fX1&&!a.fX2&&!a.fY1&&!a.fY2&&!a.fX1NDC&&!a.fX2NDC&&!a.fY1NDC&&!a.fY2NDC:!0};x.prototype.updateObject=function(a){if(!this.matchObjectType(a))return!1;
var c=this.getObject();c.modified_NDC||this.isDummyPos(a)||(this.stored&&!a.fInit&&this.stored.fX1==a.fX1&&this.stored.fX2==a.fX2&&this.stored.fY1==a.fY1&&this.stored.fY2==a.fY2?(this.stored.fX1NDC!=a.fX1NDC&&(c.fX1NDC=a.fX1NDC),this.stored.fX2NDC!=a.fX2NDC&&(c.fX2NDC=a.fX2NDC),this.stored.fY1NDC!=a.fY1NDC&&(c.fY1NDC=a.fY1NDC),this.stored.fY2NDC!=a.fY2NDC&&(c.fY2NDC=a.fY2NDC)):(c.fInit=a.fInit,c.fX1=a.fX1,c.fX2=a.fX2,c.fY1=a.fY1,c.fY2=a.fY2,c.fX1NDC=a.fX1NDC,c.fX2NDC=a.fX2NDC,c.fY1NDC=a.fY1NDC,c.fY2NDC=
a.fY2NDC),this.stored=JSROOT.extend({},a));c.fOption=a.fOption;c.fBorderSize=a.fBorderSize;switch(a._typename){case "TPaveText":return c.fLines=JSROOT.clone(a.fLines),!0;case "TPavesText":return c.fLines=JSROOT.clone(a.fLines),c.fNpaves=a.fNpaves,!0;case "TPaveLabel":return c.fLabel=a.fLabel,!0;case "TPaveStats":return c.fOptStat=a.fOptStat,c.fOptFit=a.fOptFit,!0;case "TLegend":var d=c.fPrimitives;c.fPrimitives=a.fPrimitives;c.fNColumns=a.fNColumns;if(d&&d.arr&&c.fPrimitives&&c.fPrimitives.arr&&d.arr.length==
c.fPrimitives.arr.length)for(a=0;a<d.arr.length;++a){var b=d.arr[a].fObject,f=c.fPrimitives.arr[a].fObject;b&&f&&b._typename==f._typename&&b.fName==f.fName&&(c.fPrimitives.arr[a].fObject=b)}return!0;case "TPaletteAxis":return c.fBorderSize=1,c.fShadowColor=0,!0}return!1};x.prototype.redraw=function(){return this.drawPave()};x.prototype.cleanup=function(){this.z_handle&&(this.z_handle.cleanup(),delete this.z_handle);JSROOT.ObjectPainter.prototype.cleanup.call(this)};var R=function(a,c,d){var b=new JSROOT.TPavePainter(a,
c);return v.ensureTCanvas(b,!1).then(function(){if("title"===c.fName&&"TPaveText"===c._typename){var f=b.getPadPainter().findPainterFor(null,"title");if(f&&f!==b)f.removeFromPadPrimitives(),f.cleanup();else if("postitle"==d||b.isDummyPos(c)){var e=JSROOT.gStyle;f=b.getFramePainter();if(e&&f){var g=e.fTitleX,h=e.fTitleY,t=e.fTitleW;(e=e.fTitleH)||(e=.7*(h-f.fY2NDC));t||(t=f.fX2NDC-f.fX1NDC);if(!Number.isFinite(e)||0>=e)e=.06;if(!Number.isFinite(t)||0>=t)t=.44;c.fX1NDC=g-t/2;c.fY1NDC=h-e;c.fX2NDC=g+
t/2;c.fY2NDC=h;c.fInit=1}}}else"TPaletteAxis"===c._typename&&(c.fBorderSize=1,c.fShadowColor=0,c.fAxis&&(c.fAxis.fChopt||(c.fAxis.fChopt="+"),c.fAxis.fNdiv||(c.fAxis.fNdiv=12),c.fAxis.fLabelOffset||(c.fAxis.fLabelOffset=.005)),b.z_handle=new JSROOT.TAxisPainter(a,c.fAxis,!0),b.z_handle.setPadName(b.getPadName()),b.UseContextMenu=!0);switch(c._typename){case "TPaveLabel":b.paveDrawFunc=b.drawPaveLabel;break;case "TPaveStats":b.paveDrawFunc=b.drawPaveStats;b.$secondary=!0;break;case "TPaveText":case "TPavesText":case "TDiamond":b.paveDrawFunc=
b.drawPaveText;break;case "TLegend":b.paveDrawFunc=b.drawPaveLegend;break;case "TPaletteAxis":b.paveDrawFunc=b.drawPaletteAxis}return b.drawPave(d)})};B.prototype.reset=function(){JSROOT.extend(this,{Axis:0,RevX:!1,RevY:!1,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:!1,
Pie:!1,List:!1,Zscale:!1,PadPalette:!1,Candle:"",GLBox:0,GLColor:!1,Project:"",System:v.Coord.kCARTESIAN,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:JSROOT.settings.OptimizeDraw,Mode3D:!1,Render3D:JSROOT.constants.Render3D.Default,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,minimum:-1111,maximum:-1111,ymin:0,ymax:0})};B.prototype.decode=function(a,c,d,b,f){this.orginal=a;var e=new JSROOT.DrawOptions(a);
a="";if(1===c&&0<d.fSumw2.length)for(var g=0;g<d.fSumw2.length;++g)if(0<d.fSumw2[g]){this.Error=!0;this.Zero=this.Hist=!1;break}this.ndim=c||1;this.PadStats=e.check("USE_PAD_STATS");this.PadPalette=e.check("USE_PAD_PALETTE");this.PadTitle=e.check("USE_PAD_TITLE");e.check("PAL",!0)&&(this.Palette=e.partAsInt());e.check("MINIMUM:",!0)?this.minimum=parseFloat(e.part):this.minimum=d.fMinimum;e.check("MAXIMUM:",!0)?this.maximum=parseFloat(e.part):this.maximum=d.fMaximum;e.check("YMIN:",!0)&&(this.ymin=
parseFloat(e.part));e.check("YMAX:",!0)&&(this.ymax=parseFloat(e.part));e.check("NOOPTIMIZE")&&(this.Optimize=0);e.check("OPTIMIZE")&&(this.Optimize=2);e.check("AUTOCOL")&&(this.AutoColor=!0);e.check("AUTOZOOM")&&(this.AutoZoom=!0);e.check("OPTSTAT",!0)&&(this.optstat=e.partAsInt());e.check("OPTFIT",!0)&&(this.optfit=e.partAsInt());e.check("NOSTAT")&&(this.NoStat=!0);e.check("STAT")&&(this.ForceStat=!0);e.check("NOTOOLTIP")&&f&&f.setTooltipAllowed(!1);e.check("TOOLTIP")&&f&&f.setTooltipAllowed(!0);
g=f=!1;e.check("LOGXY")&&(f=g=!0);e.check("LOGX")&&(f=!0);e.check("LOGY")&&(g=!0);f&&b&&(b.fLogx=1,b.fUxmin=0,b.fUxmax=1,b.fX1=0,b.fX2=1);g&&b&&(b.fLogy=1,b.fUymin=0,b.fUymax=1,b.fY1=0,b.fY2=1);e.check("LOGZ")&&b&&(b.fLogz=1);e.check("GRIDXY")&&b&&(b.fGridx=b.fGridy=1);e.check("GRIDX")&&b&&(b.fGridx=1);e.check("GRIDY")&&b&&(b.fGridy=1);e.check("TICKXY")&&b&&(b.fTickx=b.fTicky=1);e.check("TICKX")&&b&&(b.fTickx=1);e.check("TICKY")&&b&&(b.fTicky=1);if(e.check("FILL_",!0))if(0<e.partAsInt(1))this.histoFillColor=
e.partAsInt();else for(f=0;8>f;++f)v.getColor(f).toUpperCase()===e.part&&(this.histoFillColor=f);if(e.check("LINE_",!0))if(0<e.partAsInt(1))this.histoLineColor=v.root_colors[e.partAsInt()];else for(f=0;8>f;++f)v.getColor(f).toUpperCase()===e.part&&(this.histoLineColor=e.part);e.check("X+")&&(this.AxisPos=10);e.check("Y+")&&(this.AxisPos+=1);e.check("SAMES")&&(this.ForceStat=this.Same=!0);e.check("SAME")&&(this.Func=this.Same=!0);e.check("SPEC")&&(this.Spec=!0);e.check("BASE0")||e.check("MIN0")?this.BaseLine=
0:JSROOT.gStyle.fHistMinimumZero&&(this.BaseLine=0);e.check("PIE")&&(this.Pie=!0);e.check("CANDLE",!0)&&(this.Candle=e.part);e.check("GLBOX",!0)&&(this.GLBox=10+e.partAsInt());e.check("GLCOL")&&(this.GLColor=!0);e.check("GL");e.check("LEGO",!0)&&(this.Lego=1,0<=e.part.indexOf("0")&&(this.Zero=!1),0<=e.part.indexOf("1")&&(this.Lego=11),0<=e.part.indexOf("2")&&(this.Lego=12),0<=e.part.indexOf("3")&&(this.Lego=13),0<=e.part.indexOf("4")&&(this.Lego=14),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));
e.check("R3D_",!0)&&(this.Render3D=JSROOT.constants.Render3D.fromString(e.part.toLowerCase()));e.check("SURF",!0)&&(this.Surf=e.partAsInt(10,1),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));e.check("TF3",!0)&&(a=e.part);e.check("ISO",!0)&&(a=e.part);e.check("LIST")&&(this.List=!0);e.check("CONT",!0)&&1<c&&(this.Contour=1,0<=e.part.indexOf("Z")&&(this.Zscale=!0),0<=e.part.indexOf("1")?this.Contour=11:0<=e.part.indexOf("2")?this.Contour=12:0<=e.part.indexOf("3")?this.Contour=13:0<=e.part.indexOf("4")&&
(this.Contour=14));e.check("HBAR",!0)?this.BarStyle=20:e.check("BAR",!0)&&(this.BarStyle=10);0<this.BarStyle&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=e.partAsInt());e.check("ARR")&&(this.Arrow=!0);e.check("BOX",!0)&&(this.BoxStyle=10+e.partAsInt());this.Box=0<this.BoxStyle;e.check("COL")&&(this.Color=!0);e.check("CHAR")&&(this.Char=1);e.check("FUNC")&&(this.Func=!0,this.Hist=!1);e.check("AXIS")&&(this.Axis=1);e.check("AXIG")&&(this.Axis=2);e.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,
this.TextAngle=Math.min(e.partAsInt(),90),0<=e.part.indexOf("N")&&(this.TextKind="N"),0<=e.part.indexOf("E0")&&(this.TextLine=!0),0<=e.part.indexOf("E")&&(this.TextKind="E"));e.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(e.part),!Number.isFinite(this.ScatCoef)||0>=this.ScatCoef)&&(this.ScatCoef=1);e.check("SCAT")&&(this.Scat=!0);e.check("POL")&&(this.System=v.Coord.kPOLAR);e.check("CYL")&&(this.System=v.Coord.kCYLINDRICAL);e.check("SPH")&&(this.System=v.Coord.kSPHERICAL);e.check("PSR")&&
(this.System=v.Coord.kRAPIDITY);e.check("TRI",!0)&&(this.Color=!1,this.Tri=1,a=e.part,0<=e.part.indexOf("ERR")&&(this.Error=!0));e.check("AITOFF")&&(this.Proj=1);e.check("MERCATOR")&&(this.Proj=2);e.check("SINUSOIDAL")&&(this.Proj=3);e.check("PARABOLIC")&&(this.Proj=4);0<this.Proj&&(this.Contour=14);e.check("PROJX",!0)&&(this.Project="X"+e.partAsInt(0,1));e.check("PROJY",!0)&&(this.Project="Y"+e.partAsInt(0,1));a&&(0<=a.indexOf("FB")&&(this.FrontBox=!1),0<=a.indexOf("BB")&&(this.BackBox=!1));3==c&&
e.check("FB")&&(this.FrontBox=!1);3==c&&e.check("BB")&&(this.BackBox=!1);this._pfc=e.check("PFC");this._plc=e.check("PLC")||this.AutoColor;this._pmc=e.check("PMC");e.check("L")&&(this.Line=!0,this.Error=this.Hist=!1);e.check("F")&&(this.need_fillcol=this.Fill=!0);e.check("A")&&(this.Axis=-1);if(e.check("RX")||b&&b.$RX)this.RevX=!0;if(e.check("RY")||b&&b.$RY)this.RevY=!0;a=function(a,c,f){var g=e.check(a);b&&b["$"+a]&&(g=!0,b["$"+a]=void 0);g&&d&&(d[c].TestBit(f)||d[c].InvertBit(f))};a("OTX","fXaxis",
JSROOT.EAxisBits.kOppositeTitle);a("OTY","fYaxis",JSROOT.EAxisBits.kOppositeTitle);a("CTX","fXaxis",JSROOT.EAxisBits.kCenterTitle);a("CTY","fYaxis",JSROOT.EAxisBits.kCenterTitle);e.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0);e.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0);e.check("C")&&(this.Curve=!0,this.Hist=!1);e.check("][")&&(this.Off=1,this.Hist=!0);e.check("HIST")&&(this.Func=this.Hist=!0,this.Error=!1);this.Bar=0<this.BarStyle;delete this.MarkStyle;
e.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0);e.check("P")&&(this.Mark=!0,this.Zero=this.Hist=!1);e.check("Z")&&(this.Zscale=!0);e.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1);e.check("H")&&(this.Hist=!0);if(e.check("E",!0)&&(this.Error=!0,1==c)){this.Hist=this.Zero=!1;Number.isInteger(parseInt(e.part[0]))&&(this.ErrorKind=parseInt(e.part[0]));if(3===this.ErrorKind||4===this.ErrorKind)this.need_fillcol=!0;0===this.ErrorKind&&(this.Zero=!0);0<=e.part.indexOf("X0")&&(this.errorX=
0)}e.check("9")&&(this.HighRes=1);e.check("0")&&(this.Zero=!1);this.Color&&e.check("1")&&(this.Zero=!1);if(0<this.Lego||3==c||0<this.Surf||this.Error&&2==c)this.Mode3D=!0};B.prototype.asString=function(){var a="";this.Mode3D?(this.Lego?(a="LEGO",this.Zero||(a+="0"),10<this.Lego&&(a+=this.Lego-10),this.Zscale&&(a+="Z")):this.Surf&&(a="SURF"+(this.Surf-10),this.Zscale&&(a+="Z")),this.FrontBox||(a+="FB"),this.BackBox||(a+="BB")):(this.Scat?a="SCAT":this.Color?(a="COL",this.Zero||(a+="0"),this.Zscale&&
(a+="Z"),0>this.Axis&&(a+="A")):this.Contour?(a="CONT",10<this.Contour&&(a+=this.Contour-10),this.Zscale&&(a+="Z")):this.Bar?a=!1===this.BaseLine?"B":"B1":this.Mark?a=this.Zero?"P0":"P":this.Error?(a="E",0<=this.ErrorKind&&(a+=this.ErrorKind)):this.Line&&(a+="L",this.Fill&&(a+="F")),this.Text&&(a+="TEXT",this.TextAngle&&(a+=this.TextAngle),a+=this.TextKind));return a};I.prototype.getLevels=function(){return this.arr};I.prototype.createNormal=function(a,c,d){if(c){0>=this.colzmax&&(this.colzmax=1);
0>=this.colzmin&&(this.colzmin=void 0===d||0>=d?1E-4*this.colzmax:3>d||100<d?.3*d:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);c=Math.log(this.colzmin)/Math.log(10);d=(Math.log(this.colzmax)/Math.log(10)-c)/a;this.arr.push(this.colzmin);for(var b=1;b<a;b++)this.arr.push(Math.exp((c+d*b)*Math.log(10)));this.arr.push(this.colzmax);this.custom=!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin)),
c=(this.colzmax-this.colzmin)/a,d=0;d<=a;d++)this.arr.push(this.colzmin+c*d)};I.prototype.createCustom=function(a){this.custom=!0;for(var c=0;c<a.length;++c)this.arr.push(a[c]);this.colzmax>this.arr[this.arr.length-1]&&this.arr.push(this.colzmax)};I.prototype.configIndicies=function(a,c){this.below_min_indx=a;this.exact_min_indx=c};I.prototype.getContourIndex=function(a){if(this.custom){var c=0,d=this.arr.length-1;if(a<this.arr[0])return-1;if(a>=this.arr[d])return d;for(;c<d-1;){var b=Math.round((c+
d)/2);this.arr[b]>a?d=b:c=b}return c}return a<this.colzmin?this.below_min_indx:a===this.colzmin?this.exact_min_indx:Math.floor(.01+(a-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin))};I.prototype.getPaletteColor=function(a,c){c=this.getContourIndex(c);if(0>c)return null;c=a.calcColorIndex(c,this.arr.length);return a.getColor(c)};I.prototype.getPaletteIndex=function(a,c){c=this.getContourIndex(c);return 0>c?null:a.calcColorIndex(c,this.arr.length)};var K={kNoStats:JSROOT.BIT(9),kUserContour:JSROOT.BIT(10),
kCanRebin:JSROOT.BIT(11),kLogX:JSROOT.BIT(15),kIsZoomed:JSROOT.BIT(16),kNoTitle:JSROOT.BIT(17),kIsAverage:JSROOT.BIT(18)};m.prototype=Object.create(JSROOT.ObjectPainter.prototype);m.prototype.getHisto=function(){return this.getObject()};m.prototype.getAxis=function(a){var c=this.getObject();if(c)switch(a){case "x":return c.fXaxis;case "y":return c.fYaxis;case "z":return c.fZaxis}return null};m.prototype.isTProfile=function(){return this.matchObjectType("TProfile")};m.prototype.isTH1K=function(){return this.matchObjectType("TH1K")};
m.prototype.isTH2Poly=function(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)};m.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};m.prototype.cleanup=function(){this.clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};m.prototype.getDimension=function(){var a=this.getHisto();return a?a._typename.match(/^TH2/)||
a._typename.match(/^TProfile2D/)?2:a._typename.match(/^TH3/)?3:this.isTH2Poly()?2:1:0};m.prototype.decodeOptions=function(a){var c=this.getHisto(),d=this.getDimension(),b=this.getPadPainter();b=b?b.getRootPad(!0):null;this.options?this.options.reset():this.options=new B;this.options.decode(a||c.fOption,d,c,b,this);this.storeDrawOpt(a)};m.prototype.copyOptionsFrom=function(a){if(a!==this){var c=this.options;a=a.options;c.Mode3D=a.Mode3D;c.Zero=a.Zero;a.Mode3D?(c.Lego=a.Lego,c.Surf=a.Surf):(c.Color=
a.Color,c.Contour=a.Contour)}};m.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(c){c!==a&&"function"==typeof c.copyOptionsFrom&&c.copyOptionsFrom(a)},"objects")};m.prototype.scanContent=function(){};m.prototype.checkPadRange=function(a){this.isMainPainter()&&(this.check_pad_range=a?"pad_range":!0)};m.prototype.createAutoColor=function(a){if(!a){var c=this.getPadPainter().getRootPad(!0);a=c&&c.fPrimitves?c.fPrimitves.arr.length:5}var d=this._auto_color||0;this._auto_color=
d+1;if(c=this.getHistPalette())return 2>a&&(a=2),d>=a&&(d=a-1),a=Math.round(d*(c.getLength()-3)/(a-1)),c=c.getColor(a),this.addColor(c);this._auto_color%=8;return d+2};m.prototype.createHistDrawAttributes=function(){var a=this.getHisto();if(this.options._pfc||this.options._plc||this.options._pmc){var c=this.getMainPainter();c&&c.createAutoColor&&(c=c.createAutoColor(),this.options._pfc&&(a.fFillColor=c,delete this.fillatt),this.options._plc&&(a.fLineColor=c,delete this.lineatt),this.options._pmc&&
(a.fMarkerColor=c,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1)}this.createAttFill({attr:a,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:a,color0:this.options.histoLineColor})};m.prototype.updateObject=function(a,c){var d=this.getHisto(),b=this.getFramePainter(),f=this.getPadPainter();if(a!==d){var e=function(a,b){a.fTitle=b.fTitle;a.fLabels=b.fLabels;a.fXmin=b.fXmin;a.fXmax=b.fXmax;a.fTimeDisplay=b.fTimeDisplay;a.fTimeFormat=b.fTimeFormat;
a.fAxisColor=b.fAxisColor;a.fLabelColor=b.fLabelColor;a.fLabelFont=b.fLabelFont;a.fLabelOffset=b.fLabelOffset;a.fLabelSize=b.fLabelSize;a.fNdivisions=b.fNdivisions;a.fTickLength=b.fTickLength;a.fTitleColor=b.fTitleColor;a.fTitleFont=b.fTitleFont;a.fTitleOffset=b.fTitleOffset;a.fTitleSize=b.fTitleSize};if(!this.matchObjectType(a))return!1;var g=f?f.findPainterFor(this.findStat()):null;d.TestBit(K.kNoStats)!=a.TestBit(K.kNoStats)&&(d.fBits=a.fBits,g&&(g.Enabled=!d.TestBit(K.kNoStats)));void 0!==this.snapid&&
(d.fName=a.fName);d.fFillColor=a.fFillColor;d.fFillStyle=a.fFillStyle;d.fLineColor=a.fLineColor;d.fLineStyle=a.fLineStyle;d.fLineWidth=a.fLineWidth;d.fEntries=a.fEntries;d.fTsumw=a.fTsumw;d.fTsumwx=a.fTsumwx;d.fTsumwx2=a.fTsumwx2;d.fXaxis.fNbins=a.fXaxis.fNbins;1<this.getDimension()&&(d.fTsumwy=a.fTsumwy,d.fTsumwy2=a.fTsumwy2,d.fTsumwxy=a.fTsumwxy,d.fYaxis.fNbins=a.fYaxis.fNbins,2<this.getDimension()&&(d.fTsumwz=a.fTsumwz,d.fTsumwz2=a.fTsumwz2,d.fTsumwxz=a.fTsumwxz,d.fTsumwyz=a.fTsumwyz,d.fZaxis.fNbins=
a.fZaxis.fNbins));d.fArray=a.fArray;d.fNcells=a.fNcells;d.fTitle=a.fTitle;d.fMinimum=a.fMinimum;d.fMaximum=a.fMaximum;e(d.fXaxis,a.fXaxis);e(d.fYaxis,a.fYaxis);e(d.fZaxis,a.fZaxis);this.snapid&&(e=function(a,c,d){b&&b.zoomChangedInteractive(d)||(a.fFirst=c.fFirst,a.fLast=c.fLast,a.fBits=c.fBits)},e(d.fXaxis,a.fXaxis,"x"),e(d.fYaxis,a.fYaxis,"y"),e(d.fZaxis,a.fZaxis,"z"));d.fSumw2=a.fSumw2;this.isTProfile()?d.fBinEntries=a.fBinEntries:this.isTH1K()?(d.fNIn=a.fNIn,d.fReady=!1):this.isTH2Poly()&&(d.fBins=
a.fBins);if(this.options.Func){var h=[];e=[];var t=this.hist_painter_id;f&&f.forEachPainterInPad(function(a){a.child_painter_id===t&&h.push(a)},"objects");if(a.fFunctions)for(var q=0;q<a.fFunctions.arr.length;++q){var l=a.fFunctions.arr[q];if(l&&l._typename&&this.needDrawFunc(d,l)){for(var u=null,r=-1,n=0;n<h.length;++n)if(h[n].matchObjectType(l._typename)&&h[n].getObject().fName===l.fName){u=h[n];r=n;break}!u&&l.fName&&(u=f?f.findPainterFor(null,l.fName,l._typename):null);u?(u.updateObject(l),0<=
r&&h.splice(r,1)):e.push(l)}}g&&(g=h.indexOf(g),0<=g&&h.splice(g,1));f&&0<h.length&&f.cleanPrimitives(function(a){return 0<=h.indexOf(a)});if(f&&0<e.length){g=[];var y=f.has_canvas?f.selectCurrentPad(f.this_pad_name):void 0;for(q=0;q<e.length;++q)g.push(JSROOT.draw(this.getDom(),e[q]));Promise.all(g).then(function(a){for(var b=0;b<a.length;++b)a[b]&&(a[b].child_painter_id=t);f.selectCurrentPad(y)})}}e=d.fOption!=a.fOption;d.fOption=a.fOption;(void 0!==c&&this.options.original!==c||e)&&this.decodeOptions(c||
d.fOption)}!this.snapid&&b&&b.zoomChangedInteractive()||this.checkPadRange();this.scanContent();return this.histogram_updated=!0};m.prototype.extractAxesProperties=function(a){function c(a){a.fXbins.length>=a.fNbins?(a.regular=!1,a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fXmin;if(b>this.fNbins)return this.fXmax;if(b==a)return this.fXbins[b];var c=a<b?b-1:b+1;return this.fXbins[b]*Math.abs(a-c)+this.fXbins[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fXbins.length;++c)if(a<
this.fXbins[c])return Math.floor(c-1+b);return this.fNbins}):(a.regular=!0,a.binwidth=(a.fXmax-a.fXmin)/(a.fNbins||1),a.GetBinCoord=function(a){return this.fXmin+a*this.binwidth},a.FindBin=function(a,b){return Math.floor((a-this.fXmin)/this.binwidth+b)})}this.nbinsx=this.nbinsy=this.nbinsz=0;var d=this.getHisto();this.nbinsx=d.fXaxis.fNbins;this.xmin=d.fXaxis.fXmin;this.xmax=d.fXaxis.fXmax;c(d.fXaxis);this.ymin=d.fYaxis.fXmin;this.ymax=d.fYaxis.fXmax;1<a&&(this.nbinsy=d.fYaxis.fNbins,c(d.fYaxis));
2<a&&(this.nbinsz=d.fZaxis.fNbins,this.zmin=d.fZaxis.fXmin,this.zmax=d.fZaxis.fXmax,c(d.fZaxis))};m.prototype.drawAxes=function(){if(!this.isMainPainter())return Promise.resolve(!1);var a=this.getFramePainter();if(!a)return Promise.resolve(!1);var c=this.getHisto();this.ymin===this.ymax&&(this.ymax+=1);a.setAxesRanges(c.fXaxis,this.xmin,this.xmax,c.fYaxis,this.ymin,this.ymax,c.fZaxis,0,0);a.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,
ymin_nz:this.ymin_nz,swap_xy:20<=this.options.BarStyle,reverse_x:this.options.RevX,reverse_y:this.options.RevY,Proj:this.options.Proj,extra_y_space:this.options.Text&&0<this.options.BarStyle});delete this.check_pad_range;return this.options.Same?Promise.resolve(!1):a.drawAxes(!1,0>this.options.Axis,0>this.options.Axis,this.options.AxisPos,this.options.Zscale)};m.prototype.toggleTitle=function(a){var c=this.getHisto();if(!this.isMainPainter()||!c)return!1;if("only-check"===a)return!c.TestBit(K.kNoTitle);
c.InvertBit(K.kNoTitle);this.drawHistTitle()};m.prototype.drawHistTitle=function(){var a=this;if(!this.isMainPainter()||this.options.Same)return Promise.resolve(!0);var c=this.getHisto(),d=JSROOT.gStyle,b=this.getPadPainter(),f=b?b.findPainterFor(null,"title"):null,e=f?f.getObject():null;!e&&b&&b.findInPrimitives&&(e=b.findInPrimitives("title"));e&&"TPaveText"!==e._typename&&(e=null);b=!c.TestBit(K.kNoTitle)&&0<d.fOptTitle;if(e)e.Clear(),b&&e.AddText(c.fTitle),f&&f.redraw();else if(b&&!f&&c.fTitle&&
!this.options.PadTitle)return e=JSROOT.create("TPaveText"),e.fName="title",e.fTextFont=d.fTitleFont,e.fTextSize=d.fTitleFontSize,e.fTextColor=d.fTitleTextColor,e.fTextAlign=d.fTitleAlign,e.fFillColor=d.fTitleColor,e.fFillStyle=d.fTitleStyle,e.fBorderSize=d.fTitleBorderSize,e.AddText(c.fTitle),R(this.getDom(),e,"postitle").then(function(b){b&&(b.$secondary=!0);return a});return Promise.resolve(this)};m.prototype.processTitleChange=function(a){var c=this.getHisto(),d=this.getPadPainter();d=d?d.findPainterFor(null,
"title"):null;if(!c||!d)return null;if("check"===a)return!this.isMainPainter()||this.options.Same?null:c;d.clearPave();d.addText(c.fTitle);d.redraw();this.submitCanvExec('SetTitle("'+c.fTitle+'")')};m.prototype.updateStatWebCanvas=function(){if(this.snapid){var a=this.findStat(),c=this.getPadPainter();(a=c?c.findPainterFor(a):null)&&!a.snapid&&a.redraw()}};m.prototype.findStat=function(){if(this.options.PadStats){var a=this.getPadPainter();return(a=a?a.findPainterFor(null,"stats","TPaveStats"):null)?
a.getObject():null}return this.findFunction("TPaveStats","stats")};m.prototype.toggleStat=function(a){var c=this,d=this.findStat(),b=this.getPadPainter(),f=null;a||(a="");if(d)f=b?b.findPainterFor(d):null;else{if(0<a.indexOf("-check"))return!1;d=this.createStat(!0)}if("only-check"==a)return f?f.Enabled:!1;if("fitpar-check"==a)return d?d.fOptFit:!1;if("fitpar-toggle"==a){if(!d)return!1;d.fOptFit=d.fOptFit?0:1111;f&&f.redraw();return!0}if(f)return f.Enabled=!f.Enabled,f.redraw(),f.Enabled;var e=this.selectCurrentPad(this.getPadName());
JSROOT.draw(this.getDom(),d).then(function(){c.selectCurrentPad(e)});return!0};m.prototype.isIgnoreStatsFill=function(){return!this.getObject()||!this.draw_content&&!this.create_stats||0<this.options.Axis};m.prototype.createStat=function(a){var c=this.getHisto();if(this.options.PadStats||!c||!(a||this.options.ForceStat||!this.options.NoStat&&!c.TestBit(K.kNoStats)&&JSROOT.settings.AutoStat&&this.draw_content&&this.isMainPainter()))return null;a=this.findStat();var d=JSROOT.gStyle,b=this.options.optstat,
f=this.options.optfit;void 0!==b?(a&&(a.fOptStat=b),delete this.options.optstat):b=c.$custom_stat||d.fOptStat;void 0!==f?(a&&(a.fOptFit=f),delete this.options.optfit):f=d.fOptFit;if(!a&&!b&&!f)return null;this.create_stats=!0;if(a)return a;a=JSROOT.create("TPaveStats");JSROOT.extend(a,{fName:"stats",fOptStat:b,fOptFit:f,fBorderSize:1});a.fX1NDC=d.fStatX-d.fStatW;a.fY1NDC=d.fStatY-d.fStatH;a.fX2NDC=d.fStatX;a.fY2NDC=d.fStatY;a.fFillColor=d.fStatColor;a.fFillStyle=d.fStatStyle;a.fTextAngle=0;a.fTextSize=
d.fStatFontSize;a.fTextAlign=12;a.fTextColor=d.fStatTextColor;a.fTextFont=d.fStatFont;if(c._typename.match(/^TProfile/)||c._typename.match(/^TH2/))a.fY1NDC=.67;a.AddText(c.fName);this.addFunction(a);return a};m.prototype.findFunction=function(a,c){var d=this.getHisto();d=d&&d.fFunctions?d.fFunctions.arr:null;if(!d)return null;for(var b=0;b<d.length;++b)if((!c||d[b].fName===c)&&d[b]._typename===a)return d[b];return null};m.prototype.addFunction=function(a,c){var d=this.getHisto();d&&a&&(d.fFunctions||
(d.fFunctions=JSROOT.create("TList")),c?d.fFunctions.AddFirst(a):d.fFunctions.Add(a))};m.prototype.needDrawFunc=function(a,c){return"TPaveText"===c._typename||"TPaveStats"===c._typename?!a.TestBit(K.kNoStats)&&!this.options.NoStat:"TF1"===c._typename?!c.TestBit(JSROOT.BIT(9)):"TPaletteAxis"!==c._typename};m.prototype.drawNextFunction=function(a){var c=this,d=this.getHisto();if(!this.options.Func||!d.fFunctions||a>=d.fFunctions.arr.length)return Promise.resolve(!0);var b=d.fFunctions.arr[a],f=d.fFunctions.opt[a],
e=this.getPadPainter(),g=!1;null===(e?e.findPainterFor(b):null)&&b&&(g=this.needDrawFunc(d,b));if(!g)return this.drawNextFunction(a+1);b.$histo=d;return JSROOT.draw(this.getDom(),b,f).then(function(b){b&&"object"==typeof b&&(b.child_painter_id=c.hist_painter_id);return c.drawNextFunction(a+1)})};m.prototype.getSelectIndex=function(a,c,d){var b=this.getFramePainter(),f=this["nbins"+a]||0,e=this.getAxis(a),g=b?b["zoom_"+a+"min"]:0;a=b?b["zoom_"+a+"max"]:0;g!==a&&e?(d="left"==c?e.FindBin(g,d||0):e.FindBin(a,
(d||0)+.5),0>d?d=0:d>f&&(d=f)):d="left"==c?0:f;e&&(e.fFirst===e.fLast||!e.TestBit(JSROOT.EAxisBits.kAxisRange)||1>=e.fFirst&&e.fLast>=f)&&(e=void 0);"left"==c?(0>d&&(d=0),e&&1<e.fFirst&&d<e.fFirst&&(d=e.fFirst-1)):(d>f&&(d=f),e&&e.fLast<=f&&d>e.fLast&&(d=e.fLast));return d};m.prototype.unzoomUserRange=function(a,c,d){var b=this,f=!1,e=this.getHisto();if(!e)return!1;var g=function(a){if(!a||!a.TestBit(JSROOT.EAxisBits.kAxisRange)||a.fFirst===a.fLast||1>=a.fFirst&&a.fLast>=a.fNbins)return!1;a.InvertBit(JSROOT.EAxisBits.kAxisRange);
return!0},h=function(a){if(b.getDimension()!==a||-1111===b.options.minimum&&-1111===b.options.maximum||!b.draw_content)return!1;b.options.minimum=b.options.maximum=-1111;b.scanContent(!0);return!0};a&&g(e.fXaxis)&&(f=!0);c&&(g(e.fYaxis)||h(1))&&(f=!0);d&&(g(e.fZaxis)||h(2))&&(f=!0);return f};m.prototype.addInteractivity=function(){var a=this.isMainPainter()?this.getFramePainter():null;return a?a.addInteractivity():Promise.resolve(!1)};m.prototype.changeUserRange=function(a,c){var d=this,b=this.getHisto(),
f=b?b["f"+c+"axis"]:null;f&&(b="[1,"+f.fNbins+"]",f.TestBit(JSROOT.EAxisBits.kAxisRange)&&(b="["+f.fFirst+","+f.fLast+"]"),a.input("Enter user range for axis "+c+" like [1,"+f.fNbins+"]",b).then(function(a){if(a&&(a=JSON.parse(a))&&2==a.length){var b=parseInt(a[0]);a=parseInt(a[1]);Number.isInteger(b)&&Number.isInteger(a)&&(f.fFirst=b,f.fLast=a,(f.fFirst<f.fLast&&1<=f.fFirst&&f.fLast<=f.fNbins)!=f.TestBit(JSROOT.EAxisBits.kAxisRange)&&f.InvertBit(JSROOT.EAxisBits.kAxisRange),d.interactiveRedraw())}}))};
m.prototype.changeValuesRange=function(a){var c=this;a.input("Enter min/max hist values or empty string to reset",-1111!=this.options.minimum&&-1111!=this.options.maximum?"["+this.options.minimum+","+this.options.maximum+"]":"["+this.gminbin+","+this.gmaxbin+"]").then(function(a){(a=a?JSON.parse(a):[])&&"object"==typeof a&&2==a.length&&Number.isFinite(a[0])&&Number.isFinite(a[1])?(c.options.minimum=a[0],c.options.maximum=a[1]):c.options.minimum=c.options.maximum=-1111;c.interactiveRedraw()})};m.prototype.fillContextMenu=
function(a){var c=this,d=this.getHisto(),b=this.getFramePainter();if(d){a.add("header:"+d._typename+"::"+d.fName);this.draw_content&&(a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return c.toggleStat()}),1==this.getDimension()?a.add("User range X",function(){return c.changeUserRange(a,"X")}):(a.add("sub:User ranges"),a.add("X",function(){return c.changeUserRange(a,"X")}),a.add("Y",function(){return c.changeUserRange(a,"Y")}),2<this.getDimension()?a.add("Z",function(){return c.changeUserRange(a,
"Z")}):a.add("Values",function(){return c.changeValuesRange(a)}),a.add("endsub:")),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var f=this.getMainPainter()||this;a.addchk(f.isTooltipAllowed(),"Show tooltips",function(){f.setTooltipAllowed("toggle")});a.addchk(b.enable_highlight,"Highlight bins",function(){b.enable_highlight=!b.enable_highlight;!b.enable_highlight&&b.highlightBin3D&&b.mode3d&&b.highlightBin3D(null)});
b&&b.render3D&&(a.addchk(f.options.FrontBox,"Front box",function(){f.options.FrontBox=!f.options.FrontBox;b.render3D()}),a.addchk(f.options.BackBox,"Back box",function(){f.options.BackBox=!f.options.BackBox;b.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.interactiveRedraw("pad")}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){return c.toggleColz()}),this.fillPaletteMenu&&
this.fillPaletteMenu(a));f.control&&"function"===typeof f.control.reset&&a.add("Reset camera",function(){f.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&b.zoomChangedInteractive()&&a.add("Let update zoom",function(){b.zoomChangedInteractive("reset")});return!0}};m.prototype.clickButton=function(a){var c=this.getFramePainter();if(!this.isMainPainter()||!c)return!1;switch(a){case "ToggleZoom":if(c.zoom_xmin!==c.zoom_xmax||c.zoom_ymin!==c.zoom_ymax||c.zoom_zmin!==c.zoom_zmax)return c.unzoom(),
c.zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),!0;break;case "ToggleLogX":c.toggleAxisLog("x");break;case "ToggleLogY":c.toggleAxisLog("y");break;case "ToggleLogZ":c.toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};m.prototype.fillToolbar=function(a){var c=this.getPadPainter();c&&(c.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),c.addPadButton("arrow_right",
"Toggle log x","ToggleLogX","PageDown"),c.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&c.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&c.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||c.showPadButtons())};m.prototype.get3DToolTip=function(a){var c=this.getHisto(),d={bin:a,name:c.fName,title:c.fTitle};switch(this.getDimension()){case 1:d.ix=a;d.iy=1;d.value=c.getBinContent(d.ix);d.error=c.getBinError(a);d.lines=this.getBinTooltips(a-
1);break;case 2:d.ix=a%(this.nbinsx+2);d.iy=(a-d.ix)/(this.nbinsx+2);d.value=c.getBinContent(d.ix,d.iy);d.error=c.getBinError(a);d.lines=this.getBinTooltips(d.ix-1,d.iy-1);break;case 3:d.ix=a%(this.nbinsx+2),d.iy=(a-d.ix)/(this.nbinsx+2)%(this.nbinsy+2),d.iz=(a-d.ix-d.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),d.value=c.getBinContent(d.ix,d.iy,d.iz),d.error=c.getBinError(a),d.lines=this.getBinTooltips(d.ix-1,d.iy-1,d.iz-1)}return d};m.prototype.createContour=function(a,c,d,b,f){c=new I(c,
d);f?c.createCustom(f):(2>a&&(a=JSROOT.gStyle.fNumberContours),f=this.getPadPainter().getRootPad(!0),c.createNormal(a,f?f.fLogz:0,b),c.configIndicies(this.options.Zero?-1:0,0!=c.colzmin||!this.options.Zero||this.isTH2Poly()?0:-1));a=this.getFramePainter();3>this.getDimension()&&a&&(a.zmin=c.colzmin,a.zmax=c.colzmax);return this.fContour=c};m.prototype.getContour=function(a){if(this.fContour&&!a)return this.fContour;var c=this.getMainPainter();a=this.getFramePainter();if(c&&c!==this&&c.fContour)return this.fContour=
c.fContour;c=this.getObject();var d=0,b=this.minbin,f=this.maxbin,e=this.minposbin,g;b===f&&(b=this.gminbin,f=this.gmaxbin,e=this.gminposbin);-1111!==this.options.minimum&&-1111!=this.options.maximum&&(b=this.options.minimum,f=this.options.maximum);a&&a.zoom_zmin!=a.zoom_zmax&&(b=a.zoom_zmin,f=a.zoom_zmax);c.fContour&&1<c.fContour.length&&(c.TestBit(K.kUserContour)?g=c.fContour:d=c.fContour.length);return this.createContour(d,b,f,e,g)};m.prototype.getContourLevels=function(){return this.getContour().getLevels()};
m.prototype.getHistPalette=function(a){a&&(this.fPalette=null);this.fPalette||this.options.Palette||(a=this.getPadPainter())&&a.getCustomPalette&&(this.fPalette=a.getCustomPalette());this.fPalette||(this.fPalette=F(this.options.Palette));return this.fPalette};m.prototype.fillPaletteMenu=function(a){var c=this,d=this.options.Palette||JSROOT.settings.Palette,b=function(b,e,g){return a.addchk(b===d||g,"<nobr>"+e+"</nobr>",b,function(a){c.options.Palette=parseInt(a);c.getHistPalette(!0);c.redraw()})};
a.add("sub:Palette");b(50,"ROOT 5",10<=d&&51>d);b(51,"Deep Sea");b(52,"Grayscale",0<d&&10>d);b(53,"Dark body radiator");b(54,"Two-color hue");b(55,"Rainbow");b(56,"Inverted dark body radiator");b(57,"Bird",113<d);b(58,"Cubehelix");b(59,"Green Red Violet");b(60,"Blue Red Yellow");b(61,"Ocean");b(62,"Color Printable On Grey");b(63,"Alpine");b(64,"Aquamarine");b(65,"Army");b(66,"Atlantic");a.add("endsub:")};m.prototype.drawColorPalette=function(a,c,d){var b=this;if(!this.isMainPainter())return Promise.resolve(null);
var f=this.findFunction("TPaletteAxis"),e=this.getPadPainter(),g=e?e.findPainterFor(f):null;this._can_move_colz&&(d=!0,delete this._can_move_colz);g||f||!(g=e?e.findPainterFor(void 0,void 0,"TPaletteAxis"):null)||(f=g.getObject(),this.addFunction(f,!0));if(!a)return g&&(g.Enabled=!1,g.removeG()),Promise.resolve(null);if(!f){if(this.options.PadPalette)return Promise.resolve(null);f=JSROOT.create("TPave");JSROOT.extend(f,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:JSROOT.create("TGaxis"),
fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});a=this.getHisto().fZaxis;JSROOT.extend(f.fAxis,{fTitle:a.fTitle,fTitleSize:a.fTitleSize,fChopt:"+",fLineColor:a.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:a.fLabelSize,fTextAlign:11,fTextColor:a.fLabelColor,fTextFont:a.fLabelFont});this.addFunction(f,!0);d=!0}var h=this.getFramePainter();d&&h&&(f.fX2NDC=h.fX2NDC+.01+(f.fX2NDC-f.fX1NDC),f.fX1NDC=h.fX2NDC+.01,f.fY1NDC=h.fY1NDC,f.fY2NDC=h.fY2NDC);a="";c&&(a+=";postpone");d&&!this.do_redraw_palette&&
(a+=";can_move");if(g)g.Enabled=!0,g=g.drawPave(a);else{var t=this.selectCurrentPad(this.getPadName());g=R(this.getDom(),f,a).then(function(a){b.selectCurrentPad(t);return a})}return g.then(function(a){a.$secondary=!0;a.redraw=function(){};d&&h&&f.fX1NDC-.005<h.fX2NDC&&!b.do_redraw_palette&&(b.do_redraw_palette=!0,h.fX2NDC=f.fX1NDC-.01,h.redraw(),c||b.redraw(),delete b.do_redraw_palette);return a})};m.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||
11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)};m.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad",
"drawopt")};m.prototype.prepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var c=this.getHisto(),d=c.fXaxis,b=c.fYaxis,f=this.getFramePainter(),e=this.getDimension(),g,h={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.extra),j1:1===e?0:this.getSelectIndex("y","left",0-a.extra),j2:1===e?1:this.getSelectIndex("y","right",1+a.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};h.grx=
new Float32Array(h.i2+1);h.gry=new Float32Array(h.j2+1);"number"!=typeof c.fBarOffset||"number"!=typeof c.fBarWidth||!c.fBarOffset&&1E3===c.fBarWidth||(1E3>=c.fBarOffset?h.xbar1=h.ybar1=.001*c.fBarOffset:3E3>=c.fBarOffset?h.xbar1=.001*(c.fBarOffset-2E3):5E3>=c.fBarOffset&&(h.ybar1=.001*(c.fBarOffset-4E3)),1E3>=c.fBarWidth?(h.xbar2=Math.min(1,h.xbar1+.001*c.fBarWidth),h.ybar2=Math.min(1,h.ybar1+.001*c.fBarWidth)):3E3>=c.fBarWidth?h.xbar2=Math.min(1,h.xbar1+.001*(c.fBarWidth-2E3)):5E3>=c.fBarWidth&&
(h.ybar2=Math.min(1,h.ybar1+.001*(c.fBarWidth-4E3))));a.original&&(h.original=!0,h.origx=new Float32Array(h.i2+1),h.origy=new Float32Array(h.j2+1));a.pixel_density&&(a.rounding=!0);if(!f)return console.warn("cannot draw histogram without frame"),h;for(g=h.i1;g<=h.i2;++g){var t=d.GetBinCoord(g+a.middle);f.logx&&0>=t?h.i1=g+1:(h.origx&&(h.origx[g]=t),h.grx[g]=f.grx(t),a.rounding&&(h.grx[g]=Math.round(h.grx[g])),a.use3d&&(h.grx[g]<-f.size_xy3d&&(h.i1=g,h.grx[g]=-f.size_xy3d),h.grx[g]>f.size_xy3d&&(h.i2=
g,h.grx[g]=f.size_xy3d)))}if(1===e)h.gry[0]=f.gry(0),h.gry[1]=f.gry(1);else for(d=h.j1;d<=h.j2;++d)g=b.GetBinCoord(d+a.middle),f.logy&&0>=g?h.j1=d+1:(h.origy&&(h.origy[d]=g),h.gry[d]=f.gry(g),a.rounding&&(h.gry[d]=Math.round(h.gry[d])),a.use3d&&(h.gry[d]<-f.size_xy3d&&(h.j1=d,h.gry[d]=-f.size_xy3d),h.gry[d]>f.size_xy3d&&(h.j2=d,h.gry[d]=f.size_xy3d)));this.maxbin=this.minbin=this.minposbin=null;for(g=h.i1;g<h.i2;++g)for(d=h.j1;d<h.j2;++d){b=c.getBinContent(g+1,d+1);h.sumz+=b;if(a.pixel_density){f=
(h.grx[g+1]-h.grx[g])*(h.gry[d]-h.gry[d+1]);if(0>=f)continue;h.max=Math.max(h.max,b);0<b&&(b<h.min||0===h.min)&&(h.min=b);b/=f}null===this.maxbin?this.maxbin=this.minbin=b:(this.maxbin=Math.max(this.maxbin,b),this.minbin=Math.min(this.minbin,b));0<b&&(null===this.minposbin||b<this.minposbin)&&(this.minposbin=b)}this.fContour=null;return h};m.prototype.getAxisBinTip=function(a,c,d){var b=this.getFramePainter(),f=b[a+"_handle"],e=c.GetBinLowEdge(d+1);if("labels"===f.kind)return b.axisAsText(a,e);c=
c.GetBinLowEdge(d+2);return"time"===f.kind?b.axisAsText(a,(e+c)/2):"["+b.axisAsText(a,e)+", "+b.axisAsText(a,c)+")"};E.prototype=Object.create(m.prototype);E.prototype.convertTH1K=function(){var a=this.getObject();if(!a.fReady){var c=a.fArray,d=a.fEntries;a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var b=0;b<a.fNcells;++b)a.fArray[b]=0;for(b=0;b<a.fNIn;++b)a.Fill(c[b]);a.fReady=!0;a.fEntries=d}};E.prototype.scanContent=function(a){a&&!this.nbinsx&&(a=!1);this.isTH1K()&&this.convertTH1K();
var c=this.getHisto();a||this.extractAxesProperties(1);var d=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right");if(!a||d!==this.scan_xleft||b!==this.scan_xright){this.draw_content=!(0<this.options.Axis);this.scan_xleft=d;this.scan_xright=b;for(var f=0,e=0,g=0,h=0,t=!0,q=this.isTProfile(),l,u,r=0;r<this.nbinsx;++r)l=c.getBinContent(r+1),h+=q?c.fBinEntries[r+1]:l,r<d||r>=b||(0<l&&(0==e||l<e)&&(e=l),t&&(f=g=l,t=!1),u=this.options.Error?c.getBinError(r+1):0,f=Math.min(f,l-u),g=Math.max(g,
l+u));this.stat_entries=h=q?h+(c.fBinEntries[0]+c.fBinEntries[this.nbinsx+1]):h+(c.getBinContent(0)+c.getBinContent(this.nbinsx+1));1<c.fEntries&&(this.stat_entries=c.fEntries);this.hmin=f;this.hmax=g;this.ymin_nz=e;if(0==this.nbinsx||1E-300>Math.abs(f)&&1E-300>Math.abs(g))this.draw_content=!1;d=c=!1;this.draw_content?f>=g?0==f?(this.ymin=0,this.ymax=1):0>f?(this.ymin=2*f,this.ymax=0):(this.ymin=0,this.ymax=2*f):(b=.05*(g-f),this.ymin=f-b,0>this.ymin&&0<=f&&(this.ymin=0),this.ymax=g+b):this.options.ymin!==
this.options.ymax&&(this.ymin=this.options.ymin,this.ymax=this.options.ymax,d=!0);f=this.options.minimum;g=this.options.maximum;f===g&&-1111!==f&&(0>f?(f*=2,g=0):(f=0,(g*=2)||(g=1)));-1111==f||-1111==g||this.draw_content||d?(-1111!=f&&(f<this.ymin?this.ymin=f:c=!0),-1111!=g&&(g>this.ymax?this.ymax=g:c=!0)):(this.ymin=f,this.ymax=g);a||(c&&(this.draw_content||d)?(this.zoom_ymin=-1111==f?this.ymin:f,this.zoom_ymax=-1111==g?this.ymax:g):(delete this.zoom_ymin,delete this.zoom_ymax));this.wheel_zoomy=
1<this.getDimension()||!this.draw_content}};E.prototype.countStat=function(a){for(var c=this.isTProfile(),d=this.getHisto(),b=d.fXaxis,f=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),g=0,h=0,t=0,q=0,l=0,u,r,n=null,y=null,p=this.getFramePainter(),z={name:d.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};f<e;++f)if(u=b.GetBinCoord(f+.5),!a||a(u)){c?(r=d.fBinEntries[f+1],q+=d.fArray[f+1],l+=d.fSumw2[f+1]):r=d.getBinContent(f+1);if(null===n||
r>y)n=u,y=r;g+=r;h+=r*u;t+=r*u*u}!p.isAxisZoomed("x")&&0<d.fTsumw&&(g=d.fTsumw,h=d.fTsumwx,t=d.fTsumwx2);z.integral=g;0<g&&(z.meanx=h/g,z.meany=q/g,z.rmsx=Math.sqrt(Math.abs(t/g-z.meanx*z.meanx)),z.rmsy=Math.sqrt(Math.abs(l/g-z.meany*z.meany)));null!==n&&(z.xmax=n,z.wmax=y);return z};E.prototype.fillStatistic=function(a,c,d){if(this.isIgnoreStatsFill())return!1;var b=this.getHisto(),f=this.countStat(),e=c%10,g=Math.floor(c/10)%10,h=Math.floor(c/100)%10,t=Math.floor(c/1E3)%10,q=Math.floor(c/1E4)%10,
l=Math.floor(c/1E5)%10,u=Math.floor(c/1E6)%10,r=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearPave();0<e&&a.addText(f.name);this.isTProfile()?(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<h&&(a.addText("Mean = "+a.format(f.meanx)),a.addText("Mean y = "+a.format(f.meany))),0<t&&(a.addText("Std Dev = "+a.format(f.rmsx)),a.addText("Std Dev y = "+a.format(f.rmsy)))):(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<h&&a.addText("Mean = "+a.format(f.meanx)),0<t&&a.addText("Std Dev = "+
a.format(f.rmsx)),0<q&&a.addText("Underflow = "+a.format(0<b.fArray.length?b.fArray[0]:0,"entries")),0<l&&a.addText("Overflow = "+a.format(0<b.fArray.length?b.fArray[b.fArray.length-1]:0,"entries")),0<u&&a.addText("Integral = "+a.format(f.integral,"entries")),0<r&&a.addText("Skew = <not avail>"),0<c&&a.addText("Kurt = <not avail>"));d&&a.fillFunctionStat(this.findFunction("TF1"),d);return!0};E.prototype.drawBars=function(a){this.createG(!0);var c=this.getSelectIndex("x","left",-1),d=this.getSelectIndex("x",
"right",1),b=this.getFramePainter(),f=this.getHisto(),e=f.fXaxis,g=this.options.Text,h="",t="",q="",l=10<this.options.BarStyle?this.options.BarStyle%10:0;4<l&&(l=4);var u=b.swap_xy?0:a;Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=b.scale_ymin&&(u=Math.round(b.gry(this.options.BaseLine)));if(g){var r=this.getColor(f.fMarkerColor);var n=-1*this.options.TextAngle;var y=20;1!==f.fMarkerSize&&n&&(y=.02*a*f.fMarkerSize);this.startTextDrawing(42,y,this.draw_g,y)}for(a=c;a<d;++a){c=e.GetBinLowEdge(a+
1);var p=e.GetBinLowEdge(a+2);if(!(b.logx&&0>=p)){c=Math.round(b.grx(c));var z=Math.round(b.grx(p));var w=f.getBinContent(a+1);if(!(b.logy&&w<b.scale_ymin)){p=Math.round(b.gry(w));var m=z-c;c+=Math.round(f.fBarOffset/1E3*m);m=Math.round(f.fBarWidth/1E3*m);h=b.swap_xy?h+("M"+u+","+c+"h"+(p-u)+"v"+m+"h"+(u-p)+"z"):h+("M"+c+","+p+"h"+m+"v"+(u-p)+"h"+-m+"z");0<l&&(z=c+m,m=Math.round(m*l/10),b.swap_xy?(t+="M"+u+","+c+"h"+(p-u)+"v"+m+"h"+(u-p)+"z",q+="M"+u+","+z+"h"+(p-u)+"v"+-m+"h"+(u-p)+"z"):(t+="M"+
c+","+p+"h"+m+"v"+(u-p)+"h"+-m+"z",q+="M"+z+","+p+"h"+-m+"v"+(u-p)+"h"+m+"z"));g&&w&&(z=w===Math.round(w)?w.toString():v.floatToString(w,JSROOT.gStyle.fPaintTextFormat),b.swap_xy?this.drawText({align:12,x:Math.round(p+y/2),y:Math.round(c+.1),height:Math.round(.8*m),text:z,color:r,latex:0}):n?this.drawText({align:12,x:c+m/2,y:Math.round(p-2-y/5),width:0,height:0,rotate:n,text:z,color:r,latex:0}):this.drawText({align:22,x:Math.round(c+.1*m),y:Math.round(p-2-y),width:Math.round(.8*m),height:y,text:z,
color:r,latex:0}))}}}h&&this.draw_g.append("svg:path").attr("d",h).call(this.fillatt.func);t&&this.draw_g.append("svg:path").attr("d",t).call(this.fillatt.func).style("fill",k.rgb(this.fillatt.color).brighter(.5).toString());q&&this.draw_g.append("svg:path").attr("d",q).call(this.fillatt.func).style("fill",k.rgb(this.fillatt.color).darker(.5).toString());g&&this.finishTextDrawing()};E.prototype.drawFilledErrors=function(){this.createG(!0);for(var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x",
"right",1),d=this.getFramePainter(),b=this.getHisto(),f=b.fXaxis,e,g,h,t,q=[],l=[];a<c;++a)e=f.GetBinCoord(a+.5),d.logx&&0>=e||(e=Math.round(d.grx(e)),g=b.getBinContent(a+1),h=b.getBinError(a+1),d.logy&&g-h<d.scale_ymin||(t=Math.round(d.gry(g+h)),g=Math.round(d.gry(g-h)),q.push({grx:e,gry:t}),l.unshift({grx:e,gry:g})));c=4===this.options.ErrorKind?"bezier":"line";q=v.buildSvgPath(c,q);l=v.buildSvgPath("L"+c,l);this.draw_g.append("svg:path").attr("d",q.path+l.path+"Z").style("stroke","none").call(this.fillatt.func)};
E.prototype.draw1DBins=function(){var a=this;this.createHistDrawAttributes();var c=this.getFramePainter(),d=c.getFrameWidth(),b=c.getFrameHeight();if(!this.draw_content||0>=d||0>=b)return this.removeG();if(this.options.Bar)return this.drawBars(b);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.drawFilledErrors();var f=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",2),g=this.getHisto(),h=!JSROOT.batch_mode&&JSROOT.settings.Tooltip,t=g.fXaxis,q="",l=!1,u,
r,n,y,p,z,w,m=!this.options.Zero,k=this.options.Error,M=this.options.Mark,G=this.options.Line||this.options.Curve,x=this.options.Text,C=x&&"E"==this.options.TextKind&&this.isTProfile()&&g.fBinEntries,A=null,D=null,B=null,E=null,F=null,S=null,H=!1,I=!1,K="",ja="",da=0,J,P,Y,Z,O,Q,W,N,R,ba;k&&!M&&1<g.fMarkerStyle&&(M=!0);2===this.options.ErrorKind?this.fillatt.empty()?M=!0:A="":this.options.Error&&(D="",F=h?"":null,I=!0);G&&(E="");M&&(this.createAttMarker({attr:g,style:this.options.MarkStyle}),0<this.markeratt.size?
(B="",H=!0,this.markeratt.resetPos(),null===F&&h&&(S="")):M=!1);var ia=k||M,ka=ia||x||G;M=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!M&&!ka)return this.removeG();this.createG(!0);if(x){var ca=this.getColor(g.fMarkerColor);var ea=-1*this.options.TextAngle;var T=20;1!==g.fMarkerSize&&ea&&(T=.02*b*g.fMarkerSize);ea||this.options.TextKind||(l=d/(e-f+1),l<3*T&&(ea=270,T=Math.round(.7*l)));this.startTextDrawing(42,T,this.draw_g,T)}d=e-f>3*d;1===this.options.ErrorKind&&(l=this.lineatt.width+
JSROOT.gStyle.fEndErrorSize,K="m0,"+l+"v-"+2*l+"m0,"+l,ja="m"+l+",0h-"+2*l+"m"+l+",0",da=Math.floor((this.lineatt.width-1)/2));ka&&(d=!0);var la=function(a){Z=g.getBinContent(a+1);if(m&&0===Z)return!1;Q=Math.round(c.grx(t.GetBinLowEdge(a+1)));W=Math.round(c.grx(t.GetBinLowEdge(a+2)));N=Math.round((Q+W)/2);J=Math.round(c.gry(Z));P=Y=20;k&&(O=g.getBinError(a+1),P=Math.round(J-c.gry(Z+O)),Y=Math.round(c.gry(Z-O)-J));return!0},ma=function(){var b=5;0<a.options.errorX&&(b=Math.round((W-Q)*a.options.errorX),
R=N-b,ba=N+b,D+="M"+(R+da)+","+J+K+"h"+(ba-R-2*da)+K);D+="M"+N+","+(J-P+da)+ja+"v"+(P+Y-2*da)+ja;null!==F&&(F+="M"+(N-b)+","+(J-P)+"h"+2*b+"v"+(P+Y)+"h"+-2*b+"z")},fa=function(c){la(c)&&(x&&(c=C?g.fBinEntries[c+1]:Z,0!==c&&(c=c===Math.round(c)?c.toString():v.floatToString(c,JSROOT.gStyle.fPaintTextFormat),ea?a.drawText({align:12,x:N,y:Math.round(J-2-T/5),width:0,height:0,rotate:ea,text:c,color:ca,latex:0}):a.drawText({align:22,x:Math.round(Q+.1*(W-Q)),y:Math.round(J-2-T),width:Math.round(.8*(W-Q)),
height:T,text:c,color:ca,latex:0}))),G&&null!==E&&(E+=(0===E.length?"M":"L")+N+","+J),ia&&J>=-P&&J<=b+Y&&(null!==A&&(A+="M"+Q+","+(J-P)+"h"+(W-Q)+"v"+(P+Y+1)+"h-"+(W-Q)+"z"),null!==B&&H&&(B+=a.markeratt.create(N,J),null!==S&&(S+="M"+(N-5)+","+(J-5)+"h10v10h-10z")),null!==D&&I&&ma()))};if(H||I)if(!JSROOT.settings.OptimizeDraw||5E4>e-f&&1==JSROOT.settings.OptimizeDraw){for(z=f;z<e;++z)la(z)&&(null!==B&&(B+=this.markeratt.create(N,J)),null!==S&&(S+="M"+(N-5)+","+(J-5)+"h10v10h-10z"),null!==D&&ma());
I=H=!1}for(z=f;z<=e;++z)if(l=t.GetBinLowEdge(z+1),!(this.logx&&0>=l)){var U=Math.round(c.grx(l));if((l=z===e)&&f<e)var L=n;else L=g.getBinContent(z+1),L=Math.round(c.gry(L));if(0===q.length){var X=w=z;var ha=u=r=U;var aa=y=p=n=L;q="M"+r+","+n}else if(d)U!==r||l?(ka&&(X===w?fa(X):X<w?(fa(X),fa(w)):(fa(w),fa(X))),!M||y===p&&aa===y||(ha!==r&&(q+="h"+(r-ha)),n===y?(p!==aa&&(q+="v"+(p-aa)),y!==p&&(q+="v"+(y-p))):(y!==aa&&(q+="v"+(y-aa)),p!==y&&(q+="v"+(p-y)),n!==p&&(q+="v"+(n-p))),ha=r,aa=n),l&&ha!==U&&
(q+="h"+(U-ha)),X=w=z,y=p=n=L,r=U):(L<y?w=z:L>p&&(X=z),y=Math.min(y,L),p=Math.max(p,L),n=L);else if(L!==n||l)U!==r&&(q+="h"+(U-r)),L!==n&&(q+="v"+(L-n)),n=L,r=U}f=h&&this.fillatt.empty()&&M&&!ia&&!G;e=b+3;f||(h=Math.round(c.gry(0)),0>=h?e=-3:h<b&&(e=h));u="L"+r+","+e+"L"+u+","+e+"Z";if(ia||G)null!==A&&0<A.length&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func),null!==D&&0<D.length&&this.draw_g.append("svg:path").attr("d",D).call(this.lineatt.func),null!==F&&0<F.length&&this.draw_g.append("svg:path").attr("d",
F).attr("stroke","none").attr("fill","none").attr("pointer-events","visibleFill"),null!==E&&0<E.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",(this.options.Fill?E:q)+u).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",E).attr("fill","none").call(this.lineatt.func)),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).call(this.markeratt.func),null!==S&&0<S.length&&this.draw_g.append("svg:path").attr("d",S).attr("stroke","none").attr("fill",
"none").attr("pointer-events","visibleFill");if(0<q.length&&M){if(!this.fillatt.empty()||f)q+=u;this.draw_g.append("svg:path").attr("d",q).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}x&&this.finishTextDrawing()};E.prototype.getBinTooltips=function(a){var c=[],d=this.getObjectHint(),b=this.getFramePainter(),f=this.getHisto(),e=f.fXaxis.GetBinLowEdge(a+1),g=f.fXaxis.GetBinLowEdge(a+2),h=f.getBinContent(a+1),t=this.getAxisBinTip("x",f.fXaxis,a);0<d.length&&c.push(d);
this.options.Error||this.options.Mark?(c.push("x = "+t),c.push("y = "+b.axisAsText("y",h)),this.options.Error&&("["==t[0]&&c.push("error x = "+((g-e)/2).toPrecision(4)),c.push("error y = "+f.getBinError(a+1).toPrecision(4)))):(c.push("bin = "+(a+1)),c.push("x = "+t),f.$baseh&&(h-=f.$baseh.getBinContent(a+1)),h===Math.round(h)?c.push("entries = "+h):c.push("entries = "+v.floatToString(h,JSROOT.gStyle.fStatFormat)));return c};E.prototype.processTooltipEvent=function(a){function c(a){a=g.fXaxis.GetBinLowEdge(a+
1);return b.logx&&0>=a?null:b.grx(a)}function d(a){a=g.getBinContent(a+1);return b.logy&&a<b.scale_ymin?b.swap_xy?-1E3:10*e:Math.round(b.gry(a))}if(!a||!this.draw_content||!this.draw_g||this.options.Mode3D)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var b=this.getFramePainter(),f=b.getFrameWidth(),e=b.getFrameHeight(),g=this.getHisto(),h=null,t,q,l=2,u=this.getSelectIndex("x","left",-1),r=this.getSelectIndex("x","right",2);var n=u;var y=r;var p=a.x,z=a.y;b.swap_xy&&(h=a.x,
p=z,z=h,h=e,e=f,f=h);for(;n<y-1;){h=Math.round(.5*(n+y));var w=c(h);null===w||w<p-.5?b.swap_xy?y=h:n=h:w>p+.5?b.swap_xy?n=h:y=h:(n++,y--)}h=y=n;w=c(h);if(b.swap_xy){for(;n>u&&c(n-1)<w+2;)--n;for(;y<r&&c(y+1)>w-2;)++y}else{for(;n>u&&c(n-1)>w-2;)--n;for(;y<r&&c(y+1)<w+2;)++y}if(n<y){w=e;for(t=n;t<=y;t++){var k=Math.abs(d(t)-z);k<w&&(w=k,h=t)}w>e/10&&(h=Math.round(n+(y-n)/e*z));w=c(h)}w=Math.round(w);t=Math.round(c(h+1));this.options.Bar&&(n=t-w,w+=Math.round(g.fBarOffset/1E3*n),t=w+Math.round(g.fBarWidth/
1E3*n));w>t&&(n=w,w=t,t=n);n=Math.round((w+t)/2);y=k=q=d(h);if(this.options.Bar){f=!0;l=0;k=Math.round(b.gry(!1!==this.options.BaseLine&&this.options.BaseLine>b.scale_ymin?this.options.BaseLine:b.scale_ymin));if(k>q){var m=k;k=q;q=m}!a.touch&&1===a.nproc&&(z<k||z>q)&&(h=null)}else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve){f=!0;m=3;this.markeratt&&(m=Math.max(m,this.markeratt.getFullSize()));if(this.options.Error){var v=g.getBinContent(h+1);q=g.getBinError(h+
1);k=Math.round(b.gry(v+q));q=Math.round(b.gry(v-q));0==v&&this.isTProfile()&&(h=null);t=(t-w)*this.options.errorX;w=Math.round(n-t);t=Math.round(n+t)}t-w<2*m&&(w=n-m,t=n+m);k=Math.min(k,y-m);q=Math.max(q,y+m);!a.touch&&1===a.nproc&&(z<k||z>q)&&(h=null)}else if(f=1===a.nproc&&r-u<f)q=e,this.fillatt.empty()||(q=Math.round(b.gry(0)),0>q?q=0:q>e&&(q=e),q<k&&(m=k,k=q,q=m)),(a.y<k||a.y>q)&&!a.touch&&(h=null);null!==h&&(h===u&&w>p+l?h=null:h===r-1&&t<p-l?h=null:p<w-l||p>t+l?h=null:this.options.Zero||0!==
g.getBinContent(h+1)||(h=null));l=this.draw_g.select(".tooltip_bin");if(null===h||0>=q||k>=e)return l.remove(),null;u={name:g.fName,title:g.fTitle,x:n,y:y,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(h)};a.disabled?(l.remove(),u.changed=!0):f?(l.empty()&&(l=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),u.changed=l.property("current_bin")!==h,u.changed&&
l.attr("x",b.swap_xy?k:w).attr("width",b.swap_xy?q-k:t-w).attr("y",b.swap_xy?w:k).attr("height",b.swap_xy?t-w:q-k).style("opacity","0.3").property("current_bin",h),u.exact=5>=Math.abs(y-z)||z>=k&&z<=q,u.menu=!0,u.menu_dist=Math.sqrt((n-p)*(n-p)+(y-z)*(y-z))):(p=this.lineatt.width+3,l.empty()&&(l=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",p).call(this.lineatt.func).call(this.fillatt.func)),u.exact=Math.abs(n-a.x)<=p&&Math.abs(y-a.y)<=p,u.menu=
u.exact,u.menu_dist=Math.sqrt((n-a.x)*(n-a.x)+(y-a.y)*(y-a.y)),u.changed=l.property("current_bin")!==h,u.changed&&l.attr("cx",n).attr("cy",y).property("current_bin",h));u.changed&&(u.user_info={obj:g,name:g.fName,bin:h,cont:g.getBinContent(h+1),grx:n,gry:y});return u};E.prototype.fillHistContextMenu=function(a){var c=this;a.add("Auto zoom-in",function(){return c.autoZoom()});var d=v.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",d.opts,function(a){if("inspect"===
a)return c.showInspector();c.decodeOptions(a);c.options.need_fillcol&&c.fillatt&&c.fillatt.empty()&&c.fillatt.change(5,1001);c.interactiveRedraw("pad","drawopt")});this.snapid||this.isTProfile()||a.addRebinMenu(function(a){return c.rebinHist(a)})};E.prototype.rebinHist=function(a){var c=this.getHisto(),d=c.fXaxis,b=Math.floor(d.fNbins/a);if(!(2>b)){var f=Array(b+2),e=null;0<d.fXbins.length&&(e=Array(b));f[0]=c.fArray[0];for(var g=1,h=1;h<=b;++h){e&&(e[h-1]=d.fXbins[g-1]);for(var t=0,q=0;q<a;++q)t+=
c.fArray[g++];f[h]=t}e?(g<=d.fXbins.length&&(d.fXmax=d.fXbins[g-1]),d.fXbins=e):d.fXmax=d.fXmin+(d.fXmax-d.fXmin)/d.fNbins*b*a;d.fNbins=b;for(a=0;g<c.fArray.length;)a+=c.fArray[g++];f[b+1]=a;c.fArray=f;c.fSumw2=[];this.scanContent();this.interactiveRedraw("pad")}};E.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),d=c-a,b=this.getHisto();if(0!=d&&b){for(var f=b.getBinContent(a+1),e=a;e<c;++e)f=Math.min(f,b.getBinContent(e+1));if(!(0<f)){for(;a<
c&&b.getBinContent(a+1)<=f;)++a;for(;a<c&&b.getBinContent(c)<=f;)--c;a===c-1&&2<a&&c<this.nbinsx-2&&(--a,++c);c-a<d&&a<c&&this.getFramePainter().zoom(b.fXaxis.GetBinLowEdge(a+1),b.fXaxis.GetBinLowEdge(c+1))}}};E.prototype.canZoomInside=function(a,c,d){var b=this.getHisto();return"x"==a&&b&&1<b.fXaxis.FindBin(d,.5)-b.fXaxis.FindBin(c,0)||"y"==a&&Math.abs(d-c)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};E.prototype.callDrawFunc=function(a){var c=this.getMainPainter(),d=this.getFramePainter();c!==this&&
d&&d.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(c);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};E.prototype.draw2D=function(){var a=this;this.clear3DScene();this.scanContent(!0);"function"===typeof this.drawColorPalette&&this.drawColorPalette(!1);return this.drawAxes().then(function(){a.draw1DBins();return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();return a.addInteractivity()})};E.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return c.draw3D(a)})};
E.prototype.redraw=function(a){return this.callDrawFunc(a)};D.prototype=Object.create(m.prototype);D.prototype.cleanup=function(){delete this.tt_handle;m.prototype.cleanup.call(this)};D.prototype.toggleProjection=function(a,c){var d=this;if("Projections"==a||"Off"==a)a="";"string"==typeof a&&1<a.length&&(c=parseInt(a.substr(1)),a=a[0]);c||(c=1);if(a&&this.is_projection==a)if(this.projection_width===c)a="";else{this.projection_width=c;return}delete this.proj_hist;var b=this.is_projection===a?"":a;
this.is_projection="";this.projection_width=c;this.getCanvPainter().toggleProjection(b).then(function(){return d.redrawProjection("toggling",b)})};D.prototype.redrawProjection=function(a,c,d,b){"toggling"===a&&(this.is_projection=c,a=c=void 0);if(this.is_projection){if(void 0==b){if(!this.tt_handle)return;a=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);c=a+1;d=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);b=d+1}var f=this.getCanvPainter(),e=this.getHisto();if(f&&!f._readonly&&void 0!==
this.snapid)e="EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":",e="X"==this.is_projection?e+('ProjectionX("_projx",'+(d+1)+","+b+',"")'):e+('ProjectionY("_projy",'+(a+1)+","+c+',"")'),f.sendWebsocket(e);else{this.proj_hist||("X"==this.is_projection?(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsx),JSROOT.extend(this.proj_hist.fXaxis,e.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsy),JSROOT.extend(this.proj_hist.fXaxis,
e.fYaxis),this.proj_hist.fName="yproj",this.proj_hist.fTitle="Y projection"));if("X"==this.is_projection)for(a=0;a<this.nbinsx;++a){c=0;for(var g=d;g<b;++g)c+=e.getBinContent(a+1,g+1);this.proj_hist.setBinContent(a+1,c)}else for(d=0;d<this.nbinsy;++d){b=0;for(g=a;g<c;++g)b+=e.getBinContent(g+1,d+1);this.proj_hist.setBinContent(d+1,b)}return f.drawProjection(this.is_projection,this.proj_hist)}}};D.prototype.executeMenuCommand=function(a,c){return m.prototype.executeMenuCommand.call(this,a,c)?!0:"SetShowProjectionX"==
a.fName||"SetShowProjectionY"==a.fName?(this.toggleProjection(a.fName[17],c&&parseInt(c)?parseInt(c):1),!0):!1};D.prototype.fillHistContextMenu=function(a){var c=this;if(!this.isTH2Poly()){a.add("sub:Projections",function(){return c.toggleProjection()});var d=this.is_projection||"";d&&(d+=this.projection_width);var b="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" ");this.is_projection&&b.push("Off");for(var f=0;f<b.length;++f)a.addchk(d==b[f],b[f],b[f],function(a){return c.toggleProjection(a)});a.add("endsub:");
a.add("Auto zoom-in",function(){return c.autoZoom()})}d=v.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",d.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};D.prototype.clickButton=function(a){if(m.prototype.clickButton.call(this,a))return!0;if(this!==this.getMainPainter())return!1;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();
break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};D.prototype.fillToolbar=function(){m.prototype.fillToolbar.call(this,!0);var a=this.getPadPainter();a&&(this.isTH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};D.prototype.toggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=
!this.options.Color;this._can_move_colz=!0;this.copyOptionsToOthers();this.redrawPad()};D.prototype.autoZoom=function(){if(!this.isTH2Poly()){var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),d=this.getSelectIndex("y","left",-1),b=this.getSelectIndex("y","right",1),f,e,g=this.getObject();if(a!=c&&d!=b){var h=g.getBinContent(a+1,d+1);for(f=a;f<c;++f)for(e=d;e<b;++e)h=Math.min(h,g.getBinContent(f+1,e+1));if(!(0<h)){var t=c,q=a,l=b,u=d;for(f=a;f<c;++f)for(e=d;e<b;++e)g.getBinContent(f+
1,e+1)>h&&(f<t&&(t=f),f>=q&&(q=f+1),e<l&&(l=e),e>=u&&(u=e+1));f=!1;t===q-1&&t>a+1&&q<c-1&&(t--,q++);l===u-1&&l>d+1&&u<b-1&&(l--,u++);if((t>a||q<c)&&t<q-1){var r=g.fXaxis.GetBinLowEdge(t+1);var n=g.fXaxis.GetBinLowEdge(q+1);f=!0}if((l>d||u<b)&&l<u-1){var k=g.fYaxis.GetBinLowEdge(l+1);var p=g.fYaxis.GetBinLowEdge(u+1);f=!0}f&&this.getFramePainter().zoom(r,n,k,p)}}}};D.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var c;a=this.getObject();this.extractAxesProperties(2);if(this.isTH2Poly()){this.gminposbin=
null;var d=this.gminbin=this.gmaxbin=0;for(c=a.fBins.arr.length;d<c;++d){var b=a.fBins.arr[d].fContent;0===d&&(this.gminbin=this.gmaxbin=b);b<this.gminbin?this.gminbin=b:b>this.gmaxbin&&(this.gmaxbin=b);0<b&&(null===this.gminposbin||this.gminposbin>b)&&(this.gminposbin=b)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,d=0;d<this.nbinsx;++d)for(c=0;c<this.nbinsy;++c)b=a.getBinContent(d+1,c+1),b<this.gminbin?this.gminbin=b:b>this.gmaxbin&&(this.gmaxbin=b),0<b&&(null===
this.gminposbin||this.gminposbin>b)&&(this.gminposbin=b);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};D.prototype.countStat=function(a){var c=this.getHisto(),d=c.fXaxis,b=c.fYaxis,f=0,e=0,g=0,h=0,t=0,q,l,u=this.getFramePainter(),r={name:c.fName,entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,
0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.isTH2Poly()){d=c.fBins.arr.length;var n,k,p,z=this.getFramePainter();for(b=0;b<d;++b){var w=c.fBins.arr[b];var m=q=1;w.fXmin>z.scale_xmax?q=2:w.fXmax<z.scale_xmin&&(q=0);w.fYmin>z.scale_ymax?m=2:w.fYmax<z.scale_ymin&&(m=0);var v=l=p=0;var x=w.fPoly;var G=1;"TMultiGraph"===x._typename&&(G=w.fPoly.fGraphs.arr.length,x=null);for(k=0;k<G;++k){if(!x||0<k)x=w.fPoly.fGraphs.arr[k];for(n=0;n<x.fNpoints;++n)++p,v+=x.fX[n],l+=x.fY[n]}1<p&&(v/=p,l/=p);w=w.fContent;
r.entries+=w;r.matrix[3*m+q]+=w;if(1==q&&1==m&&(!a||a(v,l))){if(null===r.wmax||w>r.wmax)r.wmax=w,r.xmax=v,r.ymax=l;f+=w;e+=v*w;g+=l*w;h+=v*v*w;t+=l*l*w}}}else for(z=this.getSelectIndex("x","left"),n=this.getSelectIndex("x","right"),x=this.getSelectIndex("y","left"),k=this.getSelectIndex("y","right"),G=0;G<=this.nbinsx+1;++G)for(q=G<=z?0:G>n?2:1,v=d.GetBinCoord(G-.5),p=0;p<=this.nbinsy+1;++p)if(m=p<=x?0:p>k?2:1,l=b.GetBinCoord(p-.5),w=c.getBinContent(G,p),r.entries+=w,r.matrix[3*m+q]+=w,1==q&&1==m&&
(null==a||a(v,l))){if(null===r.wmax||w>r.wmax)r.wmax=w,r.xmax=v,r.ymax=l;f+=w;e+=v*w;g+=l*w;h+=v*v*w;t+=l*l*w}!u.isAxisZoomed("x")&&!u.isAxisZoomed("y")&&0<c.fTsumw&&(f=c.fTsumw,e=c.fTsumwx,h=c.fTsumwx2,g=c.fTsumwy,t=c.fTsumwy2);0<f&&(r.meanx=e/f,r.meany=g/f,r.rmsx=Math.sqrt(Math.abs(h/f-r.meanx*r.meanx)),r.rmsy=Math.sqrt(Math.abs(t/f-r.meany*r.meany)));null===r.wmax&&(r.wmax=0);r.integral=f;1<c.fEntries&&(r.entries=c.fEntries);return r};D.prototype.fillStatistic=function(a,c,d){if(this.isIgnoreStatsFill())return!1;
var b=this.countStat(),f=Math.floor(c%10),e=Math.floor(c/10)%10,g=Math.floor(c/100)%10,h=Math.floor(c/1E3)%10,t=Math.floor(c/1E4)%10,q=Math.floor(c/1E5)%10,l=Math.floor(c/1E6)%10,u=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearPave();0<f&&a.addText(b.name);0<e&&a.addText("Entries = "+a.format(b.entries,"entries"));0<g&&(a.addText("Mean x = "+a.format(b.meanx)),a.addText("Mean y = "+a.format(b.meany)));0<h&&(a.addText("Std Dev x = "+a.format(b.rmsx)),a.addText("Std Dev y = "+a.format(b.rmsy)));
0<l&&a.addText("Integral = "+a.format(b.matrix[4],"entries"));0<u&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));0<c&&a.addText("Kurt = <undef>");if(0<t||0<q)b=b.matrix,a.addText(""+b[6].toFixed(0)+" | "+b[7].toFixed(0)+" | "+b[7].toFixed(0)),a.addText(""+b[3].toFixed(0)+" | "+b[4].toFixed(0)+" | "+b[5].toFixed(0)),a.addText(""+b[0].toFixed(0)+" | "+b[1].toFixed(0)+" | "+b[2].toFixed(0));d&&a.fillFunctionStat(this.findFunction("TF2"),d);return!0};D.prototype.drawBinsColor=
function(){for(var a=this,c=this.getHisto(),d=this.prepareColorDraw(),b=this.getContour(),f=this.getHistPalette(),e=[],g=!this.options.Zero,h=this._show_empty_bins,t=d.i1;t<d.i2;++t){var q=d.grx[t+1]-d.grx[t],l=Math.round(d.grx[t]+q*d.xbar1);q=Math.round(q*(d.xbar2-d.xbar1))||1;for(var u=d.j1;u<d.j2;++u){var r=c.getBinContent(t+1,u+1),n=0===r;if(!n||!g){r=b.getPaletteIndex(f,r);if(null===r)if(n&&h)r=0;else continue;n=d.gry[u]-d.gry[u+1];var k=Math.round(d.gry[u+1]+n*d.ybar1);n=Math.round(n*(d.ybar2-
d.ybar1))||1;var p="M"+l+","+k,m=e[r];m?(r="m"+(l-m.x)+","+(k-m.y),m.path+=r.length<p.length?r:p):m=e[r]={path:p};m.x=l;m.y=k;m.path+="v"+n+"h"+q+"v"+-n+"z"}}}e.forEach(function(b,c){b&&a.draw_g.append("svg:path").attr("palette-index",c).attr("fill",f.getColor(c)).attr("d",b.path)});return d};D.prototype.buildContour=function(a,c,d,b){function f(a){for(var b=0;b<c.length;++b)if(a<c[b])return b-1;return c.length-1}function e(a,b,d,e,f,g,n,p){var u=d===n;n=u?p-e:n-d;b+=1;f-=a;p=l-1;for(var m=999+l,
r=0,k;b<=g&&p<=m;)k=c[b],k-=a,k/=f,k*=n,u?(h[p]=d,t[p]=e+k):(h[p]=d+k,t[p]=e),q[p]=b,r++,p+=2,b++;return r}var g=this.getObject(),h=new Float32Array(4008),t=new Float32Array(4008),q=new Int32Array(4008),l=0,u=[],r=0,n=[0,0,0,0],k=[0,0,0,0],p=[0,0,0,0],m=[0,0,0,0],w,v,x,D,G=a.original?a.origx:a.grx,B=a.original?a.origy:a.gry;for(v=a.j1;v<a.j2-1;++v)for(k[1]=k[0]=(B[v]+B[v+1])/2,k[3]=k[2]=(B[v+1]+B[v+2])/2,w=a.i1;w<a.i2-1;++w){p[0]=g.getBinContent(w+1,v+1);p[1]=g.getBinContent(w+2,v+1);p[2]=g.getBinContent(w+
2,v+2);p[3]=g.getBinContent(w+1,v+2);for(x=0;4>x;x++)m[x]=f(p[x]);if(m[0]!==m[1]||m[1]!==m[2]||m[2]!==m[3]||m[3]!==m[0]){n[3]=n[0]=(G[w]+G[w+1])/2;n[2]=n[1]=(G[w+1]+G[w+2])/2;var C=p[0]<=p[1]?0:1;var A=p[2]<=p[3]?2:3;p[C]>p[A]&&(C=A);C++;for(x=l=1;4>=x;x++)A=C%4+1,C=e(p[C-1],m[C-1],n[C-1],k[C-1],p[A-1],m[A-1],n[A-1],k[A-1]),l+=2*C,C=A;C=p[0]<=p[1]?0:1;A=p[2]<=p[3]?2:3;p[C]>p[A]&&(C=A);C++;l=2;for(x=1;4>=x;x++)A=1==C?4:C-1,C=e(p[C-1],m[C-1],n[C-1],k[C-1],p[A-1],m[A-1],n[A-1],k[A-1]),l+=2*C,C=A;A=0;
for(x=1;x<=l-5;x+=2)for(;q[x-1]!=q[x];){C=h[x];var E=t[x];var F=q[x];for(D=x;D<=l-5;D+=2)h[D]=h[D+2],t[D]=t[D+2],q[D]=q[D+2];h[l-3]=C;t[l-3]=E;q[l-3]=F;if(2E3<A)break;A++}if(!(2E3<A))for(x=1;x<=l-2;x+=2)A=q[x-1],0<=A&&A<c.length&&((C=u[A])||(C=u[A]=JSROOT.createTPolyLine(8016,!0)),A=C.fLastPoint,A<C.fN-2&&(C.fX[A+1]=Math.round(h[x-1]),C.fY[A+1]=Math.round(t[x-1]),C.fX[A+2]=Math.round(h[x]),C.fY[A+2]=Math.round(t[x]),C.fLastPoint=A+2,r=Math.max(r,C.fLastPoint+1)))}}a=new Int32Array(c.length);for(A=
w=0;A<c.length;A++)if(0<=c[A]){w=A;break}x=0;for(A=w-1;0<=A;A--)a[x]=A,x++;for(A=w;A<c.length;A++)a[x]=A,x++;g=new Float32Array(2*r);n=new Float32Array(2*r);for(x=0;x<c.length;++x)if(A=a[x],C=u[A])for(k=d.calcColorIndex(A,c.length),p=C.fX,m=C.fY,v=C.fLastPoint+1,G=0,E=C=B=void 0;;){B=r;C=B+1;g[B]=p[G];n[B]=m[G];g[C]=p[G+1];n[C]=m[G+1];p[G]=p[G+1]=0;for(m[G]=m[G+1]=0;;){E=0;for(w=2;w<v;w+=2)C<2*r-1&&p[w]===g[C]&&m[w]===n[C]&&(C++,g[C]=p[w+1],n[C]=m[w+1],p[w]=p[w+1]=0,m[w]=m[w+1]=0,E++),0<B&&p[w+1]===
g[B]&&m[w+1]===n[B]&&(B--,g[B]=p[w],n[B]=m[w],p[w]=p[w+1]=0,m[w]=m[w+1]=0,E++);if(0==E)break}B+1<C&&0<=B&&b(k,g,n,B,C,A);G=0;for(w=2;w<v;w+=2)if(0!==p[w]&&0!==m[w]){G=w;break}if(0===G)break}};D.prototype.drawBinsContour=function(){function a(a,b,c,d,f){for(var g="",h,n,q,p,t=c;t<=d;++t){l?(c=l(a[t],b[t]),c.x=Math.round(e.grx(c.x)),c.y=Math.round(e.gry(c.y))):c={x:Math.round(a[t]),y:Math.round(b[t])};if(g)if(t==d&&n&&c.x==n.x&&c.y==n.y){if(!q)return"";g+="z";f=!1;p=!0}else c.x!=h.x&&c.y!=h.y?(g+="l"+
(c.x-h.x)+","+(c.y-h.y),q=!0):c.x!=h.x?(g+="h"+(c.x-h.x),q=!0):c.y!=h.y&&(g+="v"+(c.y-h.y),q=!0);else g="M"+c.x+","+c.y,n=c;h=c}if(f&&!p&&!l)return"<failed>";f&&(g+="z");return g}function c(a,b){var c=a.x2-a.x1;var d=a.y2-a.y1;var e=b.x2-b.x1;var f=b.y2-b.y1;var g=c*f-e*d;if(0==g)return 0;var h=0<g;var l=a.x1-b.x1;var n=a.y1-b.y1;b=c*n-d*l;if(0>b==h)return null;l=e*n-f*l;if(0>l==h||b>g==h||l>g==h)return null;g=l/g;return{x:Math.round(a.x1+g*c),y:Math.round(a.y1+g*d)}}function d(b,d,e,f,l){function n(a,
e){a={x1:b[a],y1:d[a],x2:2*b[a]-b[a+e],y2:2*d[a]-d[a+e]};for(e=0;4>e;++e){var f=c(a,{x1:q[e].x,y1:q[e].y,x2:q[(e+1)%4].x,y2:q[(e+1)%4].y});if(f)return f.indx=e+.5,f}return null}var q=[{x:0,y:0},{x:g,y:0},{x:g,y:h},{x:0,y:h}];for(e--;e<f-1&&!t;)var t=n(++e,1);for(f++;e<f-1&&t&&!p;)var p=n(--f,-1);if(!t||!p)return"";e=a(b,d,e,f);f=p.indx;l*=.5;for(e+="L"+p.x+","+p.y;.1<Math.abs(f-t.indx);)f=Math.round(f+l)%4,e+="L"+q[f].x+","+q[f].y,f+=l;return e+"L"+t.x+","+t.y+"z"}var b=this,f=this.prepareColorDraw({rounding:!1,
extra:100,original:0!=this.options.Proj}),e=this.getFramePainter(),g=e.getFrameWidth(),h=e.getFrameHeight(),t=this.getContourLevels(),q=this.getHistPalette(),l=e.getProjectionFunc();if(14===this.options.Contour){var u="M0,0h"+g+"v"+h+"h-"+g+"z";if(this.options.Proj){u=f.j2-f.j1;for(var m=new Float32Array(2*u),n=new Float32Array(2*u),k=0;k<u;++k)m[k]=f.origx[f.i1],n[k]=(f.origy[f.j1]*(k+.5)+f.origy[f.j2]*(u-.5-k))/u,m[k+u]=f.origx[f.i2],n[k+u]=(f.origy[f.j2]*(k+.5)+f.origy[f.j1]*(u-.5-k))/u;u=a(m,
n,0,2*u-1,!0)}this.draw_g.append("svg:path").attr("d",u).style("stroke","none").style("fill",q.calcColor(0,t.length))}this.buildContour(f,t,q,function(c,e,f,g,h,l){var n=q.getColor(c);c=n;switch(b.options.Contour){case 11:c="none";var t=new JSROOT.TAttLineHandler({color:n});break;case 12:c="none";t=new JSROOT.TAttLineHandler({color:1,style:l%5+1,width:1});break;case 13:c="none",t=b.lineatt}l=a(e,f,g,h,"none"!=c);"<failed>"==l&&(l=d(e,f,g,h,1));l&&(e=b.draw_g.append("svg:path").attr("class","th2_contour").attr("d",
l).style("fill",c),t?e.call(t.func):e.style("stroke","none"))});f.hide_only_zeros=!0;return f};D.prototype.createPolyBin=function(a,c,d){function b(a,b,d,e){var f=Math.sqrt((a-d)*(a-d)+(b-e)*(b-e));c._sumx+=(a+d)*f/2;c._sumy+=(b+e)*f/2;c._suml+=f}var f="",e,g=1,h=null;"TMultiGraph"==c.fPoly._typename?g=c.fPoly.fGraphs.arr.length:h=c.fPoly;d&&(c._sumx=c._sumy=c._suml=0);for(e=0;e<g;++e){if(!h||0<e)h=c.fPoly.fGraphs.arr[e];var t=h.fNpoints,q=void 0,l=h.fX,u=h.fY,k=Math.round(a.grx(l[0])),n=Math.round(a.gry(u[0])),
m=void 0,p=void 0;2<t&&l[0]==l[t-1]&&u[0]==u[t-1]&&t--;f+="M"+k+","+n;for(q=1;q<t;++q){m=Math.round(a.grx(l[q]));p=Math.round(a.gry(u[q]));d&&b(k,n,m,p);if(k!==m||n!==p)f=k===m?f+("v"+(p-n)):n===p?f+("h"+(m-k)):f+("l"+(m-k)+","+(p-n));k=m;n=p}d&&b(k,n,Math.round(a.grx(l[0])),Math.round(a.gry(u[0])));f+="z"}d&&(0<c._suml?(c._midx=Math.round(c._sumx/c._suml),c._midy=Math.round(c._sumy/c._suml)):(c._midx=Math.round(a.grx((c.fXmin+c.fXmax)/2)),c._midy=Math.round(a.gry((c.fYmin+c.fYmax)/2))));return f};
D.prototype.drawPolyBinsColor=function(){var a=this.getObject(),c=this.getFramePainter(),d=c.getFrameHeight(),b=[],f=[],e,g=a.fBins.arr.length;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;var h=this.getContour(!0),t=this.getHistPalette();for(e=0;e<g;++e){var q=a.fBins.arr[e];var l=h.getPaletteIndex(t,q.fContent);if(null!==l){if(0===q.fContent){if(!this.options.Zero||!this.options.Line)continue;l=0}if(!(q.fXmin>c.scale_xmax||q.fXmax<c.scale_xmin||q.fYmin>c.scale_ymax||
q.fYmax<c.scale_ymin)){var k=this.createPolyBin(c,q,this.options.Text&&q.fContent);b[l]=void 0===b[l]?k:b[l]+k;this.options.Text&&q.fContent&&f.push(q)}}}for(l=0;l<b.length;++l)b[l]&&(q=this.draw_g.append("svg:path").attr("palette-index",l).attr("fill",l?this.fPalette.getColor(l):"none").attr("d",b[l]),this.options.Line&&q.call(this.lineatt.func));if(0<f.length){b=this.getColor(a.fMarkerColor);l=-1*this.options.TextAngle;c=this.draw_g.append("svg:g").attr("class","th2poly_text");q=12;1!==a.fMarkerSize&&
l&&(q=Math.round(.02*d*a.fMarkerSize));this.startTextDrawing(42,q,c,q);for(e=0;e<f.length;++e)q=f[e],a="",this.options.TextKind?(q.fPoly&&(a=q.fPoly.fName),"Graph"===a&&(a=""),a||(a=q.fNumber)):a=Math.round(q.fContent)===q.fContent?q.fContent.toString():v.floatToString(q.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({align:22,x:q._midx,y:q._midy,rotate:l,text:a,color:b,latex:0,draw_g:c});this.finishTextDrawing(c)}return{poly:!0}};D.prototype.drawBinsText=function(a){var c=this.getObject(),
d,b=this.getColor(c.fMarkerColor),f=-1*this.options.TextAngle,e=this.draw_g.append("svg:g").attr("class","th2_text");var g=20;var h=0,t=this.matchObjectType("TProfile2D")&&"function"==typeof c.getBinEntries,q="E"==this.options.TextKind,l=q&&!this.options.TextLine?1:0;null===a&&(a=this.prepareColorDraw({rounding:!1}));1!==c.fMarkerSize&&f&&(g=Math.round(.02*c.fMarkerSize*this.getFramePainter().getFrameHeight()));0!==c.fBarOffset&&(h=.001*c.fBarOffset);this.startTextDrawing(42,g,e,g);for(g=a.i1;g<a.i2;++g)for(d=
a.j1;d<a.j2;++d){var k=c.getBinContent(g+1,d+1);if(0!==k||this._show_empty_bins){var m=a.grx[g+1]-a.grx[g];var n=a.gry[d]-a.gry[d+1];t&&(k=c.getBinEntries(g+1,d+1));k=k===Math.round(k)?k.toString():v.floatToString(k,JSROOT.gStyle.fPaintTextFormat);if(q){var y=c.getBinError(c.getBin(g+1,d+1));y=y===Math.round(y)?y.toString():v.floatToString(y,JSROOT.gStyle.fPaintTextFormat);k=this.options.TextLine?k+("\u00b1"+y):"#splitline{"+k+"}{#pm"+y+"}"}if(f){y=Math.round(a.grx[g]+.5*m);var p=Math.round(a.gry[d+
1]+n*(.5+h));n=m=0}else y=Math.round(a.grx[g]+.1*m),p=Math.round(a.gry[d+1]+n*(.1+h)),m=Math.round(.8*m),n=Math.round(.8*n);this.drawText({align:22,x:y,y:p,width:m,height:n,rotate:f,text:k,color:b,latex:l,draw_g:e})}}this.finishTextDrawing(e);a.hide_only_zeros=!0;return a};D.prototype.drawBinsArrow=function(){for(var a=this.getObject(),c="",d,b,f=1E-30,e,g,h,t,q,l,k=this.prepareColorDraw({rounding:!1}),m=(k.grx[k.i2]-k.grx[k.i1])/(k.i2-k.i1+1-.03)/2,n=(k.gry[k.j2]-k.gry[k.j1])/(k.j2-k.j1+1-.03)/2,
y=0;2>y;++y)for(d=k.i1;d<k.i2;++d)for(b=k.j1;b<k.j2;++b)if(e=d===k.i1?a.getBinContent(d+2,b+1)-a.getBinContent(d+1,b+1):d===k.i2-1?a.getBinContent(d+1,b+1)-a.getBinContent(d,b+1):.5*(a.getBinContent(d+2,b+1)-a.getBinContent(d,b+1)),g=b===k.j1?a.getBinContent(d+1,b+2)-a.getBinContent(d+1,b+1):b===k.j2-1?a.getBinContent(d+1,b+1)-a.getBinContent(d+1,b):.5*(a.getBinContent(d+1,b+2)-a.getBinContent(d+1,b)),0===y)f=Math.max(f,Math.abs(e),Math.abs(g));else if(h=(k.grx[d]+k.grx[d+1])/2,t=(k.gry[b]+k.gry[b+
1])/2,q=m*e/f,e=n*g/f,l=h-q,g=h+q,h=t-e,t+=e,e=Math.round(g-l),g=Math.round(t-h),0!==e||0!==g)if(c+="M"+Math.round(l)+","+Math.round(h)+"l"+e+","+g,5<Math.abs(e)||5<Math.abs(g))t=Math.sqrt(2/(e*e+g*g)),l=Math.round(t*(e+g)),e=Math.round(t*(e-g)),0!==l&&0!==e&&(c+="l"+-l+","+e+"m"+l+","+-e+"l"+-e+","+-l);this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",c).style("fill","none").call(this.lineatt.func);return k};D.prototype.drawBinsBox=function(){var a=this.getObject(),c=this.prepareColorDraw({rounding:!1}),
d=this.getMainPainter();d===this&&(d.maxbin===d.minbin&&(d.maxbin=d.gmaxbin,d.minbin=d.gminbin,d.minposbin=d.gminposbin),d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1)));var b=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),f=Math.max(0,d.minbin),e,g="",h="",t="",q="",l=!1,m=0;if((e=this.getPadPainter().getRootPad(!0))&&e.fLogz&&0<b){l=!0;b=Math.log(b);m=0<f?Math.log(f):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):b-10;m>=b&&(m=b-10);var r=1/(b-m)}else r=
1/(b-f);for(d=c.i1;d<c.i2;++d)for(b=c.j1;b<c.j2;++b){e=a.getBinContent(d+1,b+1);var n=Math.abs(e);if(!(0===n||n<f)){var y=l?0<n?Math.log(n)-m:0:n-f;y=.5*(0>y?1:1-Math.sqrt(y*r));0>y&&(y=0);n=c.grx[d+1]-c.grx[d];var p=c.gry[b]-c.gry[b+1];var v=y*n;var w=y*p;y=Math.round(c.grx[d]+v);var x=Math.round(c.gry[b+1]+w);n=Math.max(Math.round(n-2*v),1);p=Math.max(Math.round(p-2*w),1);g+="M"+y+","+x+"v"+p+"h"+n+"v-"+p+"z";0>e&&10===this.options.BoxStyle&&(h+="M"+y+","+x+"l"+n+","+p+"M"+(y+n)+","+x+"l-"+n+","+
p);if(11===this.options.BoxStyle&&5<n&&5<p){w=Math.round(.1*n);var B=Math.round(.1*p);v="M"+y+","+x+"h"+n+"l"+-w+","+B+"h"+(2*w-n)+"v"+(p-2*B)+"l"+-w+","+B+"z";n="M"+(y+n)+","+(x+p)+"v"+-p+"l"+-w+","+B+"v"+(p-2*B)+"h"+(2*w-n)+"l"+-w+","+B+"z";0>e?(q+=v,t+=n):(t+=v,q+=n)}}}0<g.length&&(a=this.draw_g.append("svg:path").attr("d",g).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<t.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",
t).style("stroke","none").call(this.fillatt.func).style("fill",k.rgb(this.fillatt.color).brighter(.5).toString());0<q.length&&this.draw_g.append("svg:path").attr("d",q).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":k.rgb(this.fillatt.color).darker(.5).toString());0<h.length&&(h=this.draw_g.append("svg:path").attr("d",h).style("fill","none"),"none"!==this.lineatt.color?h.call(this.lineatt.func):h.style("stroke","black"));return c};D.prototype.drawBinsCandle=
function(){var a=this.getHisto(),c=this.prepareColorDraw(),d=this.getFramePainter(),b,f,e,g,h,k="",q="";1===a.fMarkerColor&&(a.fMarkerColor=a.fLineColor);this.createAttMarker({attr:a,style:5});this.markeratt.resetPos();c.candle=[];for(f=c.i1;f<c.i2;++f){for(b=g=h=e=0;b<this.nbinsy;++b)h+=a.getBinContent(f+1,b+1);var l={bin:f,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(b=0;b<this.nbinsy;++b){var m=a.getBinContent(f+1,b+1);var r=a.fYaxis.GetBinCenter(b+1);.001>g/h&&.001<=(g+m)/h&&
(l.whiskerm=r);.25>g/h&&.25<=(g+m)/h&&(l.m25y=r);.5>g/h&&.5<=(g+m)/h&&(l.median=r);.75>g/h&&.75<=(g+m)/h&&(l.p25y=r);.999>g/h&&.999<=(g+m)/h&&(l.whiskerp=r);g+=m;e+=m*r}0<g&&(l.meany=e/g);l.iqr=l.p25y-l.m25y;l.m25y-1.5*l.iqr>l.whsikerm&&(l.whiskerm=l.m25y-1.5*l.iqr);l.p25y+1.5*l.iqr<l.whiskerp&&(l.whiskerp=l.p25y+1.5*l.iqr);if(!(d.logy&&0>=l.whiskerm)){b=c.grx[f+1]-c.grx[f];b*=.66;e=(c.grx[f+1]+c.grx[f])/2+a.fBarOffset/1E3*b;0<a.fBarWidth&&(b=b*a.fBarWidth/1E3);l.x1=Math.round(e-b/2);l.x2=Math.round(e+
b/2);e=Math.round(e);l.y0=Math.round(d.gry(l.median));k+="M"+l.x1+","+l.y0+"h"+(l.x2-l.x1);l.y1=Math.round(d.gry(l.p25y));l.y2=Math.round(d.gry(l.m25y));k+="M"+l.x1+","+l.y1+"v"+(l.y2-l.y1)+"h"+(l.x2-l.x1)+"v-"+(l.y2-l.y1)+"z";l.yy1=Math.round(d.gry(l.whiskerp));l.yy2=Math.round(d.gry(l.whiskerm));k+="M"+e+","+l.y1+"v"+(l.yy1-l.y1);k+="M"+l.x1+","+l.yy1+"h"+(l.x2-l.x1);k+="M"+e+","+l.y2+"v"+(l.yy2-l.y2);k+="M"+l.x1+","+l.yy2+"h"+(l.x2-l.x1);for(b=0;b<this.nbinsy;++b)m=a.getBinContent(f+1,b+1),r=a.fYaxis.GetBinCenter(b+
1),0<m&&r<l.whiskerm&&(q+=this.markeratt.create(e,r)),0<m&&r>l.whiskerp&&(q+=this.markeratt.create(e,r));c.candle.push(l)}}0<k.length&&this.draw_g.append("svg:path").attr("d",k).call(this.lineatt.func).call(this.fillatt.func);0<q.length&&this.draw_g.append("svg:path").attr("d",q).call(this.markeratt.func);return c};D.prototype.drawBinsScatter=function(){var a=this.getObject(),c=this.prepareColorDraw({rounding:!0,pixel_density:!0}),d=[],b=[],f=[],e=[],g=[],h,k,m=1,l=this.options.ScatCoef*(2E3<this.gmaxbin?
2E3/this.gmaxbin:1);JSROOT.seed(c.sumz);if(1E5>l*c.sumz){this.createAttMarker({attr:a});this.markeratt.resetPos();d="";for(h=c.i1;h<c.i2;++h){var u=c.grx[h+1]-c.grx[h];for(k=c.j1;k<c.j2;++k){var r=c.gry[k]-c.gry[k+1];var n=a.getBinContent(h+1,k+1);e=Math.round(l*n);if(!(0>=e))for(g=0;g<e;++g)d+=this.markeratt.create(Math.round(c.grx[h]+u*JSROOT.random()),Math.round(c.gry[k+1]+r*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func);return c}.7<this.maxbin&&(m=.7/this.maxbin);
l=Math.round(c.max-c.min);l=this.createContour(50<l?50:l,this.minposbin,this.maxbin,this.minposbin);for(h=c.i1;h<c.i2;++h)for(k=c.j1;k<c.j2;++k)if(n=a.getBinContent(h+1,k+1),!(0>=n||n<this.minbin||(u=c.grx[h+1]-c.grx[h],r=c.gry[k]-c.gry[k+1],0>=u*r||(n=l.getContourIndex(n/u/r),0>n)))){var v="M"+c.grx[h]+","+c.gry[k+1];if(void 0===d[n])d[n]=v,e[n]=u,g[n]=r;else{var p="m"+(c.grx[h]-b[n])+","+(c.gry[k+1]-f[n]);d[n]+=p.length<v.length?p:v;e[n]=Math.max(e[n],u);g[n]=Math.max(g[n],r)}b[n]=c.grx[h];f[n]=
c.gry[k+1];d[n]+="v"+r+"h"+u+"v-"+r+"z"}n=this.getFrameSvg().select(".main_layer");h=n.select("defs");h.empty()&&0<d.length&&(h=n.insert("svg:defs",":first-child"));this.createAttMarker({attr:a});for(n=0;n<d.length;++n)if(void 0!==d[n]&&n<l.arr.length){k="scatter_"+n;a=h.select("."+k);a.empty()?a=h.append("svg:pattern").attr("class",k).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):a.selectAll("*").remove();k=Math.round(m*l.arr[n]*e[n]*g[n]);1>k&&
(k=1);u=new Float32Array(k);r=new Float32Array(k);if(1===k)u[0]=r[0]=.5;else for(b=0;b<k;++b)u[b]=JSROOT.random(),r[b]=JSROOT.random();this.markeratt.resetPos();b="";for(f=0;f<k;++f)b+=this.markeratt.create(u[f]*e[n],r[f]*g[n]);a.attr("width",e[n]).attr("height",g[n]).append("svg:path").attr("d",b).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",n).attr("fill","url(#"+a.attr("id")+")").attr("d",d[n])}return c};D.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();
this.createHistDrawAttributes();this.createG(!0);var a=null;this.isTH2Poly()?a=this.drawPolyBinsColor():(this.options.Scat?a=this.drawBinsScatter():this.options.Color?a=this.drawBinsColor():this.options.Box?a=this.drawBinsBox():this.options.Arrow?a=this.drawBinsArrow():this.options.Contour?a=this.drawBinsContour():this.options.Candle&&(a=this.drawBinsCandle()),this.options.Text&&(a=this.drawBinsText(a)),a||(a=this.drawBinsScatter()));this.tt_handle=a};D.prototype.getBinTooltips=function(a,c){var d=
[],b=this.getHisto(),f=b.getBinContent(a+1,c+1);d.push(this.getObjectHint());d.push("x = "+this.getAxisBinTip("x",b.fXaxis,a));d.push("y = "+this.getAxisBinTip("y",b.fYaxis,c));d.push("bin = "+a+", "+c);b.$baseh&&(f-=b.$baseh.getBinContent(a+1,c+1));d.push("entries = "+(f===Math.round(f)?f:v.floatToString(f,JSROOT.gStyle.fStatFormat)));if("E"==this.options.TextKind||this.matchObjectType("TProfile2D"))a=b.getBinError(b.getBin(a+1,c+1)),d.push("error = "+(a===Math.round(a)?a.toString():v.floatToString(a,
JSROOT.gStyle.fPaintTextFormat)));return d};D.prototype.getCandleTooltips=function(a){var c=[],d=this.getFramePainter(),b=this.getHisto();c.push(this.getObjectHint());c.push("x = "+d.axisAsText("x",b.fXaxis.GetBinLowEdge(a.bin+1)));c.push("mean y = "+v.floatToString(a.meany,JSROOT.gStyle.fStatFormat));c.push("m25 = "+v.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));c.push("p25 = "+v.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return c};D.prototype.getPolyBinTooltips=function(a,c,d){a=this.getHisto().fBins.arr[a];
var b=this.getFramePainter(),f=a.fPoly.fName,e=[],g=0;"Graph"===f&&(f="");0===f.length&&(f=a.fNumber);if(void 0===c&&void 0===d){c=d=0;var h=a.fPoly,k=1;"TMultiGraph"===h._typename&&(k=a.fPoly.fGraphs.arr.length,h=null);for(var m=0;m<k;++m){if(!h||0<m)h=a.fPoly.fGraphs.arr[m];for(var l=0;l<h.fNpoints;++l)++g,c+=h.fX[l],d+=h.fY[l]}1<g&&(c/=g,d/=g)}e.push(this.getObjectHint());e.push("x = "+b.axisAsText("x",c));e.push("y = "+b.axisAsText("y",d));0<g&&e.push("npnts = "+g);e.push("bin = "+f);a.fContent===
Math.round(a.fContent)?e.push("content = "+a.fContent):e.push("content = "+v.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));return e};D.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.getHisto(),d=this.tt_handle,b=this.draw_g.select(".tooltip_bin");if(d.poly){d=this.getFramePainter();var f=-1,e=d.revertAxis("x",a.x),g=d.revertAxis("y",a.y);if(void 0!==
e&&void 0!==g)for(var h=c.fBins.arr.length,k=0;k<h&&0>f;++k){var m=c.fBins.arr[k];if(!(e<m.fXmin||e>m.fXmax||g<m.fYmin||g>m.fYmax||0===m.fContent&&!this.options.Zero)){var l=m.fPoly,u=1;"TMultiGraph"===l._typename&&(u=m.fPoly.fGraphs.arr.length,l=null);for(var r=0;r<u;++r){if(!l||0<r)l=m.fPoly.fGraphs.arr[r];if(l.IsInside(e,g)){f=k;break}}}}if(0>f)return b.remove(),null;e={name:c.fName,title:c.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):
"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(f,e,g)};a.disabled?(b.remove(),e.changed=!0):(b.empty()&&(b=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),e.changed=b.property("current_bin")!==f,e.changed&&b.attr("d",this.createPolyBin(d,m)).style("opacity","0.7").property("current_bin",f));e.changed&&(e.user_info={obj:c,name:c.fName,bin:f,cont:m.fContent,grx:a.x,gry:a.y});return e}if(d.candle){for(f=0;f<d.candle.length;++f){var n=d.candle[f];
if(n.x1<=a.x&&a.x<=n.x2&&n.yy1<=a.y&&a.y<=n.yy2)break}if(f>=d.candle.length)return b.remove(),null;d={name:c.fName,title:c.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(n),exact:!0,menu:!0};a.disabled?(b.remove(),d.changed=!0):(b.empty()&&(b=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),d.changed=b.property("current_bin")!==f,d.changed&&
b.attr("x",n.x1).attr("width",n.x2-n.x1).attr("y",n.yy1).attr("height",n.yy2-n.yy1).style("opacity","0.7").property("current_bin",f));d.changed&&(d.user_info={obj:c,name:c.fName,bin:f+1,cont:n.median,binx:f+1,biny:1,grx:a.x,gry:a.y});return d}var v=0,p=null,x=this.getFramePainter();if(x.reverse_x)for(m=d.i1;m<d.i2&&!(a.x<=d.grx[m]&&a.x>=d.grx[m+1]);++m);else for(m=d.i1;m<d.i2&&!(a.x>=d.grx[m]&&a.x<=d.grx[m+1]);++m);if(x.reverse_y)for(n=d.j1;n<d.j2&&!(a.y<=d.gry[n+1]&&a.y>=d.gry[n]);++n);else for(n=
d.j1;n<d.j2&&!(a.y>=d.gry[n+1]&&a.y<=d.gry[n]);++n);if(m<d.i2&&n<d.j2){f=m;e=m+1;g=n;h=n+1;k=d.grx[f];l=d.grx[e];u=d.gry[h];r=d.gry[g];p=!0;if(this.options.Color){v=l-k;var w=r-u;l=Math.round(k+v*d.xbar2);k=Math.round(k+v*d.xbar1);r=Math.round(u+w*d.ybar2);u=Math.round(u+w*d.ybar1);if(x.reverse_x){if(a.x>k||a.x<=l)p=!1}else if(a.x<k||a.x>=l)p=!1;if(x.reverse_y){if(a.y>u||a.y<=r)p=!1}else if(a.y<u||a.y>=r)p=!1}v=c.getBinContent(m+1,n+1);this.is_projection?p=0:p?d.hide_only_zeros?p=0!==v||this._show_empty_bins?
0:null:(p=this.getContour().getPaletteIndex(this.getHistPalette(),v),null===p&&0===v&&this._show_empty_bins&&(p=0)):p=null}if(null===p)return b.remove(),null;x={name:c.fName,title:c.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(m,n),exact:!0,menu:!0};this.options.Color&&(x.color2=this.getHistPalette().getColor(p));a.disabled&&!this.is_projection?(b.remove(),x.changed=!0):(b.empty()&&(b=this.draw_g.append("svg:path").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),p=1E4*m+n,"X"==this.is_projection?(k=0,l=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(u=(this.projection_width-1)/2,h+u>=d.j2?(h=Math.min(Math.round(h+u),d.j2),g=Math.max(h-this.projection_width,d.j1)):(g=Math.max(Math.round(g-u),d.j1),h=Math.min(g+this.projection_width,d.j2))),u=d.gry[h],r=d.gry[g],p=777*g+333*h):"Y"==this.is_projection&&(u=0,r=this.getFramePainter().getFrameHeight(),1<this.projection_width&&(k=(this.projection_width-
1)/2,e+k>=d.i2?(e=Math.min(Math.round(e+k),d.i2),f=Math.max(e-this.projection_width,d.i1)):(f=Math.max(Math.round(f-k),d.i1),e=Math.min(f+this.projection_width,d.i2))),k=d.grx[f],l=d.grx[e],p=777*f+333*e),x.changed=b.property("current_bin")!==p,x.changed&&b.attr("d","M"+k+","+u+"h"+(l-k)+"v"+(r-u)+"h"+(k-l)+"z").style("opacity","0.7").property("current_bin",p),this.is_projection&&x.changed&&this.redrawProjection(f,e,g,h));x.changed&&(x.user_info={obj:c,name:c.fName,bin:c.getBin(m+1,n+1),cont:v,binx:m+
1,biny:n+1,grx:a.x,gry:a.y});return x};D.prototype.canZoomInside=function(a,c,d){if("z"==a)return!0;var b=this.getHisto();b&&(b="y"==a?b.fYaxis:b.fXaxis);return!b||1<b.FindBin(d,.5)-b.FindBin(c,0)};D.prototype.draw2D=function(){var a=this;this.clear3DScene();return this.drawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),!0).then(function(c){return a.drawAxes().then(function(){a.draw2DBins();return c?c.drawPave():!0})}).then(function(){return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();
return a.addInteractivity()})};D.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return c.draw3D(a)})};D.prototype.callDrawFunc=function(a){var c=this.getMainPainter(),d=this.getFramePainter();c!==this&&d&&d.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(c);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};D.prototype.redraw=function(a){return this.callDrawFunc(a)};var ba=function(a,c,d){var b=new JSROOT.TH2Painter(a,c);return v.ensureTCanvas(b).then(function(){b.setAsMainPainter();
b.decodeOptions(d);b.isTH2Poly()&&(b.options.Mode3D?b.options.Lego=12:b.options.Color||(b.options.Color=!0));b._show_empty_bins=!1;b._can_move_colz=!0;b.checkPadRange(!b.options.Mode3D&&14!=b.options.Contour);b.scanContent();b.createStat();return b.callDrawFunc()}).then(function(){return b.drawNextFunction(0)}).then(function(){!b.Mode3D&&b.options.AutoZoom&&b.autoZoom();b.fillToolbar();b.options.Project&&!b.mode3d&&b.toggleProjection(b.options.Project);return b})};H.prototype=Object.create(JSROOT.ObjectPainter.prototype);
H.prototype.cleanup=function(){var a=this,c=this.getPadPainter();c&&c.cleanPrimitives(function(c){return c===a.firstpainter||0<=a.painters.indexOf(c)});delete this.firstpainter;delete this.painters;JSROOT.ObjectPainter.prototype.cleanup.call(this)};H.prototype.buildStack=function(a){if(!a.fHists)return!1;var c=a.fHists.arr.length;if(0>=c)return!1;var d=JSROOT.create("TList");d.Add(JSROOT.clone(a.fHists.arr[0]),a.fHists.opt[0]);for(var b=1;b<c;++b){var f=JSROOT.clone(a.fHists.arr[b]),e=a.fHists.opt[b],
g=d.arr[b-1];if(f.fNbins!=g.fNbins||f.fXaxis.fXmin!=g.fXaxis.fXmin||f.fXaxis.fXmax!=g.fXaxis.fXmax)return console.warn("When drawing THStack, cannot sum-up histograms "+f.fName+" and "+g.fName),d.Clear(),!1;for(var h=0;h<f.fArray.length;++h)f.fArray[h]+=g.fArray[h];d.Add(f,e)}a.fStack=d;return!0};H.prototype.getMinMax=function(a){function c(a,b){var c={min:0,max:0},d=!0,e=!0;-1111!==a.fMinimum&&(c.min=a.fMinimum,d=!1);-1111!==a.fMaximum&&(c.max=a.fMaximum,e=!1);if(!d&&!e)return c;var f=1,g=a.fXaxis.fNbins,
h=1,k=1,m=!0;a.fXaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(f=a.fXaxis.fFirst,g=a.fXaxis.fLast);0===a._typename.indexOf("TH2")&&(k=a.fYaxis.fNbins,a.fYaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(h=a.fYaxis.fFirst,k=a.fYaxis.fLast));for(;h<=k;++h)for(var t=f;t<=g;++t){var v=a.getBinContent(t,h),x=b?a.getBinError(a.getBin(t,h)):0;d&&(m||v-x<c.min)&&(c.min=v-x);e&&(m||v+x>c.max)&&(c.max=v+x);m=!1}return c}var d={min:0,max:0},b=this.getObject(),f=this.getPadPainter().getRootPad(!0);if(this.options.nostack)for(var e=
0;e<b.fHists.arr.length;++e){var g=c(b.fHists.arr[e],a);0==e?d=g:(d.min=Math.min(d.min,g.min),d.max=Math.max(d.max,g.max))}else d.min=c(b.fStack.arr[0],a).min,d.max=c(b.fStack.arr[b.fStack.arr.length-1],a).max;-1111!=b.fMaximum&&(d.max=b.fMaximum);d.max*=1.05;-1111!=b.fMinimum&&(d.min=b.fMinimum);f&&(1==this.options.ndim?f.fLogy:f.fLogz)?(0>=d.max&&(d.max=1),0>=d.min&&(d.min=1E-4*d.max),a=1+.2*Math.log10(d.max/d.min),d.min*=1/(1+.5*Math.log10(d.max/d.min)),d.max*=a):0<d.min&&d.min<.05*d.max&&(d.min=
0);return d};H.prototype.drawNextHisto=function(a){var c=this,d=this.getObject(),b=(d=this.options.nostack?d.fHists:d.fStack)&&d.arr?d.arr.length:0;if(a>=b)return Promise.resolve(this);var f=this.options.horder?a:b-a-1,e=d.arr[f],g=d.opt[f]||e.fOption||this.options.hopt;0>g.toUpperCase().indexOf(this.options.hopt)&&(g+=this.options.hopt);this.options.draw_errors&&!g&&(g="E");g+=" same nostat";if(this.options._pfc||this.options._plc||this.options._pmc){var h=this.getMainPainter();h&&h.createAutoColor&&
(b=h.createAutoColor(b),this.options._pfc&&(e.fFillColor=b),this.options._plc&&(e.fLineColor=b),this.options._pmc&&(e.fMarkerColor=b))}0<f&&!this.options.nostack&&(e.$baseh=d.arr[f-1]);return JSROOT.draw(this.getDom(),e,g).then(function(b){c.painters.push(b);return c.drawNextHisto(a+1)})};H.prototype.decodeOptions=function(a){this.options||(this.options={});JSROOT.extend(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});var c=this.getObject(),d=c.fHistogram||
(c.fHists?c.fHists.arr[0]:null)||(c.fStack?c.fStack.arr[0]:null);d&&0==d._typename.indexOf("TH2")&&(this.options.ndim=2);2!=this.options.ndim||a||(a="lego1");if(c.fHists&&!this.options.nostack)for(d=0;d<c.fHists.arr.length;++d){var b=this.options,f;if(!(f=this.options.has_errors))a:{f=c.fHists.arr[d];if(f.fSumw2&&0<f.fSumw2.length)for(var e=0;e<f.fSumw2.length;++e)if(0<f.fSumw2[e]){f=!0;break a}f=!1}b.has_errors=f}a=new JSROOT.DrawOptions(a);this.options.nostack=a.check("NOSTACK");a.check("STACK")&&
(this.options.nostack=!1);this.options.same=a.check("SAME");this.options._pfc=a.check("PFC");this.options._plc=a.check("PLC");this.options._pmc=a.check("PMC");this.options.hopt=a.remain();c=a.check("LEGO");this.options.errors=a.check("E");!this.options.nostack&&this.options.has_errors&&!c&&!a.check("HIST")&&0>this.options.hopt.indexOf("E")&&(this.options.draw_errors=!0);this.options.horder=this.options.nostack||c};H.prototype.createHistogram=function(a){var c=a.fHists,d=c?c.arr.length:0;if(!d)return c=
JSROOT.createHistogram("TH1I",100),c.fTitle=a.fTitle,c;var b=c.arr[0],f=JSROOT.createHistogram(1==this.options.ndim?"TH1I":"TH2I",b.fXaxis.fNbins,b.fYaxis.fNbins);f.fName="axis_hist";JSROOT.extend(f.fXaxis,b.fXaxis);2==this.options.ndim&&JSROOT.extend(f.fYaxis,b.fYaxis);for(b=1;b<d;++b){var e=c.arr[b];f.fXaxis.fLabels||(f.fXaxis.fXmin=Math.min(f.fXaxis.fXmin,e.fXaxis.fXmin),f.fXaxis.fXmax=Math.max(f.fXaxis.fXmax,e.fXaxis.fXmax));2!=this.options.ndim||f.fYaxis.fLabels||(f.fYaxis.fXmin=Math.min(f.fYaxis.fXmin,
e.fYaxis.fXmin),f.fYaxis.fXmax=Math.max(f.fYaxis.fXmax,e.fYaxis.fXmax))}f.fTitle=a.fTitle;return f};H.prototype.updateObject=function(a){var c=this;if(!this.matchObjectType(a))return!1;var d=this.getObject();d.fHists=a.fHists;d.fStack=a.fStack;d.fTitle=a.fTitle;this.options.nostack||(this.options.nostack=!this.buildStack(d));this.firstpainter&&(a=a.fHistogram,a||(a=d.fHistogram=this.createHistogram(d)),this.firstpainter.updateObject(a),a=this.getMinMax(this.options.errors||this.options.draw_errors),
this.firstpainter.options.minimum=a.min,this.firstpainter.options.maximum=a.max,1==this.options.ndim&&(this.firstpainter.ymin=a.min,this.firstpainter.ymax=a.max));a=(d=this.options.nostack?d.fHists:d.fStack)&&d.arr?d.arr.length:0;if(a!==this.painters.length)(d=this.getPadPainter())&&d.cleanPrimitives(function(a){return 0<=c.painters.indexOf(a)}),this.painters=[],this.did_update=!0;else for(var b=0;b<a;++b)this.painters[b].updateObject(d.arr[this.options.horder?b:a-b-1]);return!0};H.prototype.redraw=
function(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0)};v.getColorPalette=F;v.drawPave=R;v.produceLegend=function(a,c){var d=v.getElementMainPainter(a);if(d){var b=d.getPadPainter();d=b.getRootPad(!0);if(b&&d){for(var f=JSROOT.create("TLegend"),e=0;e<b.painters.length;++e){var g=b.painters[e],h=g.getObject();if(h){var k=JSROOT.create("TLegendEntry");k.fObject=h;k.fLabel="all"==c?h.fName:g.getItemName();k.fOption="";k.fLabel&&(g.lineatt&&g.lineatt.used&&(k.fOption+="l"),
g.fillatt&&g.fillatt.used&&(k.fOption+="f"),g.markeratt&&g.markeratt.used&&(k.fOption+="m"),k.fOption||(k.fOption="l"),f.fPrimitives.Add(k))}}if(c=f.fPrimitives.arr.length)return 8<c&&(c=8),c*=.1,f.fX1NDC=.4*d.fLeftMargin+.6*(1-d.fRightMargin),f.fY1NDC=(1-c)*(1-d.fTopMargin)+c*d.fBottomMargin,f.fX2NDC=.99-d.fRightMargin,f.fY2NDC=.99-d.fTopMargin,f.fFillStyle=1001,R(a,f)}}};v.drawHistogram1D=function(a,c,d){var b=new E(a,c);return v.ensureTCanvas(b).then(function(){b.setAsMainPainter();b.decodeOptions(d);
b.checkPadRange(!b.options.Mode3D);b.scanContent();b.createStat();return b.callDrawFunc()}).then(function(){return b.drawNextFunction(0)}).then(function(){!b.options.Mode3D&&b.options.AutoZoom&&b.autoZoom();b.fillToolbar();return b})};v.drawHistogram2D=ba;v.drawTF2=function(a,c,d){var b=new JSROOT.DrawOptions(d),f=O(c,b.check("NOSAVE"));d=b.empty()?"cont3":"SAME"===b.opt?"cont2 same":b.opt;return ba(a,f,d).then(function(a){a.tf2_typename=c._typename;a.tf2_nosave=b.check("NOSAVE");a.updateObject=function(a){if(!a||
this.tf2_typename!=a._typename)return!1;O(a,this.tf2_nosave,this.getHisto());return!0};return a})};v.drawHStack=function(a,c,d){if(!c.fHists||!c.fHists.arr)return null;var b=new H(a,c,d);return v.ensureTCanvas(b,!1).then(function(){b.decodeOptions(d);b.options.nostack||(b.options.nostack=!b.buildStack(c));if(!b.options.same){c.fHistogram||(c.fHistogram=b.createHistogram(c));var f=b.getMinMax(b.options.errors||b.options.draw_errors),e=b.options.hopt+" axis";f&&(e+=";minimum:"+f.min+";maximum:"+f.max);
return JSROOT.draw(a,c.fHistogram,e).then(function(a){b.firstpainter=a})}}).then(function(){return b.drawNextHisto(0)})};JSROOT.TPavePainter=x;JSROOT.THistPainter=m;JSROOT.TH1Painter=E;JSROOT.TH2Painter=D;JSROOT.THStackPainter=H;return JSROOT});
