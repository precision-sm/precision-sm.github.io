var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var f=0;return function(){return f<c.length?{done:!1,value:c[f++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,f,e){c!=Array.prototype&&c!=Object.prototype&&(c[f]=e.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(c,f){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function c(e){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+f++,e)}var f=0;return c}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.asyncIterator;c||(c=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};
$jscomp.iteratorFromArray=function(c,f){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var e=0,a={next:function(){if(e<c.length){var b=e++;return{value:f(b,c[b]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill=function(c,f,e,a){if(f){e=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var b=c[a];b in e||(e[b]={});e=e[b]}c=c[c.length-1];a=e[c];f=f(a);f!=a&&null!=f&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6","es3");$jscomp.makeIterator=function(c){var f="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return f?f.call(c):$jscomp.arrayIterator(c)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function f(){this.batch_=null}function e(a){return a instanceof b?a:new b(function(b,d){b(a)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;f.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var a=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(b){a(b,0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.asyncThrow_(n)}}}this.batch_=null};f.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var b=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};b.prototype.createResolveAndReject_=function(){function a(a){return function(c){d||(d=!0,a.call(b,c))}}var b=this,d=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};b.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var d=null!=a;break a;case "function":d=!0;break a;default:d=!1}d?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};b.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};b.prototype.reject_=function(a){this.settle_(2,a)};b.prototype.fulfill_=function(a){this.settle_(1,a)};b.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)d.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var d=new f;b.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};b.prototype.settleSameAsThenable_=function(a,b){var d=this.createResolveAndReject_();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};b.prototype.then=function(a,d){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(p){g(p)}}:b}var e,g,f=new b(function(a,b){e=a;g=b});this.callWhenSettled_(c(a,e),c(d,g));return f};
b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?d.asyncExecute(c):this.onSettledCallbacks_.push(c)};b.resolve=e;b.reject=function(a){return new b(function(b,d){d(a)})};b.race=function(a){return new b(function(b,d){for(var c=$jscomp.makeIterator(a),f=c.next();!f.done;f=c.next())e(f.value).callWhenSettled_(b,
d)})};b.all=function(a){var d=$jscomp.makeIterator(a),c=d.next();return c.done?e([]):new b(function(a,b){function f(b){return function(d){m[b]=d;g--;0==g&&a(m)}}var m=[],g=0;do m.push(void 0),g++,e(c.value).callWhenSettled_(f(m.length-1),b),c=d.next();while(!c.done)})};return b},"es6","es3");
JSROOT.define([],function(){function c(a,b,d){this.path=a;this.req=this.connid=null;this.raw=b;this.args=d;this.nextRequest("","connect")}function f(a){var b=this;this.receiver=a;this.protocol=[];this.cnt=0;JSROOT.httpRequest("protocol.json","text").then(function(a){return b.getProtocol(a)})}function e(a,b){this.kind=a;this.state=0;this.ackn=this.cansend=this.credits=b||10}c.prototype.nextRequest=function(a,b){var d=this.path,c="buf",e=null;if("connect"===b)d+=this.raw?"?raw_connect":"?txt_connect",
this.args&&(d+="&"+this.args),console.log("longpoll connect "+d+" raw = "+this.raw),this.connid="connect";else if("close"===b){if(null===this.connid||"close"===this.connid)return;d+="?connection="+this.connid+"&close";this.connid="close";c="text;sync"}else{if(null===this.connid||"number"!==typeof this.connid){JSROOT.browser.qt5||console.error("No connection");return}d+="?connection="+this.connid;"dummy"===b&&(d+="&dummy")}a&&(this.raw?d+="&post="+btoa(a):(c="postbuf",e=a));a=JSROOT.NewHttpRequest(d,
c,function(a){this.handle.req===this&&(this.handle.req=null);if(null===a)return this.handle.processRequest(null);if(this.handle.raw){var b="",d=0,c=new Uint8Array(a),e=c.length;if(4>e)return JSROOT.browser.qt5||console.error("longpoll got short message in raw mode "+e),this.handle.processRequest(null);for(;4>d;)b+=String.fromCharCode(c[d++]);if("txt:"!=b){for(b="";d<e&&":"!=String.fromCharCode(c[d]);)b+=String.fromCharCode(c[d++]);++d;e=d+parseInt(b.trim())}for(b="";d<e;)b+=String.fromCharCode(c[d++]);
b&&("<<nope>>"==b?this.handle.processRequest(-1111):this.handle.processRequest(b));e<c.length&&this.handle.processRequest(a,e)}else if("application/x-binary"==this.getResponseHeader("Content-Type"))(b=this.getResponseHeader("LongpollHeader"))&&this.handle.processRequest(b),this.handle.processRequest(a,0);else{if(a&&"string"!==typeof a){b="";a=new Uint8Array(a);for(d=0;d<a.length;++d)b+=String.fromCharCode(a[d]);a=b}"<<nope>>"==a?this.handle.processRequest(-1111):this.handle.processRequest(a)}},function(a,
b){this.handle.processRequest(null,"error")});a.handle=this;this.req||(this.req=a);a.send(e)};c.prototype.processRequest=function(a,b){var d=this;if(null===a){if("function"===typeof this.onerror)this.onerror("receive data with connid "+(this.connid||"---"));if("error"==b&&"function"===typeof this.onclose)this.onclose("force_close");this.connid=null}else{-1111===a&&(a="");var c=5;if("connect"===this.connid){if(!a){this.connid=null;if("function"===typeof this.onerror)this.onerror("connection rejected");
return}this.connid=parseInt(a);c=100;console.log("Get new longpoll connection with id "+this.connid);if("function"==typeof this.onopen)this.onopen()}else{if("close"===this.connid){if("function"==typeof this.onclose)this.onclose();return}if("function"===typeof this.onmessage&&a)this.onmessage({data:a,offset:b})}this.req||setTimeout(function(){d.req||d.nextRequest("","dummy")},c)}};c.prototype.send=function(a){this.nextRequest(a)};c.prototype.close=function(){this.nextRequest("","close")};f.prototype.getProtocol=
function(a){if(a){this.protocol=JSON.parse(a);if("function"==typeof this.onopen)this.onopen();this.nextOperation()}};f.prototype.send=function(){var a=this;"send"==this.protocol[this.cnt]&&(this.cnt++,setTimeout(function(){return a.nextOperation()},10))};f.prototype.close=function(){};f.prototype.nextOperation=function(){var a=this;if(!this.wait_for_file){var b=this.protocol[this.cnt];b&&"send"!=b&&(this.wait_for_file=!0,this.cnt++,JSROOT.httpRequest(b,0<b.indexOf(".bin")?"buf":"text").then(function(b){a.wait_for_file=
!1;b&&(a.receiver.provideData&&a.receiver.provideData(1,b,0),setTimeout(function(){return a.nextOperation()},10))}))}};e.prototype.getUserArgs=function(a){return a&&"string"==typeof a?this.user_args&&"object"==typeof this.user_args?this.user_args[a]:void 0:this.user_args};e.prototype.setUserArgs=function(a){this.user_args=a};e.prototype.setReceiver=function(a){this.receiver=a};e.prototype.cleanup=function(){delete this.receiver;this.close(!0)};e.prototype.invokeReceiver=function(a,b,d,c){if(this.receiver&&
"function"==typeof this.receiver[b])this.receiver[b](this,d,c);if(a&&this.channels){a=Object.keys(this.channels);for(var e=0;e<a.length;++e)this.channels[a[e]].invokeReceiver(!1,b,d,c)}};e.prototype.provideData=function(a,b,d){if(this.wait_first_recv)return console.log("FIRST MESSAGE",a,b),delete this.wait_first_recv,this.invokeReceiver(!1,"onWebsocketOpened");if(1<a&&this.channels&&(a=this.channels[a]))return a.provideData(1,b,d);a=d&&0>d;if(!(a||this.msgqueue&&this.msgqueue.length))return this.invokeReceiver(!1,
"onWebsocketMsg",b,d);this.msgqueue||(this.msgqueue=[]);a&&(d=void 0);this.msgqueue.push({ready:!0,msg:b,len:d})};e.prototype.reserveQueueItem=function(){this.msgqueue||(this.msgqueue=[]);var a={ready:!1,msg:null,len:0};this.msgqueue.push(a);return a};e.prototype.markQueueItemDone=function(a,b,d){a.ready=!0;a.msg=b;a.len=d;this.processQueue()};e.prototype.processQueue=function(){if(!this._loop_msgqueue&&this.msgqueue){for(this._loop_msgqueue=!0;0<this.msgqueue.length&&this.msgqueue[0].ready;){var a=
this.msgqueue.shift();this.invokeReceiver(!1,"onWebsocketMsg",a.msg,a.len)}0==this.msgqueue.length&&delete this.msgqueue;delete this._loop_msgqueue}};e.prototype.close=function(a){this.master?(this.master.send("CLOSECH="+this.channelid,0),delete this.master.channels[this.channelid],delete this.master):(this.timerid&&(clearTimeout(this.timerid),delete this.timerid),this._websocket&&0<this.state&&(this.state=a?-1:0,this._websocket.onclose=null,this._websocket.close(),delete this._websocket))};e.prototype.canSend=
function(a){return this.cansend>=(a||1)};e.prototype.getRelCanSend=function(){return this.credits?this.cansend/this.credits:1};e.prototype.send=function(a,b){var d=this;if(this.master)return this.master.send(a,this.channelid);if(!this._websocket||0>=this.state)return!1;Number.isInteger(b)||(b=1);0>=this.cansend&&console.error("should be queued before sending cansend: "+this.cansend);b=this.ackn+":"+this.cansend+":"+b+":";this.ackn=0;this.cansend--;this._websocket.send(b+a);if("websocket"===this.kind||
"longpoll"===this.kind)this.timerid&&clearTimeout(this.timerid),this.timerid=setTimeout(function(){return d.keepAlive()},1E4);return!0};e.prototype.inject=function(a,b,d){if(!d)return setTimeout(this.inject.bind(this,a,b,!0),0);void 0===b&&(b=1);if(Array.isArray(a)){for(d=0;d<a.length;++d)this.provideData(b,"string"==typeof a[d]?a[d]:JSON.stringify(a[d]),-1);this.processQueue()}else a&&this.provideData(b,"string"==typeof a?a:JSON.stringify(a))};e.prototype.keepAlive=function(){delete this.timerid;
this.send("KEEPALIVE",0)};e.prototype.createChannel=function(){if(this.master)return master.createChannel();var a=new e("channel",this.credits);a.wait_first_recv=!0;this.channels||(this.channels={},this.freechannelid=2);a.master=this;a.channelid=this.freechannelid++;return this.channels[a.channelid]=a};e.prototype.getChannelId=function(){return this.channelid&&this.master?this.channelid:1};e.prototype.setHRef=function(a){this.href=a};e.prototype.getHRef=function(a){if(!a||!this.kind||!this.href)return this.href;
var b=this.href;if(0==a.indexOf("../")){var d=b.lastIndexOf("/",b.length-2);b=b.substr(0,d)+a.substr(2)}else b+=a;return b};e.prototype.connect=function(a){var b=this;this.close();!a&&this.href&&(a=this.href);var d=this,e=0,k=this.key?"key="+this.key:"";this.token&&(k&&(k+="&"),k+="token="+this.token);var l=function(g){if(0==b.state){g||console.log("try connect window again "+(new Date).toString());b._websocket&&(b._websocket.close(),delete b._websocket);a||((a=window.location.href)&&0<a.indexOf("#")&&
(a=a.substr(0,a.indexOf("#"))),a&&0<a.lastIndexOf("/")&&(a=a.substr(0,a.lastIndexOf("/")+1)));b.href=a;e++;g&&console.log("Opening web socket at "+a);2<e&&JSROOT.Painter&&JSROOT.Painter.showProgress("Trying to connect "+a);var h=a;"file"==b.kind?(h+="root.filedump",b._websocket=new f(b),console.log("configure protocol log "+h)):"websocket"===b.kind&&g?(h=h.replace("http://","ws://").replace("https://","wss://")+"root.websocket",k&&(h+="?"+k),console.log("configure websocket "+h),b._websocket=new WebSocket(h)):
(h+="root.longpoll",console.log("configure longpoll "+h),b._websocket=new c(h,"rawlongpoll"===b.kind,k));b._websocket&&(b._websocket.onopen=function(){2<e&&JSROOT.Painter&&JSROOT.Painter.showProgress();d.state=1;d.send("READY="+(d.key||""),0);d.invokeReceiver(!1,"onWebsocketOpened")},b._websocket.onmessage=function(a){var b=a.data;if(d.next_binary){var c=d.next_binary;delete d.next_binary;if(b instanceof Blob){c=new FileReader;var e=d.reserveQueueItem();c.onload=function(a){d.markQueueItemDone(e,
a.target.result,0)};c.readAsArrayBuffer(b,a.offset||0)}else d.provideData(c,b,a.offset||0)}else{if("string"!=typeof b)return console.log("unsupported message kind: "+typeof b);c=b.indexOf(":");a=parseInt(b.substr(0,c));var f=b.indexOf(":",c+1);c=b.indexOf(":",f+1);f=parseInt(b.substr(f+1,c-f));d.ackn++;d.cansend+=a;b=b.substr(c+1);0==f?(console.log("GET chid=0 message",b),"CLOSE"==b&&(d.close(!0),d.invokeReceiver(!0,"onWebsocketClosed"))):"$$binary$$"==b?d.next_binary=f:"$$nullbinary$$"==b?d.provideData(f,
new ArrayBuffer(0),0):d.provideData(f,b);7<d.ackn&&d.send("READY",0)}},b._websocket.onclose=function(a){delete d._websocket;if(0<d.state||"force_close"===a)console.log("websocket closed"),d.state=0,d.invokeReceiver(!0,"onWebsocketClosed")},b._websocket.onerror=function(a){console.log("websocket error "+a);0<d.state&&(d.invokeReceiver(!0,"onWebsocketError",a),d.state=0)},JSROOT.batch_mode||setTimeout(l,3E3))}};l(!0)};JSROOT.connectWebWindow=function(a){"function"==typeof a?a={callback:a}:a&&"object"==
typeof a||(a={});if(a.prereq)return a.openui5src&&(JSROOT.openui5src=a.openui5src),a.openui5libs&&(JSROOT.openui5libs=a.openui5libs),a.openui5theme&&(JSROOT.openui5theme=a.openui5theme),JSROOT.require(a.prereq).then(function(){delete a.prereq;if(a.prereq_logdiv&&document){var b=document.getElementById(a.prereq_logdiv);b&&(b.innerHTML="");delete a.prereq_logdiv}return JSROOT.connectWebWindow(a)});var b=JSROOT.decodeUrl();b.has("headless")&&b.get("key")&&(JSROOT.browser.isChromeHeadless||JSROOT.browser.isChrome)&&
JSROOT.loadScript("root_batch_holder.js?key="+b.get("key"));a.platform||(a.platform=b.get("platform"));"qt5"==a.platform?JSROOT.browser.qt5=!0:"cef3"==a.platform&&(JSROOT.browser.cef3=!0);void 0===a.batch&&(a.batch=b.has("headless"));a.batch&&(JSROOT.batch_mode=!0);a.socket_kind||(a.socket_kind=b.get("ws"));a.socket_kind||(a.socket_kind=JSROOT.browser.qt5?"rawlongpoll":JSROOT.browser.cef3?"longpoll":"websocket");return new Promise(function(c){var d=new e(a.socket_kind,a.credits);d.setUserArgs(a.user_args);
a.href&&d.setHRef(a.href);window&&(window.onbeforeunload=function(){return d.close(!0)},JSROOT.browser.qt5&&(window.onqt5unload=window.onbeforeunload));d.key=b.get("key");d.token=b.get("token");a.first_recv&&(a.receiver={onWebsocketOpened:function(){},onWebsocketMsg:function(b,d){if(0!=d.indexOf(a.first_recv))return b.close();b.first_msg=d.substr(a.first_recv.length);a.prereq2||c(b)},onWebsocketClosed:function(){return jsrp.closeCurrentWindow()}});if(!a.receiver)return c(d);d.setReceiver(a.receiver);
d.connect();a.prereq2?JSROOT.require(a.prereq2).then(function(){delete a.prereq2;a.first_recv&&!d.first_msg||c(d)}):a.first_recv||c(d)})};JSROOT.WebWindowHandle=e;return JSROOT});
