var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,n,h){b!=Array.prototype&&b!=Object.prototype&&(b[n]=h.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,n,h,t){if(n){h=$jscomp.global;b=b.split(".");for(t=0;t<b.length-1;t++){var q=b[t];q in h||(h[q]={});h=h[q]}b=b[b.length-1];t=h[b];n=n(t);n!=t&&null!=n&&$jscomp.defineProperty(h,b,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Number.isFinite",function(b){return b?b:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(b){return b?b:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6","es3");$jscomp.polyfill("Array.from",function(b){return b?b:function(b,h,t){h=null!=h?h:function(b){return b};var q=[],n="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof n){b=n.call(b);for(var e=0;!(n=b.next()).done;)q.push(h.call(t,n.value,e++))}else for(n=b.length,e=0;e<n;e++)q.push(h.call(t,b[e],e));return q}},"es6","es3");
$jscomp.arrayIteratorImpl=function(b){var n=0;return function(){return n<b.length?{done:!1,value:b[n++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,n){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:n})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(h){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(h||"")+"_"+n++,h)}var n=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,n){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var h=0,t={next:function(){if(h<b.length){var q=h++;return{value:n(q,b[q]),done:!1}}t.next=function(){return{done:!0,value:void 0}};return t.next()}};t[Symbol.iterator]=function(){return t};return t};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,h){return h})}},"es8","es3");$jscomp.makeIterator=function(b){var n="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return n?n.call(b):$jscomp.arrayIterator(b)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function n(){this.batch_=null}function h(b){return b instanceof q?b:new q(function(e,h){e(b)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;n.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var e=this;this.asyncExecuteFunction(function(){e.executeBatch_()})}this.batch_.push(b)};var t=$jscomp.global.setTimeout;n.prototype.asyncExecuteFunction=function(b){t(b,0)};n.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var h=0;h<b.length;++h){var q=b[h];b[h]=null;try{q()}catch(A){this.asyncThrow_(A)}}}this.batch_=null};n.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var q=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{b(e.resolve,e.reject)}catch(C){e.reject(C)}};q.prototype.createResolveAndReject_=function(){function b(b){return function(e){q||(q=!0,b.call(h,e))}}var h=this,q=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};q.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof q)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var e=null!=b;break a;case "function":e=!0;break a;default:e=!1}e?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};q.prototype.resolveToNonPromiseObj_=function(b){var e=void 0;try{e=b.then}catch(C){this.reject_(C);return}"function"==typeof e?
this.settleSameAsThenable_(e,b):this.fulfill_(b)};q.prototype.reject_=function(b){this.settle_(2,b)};q.prototype.fulfill_=function(b){this.settle_(1,b)};q.prototype.settle_=function(b,h){if(0!=this.state_)throw Error("Cannot settle("+b+", "+h+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=h;this.executeOnSettledCallbacks_()};q.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)r.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var r=new n;q.prototype.settleSameAsPromise_=function(b){var e=this.createResolveAndReject_();b.callWhenSettled_(e.resolve,e.reject)};q.prototype.settleSameAsThenable_=function(b,h){var e=this.createResolveAndReject_();try{b.call(h,e.resolve,e.reject)}catch(A){e.reject(A)}};q.prototype.then=function(b,h){function e(a,d){return"function"==typeof a?function(c){try{n(a(c))}catch(u){t(u)}}:d}var n,t,r=new q(function(a,d){n=a;t=d});this.callWhenSettled_(e(b,n),e(h,t));return r};
q.prototype.catch=function(b){return this.then(void 0,b)};q.prototype.callWhenSettled_=function(b,h){function e(){switch(q.state_){case 1:b(q.result_);break;case 2:h(q.result_);break;default:throw Error("Unexpected state: "+q.state_);}}var q=this;null==this.onSettledCallbacks_?r.asyncExecute(e):this.onSettledCallbacks_.push(e)};q.resolve=h;q.reject=function(b){return new q(function(e,h){h(b)})};q.race=function(b){return new q(function(e,q){for(var n=$jscomp.makeIterator(b),t=n.next();!t.done;t=n.next())h(t.value).callWhenSettled_(e,
q)})};q.all=function(b){var e=$jscomp.makeIterator(b),n=e.next();return n.done?h([]):new q(function(b,q){function t(c){return function(u){a[c]=u;d--;0==d&&b(a)}}var a=[],d=0;do a.push(void 0),d++,h(n.value).callWhenSettled_(t(a.length-1),q),n=e.next();while(!n.done)})};return q},"es6","es3");
JSROOT.define(["io","math"],function(b,n){function h(){this.branches=[];this.names=[];this.directs=[];this.break_execution=0;this.tgtobj={}}function t(a,d){if("object"!==typeof a)return 0;var c=JSROOT._.is_array_proto(Object.prototype.toString.apply(a));if(!d||1!=c)return c;var b;d=!0;for(c=0;c<a.length;++c){var f=typeof a[c];b||(b=f);if(f!==b){d=!1;break}if("object"==f&&t(a[c])){d=!1;break}}return d?2:1}function q(a,d,c){this.object=a;this.value=0;this.arr=[];this.indx=[];this.cnt=-1;this.tgtobj=
c;this.select="object"===typeof d?d:[]}function r(a){this.globals=a;this.code="";this.brindex=[];this.branches=[];this.brarray=[];this.func=null;this.kind=void 0;this.buf=[]}function e(){h.call(this);this.ndim=0;this.vars=[];this.hist=this.cut=null;this.histo_drawopt="";this.hist_name="$htemp";this.hist_title="Result of TTree::Draw";this.graph=!1;this.hist_args=[];this.arr_limit=1E3;this.htype="F";this.monitoring=0;this.globals={};this.aver_diff=this.last_progress=0}function F(a,d){function c(c){if(!c||
c.fName!==u)return!1;if(c.fType===a.fStreamerType||c.fType===b.kBool&&a.fStreamerType===b.kUChar||(a.fStreamerType===b.kSTL||a.fStreamerType===b.kSTL+b.kOffsetL||a.fStreamerType===b.kSTLp||a.fStreamerType===b.kSTLp+b.kOffsetL)&&c.fType===b.kStreamer)return!0;console.warn("Should match element",c.fType,"with branch",a.fStreamerType);return!1}if(!a||!d||"TBranchElement"!==a._typename||0>a.fID||0>a.fStreamerType)return null;d=(d=d.findStreamerInfo(a.fClassName,a.fClassVersion,a.fCheckSum))&&d.fElements?
d.fElements.arr:null;if(!d)return null;var u=a.fName,f=u.indexOf("[");0<f&&(u=u.substr(0,f));f=u.lastIndexOf(".");0<f&&(u=u.substr(f+1));if(c(d[a.fID]))return d[a.fID];for(f=0;f<d.length;++f)if(f!==a.fID&&c(d[f]))return d[f];console.error("Did not found/match element for branch",a.fName,"class",a.fClassName);return null}function C(a,d,c){d=(d=a.findStreamerInfo(d))&&d.fElements?d.fElements.arr:null;var b=null;if(!d)return"";for(var f=0;f<d.length;++f)if("BASE"===d[f].fTypeName){var l=C(a,d[f].fName,
c);if(l)return l}else if(d[f].fName===c){b=d[f];break}if(!b)return"";a=b.fTypeName;"*"===a[a.length-1]&&(a=a.substr(0,a.length-1));return a}function A(a,d,c,u){if(!a||"TBranchElement"!==a._typename)return"";if(a.fType===JSROOT.BranchType.kLeafNode&&-2===a.fID&&-1===a.fStreamerType)return a.fClassName;if(c&&a.fClonesName&&(a.fType===JSROOT.BranchType.kClonesNode||a.fType===JSROOT.BranchType.kSTLNode))return a.fClonesName;d=F(a,d.$file);if(a.fType===JSROOT.BranchType.kBaseClassNode&&d&&"BASE"===d.fTypeName)return d.fName;
if(a.fType===JSROOT.BranchType.kObjectNode)return!d||d.fType!==b.kObject&&d.fType!==b.kAny?"TObject":d.fTypeName;if(a.fType===JSROOT.BranchType.kLeafNode&&d&&u){if(d.fType===b.kObject||d.fType===b.kAny)return d.fTypeName;if(d.fType===b.kObjectp)return d.fTypeName.substr(0,d.fTypeName.length-1)}return""}function G(a){var d=JSROOT.getMethods(a),c={names:[],values:[],Create:function(){for(var a={},c=0;c<this.names.length;++c)a[this.names[c]]=this.values[c];return a}};c.names.push("_typename");c.values.push(a);
for(var b in d)c.names.push(b),c.values.push(d[b]);return c}function L(a,d,c){var b="";for(c=c||0;c<a.arr.length;++c)0===a.arr[c].fName.indexOf(d)&&a.arr[c].fClassName&&(b=a.arr[c].fClassName);return b}JSROOT.BranchType={kLeafNode:0,kBaseClassNode:1,kObjectNode:2,kClonesNode:3,kSTLNode:4,kClonesMemberNode:31,kSTLMemberNode:41};b.BranchBits={kDoNotProcess:JSROOT.BIT(10),kIsClone:JSROOT.BIT(11),kBranchObject:JSROOT.BIT(12),kBranchAny:JSROOT.BIT(17),kAutoDelete:JSROOT.BIT(15),kDoNotUseBufferMap:JSROOT.BIT(22)};
h.prototype.addBranch=function(a,d,c){d||(d="string"===typeof a?a:"br"+this.branches.length);this.branches.push(a);this.names.push(d);this.directs.push(c);return this.branches.length-1};h.prototype.indexOfBranch=function(a){return this.branches.indexOf(a)};h.prototype.nameOfBranch=function(a){return this.names[a]};h.prototype.ShowProgress=function(){};h.prototype.Abort=function(){this.break_execution=-1111};h.prototype.Begin=function(){};h.prototype.Process=function(){};h.prototype.Terminate=function(){};
q.prototype.next=function(){var a,d=this.cnt;if(0<=d){if(++this.fastindx<this.fastlimit)return this.value=this.fastarr[this.fastindx],!0;for(;0<=--d&&!(void 0===this.select[d]&&++this.indx[d]<this.arr[d].length););if(0>d)return!1}for(;;){var c=(a=0>d?this.object:this.arr[d][this.indx[d]])?typeof a:"any";"object"===c&&(void 0!==a._typename?JSROOT.isRootCollection(a)?(a=a.arr,c="array"):c="any":c=Number.isInteger(a.length)&&0<t(a)?"array":"any");if("$self$"==this.select[d+1])return this.value=a,this.fastindx=
this.fastlimit=0,this.cnt=d+1,!0;if("any"==c&&"string"===typeof this.select[d+1])this.arr[++d]=a,this.indx[d]=this.select[d];else if("array"===c&&(0<a.length||"$size$"===this.select[d+1]))switch(this.arr[++d]=a,this.select[d]){case void 0:this.indx[d]=0;break;case "$last$":this.indx[d]=a.length-1;break;case "$size$":return this.value=a.length,this.fastindx=this.fastlimit=0,this.cnt=d,!0;default:Number.isInteger(this.select[d])?(this.indx[d]=this.select[d],0>this.indx[d]&&(this.indx[d]=a.length-1)):
(this.select[d].produce(this.tgtobj),this.indx[d]=Math.round(this.select[d].get(0)))}else{if(0>d)return!1;this.value=a;void 0===this.select[d]?(this.fastarr=this.arr[d],this.fastindx=this.indx[d],this.fastlimit=this.fastarr.length):this.fastindx=this.fastlimit=0;this.cnt=d;return!0}}};q.prototype.reset=function(){this.arr=[];this.indx=[];delete this.fastarr;this.cnt=-1;this.value=0};r.prototype.parse=function(a,d,c,b,f){function u(a){return"A"<=a&&"Z">=a||"a"<=a&&"z">=a?!0:"_"===a}function x(a){return u(a)||
"0"<=a&&"9">=a?!0:!1}c||(c="");this.code=(b?b.fName:"")+c;for(var w=0,m=0,g=null;w<c.length||b;){var e=[];if(b)g=b,b=void 0;else{for(m=w;m<c.length&&(x(c[m])||"."===c[m]);)m++;if("$"==c[m]){g="";switch(c.substr(w,m-w)){case "LocalEntry":case "Entry":g="arg.$globals.entry";break;case "Entries":g="arg.$globals.entries"}if(g){c=c.substr(0,w)+g+c.substr(m+1);w+=g.length;continue}}g=a.FindBranchComplex(c.substr(w,m-w));if(!g){w=m+1;continue}g.branch&&void 0!==g.rest&&(m-=g.rest.length,f=void 0,g=g.branch);
m>=c.length-1&&"."===c[c.length-1]&&(e.push("$self$"),m=c.length)}for(;m<c.length;){if("@"===c[m]&&"@size"==c.substr(m,5)&&0==e.length){m+=5;f=!0;break}if("."===c[m]){var p=++m;if("@"===c[p]&&"@size"===c.substr(p,5)){e.push("$size$");m+=5;break}if(!u(c[p])){e.push("$self$");break}for(;m<c.length&&x(c[m]);)m++;if("("==c[m]){m=p-1;break}if(0===e.length&&g)if(g.fType===JSROOT.BranchType.kClonesNode||g.fType===JSROOT.BranchType.kSTLNode)e.push(void 0);else{var h=A(g,a,!1,!0);h&&JSROOT.isRootCollection(null,
h)&&e.push(void 0)}e.push(c.substr(p,m-p))}else{if("["!==c[m])break;if("]"==c[m+1])e.push(void 0),m+=2;else{p=m++;for(h=0;m<c.length&&("]"!=c[m]||0<h);)"["==c[m]?h++:"]"==c[m]&&h--,m++;p=c.substr(p+1,m-p-1);switch(p){case "":case "$all$":e.push(void 0);break;case "$last$":e.push("$last$");break;case "$size$":e.push("$size$");break;case "$first$":e.push(0);break;default:if(Number.isInteger(parseInt(p)))e.push(parseInt(p));else{h=new r(this.globals);if(!h.parse(a,d,p))return!1;e.push(h)}}m++}}}0===
e.length?e=void 0:1===e.length&&void 0===e[0]&&(e=!0);p=d.indexOfBranch(g);0>p&&(p=d.addBranch(g,void 0,f));f=void 0;this.brindex.push(p);this.branches.push(d.nameOfBranch(p));this.brarray.push(e);if(0===w&&m===c.length&&1===this.branches.length)return this.direct_branch=!0;e="arg.var"+(this.branches.length-1);c=c.substr(0,w)+e+c.substr(m);w+=e.length}c=c.replace(/TMath::Exp\(/g,"Math.exp(").replace(/TMath::Abs\(/g,"Math.abs(").replace(/TMath::Prob\(/g,"arg.$math.Prob(").replace(/TMath::Gaus\(/g,
"arg.$math.Gaus(");this.func=new Function("arg","return ("+c+")");return!0};r.prototype.is_dummy=function(){return 0===this.branches.length&&!this.func};r.prototype.produce=function(a){this.length=1;this.isarray=!1;if(this.is_dummy())this.value=1,this.kind="number";else{for(var d={$globals:this.globals,$math:n},c=-1,b=[],f=0;f<this.branches.length;++f){var l="var"+f;d[l]=a[this.branches[f]];void 0===this.brarray[f]&&(this.brarray[f]=0<t(d[l])||JSROOT.isRootCollection(d[l]));if(!1!==this.brarray[f]){if(!0===
this.brarray[f]&&2===t(d[l],!0))b[f]=d[l];else for(l=new q(d[l],this.brarray[f],a),b[f]=[];l.next();)b[f].push(l.value);if(0>c||c<b[f].length)c=b[f].length}}if(0>c)this.value=this.direct_branch?d.var0:this.func(d),this.kind||(this.kind=typeof this.value);else if(0==c)this.value=this.length=0;else{this.length=c;this.isarray=!0;if(this.direct_branch)this.value=b[0];else for(this.value=Array(c),a=0;a<c;++a){for(f=0;f<this.branches.length;++f)b[f]&&(d["var"+f]=b[f][a]);this.value[a]=this.func(d)}this.kind||
(this.kind=typeof this.value[0])}}};r.prototype.get=function(a){return this.isarray?this.value[a]:this.value};r.prototype.appendArray=function(a){this.buf=this.buf.concat(a[this.branches[0]])};e.prototype=Object.create(h.prototype);e.prototype.setCallback=function(a,d){this.result_callback=a;this.progress_callback=d};e.prototype.parseParameters=function(a,d,c){if(!c||"string"!==typeof c)return"";for(var b=c.lastIndexOf(";");0<=b;){var f=c.substr(b+1),l=void 0;c=c.substr(0,b);b=c.lastIndexOf(";");
var e=f.indexOf(":");0<e&&(l=f.substr(e+1),f=f.substr(0,e));e=parseInt(l);l&&Number.isInteger(e)||(e=void 0);switch(f){case "num":case "entries":case "numentries":"all"===l?d.numentries=a.fEntries:"half"===l?d.numentries=Math.round(a.fEntries/2):void 0!==e&&(d.numentries=e);break;case "first":void 0!==e&&(d.firstentry=e);break;case "mon":case "monitor":d.monitoring=void 0!==e?e:5E3;break;case "player":d.player=!0;break;case "dump":d.dump=!0;break;case "maxseg":case "maxrange":e&&(a.$file.fMaxRanges=
e);break;case "accum":e&&(this.arr_limit=e);break;case "htype":l&&1===l.length&&(this.htype=l.toUpperCase(),"C"!==this.htype&&"S"!==this.htype&&"I"!==this.htype&&"F"!==this.htype&&"L"!==this.htype&&"D"!==this.htype&&(this.htype="F"));break;case "hbins":this.hist_nbins=parseInt(l);(!Number.isInteger(this.hist_nbins)||3>=this.hist_nbins)&&delete this.hist_nbins;break;case "drawopt":d.drawopt=l;break;case "graph":d.graph=e||!0}}b=c.lastIndexOf(">>");if(0<=b)if(a=c.substr(b+2).trim(),c=c.substr(0,b).trim(),
b=a.indexOf("("),0<b&&(this.hist_name=a.substr(0,b),a=a.substr(b)),"dump"===a)d.dump=!0;else if(0==a.indexOf("Graph"))d.graph=!0;else if(0>b)this.hist_name=a;else if("("==a[0]&&")"==a[a.length-1]){a=a.substr(1,a.length-2).split(",");b=!0;for(f=0;f<a.length;++f)a[f]=0===f%3?parseInt(a[f]):parseFloat(a[f]),Number.isFinite(a[f])||(b=!1);b&&(this.hist_args=a)}d.dump&&(this.dump_values=!0,d.reallocate_objects=!0,void 0===d.numentries&&(d.numentries=10));return c};e.prototype.parseDrawExpression=function(a,
d){var c=this.parseParameters(a,d,d.expr),b="";this.hist_title="drawing '"+c+"' from "+a.fName;if(d.cut)b=d.cut;else{var f=c.replace(/TMath::/g,"TMath__").lastIndexOf("::");0<f&&(b=c.substr(f+2).trim(),c=c.substr(0,f).trim())}d.parse_expr=c;d.parse_cut=b;var l=[],e=0,h=0,m=0;for(f=0;f<c.length;++f)switch(c[f]){case "(":e++;break;case ")":e--;break;case "[":h++;break;case "]":h--;break;case ":":":"==c[f+1]?f++:(!e&&!h&&f>m&&l.push(c.substr(m,f-m)),m=f+1)}!e&&!h&&f>m&&l.push(c.substr(m,f-m));if(1>l.length||
3<l.length)return!1;this.ndim=l.length;c=!b;for(f=0;f<this.ndim;++f){this.vars[f]=new r(this.globals);if(!this.vars[f].parse(a,this,l[f]))return!1;this.vars[f].direct_branch||(c=!1)}this.cut=new r(this.globals);if(b&&!this.cut.parse(a,this,b))return!1;if(!this.branches.length)return console.warn("no any branch is selected"),!1;c&&(this.ProcessArrays=this.ProcessArraysFunc);this.monitoring=d.monitoring;this.graph=d.graph;this.histo_drawopt=void 0!==d.drawopt?d.drawopt:2===this.ndim?"col":"";return!0};
e.prototype.drawOnlyBranch=function(a,d,c,b){this.ndim=1;0==c.indexOf("dump")&&(c=";"+c);c=this.parseParameters(a,b,c);this.monitoring=b.monitoring;b.dump&&(this.dump_values=!0,b.reallocate_objects=!0);if(this.dump_values)return this.hist=[],this.leaf=b.leaf,this.copy_fields=(b.branch.fLeaves&&1<b.branch.fLeaves.arr.length||b.branch.fBranches&&0<b.branch.fBranches.arr.length)&&!b.leaf,this.addBranch(d,"br0",b.direct_branch),this.Process=this.ProcessDump,!0;this.vars[0]=new r(this.globals);if(!this.vars[0].parse(a,
this,c,d,b.direct_branch))return!1;this.hist_title="drawing branch '"+d.fName+(c?"' expr:'"+c:"")+"'  from "+a.fName;this.cut=new r(this.globals);this.vars[0].direct_branch&&(this.ProcessArrays=this.ProcessArraysFunc);return!0};e.prototype.Begin=function(a){this.globals.entries=a.fEntries;this.monitoring&&(this.lasttm=(new Date).getTime())};e.prototype.ShowProgress=function(a){if("undefined"!=typeof document&&JSROOT.Painter){if(void 0===a||!Number.isFinite(a))return JSROOT.Painter.showProgress();
if(this.last_progress!==a){var d=a-this.last_progress;this.aver_diff||(this.aver_diff=d);this.aver_diff=.3*d+.7*this.aver_diff}d=0;0>=this.aver_diff?d=0:1E-4>this.aver_diff?d=3:.001>this.aver_diff?d=2:.01>this.aver_diff&&(d=1);var c=document.createElement("p"),b=document.createTextNode("TTree draw "+(100*a).toFixed(d)+" %  "),f=this;c.appendChild(b);c.title="Click on element to break drawing";c.onclick=function(){if(3>++f.break_execution)return c.title="Tree draw will break after next I/O operation",
b.nodeValue="Breaking ... ";f.Abort();JSROOT.Painter.showProgress()};JSROOT.Painter.showProgress(c);this.last_progress=a}};e.prototype.getBitsBins=function(a,d){d.nbins=d.max=a;d.fLabels=JSROOT.create("THashList");for(var c=0;c<a;++c){var b=JSROOT.create("TObjString");b.fString=c.toString();b.fUniqueID=c+1;d.fLabels.Add(b)}return d};e.prototype.getMinMaxBins=function(a,d){var c={min:0,max:0,nbins:d,k:1,fLabels:null,title:""};if(a>=this.ndim)return c;var b=this.vars[a].buf;c.title=this.vars[a].code||
"";if("object"===this.vars[a].kind){for(var f,l=!0,e=8,h=0;h<b.length;++h)b[h]&&(f||(f=b[h]._typename),f!==b[h]._typename&&(l=!1),b[h].fNbits&&(e=Math.max(e,b[h].fNbits+1)));if(f&&l&&"TBits"===f&&0===a)return this.fill1DHistogram=this.fillTBitsHistogram,e%8&&(e=(e&65520)+8),"bits"===this.hist_name&&1==this.hist_args.length&&this.hist_args[0]&&(e=this.hist_args[0]),this.getBitsBins(e,c)}if("string"===this.vars[a].kind){c.lbls=[];for(d=0;d<b.length;++d)0>c.lbls.indexOf(b[d])&&c.lbls.push(b[d]);c.lbls.sort();
c.max=c.nbins=c.lbls.length;c.fLabels=JSROOT.create("THashList");for(d=0;d<c.lbls.length;++d)b=JSROOT.create("TObjString"),b.fString=c.lbls[d],b.fUniqueID=d+1,""===b.fString&&(b.fString="<empty>"),c.fLabels.Add(b)}else{if(0===a&&"bits"===this.hist_name&&1>=this.hist_args.length)return this.fill1DHistogram=this.FillBitsHistogram,this.getBitsBins(this.hist_args[0]||32,c);if(3*a+2<this.hist_args.length)c.nbins=this.hist_args[3*a],c.min=this.hist_args[3*a+1],c.max=this.hist_args[3*a+2];else{c.min=Math.min.apply(null,
b);c.max=Math.max.apply(null,b);this.hist_nbins&&(d=c.nbins=this.hist_nbins);c.isinteger=Math.round(c.min)===c.min&&Math.round(c.max)===c.max;if(c.isinteger)for(a=0;a<b.length;++a)if(b[a]!==Math.round(b[a])){c.isinteger=!1;break}if(c.isinteger)if(c.min=Math.round(c.min),c.max=Math.round(c.max),c.max-c.min<5*d)--c.min,c.max+=2,c.nbins=Math.round(c.max-c.min);else{b=c.max-c.min+2;for(a=Math.floor(b/d);a*d<b;)a++;c.max=c.min+d*a}else c.min>=c.max?(c.max=c.min,100>Math.abs(c.min)?(--c.min,c.max+=1):0<
c.min?(c.min*=.9,c.max*=1.1):(c.min*=1.1,c.max*=.9)):c.max+=(c.max-c.min)/c.nbins}}c.k=c.nbins/(c.max-c.min);c.GetBin=function(a){a=this.lbls?this.lbls.indexOf(a):Math.floor((a-this.min)*this.k);return 0>a?0:a>this.nbins?this.nbins+1:a+1};return c};e.prototype.createHistogram=function(){if(!this.hist&&this.vars[0].buf){if(this.dump_values)this.hist=[],this.fill1DHistogram=this.fill2DHistogram=this.fill3DHistogram=this.dumpValues;else if(this.graph){var a=this.vars[0].buf.length;1==this.ndim?this.hist=
JSROOT.createTGraph(a,Array.from(Array(a).keys()),this.vars[0].buf):2==this.ndim&&(this.hist=JSROOT.createTGraph(a,this.vars[0].buf,this.vars[1].buf),delete this.vars[1].buf);this.hist.fTitle=this.hist_title;this.hist.fName="Graph"}else{this.x=this.getMinMaxBins(0,1<this.ndim?50:200);this.y=this.getMinMaxBins(1,50);this.z=this.getMinMaxBins(2,50);switch(this.ndim){case 1:this.hist=JSROOT.createHistogram("TH1"+this.htype,this.x.nbins);break;case 2:this.hist=JSROOT.createHistogram("TH2"+this.htype,
this.x.nbins,this.y.nbins);break;case 3:this.hist=JSROOT.createHistogram("TH3"+this.htype,this.x.nbins,this.y.nbins,this.z.nbins)}this.hist.fXaxis.fTitle=this.x.title;this.hist.fXaxis.fXmin=this.x.min;this.hist.fXaxis.fXmax=this.x.max;this.hist.fXaxis.fLabels=this.x.fLabels;1<this.ndim&&(this.hist.fYaxis.fTitle=this.y.title);this.hist.fYaxis.fXmin=this.y.min;this.hist.fYaxis.fXmax=this.y.max;this.hist.fYaxis.fLabels=this.y.fLabels;2<this.ndim&&(this.hist.fZaxis.fTitle=this.z.title);this.hist.fZaxis.fXmin=
this.z.min;this.hist.fZaxis.fXmax=this.z.max;this.hist.fZaxis.fLabels=this.z.fLabels;this.hist.fName=this.hist_name;this.hist.fTitle=this.hist_title;this.hist.fOption=this.histo_drawopt;this.hist.$custom_stat="$htemp"==this.hist_name?111110:111111}a=this.vars[0].buf;var b=this.cut.buf,c=a.length;if(!this.graph)switch(this.ndim){case 1:for(var e=0;e<c;++e)this.fill1DHistogram(a[e],b?b[e]:1);break;case 2:e=this.vars[1].buf;for(var f=0;f<c;++f)this.fill2DHistogram(a[f],e[f],b?b[f]:1);delete this.vars[1].buf;
break;case 3:e=this.vars[1].buf;f=this.vars[2].buf;for(var l=0;l<c;++l)this.fill3DHistogram(a[l],e[l],f[l],b?b[l]:1);delete this.vars[1].buf;delete this.vars[2].buf}delete this.vars[0].buf;delete this.cut.buf}};e.prototype.fillTBitsHistogram=function(a,b){if(b&&a&&a.fNbits&&a.fAllBits)for(var c=Math.min(a.fNbits+1,8*a.fNbytes),d=0,f=1,e=0;d<c;++d)a.fAllBits[e]&&f&&(d<=this.x.nbins?this.hist.fArray[d+1]+=b:this.hist.fArray[this.x.nbins+1]+=b),f*=2,256<=f&&(f=1,++e)};e.prototype.FillBitsHistogram=function(a,
b){if(b)for(var c=0,d=1;c<this.x.nbins;++c)a&d&&(this.hist.fArray[c+1]+=b),d*=2};e.prototype.fill1DHistogram=function(a,b){var c=this.x.GetBin(a);this.hist.fArray[c]+=b;this.x.lbls||(this.hist.fTsumw+=b,this.hist.fTsumwx+=b*a,this.hist.fTsumwx2+=b*a*a)};e.prototype.fill2DHistogram=function(a,b,c){var d=this.x.GetBin(a),f=this.y.GetBin(b);this.hist.fArray[d+(this.x.nbins+2)*f]+=c;this.x.lbls||this.y.lbls||(this.hist.fTsumw+=c,this.hist.fTsumwx+=c*a,this.hist.fTsumwy+=c*b,this.hist.fTsumwx2+=c*a*a,
this.hist.fTsumwxy+=c*a*b,this.hist.fTsumwy2+=c*b*b)};e.prototype.fill3DHistogram=function(a,b,c,e){var d=this.x.GetBin(a),l=this.y.GetBin(b),h=this.z.GetBin(c);this.hist.fArray[d+(this.x.nbins+2)*(l+(this.y.nbins+2)*h)]+=e;this.x.lbls||this.y.lbls||this.z.lbls||(this.hist.fTsumw+=e,this.hist.fTsumwx+=e*a,this.hist.fTsumwy+=e*b,this.hist.fTsumwz+=e*c,this.hist.fTsumwx2+=e*a*a,this.hist.fTsumwy2+=e*b*b,this.hist.fTsumwz2+=e*c*c,this.hist.fTsumwxy+=e*a*b,this.hist.fTsumwxz+=e*a*c,this.hist.fTsumwyz+=
e*b*c)};e.prototype.dumpValues=function(a,b,c,e){switch(this.ndim){case 1:var d={x:a,weight:b};break;case 2:d={x:a,y:b,weight:c};break;case 3:d={x:a,y:b,z:c,weight:e}}this.cut.is_dummy()&&(1===this.ndim?d=a:delete d.weight);this.hist.push(d)};e.prototype.ProcessArraysFunc=function(){if(this.arr_limit||this.graph){var a=this.vars[0],b=this.tgtarr.br0.length,c=this.vars[1],e=this.vars[2];if(0===a.buf.length&&b>=this.arr_limit&&!this.graph)a.buf=this.tgtarr.br0,c&&(c.buf=this.tgtarr.br1),e&&(e.buf=this.tgtarr.br2);
else for(var f=0;f<b;++f)a.buf.push(this.tgtarr.br0[f]),c&&c.buf.push(this.tgtarr.br1[f]),e&&e.buf.push(this.tgtarr.br2[f]);a.kind="number";c&&(c.kind="number");e&&(e.kind="number");this.cut.buf=null;!this.graph&&a.buf.length>=this.arr_limit&&(this.createHistogram(),this.arr_limit=0)}else switch(a=this.tgtarr.br0,b=a.length,this.ndim){case 1:for(c=0;c<b;++c)this.fill1DHistogram(a[c],1);break;case 2:c=this.tgtarr.br1;for(e=0;e<b;++e)this.fill2DHistogram(a[e],c[e],1);break;case 3:for(c=this.tgtarr.br1,
e=this.tgtarr.br2,f=0;f<b;++f)this.fill3DHistogram(a[f],c[f],e[f],1)}};e.prototype.ProcessDump=function(){var a=this.leaf?this.tgtobj.br0[this.leaf]:this.tgtobj.br0;a&&this.copy_fields?0===t(a)?this.hist.push(JSROOT.extend({},a)):this.hist.push(a):this.hist.push(a)};e.prototype.Process=function(a){this.globals.entry=a;this.cut.produce(this.tgtobj);if(this.dump_values||this.cut.value){for(a=0;a<this.ndim;++a)this.vars[a].produce(this.tgtobj);a=this.vars[0];var b=this.vars[1],c=this.vars[2],e=this.cut;
if(this.graph||this.arr_limit){switch(this.ndim){case 1:for(b=0;b<a.length;++b)a.buf.push(a.get(b)),e.buf.push(e.value);break;case 2:for(c=0;c<a.length;++c)for(var f=0;f<b.length;++f)a.buf.push(a.get(c)),b.buf.push(b.get(f)),e.buf.push(e.value);break;case 3:for(f=0;f<a.length;++f)for(var l=0;l<b.length;++l)for(var h=0;h<c.length;++h)a.buf.push(a.get(f)),b.buf.push(b.get(l)),c.buf.push(c.get(h)),e.buf.push(e.value)}!this.graph&&a.buf.length>=this.arr_limit&&(this.createHistogram(),this.arr_limit=0)}else if(this.hist)switch(this.ndim){case 1:for(b=
0;b<a.length;++b)this.fill1DHistogram(a.get(b),e.value);break;case 2:for(c=0;c<a.length;++c)for(f=0;f<b.length;++f)this.fill2DHistogram(a.get(c),b.get(f),e.value);break;case 3:for(f=0;f<a.length;++f)for(l=0;l<b.length;++l)for(h=0;h<c.length;++h)this.fill3DHistogram(a.get(f),b.get(l),c.get(h),e.value)}this.monitoring&&this.hist&&!this.dump_values&&(a=(new Date).getTime(),a-this.lasttm>this.monitoring&&(this.lasttm=a,this.progress_callback&&this.progress_callback(this.hist)))}};e.prototype.Terminate=
function(a){a&&!this.hist&&this.createHistogram();this.ShowProgress();this.result_callback&&this.result_callback(this.hist)};JSROOT.treeHierarchy=function(a,b){function c(a,b,d,e){function f(b){var a=b.indexOf("[");0<a&&(b=b.substr(0,a));e&&0==b.indexOf(e.fName)&&(b=b.substr(e.fName.length),"."===b[0]&&(b=b.substr(1)));return b}if(!a||!b)return!1;var g=b.fBranches?b.fBranches.arr.length:0,l=b.fLeaves?b.fLeaves.arr.length:0;b.$tree=d;d={_name:f(b.fName),_kind:"ROOT."+b._typename,_title:b.fTitle,_obj:b};
a._childs||(a._childs=[]);a._childs.push(d);"TBranchElement"===b._typename&&(d._title+=" from "+b.fClassName+";"+b.fClassVersion);if(0<g)d._more=!0,d._expand=function(b,a){if(!a)return!1;b._childs||(b._childs=[]);!a.fLeaves||1!==a.fLeaves.arr.length||a.fType!==JSROOT.BranchType.kClonesNode&&a.fType!==JSROOT.BranchType.kSTLNode||(a.fLeaves.arr[0].$branch=a,b._childs.push({_name:"@size",_title:"container size",_kind:"ROOT.TLeafElement",_icon:"img_leaf",_obj:a.fLeaves.arr[0],_more:!1}));for(var d=0;d<
a.fBranches.arr.length;++d)c(b,a.fBranches.arr[d],a.$tree,a);var f=(d=A(a,a.$tree,!0))?JSROOT.getMethods(d):null;if(f&&0<a.fBranches.arr.length)for(var g in f)if("function"===typeof f[g]){var e=f[g].toString();0<e.indexOf("return")&&0==e.indexOf("function ()")&&b._childs.push({_name:g+"()",_title:"function "+g+" of class "+d,_kind:"ROOT.TBranchFunc",_obj:{_typename:"TBranchFunc",branch:a,func:g},_more:!1})}return!0};else if(1===l)d._icon="img_leaf",d._more=!1;else if(1<l)for(d._childs=[],a=0;a<l;++a)b.fLeaves.arr[a].$branch=
b,g={_name:f(b.fLeaves.arr[a].fName),_kind:"ROOT."+b.fLeaves.arr[a]._typename,_obj:b.fLeaves.arr[a]},d._childs.push(g);return!0}if("TTree"!=b._typename&&"TNtuple"!=b._typename&&"TNtupleD"!=b._typename)return!1;a._childs=[];a._tree=b;for(var d=0;d<b.fBranches.arr.length;++d)c(a,b.fBranches.arr[d],b);return!0};JSROOT.drawTree=function(b,d,c){if(!JSROOT.ObjectPainter)return console.error("JSROOT.drawTree called without loading of JSRoot.painter.js - how it can happen?"),null;var a=new JSROOT.ObjectPainter(b,
d),f=d,e=c;if("TBranchFunc"==d._typename)e={expr:"."+d.func+"()",branch:d.branch},c&&0==c.indexOf("dump")?e.expr+=">>"+c:c&&(e.expr+=c),f=d.branch.$tree;else if(d.$branch){e={expr:"."+d.fName+(c||""),branch:d.$branch};if(e.branch.fType===JSROOT.BranchType.kClonesNode||e.branch.fType===JSROOT.BranchType.kSTLNode)e.expr=c,e.direct_branch=!0;f=d.$branch.$tree}else if(d.$tree)!c&&d.fStreamerType&&d.fStreamerType!==JSROOT.IO.kTString&&d.fStreamerType>=JSROOT.IO.kObject&&d.fStreamerType<=JSROOT.IO.kAnyP&&
(c="dump"),e={expr:c,branch:d},f=d.$tree;else{if("player"===e||!e)return JSROOT.require("jq2d").then(function(){JSROOT.createTreePlayer(a);a.configureTree(f);a.Show();return a});"string"===typeof e&&(e={expr:e})}if(!f)return console.error("No TTree object available for TTree::Draw"),null;JSROOT.cleanup(b);var h=0,q,m=function(c,d){if(e.player)2===h&&(g=a.drawid);else var g=b;if(g)return JSROOT.redraw(g,c);if(1===h)return d?null:new Promise(function(b){q=b});h=1;return JSROOT.require("jq2d").then(function(){JSROOT.createTreePlayer(a);
a.configureTree(f);a.Show(e);h=2;return JSROOT.redraw(a.drawid,c).then(function(b){a.setItemName("TreePlayer");q&&q(b);return b})})};e.progress=function(b){return m(b,!0)};return f.Draw(e).then(function(b){return m(b)})};JSROOT.TSelector=h;JSROOT.TDrawVariable=r;JSROOT.TDrawSelector=e;b.TTreeMethods={Process:function(a,d){function c(a,c){switch(a._typename){case "TLeafF":var d=b.kFloat;break;case "TLeafD":d=b.kDouble;break;case "TLeafO":d=b.kBool;break;case "TLeafB":d=a.fIsUnsigned?b.kUChar:b.kChar;
break;case "TLeafS":d=a.fIsUnsigned?b.kUShort:b.kShort;break;case "TLeafI":d=a.fIsUnsigned?b.kUInt:b.kInt;break;case "TLeafL":d=a.fIsUnsigned?b.kULong64:b.kLong64;break;case "TLeafC":d=b.kTString;break;default:return null}return b.createStreamerElement(c||a.fName,d)}function e(b){for(var a=0;a<g.arr.length;++a)if(g.arr[a].branch===b)return g.arr[a];return null}function f(a,h,l,m){function q(b,c,d){if(!b||!b.arr.length)return!0;var e=a.fName;"."===e[e.length-1]&&(e=e.substr(0,e.length-1));"string"===
typeof m&&"."==m[0]&&(e+=m);e+=".";for(var k=0;k<b.arr.length;++k){var p=b.arr[k];if(!(0<d&&p.fType!==d))if(p.fType===JSROOT.BranchType.kBaseClassNode){if(!q(p.fBranches,c,d))return!1}else{var n=F(p,g.file);if(n&&"BASE"===n.fTypeName){if(p.fTotBytes&&!f(p,h,l,m)||!q(p.fBranches,c,d))return!1}else{n=p.fName;var v=1;if(0===p.fName.indexOf(e))n=n.substr(e.length);else if(0<d)continue;var B=n.indexOf("[");0<B&&(n=n.substr(0,B));B=n.indexOf("<");0<B&&(n=n.substr(0,B));0<d&&(v="$child$",B=n.indexOf("."),
0<B&&(v=L(b,a.fName+"."+n.substr(0,B+1),k)||"TObject"));if(!f(p,c,n,v))return!1}}}return!0}"string"===typeof a&&(a=g.tree.FindBranch(a));if(!a)return console.error("Did not found branch"),null;var p=e(a);if(p)return console.error("Branch already configured for reading",a.fName),p.tgt!==h&&console.error("Target object differs"),null;if(!a.fEntries)return console.warn("Branch ",a.fName," does not have entries"),null;for(p={branch:a,tgt:h,name:l,index:-1,member:null,type:0,curr_entry:-1,raw:null,basket:null,
curr_basket:0,read_entry:-1,staged_entry:-1,first_readentry:-1,staged_basket:0,numentries:a.fEntries,numbaskets:a.fWriteBasket,counters:null,ascounter:[],baskets:[],staged_prev:0,staged_now:0,progress_showtm:0,GetBasketEntry:function(a){if(!this.branch||a>this.branch.fMaxBaskets)return 0;var b=a<this.branch.fMaxBaskets?this.branch.fBasketEntry[a]:0;return b?b:(b=0<a?this.branch.fBaskets.arr[a-1]:null)?this.branch.fBasketEntry[a-1]+b.fNevBuf:0},GetTarget:function(a){if(!this.tgt)return a;for(var b=
0;b<this.tgt.length;++b){var c=this.tgt[b];a[c.name]||(a[c.name]=c.lst.Create());a=a[c.name]}return a},GetEntry:function(a){a-=this.first_entry;this.branch.TestBit(b.BranchBits.kDoNotUseBufferMap)||this.raw.clearObjectMap();if(this.basket.fEntryOffset){var c=this.basket.fEntryOffset[a];this.basket.fDisplacement&&(this.raw.fDisplacement=this.basket.fDisplacement[a])}else c=this.basket.fKeylen+this.basket.fNevBufSize*a;this.raw.locate(c-this.raw.raw_shift)}};p.GetBasketEntry(p.numbaskets+1);)p.numbaskets++;
var n=a.fLeaves?a.fLeaves.arr.length:0,w=0<n?a.fLeaves.arr[0]:null,v=null,k=null,E="TBranchElement"===a._typename,J=0,u=null,r=null,x="";if(a.fBranchCount){(u=e(a.fBranchCount))||(u=f(a.fBranchCount,h,"$counter"+t++,!0));if(!u)return console.error("Cannot add counter branch",a.fBranchCount.fName),null;x=a.fBranchCount2;if(!x&&a.fBranchCount.fStreamerType===b.kSTL&&(a.fStreamerType===b.kStreamLoop||a.fStreamerType===b.kOffsetL+b.kStreamLoop)){var K=F(a,g.file),I=a.fBranchCount.fBranches.arr;if(K&&
K.fCountName&&I)for(var y=0;y<I.length;++y)if(I[y].fName===a.fBranchCount.fName+"."+K.fCountName){x=I[y];break}x||console.error("Did not found branch for second counter of kStreamLoop element")}if(x&&((r=e(x))||(r=f(x,h,"$counter"+t++,!0)),!r))return console.error("Cannot add counter branch2",x.fName),null}else if(1===n&&w&&w.fLeafCount&&(x=g.tree.FindBranch(w.fLeafCount.fName))&&((u=e(x))||(u=f(x,h,"$counter"+t++,!0)),!u))return console.error("Cannot add counter branch",x.fName),null;if("TBranchObject"===
a._typename)k={name:l,typename:a.fClassName,virtual:w.fVirtual,func:function(a,b){var c=this.typename;this.virtual&&(c=a.readFastString(a.ntou1()+1));b[this.name]=a.classStreamer({},c)}};else if(a.fType===JSROOT.BranchType.kClonesNode||a.fType===JSROOT.BranchType.kSTLNode){if(v=b.createStreamerElement(l,b.kInt),!m||"string"===typeof m&&"."===m[0]||1===m){g.process_arrays=!1;k={name:l,conttype:a.fClonesName||"TObject",reallocate:d.reallocate_objects,func:function(a,b){a=a.ntoi4();var c=0,d=b[this.name];
!d||this.reallocate?d=b[this.name]=Array(a):(c=d.length,d.length=a);for(;c<a;)d[c++]=this.methods.Create()}};if("string"===typeof m&&"."===m[0]&&(k.conttype=L(a.fBranches,a.fName+m),!k.conttype))return console.error("Cannot select object",m,"in the branch",a.fName),null;k.methods=G(k.conttype);J=a.fType===JSROOT.BranchType.kClonesNode?JSROOT.BranchType.kClonesMemberNode:JSROOT.BranchType.kSTLMemberNode}}else{if(x=A(a,g.tree)){if(!0===m)return console.warn("Object branch "+x+" can not have data to be read directly"),
null;g.process_arrays=!1;v=Array(h?h.length+1:1);for(k=0;k<v.length-1;++k)v[k]=h[k];v[v.length-1]={name:l,lst:G(x)};return q(a.fBranches,v,0)?p:null}if(E&&1===n&&w.fName===a.fName&&-1==a.fID)v=b.createStreamerElement(l,a.fClassName),v.fType===b.kAny&&((n=g.file.getStreamer(a.fClassName,{val:a.fClassVersion,checksum:a.fCheckSum}))?k={name:l,typename:a.fClassName,streamer:n,func:function(a,b){for(var c={_typename:this.typename},d=0;d<this.streamer.length;++d)this.streamer[d].func(a,c);b[this.name]=
c}}:(v=null,console.warn("not found streamer!")));else if(E&&1>=n)v=F(a,g.file),!v&&a.fStreamerType&&20>a.fStreamerType&&(v=b.createStreamerElement(l,a.fStreamerType));else if(1===n)v=c(w,l);else if("TBranch"===a._typename&&1<n){w=Array(n);E=!0;for(x=0;x<n;++x)w[x]=c(a.fLeaves.arr[x]),w[x]=b.createMember(w[x],g.file),w[x]||(E=!1);E&&(k={name:l,leaves:w,func:function(a,b){var c=b[this.name],d=0;for(c||(b[this.name]=c={});d<this.leaves.length;)this.leaves[d++].func(a,c)}})}}if(!v&&!k)return console.warn("Not supported branch kind",
a.fName,a._typename),null;k||(k=b.createMember(v,g.file),void 0!==k.base&&k.basename&&(k.func=function(a,b){b[this.name]||(b[this.name]={_typename:this.basename});a.classStreamer(b[this.name],this.basename)}));if(u&&"string"===typeof m){k.name0=u.name;var z=l.split(".");if(1===z.length)k.get=function(a,b){return a[b]};else{if("$child$"===m)return console.error("target name contains point, but suppose to be direct child",l),null;if(2===z.length)l=k.name=z[1],k.name1=z[0],k.subtype1=m,k.methods1=G(k.subtype1),
k.get=function(a,b){var c=a[b][this.name1];c||(c=a[b][this.name1]=this.methods1.Create());return c};else{if(!a.fParentName)return console.error("Not possible to provide more than 2 parts in the target name",l),null;l=k.name=z.pop();k.snames=z;k.smethods=[];w=a.fParentName;for(n=0;n<z.length;++n)w=C(g.file,w,z[n]),k.smethods[n]=G(w||"AbstractClass");k.get=function(a,b){var c=a[b][this.snames[0]];c||(c=a[b][this.snames[0]]=this.smethods[0].Create());for(a=1;a<this.snames.length;++a)(b=c[this.snames[a]])||
(b=c[this.snames[a]]=this.smethods[a].Create()),c=b;return c}}}k.objs_branch_func?k.func=k.objs_branch_func:(k.func0=k.func,k.func=function(a,b){b=b[this.name0];for(var c=0;c<b.length;)this.func0(a,this.get(b,c++))})}else if(u)if(g.process_arrays=!1,v.fType===b.kDouble32||v.fType===b.kFloat16)k.stl_size=u.name,k.func=function(a,b){b[this.name]=this.readarr(a,b[this.stl_size])};else if(v.fType!==b.kOffsetP+b.kDouble32&&v.fType!==b.kOffsetP+b.kFloat16||!a.fBranchCount2)if(0<v.fType&&v.fType<b.kOffsetL||
v.fType===b.kTString||v.fType>b.kOffsetP&&v.fType<b.kOffsetP+b.kOffsetL&&a.fBranchCount2)k={name:l,stl_size:u.name,type:v.fType,func:function(a,b){b[this.name]=a.readFastArray(b[this.stl_size],this.type)}},a.fBranchCount2&&(k.type-=b.kOffsetP,k.arr_size=r.name,k.func=function(a,b){for(var c=b[this.stl_size],d=b[this.arr_size],e=Array(c),f=0;f<c;++f)e[f]=1===a.ntou1()?a.readFastArray(d[f],this.type):[];b[this.name]=e});else if(v.fType>b.kOffsetP&&v.fType<b.kOffsetP+b.kOffsetL&&k.cntname)k.cntname=
u.name;else if(v.fType==b.kStreamer){if(r)throw Error("Second branch counter not supported yet with jsrio.kStreamer");k.func=k.branch_func;k.stl_size=u.name}else if(v.fType===b.kStreamLoop||v.fType===b.kOffsetL+b.kStreamLoop)r?(k.stl_size=u.name,k.cntname=r.name,k.func=k.branch_func):k.cntname=u.name;else{k.name="$stl_member";if(r)if(k.cntname)z=r.name,k.cntname="$loop_size";else throw Error("Second branch counter not used - very BAD");k={name:l,stl_size:u.name,loop_size:z,member0:k,func:function(a,
b){for(var c=b[this.stl_size],d=Array(c),e=0;e<c;++e)this.loop_size&&(b.$loop_size=b[this.loop_size][e]),this.member0.func(a,b),d[e]=b.$stl_member;delete b.$stl_member;delete b.$loop_size;b[this.name]=d}}}else k.stl_size=u.name,k.arr_size=r.name,k.func=function(a,b){for(var c=b[this.stl_size],d=b[this.arr_size],e=Array(c),f=0;f<c;++f)e[f]=1===a.ntou1()?this.readarr(a,d[f]):[];b[this.name]=e};k.name=l;p.member=k;v&&(p.type=v.fType);p.index=g.arr.length;u&&(p.counters=[u.index],u.ascounter.push(p.index),
r&&(p.counters.push(r.index),r.ascounter.push(p.index)));g.arr.push(p);return J&&!q(a.fBranches,h,J)?null:p}function h(a){function c(){for(var b=[],c="",d=0;d<a.length;++d)if(!a[d].done){var e=a[d].branch;if(0===b.length)c=e.fFileName;else if(c!==e.fFileName)continue;a[d].selected=!0;b.push(e.fBasketSeek[a[d].basket],e.fBasketBytes[a[d].basket])}return 0<b.length?{places:b,filename:c}:null}function d(a){if(!(g.staged_prev===g.staged_now||g.process_max<=g.process_min)){var b=(new Date).getTime();500>
b-g.progress_showtm||(g.progress_showtm=b,g.selector.ShowProgress((g.staged_prev+a*(g.staged_now-g.staged_prev))/(g.process_max-g.process_min)))}}function e(f,h){function l(h){for(var k={};h<a.length;k={$jscomp$loop$prop$buf$41:k.$jscomp$loop$prop$buf$41,$jscomp$loop$prop$basket$42:k.$jscomp$loop$prop$basket$42},++h)if(a[h].selected){a[h].selected=!1;a[h].done=!0;var m=f.shift();k.$jscomp$loop$prop$buf$41=new JSROOT.TBuffer(m,0,g.file);k.$jscomp$loop$prop$basket$42=k.$jscomp$loop$prop$buf$41.classStreamer({},
"TBasket");k.$jscomp$loop$prop$basket$42.fNbytes!==a[h].branch.fBasketBytes[a[h].basket]&&console.error("mismatch in read basket sizes",a[h].branch.fBasketBytes[a[h].basket]);a[h].bskt_obj=k.$jscomp$loop$prop$basket$42;if(k.$jscomp$loop$prop$basket$42.fKeylen+k.$jscomp$loop$prop$basket$42.fObjlen===k.$jscomp$loop$prop$basket$42.fNbytes)k.$jscomp$loop$prop$buf$41.raw_shift=0,a[h].raw=k.$jscomp$loop$prop$buf$41,0<a[h].branch.fEntryOffsetLen&&k.$jscomp$loop$prop$buf$41.readBasketEntryOffset(k.$jscomp$loop$prop$basket$42,
k.$jscomp$loop$prop$buf$41.raw_shift);else return b.R__unzip(m,k.$jscomp$loop$prop$basket$42.fObjlen,!1,k.$jscomp$loop$prop$buf$41.o).then(function(b){return function(c){if(c)b.$jscomp$loop$prop$buf$41=new JSROOT.TBuffer(c,0,g.file),b.$jscomp$loop$prop$buf$41.raw_shift=b.$jscomp$loop$prop$basket$42.fKeylen,b.$jscomp$loop$prop$buf$41.fTagOffset=b.$jscomp$loop$prop$basket$42.fKeylen;else throw Error("FAIL TO UNPACK");a[h].raw=b.$jscomp$loop$prop$buf$41;0<a[h].branch.fEntryOffsetLen&&b.$jscomp$loop$prop$buf$41.readBasketEntryOffset(b.$jscomp$loop$prop$basket$42,
b.$jscomp$loop$prop$buf$41.raw_shift);return l(h+1)}}(k))}return(k=c())?g.file.readBuffer(k.places,k.filename,d).then(function(a){return e(a)}).catch(function(){return null}):Promise.resolve(a)}if(!f||2<h.length&&2*f.length!==h.length)return Promise.resolve(null);2==h.length&&(f=[f]);return l(0)}var f=c();return f?g.file.readBuffer(f.places,f.filename,d).then(function(a){return e(a,f.places)}).catch(function(){return null}):Promise.resolve(null)}function q(){for(var a=0,b=[],c=!0,d=!1,e=g.process_max;1E6>
a&&c;){c=!1;for(var f=g.arr.length-1;0<=f;--f)for(var l=g.arr[f];l.staged_basket<l.numbaskets;){var m=l.staged_basket++;if(l.GetBasketEntry(m)>=g.process_max)break;if(0>l.first_readentry){if(l.GetBasketEntry(m+1)<=g.process_min)continue;l.curr_basket=m;l.first_readentry=l.GetBasketEntry(m)}var p={id:f,branch:l.branch,basket:m,raw:null},k=l.branch.fBaskets.arr[m];k?(p.raw=k.fBufferRef,p.raw?p.raw.locate(0):p.raw=new JSROOT.TBuffer(null,0,g.file),p.raw.raw_shift=k.fKeylen,k.fBufferRef&&0<l.branch.fEntryOffsetLen&&
p.raw.readBasketEntryOffset(k,p.raw.raw_shift),p.bskt_obj=k,d=!0,l.baskets[m]=p):(b.push(p),a+=l.branch.fBasketBytes[m],c=!0);l.staged_entry=l.GetBasketEntry(m+1);e=Math.min(e,l.staged_entry);break}}if(0===a&&!d)return g.selector.Terminate(!0),D(g.selector);g.staged_prev=g.staged_now;g.staged_now=e;c=0;g.process_max>g.process_min&&(c=(g.staged_prev-g.process_min)/(g.process_max-g.process_min));g.selector.ShowProgress(c);g.progress_showtm=(new Date).getTime();if(0<a)return h(b).then(n);if(d)return n([]);
throw Error("No any data is requested - never come here");}function n(a){if(0!==g.selector.break_execution||null===a)return g.selector.Terminate(!1),D(g.selector);for(var b=0;b<a.length;++b)g.arr[a[b].id].baskets[a[b].basket]=a[b];for(a=!1;;){b=1E8;var c;for(c=0;c<g.arr.length;++c){var d=g.arr[c];if(!d.raw||!d.basket||d.first_entry+d.basket.fNevBuf<=g.current_entry){delete d.raw;delete d.basket;if(d.curr_basket>=d.numbaskets){if(0==c)return g.selector.Terminate(!0),D(g.selector);continue}var e=d.baskets[d.curr_basket];
if(!e)return a?q():(g.selector.Terminate(!1),M(Error("no data for "+d.branch.fName+" basket "+d.curr_basket)));d.raw=e.raw;d.basket=e.bskt_obj;d.first_entry=d.GetBasketEntry(e.basket);e.raw=null;e.branch=null;e.bskt_obj=null;d.baskets[d.curr_basket++]=void 0}b=Math.min(b,d.first_entry+d.basket.fNevBuf-g.current_entry)}g.current_entry+b>g.process_max&&(b=g.process_max-g.current_entry);if(g.process_arrays&&1<b){for(c=0;c<g.arr.length;++c)d=g.arr[c],d.GetEntry(g.current_entry),d.arrmember.arrlength=
b,d.arrmember.func(d.raw,g.selector.tgtarr),d.raw=null;g.selector.ProcessArrays(g.current_entry);g.current_entry+=b;a=!0}else for(;b--;){for(c=0;c<g.arr.length;++c)d=g.arr[c],d.GetEntry(g.current_entry),d.member.func(d.raw,d.GetTarget(g.selector.tgtobj));g.selector.Process(g.current_entry);g.current_entry++;a=!0}if(g.current_entry>=g.process_max)return g.selector.Terminate(!0),D(g.selector)}}var m=this;d||(d={});if(!a||!this.$file||!a.branches)return a&&a.Terminate(!1),Promise.reject(Error("required parameter missing for TTree::Process"));
for(var g={tree:this,file:this.$file,selector:a,arr:[],curr:-1,current_entry:-1,simple_read:!0,process_arrays:!0},t=0,p=0;p<a.branches.length;++p)if(!f(a.branches[p],void 0,a.names[p],a.directs[p]))return a.Terminate(!1),Promise.reject(Error("Fail to add branch "+a.branches[p]));for(p=1;p<g.arr.length&&g.simple_read;++p){var y=g.arr[p],r=g.arr[0];if(y.numentries!==r.numentries||y.numbaskets!==r.numbaskets)g.simple_read=!1;for(var H=0;H<y.numbaskets;++H)y.GetBasketEntry(H)!==r.GetBasketEntry(H)&&(g.simple_read=
!1)}for(p=g.firstentry=g.lastentry=0;p<g.arr.length;++p)y=g.arr[p].branch,r=y.fFirstEntry,void 0===r&&(r=y.fBasketBytes[0]?y.fBasketEntry[0]:0),g.firstentry=Math.max(g.firstentry,r),g.lastentry=0===p?r+y.fEntries:Math.min(g.lastentry,r+y.fEntries);if(g.firstentry>=g.lastentry)return a.Terminate(!1),Promise.reject(Error("No any common events for selected branches"));g.process_min=g.firstentry;g.process_max=g.lastentry;var D,M;Number.isInteger(d.firstentry)&&d.firstentry>g.firstentry&&d.firstentry<
g.lastentry&&(g.process_min=d.firstentry);g.current_entry=g.staged_now=g.process_min;Number.isInteger(d.numentries)&&0<d.numentries&&(p=g.process_min+d.numentries,p<g.process_max&&(g.process_max=p));if("function"===typeof a.ProcessArrays&&g.simple_read){for(p=0;p<g.arr.length;++p)if(y=g.arr[p],0>=y.type||y.type>=b.kOffsetL||y.type===b.kCharStar)g.process_arrays=!1;if(g.process_arrays)for(a.tgtarr={},a=0;a<g.arr.length;++a)p=g.arr[a],y=b.createStreamerElement(p.name,p.type),y.fType=p.type+b.kOffsetL,
y.fArrayLength=10,y.fArrayDim=1,y.fMaxIndex[0]=10,p.arrmember=b.createMember(y,g.file)}else g.process_arrays=!1;return new Promise(function(a,b){D=a;M=b;g.selector.Begin(m);q()})},FindBranchComplex:function(a,b,c){var d=!1,e=a,h=null;if(void 0===b){d=!0;b=this.fBranches;var n=e.indexOf("[");0<n&&(e=e.substr(0,n))}if(!b||0===b.arr.length)return null;for(n=0;n<b.arr.length;++n){var q=b.arr[n].fName;"]"==q[q.length-1]&&(q=q.substr(0,q.indexOf("[")));if(0!==e.indexOf(q)&&0<q.indexOf("<")){var m=q.indexOf("<"),
g=q.lastIndexOf(">");q=q.substr(0,m)+q.substr(g+1)}if(q===e){h={branch:b.arr[n],rest:""};break}if(0===e.indexOf(q)&&(m=q.length,"."===q[m-1]&&m--,"."===e[m])){(h=this.FindBranchComplex(e,b.arr[n].fBranches))||(h=this.FindBranchComplex(e.substr(m+1),b.arr[n].fBranches));h||(h={branch:b.arr[n],rest:e.substr(m)});break}}if(d&&!c&&!h&&0==e.indexOf("br_")){for(b=3;b<e.length&&"0"<=e[b]&&"9">=e[b];)++b;(c=3<b?this.GetBranch(parseInt(e.slice(3,b))):null)&&(h={branch:c,rest:e.substr(b)})}if(!d||!h)return h;
a.length>e.length&&(h.rest+=a.substr(e.length));return h},FindBranch:function(a){a=this.FindBranchComplex(a,void 0,!0);return!a||0<a.rest.length?null:a.branch},GetNumBranches:function(){function a(b){if(!b||!b.fBranches)return 0;var c=0;b.fBranches.arr.forEach(function(b){return c+=a(b)});return b.fBranches.arr.length+c}return a(this)},GetBranch:function(a){function b(d){d&&d.fBranches&&d.fBranches.arr.forEach(function(d){e++===a&&(c=d);c||b(d)})}if(Number.isInteger(a)){var c,e=0;b(this);return c}},
Draw:function(a){var b=this;"string"===typeof a&&(a={expr:a});a.expr||(a.expr="");if("testio"===a.expr)return this.IOTest(a);var c=new e;a.branch?c.drawOnlyBranch(this,a.branch,a.expr,a)||(c=null):c.parseDrawExpression(this,a)||(c=null);return c?new Promise(function(d){c.setCallback(d,a.progress);b.Process(c,a)}):Promise.reject(Error("Fail to create selector for specified expression"))},IOTest:function(a){function b(c,d){if(!c||!c.fBranches)return 0;for(var e=0,f=0;f<c.fBranches.arr.length;++f){var g=
c.fBranches.arr[f],h=(d?d+"/":"")+g.fName;a.branches.push(g);a.names.push(h);a.nchilds.push(0);var l=a.nchilds.length-1;e+=g.fLeaves?g.fLeaves.arr.length:0;g=b(g,h);e+=g;a.nchilds[l]=g}return e}var c=this;a.branches=[];a.names=[];a.nchilds=[];a.nbr=0;var e=b(this);a.names.push("Total are "+a.branches.length+" branches with "+e+" leaves");a.lasttm=(new Date).getTime();a.lastnbr=0;var f=function(){var b=new h;b.addBranch(a.branches[a.nbr],"br0");b.Process=function(){void 0===this.tgtobj.br0&&(this.fail=
!0)};b.Terminate=function(b){"string"!==typeof b&&(b=!b||this.fails?"FAIL":"ok");a.names[a.nbr]=b+" "+a.names[a.nbr];a.nbr++;if(a.nbr>=a.branches.length)return JSROOT.Painter&&JSROOT.Painter.showProgress(),a.resolveFunc(a.names);b=(new Date).getTime();5E3<b-a.lasttm||50<a.nbr-a.lastnbr?(a.lasttm=b,a.lastnbr=a.nbr,setTimeout(f,1)):f()};JSROOT.Painter&&JSROOT.Painter.showProgress("br "+a.nbr+"/"+a.branches.length+" "+a.names[a.nbr]);var d=a.branches[a.nbr],e=A(d,c),m=d.fEntries,g=!d.fLeaves||0===d.fLeaves.arr.length;
e&&(g=100<a.nchilds[a.nbr]);if(g||0>=m)b.Terminate("ignore");else{e={numentries:10};g=d.fFirstEntry||0;var n=d.fEntryNumber||g+m;m<e.numentries?e.numentries=m:e.firstentry=g+Math.round((n-g-e.numentries)*Math.random());console.log("test branch",d.fName,"first",e.firstentry||0,"num",e.numentries);c.Process(b,e)}};return new Promise(function(b){a.resolveFunc=b;f()})}};return JSROOT});
