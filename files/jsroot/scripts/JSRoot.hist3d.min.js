var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,x,e){k!=Array.prototype&&k!=Object.prototype&&(k[x]=e.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(k,x,e,O){if(x){e=$jscomp.global;k=k.split(".");for(O=0;O<k.length-1;O++){var B=k[O];B in e||(e[B]={});e=e[B]}k=k[k.length-1];O=e[k];x=x(O);x!=O&&null!=x&&$jscomp.defineProperty(e,k,{configurable:!0,writable:!0,value:x})}};$jscomp.polyfill("Number.isFinite",function(k){return k?k:function(x){return"number"!==typeof x?!1:!isNaN(x)&&Infinity!==x&&-Infinity!==x}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(k){return k?k:function(x){return Number.isFinite(x)?x===Math.floor(x):!1}},"es6","es3");$jscomp.arrayIteratorImpl=function(k){var x=0;return function(){return x<k.length?{done:!1,value:k[x++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.makeIterator=function(k){var x="undefined"!=typeof Symbol&&Symbol.iterator&&k[Symbol.iterator];return x?x.call(k):$jscomp.arrayIterator(k)};
$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(k){function x(){this.batch_=null}function e(e){return e instanceof B?e:new B(function(a,b){a(e)})}if(k&&!$jscomp.FORCE_POLYFILL_PROMISE)return k;x.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(e)};var O=$jscomp.global.setTimeout;x.prototype.asyncExecuteFunction=function(e){O(e,0)};x.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var a=0;a<e.length;++a){var b=e[a];e[a]=null;try{b()}catch(c){this.asyncThrow_(c)}}}this.batch_=null};x.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var B=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{e(a.resolve,a.reject)}catch(b){a.reject(b)}};B.prototype.createResolveAndReject_=function(){function e(c){return function(d){b||(b=!0,c.call(a,d))}}var a=this,b=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};B.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof B)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var a=null!=e;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}};B.prototype.resolveToNonPromiseObj_=function(e){var a=void 0;try{a=e.then}catch(b){this.reject_(b);return}"function"==typeof a?
this.settleSameAsThenable_(a,e):this.fulfill_(e)};B.prototype.reject_=function(e){this.settle_(2,e)};B.prototype.fulfill_=function(e){this.settle_(1,e)};B.prototype.settle_=function(e,a){if(0!=this.state_)throw Error("Cannot settle("+e+", "+a+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=a;this.executeOnSettledCallbacks_()};B.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)J.asyncExecute(this.onSettledCallbacks_[e]);
this.onSettledCallbacks_=null}};var J=new x;B.prototype.settleSameAsPromise_=function(e){var a=this.createResolveAndReject_();e.callWhenSettled_(a.resolve,a.reject)};B.prototype.settleSameAsThenable_=function(e,a){var b=this.createResolveAndReject_();try{e.call(a,b.resolve,b.reject)}catch(c){b.reject(c)}};B.prototype.then=function(e,a){function b(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(n){d(n)}}:b}var c,d,A=new B(function(a,b){c=a;d=b});this.callWhenSettled_(b(e,c),b(a,d));return A};
B.prototype.catch=function(e){return this.then(void 0,e)};B.prototype.callWhenSettled_=function(e,a){function b(){switch(c.state_){case 1:e(c.result_);break;case 2:a(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?J.asyncExecute(b):this.onSettledCallbacks_.push(b)};B.resolve=e;B.reject=function(e){return new B(function(a,b){b(e)})};B.race=function(x){return new B(function(a,b){for(var c=$jscomp.makeIterator(x),d=c.next();!d.done;d=c.next())e(d.value).callWhenSettled_(a,
b)})};B.all=function(x){var a=$jscomp.makeIterator(x),b=a.next();return b.done?e([]):new B(function(c,d){function A(a){return function(b){y[a]=b;q--;0==q&&c(y)}}var y=[],q=0;do y.push(void 0),q++,e(b.value).callWhenSettled_(A(y.length-1),d),b=a.next();while(!b.done)})};return B},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(k,x){this.$jscomp$symbol$id_=k;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:x})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function k(e){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+x++,e)}var x=0;return k}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.asyncIterator;k||(k=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};
$jscomp.iteratorFromArray=function(k,x){$jscomp.initSymbolIterator();k instanceof String&&(k+="");var e=0,O={next:function(){if(e<k.length){var B=e++;return{value:x(B,k[B]),done:!1}}O.next=function(){return{done:!0,value:void 0}};return O.next()}};O[Symbol.iterator]=function(){return O};return O};$jscomp.polyfill("Array.prototype.entries",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(x,e){return[x,e]})}},"es6","es3");
JSROOT.define(["d3","painter","base3d","hist"],function(k,x,e){function O(a,b,c,d){function e(a,b){a<=p&&(a+=4);return a>p&&a<p+b}if(b&&b.children)for(var y=0;y<b.children.length;++y){var q=b.children[y];if(q.axis_draw)break;q=void 0}if(q)if(a){c=c?!0:!1;d=d?!0:!1;var p=1;a=a.position;0>a.x&&0<=a.y&&(p=2);0<=a.x&&0<=a.y&&(p=3);0<=a.x&&0>a.y&&(p=4);for(a=0;a<q.children.length;++a)if(b=q.children[a],b.grid)b.visible=d&&e(b.grid,3);else if(b.zid)b.visible=e(b.zid,2);else if(b.xyid)b.visible=e(b.xyid,
3);else if(b.xyboxid){y=5;var n=0;d&&!c?(y=3,n=-2):c&&!d?y=3:c||d||(y=b.bottom?3:0);b.visible=e(b.xyboxid+n,y);!b.visible&&b.bottom&&d&&(b.visible=e(b.xyboxid,3))}else b.zboxid&&(y=2,n=0,c&&d?y=5:d&&!c?y=4:!d&&c&&(n=-2,y=4),b.visible=e(b.zboxid+n,y))}else b.remove(q)}function B(a,b){var c=a.getPadPainter().getRootPad(!0),d=Math.max(.75*a.size_xy3d,a.size_z3d);b&&a.camera.position.set(-1.6*d,-3.5*d,1.4*a.size_z3d);if(c&&(b||!a.zoomChangedInteractive())&&Number.isFinite(c.fTheta)&&Number.isFinite(c.fPhi)&&
(c.fTheta!==a.camera_Theta||c.fPhi!==a.camera_Phi)){d=3*Math.max(a.size_xy3d,a.size_z3d);b=(-c.fPhi-90)/180*Math.PI;var e=c.fTheta/180*Math.PI;a.camera_Phi=c.fPhi;a.camera_Theta=c.fTheta;a.camera.position.set(d*Math.cos(b)*Math.cos(e),d*Math.sin(b)*Math.cos(e),a.size_z3d+d*Math.sin(e));b=!0}b&&a.camera.lookAt(a.lookat)}function J(a,b){JSROOT.THistPainter.call(this,a,b);this.mode3d=!0}function aa(a,b){JSROOT.ObjectPainter.call(this,a,b)}JSROOT.TFramePainter.prototype.create3DScene=function(a){if(-1===
a)this.mode3d&&(this.clear3dCanvas?(O(null,this.toplevel),this.clear3dCanvas(),x.disposeThreejsObject(this.scene),this.control&&this.control.cleanup(),this.renderer&&(this.renderer.dispose&&this.renderer.dispose(),this.renderer.forceContextLoss&&this.renderer.forceContextLoss()),delete this.size_xy3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,delete this.toplevel,delete this.camera,delete this.pointLight,delete this.renderer,delete this.control,this.render_tmout&&(clearTimeout(this.render_tmout),
delete this.render_tmout),this.mode3d=!1):console.error("Strange, why mode3d is configured!!!!",this.mode3d));else if(this.mode3d=!0,"toplevel"in this)this.scene.remove(this.toplevel),x.disposeThreejsObject(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip(),a=new e.Object3D,this.scene.add(a),this.toplevel=a,this.resize3D(),B(this,!1);else{a=x.getRender3DKind(a);x.assign3DHandler(this);var b=this.getSizeFor3d(void 0,a);this.size_z3d=100;this.size_xy3d=
10<b.height&&10<b.width?Math.round(b.width/b.height*this.size_z3d):this.size_z3d;this.scene=new e.Scene;this.toplevel=new e.Object3D;this.scene.add(this.toplevel);this.scene_width=b.width;this.scene_height=b.height;this.camera=new e.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size_z3d);this.camera_Theta=this.camera_Phi=30;this.pointLight=new e.PointLight(16777215,1);this.camera.add(this.pointLight);this.pointLight.position.set(this.size_xy3d/2,this.size_xy3d/2,this.size_z3d/
2);this.lookat=new e.Vector3(0,0,.8*this.size_z3d);this.camera.up=new e.Vector3(0,0,1);this.scene.add(this.camera);B(this,!0);this.renderer=x.createRender3D(this.scene_width,this.scene_height,a);this.webgl=a===JSROOT.constants.Render3D.WebGL;this.add3dCanvas(b,this.renderer.jsroot_dom,this.webgl);this.first_render_tm=0;this.enable_highlight=!1;if(!JSROOT.batch_mode&&this.webgl){this.control=x.createOrbitControl(this,this.camera,this.scene,this.renderer,this.lookat);var c=this,d=this.getMainPainter();
this.control.ProcessMouseMove=function(a){for(var b=null,d=null,e=null,n=0;n<a.length;++n)if(a[n].object.tooltip){if(b=a[n].object.tooltip(a[n])){d=a[n].object;break}}else a[n].object.zoom&&!e&&(e=a[n].object);b&&!b.use_itself&&(a=1E-4*c.size_xy3d,n=1E-4*c.size_z3d,(b.x1>b.x2||b.y1>b.y2||b.z1>b.z2)&&console.warn("check 3D hints coordinates"),b.x1-=a,b.x2+=a,b.y1-=a,b.y2+=a,b.z1-=n,b.z2+=n);c.highlightBin3D(b,d);return!b&&e&&c.Get3DZoomCoord?(d=e.GlobalIntersect(this.raycaster),b=e.zoom,d=c.Get3DZoomCoord(d,
b),"z"===b&&e.use_y_for_z&&(b="y"),e=c.getAxis(b),a={name:b,title:"TAxis",line:"any info",only_status:!0},e&&(a.name=e.fName,a.title=e.fTitle||"histogram TAxis object"),a.line=b+" : "+c.axisAsText(b,d),a):b&&b.lines?b:""};this.control.ProcessMouseLeave=function(){c.highlightBin3D(null)};this.control.contextMenu=function(a,b){var c="painter",e=d;if(b)for(var n=0;n<b.length;++n){var g=b[n].object;if(g.zoom){c=g.zoom;e=null;break}if(g.painter&&"function"===typeof g.painter.fillContextMenu){e=g.painter;
break}}(b=d.getFramePainter())&&b.showContextMenu&&b.showContextMenu(c,a,e)}}}};JSROOT.TFramePainter.prototype.render3D=function(a){var b=this;if(-1111===a){var c=JSROOT._.get_document();a=e.CreateSVGRenderer(!1,0,c);a.setSize(this.scene_width,this.scene_height);a.render(this.scene,this.camera);return a.makeOuterHTML?(c=c.createElement("div"),c.innerHTML=a.makeOuterHTML(),c.childNodes[0]):a.domElement}void 0===a&&(a=5);0<a&&!this.usesvg&&!JSROOT.batch_mode?this.render_tmout||(this.render_tmout=setTimeout(function(){return b.render3D(0)},
a)):(this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.renderer&&(x.beforeRender3D(this.renderer),a=new Date,this.opt3d||(this.opt3d={FrontBox:!0,BackBox:!0}),O(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),this.renderer.render(this.scene,this.camera),x.afterRender3D(this.renderer),c=new Date,0===this.first_render_tm&&(this.first_render_tm=c.getTime()-a.getTime(),this.enable_highlight=1200>this.first_render_tm&&this.isTooltipAllowed(),console.log("three.js r"+
e.REVISION+", first render tm = "+this.first_render_tm))))};JSROOT.TFramePainter.prototype.resize3D=function(){var a=this.getSizeFor3d(this.access3dKind());this.apply3dSize(a);if(this.scene_width===a.width&&this.scene_height===a.height||10>a.width||10>a.height)return!1;this.scene_width=a.width;this.scene_height=a.height;this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);this.renderer.setJSROOTSize&&this.renderer.setJSROOTSize(this.scene_width,
this.scene_height);return!0};JSROOT.TFramePainter.prototype.highlightBin3D=function(a,b){var c=!1,d=null,A=!0,y=!a||void 0===a.x1||!this.enable_highlight,q=this.getMainPainter();!q||q.provideUserTooltip&&q.hasUserTooltip()||(q=null);this.tooltip_selfmesh&&(A=this.tooltip_selfmesh!==b,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,c=!0);this.tooltip_mesh&&(d=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,c=!0);
if(y)c&&this.render3D(),c&&q&&q.provideUserTooltip(null);else{if(a.use_itself)b.save_color=b.material.color,b.material.color=new e.Color(a.color),this.tooltip_selfmesh=b,c=A;else{c=!0;b=x.Box3D.Indexes;A=x.Box3D.Normals;y=x.Box3D.Vertices;var p=new e.Color(a.color?a.color:16711680),n=a.opacity||1;if(d){var g=d.geometry.attributes.position.array;d.geometry.attributes.position.needsUpdate=!0;d.material.color=p;d.material.opacity=n}else{g=new Float32Array(3*b.length);var l=new Float32Array(3*b.length);
d=new e.BufferGeometry;d.setAttribute("position",new e.BufferAttribute(g,3));d.setAttribute("normal",new e.BufferAttribute(l,3));p=new e.MeshBasicMaterial({color:p,opacity:n,flatShading:!0});d=new e.Mesh(d,p)}a.x1===a.x2&&console.warn("same tip X",a.x1,a.x2);a.y1===a.y2&&console.warn("same tip Y",a.y1,a.y2);a.z1===a.z2&&(a.z2=a.z1+1E-4);p=0;for(n=-3;p<b.length;++p){var m=y[b[p]];g[3*p]=a.x1+m.x*(a.x2-a.x1);g[3*p+1]=a.y1+m.y*(a.y2-a.y1);g[3*p+2]=a.z1+m.z*(a.z2-a.z1);l&&(0===p%6&&(n+=3),l[3*p]=A[n],
l[3*p+1]=A[n+1],l[3*p+2]=A[n+2])}this.tooltip_mesh=d;this.toplevel.add(d)}c&&this.render3D();c&&a.$painter&&"function"==typeof a.$painter.redrawProjection&&a.$painter.redrawProjection(a.ix-1,a.ix,a.iy-1,a.iy);c&&q&&q.getObject()&&q.provideUserTooltip({obj:q.getObject(),name:q.getObject().fName,bin:a.bin,cont:a.value,binx:a.ix,biny:a.iy,binz:a.iz,grx:(a.x1+a.x2)/2,gry:(a.y1+a.y2)/2,grz:(a.z1+a.z2)/2})}};JSROOT.TFramePainter.prototype.set3DOptions=function(a){this.opt3d=a};JSROOT.TFramePainter.prototype.drawXYZ=
function(a,b){function c(a,b,c){var d=new e.Geometry;"z"===a?d.vertices.push(new e.Vector3(0,0,0),new e.Vector3(4*H,0,0),new e.Vector3(4*H,0,2*b),new e.Vector3(0,0,2*b)):d.vertices.push(new e.Vector3(-b,0,0),new e.Vector3(b,0,0),new e.Vector3(b,4*-H,0),new e.Vector3(-b,4*-H,0));d.faces.push(new e.Face3(0,2,1));d.faces.push(new e.Face3(0,3,2));d.computeFaceNormals();var f=new e.MeshBasicMaterial({transparent:!0,vertexColors:e.NoColors,side:e.DoubleSide,opacity:0});d=new e.Mesh(d,f);d.zoom=a;d.size_3d=
b;d.use_y_for_z=c;"y"==a&&d.rotateZ(Math.PI/2).rotateX(Math.PI);d.GlobalIntersect=function(a){var b=new e.Plane,c=this.geometry;if(c&&c.vertices&&(b.setFromCoplanarPoints(c.vertices[0],c.vertices[1],c.vertices[2]),b.applyMatrix4(this.matrixWorld),c=a.ray.origin.clone(),a=c.clone().addScaledVector(a.ray.direction,1E10),b=b.intersectLine(new e.Line3(c,a),new e.Vector3)))return a=-this.size_3d,c=this.size_3d,"z"===this.zoom&&(a=0,c=2*this.size_3d),b[this.zoom]<a?b[this.zoom]=a:b[this.zoom]>c&&(b[this.zoom]=
c),b};d.ShowSelection=function(a,b){var c=this.children?this.children[0]:null,d=this.zoom;if(!a||!b)return c&&(this.remove(c),x.disposeThreejsObject(c)),c;if(c)var f=c.geometry;else f=this.geometry.clone(),"z"===d?f.vertices[1].x=f.vertices[2].x=H:f.vertices[2].y=f.vertices[3].y=-H,c=new e.Mesh(f,new e.MeshBasicMaterial({color:65280,side:e.DoubleSide})),this.add(c);"z"==d?(f.vertices[0].z=f.vertices[1].z=a[d],f.vertices[2].z=f.vertices[3].z=b[d]):(f.vertices[0].x=f.vertices[3].x=a[d],f.vertices[1].x=
f.vertices[2].x=b[d]);f.computeFaceNormals();f.verticesNeedUpdate=!0;return f.normalsNeedUpdate=!0};return d}b||(b={});var d=-this.size_xy3d,A=this.size_xy3d,y=-this.size_xy3d,q=this.size_xy3d,p=0,n=2*this.size_z3d,g=Math.round(.05*this.size_z3d),l=this.getPadPainter().getRootPad(!0),m=this.xmin,u=this.xmax,w=this.ymin,r=this.ymax,f=this.zmin,h=this.zmax,t=!1,v=!1;this.size_z3d||(d=this.xmin,A=this.xmax,y=this.ymin,q=this.ymax,p=this.zmin,n=this.zmax,g=.05*(n-p));"zoom_xmin"in this&&"zoom_xmax"in
this&&this.zoom_xmin!==this.zoom_xmax&&(m=this.zoom_xmin,u=this.zoom_xmax);"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(w=this.zoom_ymin,r=this.zoom_ymax,t=!0);"zoom_zmin"in this&&"zoom_zmax"in this&&this.zoom_zmin!==this.zoom_zmax&&(f=this.zoom_zmin,h=this.zoom_zmax,v=!0);b.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,f=w,h=r,v=t,w=0,r=1);this.lego_zmin=f;this.lego_zmax=h;void 0===b.zmult||v||(h*=b.zmult);this.x_handle=new JSROOT.TAxisPainter(null,this.xaxis);
this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,m,u,!1,[d,A],{log:l?l.fLogx:0});this.x_handle.assignFrameMembers(this,"x");this.y_handle=new JSROOT.TAxisPainter(null,this.yaxis);this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,w,r,!1,[y,q],{log:l&&!b.use_y_for_z?l.fLogx:0});this.y_handle.assignFrameMembers(this,"y");this.z_handle=new JSROOT.TAxisPainter(null,this.zaxis);this.z_handle.configureAxis("zaxis",this.zmin,this.zmax,f,h,!1,[p,n],{log:l?l.fLogz:0});this.z_handle.assignFrameMembers(this,
"z");this.setRootPadRange(l,!0);this.x_handle.debug=!0;var D=new e.MeshBasicMaterial({color:0});l=new e.LineBasicMaterial({color:0});var H=.5*g;u=[];var z=1;f=this.x_handle.createTicks(!1,!0);r=this.y_handle.createTicks(!1,!0);w=this.z_handle.createTicks(!1,!0);m=new e.Object3D;m.axis_draw=!0;a.add(m);a=[];var V=0;for(h=this.xaxis;f.next();){t=f.grpos;v=1===f.kind;var k=this.x_handle.format(f.tick,2);f.last_major()?h&&h.fTitle||(k="x"):null===k&&(v=!1,k="");if(v&&k&&0<k.length){k=new e.TextGeometry(k,
{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5});k.computeBoundingBox();var M=k.boundingBox.max.x-k.boundingBox.min.x,I=k.boundingBox.max.y-k.boundingBox.min.y;k.center=!0;V=Math.max(V,I);k.grx=t;u.push(k);f.last_major()||(I=f.next_major_grpos()-t,0<M&&(z=Math.min(z,.9*I/M)),this.x_handle.isCenteredLabels()&&(k.grx+=I/2))}a.push(t,0,0,t,v?-H:.6*-H,0)}h&&h.fTitle&&(f=new e.TextGeometry(h.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5}),
f.computeBoundingBox(),f.center=h.TestBit(JSROOT.EAxisBits.kCenterTitle),f.gry=2,f.grx=(d+A)/2,u.push(f));this.Get3DZoomCoord=function(a,b){a=a[b];var c=this["scale_"+b+"min"],d=this["scale_"+b+"max"];a="z"===b?a/2/this.size_z3d:(a+this.size_xy3d)/2/this.size_xy3d;return a=this["log"+b]?Math.exp(Math.log(c)+a*(Math.log(d)-Math.log(c))):c+a*(d-c)};var C=new e.Object3D;C.position.set(0,y,p);C.rotation.x=.25*Math.PI;C.xyid=2;a=x.createLineSegments(a,l);C.add(a);u.forEach(function(a){var b=a.boundingBox.max.x-
a.boundingBox.min.x,c=a.center?a.grx-b/2:A-b;b=new e.Matrix4;b.set(z,0,0,c,0,z,0,(-V*z-1.5*H)*(a.gry||1),0,0,1,0,0,0,0,1);a=new e.Mesh(a,D);a.applyMatrix4(b);C.add(a)});b.zoom&&C.add(c("x",this.size_xy3d));m.add(C);C=new e.Object3D;C.position.set(0,q,p);C.rotation.x=.75*Math.PI;C.add(new e.LineSegments(a.geometry,l));u.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.grx+b/2:A;b=new e.Matrix4;b.set(-z,0,0,c,0,z,0,(-V*z-1.5*H)*(a.gry||1),0,0,-1,0,0,0,0,1);a=new e.Mesh(a,
D);a.applyMatrix4(b);C.add(a)});C.xyid=4;b.zoom&&C.add(c("x",this.size_xy3d));m.add(C);u=[];z=1;V=0;a=[];for(f=this.yaxis;r.next();)h=r.grpos,t=1===r.kind,v=this.y_handle.format(r.tick,2),r.last_major()?f&&f.fTitle||(v="y"):null===v&&(t=!1,v=""),t&&(v=new e.TextGeometry(v,{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5}),v.computeBoundingBox(),k=v.boundingBox.max.x-v.boundingBox.min.x,M=v.boundingBox.max.y-v.boundingBox.min.y,v.center=!0,V=Math.max(V,M),v.gry=h,u.push(v),
r.last_major()||(M=r.next_major_grpos()-h,0<k&&(z=Math.min(z,.9*M/k)),this.y_handle.isCenteredLabels()&&(v.gry+=M/2))),a.push(0,h,0,t?-H:.6*-H,h,0);f&&f.fTitle&&(r=new e.TextGeometry(f.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5}),r.computeBoundingBox(),r.center=f.TestBit(JSROOT.EAxisBits.kCenterTitle),r.grx=2,r.gry=(y+q)/2,u.push(r));if(!b.use_y_for_z){a=x.createLineSegments(a,l);var E=new e.Object3D;E.position.set(d,0,p);E.rotation.y=-.25*Math.PI;E.add(a);
u.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry+b/2:q;b=new e.Matrix4;b.set(0,z,0,(-V*z-1.5*H)*(a.grx||1),-z,0,0,c,0,0,1,0,0,0,0,1);a=new e.Mesh(a,D);a.applyMatrix4(b);E.add(a)});E.xyid=3;b.zoom&&E.add(c("y",this.size_xy3d));m.add(E);E=new e.Object3D;E.position.set(A,0,p);E.rotation.y=-.75*Math.PI;E.add(new e.LineSegments(a.geometry,l));u.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry-b/2:q-b;b=new e.Matrix4;b.set(0,z,0,(-V*
z-1.5*H)*(a.grx||1),z,0,0,c,0,0,-1,0,0,0,0,1);a=new e.Mesh(a,D);a.applyMatrix4(b);E.add(a)});E.xyid=1;b.zoom&&E.add(c("y",this.size_xy3d));m.add(E)}u=[];z=1;a=[];v=h=t=null;r=this.zaxis;f=0;this.size_z3d&&(t=[],h=[]);for(;w.next();){k=w.grpos;M=1==w.kind;I=this.z_handle.format(w.tick,2);null===I&&(M=!1,I="");if(M&&I){I=new e.TextGeometry(I,{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5});I.computeBoundingBox();var G=I.boundingBox.max.x-I.boundingBox.min.x,N=I.boundingBox.max.y-
I.boundingBox.min.y;I.translate(-G,-N/2,0);I.grz=k;u.push(I);null!==v&&0<N&&(z=Math.min(z,.9*(k-v)/N));f=Math.max(f,G);v=k}t&&M&&t.push(d,0,k,A,0,k);h&&M&&h.push(0,y,k,0,q,k);a.push(0,0,k,M?H:.6*H,0,k)}t&&0<t.length&&(w=new e.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),t=x.createLineSegments(t,w),t.position.set(0,q,0),t.grid=2,t.visible=!1,m.add(t),w=new e.LineSegments(t.geometry,w),w.position.set(0,y,0),w.grid=4,w.visible=!1,m.add(w));h&&0<h.length&&(w=new e.LineDashedMaterial({color:0,dashSize:2,
gapSize:2}),h=x.createLineSegments(h,w),h.position.set(A,0,0),h.grid=3,h.visible=!1,m.add(h),w=new e.LineSegments(h.geometry,w),w.position.set(d,0,0),w.grid=1,w.visible=!1,m.add(w));var F=[];a=x.createLineSegments(a,l);for(w={$jscomp$loop$prop$n$64:0};4>w.$jscomp$loop$prop$n$64;w={$jscomp$loop$prop$n$64:w.$jscomp$loop$prop$n$64},++w.$jscomp$loop$prop$n$64)F.push(new e.Object3D),u.forEach(function(a){return function(b){var c=new e.Matrix4;c.set(-z,0,0,2*H,0,0,1,0,0,z,0,b.grz);b=new e.Mesh(b,D);b.applyMatrix4(c);
F[a.$jscomp$loop$prop$n$64].add(b)}}(w)),r&&r.fTitle&&(h=new e.TextGeometry(r.fTitle,{font:JSROOT.threejs_font_helvetiker_regular,size:g,height:0,curveSegments:5}),h.computeBoundingBox(),t=h.boundingBox.max.x-h.boundingBox.min.x,v=r.TestBit(JSROOT.EAxisBits.kCenterTitle)?(n+p-t)/2:n-t,h.rotateZ(Math.PI/2),t=new e.Matrix4,t.set(-z,0,0,3*H+f,0,0,1,0,0,z,0,v),h=new e.Mesh(h,D),h.applyMatrix4(t),F[w.$jscomp$loop$prop$n$64].add(h)),F[w.$jscomp$loop$prop$n$64].add(0==w.$jscomp$loop$prop$n$64?a:new e.LineSegments(a.geometry,
l)),b.zoom&&F[w.$jscomp$loop$prop$n$64].add(c("z",this.size_z3d,b.use_y_for_z)),F[w.$jscomp$loop$prop$n$64].zid=w.$jscomp$loop$prop$n$64+2,m.add(F[w.$jscomp$loop$prop$n$64]);F[0].position.set(d,q,0);F[0].rotation.z=.75*Math.PI;F[1].position.set(A,q,0);F[1].rotation.z=.25*Math.PI;F[2].position.set(A,y,0);F[2].rotation.z=-.25*Math.PI;F[3].position.set(d,y,0);F[3].rotation.z=-.75*Math.PI;if(0!==this.size_z3d){b=x.createLineSegments([d,0,0,A,0,0],l,null,!0);for(g=0;2>g;++g)u=new e.LineSegments(b,l),u.position.set(0,
y,0===g?p:n),u.xyboxid=2,u.bottom=0==g,m.add(u),u=new e.LineSegments(b,l),u.position.set(0,q,0===g?p:n),u.xyboxid=4,u.bottom=0==g,m.add(u);y=x.createLineSegments([0,y,0,0,q,0],l,null,!0);for(b=0;2>b;++b)g=new e.LineSegments(y,l),g.position.set(d,0,0===b?p:n),g.xyboxid=3,g.bottom=0==b,m.add(g),g=new e.LineSegments(y,l),g.position.set(A,0,0===b?p:n),g.xyboxid=1,g.bottom=0==b,m.add(g);d=x.createLineSegments([0,0,p,0,0,n],l,null,!0);for(p=0;4>p;++p)n=new e.LineSegments(d,l),n.zboxid=F[p].zid,n.position.copy(F[p].position),
m.add(n)}};JSROOT.THistPainter.prototype.draw3DBins=function(){var a=this;if(this.draw_content){if(this.isTH2Poly()&&this.drawPolyLego)return this.drawPolyLego();if(2==this.getDimension()&&this.options.Contour&&this.drawContour3D)return this.drawContour3D(!0);if(2==this.getDimension()&&this.options.Surf&&this.drawSurf)return this.drawSurf();if(2==this.getDimension()&&this.options.Error&&this.drawError)return this.drawError();var b=x.Box3D.Vertices,c=x.Box3D.Indexes,d=x.Box3D.Normals,A=x.Box3D.Segments,
y=[0,1,1,2,2,3,3,0],q=[new e.Vector3(0,0,0),new e.Vector3(0,1,0),new e.Vector3(1,1,0),new e.Vector3(1,0,0)],p=this.getFramePainter(),n=p.z_handle.gr.domain()[0],g=p.z_handle.gr.domain()[1],l=this.prepareColorDraw({rounding:!1,use3d:!0,extra:1}),m=l.i1,u=l.i2,w=l.j1,r=l.j2,f,h,t,v,D,H,z,V=this.getHisto(),B=V?V.$baseh:null,M=11===this.options.Lego||13===this.options.Lego;if(!(m>=u||w>=r)){var I=function(b,c,d){H=V.getBinContent(b+1,c+1);D=B?B.getBinContent(b+1,c+1):!1!==a.options.BaseLine?a.options.BaseLine:
a.options.Zero?n:0;H<D&&(b=D,D=H,H=b);if(D>=K||H<F)return!1;z=H===F||D>=H;return!z||0<d?!0:V.$baseh?!1:a.options.Zero||0<n?!0:a._show_empty_bins},C=65535>V.getBin(u,r),E=[n,g],G=null;if(12===this.options.Lego||14===this.options.Lego)E=this.createContour(V.fContour?V.fContour.length:20,p.lego_zmin,p.lego_zmax).arr,G=this.getHistPalette();for(var N=0;N<E.length-1;++N){var F=E[N];var K=E[N+1];G&&N==E.length-2&&K<g&&(K=g);var L=0,ba=0,R=v=0,O=p.grz(F),J=p.grz(K);for(f=m;f<u;++f)for(h=w;h<r;++h)if(I(f,
h,N)){var Q=!z&&0<N;var Z=!z&&H>K&&N<E.length-2;v+=z?12:c.length;Q&&(v-=6);Z&&(v-=6);M&&!z&&(v-=12,R+=12)}var X=new Float32Array(3*v),S=new Float32Array(3*v),T=C?new Uint16Array(v/3):new Uint32Array(v/3),U=t=null,P=null,W=0,da=0,ea=Q=void 0,ca=void 0;0<R&&(t=new Float32Array(3*R),U=new Float32Array(3*R),P=C?new Uint16Array(R/3):new Uint32Array(R/3));for(f=m;f<u;++f){v=l.grx[f]+l.xbar1*(l.grx[f+1]-l.grx[f]);var Y=l.grx[f]+l.xbar2*(l.grx[f+1]-l.grx[f]);for(h=w;h<r;++h)if(I(f,h,N)){Q=!z&&0<N;Z=!z&&H>
K&&N<E.length-2;var fa=l.gry[h]+l.ybar1*(l.gry[h+1]-l.gry[h]);var ha=l.gry[h]+l.ybar2*(l.gry[h+1]-l.gry[h]);L=D<=F?O:p.grz(D);ba=H>K?J:p.grz(H);ea=ca=0;z&&(ca+=12,ea+=24);var ja=c.length,ka=V.getBin(f+1,h+1);for(Q&&(ja-=6);ea<ja;)Q=b[c[ea]],M&&12>ea?(t[da]=v+Q.x*(Y-v),t[da+1]=fa+Q.y*(ha-fa),t[da+2]=L+Q.z*(ba-L),U[da]=d[ca],U[da+1]=d[ca+1],U[da+2]=d[ca+2],0===da%9&&(P[da/9]=ka),da+=3):(X[W]=v+Q.x*(Y-v),X[W+1]=fa+Q.y*(ha-fa),X[W+2]=L+Q.z*(ba-L),S[W]=d[ca],S[W+1]=d[ca+1],S[W+2]=d[ca+2],0===W%9&&(T[W/
9]=ka),W+=3),++ea,0===ea%6&&(ca+=3,Z&&ea===c.length-12&&(ea+=6,ca+=3))}}f=new e.BufferGeometry;f.setAttribute("position",new e.BufferAttribute(X,3));f.setAttribute("normal",new e.BufferAttribute(S,3));h=V.fFillColor;v=this.getColor(h);if(G)v=G.calcColor(N,E.length);else if(1===this.options.Lego||2>h)h=1,v="white";Y=new e.MeshBasicMaterial({color:v,flatShading:!0});f=new e.Mesh(f,Y);f.face_to_bins_index=T;f.painter=this;f.zmin=n;f.zmax=g;f.baseline=!1!==this.options.BaseLine?this.options.BaseLine:
this.options.Zero?n:0;f.tip_color=3===h?16711680:65280;f.handle=l;f.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("faceIndex not provided, check three.js version",e.REVISION,"expected r121"),null;if(0>a.faceIndex||a.faceIndex>=this.face_to_bins_index.length)return null;var b=this.painter,c=this.handle,d=b.getFramePainter(),f=b.getHisto();a=b.get3DToolTip(this.face_to_bins_index[a.faceIndex]);a.x1=Math.max(-d.size_xy3d,c.grx[a.ix-1]+c.xbar1*(c.grx[a.ix]-c.grx[a.ix-1]));
a.x2=Math.min(d.size_xy3d,c.grx[a.ix-1]+c.xbar2*(c.grx[a.ix]-c.grx[a.ix-1]));a.y1=Math.max(-d.size_xy3d,c.gry[a.iy-1]+c.ybar1*(c.gry[a.iy]-c.gry[a.iy-1]));a.y2=Math.min(d.size_xy3d,c.gry[a.iy-1]+c.ybar2*(c.gry[a.iy]-c.gry[a.iy-1]));c=this.baseline;var g=a.value;f.$baseh&&(c=f.$baseh.getBinContent(a.ix,a.iy));g<c&&(f=c,c=g,g=f);a.z1=d.grz(Math.max(this.zmin,c));a.z2=d.grz(Math.min(this.zmax,g));a.color=this.tip_color;b.is_projection&&2==b.getDimension()&&(a.$painter=b);return a};p.toplevel.add(f);
0<R&&(Y=new e.BufferGeometry,Y.setAttribute("position",new e.BufferAttribute(t,3)),Y.setAttribute("normal",new e.BufferAttribute(U,3)),h=2>h?new e.Color(16711680):new e.Color(k.rgb(v).darker(.5).toString()),h=new e.MeshBasicMaterial({color:h,flatShading:!0}),h=new e.Mesh(Y,h),h.face_to_bins_index=P,h.painter=this,h.handle=f.handle,h.tooltip=f.tooltip,h.zmin=f.zmin,h.zmax=f.zmax,h.baseline=f.baseline,h.tip_color=f.tip_color,p.toplevel.add(h))}if(!(12<this.options.Lego)){v=Y=0;c=!0;K=g;F=n;for(f=m;f<
u;++f)for(h=w;h<r;++h)I(f,h,0)&&(Y+=z?q.length:b.length,v+=z?y.length:A.length);65520<Y&&(c=!1);c||(Y=3*v);d=new Float32Array(3*Y);M=c?new Uint16Array(v):null;C=p.grz(n);E=p.grz(g);R=P=N=G=0;for(f=m;f<u;++f)for(v=l.grx[f]+l.xbar1*(l.grx[f+1]-l.grx[f]),Y=l.grx[f]+l.xbar2*(l.grx[f+1]-l.grx[f]),h=w;h<r;++h)if(I(f,h,0))if(fa=l.gry[h]+l.ybar1*(l.gry[h+1]-l.gry[h]),ha=l.gry[h]+l.ybar2*(l.gry[h+1]-l.gry[h]),G=D<=n?C:p.grz(D),N=H>g?E:p.grz(H),U=z?y:A,T=z?q:b,c){for(m=0;m<U.length;++m)M[R++]=P/3+U[m];for(m=
0;m<T.length;++m)t=T[m],d[P]=v+t.x*(Y-v),d[P+1]=fa+t.y*(ha-fa),d[P+2]=G+t.z*(N-G),P+=3}else for(m=0;m<U.length;++m)t=T[U[m]],d[P]=v+t.x*(Y-v),d[P+1]=fa+t.y*(ha-fa),d[P+2]=G+t.z*(N-G),P+=3;b=this.getColor(V.fLineColor);b=new e.LineBasicMaterial({color:new e.Color(b),linewidth:V.fLineWidth});b=x.createLineSegments(d,b,c?M:null);p.toplevel.add(b)}}}};x.drawAxis3D=function(a,b){a=new JSROOT.ObjectPainter(a,b);"_main"in b||a.addToPadPrimitives();a.Draw3DAxis=function(){var a=this.getFramePainter();if(!a||
!a._toplevel)return Promise.reject(Error("no 3D frame found for 3D axis drawing"));var b=(new e.Box3).setFromObject(a._toplevel);this.xmin=b.min.x;this.xmax=b.max.x;this.ymin=b.min.y;this.ymax=b.max.y;this.zmin=b.min.z;this.zmax=b.max.z;this.size_xy3d=this.size_z3d=0;this.drawXYZ=JSROOT.TFramePainter.prototype.drawXYZ;this.drawXYZ(a._toplevel);a.adjustCameraPosition();a.render3D();return Promise.resolve(this)};return a.Draw3DAxis()};JSROOT.TH1Painter.prototype.draw3D=function(a){var b=this;this.mode3d=
!0;var c=this.getFramePainter(),d=this.isMainPainter(),e=this.getHisto();"resize"==a?d&&c.resize3D()&&c.render3D():(this.deleteAttr(),this.scanContent(!0),d&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(e.fXaxis,this.xmin,this.xmax,e.fYaxis,this.ymin,this.ymax,e.fZaxis,0,0),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{use_y_for_z:!0,zmult:1.1,zoom:JSROOT.settings.Zooming,ndim:1})),c.mode3d&&(this.draw3DBins(),c.render3D(),this.updateStatWebCanvas(),c.addKeysHandler()));return d?this.drawColorPalette(this.options.Zscale&&
(12===this.options.Lego||14===this.options.Lego)).then(function(){return b.drawHistTitle()}):Promise.resolve(this)};JSROOT.TH2Painter.prototype.draw3D=function(a){var b=this;this.mode3d=!0;var c=this.getFramePainter(),d=this.isMainPainter(),e=this.getHisto();if("resize"==a)d&&c.resize3D()&&c.render3D();else{a=this.getPadPainter().getRootPad(!0);var y=1.1;this.zmin=a&&a.fLogz?.3*this.gminposbin:this.gminbin;this.zmax=this.gmaxbin;-1111!==this.options.minimum&&(this.zmin=this.options.minimum);-1111!==
this.options.maximum&&(this.zmax=this.options.maximum,y=1);a&&a.fLogz&&0>=this.zmin&&(this.zmin=1E-5*this.zmax);this.deleteAttr();d&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(e.fXaxis,this.xmin,this.xmax,e.fYaxis,this.ymin,this.ymax,e.fZaxis,this.zmin,this.zmax),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{zmult:y,zoom:JSROOT.settings.Zooming,ndim:2}));c.mode3d&&(this.draw3DBins(),c.render3D(),this.updateStatWebCanvas(),c.addKeysHandler())}return d?this.drawColorPalette(this.options.Zscale&&
(12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf)).then(function(){return b.drawHistTitle()}):Promise.resolve(this)};JSROOT.TH2Painter.prototype.drawContour3D=function(a){var b=this.getFramePainter(),c=this.prepareColorDraw({rounding:!1,use3d:!0,extra:100,middle:0}),d=this.getHisto(),e=this.getContourLevels(),y=this.getHistPalette(),q=2*b.size_z3d,p=[];this.buildContour(c,e,y,function(c,d,l,m,A,w){if(!(3>A-m)){if(a&&(q=b.grz(e[w]),0>q||q>2*b.size_z3d))return;
for(c=m;c<A;++c)p.push(d[c],l[c],q),p.push(d[c+1],l[c+1],q)}});c=x.createLineSegments(p,x.create3DLineMaterial(this,d));b.toplevel.add(c)};JSROOT.TH2Painter.prototype.drawSurf=function(){function a(a,b,c,d,e,f){if(h){var g=0>c?-1:c>2*p.size_z3d?1:0,l=0>f?-1:f>2*p.size_z3d?1:0;if(g!==l||0===g){if(!H)return++M;if(0!==g){var n=f-c;c=0>g?0:2*p.size_z3d;a=d-(d-a)/n*(f-c);b=e-(e-b)/n*(f-c)}0!==l&&(g=c-f,f=0>l?0:2*p.size_z3d,d=a-(a-d)/g*(c-f),e=b-(b-e)/g*(c-f));I[C]=a;I[C+1]=b;I[C+2]=c;C+=3;I[C]=d;I[C+1]=
e;I[C+2]=f;C+=3}}}function b(a,b,c,d,e,f,g,l){L>=K.length&&console.log("more than 6 points???");c=(g-c)/(f-c);f=3;0!==ba&&Math.abs(c)<Math.abs(ba)&&(K[L]=K[L-3],K[L+1]=K[L-2],K[L+2]=K[L-1],L-=3,f=6);K[L]=a+c*(d-a);K[L+1]=b+c*(e-b);K[L+2]=g;l&&G&&(R[O]=K[L],R[O+1]=K[L+1],R[O+2]=K[L+2],O+=3);L+=f;ba=c}function c(a,b,c){b=8*((b-n.i1)*(n.j2-n.j1)+(c-n.j1));if(0<=F[b])return console.error("More than 8 vertexes for the bin");c=b+8+F[b];F[b]--;F[c]=a}function d(a){for(var b=n.i1;b<n.i2;++b)for(var c=n.j1;c<
n.j2;++c){var d=8*((b-n.i1)*(n.j2-n.j1)+(c-n.j1));if(-1!==F[d]){var e=0<=F[d]?d:d+9+F[d];d+=8;for(var f=0,g=0,l=0,h=e;h<d;++h){var m=F[h];if(0>m)return console.error("FAILURE in NORMALS RECALCULATIONS");f+=a[m];g+=a[m+1];l+=a[m+2]}f/=d-e;g/=d-e;for(l/=d-e;e<d;++e)h=F[e],a[h]=f,a[h+1]=g,a[h+2]=l}}}function A(a,d,e,h,n,m,p,q,t,w){for(var A=1;A<f.length;++A){var r=e<f[A-1]?-1:e>f[A]?1:0,u=m<f[A-1]?-1:m>f[A]?1:0,y=t<f[A-1]?-1:t>f[A]?1:0,D=r+u+y;if(3!==D){if(-3===D)break;if(H){if(L=O=0,0===r&&(K[L]=a,
K[L+1]=d,K[L+2]=e,L+=3),r!==u&&(ba=0,(0>r||0>u)&&b(a,d,e,h,n,m,f[A-1]),(0<r||0<u)&&b(a,d,e,h,n,m,f[A],!0)),0===u&&(K[L]=h,K[L+1]=n,K[L+2]=m,L+=3),u!==y&&(ba=0,(0>u||0>y)&&b(h,n,m,p,q,t,f[A-1]),(0<u||0<y)&&b(h,n,m,p,q,t,f[A],!0)),0===y&&(K[L]=p,K[L+1]=q,K[L+2]=t,L+=3),y!==r&&(ba=0,(0>y||0>r)&&b(p,q,t,a,d,e,f[A-1]),(0<y||0<r)&&b(p,q,t,a,d,e,f[A],!0)),0!==L)if(9>L)console.log("found less than 3 points",L/3);else{if(G&&6===O){for(r=0;6>r;++r)G[N+r]=R[r];N+=6}r=k[A];u=B[A];v&&9===L&&(c(u,g,l),c(u+3,g+
1,w?l+1:l),c(u+6,w?g:g+1,l+1));for(y=3;y<L-3;y+=3)r[u]=K[0],r[u+1]=K[1],r[u+2]=K[2],u+=3,r[u]=K[y],r[u+1]=K[y+1],r[u+2]=K[y+2],u+=3,r[u]=K[y+3],r[u+1]=K[y+4],r[u+2]=K[y+5],u+=3;B[A]=u}}else D=Math.abs(u-r)+Math.abs(y-u)+Math.abs(r-y),0===r&&++D,0===u&&++D,0===y&&++D,1!==D&&2!==D||console.error("FOND npnts",D),2<D&&(void 0===z[A]&&(z[A]=0),z[A]+=D-2),!(0<r||0<u||0<y)||r===u&&u===y&&y===r||++E}}}var y=this,q=this.getHisto(),p=this.getFramePainter(),n=this.prepareColorDraw({rounding:!1,use3d:!0,extra:1,
middle:.5}),g,l,m,u,w=p.z_handle.gr.domain()[0],r=p.logz?function(a){return a<w?-.1:p.grz(a)}:p.grz;if(!(2>n.i2-n.i1||2>n.j2-n.j1)){var f=m=null,h=!0,t=!1,v=!1,D=null;switch(this.options.Surf){case 11:m=this.getContourLevels();D=this.getHistPalette();break;case 12:case 15:case 17:m=this.getContourLevels();D=this.getHistPalette();h=!1;break;case 14:h=!1;v=!0;break;case 16:m=this.getContourLevels();t=!0;h=!1;break;default:m=p.z_handle.createTicks(!0),t=!0}if(m)for(f=new Float32Array(m.length),u=0;u<
m.length;++u)f[u]=r(m[u]);else f=[0,2*p.size_z3d];var H,z=[],k=[],B=[],M=0,I=null,C=0,E=0,G=null,N=0,F=[],K=new Float32Array(18),L=0,ba=0,R=new Float32Array(6),O=0;if(v)for(F=new Int32Array((n.i2-n.i1)*(n.j2-n.j1)*8),m=0;m<F.length;++m)F[m]=-1;for(H=0;2>H;++H){if(H){for(m=1;m<f.length;++m)z[m]&&(k[m]=new Float32Array(9*z[m]),B[m]=0);h&&0<M&&(I=new Float32Array(6*M));t&&0<E&&(G=new Float32Array(6*E))}for(g=n.i1;g<n.i2-1;++g){m=n.grx[g];var J=n.grx[g+1];for(l=n.j1;l<n.j2-1;++l){u=n.gry[l];var Q=n.gry[l+
1];var Z=r(q.getBinContent(g+1,l+1));var X=r(q.getBinContent(g+1,l+2));var S=r(q.getBinContent(g+2,l+1));var T=r(q.getBinContent(g+2,l+2));A(m,u,Z,J,Q,T,m,Q,X,!0);A(m,u,Z,J,u,S,J,Q,T,!1);a(m,Q,X,m,u,Z);a(m,u,Z,J,u,S);g===n.i2-2&&a(J,u,S,J,Q,T);l===n.j2-2&&a(m,Q,X,J,Q,T)}}}for(r=1;r<f.length;++r)k[r]&&(B[r]!==9*z[r]&&console.error("SURF faces missmatch lvl",r,"faces",z[r],"index",B[r],"check",9*z[r]-B[r]),t=new e.BufferGeometry,t.setAttribute("position",new e.BufferAttribute(k[r],3)),t.computeVertexNormals(),
v&&1===r&&d(t.getAttribute("normal").array),m=m=void 0,D?m=D.calcColor(r,f.length):(m=1<q.fFillColor?this.getColor(q.fFillColor):"white",14===this.options.Surf&&2>q.fFillColor&&(m=this.getColor(48))),m=14===this.options.Surf?new e.MeshLambertMaterial({color:m,side:e.DoubleSide}):new e.MeshBasicMaterial({color:m,side:e.DoubleSide}),t=new e.Mesh(t,m),p.toplevel.add(t),t.painter=this);I&&(6*M!==C&&console.error("SURF lines mismmatch nsegm",M," lindx",C,"difference",6*M-C),D=this.getColor(q.fLineColor),
D=new e.LineBasicMaterial({color:new e.Color(D),linewidth:q.fLineWidth}),D=x.createLineSegments(I,D),D.painter=this,p.toplevel.add(D));G&&(6*E!==N&&console.error("SURF grid draw mismatch ngridsegm",E,"gindx",N,"diff",6*E-N),q=1===this.options.Surf?new e.LineDashedMaterial({color:0,dashSize:2,gapSize:2}):new e.LineBasicMaterial({color:new e.Color(this.getColor(q.fLineColor))}),q=x.createLineSegments(G,q),q.painter=this,p.toplevel.add(q));17===this.options.Surf&&this.drawContour3D();if(13===this.options.Surf){n=
this.prepareColorDraw({rounding:!1,use3d:!0,extra:100,middle:0});q=this.getContourLevels();var U=this.getHistPalette(),P=-1,W=2*p.size_z3d;this.buildContour(n,q,U,function(a,b,c,d,f){b[f]===b[d]&&c[f]===c[d]&&f--;if(!(3>f-d)){for(var g=[],h=d;h<=f;++h)h!==d&&b[h]===b[h-1]&&c[h]===c[h-1]||g.push(new e.Vector2(b[h],c[h]));if(!(3>g.length)&&(d=e.ShapeUtils.triangulateShape(g,[]))&&0!==d.length){if(0>P||P!==a)P=a,W+=1E-4*p.size_z3d;b=new Float32Array(9*d.length);c=new Float32Array(9*d.length);for(h=f=
0;h<d.length;++h)for(var l=d[h],n=0;3>n;++n){var m=g[l[n]];b[f]=m.x;b[f+1]=m.y;b[f+2]=W;c[f]=0;c[f+1]=0;c[f+2]=1;f+=3}g=new e.BufferGeometry;g.setAttribute("position",new e.BufferAttribute(b,3));g.setAttribute("normal",new e.BufferAttribute(c,3));a=U.getColor(a);a=new e.MeshBasicMaterial({color:a,flatShading:!0,side:e.DoubleSide,opacity:.5});a=new e.Mesh(g,a);a.painter=y;p.toplevel.add(a)}}})}}};JSROOT.TH2Painter.prototype.drawError=function(){for(var a=this.getFramePainter(),b=this.getHisto(),c=
this.prepareColorDraw({rounding:!1,use3d:!0,extra:1}),d=a.z_handle.gr.domain()[0],A=a.z_handle.gr.domain()[1],y,q,p,n,g,l,m,u,w,r=0,f=null,h=null,t=0,v=0;2>v;++v){for(y=c.i1;y<c.i2;++y)for(l=c.grx[y],m=c.grx[y+1],q=c.j1;q<c.j2;++q)if(n=b.getBinContent(y+1,q+1),!(n<d||n>A)){if(g=n===d)g=this.options.Zero||0<d?!1:!this._show_empty_bins;g||(0===v?r+=3:(p=b.getBin(y+1,q+1),g=b.getBinError(p),h[t/18]=p,p=c.gry[q],u=c.gry[q+1],w=a.grz(n-g<d?d:n-g),n=a.grz(n+g>A?A:n+g),f[t]=l,f[t+3]=m,f[t+1]=f[t+4]=(p+u)/
2,f[t+2]=f[t+5]=(w+n)/2,t+=6,f[t]=f[t+3]=(l+m)/2,f[t+1]=p,f[t+4]=u,f[t+2]=f[t+5]=(w+n)/2,t+=6,f[t]=f[t+3]=(l+m)/2,f[t+1]=f[t+4]=(p+u)/2,f[t+2]=w,f[t+5]=n,t+=6))}if(0===v){if(0===r)return;f=new Float32Array(6*r);h=new Int32Array(r/3)}}b=this.getColor(this.getObject().fLineColor);b=new e.LineBasicMaterial({color:new e.Color(b),linewidth:this.getObject().fLineWidth});f=x.createLineSegments(f,b);f.painter=this;f.intersect_index=h;f.zmin=d;f.zmax=A;f.tip_color=3===this.getObject().fLineColor?16711680:
65280;f.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("segment index not provided, check three.js version",e.REVISION,"expected r121"),null;var b=Math.floor(a.index/6);if(0>b||b>=this.intersect_index.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.intersect_index[b]);b.x1=Math.max(-d.size_xy3d,d.grx(a.fXaxis.GetBinLowEdge(b.ix)));b.x2=Math.min(d.size_xy3d,d.grx(a.fXaxis.GetBinLowEdge(b.ix+1)));b.y1=Math.max(-d.size_xy3d,
d.gry(a.fYaxis.GetBinLowEdge(b.iy)));b.y2=Math.min(d.size_xy3d,d.gry(a.fYaxis.GetBinLowEdge(b.iy+1)));b.z1=d.grz(b.value-b.error<this.zmin?this.zmin:b.value-b.error);b.z2=d.grz(b.value+b.error>this.zmax?this.zmax:b.value+b.error);b.color=this.tip_color;return b};a.toplevel.add(f)};JSROOT.TH2Painter.prototype.drawPolyLego=function(){var a=this.getHisto(),b=this.getFramePainter(),c=b.z_handle.gr.domain()[0],d=b.z_handle.gr.domain()[1],A,y=a.fBins.arr.length,q=b.grz(c);this.maxbin=this.gmaxbin;this.minbin=
this.gminbin;this.minposbin=this.gminposbin;var p=this.getContour(!0),n=this.getHistPalette();for(A=0;A<y;++A){var g=a.fBins.arr[A];if(!(g.fContent<c)){var l=p.getPaletteIndex(n,g.fContent);if(null!==l&&!(g.fXmin>b.scale_xmax||g.fXmax<b.scale_xmin||g.fYmin>b.scale_ymax||g.fYmax<b.scale_ymin)){var m=b.grz(g.fContent>d?d:g.fContent);var u=[],w=[],r=1,f=g.fPoly,h=0;"TMultiGraph"==f._typename&&(r=g.fPoly.fGraphs.arr.length,f=null);for(var t=0;t<r;++t){if(!f||0<t)f=g.fPoly.fGraphs.arr[t];for(var v=f.fNpoints,
D=f.fX,k=f.fY;2<v&&D[0]===D[v-1]&&k[0]===k[v-1];)--v;for(var z=void 0,x=void 0,B=0;2>B;++B){var M=void 0,I=void 0,C=void 0,E=void 0,G=b.size_xy3d*b.size_z3d,N=0<B?0:G/1E6;z=[];x=null;for(var F=0;F<v;++F)C=b.grx(D[F]),E=b.gry(k[F]),0<F&&(G=(C-M)*(C-M)+(E-I)*(E-I)),G>N&&(z.push(new e.Vector2(C,E)),M=C,I=E);try{2<z.length&&(x=e.ShapeUtils.triangulateShape(z,[]))}catch(K){x=null}if(x&&x.length>z.length-3)break}x&&x.length&&z&&(u.push(z),w.push(x),h+=2*x.length,m>q&&(h+=2*z.length))}g=new Float32Array(9*
h);for(f=r=0;f<u.length;++f){h=u[f];t=w[f];for(v=0;2>v;++v)for(D=0;D<t.length;++D)x=t[D],k=h[x[0]],z=h[x[0===v?2:1]],x=h[x[0===v?1:2]],g[r]=k.x,g[r+1]=k.y,g[r+2]=v?m:q,r+=3,g[r]=z.x,g[r+1]=z.y,g[r+2]=v?m:q,r+=3,g[r]=x.x,g[r+1]=x.y,g[r+2]=v?m:q,r+=3;if(m>q)for(t=0;t<h.length;++t)v=h[t],D=h[0<t?t-1:h.length-1],g[r]=v.x,g[r+1]=v.y,g[r+2]=q,r+=3,g[r]=D.x,g[r+1]=D.y,g[r+2]=q,r+=3,g[r]=D.x,g[r+1]=D.y,g[r+2]=m,r+=3,g[r]=v.x,g[r+1]=v.y,g[r+2]=q,r+=3,g[r]=D.x,g[r+1]=D.y,g[r+2]=m,r+=3,g[r]=v.x,g[r+1]=v.y,g[r+
2]=m,r+=3}u=new e.BufferGeometry;u.setAttribute("position",new e.BufferAttribute(g,3));u.computeVertexNormals();l=this.fPalette.getColor(l);l=new e.MeshBasicMaterial({color:l,flatShading:!0});l=new e.Mesh(u,l);b.toplevel.add(l);l.painter=this;l.bins_index=A;l.draw_z0=q;l.draw_z1=m;l.tip_color=65280;l.tooltip=function(){var a=this.painter,b=a.getFramePainter(),c=a.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:b.grx(c.fXmin),x2:b.grx(c.fXmax),y1:b.gry(c.fYmin),y2:b.gry(c.fYmax),z1:this.draw_z0,
z2:this.draw_z1,bin:this.bins_index,value:c.fContent,color:this.tip_color,lines:a.getPolyBinTooltips(this.bins_index)}}}}}};J.prototype=Object.create(JSROOT.THistPainter.prototype);J.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy&&this.nbinsz)){a=this.getObject();this.extractAxesProperties(3);this.gminbin=this.gmaxbin=a.getBinContent(1,1,1);for(var b=0;b<this.nbinsx;++b)for(var c=0;c<this.nbinsy;++c)for(var d=0;d<this.nbinsz;++d){var e=a.getBinContent(b+1,c+1,d+1);e<this.gminbin?
this.gminbin=e:e>this.gmaxbin&&(this.gmaxbin=e)}this.draw_content=0<this.gmaxbin}};J.prototype.countStat=function(){var a=this.getHisto(),b=a.fXaxis,c=a.fYaxis,d=a.fZaxis,e=0,y=0,q=0,p=0,n=0,g=0,l=0,m=this.getSelectIndex("x","left"),u=this.getSelectIndex("x","right"),w=this.getSelectIndex("y","left"),r=this.getSelectIndex("y","right"),f=this.getSelectIndex("z","left"),h=this.getSelectIndex("z","right"),t=this.getFramePainter(),v={name:a.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,
rmsz:0},x,k,z;for(x=0;x<this.nbinsx+2;++x){var B=b.GetBinCoord(x-.5);var O=x<m?0:x>u?2:1;for(k=0;k<this.nbinsy+2;++k){var M=c.GetBinCoord(k-.5);var I=k<w?0:k>r?2:1;for(z=0;z<this.nbinsz+2;++z){var C=d.GetBinCoord(z-.5);var E=z<f?0:z>h?2:1;var G=a.getBinContent(x,k,z);v.entries+=G;1==O&&1==I&&1==E&&(e+=G,y+=B*G,q+=M*G,p+=C*G,n+=B*B*G,g+=M*M*G,l+=C*C*G)}}}0<a.fTsumw&&!t.isAxisZoomed("x")&&!t.isAxisZoomed("y")&&!t.isAxisZoomed("z")&&(e=a.fTsumw,y=a.fTsumwx,n=a.fTsumwx2,q=a.fTsumwy,g=a.fTsumwy2,p=a.fTsumwz,
l=a.fTsumwz2);0<e&&(v.meanx=y/e,v.meany=q/e,v.meanz=p/e,v.rmsx=Math.sqrt(Math.abs(n/e-v.meanx*v.meanx)),v.rmsy=Math.sqrt(Math.abs(g/e-v.meany*v.meany)),v.rmsz=Math.sqrt(Math.abs(l/e-v.meanz*v.meanz)));v.integral=e;1<a.fEntries&&(v.entries=a.fEntries);return v};J.prototype.fillStatistic=function(a,b,c){if(this.isIgnoreStatsFill())return!1;var d=this.countStat(),e=b%10,y=Math.floor(b/10)%10,q=Math.floor(b/100)%10,p=Math.floor(b/1E3)%10;b=Math.floor(b/1E6)%10;a.clearPave();0<e&&a.addText(d.name);0<y&&
a.addText("Entries = "+a.format(d.entries,"entries"));0<q&&(a.addText("Mean x = "+a.format(d.meanx)),a.addText("Mean y = "+a.format(d.meany)),a.addText("Mean z = "+a.format(d.meanz)));0<p&&(a.addText("Std Dev x = "+a.format(d.rmsx)),a.addText("Std Dev y = "+a.format(d.rmsy)),a.addText("Std Dev z = "+a.format(d.rmsz)));0<b&&a.addText("Integral = "+a.format(d.integral,"entries"));c&&a.fillFunctionStat(this.findFunction("TF3"),c);return!0};J.prototype.getBinTooltips=function(a,b,c){var d=[],e=this.getHisto();
d.push(this.getObjectHint());d.push("x = "+this.getAxisBinTip("x",e.fXaxis,a)+"  xbin="+(a+1));d.push("y = "+this.getAxisBinTip("y",e.fYaxis,b)+"  ybin="+(b+1));d.push("z = "+this.getAxisBinTip("z",e.fZaxis,c)+"  zbin="+(c+1));a=e.getBinContent(a+1,b+1,c+1);a===Math.round(a)?d.push("entries = "+a):d.push("entries = "+x.floatToString(a,JSROOT.gStyle.fStatFormat));return d};J.prototype.draw3DScatter=function(){var a=this.getObject(),b=this.getFramePainter(),c=this.getSelectIndex("x","left",.5),d=this.getSelectIndex("x",
"right",0),A=this.getSelectIndex("y","left",.5),y=this.getSelectIndex("y","right",0),q=this.getSelectIndex("z","left",.5),p=this.getSelectIndex("z","right",0),n,g,l;if(d<=c||y<=A||p<=q)return!0;var m=1E3<this.gmaxbin?1E3/this.gmaxbin:1,u=0,w=0,r=Math.max(0,this.gminbin);for(n=c;n<d;++n)for(g=A;g<y;++g)for(l=q;l<p;++l){var f=a.getBinContent(n+1,g+1,l+1);w+=f;f<=r||(u+=Math.round(f*m))}if(u>(b.webgl?1E5:3E4))return!1;JSROOT.seed(w);w=new x.PointsCreator(u,b.webgl,b.size_xy3d/200);u=new Int32Array(u);
var h=0;for(n=c;n<d;++n)for(g=A;g<y;++g)for(l=q;l<p;++l)if(f=a.getBinContent(n+1,g+1,l+1),!(f<=r))for(c=Math.round(f*m),f=0;f<c;++f){var t=a.fXaxis.GetBinCoord(n+JSROOT.random()),v=a.fYaxis.GetBinCoord(g+JSROOT.random()),k=a.fZaxis.GetBinCoord(l+JSROOT.random());u[h++]=a.getBin(n+1,g+1,l+1);w.addPoint(b.grx(t),b.gry(v),b.grz(k))}d=w.createPoints(this.getColor(a.fMarkerColor));b.toplevel.add(d);d.bins=u;d.painter=this;d.tip_color=3===a.fMarkerColor?16711680:65280;d.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, check three.js version",
e.REVISION,"expected r121"),null;var b=Math.floor(a.index/this.nvertex);if(0>b||b>=this.bins.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.bins[b]);b.x1=d.grx(a.fXaxis.GetBinLowEdge(b.ix));b.x2=d.grx(a.fXaxis.GetBinLowEdge(b.ix+1));b.y1=d.gry(a.fYaxis.GetBinLowEdge(b.iy));b.y2=d.gry(a.fYaxis.GetBinLowEdge(b.iy+1));b.z1=d.grz(a.fZaxis.GetBinLowEdge(b.iz));b.z2=d.grz(a.fZaxis.GetBinLowEdge(b.iz+1));b.color=this.tip_color;b.opacity=.3;return b};
return!0};J.prototype.draw3DBins=function(){if(this.draw_content&&(this.options.Box||this.options.GLBox||this.options.GLColor||this.options.Lego||!this.draw3DScatter())){var a=this.getObject().fFillColor,b=this.getColor(a),c=this.getFramePainter(),d=0,A=!1,y=!1,q=!1,p=1,n=!0,g=this.options.Box?this.options.BoxStyle:0,l=.5;!g&&this.options.Lego&&(g=1===this.options.Lego?10:this.options.Lego);if(11===this.options.GLBox||12===this.options.GLBox){l=.4;A=!0;12===this.options.GLBox&&(q=!0);g=c.webgl?new e.SphereGeometry(.5,
16,12):new e.SphereGeometry(.5,8,6);g.applyMatrix4((new e.Matrix4).makeRotationX(Math.PI/2));d=9*g.faces.length;var m=new Float32Array(d);var u=new Float32Array(d);for(var w=0;w<g.faces.length;++w)m[9*w]=g.vertices[g.faces[w].a].x,m[9*w+1]=g.vertices[g.faces[w].a].y,m[9*w+2]=g.vertices[g.faces[w].a].z,m[9*w+3]=g.vertices[g.faces[w].b].x,m[9*w+4]=g.vertices[g.faces[w].b].y,m[9*w+5]=g.vertices[g.faces[w].b].z,m[9*w+6]=g.vertices[g.faces[w].c].x,m[9*w+7]=g.vertices[g.faces[w].c].y,m[9*w+8]=g.vertices[g.faces[w].c].z,
u[9*w]=g.faces[w].vertexNormals[0].x,u[9*w+1]=g.faces[w].vertexNormals[0].y,u[9*w+2]=g.faces[w].vertexNormals[0].z,u[9*w+3]=g.faces[w].vertexNormals[1].x,u[9*w+4]=g.faces[w].vertexNormals[1].y,u[9*w+5]=g.faces[w].vertexNormals[1].z,u[9*w+6]=g.faces[w].vertexNormals[2].x,u[9*w+7]=g.faces[w].vertexNormals[2].y,u[9*w+8]=g.faces[w].vertexNormals[2].z}else{w=x.Box3D.Indexes;var r=x.Box3D.Normals,f=x.Box3D.Vertices;d=3*w.length;m=new Float32Array(d);u=new Float32Array(d);for(var h=0,t=-3;h<w.length;++h){var v=
f[w[h]];m[3*h]=v.x-.5;m[3*h+1]=v.y-.5;m[3*h+2]=v.z-.5;0===h%6&&(t+=3);u[3*h]=r[t];u[3*h+1]=r[t+1];u[3*h+2]=r[t+2]}y=!0;12===g?q=!0:13===g?(q=!0,y=!1):this.options.GLColor&&(q=!0,p=.5,y=n=!1,A=!0)}n&&(n=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);var k=this.getHisto(),H=this.getSelectIndex("x","left",.5),z=this.getSelectIndex("x","right",0),B=this.getSelectIndex("y","left",.5),O=this.getSelectIndex("y","right",0),M=this.getSelectIndex("z","left",.5),I=this.getSelectIndex("z",
"right",0);if(!(z<=H||O<=B||I<=M)){g=(c.grx(k.fXaxis.GetBinLowEdge(z+1))-c.grx(k.fXaxis.GetBinLowEdge(H+1)))/(z-H);w=(c.gry(k.fYaxis.GetBinLowEdge(O+1))-c.gry(k.fYaxis.GetBinLowEdge(B+1)))/(O-B);r=(c.grz(k.fZaxis.GetBinLowEdge(I+1))-c.grz(k.fZaxis.GetBinLowEdge(M+1)))/(I-M);var C=0,E,G,N;f=[];var F=0;h=[];var K=q?this.getContour():null,L=q?this.getHistPalette():null;for(E=H;E<z;++E)for(G=B;G<O;++G)for(N=M;N<I;++N){var J=k.getBinContent(E+1,G+1,N+1);if(this.options.GLColor||!(0===J||J<this.gminbin)){var R=
n?Math.pow(Math.abs(J*n),.3333):1;.001>R||(C++,q&&(t=K.getPaletteIndex(L,J),null!==t?(void 0===f[t]&&(f[t]=0,h[t]=F++),f[t]+=1):console.error("not found color for",J)))}}q||(f.push(C),F=1,h=[0]);var aa=Array(F);t=Array(F);v=Array(F);var ia=Array(F),Q=Array(F),Z=Array(F);F=Array(F);for(E=0;E<f.length;++E)f[E]&&(C=f[E],G=h[E],aa[G]=0,Q[G]=0,y&&(Q[G]=65520<C*d/3?2:1),t[G]=new Float32Array(C*d),v[G]=new Float32Array(C*d),ia[G]=new Int32Array(C),1===Q[G]&&(Z[G]=new Uint16Array(C*x.Box3D.MeshSegments.length)),
2===Q[G]&&(F[G]=new Float32Array(C*x.Box3D.Segments.length*3)));for(E=H;E<z;++E)for(C=k.fXaxis.GetBinCenter(E+1),y=c.grx(C),G=B;G<O;++G)for(C=k.fYaxis.GetBinCenter(G+1),H=c.gry(C),N=M;N<I;++N)if(J=k.getBinContent(E+1,G+1,N+1),this.options.GLColor||!(0===J||J<this.gminbin))if(R=n?Math.pow(Math.abs(J*n),.3333):1,!(.001>R)){var X=0;if(q){C=K.getPaletteIndex(L,J);if(null===C)continue;X=h[C]}C=aa[X];J=k.fZaxis.GetBinCenter(N+1);J=c.grz(J);ia[X][C]=k.getBin(E+1,G+1,N+1);for(var S=C*d,T=t[X],U=v[X],P=0;P<
d;P+=3,S+=3)T[S]=y+m[P]*g*R,T[S+1]=H+m[P+1]*w*R,T[S+2]=J+m[P+2]*r*R,U[S]=u[P],U[S+1]=u[P+1],U[S+2]=u[P+2];if(1===Q[X]){T=x.Box3D.MeshSegments;S=C*T.length;U=Math.round(C*d/3);P=Z[X];for(var W=0;W<T.length;++W)P[S+W]=U+T[W]}if(2===Q[X])for(T=x.Box3D.Segments,U=F[X],S=C*T.length*3,P=0;P<T.length;++P,S+=3)W=x.Box3D.Vertices[T[P]],U[S]=y+(W.x-.5)*g*R,U[S+1]=H+(W.y-.5)*w*R,U[S+2]=J+(W.z-.5)*r*R;aa[X]=C+1}for(m=0;m<f.length;++m)f[m]&&(u=h[m],k=new e.BufferGeometry,k.setAttribute("position",new e.BufferAttribute(t[u],
3)),k.setAttribute("normal",new e.BufferAttribute(v[u],3)),q&&(b=this.fPalette.getColor(m)),z=A?new e.MeshLambertMaterial({color:b,opacity:p,transparent:1>p}):new e.MeshBasicMaterial({color:b,opacity:p}),k=new e.Mesh(k,z),k.bins=ia[u],k.bins_faces=d/9,k.painter=this,k.scalex=l*g,k.scaley=l*w,k.scalez=l*r,k.tip_color=3===a?16711680:65280,k.use_scale=n,k.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("intersect.faceIndex not provided, check three.js version",e.REVISION,"expected r121"),
null;var b=Math.floor(a.faceIndex/this.bins_faces);if(0>b||b>=this.bins.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.bins[b]);c=d.grx(a.fXaxis.GetBinCoord(b.ix-.5));var f=d.gry(a.fYaxis.GetBinCoord(b.iy-.5));a=d.grz(a.fZaxis.GetBinCoord(b.iz-.5));d=this.use_scale?Math.pow(Math.abs(b.value*this.use_scale),.3333):1;b.x1=c-this.scalex*d;b.x2=c+this.scalex*d;b.y1=f-this.scaley*d;b.y2=f+this.scaley*d;b.z1=a-this.scalez*d;b.z2=a+this.scalez*d;b.color=
this.tip_color;return b},c.toplevel.add(k),0<Q[u]&&(k=this.getColor(this.getObject().fLineColor),k=new e.LineBasicMaterial({color:k}),z=null,z=1===Q[u]?x.createLineSegments(t[u],k,Z[u]):x.createLineSegments(F[u],k),c.toplevel.add(z)))}}};J.prototype.redraw=function(a){var b=this.getFramePainter(),c=this.getHisto();"resize"==a?b.resize3D()&&b.render3D():(b.create3DScene(this.options.Render3D),b.setAxesRanges(c.fXaxis,this.xmin,this.xmax,c.fYaxis,this.ymin,this.ymax,c.fZaxis,this.zmin,this.zmax),b.set3DOptions(this.options),
b.drawXYZ(b.toplevel,{zoom:JSROOT.settings.Zooming,ndim:3}),this.draw3DBins(),b.render3D(),this.updateStatWebCanvas(),b.addKeysHandler());return this.drawHistTitle()};J.prototype.fillToolbar=function(){var a=this.getPadPainter();a&&(a.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&a.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a.showPadButtons())};J.prototype.canZoomInside=function(a,b,c){var d=this.getHisto();d&&(d=d["f"+a.toUpperCase()+"axis"]);
return!d||1<d.FindBin(c,.5)-d.FindBin(b,0)};J.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right"),c=this.getSelectIndex("y","left"),d=this.getSelectIndex("y","right"),e=this.getSelectIndex("z","left"),k=this.getSelectIndex("z","right"),q,p,n,g=this.getObject();if(a!==b&&c!==d&&e!==k){var l=g.getBinContent(a+1,c+1,e+1);for(q=a;q<b;++q)for(p=c;p<d;++p)for(n=e;n<k;++n)l=Math.min(l,g.getBinContent(q+1,p+1,n+1));if(!(0<l)){var m=b,u=a,w=d,r=c,f=k,h=e;
for(q=a;q<b;++q)for(p=c;p<d;++p)for(n=e;n<k;++n)g.getBinContent(q+1,p+1,n+1)>l&&(q<m&&(m=q),q>=u&&(u=q+1),p<w&&(w=p),p>=r&&(r=p+1),n<f&&(f=n),n>=h&&(h=n+1));q=!1;m===u-1&&m>a+1&&u<b-1&&(m--,u++);w===r-1&&w>c+1&&r<d-1&&(w--,r++);f===h-1&&f>e+1&&h<k-1&&(f--,h++);if((m>a||u<b)&&m<u-1){var t=g.fXaxis.GetBinLowEdge(m+1);var v=g.fXaxis.GetBinLowEdge(u+1);q=!0}if((w>c||r<d)&&w<r-1){var x=g.fYaxis.GetBinLowEdge(w+1);var B=g.fYaxis.GetBinLowEdge(r+1);q=!0}if((f>e||h<k)&&f<h-1){var z=g.fZaxis.GetBinLowEdge(f+
1);var J=g.fZaxis.GetBinLowEdge(h+1);q=!0}q&&this.getFramePainter().zoom(t,v,x,B,z,J)}}};J.prototype.fillHistContextMenu=function(a){var b=this,c=x.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.interactiveRedraw(!0,"drawopt")})};x.drawHistogram3D=function(a,b,c){var d=new JSROOT.TH3Painter(a,b);return x.ensureTCanvas(d,"3d").then(function(){d.setAsMainPainter();d.decodeOptions(c);
d.checkPadRange();d.scanContent();return d.redraw()}).then(function(){var b=d.createStat();if(b)return JSROOT.draw(a,b,"")}).then(function(){d.fillToolbar();return d})};aa.prototype=Object.create(JSROOT.ObjectPainter.prototype);aa.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a);this.options||(this.options={});var c=this.options;c.Color=b.check("COL");c.Line=b.check("LINE");c.Error=b.check("ERR")&&this.matchObjectType("TGraph2DErrors");c.Circles=b.check("P0");c.Markers=b.check("P");
c.Markers||c.Error||c.Circles||c.Line||(c.Markers=!0);c.Markers||(c.Color=!1);this.storeDrawOpt(a)};aa.prototype.createHistogram=function(){for(var a=this.getObject(),b=a.fX[0],c=b,d=a.fY[0],e=d,k=a.fZ[0],q=k,p=0;p<a.fNpoints;++p){var n=a.fX[p],g=a.fY[p],l=a.fZ[p],m=this.options.Error?a.fEX[p]:0,u=this.options.Error?a.fEY[p]:0,w=this.options.Error?a.fEZ[p]:0;b=Math.min(b,n-m);c=Math.max(c,n+m);d=Math.min(d,g-u);e=Math.max(e,g+u);k=Math.min(k,l-w);q=Math.max(q,l+w)}b>=c&&(c=b+1);d>=e&&(e=d+1);k>=q&&
(q=k+1);p=.02*(c-b);g=.02*(e-d);m=.02*(q-k);a=b-p;p=c+p;n=d-g;g=e+g;l=k-m;m=q+m;0>a&&0<=b&&(a=.98*b);0<p&&0>=c&&(p=0);0>n&&0<=d&&(n=.98*d);0<g&&0>=e&&(g=0);0>l&&0<=k&&(l=.98*k);0<m&&0>=q&&(m=0);c=this.getObject();-1111!=c.fMinimum&&(l=c.fMinimum);-1111!=c.fMaximum&&(m=c.fMaximum);b=JSROOT.createHistogram("TH2I",10,10);b.fName=c.fName+"_h";b.fTitle=c.fTitle;b.fXaxis.fXmin=a;b.fXaxis.fXmax=p;b.fYaxis.fXmin=n;b.fYaxis.fXmax=g;b.fZaxis.fXmin=l;b.fZaxis.fXmax=m;b.fMinimum=l;b.fMaximum=m;c=JSROOT.BIT(9);
b.fBits|=c;return b};aa.prototype.graph2DTooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, check three.js version",e.REVISION,"expected r121"),null;var b=Math.floor(a.index/this.nvertex);if(0>b||b>=this.index.length)return null;var c=function(a){return a*a};b=this.index[b];var d=this.painter,k=this.graph,x=d.grx(k.fX[b]),q=d.gry(k.fY[b]),p=d.grz(k.fZ[b]);if(this.check_next&&b+1<k.fX.length){a=a.point;var n=d.grx(k.fX[b+1]),g=d.gry(k.fY[b+1]),l=d.grz(k.fZ[b+
1]);c(a.x-n)+c(a.y-g)+c(a.z-l)<c(a.x-x)+c(a.y-q)+c(a.z-p)&&(x=n,q=g,p=l,b++)}return{x1:x-this.scale0,x2:x+this.scale0,y1:q-this.scale0,y2:q+this.scale0,z1:p-this.scale0,z2:p+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+b,"x: "+d.axisAsText("x",k.fX[b]),"y: "+d.axisAsText("y",k.fY[b]),"z: "+d.axisAsText("z",k.fZ[b])]}};aa.prototype.redraw=function(){var a=this.getMainPainter(),b=this.getFramePainter(),c=this.getObject(),d=1;if(c&&a&&b&&b.mode3d){var k=function(a,d){for(var e=0,f=0;f<
c.fNpoints;++f)c.fX[f]<b.scale_xmin||c.fX[f]>b.scale_xmax||c.fY[f]<b.scale_ymin||c.fY[f]>b.scale_ymax||c.fZ[f]<a||c.fZ[f]>=d||++e;return e};if(0<JSROOT.settings.OptimizeDraw&&!b.webgl){var y=k(b.scale_zmin,b.scale_zmax);5E4<y&&(d=Math.floor(y/5E4),2>=d&&(d=2))}var q=new JSROOT.TAttMarkerHandler(c);y=null;var p=[b.scale_zmin,b.scale_zmax];q=b.size_xy3d/100*q.getFullSize();this.options.Circles&&(q=.06*b.size_xy3d);b.usesvg&&(q*=.3);this.options.Color&&(p=a.getContourLevels(),y=a.getHistPalette());for(a=
0;a<p.length-1;++a){var n=Math.max(p[a],b.scale_zmin),g=Math.min(p[a+1],b.scale_zmax);if(!(n>=g)){var l=Math.floor(k(n,g)/d),m=null,u=0,w=new Int32Array(l),r=0,f=null,h=null,t=0,v=0;if(this.options.Markers||this.options.Circles)m=new x.PointsCreator(l,b.webgl,q/3);this.options.Error&&(f=new Float32Array(18*l));this.options.Line&&(h=new Float32Array(6*(l-1)));for(l=0;l<c.fNpoints;++l)if(!(c.fX[l]<b.scale_xmin||c.fX[l]>b.scale_xmax||c.fY[l]<b.scale_ymin||c.fY[l]>b.scale_ymax||c.fZ[l]<n||c.fZ[l]>=g)){if(1<
d&&(u=(u+1)%d,0!==u))continue;w[r++]=l;var D=b.grx(c.fX[l]),B=b.gry(c.fY[l]),z=b.grz(c.fZ[l]);m&&m.addPoint(D,B,z);f&&(f[t]=b.grx(c.fX[l]-c.fEX[l]),f[t+1]=B,f[t+2]=z,f[t+3]=b.grx(c.fX[l]+c.fEX[l]),f[t+4]=B,f[t+5]=z,t+=6,f[t]=D,f[t+1]=b.gry(c.fY[l]-c.fEY[l]),f[t+2]=z,f[t+3]=D,f[t+4]=b.gry(c.fY[l]+c.fEY[l]),f[t+5]=z,t+=6,f[t]=D,f[t+1]=B,f[t+2]=b.grz(c.fZ[l]-c.fEZ[l]),f[t+3]=D,f[t+4]=B,f[t+5]=b.grz(c.fZ[l]+c.fEZ[l]),t+=6);h&&(6<=v&&(h[v]=h[v-3],h[v+1]=h[v-2],h[v+2]=h[v-1],v+=3),h[v]=D,h[v+1]=B,h[v+2]=
z,v+=3)}h&&3<v&&h.length==v&&(n=this.getColor(this.getObject().fLineColor),n=new e.LineBasicMaterial({color:new e.Color(n),linewidth:this.getObject().fLineWidth}),h=x.createLineSegments(h,n),b.toplevel.add(h),h.graph=c,h.index=w,h.painter=b,h.scale0=.7*q,h.tip_name=this.getObjectHint(),h.tip_color=3===c.fMarkerColor?16711680:65280,h.nvertex=2,h.check_next=!0,h.tooltip=this.graph2DTooltip);f&&(h=this.getColor(this.getObject().fLineColor),h=new e.LineBasicMaterial({color:new e.Color(h),linewidth:this.getObject().fLineWidth}),
f=x.createLineSegments(f,h),b.toplevel.add(f),f.graph=c,f.index=w,f.painter=b,f.scale0=.7*q,f.tip_name=this.getObjectHint(),f.tip_color=3===c.fMarkerColor?16711680:65280,f.nvertex=6,f.tooltip=this.graph2DTooltip);m&&(f="blue",this.options.Circles||(f=y?y.calcColor(a,p.length):this.getColor(c.fMarkerColor)),m=m.createPoints({color:f,style:this.options.Circles?4:c.fMarkerStyle}),m.graph=c,m.painter=b,m.tip_color=3===c.fMarkerColor?16711680:65280,m.scale0=.3*q,m.index=w,m.tip_name=this.getObjectHint(),
m.tooltip=this.graph2DTooltip,b.toplevel.add(m))}}b.render3D(100)}};x.drawGraph2D=function(a,b,c){var d=new JSROOT.TGraph2DPainter(a,b);d.decodeOptions(c);c=Promise.resolve(!0);d.getMainPainter()||(b.fHistogram||(b.fHistogram=d.createHistogram()),c=JSROOT.draw(a,b.fHistogram,"lego;axis"),d.ownhisto=!0);return c.then(function(){d.addToPadPrimitives();d.redraw();return d})};x.drawPolyMarker3D=function(){var a=this.getFramePainter();if(!a||!a.mode3d||!a.toplevel)return Promise.reject(Error("Fail to draw poly markers without 3D mode"));
for(var b=1,c=0,d=this.getObject(),k=0;k<d.fP.length;k+=3)d.fP[k]<a.scale_xmin||d.fP[k]>a.scale_xmax||d.fP[k+1]<a.scale_ymin||d.fP[k+1]>a.scale_ymax||d.fP[k+2]<a.scale_zmin||d.fP[k+2]>a.scale_zmax||++c;0<JSROOT.settings.OptimizeDraw&&5E4<c&&(b=Math.floor(c/5E4),2>=b&&(b=2));k=Math.floor(c/b);c=new x.PointsCreator(k,a.webgl,a.size_xy3d/100);k=new Int32Array(k);for(var y=0,q=0,p=0;p<d.fP.length;p+=3)if(!(d.fP[p]<a.scale_xmin||d.fP[p]>a.scale_xmax||d.fP[p+1]<a.scale_ymin||d.fP[p+1]>a.scale_ymax||d.fP[p+
2]<a.scale_zmin||d.fP[p+2]>a.scale_zmax)){if(1<b&&(y=(y+1)%b,0!==y))continue;k[q++]=p;c.addPoint(a.grx(d.fP[p]),a.gry(d.fP[p+1]),a.grz(d.fP[p+2]))}b=c.createPoints({color:this.getColor(d.fMarkerColor),style:d.fMarkerStyle});b.tip_color=3===d.fMarkerColor?16711680:65280;b.tip_name=d.fName||"Poly3D";b.poly=d;b.painter=a;b.scale0=.7*c.scale;b.index=k;a.toplevel.add(b);b.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, check three.js version",e.REVISION,
"expected r102"),null;a=Math.floor(a.index/this.nvertex);if(0>a||a>=this.index.length)return null;a=this.index[a];var b=this.painter,c=b.grx(this.poly.fP[a]),d=b.gry(this.poly.fP[a+1]),k=b.grz(this.poly.fP[a+2]);return{x1:c-this.scale0,x2:c+this.scale0,y1:d-this.scale0,y2:d+this.scale0,z1:k-this.scale0,z2:k+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+a/3,"x: "+b.axisAsText("x",this.poly.fP[a]),"y: "+b.axisAsText("y",this.poly.fP[a+1]),"z: "+b.axisAsText("z",this.poly.fP[a+2])]}};
a.render3D(100);return Promise.resolve(this)};JSROOT.TH3Painter=J;JSROOT.TGraph2DPainter=aa;return JSROOT});
