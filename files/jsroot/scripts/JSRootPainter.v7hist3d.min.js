var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,H,N){d!=Array.prototype&&d!=Object.prototype&&(d[H]=N.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,H,N,g){if(H){N=$jscomp.global;d=d.split(".");for(g=0;g<d.length-1;g++){var da=d[g];da in N||(N[da]={});N=N[da]}d=d[d.length-1];g=N[d];H=H(g);H!=g&&null!=H&&$jscomp.defineProperty(N,d,{configurable:!0,writable:!0,value:H})}};$jscomp.arrayIteratorImpl=function(d){var H=0;return function(){return H<d.length?{done:!1,value:d[H++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(d,H){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:H})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function d(N){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(N||"")+"_"+H++,N)}var H=0;return d}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.asyncIterator;d||(d=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};
$jscomp.iteratorFromArray=function(d,H){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var N=0,g={next:function(){if(N<d.length){var da=N++;return{value:H(da,d[da]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,N){return[d,N]})}},"es6","es3");
(function(d){if("function"===typeof define&&define.amd)define(["JSRootCore","d3","JSRootPainter.v7hist","threejs","threejs_all"],d);else if("object"===typeof exports&&"undefined"!==typeof module){var H=require("./JSRootCore.js");d(H,require("d3"),require("./JSRootPainter.v7hist.js"),require("three"),require("./three.extra.min.js"),H.nodejs||"undefined"==typeof document?H.nodejs_document:document)}else{if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.v7hist3d.js");if("object"!=
typeof d3)throw Error("This extension requires d3.js","JSRootPainter.v7hist3d.js");if("undefined"==typeof THREE)throw Error("THREE is not defined","JSRootPainter.v7hist3d.js");d(JSROOT,d3,JSROOT,THREE,THREE)}})(function(d,H,N,g,da,ka){function na(a,b){if(!a)return null;b||(b="line_");var k=a.v7EvalColor(b+"color","black"),e=a.v7EvalAttr(b+"style",0);a=a.v7EvalAttr(b+"width",1);k=(e=(e=e?d.Painter.root_line_styles[parseInt(e)]:"")?e.split(","):[])&&2<=e.length?new g.LineDashedMaterial({color:k,dashSize:parseInt(e[0]),
gapSize:parseInt(e[1])}):new g.LineBasicMaterial({color:k});a&&1<a&&!d.browser.isIE&&(k.linewidth=parseInt(a));return k}d.sources.push("v7hist3d");"undefined"==typeof ka&&"object"==typeof window&&(ka=window.document);if("undefined"===typeof d.v7.RHistPainter)throw Error("JSROOT.v7.RHistPainter is not defined","JSRootPainter.v7hist3d.js");d.v7.RFramePainter.prototype.SetCameraPosition=function(a){var b=Math.max(.75*this.size_xy3d,this.size_z3d);a&&(this.camera.position.set(-1.6*b,-3.5*b,1.4*this.size_z3d),
this.camera.lookAt(this.lookat))};d.v7.RFramePainter.prototype.Create3DScene=function(a){if(void 0!==a&&0>a)this.mode3d&&(this.TestAxisVisibility(null,this.toplevel),this.clear_3d_canvas(),d.Painter.DisposeThreejsObject(this.scene),this.control&&this.control.Cleanup(),this.renderer&&(this.renderer.dispose&&this.renderer.dispose(),this.renderer.context&&delete this.renderer.context),delete this.size_xy3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,delete this.toplevel,delete this.camera,
delete this.pointLight,delete this.renderer,delete this.control,"render_tmout"in this&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.mode3d=!1);else if(this.mode3d=!0,"toplevel"in this)this.scene.remove(this.toplevel),d.Painter.DisposeThreejsObject(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip(),a=new g.Object3D,this.scene.add(a),this.toplevel=a,this.Resize3D(),this.SetCameraPosition(!1);else{this.usesvg=d.Painter.UseSVGFor3D();
a=this.size_for_3d(this.usesvg?3:void 0);this.size_z3d=100;this.size_xy3d=10<a.height&&10<a.width?Math.round(a.width/a.height*this.size_z3d):this.size_z3d;this.scene=new g.Scene;this.toplevel=new g.Object3D;this.scene.add(this.toplevel);this.scene_width=a.width;this.scene_height=a.height;this.camera=new g.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size_z3d);this.camera_Theta=this.camera_Phi=30;this.pointLight=new g.PointLight(16777215,1);this.camera.add(this.pointLight);this.pointLight.position.set(this.size_xy3d/
2,this.size_xy3d/2,this.size_z3d/2);this.lookat=new g.Vector3(0,0,.8*this.size_z3d);this.camera.up=new g.Vector3(0,0,1);this.scene.add(this.camera);this.SetCameraPosition(!0);var b=d.Painter.Create3DRenderer(this.scene_width,this.scene_height,this.usesvg,4==a.can3d);this.renderer=b.renderer;this.webgl=b.usewebgl;this.add_3d_canvas(a,b.dom);this.first_render_tm=0;this.enable_highlight=!1;if(!d.BatchMode){this.control=d.Painter.CreateOrbitControl(this,this.camera,this.scene,this.renderer,this.lookat);
var k=this,e=this.main_painter();this.control.ProcessMouseMove=function(a){for(var b=null,d=null,l=null,e=0;e<a.length;++e)if(a[e].object.tooltip){if(b=a[e].object.tooltip(a[e])){d=a[e].object;break}}else a[e].object.zoom&&!l&&(l=a[e].object);b&&!b.use_itself&&(a=1E-4*k.size_xy3d,e=1E-4*k.size_z3d,(b.x1>b.x2||b.y1>b.y2||b.z1>b.z2)&&console.warn("check 3D hints coordinates"),b.x1-=a,b.x2+=a,b.y1-=a,b.y2+=a,b.z1-=e,b.z2+=e);k.BinHighlight3D(b,d);return!b&&l&&k.Get3DZoomCoord?(d=l.GlobalIntersect(this.raycaster),
b=l.zoom,d=k.Get3DZoomCoord(d,b),"z"===b&&l.use_y_for_z&&(b="y"),l={name:b,title:"RAxis",line:"any info",only_status:!0},l.line=b+" : "+k.AxisAsText(b,d),l):b&&b.lines?b:""};this.control.ProcessMouseLeave=function(){k.BinHighlight3D(null)};this.control.ContextMenu=function(a,b){var d="hist",l=e;if(b)for(var g=0;g<b.length;++g){var k=b[g].object;if(k.zoom){d=k.zoom;l=e.frame_painter();break}if(k.painter&&"function"===typeof k.painter.ShowContextMenu){l=k.painter;break}}"function"==typeof l.ShowContextMenu&&
l.ShowContextMenu(d,a)}}}};d.v7.RFramePainter.prototype.SetActive=function(a){this.control&&(this.control.enableKeys=a&&d.key_handling)};d.v7.RFramePainter.prototype.Render3D=function(a){if(-1111===a){a=g.CreateSVGRenderer(!1,0,ka);a.setSize(this.scene_width,this.scene_height);a.render(this.scene,this.camera);if(a.makeOuterHTML){var b=ka.createElement("div");b.innerHTML=a.makeOuterHTML();return b.childNodes[0]}return a.domElement}void 0===a&&(a=5);if(0>=a||this.usesvg||d.BatchMode){if("render_tmout"in
this)clearTimeout(this.render_tmout);else if(-2222===a)return;void 0!==this.renderer&&(a=new Date,this.opt3d||(this.opt3d={FrontBox:!0,BackBox:!0}),this.TestAxisVisibility(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),this.renderer.render(this.scene,this.camera),0===this.first_render_tm&&this.renderer instanceof g.SoftwareRenderer&&this.renderer.render(this.scene,this.camera),d.Painter.AfterRender3D(this.renderer),b=new Date,delete this.render_tmout,0===this.first_render_tm&&(this.first_render_tm=
b.getTime()-a.getTime(),this.enable_highlight=1200>this.first_render_tm&&this.IsTooltipAllowed(),console.log("First render tm = "+this.first_render_tm)))}else"render_tmout"in this||(this.render_tmout=setTimeout(this.Render3D.bind(this,0),a))};d.v7.RFramePainter.prototype.Resize3D=function(){var a=this.size_for_3d(this.access_3d_kind());this.apply_3d_size(a);if(this.scene_width===a.width&&this.scene_height===a.height||10>a.width||10>a.height)return!1;this.scene_width=a.width;this.scene_height=a.height;
this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);return!0};d.v7.RFramePainter.prototype.BinHighlight3D=function(a,b){var k=!1,e=null,C=!0,u=!a||void 0===a.x1||!this.enable_highlight,p=this.main_painter();p&&!p.IsUserTooltipCallback()&&(p=null);this.tooltip_selfmesh&&(C=this.tooltip_selfmesh!==b,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,k=!0);
this.tooltip_mesh&&(e=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,k=!0);if(u)k&&this.Render3D(),k&&p&&p.ProvideUserTooltip(null);else{if(a.use_itself)b.save_color=b.material.color,b.material.color=new g.Color(a.color),this.tooltip_selfmesh=b,k=C;else{k=!0;b=d.Painter.Box3D.Indexes;C=d.Painter.Box3D.Normals;u=d.Painter.Box3D.Vertices;var l=new g.Color(a.color?a.color:16711680),w=a.opacity||1;if(e){var v=e.geometry.attributes.position.array;e.geometry.attributes.position.needsUpdate=
!0;e.material.color=l;e.material.opacity=w}else{v=new Float32Array(3*b.length);var h=new Float32Array(3*b.length);e=new g.BufferGeometry;e.addAttribute("position",new g.BufferAttribute(v,3));e.addAttribute("normal",new g.BufferAttribute(h,3));l=new g.MeshBasicMaterial({color:l,opacity:w,flatShading:!0});e=new g.Mesh(e,l)}a.x1===a.x2&&console.warn("same tip X",a.x1,a.x2);a.y1===a.y2&&console.warn("same tip Y",a.y1,a.y2);a.z1===a.z2&&(a.z2=a.z1+1E-4);l=0;for(w=-3;l<b.length;++l){var r=u[b[l]];v[3*l]=
a.x1+r.x*(a.x2-a.x1);v[3*l+1]=a.y1+r.y*(a.y2-a.y1);v[3*l+2]=a.z1+r.z*(a.z2-a.z1);h&&(0===l%6&&(w+=3),h[3*l]=C[w],h[3*l+1]=C[w+1],h[3*l+2]=C[w+2])}this.tooltip_mesh=e;this.toplevel.add(e)}k&&this.Render3D();k&&a.$painter&&"function"==typeof a.$painter.RedrawProjection&&a.$painter.RedrawProjection(a.ix-1,a.ix,a.iy-1,a.iy);k&&p&&p.GetObject()&&p.ProvideUserTooltip({obj:p.GetObject(),name:p.GetObject().fName,bin:a.bin,cont:a.value,binx:a.ix,biny:a.iy,binz:a.iz,grx:(a.x1+a.x2)/2,gry:(a.y1+a.y2)/2,grz:(a.z1+
a.z2)/2})}};d.v7.RFramePainter.prototype.TestAxisVisibility=function(a,b,d,e){function g(a,b){a<=l&&(a+=4);return a>l&&a<l+b}if(b&&b.children)for(var k=0;k<b.children.length;++k){var p=b.children[k];if(p.axis_draw)break;p=void 0}if(p)if(a){d=d?!0:!1;e=e?!0:!1;var l=1;k=a.position;0>k.x&&0<=k.y&&(l=2);0<=k.x&&0<=k.y&&(l=3);0<=k.x&&0>k.y&&(l=4);for(k=0;k<p.children.length;++k)if(a=p.children[k],a.grid)a.visible=e&&g(a.grid,3);else if(a.zid)a.visible=g(a.zid,2);else if(a.xyid)a.visible=g(a.xyid,3);else if(a.xyboxid){b=
5;var w=0;e&&!d?(b=3,w=-2):d&&!e?b=3:d||e||(b=a.bottom?3:0);a.visible=g(a.xyboxid+w,b);!a.visible&&a.bottom&&e&&(a.visible=g(a.xyboxid,3))}else a.zboxid&&(b=2,w=0,d&&e?b=5:e&&!d?b=4:!e&&d&&(w=-2,b=4),a.visible=g(a.zboxid+w,b))}else b.remove(p)};d.v7.RFramePainter.prototype.Set3DOptions=function(a){this.opt3d=a};d.v7.RFramePainter.prototype.DrawXYZ=function(a,b){function k(a,b,c){var e=new g.Geometry;"z"===a?e.vertices.push(new g.Vector3(0,0,0),new g.Vector3(4*z,0,0),new g.Vector3(4*z,0,2*b),new g.Vector3(0,
0,2*b)):e.vertices.push(new g.Vector3(-b,0,0),new g.Vector3(b,0,0),new g.Vector3(b,4*-z,0),new g.Vector3(-b,4*-z,0));e.faces.push(new g.Face3(0,2,1));e.faces.push(new g.Face3(0,3,2));e.computeFaceNormals();var f=new g.MeshBasicMaterial({transparent:!0,vertexColors:g.NoColors,side:g.DoubleSide,opacity:0});e=new g.Mesh(e,f);e.zoom=a;e.size_3d=b;e.use_y_for_z=c;"y"==a&&e.rotateZ(Math.PI/2).rotateX(Math.PI);e.GlobalIntersect=function(a){var b=new g.Plane,c=this.geometry;if(c&&c.vertices&&(b.setFromCoplanarPoints(c.vertices[0],
c.vertices[1],c.vertices[2]),b.applyMatrix4(this.matrixWorld),c=a.ray.origin.clone(),a=c.clone().addScaledVector(a.ray.direction,1E10),b=b.intersectLine(new g.Line3(c,a),new g.Vector3)))return a=-this.size_3d,c=this.size_3d,"z"===this.zoom&&(a=0,c=2*this.size_3d),b[this.zoom]<a?b[this.zoom]=a:b[this.zoom]>c&&(b[this.zoom]=c),b};e.ShowSelection=function(a,b){var c=this.children?this.children[0]:null,e=this.zoom;if(!a||!b)return c&&(this.remove(c),d.Painter.DisposeThreejsObject(c)),c;if(c)var f=c.geometry;
else f=this.geometry.clone(),"z"===e?f.vertices[1].x=f.vertices[2].x=z:f.vertices[2].y=f.vertices[3].y=-z,c=new g.Mesh(f,new g.MeshBasicMaterial({color:65280,side:g.DoubleSide})),this.add(c);"z"==e?(f.vertices[0].z=f.vertices[1].z=a[e],f.vertices[2].z=f.vertices[3].z=b[e]):(f.vertices[0].x=f.vertices[3].x=a[e],f.vertices[1].x=f.vertices[2].x=b[e]);f.computeFaceNormals();f.verticesNeedUpdate=!0;return f.normalsNeedUpdate=!0};return e}b||(b={});var e=-this.size_xy3d,C=this.size_xy3d,u=-this.size_xy3d,
p=this.size_xy3d,l=0,w=2*this.size_z3d,v=Math.round(.05*this.size_z3d),h=this.frame_painter(),r=this.xmin,y=this.xmax,c=this.ymin,m=this.ymax,n=this.zmin,t=this.zmax,f=!1,q=!1;this.size_z3d||(e=this.xmin,C=this.xmax,u=this.ymin,p=this.ymax,l=this.zmin,w=this.zmax,v=.05*(w-l));"zoom_xmin"in this&&"zoom_xmax"in this&&this.zoom_xmin!==this.zoom_xmax&&(r=this.zoom_xmin,y=this.zoom_xmax);"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(c=this.zoom_ymin,m=this.zoom_ymax,f=!0);"zoom_zmin"in
this&&"zoom_zmax"in this&&this.zoom_zmin!==this.zoom_zmax&&(n=this.zoom_zmin,t=this.zoom_zmax,q=!0);b.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,n=c,t=m,q=f,c=0,m=1);this.lego_zmin=n;this.lego_zmax=t;void 0===b.zmult||q||(t*=b.zmult);if(h.logx){0>=y&&(y=1);if(0>=r&&this.xaxis)for(f=0;f<this.xaxis.GetNumBins()&&!(r=Math.max(r,this.xaxis.GetBinLowEdge(f+1)),0<r);++f);0>=r&&(r=1E-4*y);this.grx=H.scaleLog();this.x_kind="log"}else this.grx=H.scaleLinear(),this.x_kind=this.xaxis&&this.xaxis.fLabels?
"labels":"normal";this.logx="log"===this.x_kind;this.grx.domain([r,y]).range([e,C]);this.x_handle=new d.v7.RAxisPainter(!0,"x_");this.x_handle.SetAxisConfig("xaxis",this.x_kind,this.grx,this.xmin,this.xmax,r,y);this.x_handle.CreateFormatFuncs();this.scale_xmin=r;this.scale_xmax=y;if(h.logy&&!b.use_y_for_z){0>=m&&(m=1);if(0>=c&&this.yaxis)for(f=0;f<this.yaxis.GetNumBins()&&!(c=Math.max(c,this.yaxis.GetBinLowEdge(f+1)),0<c);++f);0>=c&&(c=1E-4*m);this.gry=H.scaleLog();this.y_kind="log"}else this.gry=
H.scaleLinear(),this.y_kind=this.yaxis&&this.yaxis.fLabels?"labels":"normal";this.logy="log"===this.y_kind;this.gry.domain([c,m]).range([u,p]);this.y_handle=new d.v7.RAxisPainter(!0,"y_");this.y_handle.SetAxisConfig("yaxis",this.y_kind,this.gry,this.ymin,this.ymax,c,m);this.y_handle.CreateFormatFuncs();this.scale_ymin=c;this.scale_ymax=m;h.logz?(0>=t&&(t=1),0>=n&&(n=1E-4*t),this.grz=H.scaleLog(),this.z_kind="log"):(this.grz=H.scaleLinear(),this.z_kind="normal",this.zaxis&&this.zaxis.fLabels&&3===
b.ndim&&(this.z_kind="labels"));this.logz="log"===this.z_kind;this.grz.domain([n,t]).range([l,w]);this.z_handle=new d.v7.RAxisPainter(!0,"z_");this.z_handle.SetAxisConfig("zaxis",this.z_kind,this.grz,this.zmin,this.zmax,n,t);this.z_handle.CreateFormatFuncs();this.scale_zmin=n;this.scale_zmax=t;this.x_handle.debug=!0;var D=new g.MeshBasicMaterial({color:0});h=new g.LineBasicMaterial({color:0});var z=.5*v;y=[];var x=1;q=this.x_handle.CreateTicks(!1,!0);f=this.y_handle.CreateTicks(!1,!0);c=this.z_handle.CreateTicks(!1,
!0);r=new g.Object3D;r.axis_draw=!0;a.add(r);a=[];for(var F=0,J=this.xaxis;q.next();){var U=q.grpos;n=1===q.kind;m=this.x_handle.format(q.tick,!0,!0);q.last_major()?J&&J.fTitle||(m="x"):null===m&&(n=!1,m="");if(n&&m&&0<m.length){m=new g.TextGeometry(m,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5});m.computeBoundingBox();t=m.boundingBox.max.x-m.boundingBox.min.x;var L=m.boundingBox.max.y-m.boundingBox.min.y;m.center=!0;F=Math.max(F,L);m.grx=U;y.push(m);q.last_major()||(L=
q.next_major_grpos()-U,0<t&&(x=Math.min(x,.9*L/t)),this.x_handle.IsCenterLabels()&&(m.grx+=L/2))}a.push(U,0,0,U,n?-z:.6*-z,0)}J&&J.fTitle&&(m=new g.TextGeometry(J.fTitle,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5}),m.computeBoundingBox(),m.center=J.TestBit(d.EAxisBits.kCenterTitle),m.gry=2,m.grx=(e+C)/2,y.push(m));this.Get3DZoomCoord=function(a,b){a=a[b];var c=this["scale_"+b+"min"],e=this["scale_"+b+"max"];a="z"===b?a/2/this.size_z3d:(a+this.size_xy3d)/2/this.size_xy3d;
return a=this["log"+b]?Math.exp(Math.log(c)+a*(Math.log(e)-Math.log(c))):c+a*(e-c)};var G=new g.Object3D;G.position.set(0,u,l);G.rotation.x=.25*Math.PI;G.xyid=2;a=d.Painter.createLineSegments(a,h);G.add(a);y.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.grx-b/2:C-b;b=new g.Matrix4;b.set(x,0,0,c,0,x,0,(-F*x-1.5*z)*(a.gry||1),0,0,1,0,0,0,0,1);a=new g.Mesh(a,D);a.applyMatrix(b);G.add(a)});b.zoom&&G.add(k("x",this.size_xy3d));r.add(G);G=new g.Object3D;G.position.set(0,
p,l);G.rotation.x=.75*Math.PI;G.add(new g.LineSegments(a.geometry,h));y.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.grx+b/2:C;b=new g.Matrix4;b.set(-x,0,0,c,0,x,0,(-F*x-1.5*z)*(a.gry||1),0,0,-1,0,0,0,0,1);a=new g.Mesh(a,D);a.applyMatrix(b);G.add(a)});G.xyid=4;b.zoom&&G.add(k("x",this.size_xy3d));r.add(G);y=[];x=1;F=0;a=[];for(q=this.yaxis;f.next();)J=f.grpos,n=1===f.kind,m=this.y_handle.format(f.tick,!0,!0),f.last_major()?q&&q.fTitle||(m="y"):null===m&&(n=!1,m=""),
n&&(m=new g.TextGeometry(m,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5}),m.computeBoundingBox(),t=m.boundingBox.max.x-m.boundingBox.min.x,L=m.boundingBox.max.y-m.boundingBox.min.y,m.center=!0,F=Math.max(F,L),m.gry=J,y.push(m),f.last_major()||(L=f.next_major_grpos()-J,0<t&&(x=Math.min(x,.9*L/t)),this.y_handle.IsCenterLabels()&&(m.gry+=L/2))),a.push(0,J,0,n?-z:.6*-z,J,0);q&&q.fTitle&&(m=new g.TextGeometry(q.fTitle,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5}),
m.computeBoundingBox(),m.center=q.TestBit(d.EAxisBits.kCenterTitle),m.grx=2,m.gry=(u+p)/2,y.push(m));if(!b.use_y_for_z){a=d.Painter.createLineSegments(a,h);var K=new g.Object3D;K.position.set(e,0,l);K.rotation.y=-.25*Math.PI;K.add(a);y.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry+b/2:p;b=new g.Matrix4;b.set(0,x,0,(-F*x-1.5*z)*(a.grx||1),-x,0,0,c,0,0,1,0,0,0,0,1);a=new g.Mesh(a,D);a.applyMatrix(b);K.add(a)});K.xyid=3;b.zoom&&K.add(k("y",this.size_xy3d));r.add(K);
K=new g.Object3D;K.position.set(C,0,l);K.rotation.y=-.75*Math.PI;K.add(new g.LineSegments(a.geometry,h));y.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry-b/2:p-b;b=new g.Matrix4;b.set(0,x,0,(-F*x-1.5*z)*(a.grx||1),x,0,0,c,0,0,-1,0,0,0,0,1);a=new g.Mesh(a,D);a.applyMatrix(b);K.add(a)});K.xyid=1;b.zoom&&K.add(k("y",this.size_xy3d));r.add(K)}y=[];x=1;a=[];var O=J=U=null;f=this.zaxis;q=0;this.size_z3d&&(U=[],J=[]);for(;c.next();){var M=c.grpos;n=1==c.kind;m=this.z_handle.format(c.tick,
!0,!0);null===m&&(n=!1,m="");n&&m&&(m=new g.TextGeometry(m,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5}),m.computeBoundingBox(),t=m.boundingBox.max.x-m.boundingBox.min.x,L=m.boundingBox.max.y-m.boundingBox.min.y,m.translate(-t,-L/2,0),m.grz=M,y.push(m),null!==O&&0<L&&(x=Math.min(x,.9*(M-O)/L)),q=Math.max(q,t),O=M);U&&n&&U.push(e,0,M,C,0,M);J&&n&&J.push(0,u,M,0,p,M);a.push(0,0,M,n?z:.6*z,0,M)}U&&0<U.length&&(c=new g.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),m=d.Painter.createLineSegments(U,
c),m.position.set(0,p,0),m.grid=2,m.visible=!1,r.add(m),c=new g.LineSegments(m.geometry,c),c.position.set(0,u,0),c.grid=4,c.visible=!1,r.add(c));J&&0<J.length&&(c=new g.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),m=d.Painter.createLineSegments(J,c),m.position.set(C,0,0),m.grid=3,m.visible=!1,r.add(m),c=new g.LineSegments(m.geometry,c),c.position.set(e,0,0),c.grid=1,c.visible=!1,r.add(c));var P=[];c=d.Painter.createLineSegments(a,h);for(var A=0;4>A;++A)P.push(new g.Object3D),y.forEach(function(a){var b=
new g.Matrix4;b.set(-x,0,0,2*z,0,0,1,0,0,x,0,a.grz);a=new g.Mesh(a,D);a.applyMatrix(b);P[A].add(a)}),f&&f.fTitle&&(m=new g.TextGeometry(f.fTitle,{font:d.threejs_font_helvetiker_regular,size:v,height:0,curveSegments:5}),m.computeBoundingBox(),t=m.boundingBox.max.x-m.boundingBox.min.x,L=m.boundingBox.max.y-m.boundingBox.min.y,n=f.TestBit(d.EAxisBits.kCenterTitle)?(w+l-t)/2:w-t,m.rotateZ(Math.PI/2),a=new g.Matrix4,a.set(-x,0,0,3*z+q,0,0,1,0,0,x,0,n),m=new g.Mesh(m,D),m.applyMatrix(a),P[A].add(m)),P[A].add(0==
A?c:new g.LineSegments(c.geometry,h)),b.zoom&&P[A].add(k("z",this.size_z3d,b.use_y_for_z)),P[A].zid=A+2,r.add(P[A]);P[0].position.set(e,p,0);P[0].rotation.z=.75*Math.PI;P[1].position.set(C,p,0);P[1].rotation.z=.25*Math.PI;P[2].position.set(C,u,0);P[2].rotation.z=-.25*Math.PI;P[3].position.set(e,u,0);P[3].rotation.z=-.75*Math.PI;if(0!==this.size_z3d){v=d.Painter.createLineSegments([e,0,0,C,0,0],h,null,!0);for(A=0;2>A;++A)b=new g.LineSegments(v,h),b.position.set(0,u,0===A?l:w),b.xyboxid=2,b.bottom=
0==A,r.add(b),b=new g.LineSegments(v,h),b.position.set(0,p,0===A?l:w),b.xyboxid=4,b.bottom=0==A,r.add(b);u=d.Painter.createLineSegments([0,u,0,0,p,0],h,null,!0);for(A=0;2>A;++A)b=new g.LineSegments(u,h),b.position.set(e,0,0===A?l:w),b.xyboxid=3,b.bottom=0==A,r.add(b),b=new g.LineSegments(u,h),b.position.set(C,0,0===A?l:w),b.xyboxid=1,b.bottom=0==A,r.add(b);e=d.Painter.createLineSegments([0,0,l,0,0,w],h,null,!0);for(A=0;4>A;++A)b=new g.LineSegments(e,h),b.zboxid=P[A].zid,b.position.copy(P[A].position),
r.add(b)}};d.v7.RHistPainter.prototype.DrawLego=function(){function a(a,b,c){z=J.getBinContent(a+1,b+1);D=U?U.getBinContent(a+1,b+1):!1!==F.options.BaseLine?F.options.BaseLine:F.options.Zero?w:0;z<D&&(a=D,D=z,z=a);if(D>=A||z<P)return!1;x=z===P||D>=z;return!x||0<c?!0:J.$baseh?!1:F.options.Zero||0<w?!0:F._show_empty_bins}if(this.draw_content){var b=d.Painter.Box3D.Vertices,k=d.Painter.Box3D.Indexes,e=d.Painter.Box3D.Normals,C=d.Painter.Box3D.Segments,u=[0,1,1,2,2,3,3,0],p=[new g.Vector3(0,0,0),new g.Vector3(0,
1,0),new g.Vector3(1,1,0),new g.Vector3(1,0,0)],l=this.frame_painter(),w=l.grz.domain()[0],v=l.grz.domain()[1],h=this.PrepareDraw({rounding:!1,use3d:!0,extra:1}),r=h.i1,y=h.i2,c=h.j1,m=h.j2,n=h.stepi,t=h.stepj,f,q,D,z,x,F=this,J=this.GetHisto(),U=J?J.$baseh:null,L=11===this.options.Lego||13===this.options.Lego;if(!(r>=y||c>=m)){var G=65535>J.getBin(y,m),K=[w,v],O=null;if(12===this.options.Lego||14===this.options.Lego)O=l.GetPalette(),this.CreateContour(l,O,{full_z_range:!0}),K=O.GetContour(),w=K[0],
v=K[K.length-1];for(var M=0;M<K.length-1;++M){var P=K[M];var A=K[M+1];O&&M==K.length-2&&A<v&&(A=v);var Y=0,Q=0,B=0,I=0,R=l.grz(P),E=l.grz(A);for(f=r;f<y;f+=n)for(q=c;q<m;q+=t)if(a(f,q,M)){var V=!x&&0<M;var N=!x&&z>A&&M<K.length-2;B+=x?12:k.length;V&&(B-=6);N&&(B-=6);L&&!x&&(B-=12,I+=12)}var ca=new Float32Array(3*B),ea=new Float32Array(3*B),Z=G?new Uint16Array(B/3):new Uint32Array(B/3),ba=null,fa=null;B=null;var T=0,W=0,S;0<I&&(ba=new Float32Array(3*I),fa=new Float32Array(3*I),B=G?new Uint16Array(I/
3):new Uint32Array(I/3));for(f=r;f<y;f+=n){var aa=h.grx[f]+h.xbar1*(h.grx[f+n]-h.grx[f]);var ia=h.grx[f]+h.xbar2*(h.grx[f+n]-h.grx[f]);for(q=c;q<m;q+=t)if(a(f,q,M)){V=!x&&0<M;N=!x&&z>A&&M<K.length-2;var ha=h.gry[q]+h.ybar1*(h.gry[q+t]-h.gry[q]);var ja=h.gry[q]+h.ybar2*(h.gry[q+t]-h.gry[q]);Y=D<=P?R:l.grz(D);Q=z>A?E:l.grz(z);var X=S=0;x&&(S+=12,X+=24);var la=k.length,ma=J.getBin(f+1,q+1);for(V&&(la-=6);X<la;)V=b[k[X]],L&&12>X?(ba[W]=aa+V.x*(ia-aa),ba[W+1]=ha+V.y*(ja-ha),ba[W+2]=Y+V.z*(Q-Y),fa[W]=e[S],
fa[W+1]=e[S+1],fa[W+2]=e[S+2],0===W%9&&(B[W/9]=ma),W+=3):(ca[T]=aa+V.x*(ia-aa),ca[T+1]=ha+V.y*(ja-ha),ca[T+2]=Y+V.z*(Q-Y),ea[T]=e[S],ea[T+1]=e[S+1],ea[T+2]=e[S+2],0===T%9&&(Z[T/9]=ma),T+=3),++X,0===X%6&&(S+=3,N&&X===k.length-12&&(X+=6,S+=3))}}q=new g.BufferGeometry;q.addAttribute("position",new g.BufferAttribute(ca,3));q.addAttribute("normal",new g.BufferAttribute(ea,3));R=3;E=this.get_color(R);if(O)E=O.getColor(M);else if(1===this.options.Lego||2>R)R=1,E="white";f=new g.MeshBasicMaterial({color:E,
flatShading:!0});f=new g.Mesh(q,f);f.face_to_bins_index=Z;f.painter=this;f.zmin=w;f.zmax=v;f.baseline=!1!==this.options.BaseLine?this.options.BaseLine:this.options.Zero?w:0;f.tip_color=3===R?16711680:65280;f.handle=h;f.tooltip=function(a){if(isNaN(a.faceIndex))return console.error("faceIndex not provided, check three.js version",g.REVISION,"expected r102"),null;if(0>a.faceIndex||a.faceIndex>=this.face_to_bins_index.length)return null;var b=this.painter,c=this.handle,e=b.frame_painter(),f=b.GetHisto();
a=b.Get3DToolTip(this.face_to_bins_index[a.faceIndex]);var d=a.ix-1,l=d+c.stepi,k=a.iy-1,h=k+c.stepj;a.x1=Math.max(-e.size_xy3d,c.grx[d]+c.xbar1*(c.grx[l]-c.grx[d]));a.x2=Math.min(e.size_xy3d,c.grx[d]+c.xbar2*(c.grx[l]-c.grx[d]));a.y1=Math.max(-e.size_xy3d,c.gry[k]+c.ybar1*(c.gry[h]-c.gry[k]));a.y2=Math.min(e.size_xy3d,c.gry[k]+c.ybar2*(c.gry[h]-c.gry[k]));c=this.baseline;l=a.value;f.$baseh&&(c=f.$baseh.getBinContent(d+1,k+1));l<c&&(f=c,c=l,l=f);a.z1=e.grz(Math.max(this.zmin,c));a.z2=e.grz(Math.min(this.zmax,
l));a.color=this.tip_color;b.is_projection&&2==b.Dimension()&&(a.$painter=b);return a};l.toplevel.add(f);0<I&&(q=new g.BufferGeometry,q.addAttribute("position",new g.BufferAttribute(ba,3)),q.addAttribute("normal",new g.BufferAttribute(fa,3)),R=2>R?new g.Color(16711680):new g.Color(H.rgb(E).darker(.5).toString()),R=new g.MeshBasicMaterial({color:R,flatShading:!0}),q=new g.Mesh(q,R),q.face_to_bins_index=B,q.painter=this,q.handle=f.handle,q.tooltip=f.tooltip,q.zmin=f.zmin,q.zmax=f.zmax,q.baseline=f.baseline,
q.tip_color=f.tip_color,l.toplevel.add(q))}if(!(12<this.options.Lego)){L=e=0;k=!0;G=0;A=v;P=w;for(f=r;f<y;f+=n)for(q=c;q<m;q+=t)a(f,q,0)?(e+=x?p.length:b.length,L+=x?u.length:C.length):G++;65520<e&&(k=!1);k||(e=3*L);e=new Float32Array(3*e);L=k?new Uint16Array(L):null;R=l.grz(w);E=l.grz(v);K=G=Q=Y=0;for(f=r;f<y;f+=n)for(aa=h.grx[f]+h.xbar1*(h.grx[f+n]-h.grx[f]),ia=h.grx[f]+h.xbar2*(h.grx[f+n]-h.grx[f]),q=c;q<m;q+=t)if(a(f,q,0))if(ha=h.gry[q]+h.ybar1*(h.gry[q+t]-h.gry[q]),ja=h.gry[q]+h.ybar2*(h.gry[q+
t]-h.gry[q]),Y=D<=w?R:l.grz(D),Q=z>v?E:l.grz(z),r=x?u:C,O=x?p:b,k){for(X=0;X<r.length;++X)L[K++]=G/3+r[X];for(X=0;X<O.length;++X)V=O[X],e[G]=aa+V.x*(ia-aa),e[G+1]=ha+V.y*(ja-ha),e[G+2]=Y+V.z*(Q-Y),G+=3}else for(X=0;X<r.length;++X)V=O[r[X]],e[G]=aa+V.x*(ia-aa),e[G+1]=ha+V.y*(ja-ha),e[G+2]=Y+V.z*(Q-Y),G+=3;b=this.v7EvalColor("line_color","lightblue");f=new g.LineBasicMaterial({color:new g.Color(b)});d.browser.isIE||(f.linewidth=this.v7EvalAttr("line_width",1));b=d.Painter.createLineSegments(e,f,k?L:
null);l.toplevel.add(b)}}}};d.Painter.drawAxis3D=function(a,b,k){k=new d.TObjectPainter(b);"_main"in b||k.SetDivId(a);k.Draw3DAxis=function(){var a=this.frame_painter();if(!a||!a._toplevel)return console.warn("no geo object found for 3D axis drawing");var b=(new g.Box3).setFromObject(a._toplevel);this.xmin=b.min.x;this.xmax=b.max.x;this.ymin=b.min.y;this.ymax=b.max.y;this.zmin=b.min.z;this.zmax=b.max.z;this.size_xy3d=this.size_z3d=0;this.DrawXYZ=d.v7.RFramePainter.prototype.DrawXYZ;this.DrawXYZ(a._toplevel);
a.adjustCameraPosition();a.Render3D()};k.Draw3DAxis();return k.DrawingReady()};d.v7.RH1Painter.prototype.Draw3D=function(a,b){this.mode3d=!0;var k=this.frame_painter(),e=this.is_main_painter();this.GetHisto();if("resize"==b)return e&&k.Resize3D()&&k.Render3D(),d.CallBack(a);this.DeleteAtt();this.ScanContent(!0);e&&(k.Create3DScene(),k.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax,0,0),k.Set3DOptions(this.options),k.DrawXYZ(k.toplevel,{use_y_for_z:!0,zmult:1.1,zoom:d.gStyle.Zooming,ndim:1}));
if(!k.mode3d)return d.CallBack(a);this.DrawingBins(a,b,function(){var a=this.frame_painter();this.DrawLego();this.UpdatePaletteDraw();a.Render3D();this.UpdateStatWebCanvas();a.AddKeysHandler()})};d.v7.RH2Painter.prototype.Draw3D=function(a,b){this.mode3d=!0;var k=this.frame_painter(),e=this.is_main_painter();this.GetHisto();if("resize"==b)return e&&k.Resize3D()&&k.Render3D(),d.CallBack(a);var g=1.1;this.zmin=k.logz?.3*this.gminposbin:this.gminbin;this.zmax=this.gmaxbin;-1111!==this.options.minimum&&
(this.zmin=this.options.minimum);-1111!==this.options.maximum&&(this.zmax=this.options.maximum,g=1);k.logz&&0>=this.zmin&&(this.zmin=1E-5*this.zmax);this.DeleteAtt();e&&(k.Create3DScene(),k.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax,this.zmin,this.zmax),k.Set3DOptions(this.options),k.DrawXYZ(k.toplevel,{zmult:g,zoom:d.gStyle.Zooming,ndim:2}));if(!k.mode3d)return d.CallBack(a);this.DrawingBins(a,b,function(){var a=this.frame_painter();this.Draw3DBins();a.Render3D();this.UpdateStatWebCanvas();
a.AddKeysHandler()})};d.v7.RH2Painter.prototype.Draw3DBins=function(){if(this.draw_content){if(this.IsTH2Poly())return this.DrawPolyLego();if(this.options.Surf)return this.DrawSurf();if(this.options.Error)return this.DrawError();if(this.options.Contour)return this.DrawContour3D(!0);this.DrawLego();this.UpdatePaletteDraw()}};d.v7.RH2Painter.prototype.DrawContour3D=function(a){var b=this.frame_painter(),k=this.PrepareDraw({rounding:!1,use3d:!0,extra:100,middle:0});this.GetHisto();var e=b.GetPalette(),
g=2*b.size_z3d,u=[];this.CreateContour(b,e,{full_z_range:!0});var p=e.GetContour();this.BuildContour(k,p,e,function(e,d,k,h,r,y){if(!(3>r-h)){if(a&&(g=b.grz(p[y]),0>g||g>2*b.size_z3d))return;for(e=h;e<r;++e)u.push(d[e],k[e],g),u.push(d[e+1],k[e+1],g)}});k=d.Painter.createLineSegments(u,na(this));b.toplevel.add(k)};d.v7.RH2Painter.prototype.DrawSurf=function(){function a(a,b,c,e,f,d){if(q){var k=0>c?-1:c>2*p.size_z3d?1:0,g=0>d?-1:d>2*p.size_z3d?1:0;if(k!==g||0===k){if(!J)return++K;if(0!==k){var l=
d-c;c=0>k?0:2*p.size_z3d;a=e-(e-a)/l*(d-c);b=f-(f-b)/l*(d-c)}0!==g&&(l=c-d,d=0>g?0:2*p.size_z3d,e=a-(a-e)/l*(c-d),f=b-(b-f)/l*(c-d));O[M]=a;O[M+1]=b;O[M+2]=c;M+=3;O[M]=e;O[M+1]=f;O[M+2]=d;M+=3}}}function b(a,b,c,e,d,f,k,g){I>=B.length&&console.log("more than 6 points???");c=(k-c)/(f-c);f=3;0!==R&&Math.abs(c)<Math.abs(R)&&(B[I]=B[I-3],B[I+1]=B[I-2],B[I+2]=B[I-1],I-=3,f=6);B[I]=a+c*(e-a);B[I+1]=b+c*(d-b);B[I+2]=k;g&&A&&(E[H]=B[I],E[H+1]=B[I+1],E[H+2]=B[I+2],H+=3);I+=f;R=c}function k(a,b,c){b=8*((b-
l.i1)/r*m+(c-l.j1)/y);if(0<=Q[b])return console.error("More than 8 vertexes for the bin");c=b+8+Q[b];Q[b]--;Q[c]=a}function e(a){for(var b=l.i1;b<l.i2;b+=r)for(var c=l.j1;c<l.j2;c+=y){var e=8*((b-l.i1)/r*m+(c-l.j1)/y);if(-1!==Q[e]){var d=0<=Q[e]?e:e+9+Q[e];e+=8;for(var f=0,k=0,g=0,h=d;h<e;++h){var n=Q[h];if(0>n)return console.error("FAILURE in NORMALS RECALCULATIONS");f+=a[n];k+=a[n+1];g+=a[n+2]}f/=e-d;k/=e-d;g/=e-d;for(h=d;h<e;++h)n=Q[h],a[n]=f,a[n+1]=k,a[n+2]=g}}}function C(a,c,e,d,g,h,l,m,n,q){for(var p=
1;p<f.length;++p){var t=e<f[p-1]?-1:e>f[p]?1:0,u=h<f[p-1]?-1:h>f[p]?1:0,x=n<f[p-1]?-1:n>f[p]?1:0,C=t+u+x;if(3!==C){if(-3===C)break;if(J){if(I=H=0,0===t&&(B[I]=a,B[I+1]=c,B[I+2]=e,I+=3),t!==u&&(R=0,(0>t||0>u)&&b(a,c,e,d,g,h,f[p-1]),(0<t||0<u)&&b(a,c,e,d,g,h,f[p],!0)),0===u&&(B[I]=d,B[I+1]=g,B[I+2]=h,I+=3),u!==x&&(R=0,(0>u||0>x)&&b(d,g,h,l,m,n,f[p-1]),(0<u||0<x)&&b(d,g,h,l,m,n,f[p],!0)),0===x&&(B[I]=l,B[I+1]=m,B[I+2]=n,I+=3),x!==t&&(R=0,(0>x||0>t)&&b(l,m,n,a,c,e,f[p-1]),(0<x||0<t)&&b(l,m,n,a,c,e,f[p],
!0)),0!==I)if(9>I)console.log("found less than 3 points",I/3);else{if(A&&6===H){for(t=0;6>t;++t)A[Y+t]=E[t];Y+=6}t=L[p];u=G[p];z&&9===I&&(k(u,w,v),k(u+3,w+1,q?v+y:v),k(u+6,q?w:w+r,v+y));for(x=3;x<I-3;x+=3)t[u]=B[0],t[u+1]=B[1],t[u+2]=B[2],u+=3,t[u]=B[x],t[u+1]=B[x+1],t[u+2]=B[x+2],u+=3,t[u]=B[x+3],t[u+1]=B[x+4],t[u+2]=B[x+5],u+=3;G[p]=u}}else C=Math.abs(u-t)+Math.abs(x-u)+Math.abs(t-x),0===t&&++C,0===u&&++C,0===x&&++C,1!==C&&2!==C||console.error("FOND npnts",C),2<C&&(void 0===U[p]&&(U[p]=0),U[p]+=
C-2),!(0<t||0<u||0<x)||t===u&&u===x&&x===t||++P}}}var u=this.GetHisto(),p=this.frame_painter(),l=this.PrepareDraw({rounding:!1,use3d:!0,extra:1,middle:.5}),w,v,h,r=l.stepi,y=l.stepj;var c=l.i2-l.i1;var m=l.j2-l.j1,n=p.grz.domain()[0];p.grz.domain();1<r&&(c=Math.round(c/r),c*r<l.i2-l.i1&&c++);1<y&&(m=Math.round(m/y),m*y<l.j2-l.j1&&m++);var t=p.logz?function(a){return a<n?-.1:p.grz(a)}:p.grz;if(!(2>l.i2-l.i1||2>l.j2-l.j1)){var f=h=null,q=!0,D=!1,z=!1,x=null;var F=0;switch(this.options.Surf){case 11:F=
2;break;case 12:case 15:case 17:F=2;q=!1;break;case 14:q=!1;z=!0;break;case 16:F=1;D=!0;q=!1;break;default:h=p.z_handle.CreateTicks(!0),D=!0}0<F&&(x=p.GetPalette(),2==F&&this.CreateContour(p,x,{full_z_range:!0}),h=x.GetContour());if(h)for(f=new Float32Array(h.length),F=0;F<h.length;++F)f[F]=t(h[F]);else f=[0,2*p.size_z3d];var J,U=[],L=[],G=[],K=0,O=null,M=0,P=0,A=null,Y=0,Q=null,B=new Float32Array(18),I=0,R=0,E=new Float32Array(6),H=0;if(z)for(Q=new Int32Array(c*m*8),c=0;c<Q.length;++c)Q[c]=-1;for(J=
0;2>J;++J){if(J){for(c=1;c<f.length;++c)U[c]&&(L[c]=new Float32Array(9*U[c]),G[c]=0);q&&0<K&&(O=new Float32Array(6*K));D&&0<P&&(A=new Float32Array(6*P))}for(w=l.i1;w<l.i2-r;w+=r)for(c=l.grx[w],F=l.grx[w+r],v=l.j1;v<l.j2-y;v+=y){h=l.gry[v];var N=l.gry[v+y];var ca=t(u.getBinContent(w+1,v+1));var ea=t(u.getBinContent(w+1,v+1+y));var Z=t(u.getBinContent(w+1+y,v+1));var ba=t(u.getBinContent(w+1+y,v+1+y));C(c,h,ca,F,N,ba,c,N,ea,!0);C(c,h,ca,F,h,Z,F,N,ba,!1);a(c,N,ea,c,h,ca);a(c,h,ca,F,h,Z);w===l.i2-2&&
a(F,h,Z,F,N,ba);v===l.j2-2&&a(c,N,ea,F,N,ba)}}for(c=1;c<f.length;++c)L[c]&&(G[c]!==9*U[c]&&console.error("SURF faces missmatch lvl",c,"faces",U[c],"index",G[c],"check",9*U[c]-G[c]),u=new g.BufferGeometry,u.addAttribute("position",new g.BufferAttribute(L[c],3)),u.computeVertexNormals(),z&&1===c&&e(u.getAttribute("normal").array),t=x?x.getColor(c-1):this.get_color(5),t=14===this.options.Surf?new g.MeshLambertMaterial({color:t,side:g.DoubleSide}):new g.MeshBasicMaterial({color:t,side:g.DoubleSide}),
u=new g.Mesh(u,t),p.toplevel.add(u),u.painter=this);O&&(6*K!==M&&console.error("SURF lines mismmatch nsegm",K," lindx",M,"difference",6*K-M),u=this.get_color(7),t=new g.LineBasicMaterial({color:new g.Color(u)}),d.browser.isIE||(t.linewidth=this.v7EvalAttr("line_width",1)),u=d.Painter.createLineSegments(O,t),u.painter=this,p.toplevel.add(u));A&&(6*P!==Y&&console.error("SURF grid draw mismatch ngridsegm",P,"gindx",Y,"diff",6*P-Y),t=1===this.options.Surf?new g.LineDashedMaterial({color:0,dashSize:2,
gapSize:2}):new g.LineBasicMaterial({color:new g.Color(this.v7EvalColor("line_color","lightblue"))}),u=d.Painter.createLineSegments(A,t),u.painter=this,p.toplevel.add(u));17===this.options.Surf&&this.DrawContour3D();if(13===this.options.Surf){l=this.PrepareDraw({rounding:!1,use3d:!0,extra:100,middle:0});f=this.GetContour();x=this.GetPalette();var fa=-1,T=2*p.size_z3d;this.BuildContour(l,f,x,function(a,b,c,e,d){b[d]===b[e]&&c[d]===c[e]&&d--;if(!(3>d-e)){for(var f=[],k=e;k<=d;++k)k!==e&&b[k]===b[k-
1]&&c[k]===c[k-1]||f.push(new g.Vector2(b[k],c[k]));if(!(3>f.length)&&(e=g.ShapeUtils.triangulateShape(f,[]))&&0!==e.length){if(0>fa||fa!==a)fa=a,T+=1E-4*p.size_z3d;b=new Float32Array(9*e.length);c=new Float32Array(9*e.length);for(k=d=0;k<e.length;++k)for(var h=e[k],l=0;3>l;++l){var m=f[h[l]];b[d]=m.x;b[d+1]=m.y;b[d+2]=T;c[d]=0;c[d+1]=0;c[d+2]=1;d+=3}f=new g.BufferGeometry;f.addAttribute("position",new g.BufferAttribute(b,3));f.addAttribute("normal",new g.BufferAttribute(c,3));a=x.getColor(a);a=new g.MeshBasicMaterial({color:a,
flatShading:!0,side:g.DoubleSide,opacity:.5});a=new g.Mesh(f,a);a.painter=this;p.toplevel.add(a)}}})}this.UpdatePaletteDraw()}};d.v7.RH2Painter.prototype.DrawError=function(){for(var a=this.frame_painter(),b=this.GetHisto(),k=this.PrepareDraw({rounding:!1,use3d:!0,extra:1}),e=a.grz.domain()[0],C=a.grz.domain()[1],u,p,l,w,v,h,r,y,c,m=0,n=null,t=null,f=0,q=k.stepi,D=k.stepj,z=0;2>z;++z){for(u=k.i1;u<k.i2;u+=q)for(v=k.grx[u],r=k.grx[u+q],p=k.j1;p<k.j2;p+=D)if(l=b.getBinContent(u+1,p+1),!(l<e||l>C)){if(h=
l===e)h=this.options.Zero||0<e?!1:!this._show_empty_bins;h||(0===z?m+=3:(w=b.getBinError(u+1,p+1),t[f/18]=b.getBin(u+1,p+1),h=k.gry[p],y=k.gry[p+D],c=a.grz(l-w<e?e:l-w),l=a.grz(l+w>C?C:l+w),n[f]=v,n[f+3]=r,n[f+1]=n[f+4]=(h+y)/2,n[f+2]=n[f+5]=(c+l)/2,f+=6,n[f]=n[f+3]=(v+r)/2,n[f+1]=h,n[f+4]=y,n[f+2]=n[f+5]=(c+l)/2,f+=6,n[f]=n[f+3]=(v+r)/2,n[f+1]=n[f+4]=(h+y)/2,n[f+2]=c,n[f+5]=l,f+=6))}if(0===z){if(0===m)return;n=new Float32Array(6*m);t=new Int32Array(m/3)}}b=new g.Color(this.v7EvalColor("line_color",
"lightblue"));u=new g.LineBasicMaterial({color:b});n=d.Painter.createLineSegments(n,u);d.browser.isIE||(u.linewidth=this.v7EvalAttr("line_width",1));n.painter=this;n.intersect_index=t;n.zmin=e;n.zmax=C;n.tip_color=.5>b.g?65280:16711680;n.handle=k;n.tooltip=function(a){if(isNaN(a.index))return console.error("segment index not provided, check three.js version",g.REVISION,"expected r102"),null;var b=Math.floor(a.index/6);if(0>b||b>=this.intersect_index.length)return null;var c=this.painter;c.GetHisto();
a=c.frame_painter();b=c.Get3DToolTip(this.intersect_index[b]);c=this.handle;var e=b.ix-1,d=e+c.stepi,f=b.iy-1,k=f+c.stepj;b.x1=Math.max(-a.size_xy3d,c.grx[e]);b.x2=Math.min(a.size_xy3d,c.grx[d]);b.y1=Math.max(-a.size_xy3d,c.gry[f]);b.y2=Math.min(a.size_xy3d,c.gry[k]);b.z1=a.grz(b.value-b.error<this.zmin?this.zmin:b.value-b.error);b.z2=a.grz(b.value+b.error>this.zmax?this.zmax:b.value+b.error);b.color=this.tip_color;return b};a.toplevel.add(n)};d.v7.RH2Painter.prototype.DrawPolyLego=function(){var a=
this.GetHisto(),b=this.frame_painter(),d=b.grz.domain()[0],e=b.grz.domain()[1],C,u=a.fBins.arr.length,p=0,l=b.grz(d),w=l;this.fContour=null;this.fCustomContour=!1;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(C=0;C<u;++C){var v=a.fBins.arr[C];if(!(v.fContent<d)){var h=this.getContourColor(v.fContent,!0);if(null!==h&&!(v.fXmin>b.scale_xmax||v.fXmax<b.scale_xmin||v.fYmin>b.scale_ymax||v.fYmax<b.scale_ymin)){w=b.grz(v.fContent>e?e:v.fContent);var r=[],y=[],c=1,
m=v.fPoly,n=0;"TMultiGraph"==m._typename&&(c=v.fPoly.fGraphs.arr.length,m=null);for(var t=0;t<c;++t){if(!m||0<t)m=v.fPoly.fGraphs.arr[t];for(var f=m.fNpoints,q=m.fX,D=m.fY;2<f&&q[0]===q[f-1]&&D[0]===D[f-1];)--f;for(var z,x,F=0;2>F;++F){var J=b.size_xy3d*b.size_z3d,H=0<F?0:J/1E6;z=[];x=null;for(var L=0;L<f;++L){var G=b.grx(q[L]);var K=b.gry(D[L]);0<L&&(J=(G-O)*(G-O)+(K-M)*(K-M));if(J>H){z.push(new g.Vector2(G,K));var O=G;var M=K}}try{2<z.length&&(x=g.ShapeUtils.triangulateShape(z,[]))}catch(P){x=null}if(x&&
x.length>z.length-3)break}x&&x.length&&z&&(r.push(z),y.push(x),n+=2*x.length,w>l&&(n+=2*z.length))}v=new Float32Array(9*n);for(t=c=0;t<r.length;++t){z=r[t];x=y[t];for(m=0;2>m;++m)for(n=0;n<x.length;++n)D=x[n],f=z[D[0]],q=z[D[0===m?2:1]],D=z[D[0===m?1:2]],v[c]=f.x,v[c+1]=f.y,v[c+2]=m?w:l,c+=3,v[c]=q.x,v[c+1]=q.y,v[c+2]=m?w:l,c+=3,v[c]=D.x,v[c+1]=D.y,v[c+2]=m?w:l,c+=3;if(w>l)for(n=0;n<z.length;++n)f=z[n],q=z[0<n?n-1:z.length-1],v[c]=f.x,v[c+1]=f.y,v[c+2]=l,c+=3,v[c]=q.x,v[c+1]=q.y,v[c+2]=l,c+=3,v[c]=
q.x,v[c+1]=q.y,v[c+2]=w,c+=3,v[c]=f.x,v[c+1]=f.y,v[c+2]=l,c+=3,v[c]=q.x,v[c+1]=q.y,v[c+2]=w,c+=3,v[c]=f.x,v[c+1]=f.y,v[c+2]=w,c+=3}r=new g.BufferGeometry;r.addAttribute("position",new g.BufferAttribute(v,3));r.computeVertexNormals();h=this.fPalette.getColor(h);h=new g.MeshBasicMaterial({color:h,flatShading:!0});h=new g.Mesh(r,h);b.toplevel.add(h);h.painter=this;h.bins_index=C;h.draw_z0=l;h.draw_z1=w;h.tip_color=65280;h.tooltip=function(a){a=this.painter;var b=a.frame_painter(),c=a.GetObject().fBins.arr[this.bins_index];
return{use_itself:!0,x1:b.grx(c.fXmin),x2:b.grx(c.fXmax),y1:b.gry(c.fYmin),y2:b.gry(c.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:c.fContent,color:this.tip_color,lines:a.ProvidePolyBinHints(this.bins_index)}};p++}}}};d.v7.RH3Painter.prototype.ScanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy&&this.nbinsz)&&(a=this.GetHisto())){this.nbinsx=this.GetAxis("x").GetNumBins();this.nbinsy=this.GetAxis("y").GetNumBins();this.nbinsz=this.GetAxis("z").GetNumBins();if(this.IsDisplayItem())this.gminbin=
a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else{this.gminbin=this.gmaxbin=a.getBinContent(1,1,1);for(var b=0;b<this.nbinsx;++b)for(var d=0;d<this.nbinsy;++d)for(var e=0;e<this.nbinsz;++e){var g=a.getBinContent(b+1,d+1,e+1);g<this.gminbin?this.gminbin=g:g>this.gmaxbin&&(this.gmaxbin=g)}}this.draw_content=0<this.gmaxbin;this.CreateAxisFuncs(!0,!0)}};d.v7.RH3Painter.prototype.CountStat=function(){var a=this.GetHisto(),b=this.GetAxis("x"),d=this.GetAxis("y"),
e=this.GetAxis("z"),g=0,u=0,p=0,l=0,w=0,v=0,h=0,r=this.GetSelectIndex("x","left"),y=this.GetSelectIndex("x","right"),c=this.GetSelectIndex("y","left"),m=this.GetSelectIndex("y","right"),n=this.GetSelectIndex("z","left"),t=this.GetSelectIndex("z","right"),f=this.frame_painter(),q={name:a.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0},D,z,x;for(D=0;D<this.nbinsx+2;++D){var F=b.GetBinCoord(D-.5);var J=D<r?0:D>y?2:1;for(z=0;z<this.nbinsy+2;++z){var H=d.GetBinCoord(z-.5);var L=
z<c?0:z>m?2:1;for(x=0;x<this.nbinsz+2;++x){var G=e.GetBinCoord(x-.5);var K=x<n?0:x>t?2:1;var O=a.getBinContent(D,z,x);q.entries+=O;1==J&&1==L&&1==K&&(g+=O,u+=F*O,p+=H*O,l+=G*O,w+=F*F*O,v+=H*H*O,h+=G*G*O)}}}0<a.fTsumw&&!f.IsAxisZoomed("x")&&!f.IsAxisZoomed("y")&&!f.IsAxisZoomed("z")&&(g=a.fTsumw,u=a.fTsumwx,w=a.fTsumwx2,p=a.fTsumwy,v=a.fTsumwy2,l=a.fTsumwz,h=a.fTsumwz2);0<g&&(q.meanx=u/g,q.meany=p/g,q.meanz=l/g,q.rmsx=Math.sqrt(Math.abs(w/g-q.meanx*q.meanx)),q.rmsy=Math.sqrt(Math.abs(v/g-q.meany*q.meany)),
q.rmsz=Math.sqrt(Math.abs(h/g-q.meanz*q.meanz)));q.integral=g;1<a.fEntries&&(q.entries=a.fEntries);return q};d.v7.RH3Painter.prototype.FillStatistic=function(a,b,d){if(this.IgnoreStatsFill())return!1;var e=this.CountStat(),g=b%10,k=Math.floor(b/10)%10,p=Math.floor(b/100)%10,l=Math.floor(b/1E3)%10;b=Math.floor(b/1E6)%10;a.ClearPave();0<g&&a.AddText(e.name);0<k&&a.AddText("Entries = "+a.Format(e.entries,"entries"));0<p&&(a.AddText("Mean x = "+a.Format(e.meanx)),a.AddText("Mean y = "+a.Format(e.meany)),
a.AddText("Mean z = "+a.Format(e.meanz)));0<l&&(a.AddText("Std Dev x = "+a.Format(e.rmsx)),a.AddText("Std Dev y = "+a.Format(e.rmsy)),a.AddText("Std Dev z = "+a.Format(e.rmsz)));0<b&&a.AddText("Integral = "+a.Format(e.integral,"entries"));d&&a.FillFunctionStat(this.FindFunction("TF1"),d);return!0};d.v7.RH3Painter.prototype.GetBinTips=function(a,b,g){var e=[],k=this.frame_painter(),u=this.GetHisto(),p=this.GetAxis("x"),l=this.GetAxis("y"),w=this.GetAxis("z"),v=1,h=1,r=1;this.IsDisplayItem()&&(v=u.stepx||
1,h=u.stepy||1,r=u.stepz||1);e.push(this.GetTipName());"labels"==k.x_kind?e.push("x = "+k.AxisAsText("x",p.GetBinCoord(a))+"  xbin="+a):e.push("x = ["+k.AxisAsText("x",p.GetBinCoord(a))+", "+k.AxisAsText("x",p.GetBinCoord(a+v))+")   xbin="+a);"labels"==k.y_kind?e.push("y = "+k.AxisAsText("y",l.GetBinCoord(b))+"  ybin="+b):e.push("y = ["+k.AxisAsText("y",l.GetBinCoord(b))+", "+k.AxisAsText("y",l.GetBinCoord(b+h))+")  ybin="+b);"labels"==k.z_kind?e.push("z = "+k.AxisAsText("z",w.GetBinCoord(g))+"  zbin="+
g):e.push("z = ["+k.AxisAsText("z",w.GetBinCoord(g))+", "+k.AxisAsText("z",w.GetBinCoord(g+r))+")  zbin="+g);a=u.getBinContent(a+1,b+1,g+1);v="entries = "+(1<v||1<h||1<r?"~":"");a===Math.round(a)?e.push(v+a):e.push(v+d.FFormat(a,d.gStyle.fStatFormat));return e};d.v7.RH3Painter.prototype.Draw3DScatter=function(a){var b=this.GetHisto(),k=this.frame_painter(),e=a.i1,C=a.i2,u=a.stepi,p=a.j1,l=a.j2,w=a.stepj,v=a.k1,h=a.k2,r=a.stepk;this.GetTipName("<br/>");var y,c;if(C<=e||l<=p||h<=v)return!0;var m=1E3<
this.gmaxbin?1E3/this.gmaxbin:1,n=0,t=0,f=Math.max(0,this.gminbin);for(a=e;a<C;a+=u)for(y=p;y<l;y+=w)for(c=v;c<h;c+=r){var q=b.getBinContent(a+1,y+1,c+1);t+=q;q<=f||(n+=Math.round(q*m))}if(n>(k.webgl?1E5:3E4))return!1;d.seed(t);t=new d.Painter.PointsCreator(n,k.webgl,k.size_xy3d/200);n=new Int32Array(n);var D=0,z=this.GetAxis("x"),x=this.GetAxis("y"),F=this.GetAxis("z");for(a=e;a<C;a+=u)for(y=p;y<l;y+=w)for(c=v;c<h;c+=r)if(q=b.getBinContent(a+1,y+1,c+1),!(q<=f))for(e=Math.round(q*m),q=0;q<e;++q){var J=
z.GetBinCoord(a+d.random()),H=x.GetBinCoord(y+d.random()),L=F.GetBinCoord(c+d.random());n[D++]=b.getBin(a+1,y+1,c+1);t.AddPoint(k.grx(J),k.gry(H),k.grz(L))}b=this.v7EvalColor("fill_color","red");b=t.CreatePoints(b);k.toplevel.add(b);b.bins=n;b.painter=this;b.tip_color=65280;b.tooltip=function(a){if(isNaN(a.index))return console.error("intersect.index not provided, check three.js version",g.REVISION,"expected r102"),null;var b=Math.floor(a.index/this.nvertex);if(0>b||b>=this.bins.length)return null;
a=this.painter;var c=a.frame_painter();b=a.Get3DToolTip(this.bins[b]);b.x1=c.grx(a.GetAxis("x").GetBinLowEdge(b.ix));b.x2=c.grx(a.GetAxis("x").GetBinLowEdge(b.ix+u));b.y1=c.gry(a.GetAxis("y").GetBinLowEdge(b.iy));b.y2=c.gry(a.GetAxis("y").GetBinLowEdge(b.iy+w));b.z1=c.grz(a.GetAxis("z").GetBinLowEdge(b.iz));b.z2=c.grz(a.GetAxis("z").GetBinLowEdge(b.iz+r));b.color=this.tip_color;b.opacity=.3;return b};return!0};d.v7.RH3Painter.prototype.Draw3DBins=function(){if(this.draw_content){var a=this.PrepareDraw({only_indexes:!0,
extra:-.5,right_extra:-1});if(!this.options.Scatter||!this.Draw3DScatter(a)){var b=this.v7EvalColor("fill_color","red"),k=this.frame_painter(),e=0,C=!1,u=!1,p=!1,l=1,w=!0,v=.5;if(this.options.Sphere){v=.4;C=!0;11===this.options.Sphere&&(p=!0);var h=d.Painter.TestWebGL()?new g.SphereGeometry(.5,16,12):new g.SphereGeometry(.5,8,6);h.applyMatrix((new g.Matrix4).makeRotationX(Math.PI/2));e=9*h.faces.length;var r=new Float32Array(e);var y=new Float32Array(e);for(var c=0;c<h.faces.length;++c)r[9*c]=h.vertices[h.faces[c].a].x,
r[9*c+1]=h.vertices[h.faces[c].a].y,r[9*c+2]=h.vertices[h.faces[c].a].z,r[9*c+3]=h.vertices[h.faces[c].b].x,r[9*c+4]=h.vertices[h.faces[c].b].y,r[9*c+5]=h.vertices[h.faces[c].b].z,r[9*c+6]=h.vertices[h.faces[c].c].x,r[9*c+7]=h.vertices[h.faces[c].c].y,r[9*c+8]=h.vertices[h.faces[c].c].z,y[9*c]=h.faces[c].vertexNormals[0].x,y[9*c+1]=h.faces[c].vertexNormals[0].y,y[9*c+2]=h.faces[c].vertexNormals[0].z,y[9*c+3]=h.faces[c].vertexNormals[1].x,y[9*c+4]=h.faces[c].vertexNormals[1].y,y[9*c+5]=h.faces[c].vertexNormals[1].z,
y[9*c+6]=h.faces[c].vertexNormals[2].x,y[9*c+7]=h.faces[c].vertexNormals[2].y,y[9*c+8]=h.faces[c].vertexNormals[2].z}else{h=d.Painter.Box3D.Indexes;c=d.Painter.Box3D.Normals;var m=d.Painter.Box3D.Vertices;e=3*h.length;r=new Float32Array(e);y=new Float32Array(e);for(var n=0,t=-3;n<h.length;++n){var f=m[h[n]];r[3*n]=f.x-.5;r[3*n+1]=f.y-.5;r[3*n+2]=f.z-.5;0===n%6&&(t+=3);y[3*n]=c[t];y[3*n+1]=c[t+1];y[3*n+2]=c[t+2]}u=!0;11==this.options.Box?p=!0:12==this.options.Box?(p=!0,u=!1):this.options.Color&&(p=
!0,l=.5,u=w=!1,C=!0)}w&&(w=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);var q=this.GetHisto(),D=a.i1,z=a.i2,x=a.stepi,F=a.j1,J=a.j2,H=a.stepj,L=a.k1,G=a.k2,K=a.stepk;this.GetTipName("<br/>");a=null;p&&(a=k.GetPalette(),this.CreateContour(k,a));if(!(z<=D||J<=F||G<=L)){var O=this.GetAxis("x"),M=this.GetAxis("y"),P=this.GetAxis("z");h=(k.grx(O.GetBinCoord(z))-k.grx(O.GetBinCoord(D)))/(z-D)*x;c=(k.gry(M.GetBinCoord(J))-k.gry(M.GetBinCoord(F)))/(J-F)*H;m=(k.grz(P.GetBinCoord(G))-
k.grz(P.GetBinCoord(L)))/(G-L)*K;var A=0,N,Q;t=[];var B=0,I=[];for(N=D;N<z;N+=x)for(Q=F;Q<J;Q+=H)for(n=L;n<G;n+=K)if(f=q.getBinContent(N+1,Q+1,n+1),this.options.Color||!(0===f||f<this.gminbin)){var R=w?Math.pow(Math.abs(f*w),.3333):1;if(!(.001>R)&&(A++,p)){var E=a.getContourIndex(f);0<=E?(void 0===t[E]&&(t[E]=0,I[E]=B++),t[E]+=1):console.error("not found color for",f)}}p||(t.push(A),B=1,I=[0]);var V=Array(B),da=Array(B),ca=Array(B),ea=Array(B),Z=Array(B),ba=Array(B);B=Array(B);for(n=0;n<t.length;++n)t[n]&&
(A=t[n],E=I[n],V[E]=0,Z[E]=0,u&&(Z[E]=65520<A*e/3?2:1),da[E]=new Float32Array(A*e),ca[E]=new Float32Array(A*e),ea[E]=new Int32Array(A),1===Z[E]&&(ba[E]=new Uint16Array(A*d.Painter.Box3D.MeshSegments.length)),2===Z[E]&&(B[E]=new Float32Array(A*d.Painter.Box3D.Segments.length*3)));O=this.GetAxis("x");M=this.GetAxis("y");P=this.GetAxis("z");for(N=D;N<z;N+=x)for(n=O.GetBinCenter(N+1),u=k.grx(n),Q=F;Q<J;Q+=H)for(n=M.GetBinCenter(Q+1),D=k.gry(n),n=L;n<G;n+=K)if(f=q.getBinContent(N+1,Q+1,n+1),this.options.Color||
!(0===f||f<this.gminbin))if(R=w?Math.pow(Math.abs(f*w),.3333):1,!(.001>R)){E=0;if(p){E=a.getContourIndex(f);if(0>E)continue;E=I[E]}A=V[E];f=P.GetBinCenter(n+1);var fa=k.grz(f);ea[E][A]=q.getBin(N+1,Q+1,n+1);var T=A*e;f=da[E];for(var W=ca[E],S=0;S<e;S+=3,T+=3)f[T]=u+r[S]*h*R,f[T+1]=D+r[S+1]*c*R,f[T+2]=fa+r[S+2]*m*R,W[T]=y[S],W[T+1]=y[S+1],W[T+2]=y[S+2];if(1===Z[E]){W=d.Painter.Box3D.MeshSegments;T=A*W.length;f=Math.round(A*e/3);var aa=ba[E];for(S=0;S<W.length;++S)aa[T+S]=f+W[S]}if(2===Z[E])for(W=d.Painter.Box3D.Segments,
aa=B[E],T=A*W.length*3,S=0;S<W.length;++S,T+=3)f=d.Painter.Box3D.Vertices[W[S]],aa[T]=u+(f.x-.5)*h*R,aa[T+1]=D+(f.y-.5)*c*R,aa[T+2]=fa+(f.z-.5)*m*R;V[E]=A+1}for(n=0;n<t.length;++n)t[n]&&(A=t[n],E=I[n],r=new g.BufferGeometry,r.addAttribute("position",new g.BufferAttribute(da[E],3)),r.addAttribute("normal",new g.BufferAttribute(ca[E],3)),p&&(b=a.getColor(n)),y=C?new g.MeshLambertMaterial({color:b,opacity:l,transparent:1>l}):new g.MeshBasicMaterial({color:b,opacity:l}),r=new g.Mesh(r,y),r.bins=ea[E],
r.bins_faces=e/9,r.painter=this,r.scalex=v*h,r.scaley=v*c,r.scalez=v*m,r.tip_color=65280,r.use_scale=w,r.tooltip=function(a){if(isNaN(a.faceIndex))return console.error("intersect.faceIndex not provided, check three.js version",g.REVISION,"expected r102"),null;a=Math.floor(a.faceIndex/this.bins_faces);if(0>a||a>=this.bins.length)return null;var b=this.painter;b.GetHisto();var c=b.frame_painter();a=b.Get3DToolTip(this.bins[a]);var e=c.grx(b.GetAxis("x").GetBinCoord(a.ix-.5)),d=c.gry(b.GetAxis("y").GetBinCoord(a.iy-
.5));b=c.grz(b.GetAxis("z").GetBinCoord(a.iz-.5));c=this.use_scale?Math.pow(Math.abs(a.value*this.use_scale),.3333):1;a.x1=e-this.scalex*c;a.x2=e+this.scalex*c;a.y1=d-this.scaley*c;a.y2=d+this.scaley*c;a.z1=b-this.scalez*c;a.z2=b+this.scalez*c;a.color=this.tip_color;return a},k.toplevel.add(r),0<Z[E]&&(r=this.v7EvalColor("line_color","lightblue"),r=new g.LineBasicMaterial({color:r}),y=null,y=1===Z[E]?d.Painter.createLineSegments(da[E],r,ba[E]):d.Painter.createLineSegments(B[E],r),k.toplevel.add(y)));
p&&this.UpdatePaletteDraw()}}}};d.v7.RH3Painter.prototype.Redraw=function(a){var b=this.frame_painter();this.GetHisto();"resize"==a?b.Resize3D()&&b.Render3D():(b.Create3DScene(),b.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax,this.zmin,this.zmax),b.Set3DOptions(this.options),b.DrawXYZ(b.toplevel,{zoom:d.gStyle.Zooming,ndim:3}),this.DrawingBins(null,a,function(){var a=this.frame_painter();console.log("drawing bins",this.options.Color,this.draw_content);this.Draw3DBins();a.Render3D();this.UpdateStatWebCanvas();
a.AddKeysHandler()}))};d.v7.RH3Painter.prototype.FillToolbar=function(){var a=this.pad_painter();a&&(a.AddButton(d.ToolbarIcons.auto_zoom,"Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&a.AddButton(d.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox"),a.ShowButtons())};d.v7.RH3Painter.prototype.CanZoomIn=function(a,b,d){var e=this.GetHisto();e&&(e=e["f"+a.toUpperCase()+"axis"]);return!e||1<e.FindBin(d,.5)-e.FindBin(b,0)};d.v7.RH3Painter.prototype.AutoZoom=function(){var a=this.GetSelectIndex("x",
"left"),b=this.GetSelectIndex("x","right"),d=this.GetSelectIndex("y","left"),e=this.GetSelectIndex("y","right"),g=this.GetSelectIndex("z","left"),u=this.GetSelectIndex("z","right"),p,l,w,v=this.GetHisto();if(a!==b&&d!==e&&g!==u){var h=v.getBinContent(a+1,d+1,g+1);for(p=a;p<b;++p)for(l=d;l<e;++l)for(w=g;w<u;++w)h=Math.min(h,v.getBinContent(p+1,l+1,w+1));if(!(0<h)){var r=b,y=a,c=e,m=d,n=u,t=g;for(p=a;p<b;++p)for(l=d;l<e;++l)for(w=g;w<u;++w)v.getBinContent(p+1,l+1,w+1)>h&&(p<r&&(r=p),p>=y&&(y=p+1),l<
c&&(c=l),l>=m&&(m=l+1),w<n&&(n=w),w>=t&&(t=w+1));p=!1;r===y-1&&r>a+1&&y<b-1&&(r--,y++);c===m-1&&c>d+1&&m<e-1&&(c--,m++);n===t-1&&n>g+1&&t<u-1&&(n--,t++);if((r>a||y<b)&&r<y-1){var f=this.GetAxis("x").GetBinLowEdge(r+1);var q=this.GetAxis("x").GetBinLowEdge(y+1);p=!0}if((c>d||m<e)&&c<m-1){var D=this.GetAxis("y").GetBinLowEdge(c+1);var z=this.GetAxis("y").GetBinLowEdge(m+1);p=!0}if((n>g||t<u)&&n<t-1){var x=this.GetAxis("z").GetBinLowEdge(n+1);var F=this.GetAxis("z").GetBinLowEdge(t+1);p=!0}p&&this.frame_painter().Zoom(f,
q,D,z,x,F)}}};d.v7.RH3Painter.prototype.FillHistContextMenu=function(a){var b=d.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.InteractiveRedraw(!0,"drawopt")})};return d});
