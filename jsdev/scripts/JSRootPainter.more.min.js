(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3","JSRootMath"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"),require("./JSRootMath.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.v3.js","JSRootPainter.more.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.more.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.more.js")}a(JSROOT,d3)}}}(function(d,u){d.sources.push("more2d");function q(){var C=this.GetObject(),B=this.pad_width(),z=this.pad_height(),x=C.fX,H=C.fY,D=this.get_color(C.fTextColor),F=false,G=1,A=C.fTextSize||0.05,y=this.frame_painter();if(C.TestBit(d.BIT(14))){x=x*B;H=(1-H)*z}else{if(y&&!y.mode3d){B=this.frame_width();z=this.frame_height();F="upper_layer";x=y.grx(x);H=y.gry(H)}else{if(this.root_pad()!==null){x=this.ConvertToNDC("x",x)*B;H=(1-this.ConvertToNDC("y",H))*z}else{C.fTextAlign=22;x=B/2;H=z/2;if(!D){D="black"}}}}this.CreateG(F);var E={align:C.fTextAlign,x:Math.round(x),y:Math.round(H),text:C.fTitle,color:D,latex:0};if(C.fTextAngle){E.rotate=-C.fTextAngle}if(C._typename=="TLatex"){E.latex=1;G=0.9}else{if(C._typename=="TMathText"){E.latex=2;G=0.8}}this.StartTextDrawing(C.fTextFont,Math.round((A>1)?A:A*Math.min(B,z)*G));this.DrawText(E);this.FinishTextDrawing()}function o(){var y=this.GetObject(),x=new d.TAttLineHandler(y),z=d.BIT(14),w=y.TestBit(z);this.CreateG();this.draw_g.append("svg:line").attr("x1",this.AxisToSvg("x",y.fX1,w)).attr("y1",this.AxisToSvg("y",y.fY1,w)).attr("x2",this.AxisToSvg("x",y.fX2,w)).attr("y2",this.AxisToSvg("y",y.fY2,w)).call(x.func)}function k(){var z=this.GetObject(),y=new d.TAttLineHandler(z),A=this.createAttFill(z),x=d.BIT(14),w=z.TestBit(x),B="";this.CreateG();for(var C=0;C<=z.fLastPoint;++C){B+=((C>0)?"L":"M")+this.AxisToSvg("x",z.fX[C],w)+","+this.AxisToSvg("y",z.fY[C],w)}if(z._typename!="TPolyLine"){A.SetSolidColor("none")}if(!A.empty()){B+="Z"}this.draw_g.append("svg:path").attr("d",B).call(y.func).call(A.func)}function n(){var W=this.GetObject();this.createAttLine({attr:W});this.createAttFill({attr:W});this.CreateG();var M=this.AxisToSvg("x",W.fX1,false),L=this.AxisToSvg("y",W.fY1,false),I=this.AxisToSvg("x",W.fX1+W.fR1,false)-M,H=L-this.AxisToSvg("y",W.fY1+W.fR2,false);if(W._typename=="TCrown"){if(W.fR1<=0){I=this.AxisToSvg("x",W.fX1+W.fR2,false)-M}else{var V=I,E=H,F=L-this.AxisToSvg("y",W.fY1+W.fR1,false),T=this.AxisToSvg("x",W.fX1+W.fR2,false)-M;var U=this.draw_g.attr("transform","translate("+M+","+L+")").append("svg:path").call(this.lineatt.func).call(this.fillatt.func);if((W.fPhimin==0)&&(W.fPhimax==360)){U.attr("d","M-"+V+",0A"+V+","+F+",0,1,0,"+V+",0A"+V+","+F+",0,1,0,-"+V+",0M-"+T+",0A"+T+","+E+",0,1,0,"+T+",0A"+T+","+E+",0,1,0,-"+T+",0")}else{var O=(W.fPhimax-W.fPhimin>=180)?1:0;var Y=W.fPhimin*Math.PI/180,X=W.fPhimax*Math.PI/180,C=V*Math.cos(Y),P=F*Math.sin(Y),A=V*Math.cos(X),N=F*Math.sin(X),z=T*Math.cos(Y),K=E*Math.sin(Y),w=T*Math.cos(X),J=E*Math.sin(X);U.attr("d","M"+Math.round(A)+","+Math.round(N)+"A"+V+","+F+",0,"+O+",0,"+Math.round(C)+","+Math.round(P)+"L"+Math.round(z)+","+Math.round(K)+"A"+T+","+E+",0,"+O+",1,"+Math.round(w)+","+Math.round(J)+"Z")}return}}if((W.fPhimin==0)&&(W.fPhimax==360)&&(W.fTheta==0)){this.draw_g.append("svg:ellipse").attr("cx",M).attr("cy",L).attr("rx",I).attr("ry",H).call(this.lineatt.func).call(this.fillatt.func);return}var G=Math.cos(Math.PI*W.fTheta/180),Q=Math.sin(Math.PI*W.fTheta/180),C=I*Math.cos(W.fPhimin*Math.PI/180),P=H*Math.sin(W.fPhimin*Math.PI/180),S=C*G-P*Q,D=-C*Q-P*G,A=I*Math.cos(W.fPhimax*Math.PI/180),N=H*Math.sin(W.fPhimax*Math.PI/180),R=A*G-N*Q,B=-A*Q-N*G;this.draw_g.attr("transform","translate("+M+","+L+")").append("svg:path").attr("d","M0,0L"+Math.round(S)+","+Math.round(D)+"A"+I+","+H+","+Math.round(-W.fTheta)+",1,0,"+Math.round(R)+","+Math.round(B)+"Z").call(this.lineatt.func).call(this.fillatt.func)}function m(){var C=this.GetObject();this.CreateG();var H=this.AxisToSvg("x",C.fX,false),w=this.AxisToSvg("y",C.fY,false),A=this.AxisToSvg("x",C.fX+C.fRadius,false)-H,z=this.AxisToSvg("y",C.fY+C.fRadius,false)-w;this.draw_g.attr("transform","translate("+H+","+w+")");var B=C.fPieSlices.length,E,N,F,O=0,M,G;for(var D=0;D<B;D++){E=C.fPieSlices[D];O=O+E.fValue}var K=(C.fAngularOffset*Math.PI)/180;var J=A*Math.cos(K);var y=z*Math.sin(K);var I,x,L=K;for(var D=0;D<B;D++){E=C.fPieSlices[D];M=new d.TAttLineHandler(E);G=this.createAttFill(E);F=E.fValue;L=L+((2*Math.PI)/O)*F;I=A*Math.cos(L);x=z*Math.sin(L);N=E.fTitle;this.draw_g.append("svg:path").attr("d","M0,0L"+J.toFixed(1)+","+y.toFixed(1)+"A"+A.toFixed(1)+","+z.toFixed(1)+",0,0,0,"+I.toFixed(1)+","+x.toFixed(1)+"Z").call(M.func).call(G.func);J=I;y=x}}function l(){var E=this.GetObject(),w=this.OptionsAsString(),L=(w.toUpperCase().indexOf("L")>=0),M=this.createAttLine(E),H=this.createAttFill(E);this.CreateG();var J=this.AxisToSvg("x",E.fX1,false),I=this.AxisToSvg("x",E.fX2,false),y=this.AxisToSvg("y",E.fY1,false),x=this.AxisToSvg("y",E.fY2,false),D=Math.min(J,I),G=Math.min(y,x),N=Math.abs(I-J),A=Math.abs(y-x);if(!H.empty()&&!L){M.color="none"}this.draw_g.append("svg:rect").attr("x",D).attr("y",G).attr("width",N).attr("height",A).call(M.func).call(H.func);if(E.fBorderMode&&E.fBorderSize&&(H.color!=="none")){var K=E.fBorderSize,z=E.fBorderSize,C="M"+D+","+G+"h"+N+"l"+(-K)+","+z+"h"+(2*K-N)+"v"+(A-2*z)+"l"+(-K)+","+z+"z",B="M"+(D+N)+","+(G+A)+"v"+(-A)+"l"+(-K)+","+z+"v"+(A-2*z)+"h"+(2*K-N)+"l"+(-K)+","+z+"z";if(E.fBorderMode<0){var F=C;C=B;B=F}this.draw_g.append("svg:path").attr("d",C).style("stroke","none").call(H.func).style("fill",u.rgb(H.color).brighter(0.5).toString());this.draw_g.append("svg:path").attr("d",B).style("stroke","none").call(H.func).style("fill",u.rgb(H.color).darker(0.5).toString())}}function h(){var A=this.GetObject(),B=new d.TAttMarkerHandler(A),C=d.BIT(14),z=A.TestBit(C);this.CreateG();var w=this.AxisToSvg("x",A.fX,z),E=this.AxisToSvg("y",A.fY,z),D=B.create(w,E);if(D){this.draw_g.append("svg:path").attr("d",D).call(B.func)}}function s(){var y=this.GetObject(),x=new d.TAttMarkerHandler(y),w=false;this.CreateG();var z="";for(var A=0;A<y.fN;++A){z+=x.create(this.AxisToSvg("x",y.fX[A],w),this.AxisToSvg("y",y.fY[A],w))}if(z){this.draw_g.append("svg:path").attr("d",z).call(x.func)}}function f(){var C=this.GetObject(),w=Math.max(3,Math.round(Math.max(this.pad_width(),this.pad_height())*C.fArrowSize)),R=Math.round(w*Math.tan(C.fAngle/2*Math.PI/180));this.createAttLine({attr:C});this.createAttFill({attr:C});this.CreateG();var V=this.AxisToSvg("x",C.fX1,false),D=this.AxisToSvg("y",C.fY1,false),T=this.AxisToSvg("x",C.fX2,false),A=this.AxisToSvg("y",C.fY2,false),x="M0,0L"+w+","+R+"L0,"+(2*R),J="M"+w+",0L0,"+R+"L"+w+","+(2*R),E=null,F=null,O=null,y=null,K=C.fOption,U=K.length;if(K.indexOf("<")==0){var B=(K.indexOf("<|")==0);if(!y){y=this.draw_g.append("defs")}E="jsroot_arrowmarker_"+d.id_counter++;var Q=y.append("svg:marker").attr("id",E).attr("markerWidth",w).attr("markerHeight",2*R).attr("refX",0).attr("refY",R).attr("orient","auto").attr("markerUnits","userSpaceOnUse");var z=Q.append("svg:path").style("fill","none").attr("d",J+(B?"Z":"")).call(this.lineatt.func);if(B){z.call(this.fillatt.func);if((this.fillatt.color==this.lineatt.color)&&this.fillatt.isSolid()){z.style("stroke-width",1)}var M=T-V,L=A-D,S=Math.sqrt(M*M+L*L);if(S>w){var G=w/S;V+=G*M;D+=G*L;Q.attr("refX",w)}}}var H=0;if(K.indexOf("->-")>=0){H=1}else{if(K.indexOf("-|>-")>=0){H=11}else{if(K.indexOf("-<-")>=0){H=2}else{if(K.indexOf("-<|-")>=0){H=12}}}}if(H>0){var B=H>10;if(!y){y=this.draw_g.append("defs")}F="jsroot_arrowmarker_"+d.id_counter++;var N=y.append("svg:marker").attr("id",F).attr("markerWidth",w).attr("markerHeight",2*R).attr("refX",Math.round(w*0.5)).attr("refY",R).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",((H%10==1)?x:J)+((H>10)?"Z":"")).call(this.lineatt.func);if(H>10){N.call(this.fillatt.func);if(this.fillatt.isSolid(this.lineatt.color)){N.style("stroke-width",1)}}}if(K.lastIndexOf(">")==U-1){var B=(K.lastIndexOf("|>")==U-2)&&(U>1);if(!y){y=this.draw_g.append("defs")}O="jsroot_arrowmarker_"+d.id_counter++;var I=y.append("svg:marker").attr("id",O).attr("markerWidth",w).attr("markerHeight",2*R).attr("refX",w).attr("refY",R).attr("orient","auto").attr("markerUnits","userSpaceOnUse");var W=I.append("svg:path").style("fill","none").attr("d",x+(B?"Z":"")).call(this.lineatt.func);if(B){W.call(this.fillatt.func);if(this.fillatt.isSolid(this.lineatt.color)){W.style("stroke-width",1)}var M=T-V,L=A-D,S=Math.sqrt(M*M+L*L);if(S>w){var G=w/S;T-=G*M;A-=G*L;I.attr("refX",0)}}}var P=this.draw_g.append("svg:path").attr("d","M"+Math.round(V)+","+Math.round(D)+((F==null)?"":"L"+Math.round(V/2+T/2)+","+Math.round(D/2+A/2))+"L"+Math.round(T)+","+Math.round(A)).call(this.lineatt.func);if(E){P.style("marker-start","url(#"+E+")")}if(F){P.style("marker-mid","url(#"+F+")")}if(O){P.style("marker-end","url(#"+O+")")}}function g(B,z,y){var w=new d.TObjectPainter(z),x=-1;function A(){if(++x>=z._items.arr.length){return w.DrawingReady()}d.draw(B,z._items.arr[x],z._items.opt[x],A)}d.draw(B,z._hist,"hist",A);return w}function v(w){d.TObjectPainter.call(this,w);this.bins=null}v.prototype=Object.create(d.TObjectPainter.prototype);v.prototype.Eval=function(w){return this.GetObject().evalPar(w)};v.prototype.CreateBins=function(I){var A=this.frame_painter(),y=0,C=0,D=this.GetObject();if(A&&!I){if(A.zoom_xmin!==A.zoom_xmax){y=A.zoom_xmin;C=A.zoom_xmax}else{y=A.xmin;C=A.xmax}}if((D.fSave.length>0)&&!this.nosave){var G=D.fSave.length-2,x=D.fSave[G],B=D.fSave[G+1],J=(B-x)/(G-1),F=[];for(var z=0;z<G;++z){var w=x+J*z;if((y!==C)&&((w+2*J<y)||(w-2*J>C))){continue}var E=D.fSave[z];if(!isNaN(E)){F.push({x:w,y:E})}}return F}var x=D.fXmin,B=D.fXmax,H=false;if(y!==C){if(y>x){x=y}if(C<B){B=C}}if(A&&A.logx&&(x>0)&&(B>0)){H=true;x=Math.log(x);B=Math.log(B)}var G=Math.max(D.fNpx,101),J=(B-x)/(G-1),F=[];for(var z=0;z<G;z++){var w=x+z*J;if(H){w=Math.exp(w)}var E=this.Eval(w);if(!isNaN(E)){F.push({x:w,y:E})}}return F};v.prototype.CreateDummyHisto=function(){var B=0,y=1,z=0,w=1,A=this.CreateBins(true);if(A&&(A.length>0)){B=y=A[0].x;z=w=A[0].y;A.forEach(function(D){B=Math.min(D.x,B);y=Math.max(D.x,y);z=Math.min(D.y,z);w=Math.max(D.y,w)});if(w>0){w*=1.05}if(z<0){z*=1.05}}var x=d.Create("TH1I"),C=this.GetObject();x.fName=C.fName+"_hist";x.fTitle=C.fTitle;x.fXaxis.fXmin=B;x.fXaxis.fXmax=y;x.fYaxis.fXmin=z;x.fYaxis.fXmax=w;return x};v.prototype.ProcessTooltip=function(w){var y=false;if((w===null)||(this.bins===null)){y=true}else{if((this.bins.length==0)||(w.x<this.bins[0].grx)||(w.x>this.bins[this.bins.length-1].grx)){y=true}}if(y){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var C=100000,B=-1,H;for(var A=0;A<this.bins.length;++A){H=this.bins[A];var G=Math.abs(H.grx-w.x);if(G<C){C=G;B=A}}H=this.bins[B];var z=this.draw_g.select(".tooltip_bin"),D=this.lineatt.width+3;if(z.empty()){z=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",D).call(this.lineatt.func).call(this.fillatt.func)}var F={name:this.GetObject().fName,title:this.GetObject().fTitle,x:H.grx,y:H.gry,color1:this.lineatt.color,color2:this.fillatt.fillcolor(),lines:[],exact:(Math.abs(H.grx-w.x)<D)&&(Math.abs(H.gry-w.y)<D)};F.changed=z.property("current_bin")!==B;F.menu=F.exact;F.menu_dist=Math.sqrt((H.grx-w.x)*(H.grx-w.x)+(H.gry-w.y)*(H.gry-w.y));if(F.changed){z.attr("cx",H.grx).attr("cy",H.gry).property("current_bin",B)}var x=this.GetTipName();if(x.length>0){F.lines.push(x)}var E=this.frame_painter();if(E){F.lines.push("x = "+E.AxisAsText("x",H.x)+" y = "+E.AxisAsText("y",H.y))}return F};v.prototype.Redraw=function(){var E=this.frame_width(),z=this.frame_height(),A=this.GetObject(),C=this.frame_painter(),B=this.main_painter(),x=this.GetTipName("\n");this.CreateG(true);this.bins=this.CreateBins(false);this.createAttLine({attr:A});this.lineatt.used=false;this.createAttFill({attr:A,kind:1});this.fillatt.used=false;for(var y=0;y<this.bins.length;++y){var G=this.bins[y];G.grx=C.grx(G.x);G.gry=C.gry(G.y)}if(this.bins.length>2){var D=z;if((B.hmin!==undefined)&&(B.hmin>=0)){D=Math.round(C.gry(0));if((D>z)||(D<0)){D=z}}var F=d.Painter.BuildSvgPath("bezier",this.bins,D,2);if(this.lineatt.color!="none"){this.draw_g.append("svg:path").attr("class","line").attr("d",F.path).style("fill","none").call(this.lineatt.func)}if(!this.fillatt.empty()){this.draw_g.append("svg:path").attr("class","area").attr("d",F.path+F.close).style("stroke","none").call(this.fillatt.func)}}};v.prototype.CanZoomIn=function(z,y,w){if(z!=="x"){return false}var C=this.GetObject();if(C.fSave.length>0){var B=C.fNpx;var A=C.fSave[B+1];var x=C.fSave[B+2];return Math.abs(A-x)/B<Math.abs(y-w)}return true};v.prototype.PerformDraw=function(){if(this.main_painter()===null){var x=this.CreateDummyHisto(),w=this;d.draw(this.divid,x,"AXIS",function(y){w.SetDivId(w.divid);w.Redraw();return w.DrawingReady()});return w}this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};d.Painter.drawFunction=function(A,z,x){var w=new v(z);w.SetDivId(A,-1);var y=new d.DrawOptions(x);w.nosave=y.check("NOSAVE");if(d.Math!==undefined){return w.PerformDraw()}d.AssertPrerequisites("math",w.PerformDraw.bind(w));return w};function b(w){d.TObjectPainter.call(this,w);this.axes_draw=false;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=true;this.is_bent=(w._typename=="TGraphBentErrors");this.has_errors=(w._typename=="TGraphErrors")||(w._typename=="TGraphAsymmErrors")||this.is_bent||w._typename.match(/^RooHist/)}b.prototype=Object.create(d.TObjectPainter.prototype);b.prototype.Redraw=function(){this.DrawBins()};b.prototype.DecodeOptions=function(x){if(!x){x=this.main_painter()?"lp":"alp"}if((typeof x=="string")&&(x.indexOf("same ")==0)){x=x.substr(5)}var y=this.GetObject(),A=new d.DrawOptions(x);if(!this.options){this.options={}}d.extend(this.options,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,NoOpt:0,MainError:1,Ends:1,Axis:"",original:x});var w=this.options;w._pfc=A.check("PFC");w._plc=A.check("PLC");w._pmc=A.check("PMC");if(A.check("NOOPT")){w.NoOpt=1}if(A.check("L")){w.Line=1}if(A.check("F")){w.Fill=1}if(A.check("A")){w.Axis=A.check("I")?"A":"AXIS"}if(A.check("X+")){w.Axis+="X+"}if(A.check("Y+")){w.Axis+="Y+"}if(A.check("RX")){w.Axis+="RX"}if(A.check("RY")){w.Axis+="RY"}if(A.check("C")){w.Curve=w.Line=1}if(A.check("*")){w.Mark=103}if(A.check("P0")){w.Mark=104}if(A.check("P")){w.Mark=1}if(A.check("B")){w.Bar=1;w.Errors=0}if(A.check("Z")){w.Errors=1;w.Ends=0}if(A.check("||")){w.Errors=1;w.MainError=0;w.Ends=1}if(A.check("[]")){w.Errors=1;w.MainError=0;w.Ends=2}if(A.check("|>")){w.Errors=1;w.Ends=3}if(A.check(">")){w.Errors=1;w.Ends=4}if(A.check("0")){w.Mark=1;w.Errors=1;w.OutRange=1}if(A.check("1")){if(w.Bar==1){w.Bar=2}}if(A.check("2")){w.Rect=1;w.Errors=0}if(A.check("3")){w.EF=1;w.Errors=0}if(A.check("4")){w.EF=2;w.Errors=0}if(A.check("5")){w.Rect=2;w.Errors=0}if(A.check("X")){w.Errors=0}if(w.Errors===undefined){w.Errors=this.has_errors?1:0}if((w.Mark==1)&&(y.fMarkerStyle==1)){w.Mark=101}if(w.Line+w.Fill+w.Mark+w.Bar+w.EF+w.Rect+w.Errors==0){if(A.empty()){w.Line=1}}if(y._typename=="TGraphErrors"){if(u.max(y.fEX)<1e-300&&u.max(y.fEY)<1e-300){w.Errors=0}}if(!w.Axis){var z=this.root_pad();if(!z||(z.fPrimitives&&(z.fPrimitives.arr[0]===y))){w.Axis="AXIS"}}else{if(w.Axis.indexOf("A")<0){w.Axis="AXIS,"+w.Axis}}};b.prototype.CreateBins=function(){var w=this.GetObject();if(!w){return}var z,y=0,A=w.fNpoints;if((w._typename==="TCutG")&&(A>3)){A--}if(w._typename=="TGraphErrors"){y=1}else{if(w._typename=="TGraphAsymmErrors"||w._typename=="TGraphBentErrors"||w._typename.match(/^RooHist/)){y=2}}this.bins=[];for(z=0;z<A;++z){var x={x:w.fX[z],y:w.fY[z],indx:z};switch(y){case 1:x.exlow=x.exhigh=w.fEX[z];x.eylow=x.eyhigh=w.fEY[z];break;case 2:x.exlow=w.fEXlow[z];x.exhigh=w.fEXhigh[z];x.eylow=w.fEYlow[z];x.eyhigh=w.fEYhigh[z];break}this.bins.push(x);if(z===0){this.xmin=this.xmax=x.x;this.ymin=this.ymax=x.y}if(y>0){this.xmin=Math.min(this.xmin,x.x-x.exlow,x.x+x.exhigh);this.xmax=Math.max(this.xmax,x.x-x.exlow,x.x+x.exhigh);this.ymin=Math.min(this.ymin,x.y-x.eylow,x.y+x.eyhigh);this.ymax=Math.max(this.ymax,x.y-x.eylow,x.y+x.eyhigh)}else{this.xmin=Math.min(this.xmin,x.x);this.xmax=Math.max(this.xmax,x.x);this.ymin=Math.min(this.ymin,x.y);this.ymax=Math.max(this.ymax,x.y)}}};b.prototype.CreateHistogram=function(){var w=this.xmin,C=this.xmax,E=this.ymin,x=this.ymax;if(w>=C){C=w+1}if(E>=x){x=E+1}var I=(C-w)*0.1,H=(x-E)*0.1,G=w-I,z=C+I,D=E-H,A=x+H;if((G<0)&&(w>=0)){G=w*0.9}if((z>0)&&(C<=0)){z=0}var F=this.GetObject();if(F.fMinimum!=-1111){D=E=F.fMinimum}if(F.fMaximum!=-1111){A=x=F.fMaximum}if((D<0)&&(E>=0)){D=0.9*E}var y=d.BIT(17);var B=F.fHistogram;if(B){if(!F.TestBit(y)){return B}F.InvertBit(y)}else{F.fHistogram=B=d.CreateHistogram("TH1F",100);B.fName=F.fName+"_h";B.fTitle=F.fTitle;B.fBits=B.fBits|d.TH1StatusBits.kNoStats}B.fXaxis.fXmin=G;B.fXaxis.fXmax=z;B.fYaxis.fXmin=D;B.fYaxis.fXmax=A;B.fMinimum=D;B.fMaximum=A;return B};b.prototype.CanOptimize=function(){return d.gStyle.OptimizeDraw>0&&!this.options.NoOpt};b.prototype.OptimizeBins=function(x,w){if((this.bins.length<30)&&!w){return this.bins}var B=null;if(typeof w=="function"){for(var A=0;A<this.bins.length;++A){if(w(this.bins[A],A)){if(!B){B=(A==0)?[]:this.bins.slice(0,A)}}else{if(B){B.push(this.bins[A])}}}}if(!B){B=this.bins}if(!x){x=500000}if((B.length<x)||!this.CanOptimize()){return B}var z=Math.floor(B.length/x);if(z<2){z=2}var y=[];for(var A=0;A<B.length;A+=z){y.push(B[A])}return y};b.prototype.TooltipText=function(y){var x=this.frame_painter(),w=[];w.push(this.GetTipName());if(y&&x){w.push("x = "+x.AxisAsText("x",y.x));w.push("y = "+x.AxisAsText("y",y.y));if(this.options.Errors&&(x.x_kind=="normal")&&("exlow" in y)&&((y.exlow!=0)||(y.exhigh!=0))){w.push("error x = -"+x.AxisAsText("x",y.exlow)+"/+"+x.AxisAsText("x",y.exhigh))}if((this.options.Errors||(this.options.EF>0))&&(x.y_kind=="normal")&&("eylow" in y)&&((y.eylow!=0)||(y.eyhigh!=0))){w.push("error y = -"+x.AxisAsText("y",y.eylow)+"/+"+x.AxisAsText("y",y.eyhigh))}}return w};b.prototype.get_main=function(){var w=this.frame_painter();if(w&&w.grx&&w.gry){return w}w={pad_layer:true,pad:this.root_pad(),pw:this.pad_width(),ph:this.pad_height(),grx:function(x){if(this.pad.fLogx){x=(x>0)?d.log10(x):this.pad.fUxmin}else{x=(x-this.pad.fX1)/(this.pad.fX2-this.pad.fX1)}return x*this.pw},gry:function(x){if(this.pad.fLogy){x=(x>0)?d.log10(x):this.pad.fUymin}else{x=(x-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)}return(1-x)*this.ph}};return w.pad?w:null};b.prototype.DrawBins=function(){var I=this,H=this.get_main(),T=this.frame_width(),ab=this.frame_height(),S=this.GetObject(),x=0,B=this.pad_painter();if(!H){return}this.CreateG(!H.pad_layer);if(B&&(this.options._pfc||this.options._plc||this.options._pmc)){var R=B.CreateAutoColor(this);if(this.options._pfc){S.fFillColor=R;delete this.fillatt}if(this.options._plc){S.fLineColor=R;delete this.lineatt}if(this.options._pmc){S.fMarkerColor=R;delete this.markeratt}this.options._pfc=this.options._plc=this.options._pmc=false}this.createAttLine({attr:S,can_excl:true});this.createAttFill({attr:S,kind:1});this.fillatt.used=false;this.draw_kind="none";this.marker_size=0;if(this.lineatt.excl_side!=0){x=this.lineatt.excl_width;if(this.lineatt.width>0){this.options.Line=1}}var L=null;if(this.options.EF){L=this.OptimizeBins((this.options.EF>1)?5000:0);for(var W=0;W<L.length;++W){var y=L[W];y.grx=H.grx(y.x);y.gry=H.gry(y.y-y.eylow)}var F=d.Painter.BuildSvgPath((this.options.EF>1)?"bezier":"line",L),J=[];for(var W=L.length-1;W>=0;--W){var y=L[W];y.gry=H.gry(y.y+y.eyhigh);J.push(y)}var C=d.Painter.BuildSvgPath((this.options.EF>1)?"Lbezier":"Lline",J);this.draw_g.append("svg:path").attr("d",F.path+C.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind="lines"}if(this.options.Line==1||this.options.Fill==1||(x!==0)){var af="";if(S._typename=="TCutG"){this.options.Fill=1}if(this.options.Fill==1){af="Z";x=0}if(!L){L=this.OptimizeBins(this.options.Curve?5000:0)}for(var W=0;W<L.length;++W){var y=L[W];y.grx=H.grx(y.x);y.gry=H.gry(y.y)}var V="line";if(this.options.Curve===1){V="bezier"}else{if(x!==0){V+="calc"}}var U=d.Painter.BuildSvgPath(V,L);if(x!==0){var ad=[];for(var W=L.length-1;W>=0;--W){var y=L[W];var G=Math.sqrt(y.dgrx*y.dgrx+y.dgry*y.dgry);y.grx+=x*y.dgry/G;y.gry-=x*y.dgrx/G;ad.push(y)}var C=d.Painter.BuildSvgPath("L"+((this.options.Curve===1)?"bezier":"line"),ad);this.draw_g.append("svg:path").attr("d",U.path+C.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",0.75)}if(this.options.Line||this.options.Fill){var Y=this.draw_g.append("svg:path").attr("d",U.path+af);if(this.options.Line){Y.call(this.lineatt.func)}else{Y.style("stroke","none")}if(this.options.Fill){Y.call(this.fillatt.func)}else{Y.style("fill","none")}}this.draw_kind="lines"}var P=null;if(this.options.Errors||this.options.Rect||this.options.Bar){L=this.OptimizeBins(5000,function(ak,aj){var ai=H.grx(ak.x);if(!I.options.Bar&&((ai<0)||(ai>T))){return true}var w=H.gry(ak.y);if(!I.options.Bar&&!I.options.OutRange&&((w<0)||(w>ab))){return true}ak.grx1=Math.round(ai);ak.gry1=Math.round(w);if(I.has_errors){ak.grx0=Math.round(H.grx(ak.x-ak.exlow)-ai);ak.grx2=Math.round(H.grx(ak.x+ak.exhigh)-ai);ak.gry0=Math.round(H.gry(ak.y-ak.eylow)-w);ak.gry2=Math.round(H.gry(ak.y+ak.eyhigh)-w);if(I.is_bent){ak.grdx0=Math.round(H.gry(ak.y+S.fEXlowd[aj])-w);ak.grdx2=Math.round(H.gry(ak.y+S.fEXhighd[aj])-w);ak.grdy0=Math.round(H.grx(ak.x+S.fEYlowd[aj])-ai);ak.grdy2=Math.round(H.grx(ak.x+S.fEYhighd[aj])-ai)}else{ak.grdx0=ak.grdx2=ak.grdy0=ak.grdy2=0}}return false});this.draw_kind="nodes";P=this.draw_g.selectAll(".grpoint").data(L).enter().append("svg:g").attr("class","grpoint").attr("transform",function(w){return"translate("+w.grx1+","+w.gry1+")"})}if(this.options.Bar){for(var aa=1;aa<L.length-1;++aa){L[aa].width=Math.max(2,(L[aa+1].grx1-L[aa-1].grx1)/2-2)}switch(L.length){case 0:break;case 1:L[0].width=T/4;break;case 2:L[0].width=L[1].width=(L[1].grx1-L[0].grx1)/2;break;default:L[0].width=L[1].width;L[L.length-1].width=L[L.length-2].width}var ah=Math.round(H.gry(0));P.append("svg:rect").attr("x",function(w){return Math.round(-w.width/2)}).attr("y",function(w){w.bar=true;if(I.options.Bar!==1){return 0}return(w.gry1>ah)?ah-w.gry1:0}).attr("width",function(w){return Math.round(w.width)}).attr("height",function(w){if(I.options.Bar!==1){return ab>w.gry1?ab-w.gry1:0}return Math.abs(ah-w.gry1)}).call(this.fillatt.func)}if(this.options.Rect){P.filter(function(w){return(w.exlow>0)&&(w.exhigh>0)&&(w.eylow>0)&&(w.eyhigh>0)}).append("svg:rect").attr("x",function(w){w.rect=true;return w.grx0}).attr("y",function(w){return w.gry2}).attr("width",function(w){return w.grx2-w.grx0}).attr("height",function(w){return w.gry0-w.gry2}).call(this.fillatt.func).call(this.options.Rect===2?this.lineatt.func:function(){})}this.error_size=0;if(this.options.Errors){var K=this.lineatt.width+d.gStyle.fEndErrorSize,ag=0,z=this.options.Ends?"m0,"+K+"v-"+2*K:"",ae=this.options.Ends?"m"+K+",0h-"+2*K:"",X=z,Q=z,Z=ae,E=ae,D=this.options.MainError?"M0,0L":"M";switch(this.options.Ends){case 2:ag=Math.max(this.lineatt.width+1,Math.round(K*0.66));X="m"+ag+","+K+"h-"+ag+"v-"+2*K+"h"+ag;Q="m-"+ag+","+K+"h"+ag+"v-"+2*K+"h-"+ag;Z="m-"+K+","+ag+"v-"+ag+"h"+2*K+"v"+ag;E="m-"+K+",-"+ag+"v"+ag+"h"+2*K+"v-"+ag;break;case 3:K=Math.max(K,Math.round(S.fMarkerSize*8*0.66));ag=Math.max(this.lineatt.width+1,Math.round(K*0.66));X="l"+ag+","+K+"v-"+2*K+"l-"+ag+","+K;Q="l-"+ag+","+K+"v-"+2*K+"l"+ag+","+K;Z="l-"+K+","+ag+"h"+2*K+"l-"+K+",-"+ag;E="l-"+K+",-"+ag+"h"+2*K+"l-"+K+","+ag;break;case 4:K=Math.max(K,Math.round(S.fMarkerSize*8*0.66));ag=Math.max(this.lineatt.width+1,Math.round(K*0.66));X="l"+ag+","+K+"m0,-"+2*K+"l-"+ag+","+K;Q="l-"+ag+","+K+"m0,-"+2*K+"l"+ag+","+K;Z="l-"+K+","+ag+"m"+2*K+",0l-"+K+",-"+ag;E="l-"+K+",-"+ag+"m"+2*K+",0l-"+K+","+ag;break}this.error_size=K;K=Math.floor((this.lineatt.width-1)/2);P.filter(function(w){return(w.exlow>0)||(w.exhigh>0)||(w.eylow>0)||(w.eyhigh>0)}).append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(w){w.error=true;return((w.exlow>0)?D+(w.grx0+K)+","+w.grdx0+X:"")+((w.exhigh>0)?D+(w.grx2-K)+","+w.grdx2+Q:"")+((w.eylow>0)?D+w.grdy0+","+(w.gry0-K)+E:"")+((w.eyhigh>0)?D+w.grdy2+","+(w.gry2+K)+Z:"")})}if(this.options.Mark){var U="",ac,N,M;this.createAttMarker({attr:S,style:this.options.Mark-100});this.marker_size=this.markeratt.GetFullSize();this.markeratt.reset_pos();var A=1000000/(this.markeratt.MarkerLength()+7),O=1;if(!L){L=this.OptimizeBins(A)}else{if(this.CanOptimize()&&(L.length>1.5*A)){O=Math.min(2,Math.round(L.length/A))}}for(var W=0;W<L.length;W+=O){ac=L[W];N=H.grx(ac.x);if((N>-this.marker_size)&&(N<T+this.marker_size)){M=H.gry(ac.y);if((M>-this.marker_size)&&(M<ab+this.marker_size)){U+=this.markeratt.create(N,M)}}}if(U.length>0){this.draw_g.append("svg:path").attr("d",U).call(this.markeratt.func);if((P===null)&&(this.draw_kind=="none")){this.draw_kind=(this.options.Mark==101)?"path":"mark"}}}};b.prototype.ExtractTooltip=function(w){if(!w){return null}if((this.draw_kind=="lines")||(this.draw_kind=="path")||(this.draw_kind=="mark")){return this.ExtractTooltipForPath(w)}if(this.draw_kind!="nodes"){return null}var x=this.frame_width(),G=this.frame_height(),A=this.frame_painter(),E=this,F=null,D=10000000000,y=null,z=this.marker_size?Math.round(this.marker_size/2+1.5):0;this.draw_g.selectAll(".grpoint").each(function(){var M=u.select(this).datum();if(M===undefined){return}var L=Math.pow(w.x-M.grx1,2);if(w.nproc===1){L+=Math.pow(w.y-M.gry1,2)}if(L>=D){return}var K=null;if(M.error||M.rect||M.marker){K={x1:Math.min(-E.error_size,M.grx0,-z),x2:Math.max(E.error_size,M.grx2,z),y1:Math.min(-E.error_size,M.gry2,-z),y2:Math.max(E.error_size,M.gry0,z)}}else{if(M.bar){K={x1:-M.width/2,x2:M.width/2,y1:0,y2:G-M.gry1};if(E.options.Bar===1){var J=A.gry(0);K.y1=(M.gry1>J)?J-M.gry1:0;K.y2=(M.gry1>J)?0:J-M.gry1}}else{K={x1:-5,x2:5,y1:-5,y2:5}}}var I=(w.x>=M.grx1+K.x1)&&(w.x<=M.grx1+K.x2),H=(w.y>=M.gry1+K.y1)&&(w.y<=M.gry1+K.y2);if(I&&(H||(w.nproc>1))){D=L;F=this;y=K;y.exact=I&&H}});if(F===null){return null}var C=u.select(F).datum();var B={name:this.GetObject().fName,title:this.GetObject().fTitle,x:C.grx1,y:C.gry1,color1:this.lineatt.color,lines:this.TooltipText(C),rect:y,d3bin:F};if(this.fillatt&&this.fillatt.used&&!this.fillatt.empty()){B.color2=this.fillatt.fillcolor()}if(y.exact){B.exact=true}B.menu=B.exact;B.menu_dist=3;B.bin=C;B.binindx=C.indx;if(w.click_handler&&B.exact&&this.TestEditable()){B.click_handler=this.InvokeClickHandler.bind(this)}return B};b.prototype.ShowTooltip=function(y){if(!y){if(this.draw_g){this.draw_g.select(".tooltip_bin").remove()}return}if(y.usepath){return this.ShowTooltipForPath(y)}var x=u.select(y.d3bin).datum();var w=this.draw_g.select(".tooltip_bin");if(w.empty()){w=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}y.changed=w.property("current_bin")!==y.d3bin;if(y.changed){w.attr("x",x.grx1+y.rect.x1).attr("width",y.rect.x2-y.rect.x1).attr("y",x.gry1+y.rect.y1).attr("height",y.rect.y2-y.rect.y1).style("opacity","0.3").property("current_bin",y.d3bin)}};b.prototype.ProcessTooltip=function(w){var x=this.ExtractTooltip(w);if(!w||!w.disabled){this.ShowTooltip(x)}return x};b.prototype.FindBestBin=function(N){if(!this.bins){return null}var M=(this.draw_kind=="lines"),z=(this.draw_kind=="mark"),H=-1,L=null,C=10000000000,E=this.frame_painter(),J,A,y,K,G;for(K=0;K<this.bins.length;++K){G=this.bins[K];A=E.grx(G.x);y=E.gry(G.y);J=(N.x-A)*(N.x-A)+(N.y-y)*(N.y-y);if(J<C){C=J;L=G;H=K}}if((C>100)&&M){L=null}var x=Math.max(this.lineatt.width+3,4);if(this.marker_size>0){x=Math.max(this.marker_size,x)}if(L){C=Math.sqrt(Math.pow(N.x-E.grx(L.x),2)+Math.pow(N.y-E.gry(L.y),2))}if(!M&&(C>x)){L=null}if(!L){H=-1}var O={bin:L,indx:H,dist:C,radius:Math.round(x)};if(!L&&M){C=10000;function D(P,R,Q){return((R>=P)&&(P>=Q))||((R<=P)&&(P<=Q))}var w=this.bins[0],B=E.grx(w.x),F,I=0;for(K=1;K<this.bins.length;++K){G=this.bins[K];A=E.grx(G.x);if(D(N.x,B,A)){F=E.gry(w.y);y=E.gry(G.y);if(Math.abs(A-B)<1){I=N.y;J=D(N.y,F,y)?0:Math.min(Math.abs(N.y-F),Math.abs(N.y-y))}else{I=F+(N.x-B)/(A-B)*(y-F);J=Math.abs(I-N.y)}if(J<C){C=J;O.linex=N.x;O.liney=I}}w=G;B=A}if(C<x*0.5){O.linedist=C;O.closeline=true}}return O};b.prototype.TestEditable=function(w){var y=this.GetObject(),x=d.BIT(18);if(!y){return false}if(w){y.InvertBit(x)}return !y.TestBit(x)};b.prototype.ExtractTooltipForPath=function(A){if(this.bins===null){return null}var C=this.FindBestBin(A);if(!C||(!C.bin&&!C.closeline)){return null}var B=(this.draw_kind=="lines"),y=(this.draw_kind=="mark"),w=this.frame_painter(),x=this.GetObject(),z={name:x.fName,title:x.fTitle,x:C.bin?w.grx(C.bin.x):C.linex,y:C.bin?w.gry(C.bin.y):C.liney,color1:this.lineatt.color,lines:this.TooltipText(C.bin),usepath:true};z.ismark=y;z.islines=B;if(C.closeline){z.menu=z.exact=true;z.menu_dist=C.linedist}else{if(C.bin){if(this.options.EF&&B){z.gry1=w.gry(C.bin.y-C.bin.eylow);z.gry2=w.gry(C.bin.y+C.bin.eyhigh)}else{z.gry1=z.gry2=w.gry(C.bin.y)}z.binindx=C.indx;z.bin=C.bin;z.radius=C.radius;z.exact=(Math.abs(A.x-z.x)<=C.radius)&&((Math.abs(A.y-z.gry1)<=C.radius)||(Math.abs(A.y-z.gry2)<=C.radius));z.menu=z.exact;z.menu_dist=Math.sqrt((A.x-z.x)*(A.x-z.x)+Math.pow(Math.min(Math.abs(A.y-z.gry1),Math.abs(A.y-z.gry2)),2));if(A.click_handler&&z.exact&&this.TestEditable()){z.click_handler=this.InvokeClickHandler.bind(this)}}}if(this.fillatt&&this.fillatt.used&&!this.fillatt.empty()){z.color2=this.fillatt.fillcolor()}if(!B){z.color1=this.get_color(x.fMarkerColor);if(!z.color2){z.color2=z.color1}}return z};b.prototype.ShowTooltipForPath=function(y){var w=this.draw_g.select(".tooltip_bin");if(!y||!y.bin){w.remove();return}if(w.empty()){w=this.draw_g.append("svg:g").attr("class","tooltip_bin")}y.changed=w.property("current_bin")!==y.bin;if(y.changed){w.selectAll("*").remove();w.property("current_bin",y.bin);if(y.ismark){w.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(y.x-y.radius)).attr("y",Math.round(y.y-y.radius)).attr("width",2*y.radius).attr("height",2*y.radius)}else{w.append("svg:circle").attr("cy",Math.round(y.gry1));if(Math.abs(y.gry1-y.gry2)>1){w.append("svg:circle").attr("cy",Math.round(y.gry2))}var x=w.selectAll("circle").attr("r",y.radius).attr("cx",Math.round(y.x));if(!y.islines){x.style("stroke",y.color1=="black"?"green":"black").style("fill","none")}else{if(this.options.Line){x.call(this.lineatt.func)}else{x.style("stroke","black")}if(this.options.Fill){x.call(this.fillatt.func)}else{x.style("fill","none")}}}}};b.prototype.movePntHandler=function(x){var y=u.mouse(this.svg_frame().node()),w=this.frame_painter();if(!w||!this.interactive_bin){return}this.interactive_bin.x=w.RevertX(y[0]+this.interactive_delta_x);this.interactive_bin.y=w.RevertY(y[1]+this.interactive_delta_y);this.DrawBins()};b.prototype.endPntHandler=function(){if(this.snapid&&this.interactive_bin){var w="SetPoint("+this.interactive_bin.indx+","+this.interactive_bin.x+","+this.interactive_bin.y+")";var x=this.canv_painter();if(x){x.SendWebsocket("OBJEXEC:"+this.snapid+":"+w)}}delete this.interactive_bin;u.select(window).on("mousemove.graphPnt",null).on("mouseup.graphPnt",null)};b.prototype.InvokeClickHandler=function(x){if(!x.bin){return}this.interactive_bin=x.bin;u.select(window).on("mousemove.graphPnt",this.movePntHandler.bind(this)).on("mouseup.graphPnt",this.endPntHandler.bind(this),true);var y=u.mouse(this.svg_frame().node()),w=this.frame_painter();this.interactive_delta_x=w?w.x(this.interactive_bin.x)-y[0]:0;this.interactive_delta_y=w?w.y(this.interactive_bin.y)-y[1]:0};b.prototype.FillContextMenu=function(w){d.TObjectPainter.prototype.FillContextMenu.call(this,w);if(!this.snapid){w.addchk(this.TestEditable(),"Editable",this.TestEditable.bind(this,true))}return w.size()>0};b.prototype.ExecuteMenuCommand=function(w,C){if(d.TObjectPainter.prototype.ExecuteMenuCommand.call(this,w,C)){return true}var y=this.canv_painter(),D=this.frame_painter();if((w.fName=="RemovePoint")||(w.fName=="InsertPoint")){var x=D?D.GetLastEventPos():null;if(!y||!D||!x){return true}var B=this.ExtractTooltip(x);if(w.fName=="InsertPoint"){var A=this.frame_painter(),F=A&&A.RevertX?A.RevertX(x.x):0,E=A&&A.RevertY?A.RevertY(x.y):0;y.ShowMessage("InsertPoint("+F.toFixed(3)+","+E.toFixed(3)+") not yet implemented")}else{if(this.args_menu_id&&B&&(B.binindx!==undefined)){var z="RemovePoint("+B.binindx+")";console.log("execute "+z+" for object "+this.args_menu_id);y.SendWebsocket("OBJEXEC:"+this.args_menu_id+":"+z)}}return true}return false};b.prototype.UpdateObject=function(z,x){if(!this.MatchObjectType(z)){return false}if((x!==undefined)&&(x!=this.options.original)){this.DecodeOptions(x)}var y=this.GetObject();y.fBits=z.fBits;y.fTitle=z.fTitle;y.fX=z.fX;y.fY=z.fY;y.fNpoints=z.fNpoints;this.CreateBins();if(this.axes_draw){var w=this.main_painter();w.UpdateObject(z.fHistogram||this.CreateHistogram());w.GetObject().fTitle=y.fTitle}return true};b.prototype.CanZoomIn=function(z,y,w){var x=this.GetObject();if((x===null)||(z!=="x")){return false}for(var A=0;A<x.fNpoints;++A){if((y<x.fX[A])&&(x.fX[A]<w)){return true}}return false};b.prototype.ButtonClick=function(x){if(x!=="ToggleZoom"){return false}var w=this.frame_painter();if(!w){return false}if((this.xmin===this.xmax)&&(this.ymin=this.ymax)){return false}w.Zoom(this.xmin,this.xmax,this.ymin,this.ymax);return true};b.prototype.FindFunc=function(){var w=this.GetObject();if(w&&w.fFunctions){for(var x=0;x<w.fFunctions.arr.length;++x){var y=w.fFunctions.arr[x];if((y._typename=="TF1")||(y._typename=="TF2")){return y}}}return null};b.prototype.FindStat=function(){var w=this.GetObject();if(w&&w.fFunctions){for(var x=0;x<w.fFunctions.arr.length;++x){var y=w.fFunctions.arr[x];if((y._typename=="TPaveStats")&&(y.fName=="stats")){return y}}}return null};b.prototype.CreateStat=function(){var z=this.FindFunc();if(!z){return null}var y=this.FindStat();if(y){return y}var w=this.canv_painter();if(w&&w.normal_canvas){return null}this.create_stats=true;var x=d.gStyle;y=d.Create("TPaveStats");d.extend(y,{fName:"stats",fOptStat:0,fOptFit:x.fOptFit||111,fBorderSize:1});y.fX1NDC=x.fStatX-x.fStatW;y.fY1NDC=x.fStatY-x.fStatH;y.fX2NDC=x.fStatX;y.fY2NDC=x.fStatY;y.fFillColor=x.fStatColor;y.fFillStyle=x.fStatStyle;y.fTextAngle=0;y.fTextSize=x.fStatFontSize;y.fTextAlign=12;y.fTextColor=x.fStatTextColor;y.fTextFont=x.fStatFont;y.AddText(z.fName);this.GetObject().fFunctions.Add(y);return y};b.prototype.FillStatistic=function(x,w,z){var y=this.FindFunc();if(!y||!z||!this.create_stats){return false}x.ClearPave();x.FillFunctionStat(y,z);return true};b.prototype.DrawNextFunction=function(y,A){var z=this.GetObject();if(!z.fFunctions||(y>=z.fFunctions.arr.length)){return d.CallBack(A)}var x=z.fFunctions.arr[y],w=z.fFunctions.opt[y];x.$main_painter=this;d.draw(this.divid,x,w,this.DrawNextFunction.bind(this,y+1,A))};b.prototype.PerformDrawing=function(x,w){if(w){this.axes_draw=true;w.$secondary=true}this.SetDivId(x);this.DrawBins();this.DrawNextFunction(0,this.DrawingReady.bind(this));return this};function e(z,y,x){var w=new b(y);w.SetDivId(z,-1);w.DecodeOptions(x);w.CreateBins();w.CreateStat();if(!w.main_painter()&&w.options.Axis){d.draw(z,w.CreateHistogram(),w.options.Axis,w.PerformDrawing.bind(w,z))}else{w.PerformDrawing(z)}return w}function r(w){d.TooltipHandler.call(this,w);this.$polargram=true;this.zoom_rmin=this.zoom_rmax=0}r.prototype=Object.create(d.TooltipHandler.prototype);r.prototype.translate=function(A,w,z){var y=this.r(w),x=y/this.szx*this.szy,B={x:y*Math.cos(-A-this.angle),y:x*Math.sin(-A-this.angle),rx:y,ry:x};if(!z){B.x=Math.round(B.x);B.y=Math.round(B.y);B.rx=Math.round(B.rx);B.ry=Math.round(B.ry)}return B};r.prototype.format=function(w){if(w===Math.round(w)){return w.toString()}if(this.ndig>10){return w.toExponential(4)}return w.toFixed((this.ndig>0)?this.ndig:0)};r.prototype.AxisAsText=function(w,x){if(w=="r"){if(x===Math.round(x)){return x.toString()}if(this.ndig>10){return x.toExponential(4)}return x.toFixed(this.ndig+2)}x*=180/Math.PI;return(x===Math.round(x))?x.toString():x.toFixed(1)};r.prototype.MouseEvent=function(y){var x=this.svg_layer("primitives_layer"),w=x.select(".interactive_ellipse");if(w.empty()){return}var z=null;if(y!=="leave"){var A=u.mouse(w.node());z={x:A[0],y:A[1],touch:false}}this.ProcessTooltipEvent(z)};r.prototype.GetFrameRect=function(){var A=this.root_pad(),x=this.pad_width(),y=this.pad_height(),z={};z.szx=Math.round(Math.max(0.1,0.5-Math.max(A.fLeftMargin,A.fRightMargin))*x);z.szy=Math.round(Math.max(0.1,0.5-Math.max(A.fBottomMargin,A.fTopMargin))*y);z.width=2*z.szx;z.height=2*z.szy;z.midx=Math.round(x/2);z.midy=Math.round(y/2);z.x=z.midx-z.szx;z.y=z.midy-z.szy;z.hint_delta_x=z.szx;z.hint_delta_y=z.szy;z.transform="translate("+z.x+","+z.y+")";return z};r.prototype.MouseWheel=function(){u.event.stopPropagation();u.event.preventDefault();this.ProcessTooltipEvent(null);var y=this.GetObject();if(!u.event||!y){return}var A=u.event.wheelDelta?-u.event.wheelDelta:(u.event.deltaY||u.event.detail);if(!A){return}A=(A<0)?-0.2:0.2;var x=this.scale_rmin,z=this.scale_rmax,w=z-x;z+=A*w;if((x<y.fRwrmin)||(z>y.fRwrmax)){x=z=0}if((this.zoom_rmin!=x)||(this.zoom_rmax!=z)){this.zoom_rmin=x;this.zoom_rmax=z;this.RedrawPad()}};r.prototype.Redraw=function(){if(!this.is_main_painter()){return}var M=this.root_pad(),S=this.GetObject(),x=this.GetFrameRect();this.CreateG();this.draw_g.attr("transform","translate("+x.midx+","+x.midy+")");this.szx=x.szx;this.szy=x.szy;this.scale_rmin=S.fRwrmin;this.scale_rmax=S.fRwrmax;if(this.zoom_rmin!=this.zoom_rmax){this.scale_rmin=this.zoom_rmin;this.scale_rmax=this.zoom_rmax}this.r=u.scaleLinear().domain([this.scale_rmin,this.scale_rmax]).range([0,this.szx]);this.angle=S.fAxisAngle||0;var P=this.r.ticks(5),F=Math.floor((S.fNdivRad%10000)/100);this.createAttLine({attr:S});if(!this.gridatt){this.gridatt=new d.TAttLineHandler({color:S.fLineColor,style:2,width:1})}var E=Math.abs(S.fRwrmax-S.fRwrmin);this.ndig=(E<=0)?-3:Math.round(d.log10(P.length/E));var G=[],R=0;while(R<P.length){var J=this.format(P[R]);if(G.indexOf(J)>=0){if(++this.ndig>10){break}G=[];R=0;continue}G.push(J);R++}var z=false;if((P[P.length-1]<S.fRwrmax)&&(this.zoom_rmin==this.zoom_rmax)){P.push(S.fRwrmax);z=true}this.StartTextDrawing(S.fRadialLabelFont,Math.round(S.fRadialTextSize*this.szy*2));for(var I=0;I<P.length;++I){var D=this.r(P[I]),C=D/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(D)).attr("ry",Math.round(C)).style("fill","none").call(this.lineatt.func);if((I<P.length-1)||!z){this.DrawText({align:23,x:Math.round(D),y:Math.round(S.fRadialTextSize*this.szy*0.5),text:this.format(P[I]),color:this.get_color[S.fRadialLabelColor],latex:0})}if((F>1)&&((I<P.length-1)||!z)){var H=(P[1]-P[0])/F;for(var y=1;y<F;++y){var B=P[I]+H*y;if(B>this.scale_rmax){break}D=this.r(B);C=D/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(D)).attr("ry",Math.round(C)).style("fill","none").call(this.gridatt.func)}}}this.FinishTextDrawing();var O=Math.round(S.fPolarTextSize*this.szy*2);this.StartTextDrawing(S.fPolarLabelFont,O);var A=S.fNdivPol%100;if((A!==8)&&(A!==3)){A=8}var G=(A==8)?["0","#frac{#pi}{4}","#frac{#pi}{2}","#frac{3#pi}{4}","#pi","#frac{5#pi}{4}","#frac{3#pi}{2}","#frac{7#pi}{4}"]:["0","#frac{2#pi}{3}","#frac{4#pi}{3}"],w=[12,11,21,31,32,33,23,13];for(var I=0;I<A;++I){var L=-I*2*Math.PI/A-this.angle;this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(L))).attr("y2",Math.round(this.szy*Math.sin(L))).call(this.lineatt.func);var K=Math.round(16-L/Math.PI*4)%8;this.DrawText({align:w[K],x:Math.round((this.szx+O)*Math.cos(L)),y:Math.round((this.szy+O/this.szx*this.szy)*(Math.sin(L))),text:G[I],color:this.get_color[S.fPolarLabelColor],latex:1})}this.FinishTextDrawing();var F=Math.floor((S.fNdivPol%10000)/100);if(F>1){for(var I=0;I<A*F;++I){if(I%F===0){continue}var L=-I*2*Math.PI/A/F-this.angle;this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(L))).attr("y2",Math.round(this.szy*Math.sin(L))).call(this.gridatt.func)}}if(d.BatchMode){return}var Q=this.svg_layer("primitives_layer"),N=Q.select(".interactive_ellipse");if(N.empty()){N=Q.append("g").classed("most_upper_primitives",true).append("ellipse").classed("interactive_ellipse",true).attr("cx",0).attr("cy",0).style("fill","none").style("pointer-events","visibleFill").on("mouseenter",this.MouseEvent.bind(this,"enter")).on("mousemove",this.MouseEvent.bind(this,"move")).on("mouseleave",this.MouseEvent.bind(this,"leave"))}N.attr("rx",this.szx).attr("ry",this.szy);u.select(N.node().parentNode).attr("transform",this.draw_g.attr("transform"));if(d.gStyle.Zooming&&d.gStyle.ZoomWheel){N.on("wheel",this.MouseWheel.bind(this))}};d.Painter.drawGraphPolargram=function(A,z,y){var x=new r(z);x.SetDivId(A,-1);var w=x.main_painter();if(w){if(w.GetObject()!==z){console.error("Cannot superimpose TGraphPolargram with any other drawings")}return null}x.SetDivId(A,4);x.Redraw();return x.DrawingReady()};function i(w){d.TObjectPainter.call(this,w)}i.prototype=Object.create(d.TObjectPainter.prototype);i.prototype.Redraw=function(){this.DrawBins()};i.prototype.DecodeOptions=function(w){var x=new d.DrawOptions(w||"L");if(!this.options){this.options={}}d.extend(this.options,{mark:x.check("P"),err:x.check("E"),fill:x.check("F"),line:x.check("L"),curve:x.check("C")});this.OptionsStore(w)};i.prototype.DrawBins=function(){var E=this.GetObject(),y=this.main_painter();if(!E||!y||!y.$polargram){return}if(this.options.mark){this.createAttMarker({attr:E})}if(this.options.err||this.options.line||this.options.curve){this.createAttLine({attr:E})}if(this.options.fill){this.createAttFill({attr:E})}this.CreateG();this.draw_g.attr("transform",y.draw_g.attr("transform"));var z="",x="",A="",F=[];for(var w=0;w<E.fNpoints;++w){if(E.fY[w]>y.scale_rmax){continue}if(this.options.err){var D=y.translate(E.fX[w],E.fY[w]-E.fEY[w]),C=y.translate(E.fX[w],E.fY[w]+E.fEY[w]);x+="M"+D.x+","+D.y+"L"+C.x+","+C.y;D=y.translate(E.fX[w]+E.fEX[w],E.fY[w]);C=y.translate(E.fX[w]-E.fEX[w],E.fY[w]);x+="M"+D.x+","+D.y+"A"+C.rx+","+C.ry+",0,0,1,"+C.x+","+C.y}var B=y.translate(E.fX[w],E.fY[w]);if(this.options.mark){z+=this.markeratt.create(B.x,B.y)}if(this.options.line||this.options.fill){A+=(A?"L":"M")+B.x+","+B.y}if(this.options.curve){B.grx=B.x;B.gry=B.y;F.push(B)}}if(this.options.fill&&A){this.draw_g.append("svg:path").attr("d",A+"Z").style("stroke","none").call(this.fillatt.func)}if(this.options.line&&A){this.draw_g.append("svg:path").attr("d",A).style("fill","none").call(this.lineatt.func)}if(this.options.curve&&F.length){this.draw_g.append("svg:path").attr("d",d.Painter.BuildSvgPath("bezier",F).path).style("fill","none").call(this.lineatt.func)}if(x){this.draw_g.append("svg:path").attr("d",x).style("fill","none").call(this.lineatt.func)}if(z){this.draw_g.append("svg:path").attr("d",z).call(this.markeratt.func)}};i.prototype.CreatePolargram=function(){var y=d.Create("TGraphPolargram"),x=this.GetObject();var w=x.fY[0]||0,A=w;for(var z=0;z<x.fNpoints;++z){w=Math.min(w,x.fY[z]-x.fEY[z]);A=Math.max(A,x.fY[z]+x.fEY[z])}y.fRwrmin=w-(A-w)*0.1;y.fRwrmax=A+(A-w)*0.1;return y};i.prototype.ExtractTooltip=function(x){if(!x){return null}var G=this.GetObject(),z=this.main_painter(),D=10000000000,F=-1,B=null;for(var y=0;y<G.fNpoints;++y){var E=z.translate(G.fX[y],G.fY[y]);var A=(E.x-x.x)*(E.x-x.x)+(E.y-x.y)*(E.y-x.y);if(A<D){D=A;F=y;B=E}}var w=5;if(this.markeratt&&this.markeratt.used){w=this.markeratt.GetFullSize()}if(Math.sqrt(D)>w){return null}var C={name:this.GetObject().fName,title:this.GetObject().fTitle,x:B.x,y:B.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:Math.sqrt(D)<4,lines:[this.GetTipName()],binindx:F,menu_dist:w,radius:w};C.lines.push("r = "+z.AxisAsText("r",G.fY[F]));C.lines.push("phi = "+z.AxisAsText("phi",G.fX[F]));if(G.fEY&&G.fEY[F]){C.lines.push("error r = "+z.AxisAsText("r",G.fEY[F]))}if(G.fEX&&G.fEX[F]){C.lines.push("error phi = "+z.AxisAsText("phi",G.fEX[F]))}return C};i.prototype.ShowTooltip=function(x){if(!this.draw_g){return}var w=this.draw_g.select(".tooltip_bin");if(!x){w.remove();return}if(w.empty()){w=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")}x.changed=w.property("current_bin")!==x.binindx;if(x.changed){w.attr("cx",x.x).attr("cy",x.y).attr("rx",Math.round(x.radius)).attr("ry",Math.round(x.radius)).style("fill","none").style("stroke",x.color1).property("current_bin",x.binindx)}};i.prototype.ProcessTooltip=function(w){var x=this.ExtractTooltip(w);if(!w||!w.disabled){this.ShowTooltip(x)}return x};i.prototype.PerformDrawing=function(w){this.SetDivId(w);this.DrawBins();this.DrawingReady()};d.Painter.drawGraphPolar=function(A,z,y){var x=new i(z);x.DecodeOptions(y);x.SetDivId(A,-1);var w=x.main_painter();if(w){if(!w.$polargram){console.error("Cannot superimpose TGraphPolar with plain histograms");return null}x.PerformDrawing(A);return x}if(!z.fPolargram){z.fPolargram=x.CreatePolargram()}return d.draw(A,z.fPolargram,"",x.PerformDrawing.bind(x,A))};function c(w){d.TObjectPainter.call(this,w);this.bins=null}c.prototype=Object.create(d.TObjectPainter.prototype);c.prototype.UpdateObject=function(x,w){var y=this.GetObject();if(y._typename!=x._typename){return false}if(y!==x){d.extend(y,x)}if(w!==undefined){this.DecodeOptions(w)}return true};c.prototype.Eval=function(z,w){var y=w-z.fX;if(z._typename=="TSplinePoly3"){return z.fY+y*(z.fB+y*(z.fC+y*z.fD))}if(z._typename=="TSplinePoly5"){return z.fY+y*(z.fB+y*(z.fC+y*(z.fD+y*(z.fE+y*z.fF))))}return z.fY+y};c.prototype.FindX=function(y){var B=this.GetObject(),A=0,z=B.fNp-1;if(y<=B.fXmin){return 0}if(y>=B.fXmax){return z}if(B.fKstep){A=Math.round((y-B.fXmin)/B.fDelta);if(y<B.fPoly[A].fX){A=Math.max(A-1,0)}else{if(A<z){if(y>B.fPoly[A+1].fX){++A}}}}else{while(z-A>1){var w=Math.round((A+z)/2);if(y>B.fPoly[w].fX){A=w}else{z=w}}}return A};c.prototype.CreateDummyHisto=function(){var A=0,y=1,z=0,w=1,B=this.GetObject();if(B&&B.fPoly){A=y=B.fPoly[0].fX;z=w=B.fPoly[0].fY;B.fPoly.forEach(function(C){A=Math.min(C.fX,A);y=Math.max(C.fX,y);z=Math.min(C.fY,z);w=Math.max(C.fY,w)});if(w>0){w*=1.05}if(z<0){z*=1.05}}var x=d.Create("TH1I");x.fName=B.fName+"_hist";x.fTitle=B.fTitle;x.fXaxis.fXmin=A;x.fXaxis.fXmax=y;x.fYaxis.fXmin=z;x.fYaxis.fXmax=w;return x};c.prototype.ProcessTooltip=function(x){var A=false,D=this.GetObject(),C=this.frame_painter(),w,H,B=null,E=0;if((x===null)||!D||!C){A=true}else{w=C.RevertX(x.x);E=this.FindX(w);B=D.fPoly[E];H=this.Eval(B,w);if((E<D.fN-1)&&(Math.abs(D.fPoly[E+1].fX-w)<Math.abs(w-B.fX))){B=D.fPoly[++E]}if(Math.abs(C.grx(B.fX)-x.x)<0.5*this.knot_size){w=B.fX;H=B.fY}else{B=null;if((w<D.fXmin)||(w>D.fXmax)){A=true}}}if(A){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var z=this.draw_g.select(".tooltip_bin"),F=this.lineatt.width+3;if(z.empty()){z=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",F).style("fill","none").call(this.lineatt.func)}var G={name:this.GetObject().fName,title:this.GetObject().fTitle,x:C.grx(w),y:C.gry(H),color1:this.lineatt.color,lines:[],exact:(B!==null)||(Math.abs(C.gry(H)-x.y)<F)};G.changed=z.property("current_xx")!==w;G.menu=G.exact;G.menu_dist=Math.sqrt((G.x-x.x)*(G.x-x.x)+(G.y-x.y)*(G.y-x.y));if(G.changed){z.attr("cx",Math.round(G.x)).attr("cy",Math.round(G.y)).property("current_xx",w)}var y=this.GetTipName();if(y.length>0){G.lines.push(y)}G.lines.push("x = "+C.AxisAsText("x",w));G.lines.push("y = "+C.AxisAsText("y",H));if(B!==null){G.lines.push("knot = "+E);G.lines.push("B = "+d.FFormat(B.fB,d.gStyle.fStatFormat));G.lines.push("C = "+d.FFormat(B.fC,d.gStyle.fStatFormat));G.lines.push("D = "+d.FFormat(B.fD,d.gStyle.fStatFormat));if((B.fE!==undefined)&&(B.fF!==undefined)){G.lines.push("E = "+d.FFormat(B.fE,d.gStyle.fStatFormat));G.lines.push("F = "+d.FFormat(B.fF,d.gStyle.fStatFormat))}}return G};c.prototype.Redraw=function(){var E=this.frame_width(),M=this.frame_height(),L=this.GetObject(),C=this.frame_painter(),O=this.GetTipName("\n");this.CreateG(true);this.knot_size=5;this.createAttLine({attr:L});if(this.options.Line||this.options.Curve){var D=Math.max(10,L.fNpx);var F=Math.max(C.scale_xmin,L.fXmin),I=Math.min(C.scale_xmax,L.fXmax),N=this.FindX(F),K=[];if(C.logx){F=Math.log(F);I=Math.log(I)}for(var J=0;J<D;++J){var A=F+(I-F)/D*(J-1);if(C.logx){A=Math.exp(A)}while((N<L.fNp-1)&&(A>L.fPoly[N+1].fX)){++N}var H=this.Eval(L.fPoly[N],A);K.push({x:A,y:H,grx:C.grx(A),gry:C.gry(H)})}var B=M;if((C.hmin!==undefined)&&(C.hmin>=0)){B=Math.round(C.gry(0));if((B>M)||(B<0)){B=M}}var G=d.Painter.BuildSvgPath("bezier",K,B,2);this.draw_g.append("svg:path").attr("class","line").attr("d",G.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){var G="";this.createAttMarker({attr:L});this.markeratt.reset_pos();this.knot_size=this.markeratt.GetFullSize();for(var J=0;J<L.fPoly.length;J++){var x=L.fPoly[J],z=C.grx(x.fX);if((z>-this.knot_size)&&(z<E+this.knot_size)){var y=C.gry(x.fY);if((y>-this.knot_size)&&(y<M+this.knot_size)){G+=this.markeratt.create(z,y)}}}if(G){this.draw_g.append("svg:path").attr("d",G).call(this.markeratt.func)}}};c.prototype.CanZoomIn=function(y,x,w){if(y!=="x"){return false}var z=this.GetObject();if(!z){return false}return true};c.prototype.DecodeOptions=function(w){var x=new d.DrawOptions(w);if(!this.options){this.options={}}d.extend(this.options,{Same:x.check("SAME"),Line:x.check("L"),Curve:x.check("C"),Mark:x.check("P")});this.OptionsStore(w)};c.prototype.FirstDraw=function(){this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};d.Painter.drawSpline=function(A,z,y){var w=new c(z);w.SetDivId(A,-1);w.DecodeOptions(y);if(!w.main_painter()){if(w.options.Same){console.warn("TSpline painter requires histogram to be drawn");return null}var x=w.CreateDummyHisto();d.draw(A,x,"AXIS",w.FirstDraw.bind(w));return w}return w.FirstDraw()};function t(w){d.TObjectPainter.call(this,w)}t.prototype=Object.create(d.TObjectPainter.prototype);t.prototype.Redraw=function(){if(this.step===undefined){this.StartDrawing(false)}};t.prototype.DecodeOptions=function(w){var x=new d.DrawOptions(w||"REPEAT");if(!this.options){this.options={}}d.extend(this.options,{once:x.check("ONCE"),repeat:x.check("REPEAT"),first:x.check("FIRST")});this.OptionsStore(w)};t.prototype.DrawPrimitives=function(y,A,x){if(y===0){this._doing_primitives=true}var w=this.GetObject().fSteps.arr[this.step];while(true){if(x){x.$grtimeid=this.selfid}if(!w||(y>=w.arr.length)){delete this._doing_primitives;return d.CallBack(A)}var z={func:this.DrawPrimitives.bind(this,y+1,A)};x=d.draw(this.divid,w.arr[y],w.opt[y],z);if(!z.completed){return}y++}};t.prototype.Selector=function(w){return w&&(w.$grtimeid===this.selfid)};t.prototype.ContineDrawing=function(){if(!this.options){return}var x=this.GetObject();if(!this.ready_called){this.ready_called=true;this.DrawingReady()}if(this.options.first){delete this.step;return}if(this.wait_animation_frame){delete this.wait_animation_frame;var w=this.pad_painter();if(!w){delete this.step;return}w.CleanPrimitives(this.Selector.bind(this));this.DrawPrimitives(0,this.ContineDrawing.bind(this))}else{if(this.running_timeout){clearTimeout(this.running_timeout);delete this.running_timeout;this.wait_animation_frame=true;requestAnimationFrame(this.ContineDrawing.bind(this))}else{var y=x.fSleepTime;if(!y||(y<100)){y=10}if(++this.step>x.fSteps.arr.length){if(this.options.repeat){this.step=0;y=Math.max(5000,5*y)}else{delete this.step;return}}this.running_timeout=setTimeout(this.ContineDrawing.bind(this),y)}}};t.prototype.StartDrawing=function(w){if(w!==false){this.SetDivId(this.divid)}this.step=0;this.DrawPrimitives(0,this.ContineDrawing.bind(this))};d.Painter.drawGraphTime=function(z,x,y){var w=new t(x);w.SetDivId(z,-1);if(w.main_painter()){console.error("Cannot draw graph time on top of other histograms");return null}if(!x.fFrame){console.error("Frame histogram not exists");return null}w.DecodeOptions(y);if(!x.fFrame.fTitle&&x.fTitle){x.fFrame.fTitle=x.fTitle}w.selfid="grtime"+d.id_counter++;d.draw(z,x.fFrame,"AXIS",w.StartDrawing.bind(w));return w};function j(w){d.TObjectPainter.call(this,w);this.fBoundary="Normal"}j.prototype=Object.create(d.TObjectPainter.prototype);j.prototype.GetEfficiency=function(w){var y=this.GetObject(),x=y.fTotalHistogram.getBinContent(w),z=y.fPassedHistogram.getBinContent(w);return x?z/x:0};j.prototype.Normal=function(z,D,C,w){if(z==0){return w?1:0}var A=(1-C)/2,y=D/z,x=Math.sqrt(y*(1-y)/z),B=d.Math.normal_quantile(1-A,x);if(w){return((y+B)>1)?1:(y+B)}return((y-B)<0)?0:(y-B)};j.prototype.GetEfficiencyErrorLow=function(w){var z=this.GetObject(),y=z.fTotalHistogram.getBinContent(w),A=z.fPassedHistogram.getBinContent(w),x=this.GetEfficiency(w);return x-this[this.fBoundary](y,A,z.fConfLevel,false)};j.prototype.GetEfficiencyErrorUp=function(w){var z=this.GetObject(),y=z.fTotalHistogram.getBinContent(w),A=z.fPassedHistogram.getBinContent(w),x=this.GetEfficiency(w);return this[this.fBoundary](y,A,z.fConfLevel,true)-x};j.prototype.CreateGraph=function(){var w=d.Create("TGraphAsymmErrors");w.fName="eff_graph";return w};j.prototype.FillGraph=function(x,y){var A=this.GetObject(),B=A.fTotalHistogram.fXaxis.fNbins,z=y.toLowerCase(),D=false,w=0;if(z.indexOf("e0")>=0){D=true}for(var C=0;C<B;++C){if(!D&&A.fTotalHistogram.getBinContent(C+1)===0){continue}x.fX[w]=A.fTotalHistogram.fXaxis.GetBinCenter(C+1);x.fY[w]=this.GetEfficiency(C+1);x.fEXlow[w]=A.fTotalHistogram.fXaxis.GetBinCenter(C+1)-A.fTotalHistogram.fXaxis.GetBinLowEdge(C+1);x.fEXhigh[w]=A.fTotalHistogram.fXaxis.GetBinLowEdge(C+2)-A.fTotalHistogram.fXaxis.GetBinCenter(C+1);x.fEYlow[w]=this.GetEfficiencyErrorLow(C+1);x.fEYhigh[w]=this.GetEfficiencyErrorUp(C+1);++w}x.fNpoints=w};d.Painter.drawEfficiency=function(A,z,y){if(!z||!z.fTotalHistogram||(z.fTotalHistogram._typename.indexOf("TH1")!=0)){return null}var w=new j(z);w.options=y;var x=w.CreateGraph();w.FillGraph(x,y);d.draw(A,x,y,function(){w.SetDivId(A);w.DrawingReady()});return w};function p(w){d.TObjectPainter.call(this,w);this.firstpainter=null;this.autorange=false;this.painters=[]}p.prototype=Object.create(d.TObjectPainter.prototype);p.prototype.Cleanup=function(){this.painters=[];d.TObjectPainter.prototype.Cleanup.call(this)};p.prototype.UpdateObject=function(C){if(!this.MatchObjectType(C)){return false}var D=this.GetObject(),x=C.fGraphs;D.fTitle=C.fTitle;var B=false;if(this.firstpainter){var w=C.fHistogram;if(this.autorange&&!w){w=this.ScanGraphsRange(x)}if(this.firstpainter.UpdateObject(w)){B=true}}for(var y=0;y<x.arr.length;++y){if(y<this.painters.length){if(this.painters[y].UpdateObject(x.arr[y])){B=true}}}if(C.fFunctions){for(var y=0;y<C.fFunctions.arr.length;++y){var A=C.fFunctions.arr[y];if(!A||!A._typename||!A.fName){continue}var z=this.FindPainterFor(null,A.fName,A._typename);if(z){z.UpdateObject(A)}}}return B};p.prototype.ComputeGraphRange=function(y,w){if(w.fNpoints==0){return}if(y.first){y.xmin=y.xmax=w.fX[0];y.ymin=y.ymax=w.fY[0];y.first=false}for(var x=0;x<w.fNpoints;++x){y.xmin=Math.min(y.xmin,w.fX[x]);y.xmax=Math.max(y.xmax,w.fX[x]);y.ymin=Math.min(y.ymin,w.fY[x]);y.ymax=Math.max(y.ymax,w.fY[x])}return y};p.prototype.padtoX=function(y,w){if(y.fLogx&&(w<50)){return Math.exp(2.302585092994*w)}return w};p.prototype.ScanGraphsRange=function(F,C,z){var A=this.GetObject(),B,G,L,K,J=0,y=0,I=false,H=false,E=false,x="",w={xmin:0,xmax:0,ymin:0,ymax:0,first:true};if(z){I=z.fLogx;H=z.fLogy;w.xmin=z.fUxmin;w.xmax=z.fUxmax;w.ymin=z.fUymin;w.ymax=z.fUymax;w.first=false}if(C){G=C.fYaxis.fXmin;B=C.fYaxis.fXmax;if(z){J=this.padtoX(z,w.xmin);y=this.padtoX(z,w.xmax)}}else{this.autorange=true;for(var D=0;D<F.arr.length;++D){this.ComputeGraphRange(w,F.arr[D])}if(F.arr[0]&&F.arr[0].fHistogram&&F.arr[0].fHistogram.fXaxis.fTimeDisplay){E=true;x=F.arr[0].fHistogram.fXaxis.fTimeFormat}if(w.xmin==w.xmax){w.xmax+=1}if(w.ymin==w.ymax){w.ymax+=1}L=0.05*(w.xmax-w.xmin);K=0.05*(w.ymax-w.ymin);J=w.xmin-L;y=w.xmax+L;if(H){if(w.ymin<=0){w.ymin=0.001*w.ymax}G=w.ymin/(1+0.5*d.log10(w.ymax/w.ymin));B=w.ymax*(1+0.2*d.log10(w.ymax/w.ymin))}else{G=w.ymin-K;B=w.ymax+K}if(G<0&&w.ymin>=0){G=0}if(B>0&&w.ymax<=0){B=0}}if(J<0&&w.xmin>=0){J=I?0.9*w.xmin:0}if(y>0&&w.xmax<=0){y=I?1.1*w.xmax:0}if(A.fMinimum!=-1111){w.ymin=G=A.fMinimum}if(A.fMaximum!=-1111){w.ymax=B=A.fMaximum}if(G<0&&w.ymin>=0&&H){G=0.9*w.ymin}if(B>0&&w.ymax<=0&&H){B=1.1*w.ymax}if(G<=0&&H){G=0.001*B}if(!H&&G>0&&G<0.05*B){G=0}if(J<=0&&I){J=(y>1000)?1:0.001*y}if(!C){C=d.Create("TH1I");C.fTitle=A.fTitle;C.fXaxis.fXmin=J;C.fXaxis.fXmax=y;C.fXaxis.fTimeDisplay=E;if(E){C.fXaxis.fTimeFormat=x}}C.fYaxis.fXmin=G;C.fYaxis.fXmax=B;return C};p.prototype.DrawAxis=function(y){var x=this.GetObject(),w=this.ScanGraphsRange(x.fGraphs,x.fHistogram,this.root_pad());d.draw(this.divid,w,"AXIS",y)};p.prototype.DrawNextFunction=function(w,y){var x=this.GetObject();if(!x.fFunctions||(w>=x.fFunctions.arr.length)){return d.CallBack(y)}d.draw(this.divid,x.fFunctions.arr[w],x.fFunctions.opt[w],this.DrawNextFunction.bind(this,w+1,y))};p.prototype.DrawNextGraph=function(A,z,B,y){if(B){this.painters.push(B)}var x=this.GetObject().fGraphs;if(A>=x.arr.length){this._pfc=this._plc=this._pmc=false;return this.DrawNextFunction(0,this.DrawingReady.bind(this))}if((A%500===499)&&!y){return setTimeout(this.DrawNextGraph.bind(this,A,z,null,true),0)}if(this._pfc||this._plc||this._pmc){if(!this.pallette&&d.Painter.GetColorPalette){this.palette=d.Painter.GetColorPalette()}if(this.palette){var w=this.palette.calcColor(A,x.arr.length+1);var C=this.add_color(w);if(this._pfc){x.arr[A].fFillColor=C}if(this._plc){x.arr[A].fLineColor=C}if(this._pmc){x.arr[A].fMarkerColor=C}}}d.draw(this.divid,x.arr[A],x.opt[A]||z,this.DrawNextGraph.bind(this,A+1,z))};d.Painter.drawMultiGraph=function(A,z,x){var w=new p(z);w.SetDivId(A,-1);var y=new d.DrawOptions(x);y.check("3D");y.check("FB");w._pfc=y.check("PFC");w._plc=y.check("PLC");w._pmc=y.check("PMC");if(y.check("A")||!w.main_painter()){w.DrawAxis(function(B){w.firstpainter=B;w.SetDivId(A);w.DrawNextGraph(0,y.remain())})}else{w.SetDivId(A);w.DrawNextGraph(0,y.remain())}return w};function a(z,y,x){var w=new d.TObjectPainter(y);w.UpdateObject=function(A){if(!this.MatchObjectType(A)){return false}this.draw_object=A;return true};w.Redraw=function(){var G=this.GetObject(),O=null,W=0,V=null,N=null,I=null;if(!G||!G.fOper){return}this.CreateG();for(var Q=0;Q<G.fOper.arr.length;++Q){var F=G.fOper.opt[Q];switch(F){case"attr":O=G.fOper.arr[Q];V=N=I=null;continue;case"rect":case"box":var T=this.AxisToSvg("x",G.fBuf[W++]),C=this.AxisToSvg("y",G.fBuf[W++]),S=this.AxisToSvg("x",G.fBuf[W++]),B=this.AxisToSvg("y",G.fBuf[W++]);var A=this.draw_g.append("svg:rect").attr("x",Math.min(T,S)).attr("y",Math.min(C,B)).attr("width",Math.abs(S-T)).attr("height",Math.abs(C-B));if(F==="box"){if(!N){N=this.createAttFill(O)}A.call(N.func).style("stroke","none")}else{if(!V){V=new d.TAttLineHandler(O)}A.call(V.func).style("fill","none")}continue;case"line":case"linendc":var P=(F==="linendc"),T=this.AxisToSvg("x",G.fBuf[W++],P),C=this.AxisToSvg("y",G.fBuf[W++],P),S=this.AxisToSvg("x",G.fBuf[W++],P),B=this.AxisToSvg("y",G.fBuf[W++],P);if(!V){V=new d.TAttLineHandler(O)}this.draw_g.append("svg:line").attr("x1",T).attr("y1",C).attr("x2",S).attr("y2",B).call(V.func);continue;case"polyline":case"polylinendc":case"fillarea":case"fillareandc":var L=parseInt(G.fOper.arr[Q].fString),R="",P=(F.indexOf("ndc")>0);for(var M=0;M<L;++M){R+=((M>0)?"L":"M")+this.AxisToSvg("x",G.fBuf[W++],P)+","+this.AxisToSvg("y",G.fBuf[W++],P)}if(F.indexOf("fillarea")==0){R+="Z"}var K=this.draw_g.append("svg:path").attr("d",R);if(F.indexOf("fillarea")==0){if(!N){N=this.createAttFill(O)}K.call(N.func).attr("stroke","none")}else{if(!V){V=new d.TAttLineHandler(O)}K.call(V.func).attr("fill","none")}continue;case"polymarker":var L=parseInt(G.fOper.arr[Q].fString),R="";if(!I){I=new d.TAttMarkerHandler(O)}I.reset_pos();for(var M=0;M<L;++M){R+=I.create(this.AxisToSvg("x",G.fBuf[W++],false),this.AxisToSvg("y",G.fBuf[W++],false))}if(R){this.draw_g.append("svg:path").attr("d",R).call(I.func)}continue;case"text":case"textndc":var P=(F==="textndc"),D=this.AxisToSvg("x",G.fBuf[W++],P),J=this.AxisToSvg("y",G.fBuf[W++],P);if(O){var H=(O.fTextSize>1)?O.fTextSize:this.pad_height()*O.fTextSize;var E=this.draw_g.append("svg:g");this.StartTextDrawing(O.fTextFont,H,E);var U=O.fTextAngle;U-=Math.floor(U/360)*360;this.DrawText({align:O.fTextAlign,x:D,y:J,rotate:U,text:G.fOper.arr[Q].fString,color:d.Painter.root_colors[O.fTextColor],latex:0,draw_g:E});this.FinishTextDrawing(E)}continue;default:console.log("unsupported operation",F)}}};w.SetDivId(z);w.options=x;w.Redraw();return w.DrawingReady()}d.Painter.drawASImage=function(A,z,y){var x=new d.TBasePainter();x.SetDivId(A,-1);var w=x.select_main();x.SetDivId(A);return x.DrawingReady()};d.Painter.drawJSImage=function(B,A,z){var x=new d.TBasePainter();x.SetDivId(B,-1);var w=x.select_main();var y=w.append("img").attr("src",A.fName).attr("title",A.fTitle||A.fName);if(z&&z.indexOf("scale")>=0){y.style("width","100%").style("height","100%")}else{if(z&&z.indexOf("center")>=0){w.style("position","relative");y.attr("style","margin: 0; position: absolute;  top: 50%; left: 50%; transform: translate(-50%, -50%);")}}x.SetDivId(B);return x.DrawingReady()};d.Painter.CreateBranchItem=function(y,D,F,z){if(!y||!D){return false}var C=D.fBranches?D.fBranches.arr.length:0,w=D.fLeaves?D.fLeaves.arr.length:0;function B(G){var H=G.indexOf("[");if(H>0){G=G.substr(0,H)}if(z&&G.indexOf(z.fName)==0){G=G.substr(z.fName.length);if(G[0]==="."){G=G.substr(1)}}return G}D.$tree=F;var E={_name:B(D.fName),_kind:"ROOT."+D._typename,_title:D.fTitle,_obj:D};if(!y._childs){y._childs=[]}y._childs.push(E);if(D._typename==="TBranchElement"){E._title+=" from "+D.fClassName+";"+D.fClassVersion}if(C>0){E._more=true;E._expand=function(H,G){if(!G){return false}if(!H._childs){H._childs=[]}if(G.fLeaves&&(G.fLeaves.arr.length===1)&&((G.fType===d.BranchType.kClonesNode)||(G.fType===d.BranchType.kSTLNode))){G.fLeaves.arr[0].$branch=G;H._childs.push({_name:"@size",_title:"container size",_kind:"ROOT.TLeafElement",_icon:"img_leaf",_obj:G.fLeaves.arr[0],_more:false})}for(var L=0;L<G.fBranches.arr.length;++L){d.Painter.CreateBranchItem(H,G.fBranches.arr[L],G.$tree,G)}var K=d.IO.GetBranchObjectClass(G,G.$tree,true),I=K?d.getMethods(K):null;if(I&&(G.fBranches.arr.length>0)){for(var J in I){if(typeof I[J]!=="function"){continue}var M=I[J].toString();if((M.indexOf("return")>0)&&(M.indexOf("function ()")==0)){H._childs.push({_name:J+"()",_title:"function "+J+" of class "+K,_kind:"ROOT.TBranchFunc",_obj:{_typename:"TBranchFunc",branch:G,func:J},_more:false})}}}return true};return true}else{if(w===1){E._icon="img_leaf";E._more=false}else{if(w>1){E._childs=[];for(var A=0;A<w;++A){D.fLeaves.arr[A].$branch=D;var x={_name:B(D.fLeaves.arr[A].fName),_kind:"ROOT."+D.fLeaves.arr[A]._typename,_obj:D.fLeaves.arr[A]};E._childs.push(x)}}}}return true};d.Painter.TreeHierarchy=function(x,y){if(y._typename!="TTree"&&y._typename!="TNtuple"&&y._typename!="TNtupleD"){return false}x._childs=[];x._tree=y;for(var w=0;w<y.fBranches.arr.length;++w){d.Painter.CreateBranchItem(x,y.fBranches.arr[w],y)}return true};d.Painter.drawTree=function(C,A,z){var x=new d.TObjectPainter(A),w=A,y=z;if(A._typename=="TBranchFunc"){y={expr:"."+A.func+"()",branch:A.branch};if(z&&z.indexOf("dump")==0){y.expr+=">>"+z}else{if(z){y.expr+=z}}w=A.branch.$tree}else{if(A.$branch){y={expr:"."+A.fName+(z||""),branch:A.$branch};if((y.branch.fType===d.BranchType.kClonesNode)||(y.branch.fType===d.BranchType.kSTLNode)){y.expr=z;y.direct_branch=true}w=A.$branch.$tree}else{if(A.$tree){if(!z&&A.fStreamerType&&(A.fStreamerType!==d.IO.kTString)&&(A.fStreamerType>=d.IO.kObject)&&(A.fStreamerType<=d.IO.kAnyP)){z="dump"}y={expr:z,branch:A};w=A.$tree}else{if((y==="player")||!y){d.AssertPrerequisites("jq2d",function(){d.CreateTreePlayer(x);x.ConfigureTree(w);x.Show(C);x.DrawingReady()});return x}if(typeof y==="string"){y={expr:y}}}}}if(!w){console.error("No TTree object available for TTree::Draw");return x.DrawingReady()}var B=x.DrawingReady.bind(x);x._return_res_painter=true;d.cleanup(C);w.Draw(y,function(E,D,G){var F="";if(!y.player){F=C}else{if(y.create_player===2){F=x.drawid}}if(F){return d.redraw(F,E,D,G?null:B)}if(y.create_player===1){y.player_intermediate=G;return}y.player_create=1;y.player_intermediate=G;d.AssertPrerequisites("jq2d",function(){d.CreateTreePlayer(x);x.ConfigureTree(w);x.Show(C,y);y.create_player=2;d.redraw(x.drawid,E,D,y.player_intermediate?null:B);x.SetItemName("TreePlayer")})});return x};d.Painter.drawText=q;d.Painter.drawLine=o;d.Painter.drawPolyLine=k;d.Painter.drawArrow=f;d.Painter.drawEllipse=n;d.Painter.drawPie=m;d.Painter.drawBox=l;d.Painter.drawMarker=h;d.Painter.drawPolyMarker=s;d.Painter.drawWebPainting=a;d.Painter.drawRooPlot=g;d.Painter.drawGraph=e;d.TF1Painter=v;d.TGraphPainter=b;d.TGraphPolarPainter=i;d.TMultiGraphPainter=p;d.TSplinePainter=c;return d}));