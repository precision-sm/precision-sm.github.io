(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.v6.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.v6.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.v6.js")}a(JSROOT,d3)}}}(function(b,j){b.sources.push("v6");b.WebSnapIds={kNone:0,kObject:1,kSVG:2,kSubPad:3,kSpecial:4};function i(l,k){b.TObjectPainter.call(this,l);this.embedded=k;this.name="yaxis";this.kind="normal";this.func=null;this.order=0;this.full_min=0;this.full_max=1;this.scale_min=0;this.scale_max=1;this.ticks=[];this.invert_side=false;this.lbls_both_sides=false}i.prototype=Object.create(b.TObjectPainter.prototype);i.prototype.Cleanup=function(){this.ticks=[];this.func=null;delete this.format;b.TObjectPainter.prototype.Cleanup.call(this)};i.prototype.SetAxisConfig=function(m,o,p,n,l,k,q){this.name=m;this.kind=o;this.func=p;this.full_min=n;this.full_max=l;this.scale_min=k;this.scale_max=q};i.prototype.format10Exp=function(k,o){var m="";if(o){o=Math.round(o/Math.pow(10,k));if((o!=0)&&(o!=1)){m=o.toString()+(b.gStyle.Latex?"#times":"x")}}m+="10";if(b.gStyle.Latex>1){return m+"^{"+k+"}"}var l={"0":"\u2070","1":"\xB9","2":"\xB2","3":"\xB3","4":"\u2074","5":"\u2075","6":"\u2076","7":"\u2077","8":"\u2078","9":"\u2079","-":"\u207B"};var p=k.toString();for(var q=0;q<p.length;++q){m+=l[p[q]]}return m};i.prototype.CreateFormatFuncs=function(){var m=this.GetObject(),l=(m&&m._typename==="TGaxis");delete this.format;var q=508;if(l){q=m.fNdiv}else{if(m){q=Math.max(m.fNdivisions,4)}}this.nticks=q%100;this.nticks2=(q%10000-this.nticks)/100;this.nticks3=Math.floor(q/10000);if(m&&!l&&(this.nticks>7)){this.nticks=7}var n=Math.abs(this.func.range()[1]-this.func.range()[0]);if(n<=0){n=100}if(this.kind=="time"){if(this.nticks>8){this.nticks=8}var k=this.scale_max-this.scale_min,p=b.Painter.getTimeFormat(m),o=b.Painter.chooseTimeFormat(k/n,false);if((p.length==0)||(k<0.1*(this.full_max-this.full_min))){p=b.Painter.chooseTimeFormat(k/this.nticks,true)}this.tfunc1=this.tfunc2=j.timeFormat(p);if(o!==p){this.tfunc2=j.timeFormat(o)}this.format=function(s,r){return r?this.tfunc1(s):this.tfunc2(s)}}else{if(this.kind=="log"){if(this.nticks2>1){this.nticks*=this.nticks2;this.nticks2=1}this.noexp=m?m.TestBit(b.EAxisBits.kNoExponent):false;if((this.scale_max<300)&&(this.scale_min>0.3)){this.noexp=true}this.moreloglabels=m?m.TestBit(b.EAxisBits.kMoreLogLabels):false;this.format=function(w,r,u){var v=parseFloat(w),t=Math.round(v);if(!r){return((t===v)&&(Math.abs(t)<1000000000))?t.toString():b.FFormat(v,u||b.gStyle.fStatFormat)}if(v<=0){return null}var s=b.log10(v);if(this.moreloglabels||(Math.abs(s-Math.round(s))<0.001)){if(!this.noexp&&!u){return this.format10Exp(Math.floor(s+0.01),v)}return(s<0)?v.toFixed(Math.round(-s+0.5)):v.toFixed(0)}return null}}else{if(this.kind=="labels"){this.nticks=50;var k=this.scale_max-this.scale_min;if(this.nticks>k){this.nticks=Math.round(k)}this.regular_labels=true;if(m&&m.fNbins&&m.fLabels){if((m.fNbins!=Math.round(m.fXmax-m.fXmin))||(m.fXmin!=0)||(m.fXmax!=m.fNbins)){this.regular_labels=false}}this.nticks2=1;this.axis=m;this.format=function(u){var t=parseFloat(u);if(!this.regular_labels){t=(t-this.axis.fXmin)/(this.axis.fXmax-this.axis.fXmin)*this.axis.fNbins}t=Math.round(t);if((t<0)||(t>=this.axis.fNbins)){return null}for(var s=0;s<this.axis.fLabels.arr.length;++s){var r=this.axis.fLabels.arr[s];if(r.fUniqueID===t+1){return r.fString}}return null}}else{this.order=0;this.ndig=0;this.format=function(u,s,r){var t=parseFloat(u);if(s&&this.order){t=t/Math.pow(10,this.order)}if(t===Math.round(t)){return(Math.abs(t)<1000000000)?t.toFixed(0):t.toExponential(4)}if(s){return(this.ndig>10)?t.toExponential(this.ndig-11):t.toFixed(this.ndig)}return b.FFormat(t,r||b.gStyle.fStatFormat)}}}}};i.prototype.ProduceTicks=function(p,k){if(!this.noticksopt){return this.func.ticks(p*(k||1))}if(k){p=(p-1)*k}var m=this.func.domain(),l=[];for(var o=0;o<=p;++o){l.push((m[0]*(p-o)+m[1]*o)/p)}return l};i.prototype.CreateTicks=function(s,z,q,G){if(q&&this.nticks&&(this.kind=="normal")){this.noticksopt=true}var E={nminor:0,nmiddle:0,nmajor:0,func:this.func};E.minor=E.middle=E.major=this.ProduceTicks(this.nticks);if(s){var J=E.major,F=(this.scale_max-this.scale_min)*0.00001;if(J[0]>this.scale_min+F){J.unshift(this.scale_min)}if(J[J.length-1]<this.scale_max-F){J.push(this.scale_max)}return J}if((this.kind=="labels")&&!this.regular_labels){E.lbl_pos=[];for(var w=0;w<this.axis.fNbins;++w){var r=this.axis.fXmin+w/this.axis.fNbins*(this.axis.fXmax-this.axis.fXmin);if((r>=this.scale_min)&&(r<this.scale_max)){E.lbl_pos.push(r)}}}if(this.nticks2>1){E.minor=E.middle=this.ProduceTicks(E.major.length,this.nticks2);var o=Math.abs(this.func.range()[1]-this.func.range()[0]);if((E.middle.length<=E.major.length)||(E.middle.length>o/3.5)){E.minor=E.middle=E.major}else{if((this.nticks3>1)&&(this.kind!=="log")){E.minor=this.ProduceTicks(E.middle.length,this.nticks3);if((E.minor.length<=E.middle.length)||(E.minor.length>o/1.7)){E.minor=E.middle}}}}E.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};E.next=function(n){if(this.nminor>=this.minor.length){return false}this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);if(n){this.grpos=Math.round(this.grpos)}this.kind=3;if((this.nmiddle<this.middle.length)&&(Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1)){this.nmiddle++;this.kind=2}if((this.nmajor<this.major.length)&&(Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1)){this.nmajor++;this.kind=1}return true};E.last_major=function(){return(this.kind!==1)?false:this.nmajor==this.major.length};E.next_major_grpos=function(){if(this.nmajor>=this.major.length){return null}return this.func(this.major[this.nmajor])};this.order=0;this.ndig=0;if((this.kind=="normal")&&(E.major.length>0)){var y=0,p=0;if(!z){var l=Math.max(Math.abs(E.major[0]),Math.abs(E.major[E.major.length-1])),I=Math.min(Math.abs(E.major[0]),Math.abs(E.major[E.major.length-1])),u=(l>0)?Math.round(b.log10(l)/3)*3:0,t=(I>0)?Math.round(b.log10(I)/3)*3:0;if(l||I){y=Math.max(u,t)+3;p=Math.min(u,t)-3}}var m=0,D=this.ndig,k=10000000000;for(var B=p;B<=y;B+=3){this.order=B;this.ndig=0;var v=[],H=0,A=0;while(H<E.major.length){var C=this.format(E.major[H],true);if(v.indexOf(C)<0){v.push(C);A+=C.length;H++;continue}if(++this.ndig>15){break}v=[];H=0;A=0}if(!B&&(this.ndig<4)){A-=(E.major.length*2+3)}if(A<k){k=A;m=this.order;D=this.ndig}}this.order=m;this.ndig=D;if(G){if(this.order){console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable")}if(this.ndig){console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required")}this.ndig=0;this.order=0}}return E};i.prototype.IsCenterLabels=function(){if(this.kind==="labels"){return true}if(this.kind==="log"){return false}var k=this.GetObject();return k&&k.TestBit(b.EAxisBits.kCenterLabels)};i.prototype.AddTitleDrag=function(n,m,v,s,p){if(!b.gStyle.MoveResize){return}var l=this,o=null,q="",w,z,y,u,t,k,x,r;if(b._test_d3_===3){q="drag";w=j.behavior.drag().origin(Object)}else{w=j.drag().subject(Object)}w.on(q+"start",function(){j.event.sourceEvent.preventDefault();j.event.sourceEvent.stopPropagation();var B=n.node().getBBox(),A=l.GetObject();u=z=n.property("shift_x");t=y=n.property("shift_y");k=m?(z>0):(y>0);if(A.TestBit(b.EAxisBits.kCenterTitle)){r=(s===m)?p:0}else{r=Math.round(p/2)}o=n.append("rect").classed("zoom",true).attr("x",B.x).attr("y",B.y).attr("width",B.width).attr("height",B.height).style("cursor","move")}).on("drag",function(){if(!o){return}j.event.sourceEvent.preventDefault();j.event.sourceEvent.stopPropagation();z+=j.event.dx;y+=j.event.dy;var B=n.property("shift_x"),A=n.property("shift_y");if(m){B=z;if(Math.abs(y-A)>Math.abs(y-r)){A=r}}else{A=y;if(Math.abs(z-B)>Math.abs(z-r)){B=r}}if(k===(m?(B>0):(A>0))){u=B;t=A;n.attr("transform","translate("+u+","+t+")")}}).on(q+"end",function(){if(!o){return}j.event.sourceEvent.preventDefault();j.event.sourceEvent.stopPropagation();n.property("shift_x",u).property("shift_y",t);var A=l.GetObject();A.fTitleOffset=(m?u:t)/v;if((m?t:u)===r){A.InvertBit(b.EAxisBits.kCenterTitle)}o.remove();o=null});n.style("cursor","move").call(w)};i.prototype.DrawAxis=function(I,Q,P,V,ar,m,ah,aK,af){var s=this.GetObject(),aq="",aH=(s&&s._typename==="TGaxis"),ae=Q,M=0.03,S=100,q=true,J=this.pad_width()||10,O=this.pad_height()||10;this.vertical=I;function K(w,r){return(w&&!r)||(!w&&r)}if(!ah){ah=0}else{if(this.invert_side){ah=-ah}}if(aH){this.createAttLine({attr:s});q=s.fLineColor!=0;aq=s.fChopt;M=s.fTickSize;S=(I?1.7*V:0.6*P)}else{this.createAttLine({color:s.fAxisColor,width:1,style:1});aq=K(I,this.invert_side)?"-S":"+S";M=s.fTickLength;S=(I?J:O)}if(!aH||(this.name==="zaxis")){ae=Q.select("."+this.name+"_container");if(ae.empty()){ae=Q.append("svg:g").attr("class",this.name+"_container")}else{ae.selectAll("*").remove()}}if(!aK&&q){ae.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",I?0:P).attr("y2",I?V:0).call(this.lineatt.func)}ae.attr("transform",ar||null);var aE=1,ay=0,Y=Math.min(J,O),N=(aq.indexOf("+")>=0),k=(aq.indexOf("-")>=0),al=(aq.indexOf("S")>=0),ai=(aq.indexOf("Y")>=0),H=(aq.indexOf("0")>=0),aa=(aq.indexOf("O")>=0),l=(aq.indexOf("U")>=0),am=(aq.indexOf("N")>=0),F=(aq.indexOf("I")>=0),ap=s.TestBit(b.EAxisBits.kNoExponent);if(aH&&s.TestBit(b.EAxisBits.kTickPlus)){N=true}if(aH&&s.TestBit(b.EAxisBits.kTickMinus)){k=true}if(N&&k){aE=1;ay=1}else{if(k){aE=K(m,I)?1:-1}else{if(N){aE=K(m,I)?-1:1}}}M=Math.round((al?M:0.03)*S);if(this.max_tick_size&&(M>this.max_tick_size)){M=this.max_tick_size}this.CreateFormatFuncs();var T="",ax="",x=0,C=0;this.ticks=[];var ab=this.CreateTicks(false,ap,am,F);while(ab.next(true)){var av=Math.round(M/4),at=0;if(ab.kind<3){av=Math.round(M/2)}if(ab.kind==1){if(!("format" in this)||(this.format(ab.tick,true)!==null)){av=M}this.ticks.push(ab.grpos)}if(ay>0){at=-av}else{if(aE<0){at=-av;av=0}else{at=0}}if(T.length==0){T=I?("M"+av+","+ab.grpos):("M"+ab.grpos+","+(-av));ax=I?("M"+(ah-av)+","+ab.grpos):("M"+ab.grpos+","+(ah+av))}else{T+=I?("m"+(av-C)+","+(ab.grpos-x)):("m"+(ab.grpos-x)+","+(C-av));ax+=I?("m"+(C-av)+","+(ab.grpos-x)):("m"+(ab.grpos-x)+","+(av-C))}T+=I?("h"+(at-av)):("v"+(av-at));ax+=I?("h"+(av-at)):("v"+(at-av));x=ab.grpos;C=at}if((T.length>0)&&!aK&&q){ae.append("svg:path").attr("d",T).call(this.lineatt.func)}if((ah!==0)&&(ax.length>0)&&!aK&&q){ae.append("svg:path").attr("d",ax).call(this.lineatt.func)}var D=Math.round((s.fLabelSize<1)?s.fLabelSize*Y:s.fLabelSize);if((D<=0)||(Math.abs(s.fLabelOffset)>1.1)){l=true}if(!aK&&!l){var ao=this.get_color(s.fLabelColor),aw=Math.round(s.fLabelOffset*Y),ag=this.IsCenterLabels(),z=s.TestBit(b.EAxisBits.kLabelsVert),aJ=1,B=0,an=false,Z=null,ak=[ae.append("svg:g").attr("class","axis_labels")],p=ab.lbl_pos||ab.major;if(this.lbls_both_sides){ak.push(ae.append("svg:g").attr("class","axis_labels").attr("transform",I?"translate("+P+",0)":"translate(0,"+(-V)+")"))}for(var L=0;L<ak.length;++L){if(L>0){aE=-aE}var x=0,aB=I?-aw*aE:(aw+2)*aE+ay*M;Z=b.Painter.getFontDetails(s.fLabelFont,D);this.StartTextDrawing(Z,"font",ak[L]);for(var E=0;E<p.length;++E){var v=this.format(p[E],true);if(v===null){continue}var au=Math.round(this.func(p[E])),ad=(E>0)?Math.abs(Math.round(au-this.func(p[E-1]))):0,y=(E<p.length-1)?Math.abs(Math.round(this.func(p[E+1])-au)):0;if(ag){var U=y||ad;au=Math.round(au-(I?0.5*U:-0.5*U));if((au<-5)||(au>(I?V:P)+5)){continue}}var az={text:v,color:ao,latex:1,draw_g:ak[L]};B=Math.max(B,v.length);if(I){az.x=aB;az.y=au;az.align=z?((aE<0)?23:20):((aE<0)?12:32)}else{az.x=au;az.y=aB;az.align=z?((aE<0)?12:32):((aE<0)?20:23)}if(z){az.rotate=270}var aI=this.DrawText(az);if(aI&&((!I&&!z)||(I&&z))&&(this.kind!="log")){var n=ad*0.45+y*0.45;if(!ad){n=0.9*y}else{if(!y){n=0.9*ad}}aJ=Math.min(aJ,n/aI)}else{if(I&&af&&!L&&(af-aw>20)&&(aI>af-aw)){aJ=Math.min(aJ,(af-aw)/aI)}}if(x&&(au!=x)&&((I&&!z)||(!I&&z))){var A=Math.abs(au-x);aJ=Math.min(aJ,0.9*A/D)}x=au}if(this.order){this.DrawText({color:ao,x:I?aE*5:P+5,y:this.has_obstacle?aB:(I?-3:-3*aE),align:I?((aE<0)?30:10):(K(this.has_obstacle,(aE<0))?13:10),latex:1,text:"#times"+this.format10Exp(this.order),draw_g:ak[L]})}}if((aJ>0.01)&&(aJ<0.7)&&!I&&!z&&(B>5)&&!this.lbls_both_sides){an=true;aJ*=3}for(var L=0;L<ak.length;++L){if((aJ>0.01)&&(aJ<1)){this.TextScaleFactor(1/aJ,ak[L])}this.FinishTextDrawing(ak[L]);if(an){ak[L].selectAll("text").each(function(){var r=j.select(this),w=r.attr("transform");r.attr("transform",w+" rotate(25)").style("text-anchor","start")})}}if(ak.length>1){aE=-aE}if(Z){D=Z.size}}if(b.gStyle.Zooming&&!this.disable_zooming){var R=ae.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair");if(I){R.attr("x",(aE>0)?(-2*D-3):3).attr("y",0).attr("width",2*D+3).attr("height",V)}else{R.attr("x",0).attr("y",(aE>0)?0:-D-3).attr("width",P).attr("height",D+3)}}if((s.fTitle.length>0)&&!aK){var W=ae.append("svg:g").attr("class","axis_title"),aj=(s.fTitleSize>=1)?s.fTitleSize:Math.round(s.fTitleSize*Y),o=1.6*(s.fTitleSize<1?s.fTitleSize:s.fTitleSize/(this.pad_height("")||10)),ac=s.TestBit(b.EAxisBits.kCenterTitle),X=s.TestBit(b.EAxisBits.kRotateTitle)?-1:1,t=this.get_color(aH?s.fTextColor:s.fTitleColor),aD=0,aC=0;this.StartTextDrawing(s.fTitleFont,aj,W);var G=((X<0)&&!m)||((X>=0)&&m);if(I){o*=-aE*J;aD=Math.round(o*s.fTitleOffset);if((this.name=="zaxis")&&aH&&("getBoundingClientRect" in ae.node())){var u=ae.node().getBoundingClientRect();if(aD<u.width-M){aD=Math.round(u.width-M)}}aC=Math.round(ac?V/2:(m?V:0));this.DrawText({align:(ac?"middle":(G?"begin":"end"))+";middle",rotate:(X<0)?90:270,text:s.fTitle,color:t,draw_g:W})}else{o*=aE*O;aD=Math.round(ac?P/2:(m?0:P));aC=Math.round(o*s.fTitleOffset);this.DrawText({align:(ac?"middle":(G?"begin":"end"))+";middle",rotate:(X<0)?180:0,text:s.fTitle,color:t,draw_g:W})}var aA=null;if(I&&(s.fTitleOffset==0)&&("getBoundingClientRect" in ae.node())){aA=ae.node().getBoundingClientRect()}this.FinishTextDrawing(W,function(){if(aA){var r=W.node().getBoundingClientRect();aD=(aE>0)?Math.round(aA.left-r.right-aj*0.3):Math.round(aA.right-r.left+aj*0.3)}W.attr("transform","translate("+aD+","+aC+")").property("shift_x",aD).property("shift_y",aC)});this.AddTitleDrag(W,I,o,m,I?V:P)}this.position=0;if(!aK&&("getBoundingClientRect" in ae.node())){var aG=ae.node().getBoundingClientRect(),aF=this.svg_pad().node().getBoundingClientRect();this.position=aG.left-aF.left}};i.prototype.Redraw=function(){var o=this.GetObject(),l=this.AxisToSvg("x",o.fX1,"pad"),z=this.AxisToSvg("y",o.fY1,"pad"),k=this.AxisToSvg("x",o.fX2,"pad"),x=this.AxisToSvg("y",o.fY2,"pad"),A=k-l,s=z-x,p=Math.abs(A)<Math.abs(s),m=null,t=false,n="normal",q=o.fWmin,v=o.fWmax,r=q,y=v;if(o.fChopt.indexOf("t")>=0){m=j.scaleTime();n="time";this.toffset=b.Painter.getTimeOffset(o);r=new Date(this.toffset+q*1000);y=new Date(this.toffset+v*1000)}else{if(o.fChopt.indexOf("G")>=0){m=j.scaleLog();n="log"}else{m=j.scaleLinear();n="normal"}}m.domain([r,y]);if(p){if(s>0){m.range([s,0])}else{var u=z;z=x;x=u;s=-s;t=true;m.range([0,s])}}else{if(A>0){m.range([0,A])}else{var u=l;l=k;k=u;A=-A;t=true;m.range([A,0])}}this.SetAxisConfig(p?"yaxis":"xaxis",n,m,q,v,q,v);this.CreateG();this.DrawAxis(p,this.draw_g,A,s,"translate("+l+","+x+")",t)};b.Painter.drawGaxis=function(n,m,l){var k=new b.TAxisPainter(m,false);k.SetDivId(n);k.disable_zooming=true;k.Redraw();return k.DrawingReady()};function e(k){if(k&&k.$dummy){k=null}b.TooltipHandler.call(this,k);this.zoom_kind=0;this.mode3d=false;this.shrink_frame_left=0;this.x_kind="normal";this.y_kind="normal";this.xmin=this.xmax=0;this.ymin=this.ymax=0;this.axes_drawn=false;this.keys_handler=null;this.projection=0}e.prototype=Object.create(b.TooltipHandler.prototype);e.prototype.frame_painter=function(){return this};e.prototype.GetTipName=function(k){var l=b.TooltipHandler.prototype.GetTipName.call(this)||"TFrame";if(k){l+=k}return l};e.prototype.Shrink=function(l,k){this.fX1NDC+=l;this.fX2NDC-=k};e.prototype.SetLastEventPos=function(k){this.fLastEventPnt=k};e.prototype.GetLastEventPos=function(){return this.fLastEventPnt};e.prototype.ProjectAitoff2xy=function(m,s){var r=Math.PI/180,t=(m/2)*r,u=s*r,k=Math.sqrt(2),p=2*k/Math.PI,n=Math.cos(u),o=Math.sqrt(1+n*Math.cos(t)),q={x:n*Math.sin(t)*2*k/o/p/r,y:Math.sin(u)*k/o/p/r};return q};e.prototype.ProjectMercator2xy=function(m,k){var n=Math.tan((Math.PI/2+k/180*Math.PI)/2);return{x:m,y:Math.log(n)}};e.prototype.ProjectSinusoidal2xy=function(m,k){return{x:m*Math.cos(k/180*Math.PI),y:k}};e.prototype.ProjectParabolic2xy=function(m,k){return{x:m*(2*Math.cos(2*k/180*Math.PI/3)-1),y:180*Math.sin(k/180*Math.PI/3)}};e.prototype.RecalculateRange=function(l){this.projection=l||0;if(!this.projection){return}var k=[];if(this.projection==1){k.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymin));k.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymax));k.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymax));k.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){k.push(this.ProjectAitoff2xy(this.scale_xmin*0.9999,0));k.push(this.ProjectAitoff2xy(this.scale_xmax*0.9999,0))}if(this.scale_xmin<0&&this.scale_xmax>0){k.push(this.ProjectAitoff2xy(0,this.scale_ymin));k.push(this.ProjectAitoff2xy(0,this.scale_ymax))}}else{if(this.projection==2){if(this.scale_ymin<=-90||this.scale_ymax>=90){console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax);this.projection=0;return}k.push(this.ProjectMercator2xy(this.scale_xmin,this.scale_ymin));k.push(this.ProjectMercator2xy(this.scale_xmax,this.scale_ymax))}else{if(this.projection==3){k.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymin));k.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymax));k.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymax));k.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){k.push(this.ProjectSinusoidal2xy(this.scale_xmin,0));k.push(this.ProjectSinusoidal2xy(this.scale_xmax,0))}if(this.scale_xmin<0&&this.scale_xmax>0){k.push(this.ProjectSinusoidal2xy(0,this.scale_ymin));k.push(this.ProjectSinusoidal2xy(0,this.scale_ymax))}}else{if(this.projection==4){k.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymin));k.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymax));k.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymax));k.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){k.push(this.ProjectParabolic2xy(this.scale_xmin,0));k.push(this.ProjectParabolic2xy(this.scale_xmax,0))}if(this.scale_xmin<0&&this.scale_xmax>0){k.push(this.ProjectParabolic2xy(0,this.scale_ymin));k.push(this.ProjectParabolic2xy(0,this.scale_ymax))}}}}}this.original_xmin=this.scale_xmin;this.original_xmax=this.scale_xmax;this.original_ymin=this.scale_ymin;this.original_ymax=this.scale_ymax;this.scale_xmin=this.scale_xmax=k[0].x;this.scale_ymin=this.scale_ymax=k[0].y;for(var m=1;m<k.length;++m){this.scale_xmin=Math.min(this.scale_xmin,k[m].x);this.scale_xmax=Math.max(this.scale_xmax,k[m].x);this.scale_ymin=Math.min(this.scale_ymin,k[m].y);this.scale_ymax=Math.max(this.scale_ymax,k[m].y)}};e.prototype.SetAxesRanges=function(q,k,m,p,r,l,o,n,s){this.xaxis=q;this.xmin=k;this.xmax=m;this.yaxis=p;this.ymin=r;this.ymax=l;this.zaxis=o;this.zmin=n;this.zmax=s};e.prototype.GetAxis=function(k){switch(k){case"x":return this.xaxis;case"y":return this.yaxis;case"z":return this.zaxis}return null};e.prototype.CheckAxisZoom=function(k){var l=this.GetAxis(k);if(l&&l.TestBit(b.EAxisBits.kAxisRange)){if((l.fFirst!==l.fLast)&&((l.fFirst>1)||(l.fLast<l.fNbins))){this["zoom_"+k+"min"]=l.fFirst>1?l.GetBinLowEdge(l.fFirst):l.fXmin;this["zoom_"+k+"max"]=l.fLast<l.fNbins?l.GetBinLowEdge(l.fLast+1):l.fXmax;l.InvertBit(b.EAxisBits.kAxisRange);l.fFirst=1;l.fLast=l.fNbins}}};e.prototype.CheckPadUserRange=function(m,k){if(!m){return}var q=m["fU"+k+"min"],l=m["fU"+k+"max"],t=1e-7;if(k=="x"){if((Math.abs(m.fX1)>t)||(Math.abs(m.fX2-1)>t)){var s=m.fX2-m.fX1;q=m.fX1+s*m.fLeftMargin;l=m.fX2-s*m.fRightMargin}}else{if((Math.abs(m.fY1)>t)||(Math.abs(m.fY2-1)>t)){var r=m.fY2-m.fY1;q=m.fY1+r*m.fBottomMargin;l=m.fY2-r*m.fTopMargin}}if((q>=l)||(Math.abs(q)<t&&Math.abs(l-1)<t)){return}if(m["fLog"+k]>0){q=Math.exp(q*Math.log(10));l=Math.exp(l*Math.log(10))}var o=k;if(this.swap_xy){o=(k=="x")?"y":"x"}var n="scale_"+o+"min",p="scale_"+o+"max";var t=(this[p]-this[n])*1e-7;if((Math.abs(q-this[n])>t)||(Math.abs(l-this[p])>t)){this["zoom_"+o+"min"]=q;this["zoom_"+o+"max"]=l}};e.prototype.CreateXY=function(k){this.CleanXY();if(!k){k={}}this.swap_xy=k.swap_xy||false;this.reverse_x=k.reverse_x||false;this.reverse_y=k.reverse_y||false;this.logx=this.logy=false;var s=this.frame_width(),q=this.frame_height(),n=this.root_pad();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;if(k.extra_y_space){var m=this.swap_xy?n.fLogx:n.fLogy;if(m&&(this.scale_ymax>0)){this.scale_ymax=Math.exp(Math.log(this.scale_ymax)*1.1)}else{this.scale_ymax+=(this.scale_ymax-this.scale_ymin)*0.1}}if(k.check_pad_range){this.zoom_xmin=this.zoom_xmax=0;this.zoom_ymin=this.zoom_ymax=0;this.zoom_zmin=this.zoom_zmax=0;this.CheckAxisZoom("x");if(k.ndim&&(k.ndim>1)){this.CheckAxisZoom("y")}if(k.ndim&&(k.ndim>2)){this.CheckAxisZoom("z")}if(k.check_pad_range==="pad_range"){var l=this.canv_painter();if(!l||!l.online_canvas){this.CheckPadUserRange(n,"x");this.CheckPadUserRange(n,"y")}}}if(this.zoom_xmin!=this.zoom_xmax){this.scale_xmin=this.zoom_xmin;this.scale_xmax=this.zoom_xmax}if(this.zoom_ymin!=this.zoom_ymax){this.scale_ymin=this.zoom_ymin;this.scale_ymax=this.zoom_ymax}this.RecalculateRange(k.Proj);if(this.xaxis.fTimeDisplay){this.x_kind="time";this.timeoffsetx=b.Painter.getTimeOffset(this.xaxis);this.ConvertX=function(t){return new Date(this.timeoffsetx+t*1000)};this.RevertX=function(t){return(this.x.invert(t)-this.timeoffsetx)/1000}}else{this.x_kind=!this.xaxis.fLabels?"normal":"labels";this.ConvertX=function(t){return t};this.RevertX=function(t){return this.x.invert(t)}}if(this.x_kind=="time"){this.x=j.scaleTime()}else{if(this.swap_xy?n.fLogy:n.fLogx){this.logx=true;if(this.scale_xmax<=0){this.scale_xmax=0}if((this.scale_xmin<=0)&&this.xaxis&&!this.swap_xy){for(var o=0;o<this.xaxis.fNbins;++o){this.scale_xmin=Math.max(this.scale_xmin,this.xaxis.GetBinLowEdge(o+1));if(this.scale_xmin>0){break}}}if((this.scale_xmin<=0)||(this.scale_xmin>=this.scale_xmax)){this.scale_xmin=this.scale_xmax*0.0001}this.x=j.scaleLog()}else{this.x=j.scaleLinear()}}var r=this.reverse_x?[s,0]:[0,s],p=this.reverse_y?[0,q]:[q,0];this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range(this.swap_xy?p:r);if(this.x_kind=="time"){this.grx=function(t){return this.x(this.ConvertX(t))}}else{if(this.logx){this.grx=function(t){return(t<this.scale_xmin)?(this.swap_xy?this.x.range()[0]+5:-5):this.x(t)}}else{this.grx=this.x}}if(this.yaxis.fTimeDisplay){this.y_kind="time";this.timeoffsety=b.Painter.getTimeOffset(this.yaxis);this.ConvertY=function(t){return new Date(this.timeoffsety+t*1000)};this.RevertY=function(t){return(this.y.invert(t)-this.timeoffsety)/1000}}else{this.y_kind=!this.yaxis.fLabels?"normal":"labels";this.ConvertY=function(t){return t};this.RevertY=function(t){return this.y.invert(t)}}if(this.swap_xy?n.fLogx:n.fLogy){this.logy=true;if(this.scale_ymax<=0){this.scale_ymax=1}else{if((this.zoom_ymin===this.zoom_ymax)&&(k.ndim==1)&&this.draw_content){this.scale_ymax*=1.8}}if((this.scale_ymin<=0)&&this.yaxis&&(k.ndim>1)&&!this.swap_xy){for(var o=0;o<this.yaxis.fNbins;++o){this.scale_ymin=Math.max(this.scale_ymin,this.yaxis.GetBinLowEdge(o+1));if(this.scale_ymin>0){break}}}if((this.scale_ymin<=0)&&(k.ymin_nz)&&(k.ymin_nz<0.01*this.ymax)){this.scale_ymin=0.3*k.ymin_nz}if((this.scale_ymin<=0)||(this.scale_ymin>=this.scale_ymax)){this.scale_ymin=0.0003*this.scale_ymax}this.y=j.scaleLog()}else{if(this.y_kind=="time"){this.y=j.scaleTime()}else{this.y=j.scaleLinear()}}this.y.domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range(this.swap_xy?r:p);if(this.y_kind=="time"){this.gry=function(t){return this.y(this.ConvertY(t))}}else{if(this.logy){this.gry=function(t){return(t<this.scale_ymin)?(this.swap_xy?-5:this.y.range()[0]+5):this.y(t)}}else{this.gry=this.y}}this.SetRootPadRange(n)};e.prototype.SetRootPadRange=function(o,l){if(!o){return}if(l){o.fUxmin=o.fUymin=-0.9;o.fUxmax=o.fUymax=0.9}else{o.fLogx=(this.swap_xy?this.logy:this.logx)?1:0;o.fUxmin=o.fLogx?b.log10(this.scale_xmin):this.scale_xmin;o.fUxmax=o.fLogx?b.log10(this.scale_xmax):this.scale_xmax;o.fLogy=(this.swap_xy?this.logx:this.logy)?1:0;o.fUymin=o.fLogy?b.log10(this.scale_ymin):this.scale_ymin;o.fUymax=o.fLogy?b.log10(this.scale_ymax):this.scale_ymax}var n=o.fUxmax-o.fUxmin,p=1-o.fLeftMargin-o.fRightMargin,k=o.fUymax-o.fUymin,m=1-o.fBottomMargin-o.fTopMargin;if(p<=0){p=0.01}if(m<=0){m=0.01}o.fX1=o.fUxmin-n/p*o.fLeftMargin;o.fX2=o.fUxmax+n/p*o.fRightMargin;o.fY1=o.fUymin-k/m*o.fBottomMargin;o.fY2=o.fUymax+k/m*o.fTopMargin};e.prototype.DrawGrids=function(){var s=this.svg_frame().select(".grid_layer");s.selectAll(".xgrid").remove();s.selectAll(".ygrid").remove();var o=this.root_pad(),q=this.frame_height(),t=this.frame_width(),k,p=b.gStyle.fGridStyle;if((p<0)||(p>=b.Painter.root_line_styles.length)){p=11}if(o&&o.fGridx&&this.x_handle){k="";for(var m=0;m<this.x_handle.ticks.length;++m){if(this.swap_xy){k+="M0,"+this.x_handle.ticks[m]+"h"+t}else{k+="M"+this.x_handle.ticks[m]+",0v"+q}}var l=(b.gStyle.fGridColor>0)?b.gStyle.fGridColor:(this.GetAxis("x")?this.GetAxis("x").fAxisColor:1),r=this.get_color(l)||"black";if(k.length>0){s.append("svg:path").attr("class","xgrid").attr("d",k).style("stroke",r).style("stroke-width",b.gStyle.fGridWidth).style("stroke-dasharray",b.Painter.root_line_styles[p])}}if(o&&o.fGridy&&this.y_handle){k="";for(var m=0;m<this.y_handle.ticks.length;++m){if(this.swap_xy){k+="M"+this.y_handle.ticks[m]+",0v"+q}else{k+="M0,"+this.y_handle.ticks[m]+"h"+t}}var l=(b.gStyle.fGridColor>0)?b.gStyle.fGridColor:(this.GetAxis("y")?this.GetAxis("y").fAxisColor:1),r=this.get_color(l)||"black";if(k.length>0){s.append("svg:path").attr("class","ygrid").attr("d",k).style("stroke",r).style("stroke-width",b.gStyle.fGridWidth).style("stroke-dasharray",b.Painter.root_line_styles[p])}}};e.prototype.AxisAsText=function(k,l){if(k=="x"){if(this.x_kind=="time"){l=this.ConvertX(l)}if(this.x_handle&&("format" in this.x_handle)){return this.x_handle.format(l,false,b.gStyle.XValuesFormat)}}else{if(k=="y"){if(this.y_kind=="time"){l=this.ConvertY(l)}if(this.y_handle&&("format" in this.y_handle)){return this.y_handle.format(l,false,false,b.gStyle.YValuesFormat)}}else{if(this.z_handle&&("format" in this.z_handle)){return this.z_handle.format(l,false,false,b.gStyle.ZValuesFormat)}}}return l.toPrecision(4)};e.prototype.DrawAxes=function(u,l,t,x){this.CleanupAxes();if((this.xmin==this.xmax)||(this.ymin==this.ymax)){return false}if(t===undefined){t=0}var r=this.svg_frame().select(".axis_layer"),v=this.frame_width(),q=this.frame_height(),o=this.root_pad();this.x_handle=new b.TAxisPainter(this.xaxis,true);this.x_handle.SetDivId(this.divid,-1);this.x_handle.pad_name=this.pad_name;this.x_handle.SetAxisConfig("xaxis",(this.logx&&(this.x_kind!=="time"))?"log":this.x_kind,this.x,this.xmin,this.xmax,this.scale_xmin,this.scale_xmax);this.x_handle.invert_side=(t>=10);this.x_handle.lbls_both_sides=!this.x_handle.invert_side&&(o.fTickx>1);this.x_handle.has_obstacle=x;this.y_handle=new b.TAxisPainter(this.yaxis,true);this.y_handle.SetDivId(this.divid,-1);this.y_handle.pad_name=this.pad_name;this.y_handle.SetAxisConfig("yaxis",(this.logy&&this.y_kind!=="time")?"log":this.y_kind,this.y,this.ymin,this.ymax,this.scale_ymin,this.scale_ymax);this.y_handle.invert_side=((t%10)===1);this.y_handle.lbls_both_sides=!this.y_handle.invert_side&&(o.fTicky>1);var s=this.swap_xy?this.y_handle:this.x_handle,k=this.swap_xy?this.x_handle:this.y_handle;if(!l){var n=this.pad_painter();if(n&&n._fast_drawing){l=true}}if(!l){s.DrawAxis(false,r,v,q,s.invert_side?undefined:"translate(0,"+q+")",false,o.fTickx?-q:0,l);k.DrawAxis(true,r,v,q,k.invert_side?"translate("+v+",0)":undefined,false,o.fTicky?v:0,l,k.invert_side?0:this.frame_x());this.DrawGrids()}if(!u&&b.gStyle.CanAdjustFrame&&!l){var p=0,m=k.position;if((-0.2*v<m)&&(m<0)){p=-m/v+0.001;this.shrink_frame_left+=p}else{if((m>0)&&(m<0.3*v)&&(this.shrink_frame_left>0)&&(m/v>this.shrink_frame_left)){p=-this.shrink_frame_left;this.shrink_frame_left=0}}if(p!=0){this.Shrink(p,0);this.Redraw();this.DrawAxes(true)}}this.axes_drawn=true;return true};e.prototype.UpdateAttributes=function(l){var m=this.root_pad(),k=this.GetObject();if((this.fX1NDC===undefined)||(l&&!this.modified_NDC)){if(!m||(m.fLeftMargin===undefined)){b.extend(this,b.gStyle.FrameNDC)}else{b.extend(this,{fX1NDC:m.fLeftMargin,fX2NDC:1-m.fRightMargin,fY1NDC:m.fBottomMargin,fY2NDC:1-m.fTopMargin})}}if(this.fillatt===undefined){if(k){this.createAttFill({attr:k})}else{if(m&&m.fFrameFillColor){this.createAttFill({pattern:m.fFrameFillStyle,color:m.fFrameFillColor})}else{if(m){this.createAttFill({attr:m})}else{this.createAttFill({pattern:1001,color:0})}}}if(!k&&this.fillatt.empty()&&this.pad_painter()&&this.pad_painter().iscan){this.fillatt.SetSolidColor("white")}}if(m&&m.fFrameLineColor!==undefined){this.createAttLine({color:m.fFrameLineColor,width:m.fFrameLineWidth,style:m.fFrameLineStyle})}else{this.createAttLine({attr:k,color:"black"})}};e.prototype.SizeChanged=function(){var k=this.root_pad();if(k){k.fLeftMargin=this.fX1NDC;k.fRightMargin=1-this.fX2NDC;k.fBottomMargin=this.fY1NDC;k.fTopMargin=1-this.fY2NDC;this.SetRootPadRange(k)}this.RedrawPad()};e.prototype.CleanXY=function(){delete this.x;delete this.grx;delete this.ConvertX;delete this.RevertX;delete this.y;delete this.gry;delete this.ConvertY;delete this.RevertY;delete this.z;delete this.grz};e.prototype.CleanupAxes=function(){if(this.x_handle){this.x_handle.Cleanup();delete this.x_handle}if(this.y_handle){this.y_handle.Cleanup();delete this.y_handle}if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}if(this.draw_g){this.draw_g.select(".grid_layer").selectAll("*").remove();this.draw_g.select(".axis_layer").selectAll("*").remove()}this.axes_drawn=false};e.prototype.CleanFrameDrawings=function(){if(typeof this.Create3DScene==="function"){this.Create3DScene(-1)}this.CleanupAxes();this.CleanXY();this.xmin=this.xmax=0;this.ymin=this.ymax=0;this.zmin=this.zmax=0;this.zoom_xmin=this.zoom_xmax=0;this.zoom_ymin=this.zoom_ymax=0;this.zoom_zmin=this.zoom_zmax=0;this.scale_xmin=this.scale_xmax=0;this.scale_ymin=this.scale_ymax=0;this.scale_zmin=this.scale_zmax=0;if(this.draw_g){this.draw_g.select(".main_layer").selectAll("*").remove();this.draw_g.select(".upper_layer").selectAll("*").remove()}this.xaxis=null;this.yaxis=null;this.zaxis=null;if(this.draw_g){this.draw_g.selectAll("*").remove();this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null);this.draw_g.remove()}this.draw_g=null;if(this.keys_handler){window.removeEventListener("keydown",this.keys_handler,false);this.keys_handler=null}};e.prototype.Cleanup=function(){this.CleanFrameDrawings();delete this._click_handler;delete this._dblclick_handler;b.TooltipHandler.prototype.Cleanup.call(this)};e.prototype.Redraw=function(){var z=this.pad_painter();if(z){z.frame_painter_ref=this}if(this.mode3d){return}this.UpdateAttributes();var y=this.pad_width(),v=this.pad_height(),t=Math.round(y*this.fX1NDC),u=Math.round(y*(this.fX2NDC-this.fX1NDC)),n=Math.round(v*(1-this.fY2NDC)),C=Math.round(v*(this.fY2NDC-this.fY1NDC)),B=false,r=false;if(z&&z.options){if(z.options.RotateFrame){B=true}if(z.options.FixFrame){r=true}}this.draw_g=this.svg_layer("primitives_layer").select(".root_frame");var q,o;if(this.draw_g.empty()){var E=this.svg_layer("primitives_layer");this.draw_g=E.append("svg:g").attr("class","root_frame");this.draw_g.append("svg:title").text("");q=this.draw_g.append("svg:rect");this.draw_g.append("svg:g").attr("class","grid_layer");o=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden");this.draw_g.append("svg:g").attr("class","axis_layer");this.draw_g.append("svg:g").attr("class","upper_layer")}else{q=this.draw_g.select("rect");o=this.draw_g.select(".main_layer")}this.axes_drawn=false;var p="translate("+t+","+n+")";if(B){p+=" rotate(-90) translate("+-C+",0)";var D=u;u=C;C=D}this._frame_x=t;this._frame_y=n;this._frame_width=u;this._frame_height=C;this.draw_g.attr("transform",p);q.attr("x",0).attr("y",0).attr("width",u).attr("height",C).call(this.fillatt.func).call(this.lineatt.func);o.attr("width",u).attr("height",C).attr("viewBox","0 0 "+u+" "+C);var x=this.draw_g.select(".interactive_rect");if(b.BatchMode){return x.remove()}this.draw_g.attr("x",t).attr("y",n).attr("width",u).attr("height",C);if(!B&&!r){this.AddDrag({obj:this,only_resize:true,minwidth:20,minheight:20,redraw:this.SizeChanged.bind(this)})}if(x.empty()){x=this.draw_g.append("rect").attr("class","interactive_rect").style("opacity",0).style("fill","none").style("pointer-events","visibleFill").property("handlers_set",0)}var A=(z&&z._fast_drawing)?0:1;if(x.property("handlers_set")!=A){var m=A?this.ProcessTooltipEvent.bind(this,null):null,s=A?this.ProcessTooltipEvent.bind(this,{handler:true,touch:false}):null;x.property("handlers_set",A).on("mouseenter",s).on("mousemove",s).on("mouseleave",m);if(b.touches){var l=A?this.ProcessTooltipEvent.bind(this,{handler:true,touch:true}):null;x.on("touchstart",l).on("touchmove",l).on("touchend",m).on("touchcancel",m)}}x.attr("x",0).attr("y",0).attr("width",u).attr("height",C);var k=this.hints_layer().select(".objects_hints");if(!k.empty()&&this.tooltip_allowed&&(k.property("hints_pad")==this.pad_name)){setTimeout(this.ProcessTooltipEvent.bind(this,k.property("last_point")),10)}};e.prototype.ToggleLog=function(m){var n=this.root_pad();if(!n){return}if(!n["fLog"+m]){var l=this[m+"_kind"];if(this.swap_xy&&m==="x"){l=this.y_kind}else{if(this.swap_xy&&m==="y"){l=this.x_kind}}if(l==="labels"){return}}n["fLog"+m]=n["fLog"+m]?0:1;this.RedrawPad();var k=this.canv_painter();if(k){k.ProcessChanges("log"+m,this.pad_painter())}};e.prototype.FillContextMenu=function(q,m,o){var k=this.main_painter(),n=this.root_pad();if((m=="x")||(m=="y")||(m=="z")){var l=o||this[m+"axis"];q.add("header: "+m.toUpperCase()+" axis");q.add("Unzoom",this.Unzoom.bind(this,m));q.addchk(n["fLog"+m],"SetLog"+m,this.ToggleLog.bind(this,m));q.addchk(l.TestBit(b.EAxisBits.kMoreLogLabels),"More log",function(){l.InvertBit(b.EAxisBits.kMoreLogLabels);this.RedrawPad()});q.addchk(l.TestBit(b.EAxisBits.kNoExponent),"No exponent",function(){l.InvertBit(b.EAxisBits.kNoExponent);this.RedrawPad()});if((m==="z")&&k&&k.options&&k.options.Zscale){if(typeof k.FillPaletteMenu=="function"){k.FillPaletteMenu(q)}}if(l){q.add("sub:Labels");q.addchk(l.TestBit(b.EAxisBits.kCenterLabels),"Center",function(){l.InvertBit(b.EAxisBits.kCenterLabels);this.RedrawPad()});q.addchk(l.TestBit(b.EAxisBits.kLabelsVert),"Rotate",function(){l.InvertBit(b.EAxisBits.kLabelsVert);this.RedrawPad()});this.AddColorMenuEntry(q,"Color",l.fLabelColor,function(r){l.fLabelColor=parseInt(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Offset",0,0.1,0.01,l.fLabelOffset,function(r){l.fLabelOffset=parseFloat(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Size",0.02,0.11,0.01,l.fLabelSize,function(r){l.fLabelSize=parseFloat(r);this.RedrawPad()});q.add("endsub:");q.add("sub:Title");q.add("SetTitle",function(){var r=prompt("Enter axis title",l.fTitle);if(r!==null){l.fTitle=r;this.RedrawPad()}});q.addchk(l.TestBit(b.EAxisBits.kCenterTitle),"Center",function(){l.InvertBit(b.EAxisBits.kCenterTitle);this.RedrawPad()});q.addchk(l.TestBit(b.EAxisBits.kRotateTitle),"Rotate",function(){l.InvertBit(b.EAxisBits.kRotateTitle);this.RedrawPad()});this.AddColorMenuEntry(q,"Color",l.fTitleColor,function(r){l.fTitleColor=parseInt(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Offset",0,3,0.2,l.fTitleOffset,function(r){l.fTitleOffset=parseFloat(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Size",0.02,0.11,0.01,l.fTitleSize,function(r){l.fTitleSize=parseFloat(r);this.RedrawPad()});q.add("endsub:");q.add("sub:Ticks");if(l._typename=="TGaxis"){this.AddColorMenuEntry(q,"Color",l.fLineColor,function(r){l.fLineColor=parseInt(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Size",-0.05,0.055,0.01,l.fTickSize,function(r){l.fTickSize=parseFloat(r);this.RedrawPad()})}else{this.AddColorMenuEntry(q,"Color",l.fAxisColor,function(r){l.fAxisColor=parseInt(r);this.RedrawPad()});this.AddSizeMenuEntry(q,"Size",-0.05,0.055,0.01,l.fTickLength,function(r){l.fTickLength=parseFloat(r);this.RedrawPad()})}q.add("endsub:")}return true}var p=q.size()==0;if(p){q.add("header:Frame")}else{q.add("separator")}if(this.zoom_xmin!==this.zoom_xmax){q.add("Unzoom X",this.Unzoom.bind(this,"x"))}if(this.zoom_ymin!==this.zoom_ymax){q.add("Unzoom Y",this.Unzoom.bind(this,"y"))}if(this.zoom_zmin!==this.zoom_zmax){q.add("Unzoom Z",this.Unzoom.bind(this,"z"))}q.add("Unzoom all",this.Unzoom.bind(this,"xyz"));if(n){q.addchk(n.fLogx,"SetLogx",this.ToggleLog.bind(this,"x"));q.addchk(n.fLogy,"SetLogy",this.ToggleLog.bind(this,"y"));if(k&&(typeof k.Dimension==="function")&&(k.Dimension()>1)){q.addchk(n.fLogz,"SetLogz",this.ToggleLog.bind(this,"z"))}q.add("separator")}q.addchk(this.tooltip_allowed,"Show tooltips",function(){this.tooltip_allowed=!this.tooltip_allowed});this.FillAttContextMenu(q,p?"":"Frame ");q.add("separator");q.add("Save as frame.png",function(){this.pad_painter().SaveAs("png","frame","frame.png")});q.add("Save as frame.svg",function(){this.pad_painter().SaveAs("svg","frame","frame.svg")});return true};e.prototype.GetFrameRect=function(){return{x:this.frame_x(),y:this.frame_y(),width:this.frame_width(),height:this.frame_height(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};e.prototype.ProcessFrameClick=function(s,l){var m=this.pad_painter();if(!m){return}s.painters=true;s.disabled=true;var r=m.GetTooltips(s),q=null;for(var n=0;(n<r.length)&&!q;++n){if(r[n]&&r[n].exact){q=r[n]}}var o;if(q){var p=l?this._dblclick_handler:this._click_handler;if(p){o=p(q.user_info,s)}}if(!l){m.SelectObjectPainter(q?q.painter:this,{x:s.x+(this._frame_x||0),y:s.y+(this._frame_y||0)})}return o};e.prototype.AddKeysHandler=function(){if(this.keys_handler||b.BatchMode||(typeof window=="undefined")){return}this.keys_handler=this.ProcessKeyPress.bind(this);window.addEventListener("keydown",this.keys_handler,false)};e.prototype.ProcessKeyPress=function(q){var k=this.select_main();if(k.empty()){return}var p=k.attr("frame_active");if(p&&p!=="true"){return}var m="";switch(q.keyCode){case 33:m="PageUp";break;case 34:m="PageDown";break;case 37:m="ArrowLeft";break;case 38:m="ArrowUp";break;case 39:m="ArrowRight";break;case 40:m="ArrowDown";break;case 42:m="PrintScreen";break;case 106:m="*";break;default:return false}if(q.shiftKey){m="Shift "+m}if(q.altKey){m="Alt "+m}if(q.ctrlKey){m="Ctrl "+m}var o={name:"x",dleft:0,dright:0};switch(m){case"ArrowLeft":o.dleft=-1;o.dright=1;break;case"ArrowRight":o.dleft=1;o.dright=-1;break;case"Ctrl ArrowLeft":o.dleft=o.dright=-1;break;case"Ctrl ArrowRight":o.dleft=o.dright=1;break;case"ArrowUp":o.name="y";o.dleft=1;o.dright=-1;break;case"ArrowDown":o.name="y";o.dleft=-1;o.dright=1;break;case"Ctrl ArrowUp":o.name="y";o.dleft=o.dright=1;break;case"Ctrl ArrowDown":o.name="y";o.dleft=o.dright=-1;break}if(o.dleft||o.dright){if(!b.gStyle.Zooming){return false}if(this.mode3d&&(m.indexOf("Ctrl")!==0)){return false}this.AnalyzeMouseWheelEvent(null,o,0.5);this.Zoom(o.name,o.min,o.max);if(o.changed){this.zoom_changed_interactive=2}q.stopPropagation();q.preventDefault()}else{var l=this.pad_painter(),n=l?l.FindButton(m):"";if(n){l.PadButtonClick(n);q.stopPropagation();q.preventDefault()}}return true};e.prototype.FindAlternativeClickHandler=function(p){var l=this.pad_painter();if(!l){return false}var o={x:p[0],y:p[1],painters:true,disabled:true,click_handler:true};var n=l.GetTooltips(o);for(var m=0;m<n.length;++m){if(n[m]&&(typeof n[m].click_handler=="function")){n[m].click_handler(n[m]);return true}}return false};e.prototype.clearInteractiveElements=function(){b.Painter.closeMenu();if(this.zoom_rect){this.zoom_rect.remove();this.zoom_rect=null}this.zoom_kind=0;this.SwitchTooltip(true)};e.prototype.startRectSel=function(){if(this.zoom_kind>100){return}if((j.event.which||j.event.button)!==1){return}j.event.preventDefault();var m=j.mouse(this.svg_frame().node());if(this.FindAlternativeClickHandler(m)){return}this.clearInteractiveElements();this.zoom_origin=m;var k=this.frame_width(),l=this.frame_height();this.zoom_curr=[Math.max(0,Math.min(k,this.zoom_origin[0])),Math.max(0,Math.min(l,this.zoom_origin[1]))];if((this.zoom_origin[0]<0)||(this.zoom_origin[0]>k)){this.zoom_kind=3;this.zoom_origin[0]=0;this.zoom_origin[1]=this.zoom_curr[1];this.zoom_curr[0]=k;this.zoom_curr[1]+=1}else{if((this.zoom_origin[1]<0)||(this.zoom_origin[1]>l)){this.zoom_kind=2;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=0;this.zoom_curr[0]+=1;this.zoom_curr[1]=l}else{this.zoom_kind=1;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=this.zoom_curr[1]}}j.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),true);this.zoom_rect=null;this.SwitchTooltip(false);j.event.stopPropagation()};e.prototype.moveRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}j.event.preventDefault();var k=j.mouse(this.svg_frame().node());k[0]=Math.max(0,Math.min(this.frame_width(),k[0]));k[1]=Math.max(0,Math.min(this.frame_height(),k[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=k[0];this.zoom_curr[1]=k[1];break;case 2:this.zoom_curr[0]=k[0];break;case 3:this.zoom_curr[1]=k[1];break}if(this.zoom_rect===null){this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("pointer-events","none")}this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]))};e.prototype.endRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}j.event.preventDefault();j.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);var p=j.mouse(this.svg_frame().node()),r=[true,true];p[0]=Math.max(0,Math.min(this.frame_width(),p[0]));p[1]=Math.max(0,Math.min(this.frame_height(),p[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=p[0];this.zoom_curr[1]=p[1];break;case 2:this.zoom_curr[0]=p[0];r[1]=false;break;case 3:this.zoom_curr[1]=p[1];r[0]=false;break}var l,t,w,o,s=false,x=this.swap_xy?1:0,v=1-x;if(r[x]&&(Math.abs(this.zoom_curr[x]-this.zoom_origin[x])>10)){l=Math.min(this.RevertX(this.zoom_origin[x]),this.RevertX(this.zoom_curr[x]));t=Math.max(this.RevertX(this.zoom_origin[x]),this.RevertX(this.zoom_curr[x]));s=true}if(r[v]&&(Math.abs(this.zoom_curr[v]-this.zoom_origin[v])>10)){w=Math.min(this.RevertY(this.zoom_origin[v]),this.RevertY(this.zoom_curr[v]));o=Math.max(this.RevertY(this.zoom_origin[v]),this.RevertY(this.zoom_curr[v]));s=true}var q=this.zoom_kind,k=(q===1)?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;this.clearInteractiveElements();if(s){this.zoom_changed_interactive=2;this.Zoom(l,t,w,o)}else{switch(q){case 1:var u=this.frame_painter();if(u){u.ProcessFrameClick(k)}break;case 2:var n=this.pad_painter();if(n){n.SelectObjectPainter(this.x_handle)}break;case 3:var n=this.pad_painter();if(n){n.SelectObjectPainter(this.y_handle)}break}}this.zoom_kind=0};e.prototype.mouseDoubleClick=function(){j.event.preventDefault();var k=j.mouse(this.svg_frame().node());this.clearInteractiveElements();var p=(k[0]>=0)&&(k[0]<=this.frame_width()),o=(k[1]>=0)&&(k[1]<=this.frame_height());if(p&&o&&this._dblclick_handler){if(this.ProcessFrameClick({x:k[0],y:k[1]},true)){return}}var n="xyz";if(!p){n=this.swap_xy?"x":"y"}else{if(!o){n=this.swap_xy?"y":"x"}}if(this.Unzoom(n)){return}var l=this.pad_painter();if(l){l.SelectObjectPainter(l,{x:k[0]+this.frame_x(),y:k[1]+this.frame_y(),dbl:true})}};e.prototype.ConfigureUserClickHandler=function(k){this._click_handler=k&&(typeof k=="function")?k:null};e.prototype.ConfigureUserDblclickHandler=function(k){this._dblclick_handler=k&&(typeof k=="function")?k:null};e.prototype.Zoom=function(l,u,w,p,v,x){if(this.projection){return false}if(l==="x"){l=u;u=w;w=undefined}else{if(l==="y"){p=w;w=u;l=u=undefined}else{if(l==="z"){v=u;x=w;l=u=w=undefined}}}var r=(l!==u),o=(w!==p),m=(v!==x),k=false,z=false,y=false;if(r){var q=0;if(l<=this.xmin){l=this.xmin;q++}if(u>=this.xmax){u=this.xmax;q++}if(q===2){r=false;k=true}}else{k=(l===u)&&(l===0)}if(o){var q=0;if(w<=this.ymin){w=this.ymin;q++}if(p>=this.ymax){p=this.ymax;q++}if(q===2){o=false;z=true}}else{z=(w===p)&&(w===0)}if(m){var q=0;if(v<=this.zmin){v=this.zmin;q++}if(x>=this.zmax){x=this.zmax;q++}if(q===2){m=false;y=true}}else{y=(v===x)&&(v===0)}var t=false,s=this;if(r||o||m){s.ForEachPainter(function(A){if(r&&A.CanZoomIn("x",l,u)){s.zoom_xmin=l;s.zoom_xmax=u;t=true;r=false}if(o&&A.CanZoomIn("y",w,p)){s.zoom_ymin=w;s.zoom_ymax=p;t=true;o=false}if(m&&A.CanZoomIn("z",v,x)){s.zoom_zmin=v;s.zoom_zmax=x;t=true;m=false}})}if(k||z||y){if(k){if(this.zoom_xmin!==this.zoom_xmax){t=true}this.zoom_xmin=this.zoom_xmax=0}if(z){if(this.zoom_ymin!==this.zoom_ymax){t=true}this.zoom_ymin=this.zoom_ymax=0}if(y){if(this.zoom_zmin!==this.zoom_zmax){t=true}this.zoom_zmin=this.zoom_zmax=0}if(!t){var n=this.pad_painter();if(n&&n.painters){n.painters.forEach(function(A){if(A&&(typeof A.UnzoomUserRange=="function")){if(A.UnzoomUserRange(k,z,y)){t=true}}})}}}if(t){this.InteractiveRedraw("pad","zoom")}return t};e.prototype.IsAxisZoomed=function(k){return this["zoom_"+k+"min"]!==this["zoom_"+k+"max"]};e.prototype.Unzoom=function(o,m,l){if(typeof o==="undefined"){o=true;m=true;l=true}else{if(typeof o==="string"){l=o.indexOf("z")>=0;m=o.indexOf("y")>=0;o=o.indexOf("x")>=0}}var k=this.zoom_changed_interactive;if(o||m||o){this.zoom_changed_interactive=2}var n=this.Zoom(o?0:undefined,o?0:undefined,m?0:undefined,m?0:undefined,l?0:undefined,l?0:undefined);if((o||m||o)&&!n){this.zoom_changed_interactive=(!isNaN(k)&&(k>0))?k-1:0}return n};e.prototype.AnalyzeMouseWheelEvent=function(k,w,m,r){w.min=w.max=undefined;w.changed=false;if(r&&w.ignore){return}var v=0,x=1,t=1;if("dleft" in w){x=w.dleft;v=1}if("dright" in w){t=w.dright;v=1}if("delta" in w){v=w.delta}else{if(k&&k.wheelDelta!==undefined){v=-k.wheelDelta}else{if(k&&k.deltaY!==undefined){v=k.deltaY}else{if(k&&k.detail!==undefined){v=k.detail}}}}if(v===0){return}v=(v<0)?-0.2:0.2;x*=v;t*=v;var l=w.min=this["scale_"+w.name+"min"],o=w.max=this["scale_"+w.name+"max"],n=this[w.name+"min"],u=this[w.name+"max"];if((w.min===w.max)&&(v<0)){w.min=n;w.max=u}if(w.min>=w.max){return}if((m>0)&&(m<1)){if(this["log"+w.name]){var s=(w.min>0)?b.log10(w.max/w.min):2;if(s>10){s=10}else{if(s<0.01){s=0.01}}w.min=w.min/Math.pow(10,s*x*m);w.max=w.max*Math.pow(10,s*t*(1-m))}else{var p=(w.max-w.min),q=p;if(x>0){p=1.001*p/(1-x)}w.min+=-x*m*p;if(t>0){q=1.001*q/(1-t)}w.max-=-t*(1-m)*q}if(w.min>=w.max){w.min=w.max=undefined}else{if(x!==t){if(((w.min<n)&&(l===n))||((w.max>u)&&(o==u))){w.min=w.max=undefined}}}}else{w.min=w.max=undefined}w.changed=((w.min!==undefined)&&(w.max!==undefined))};e.prototype.AllowDefaultYZooming=function(){var n=this.pad_painter();if(n&&n.painters){for(var m=0;m<n.painters.length;++m){var l=n.painters[m];if(l&&(l.wheel_zoomy!==undefined)){return l.wheel_zoomy}}}return false};e.prototype.mouseWheel=function(){j.event.stopPropagation();j.event.preventDefault();this.clearInteractiveElements();var n={name:"x",ignore:false},m={name:"y",ignore:!this.AllowDefaultYZooming()},o=j.mouse(this.svg_frame().node()),k=this.frame_width(),l=this.frame_height();this.AnalyzeMouseWheelEvent(j.event,this.swap_xy?m:n,o[0]/k,(o[1]>=0)&&(o[1]<=l));this.AnalyzeMouseWheelEvent(j.event,this.swap_xy?n:m,1-o[1]/l,(o[0]>=0)&&(o[0]<=k));this.Zoom(n.min,n.max,m.min,m.max);if(n.changed||m.changed){this.zoom_changed_interactive=2}};e.prototype.startTouchZoom=function(){if(this.zoom_kind!=0){j.event.preventDefault();j.event.stopPropagation();return}var l=j.touches(this.svg_frame().node());this.touch_cnt+=1;if(l.length==1){var n=new Date(),p=n.getTime()-this.last_touch.getTime();this.last_touch=n;if((p<300)&&this.zoom_curr&&(Math.abs(this.zoom_curr[0]-l[0][0])<30)&&(Math.abs(this.zoom_curr[1]-l[0][1])<30)){j.event.preventDefault();j.event.stopPropagation();this.clearInteractiveElements();this.Unzoom("xyz");this.last_touch=new Date(0);this.svg_frame().on("touchcancel",null).on("touchend",null,true)}else{if(b.gStyle.ContextMenu){this.zoom_curr=l[0];this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this));j.event.preventDefault();j.event.stopPropagation()}}}if((l.length!=2)||!b.gStyle.Zooming||!b.gStyle.ZoomTouch){return}j.event.preventDefault();j.event.stopPropagation();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null);var k=l[0],q=l[1],m=this.frame_width(),o=this.frame_height();this.zoom_curr=[Math.min(k[0],q[0]),Math.min(k[1],q[1])];this.zoom_origin=[Math.max(k[0],q[0]),Math.max(k[1],q[1])];if((this.zoom_curr[0]<0)||(this.zoom_curr[0]>m)){this.zoom_kind=103;this.zoom_curr[0]=0;this.zoom_origin[0]=m}else{if((this.zoom_origin[1]>o)||(this.zoom_origin[1]<0)){this.zoom_kind=102;this.zoom_curr[1]=0;this.zoom_origin[1]=o}else{this.zoom_kind=101}}this.SwitchTooltip(false);this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);j.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",this.endTouchSel.bind(this))};e.prototype.moveTouchSel=function(){if(this.zoom_kind<100){return}j.event.preventDefault();var l=j.touches(this.svg_frame().node());if(l.length!=2){return this.clearInteractiveElements()}var k=l[0],m=l[1];if(this.zoom_kind!=103){this.zoom_curr[0]=Math.min(k[0],m[0]);this.zoom_origin[0]=Math.max(k[0],m[0])}if(this.zoom_kind!=102){this.zoom_curr[1]=Math.min(k[1],m[1]);this.zoom_origin[1]=Math.max(k[1],m[1])}this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);if((this.zoom_origin[0]-this.zoom_curr[0]>10)||(this.zoom_origin[1]-this.zoom_curr[1]>10)){this.SwitchTooltip(false)}j.event.stopPropagation()};e.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null);if(this.zoom_kind===0){j.event.preventDefault();var l=new Date();var s=l.getTime()-this.last_touch.getTime();if((s>500)&&(s<2000)&&!this.frame_painter().IsTooltipShown()){this.ShowContextMenu("main",{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]});this.last_touch=new Date(0)}else{this.clearInteractiveElements()}}if(this.zoom_kind<100){return}j.event.preventDefault();j.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);var k,r,t,m,q=false,n=this.swap_xy?1:0,p=1-n,o=[true,true];if(this.zoom_kind===102){o[1]=false}if(this.zoom_kind===103){o[0]=false}if(o[n]&&(Math.abs(this.zoom_curr[n]-this.zoom_origin[n])>10)){k=Math.min(this.RevertX(this.zoom_origin[n]),this.RevertX(this.zoom_curr[n]));r=Math.max(this.RevertX(this.zoom_origin[n]),this.RevertX(this.zoom_curr[n]));q=true}if(o[p]&&(Math.abs(this.zoom_curr[p]-this.zoom_origin[p])>10)){t=Math.min(this.RevertY(this.zoom_origin[p]),this.RevertY(this.zoom_curr[p]));m=Math.max(this.RevertY(this.zoom_origin[p]),this.RevertY(this.zoom_curr[p]));q=true}this.clearInteractiveElements();this.last_touch=new Date(0);if(q){this.zoom_changed_interactive=2;this.Zoom(k,r,t,m)}j.event.stopPropagation()};e.prototype.ShowContextMenu=function(s,z,t){if(("zoom_kind" in this)&&(this.zoom_kind>100)){return}var x=this,u=false,v=null;if(!z){j.event.preventDefault();j.event.stopPropagation();z=j.event;if(s===undefined){var l=j.mouse(this.svg_frame().node()),r=j.touches(this.svg_frame().node()),p=this.pad_painter(),k=null,o=null;v=this.frame_painter();if(r.length===1){k={x:r[0][0],y:r[0][1],touch:true}}else{if(l.length===2){k={x:l[0],y:l[1],touch:false}}}if((k!==null)&&(p!==null)){k.painters=true;var m=p.GetTooltips(k),y=1000;for(var q=0;q<m.length;++q){if(m[q]&&m[q].menu){var w=("menu_dist" in m[q])?m[q].menu_dist:7;if(w<y){o=m[q].painter;y=w}}}}if(o!==null){x=o}else{if(v!==null){s="frame"}}if(k!==null){u=(k.x>0)&&(k.x<20)&&(k.y>0)&&(k.y<20)}if(v){v.SetLastEventPos(k)}}}x.ctx_menu_evnt=z;b.Painter.createMenu(x,function(A){var n=A.painter.FillContextMenu(A,s,t);if(v&&(!n||(u&&(s!=="frame")))){n=v.FillContextMenu(A)}if(n){A.painter.FillObjectExecMenu(A,s,function(){A.painter.SwitchTooltip(false);A.show(A.painter.ctx_menu_evnt,A.painter.SwitchTooltip.bind(A.painter,true))})}})};e.prototype.ShowAxisStatus=function(o){var n=this.GetShowStatusFunc();if(!n){return}var p=this.histo?this.histo["f"+o.toUpperCase()+"axis"]:null;var s=o,l="TAxis";if(p){s=p.fName;l=p.fTitle||"histogram TAxis object"}var k=j.mouse(this.svg_frame().node());var r=(o=="x")?0:1;if(this.swap_xy){r=1-r}var q=(o=="x")?this.RevertX(k[r]):this.RevertY(k[r]);n(s,l,o+" : "+this.AxisAsText(o,q),k[0].toFixed(0)+","+k[1].toFixed(0))};e.prototype.AddInteractive=function(){if(b.BatchMode||(!b.gStyle.Zooming&&!b.gStyle.ContextMenu)){return}var k=this.pad_painter();if(k&&k._fast_drawing){return}var l=this.svg_frame();if(l.empty()){return}var n=l.selectAll(".xaxis_container"),m=l.selectAll(".yaxis_container");if(!l.property("interactive_set")){this.AddKeysHandler();this.last_touch=new Date(0);this.zoom_kind=0;this.zoom_rect=null;this.zoom_origin=null;this.zoom_curr=null;this.touch_cnt=0}if(b.gStyle.Zooming&&!this.projection){if(b.gStyle.ZoomMouse){l.on("mousedown",this.startRectSel.bind(this));l.on("dblclick",this.mouseDoubleClick.bind(this))}if(b.gStyle.ZoomWheel){l.on("wheel",this.mouseWheel.bind(this))}}if(b.touches&&((b.gStyle.Zooming&&b.gStyle.ZoomTouch&&!this.projection)||b.gStyle.ContextMenu)){l.on("touchstart",this.startTouchZoom.bind(this))}if(b.gStyle.ContextMenu){if(b.touches){n.on("touchstart",this.startTouchMenu.bind(this,"x"));m.on("touchstart",this.startTouchMenu.bind(this,"y"))}l.on("contextmenu",this.ShowContextMenu.bind(this));n.on("contextmenu",this.ShowContextMenu.bind(this,"x"));m.on("contextmenu",this.ShowContextMenu.bind(this,"y"))}n.on("mousemove",this.ShowAxisStatus.bind(this,"x"));m.on("mousemove",this.ShowAxisStatus.bind(this,"y"));l.property("interactive_set",true)};function h(n,m,k){var l=new e(m);if(k=="3d"){l.mode3d=true}l.SetDivId(n,2);l.Redraw();return l.DrawingReady()}function c(m,k){b.TObjectPainter.call(this,m);this.pad=m;this.iscan=k;this.this_pad_name="";if(!this.iscan&&(m!==null)&&("fName" in m)){this.this_pad_name=m.fName.replace(" ","_");var l=new RegExp("^[A-Za-z][A-Za-z0-9_]*$");if(!l.test(this.this_pad_name)){this.this_pad_name="jsroot_pad_"+b.id_counter++}}this.painters=[];this.has_canvas=true}c.prototype=Object.create(b.TObjectPainter.prototype);c.prototype.Cleanup=function(){for(var m=0;m<this.painters.length;++m){this.painters[m].Cleanup()}var l=this.svg_pad(this.this_pad_name);if(!l.empty()){l.property("pad_painter",null);l.property("mainpainter",null);if(!this.iscan){l.remove()}}delete this.frame_painter_ref;delete this.pads_cache;this.painters=[];this.pad=null;this.this_pad_name="";this.has_canvas=false;b.TObjectPainter.prototype.Cleanup.call(this)};c.prototype.CleanPrimitives=function(l){if(!l||(typeof l!=="function")){return}for(var m=this.painters.length-1;m>=0;--m){var n=this.painters[m];if(l(n)){n.Cleanup();this.painters.splice(m--,1)}}};c.prototype.CreateAutoColor=function(){var k=this._auto_color||0;this._auto_color=(k+1)%8;return k+2};c.prototype.ForEachPainterInPad=function(m,o){if(!o){o="all"}if(o!="objects"){m(this)}for(var l=0;l<this.painters.length;++l){var n=this.painters[l];if(typeof n.ForEachPainterInPad==="function"){if(o!="objects"){n.ForEachPainterInPad(m,o)}}else{if(o!="pads"){m(n)}}}};c.prototype.ButtonSize=function(k){return Math.round((!k?1:k)*(this.iscan||!this.has_canvas?16:12))};c.prototype.IsTooltipAllowed=function(){var k=this.frame_painter();return k?k.tooltip_allowed:undefined};c.prototype.SetTooltipAllowed=function(k){var l=this.frame_painter();if(l){l.tooltip_allowed=k}};c.prototype.RegisterForPadEvents=function(k){this.pad_events_receiver=k};c.prototype.SelectObjectPainter=function(n,o){var l=(this.iscan||!this.has_canvas),m=l?this:this.canv_painter(),k=n instanceof c?n:n.pad_painter();if(o&&!l){this.CalcAbsolutePosition(this.svg_pad(this.this_pad_name),o)}if(typeof m.SelectActivePad=="function"){m.SelectActivePad(k,n,o)}if(m.pad_events_receiver){m.pad_events_receiver({what:"select",padpainter:k,painter:n,position:o})}};c.prototype.InteractiveObjectRedraw=function(m){var l=(this.iscan||!this.has_canvas)?this:this.canv_painter(),k=m instanceof c?m:m.pad_painter();if(l&&l.pad_events_receiver){l.pad_events_receiver({what:"redraw",padpainter:k,painter:m})}};c.prototype.DrawActiveBorder=function(l,m){if(m!==undefined){if(this.is_active_pad===m){return}this.is_active_pad=m}if(this.is_active_pad===undefined){return}if(!l){l=this.iscan?this.svg_canvas().select(".canvas_fillrect"):this.svg_pad(this.this_pad_name).select(".root_pad_border")}var k=this.is_active_pad?new b.TAttLineHandler({style:1,width:1,color:"red"}):this.lineatt;if(!k){k=new b.TAttLineHandler({color:"none"})}l.call(k.func)};c.prototype.CreateCanvasSvg=function(n,k){var r=null,p=null,q=5,s=null,l;if(n>0){if(this._fixed_size){return(n>1)}p=this.svg_canvas();if(p.empty()){return false}r=p.property("height_factor");s=this.check_main_resize(n,null,r);if(!s.changed){return false}l=this.svg_layer("btns_layer")}else{var m=this.select_main();if(m.style("position")=="static"){m.style("position","relative")}p=m.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("mainpainter",null).property("current_pad","").property("redraw_by_resize",false);if(b.BatchMode){p.attr("xmlns","http://www.w3.org/2000/svg");p.attr("xmlns:xlink","http://www.w3.org/1999/xlink")}p.append("svg:title").text("ROOT canvas");var t=p.append("svg:rect").attr("class","canvas_fillrect").attr("x",0).attr("y",0);if(!b.BatchMode){t.style("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}p.append("svg:g").attr("class","primitives_layer");p.append("svg:g").attr("class","info_layer");l=p.append("svg:g").attr("class","btns_layer").property("leftside",b.gStyle.ToolBarSide=="left").property("vertical",b.gStyle.ToolBarVert);if(b.gStyle.ContextMenu){p.select(".canvas_fillrect").on("contextmenu",this.ShowContextMenu.bind(this))}r=0.66;if(this.pad&&this.pad.fCw&&this.pad.fCh&&(this.pad.fCw>0)){r=this.pad.fCh/this.pad.fCw;if((r<0.1)||(r>10)){r=0.66}}if(this._fixed_size){m.style("overflow","auto");s={width:this.pad.fCw,height:this.pad.fCh}}else{s=this.check_main_resize(2,k,r)}}this.createAttFill({attr:this.pad});if((s.width<=q)||(s.height<=q)){p.style("display","none");console.warn("Hide canvas while geometry too small w="+s.width+" h="+s.height);s.width=200;s.height=100}else{p.style("display",null)}if(this._fixed_size){p.attr("x",0).attr("y",0).attr("width",s.width).attr("height",s.height).style("position","absolute")}else{p.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0)}p.attr("viewBox","0 0 "+s.width+" "+s.height).attr("preserveAspectRatio","none").property("height_factor",r).property("draw_x",0).property("draw_y",0).property("draw_width",s.width).property("draw_height",s.height);var o=p.select(".canvas_fillrect").attr("width",s.width).attr("height",s.height).call(this.fillatt.func);this._fast_drawing=b.gStyle.SmallPad&&((s.width<b.gStyle.SmallPad.width)||(s.height<b.gStyle.SmallPad.height));this.DrawActiveBorder(o);this.AlignBtns(l,s.width,s.height,p);return true};c.prototype.EnlargePad=function(){if(j.event){j.event.preventDefault();j.event.stopPropagation()}var m=this.svg_canvas(),k=m.property("pad_enlarged");if(this.iscan||!this.has_canvas||(!k&&!this.HasObjectsToDraw()&&!this.painters)){if(this._fixed_size){return}if(!this.enlarge_main("toggle")){return}if(this.enlarge_main("state")=="off"){m.property("pad_enlarged",null)}}else{if(!k){this.enlarge_main(true,true);m.property("pad_enlarged",this.pad)}else{if(k===this.pad){this.enlarge_main(false);m.property("pad_enlarged",null)}else{console.error("missmatch with pad double click events")}}}var l=this._fast_drawing;this.CheckResize({force:true});if(this._fast_drawing!=l){this.ShowButtons()}};c.prototype.CreatePadSvg=function(z){if(!this.has_canvas){this.CreateCanvasSvg(z?2:0);return true}var v=this.svg_canvas(),k=v.property("draw_width"),u=v.property("draw_height"),n=v.property("pad_enlarged"),t=!n||(n===this.pad),s=Math.round(this.pad.fAbsWNDC*k),p=Math.round(this.pad.fAbsHNDC*u),r=Math.round(this.pad.fAbsXlowNDC*k),q=Math.round(u*(1-this.pad.fAbsYlowNDC))-p,l=null,o=null,m=null;if(n===this.pad){s=k;p=u;r=q=0}if(z){l=this.svg_pad(this.this_pad_name);o=l.select(".root_pad_border");m=this.svg_layer("btns_layer",this.this_pad_name)}else{l=v.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,true).attr("pad",this.this_pad_name).property("pad_painter",this).property("mainpainter",null);o=l.append("svg:rect").attr("class","root_pad_border");l.append("svg:g").attr("class","primitives_layer");m=l.append("svg:g").attr("class","btns_layer").property("leftside",b.gStyle.ToolBarSide!="left").property("vertical",b.gStyle.ToolBarVert);if(b.gStyle.ContextMenu){o.on("contextmenu",this.ShowContextMenu.bind(this))}if(!b.BatchMode){o.attr("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:this.pad.fBorderMode==0?"none":""});l.attr("display",t?null:"none").attr("viewBox","0 0 "+s+" "+p).attr("preserveAspectRatio","none").attr("x",r).attr("y",q).attr("width",s).attr("height",p).property("draw_x",r).property("draw_y",q).property("draw_width",s).property("draw_height",p);o.attr("x",0).attr("y",0).attr("width",s).attr("height",p).call(this.fillatt.func).call(this.lineatt.func);this.DrawActiveBorder(o);this._fast_drawing=b.gStyle.SmallPad&&((s<b.gStyle.SmallPad.width)||(p<b.gStyle.SmallPad.height));if(l.property("can3d")===1){this.select_main().select(".draw3d_"+this.this_pad_name).style("display",t?"":"none")}this.AlignBtns(m,s,p);return t};c.prototype.CheckSpecial=function(o){if(!o||(o._typename!=="TObjArray")){return false}if(o.name=="ListOfColors"){if(this.options&&this.options.CreatePalette){var k=[];for(var p=o.arr.length-this.options.CreatePalette;p<o.arr.length;++p){var l=b.Painter.MakeColorRGB(o.arr[p]);if(!l){console.log("Fail to create color for palette");k=null;break}k.push(l)}if(k){this.CanvasPalette=new b.ColorPalette(k)}}if(!this.options||this.options.GlobalColors){b.Painter.adoptRootColors(o)}if(this.options&&this.options.LocalColors){this.root_colors=[];for(var p=0;p<b.Painter.root_colors.length;++p){this.root_colors[p]=b.Painter.root_colors[p]}b.Painter.extendRootColors(this.root_colors,o)}return true}if(o.name=="CurrentColorPalette"){var k=[],m=false;for(var p=0;p<o.arr.length;++p){var l=o.arr[p];if(l&&(l._typename=="TColor")){k[p]=b.Painter.MakeColorRGB(l)}else{console.log("Missing color with index "+p);m=true}}if(!this.options||(!m&&!this.options.IgnorePalette)){this.CanvasPalette=new b.ColorPalette(k)}return true}return false};c.prototype.CheckSpecialsInPrimitives=function(m){var k=m?m.fPrimitives:null;if(!k){return}for(var l=0;l<k.arr.length;++l){if(this.CheckSpecial(k.arr[l])){k.arr.splice(l,1);k.opt.splice(l,1);l--}}};c.prototype.RemovePrimitive=function(l){if(!this.pad||!this.pad.fPrimitives){return}var k=this.pad.fPrimitives.arr.indexOf(l);if(k>=0){this.pad.fPrimitives.RemoveAt(k)}};c.prototype.FindPrimitive=function(o,n,k){if(!this.pad||!this.pad.fPrimitives){return null}for(var l=0;l<this.pad.fPrimitives.arr.length;l++){var m=this.pad.fPrimitives.arr[l];if((o!==null)&&(m!==o)){continue}if((n!==undefined)&&(n!==null)){if(m._typename!==n){continue}}if((k!==undefined)&&(k!==null)){if(m.fName!==k){continue}}return m}return null};c.prototype.HasObjectsToDraw=function(){if(!this.pad||!this.pad.fPrimitives){return false}for(var k=0;k<this.pad.fPrimitives.arr.length;++k){if(this.pad.fPrimitives.arr[k]&&this.pad.fPrimitives.arr[k]._typename!="TPad"){return true}}return false};c.prototype.DrawPrimitives=function(l,p,k){if(l===0){this._doing_pad_draw=true;if(this.iscan){this._start_tm=this._lasttm_tm=new Date().getTime()}this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.arr.length:0}while(true){if(k&&(typeof k=="object")){k._primitive=true}if(!this.pad||(l>=this.pad.fPrimitives.arr.length)){delete this._doing_pad_draw;delete this._current_primitive_indx;if(this._start_tm){var n=new Date().getTime()-this._start_tm;if(n>200){console.log("Canvas drawing took "+(n*0.001).toFixed(2)+"s")}delete this._start_tm;delete this._lasttm_tm}return b.CallBack(p)}var m={func:this.DrawPrimitives.bind(this,l+1,p)};this._current_primitive_indx=l;k=b.draw(this.divid,this.pad.fPrimitives.arr[l],this.pad.fPrimitives.opt[l],m);l++;if(!m.completed){return}if(!b.BatchMode&&this.iscan){var o=new Date().getTime();if(o>this._lasttm_tm+15000){this._lasttm_tm=o;k._primitive=true;return requestAnimationFrame(m.func)}}}};c.prototype.GetTooltips=function(m){var k=[],l=[];if(this.painters!==null){this.painters.forEach(function(n){if("ProcessTooltip" in n){k.push(n)}})}if(m){m.nproc=k.length}k.forEach(function(n){var o=n.ProcessTooltip(m);if(!o){o={user_info:null}}l.push(o);if(o&&m&&m.painters){o.painter=n}});return l};c.prototype.FillContextMenu=function(m){if(this.pad){m.add("header: "+this.pad._typename+"::"+this.pad.fName)}else{m.add("header: Canvas")}var l=this.IsTooltipAllowed();if(l!==undefined){m.addchk(l,"Show tooltips",this.SetTooltipAllowed.bind(this,!l))}if(!this._websocket){function k(p){this.pad[p.substr(1)]=parseInt(p[0]);var o=this.svg_pad(this.this_pad_name).property("mainpainter");if(o&&(typeof o.DrawAxes=="function")){o.DrawAxes()}var q=this.canv_painter();if(q){q.ProcessChanges(p.substr(1),this.pad_painter())}}m.addchk(this.pad.fGridx,"Grid x",(this.pad.fGridx?"0":"1")+"fGridx",k);m.addchk(this.pad.fGridy,"Grid y",(this.pad.fGridy?"0":"1")+"fGridy",k);m.add("sub:Ticks x");m.addchk(this.pad.fTickx==0,"normal","0fTickx",k);m.addchk(this.pad.fTickx==1,"ticks on both sides","1fTickx",k);m.addchk(this.pad.fTickx==2,"labels on both sides","2fTickx",k);m.add("endsub:");m.add("sub:Ticks y");m.addchk(this.pad.fTicky==0,"normal","0fTicky",k);m.addchk(this.pad.fTicky==1,"ticks on both sides","1fTicky",k);m.addchk(this.pad.fTicky==2,"labels on both sides","2fTicky",k);m.add("endsub:");this.FillAttContextMenu(m)}m.add("separator");if(this.ActivateStatusBar){m.addchk(this.HasEventStatus(),"Event status",this.ActivateStatusBar.bind(this,"toggle"))}if(this.enlarge_main()||(this.has_canvas&&this.HasObjectsToDraw())){m.addchk((this.enlarge_main("state")=="on"),"Enlarge "+(this.iscan?"canvas":"pad"),this.EnlargePad.bind(this))}var n=this.this_pad_name;if(n.length===0){n=this.iscan?"canvas":"pad"}m.add("Save as "+n+".png",n+".png",this.SaveAs.bind(this,"png",false));m.add("Save as "+n+".svg",n+".svg",this.SaveAs.bind(this,"svg",false));return true};c.prototype.ShowContextMenu=function(m){if(!m){var l=j.mouse(this.svg_pad(this.this_pad_name).node());if(l&&(l.length==2)&&(l[0]>0)&&(l[0]<10)&&(l[1]>0)&&l[1]<10){return}j.event.stopPropagation();j.event.preventDefault();m=j.event;var k=this.frame_painter();if(k){k.SetLastEventPos()}}b.Painter.createMenu(this,function(n){n.painter.FillContextMenu(n);n.painter.FillObjectExecMenu(n,"",function(){n.show(m)})})};c.prototype.Redraw=function(k){if(this._doing_pad_draw){return console.log("Prevent redrawing",this.pad.fName)}var n=true;if(this.iscan){this.CreateCanvasSvg(2)}else{n=this.CreatePadSvg(true)}for(var l=0;l<this.painters.length;++l){var m=this.painters[l];if(n||m.this_pad_name){m.Redraw(k)}}};c.prototype.NumDrawnSubpads=function(){if(this.painters===undefined){return 0}var k=0;for(var l=0;l<this.painters.length;++l){var m=this.painters[l].GetObject();if(m&&(m._typename==="TPad")){k++}}return k};c.prototype.RedrawByResize=function(){if(this.access_3d_kind()===1){return true}for(var k=0;k<this.painters.length;++k){if(typeof this.painters[k].RedrawByResize==="function"){if(this.painters[k].RedrawByResize()){return true}}}return false};c.prototype.CheckCanvasResize=function(l,m){if(!this.iscan&&this.has_canvas){return false}if((l===true)||(l===false)){m=l;l=null}if(l&&(typeof l==="object")&&l.force){m=true}if(!m){m=this.RedrawByResize()}var n=this.CreateCanvasSvg(m?2:1,l);if(n){for(var k=0;k<this.painters.length;++k){this.painters[k].Redraw(m?false:true)}}return n};c.prototype.UpdateObject=function(q){if(!q){return false}this.pad.fBits=q.fBits;this.pad.fTitle=q.fTitle;this.pad.fGridx=q.fGridx;this.pad.fGridy=q.fGridy;this.pad.fTickx=q.fTickx;this.pad.fTicky=q.fTicky;this.pad.fLogx=q.fLogx;this.pad.fLogy=q.fLogy;this.pad.fLogz=q.fLogz;this.pad.fUxmin=q.fUxmin;this.pad.fUxmax=q.fUxmax;this.pad.fUymin=q.fUymin;this.pad.fUymax=q.fUymax;this.pad.fX1=q.fX1;this.pad.fX2=q.fX2;this.pad.fY1=q.fY1;this.pad.fY2=q.fY2;this.pad.fLeftMargin=q.fLeftMargin;this.pad.fRightMargin=q.fRightMargin;this.pad.fBottomMargin=q.fBottomMargin;this.pad.fTopMargin=q.fTopMargin;this.pad.fFillColor=q.fFillColor;this.pad.fFillStyle=q.fFillStyle;this.pad.fLineColor=q.fLineColor;this.pad.fLineStyle=q.fLineStyle;this.pad.fLineWidth=q.fLineWidth;if(this.iscan){this.CheckSpecialsInPrimitives(q)}var l=this.frame_painter();if(l){l.UpdateAttributes(!l.modified_NDC)}if(!q.fPrimitives){return false}var m=false,o=0;for(var r=0;r<q.fPrimitives.arr.length;++r){while(o<this.painters.length){var k=this.painters[o++];if(!k._primitive){continue}if(k.UpdateObject(q.fPrimitives.arr[r])){m=true}break}}return m};c.prototype.DrawNextSnap=function(p,q,m,x){if(q===-1){this._doing_pad_draw=true;this._snaps_map={};this._num_primitives=p?p.length:0}while(true){if(x&&p&&p[q]&&(x.snapid===undefined)){if(this.painters.indexOf(x)<0){this.painters.push(x)}x.snapid=p[q].fObjectID}x=null;++q;if(!p||q>=p.length){delete this._doing_pad_draw;delete this._snaps_map;delete this._current_primitive_indx;return b.CallBack(m,this)}var n=p[q],v=n.fObjectID,l=this._snaps_map[v];if(l){l++}else{l=1}this._snaps_map[v]=l;this._current_primitive_indx=q;for(var o=0;o<this.painters.length;++o){if(this.painters[o].snapid===v){if(--l===0){x=this.painters[o];break}}}var w=this.DrawNextSnap.bind(this,p,q,m);if(x){if(n.fKind===b.WebSnapIds.kObject){if(x.UpdateObject(n.fSnapshot,n.fOption)){x.Redraw()}continue}if(n.fKind===b.WebSnapIds.kSVG){if(x.UpdateObject(n.fSnapshot)){x.Redraw()}continue}if(n.fKind===b.WebSnapIds.kSubPad){return x.RedrawPadSnap(n,w)}continue}if(n.fKind===b.WebSnapIds.kSpecial){this.CheckSpecial(n.fSnapshot);continue}if(n.fKind===b.WebSnapIds.kSubPad){var u=n.fSnapshot;u.fPrimitives=null;var s=new c(u,false);s.DecodeOptions(n.fOption);s.SetDivId(this.divid);s.snapid=n.fObjectID;s.CreatePadSvg();if(s.MatchObjectType("TPad")&&n.fPrimitives.length>0){s.AddButton(b.ToolbarIcons.camera,"Create PNG","PadSnapShot");s.AddButton(b.ToolbarIcons.circle,"Enlarge pad","EnlargePad");if(b.gStyle.ContextMenu){s.AddButton(b.ToolbarIcons.question,"Access context menus","PadContextMenus")}}var t=s.CurrentPadName(s.this_pad_name);s.DrawNextSnap(n.fPrimitives,-1,function(){s.CurrentPadName(t);w(s)});return}var r={func:w};if(n.fKind===b.WebSnapIds.kObject){x=b.draw(this.divid,n.fSnapshot,n.fOption,r)}if(n.fKind===b.WebSnapIds.kSVG){x=b.draw(this.divid,n.fSnapshot,n.fOption,r)}if(!r.completed){return}}};c.prototype.FindSnap=function(n){if(this.snapid===n){return this}if(!this.painters){return null}for(var l=0;l<this.painters.length;++l){var m=this.painters[l];if(typeof m.FindSnap==="function"){m=m.FindSnap(n)}else{if(m.snapid!==n){m=null}}if(m){return m}}return null};c.prototype.AddOnlineButtons=function(){this.AddButton(b.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");if(b.gStyle.ContextMenu){this.AddButton(b.ToolbarIcons.question,"Access context menus","PadContextMenus")}if(this.enlarge_main("verify")){this.AddButton(b.ToolbarIcons.circle,"Enlarge canvas","EnlargePad")}if(this.brlayout){this.AddButton(b.ToolbarIcons.diamand,"Toggle Ged","ToggleGed");this.AddButton(b.ToolbarIcons.three_circles,"Toggle Status","ToggleStatus")}};c.prototype.RedrawPadSnap=function(o,m){if(!o||!o.fPrimitives){return}this.is_active_pad=!!o.fActive;var r=o.fSnapshot;r.fPrimitives=null;if(this.snapid===undefined){this.snapid=o.fObjectID;this.draw_object=r;this.pad=r;if(this.batch_mode&&(!r.fCw||!r.fCh)){r.fCw=900;r.fCh=700}if(!r.fCw||!r.fCh){this._fixed_size=false}if(b.BrowserLayout&&!this.batch_mode&&!this.use_openui&&!this.brlayout){var t=this.divid;if(t&&(typeof t=="object")){t=j.select(t).attr("id")}if(t&&(typeof t=="string")){this.brlayout=new b.BrowserLayout(t,null,this);this.brlayout.Create(t,true);this.SetDivId(this.brlayout.drawing_divid(),-1);b.RegisterForResize(this.brlayout)}}this.CreateCanvasSvg(0);this.SetDivId(this.divid);if(!this.batch_mode){this.AddOnlineButtons()}this.DrawNextSnap(o.fPrimitives,-1,m);return}this.UpdateObject(r);if(this.iscan){this.CreateCanvasSvg(2)}else{this.CreatePadSvg(true)}var n=false;for(var p=0;p<this.painters.length;++p){var l=this.painters[p];if(l.snapid===undefined){continue}for(var q=0;q<o.fPrimitives.length;++q){if(o.fPrimitives[q].fObjectID===l.snapid){l=null;n=true;break}}if(l){this.painters.splice(p--,1);l.Cleanup()}}if(!n){var u=this.svg_pad(this.this_pad_name),s=this.frame_painter();if(u&&!u.empty()){u.property("mainpainter",null)}for(var p=0;p<this.painters.length;++p){if(s!==this.painters[p]){this.painters[p].Cleanup()}}this.painters=[];if(s){this.painters.push(s);s.CleanFrameDrawings()}this.RemoveButtons();this.AddOnlineButtons()}var v=this,w=v.CurrentPadName(v.this_pad_name);v.DrawNextSnap(o.fPrimitives,-1,function(){v.CurrentPadName(w);b.CallBack(m,v)})};c.prototype.CreateImage=function(l,k){if(l=="pdf"){b.CallBack(k,btoa("dummy PDF file"))}else{if((l=="png")||(l=="jpeg")||(l=="svg")){this.ProduceImage(true,l,function(m){if((l=="svg")||!m){return b.CallBack(k,m)}var n=m.indexOf("base64,");b.CallBack(k,(n>0)?m.substr(n+7):"")})}else{b.CallBack(k,"")}}};c.prototype.GetAllRanges=function(l){var n=(l===undefined),p=null;if(n){l=[]}if(this.snapid){p={_typename:"TWebPadRange",snapid:this.snapid.toString(),active:!!this.is_active_pad,bits:0,primitives:[],logx:this.pad.fLogx,logy:this.pad.fLogy,logz:this.pad.fLogz,gridx:this.pad.fGridx,gridy:this.pad.fGridy,tickx:this.pad.fTickx,ticky:this.pad.fTicky,mleft:this.pad.fLeftMargin,mright:this.pad.fRightMargin,mtop:this.pad.fTopMargin,mbottom:this.pad.fBottomMargin};if(this.iscan){p.bits=this.GetStatusBits()}if(this.GetPadRanges(p)){l.push(p)}else{console.log("fail to get ranges for pad "+this.pad.fName)}}for(var m=0;m<this.painters.length;++m){var o=this.painters[m];if(typeof o.GetAllRanges=="function"){o.GetAllRanges(l)}else{if(o.snapid){p.primitives.push({_typename:"TWebObjectOptions",snapid:o.snapid.toString(),opt:o.OptionsAsString()})}}}if(n){return b.toJSON(l)}};c.prototype.GetPadRanges=function(l){if(!l){return false}var u=this.frame_painter_ref,o=this.svg_pad(this.this_pad_name);l.ranges=u?true:false;l.ux1=l.px1=u?u.scale_xmin:0;l.uy1=l.py1=u?u.scale_ymin:0;l.ux2=l.px2=u?u.scale_xmax:0;l.uy2=l.py2=u?u.scale_ymax:0;if(!u||o.empty()){return true}var y=function(k){return k},q=function(k){return Math.pow(10,k)},s=u.logx?b.log10:y,z=u.logx?q:y,t=(s(u.scale_xmax)-s(u.scale_xmin))/o.property("draw_width"),n=s(u.scale_xmin)-t*o.property("draw_x"),m=n+t*o.property("draw_width");function v(r,k,p){return(Math.abs(k-r)<Math.abs(p)*1e-10)?k:r}l.ux1=v(z(n),l.ux1,l.px2-l.px1);l.ux2=v(z(m),l.ux2,l.px2-l.px1);s=u.logy?b.log10:y;z=u.logy?q:y;t=(s(u.scale_ymax)-s(u.scale_ymin))/o.property("draw_height");var w=s(u.scale_ymax)+t*o.property("draw_y"),x=w-t*o.property("draw_height");l.uy1=v(z(x),l.uy1,l.py2-l.py1);l.uy2=v(z(w),l.uy2,l.py2-l.py1);return true};c.prototype.ItemContextMenu=function(l){var o=this.svg_pad(this.this_pad_name).node().getBoundingClientRect();var p={clientX:o.left+10,clientY:o.top+10};if(l=="pad"){return setTimeout(this.ShowContextMenu.bind(this,p),50)}var k=null,n;switch(l){case"xaxis":case"yaxis":case"zaxis":k=this.frame_painter_ref;n=l[0];break;case"frame":k=this.frame_painter_ref;break;default:var m=parseInt(l);if(!isNaN(m)){k=this.painters[m]}}if(!k||(typeof k.FillContextMenu!=="function")){return}b.Painter.createMenu(k,function(q){if(k.FillContextMenu(q,n)){setTimeout(q.show.bind(q,p),50)}})};c.prototype.SaveAs=function(l,m,k){if(!k){k=this.this_pad_name;if(k.length===0){k=this.iscan?"canvas":"pad"}k+="."+l}this.ProduceImage(m,l,function(n){var o=document.createElement("a");o.download=k;o.href=(l!="svg")?n:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n);document.body.appendChild(o);o.addEventListener("click",function(p){o.parentNode.removeChild(o)});o.click()})};c.prototype.ProduceImage=function(r,q,p){var x=(r==="frame");var m=x?this.svg_frame():(r?this.svg_canvas():this.svg_pad(this.this_pad_name));if(m.empty()){return b.CallBack(p)}var v=(r&&!x)?this.canv_painter():this;var t=[];if(!x){v.ForEachPainterInPad(function(z){var H={prnt:z.svg_pad(z.this_pad_name)};t.push(H);var C=z.svg_layer("btns_layer",z.this_pad_name);H.btns_node=C.node();if(H.btns_node){H.btns_prnt=H.btns_node.parentNode;H.btns_next=H.btns_node.nextSibling;C.remove()}var A=z.frame_painter_ref;if(!A||(typeof A.Render3D!=="function")){return}var G=A.access_3d_kind();if((G!==1)&&(G!==2)){return}var B=A.size_for_3d(2);var F=(G==2)?F:A.size_for_3d(1);var y=A.renderer.domElement;A.Render3D(0);var E=y.toDataURL("image/png");if(G==2){H.foreign=H.prnt.select("."+B.clname);H.foreign.remove()}var D=A.svg_frame();H.frame_node=D.node();if(H.frame_node){H.frame_next=H.frame_node.nextSibling;D.remove()}H.img=H.prnt.insert("image",".primitives_layer").attr("x",B.x).attr("y",B.y).attr("width",y.width).attr("height",y.height).attr("href",E)},"pads")}function k(y){y=encodeURIComponent(y);y=y.replace(/%([0-9A-F]{2})/g,function(z,A){var B=String.fromCharCode("0x"+A);return B==="%"?"%25":B});return decodeURIComponent(y)}function u(A){for(var z=0;z<t.length;++z){var B=t[z];if(B.img){B.img.remove()}var y=B.prnt.select(".primitives_layer");if(B.foreign){B.prnt.node().insertBefore(B.foreign.node(),y.node())}if(B.frame_node){y.node().insertBefore(B.frame_node,B.frame_next)}if(B.btns_node){B.btns_prnt.insertBefore(B.btns_node,B.btns_next)}}b.CallBack(p,A)}var l=m.property("draw_width"),w=m.property("draw_height");if(x){l=this.frame_width();w=this.frame_height()}var s='<svg width="'+l+'" height="'+w+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+m.node().innerHTML+"</svg>";if(q=="svg"){return u(s)}var o='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';var n=new Image();n.onload=function(){var y=document.createElement("canvas");y.width=n.width;y.height=n.height;var z=y.getContext("2d");z.drawImage(n,0,0);u(y.toDataURL("image/"+q))};n.onerror=function(y){console.log("IMAGE ERROR",y);u(null)};n.src="data:image/svg+xml;base64,"+window.btoa(k(o+s))};c.prototype.PadButtonClick=function(k){if(k=="CanvasSnapShot"){return this.SaveAs("png",true)}if(k=="EnlargePad"){return this.EnlargePad()}if(k=="PadSnapShot"){return this.SaveAs("png",false)}if(k=="PadContextMenus"){j.event.preventDefault();j.event.stopPropagation();if(b.Painter.closeMenu()){return}var n=this,p=j.event;b.Painter.createMenu(n,function(v){v.add("header:Menus");if(n.iscan){v.add("Canvas","pad",n.ItemContextMenu)}else{v.add("Pad","pad",n.ItemContextMenu)}if(n.frame_painter()){v.add("Frame","frame",n.ItemContextMenu)}var q=n.main_painter();if(q){v.add("X axis","xaxis",n.ItemContextMenu);v.add("Y axis","yaxis",n.ItemContextMenu);if((typeof q.Dimension==="function")&&(q.Dimension()>1)){v.add("Z axis","zaxis",n.ItemContextMenu)}}if(n.painters&&(n.painters.length>0)){v.add("separator");var t=[];for(var w=0;w<n.painters.length;++w){var r=n.painters[w];var u=r?r.GetObject():null;if(!u||(t.indexOf(u)>=0)){continue}var s=("_typename" in u)?(u._typename+"::"):"";if("fName" in u){s+=u.fName}if(s.length==0){s="item"+w}v.add(s,w,n.ItemContextMenu)}}v.show(p)});return}var m=false;for(var o=0;o<this.painters.length;++o){var l=this.painters[o];if(typeof l.PadButtonClick=="function"){l.PadButtonClick(k)}if(!m&&(typeof l.ButtonClick=="function")){m=l.ButtonClick(k)}}};c.prototype.FindButton=function(m){var l=this.svg_layer("btns_layer",this.this_pad_name),k="";if(!l.empty()){l.selectAll("svg").each(function(){if(j.select(this).attr("key")===m){k=j.select(this).attr("name")}})}return k};c.prototype.toggleButtonsVisibility=function(n){var o=this.svg_layer("btns_layer",this.this_pad_name),l=o.select("[name='Toggle']");if(l.empty()){return}var m=l.property("buttons_state");if(l.property("timout_handler")){if(n!=="timeout"){clearTimeout(l.property("timout_handler"))}l.property("timout_handler",null)}var k=false;switch(n){case"enable":k=true;break;case"enterbtn":return;case"timeout":k=false;break;case"toggle":m=!m;l.property("buttons_state",m);k=m;break;case"disable":case"leavebtn":if(!m){l.property("timout_handler",setTimeout(this.toggleButtonsVisibility.bind(this,"timeout"),500))}return}o.selectAll("svg").each(function(){if(this===l.node()){return}j.select(this).style("display",k?"":"none")})};c.prototype.RemoveButtons=function(){var k=this.svg_layer("btns_layer",this.this_pad_name);if(!k.empty()){k.selectAll("*").remove();k.property("nextx",null)}};c.prototype.AddButton=function(q,n,l,p){if(!b.gStyle.ToolBar){return}if(!this._buttons){this._buttons=[]}for(var m=0;m<this._buttons.length;++m){if(this._buttons[m].funcname==l){return}}this._buttons.push({btn:q,tooltip:n,funcname:l,keyname:p});var o=this.iscan||!this.has_canvas;if(!o&&(l.indexOf("Pad")!=0)&&(l!=="EnlargePad")){var r=this.canv_painter();if(r&&(r!==this)){r.AddButton(q,n,l)}}};c.prototype.ShowButtons=function(){if(!this._buttons){return}var r=this.svg_layer("btns_layer",this.this_pad_name);if(r.empty()){return}r.selectAll("*").remove();var o=this.iscan||!this.has_canvas,q,l=r.property("leftside")?this.ButtonSize(1.25):0,s=0;if(this._fast_drawing){q=b.ToolbarIcons.CreateSVG(r,b.ToolbarIcons.circle,this.ButtonSize(),"EnlargePad");q.attr("name","Enlarge").attr("x",0).attr("y",0).on("click",this.PadButtonClick.bind(this,"EnlargePad"))}else{q=b.ToolbarIcons.CreateSVG(r,b.ToolbarIcons.rect,this.ButtonSize(),"Toggle tool buttons");q.attr("name","Toggle").attr("x",0).attr("y",0).property("buttons_state",(b.gStyle.ToolBar!=="popup")).on("click",this.toggleButtonsVisibility.bind(this,"toggle")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enable")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"disable"));for(var n=0;n<this._buttons.length;++n){var p=this._buttons[n];var m=b.ToolbarIcons.CreateSVG(r,p.btn,this.ButtonSize(),p.tooltip+(o?"":(" on pad "+this.this_pad_name))+(p.keyname?" (keyshortcut "+p.keyname+")":""));if(r.property("vertical")){m.attr("x",s).attr("y",l)}else{m.attr("x",l).attr("y",s)}m.attr("name",p.funcname).style("display",(q.property("buttons_state")?"":"none")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enterbtn")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"leavebtn"));if(p.keyname){m.attr("key",p.keyname)}m.on("click",this.PadButtonClick.bind(this,p.funcname));l+=this.ButtonSize(1.25)}}r.property("nextx",l);this.AlignBtns(r,this.pad_width(this.this_pad_name),this.pad_height(this.this_pad_name));if(r.property("vertical")){q.attr("y",l)}else{if(!r.property("leftside")){q.attr("x",l)}}};c.prototype.AlignBtns=function(o,n,l,m){var r=this.ButtonSize(1.25),q=(o.property("nextx")||0)+r,k,p;if(o.property("vertical")){k=o.property("leftside")?2:(n-r);p=l-q}else{k=o.property("leftside")?2:(n-q);p=l-r}o.attr("transform","translate("+k+","+p+")")};c.prototype.DrawingReady=function(l){var k=this.frame_painter_ref;if(k&&k.mode3d&&typeof k.Render3D=="function"){k.Render3D(-2222)}b.TObjectPainter.prototype.DrawingReady.call(this,l)};c.prototype.DecodeOptions=function(k){var l=this.GetObject();if(!l){return}var m=new b.DrawOptions(k);if(m.check("WEBSOCKET")){this.OpenWebsocket()}if(!this.options){this.options={}}b.extend(this.options,{GlobalColors:true,LocalColors:false,CreatePalette:0,IgnorePalette:false,RotateFrame:false,FixFrame:false});if(m.check("NOCOLORS")||m.check("NOCOL")){this.options.GlobalColors=this.options.LocalColors=false}if(m.check("LCOLORS")||m.check("LCOL")){this.options.GlobalColors=false;this.options.LocalColors=true}if(m.check("NOPALETTE")||m.check("NOPAL")){this.options.IgnorePalette=true}if(m.check("ROTATE")){this.options.RotateFrame=true}if(m.check("FIXFRAME")){this.options.FixFrame=true}if(m.check("CP",true)){this.options.CreatePalette=m.partAsInt(0,0)}if(m.check("WHITE")){l.fFillColor=0}if(m.check("LOGX")){l.fLogx=1;l.fUxmin=0;l.fUxmax=1;l.fX1=0;l.fX2=1}if(m.check("LOGY")){l.fLogy=1;l.fUymin=0;l.fUymax=1;l.fY1=0;l.fY2=1}if(m.check("LOGZ")){l.fLogz=1}if(m.check("LOG")){l.fLogx=l.fLogy=l.fLogz=1}if(m.check("GRIDX")){l.fGridx=1}if(m.check("GRIDY")){l.fGridy=1}if(m.check("GRID")){l.fGridx=l.fGridy=1}if(m.check("TICKX")){l.fTickx=1}if(m.check("TICKY")){l.fTicky=1}if(m.check("TICK")){l.fTickx=l.fTicky=1}this.OptionsStore(k)};function g(o,n,l){var k=new c(n,false);k.DecodeOptions(l);k.SetDivId(o);if(k.svg_canvas().empty()){k.has_canvas=false;k.this_pad_name=""}k.CreatePadSvg();if(k.MatchObjectType("TPad")&&(!k.has_canvas||k.HasObjectsToDraw())){k.AddButton(b.ToolbarIcons.camera,"Create PNG","PadSnapShot");if((k.has_canvas&&k.HasObjectsToDraw())||k.enlarge_main("verify")){k.AddButton(b.ToolbarIcons.circle,"Enlarge pad","EnlargePad")}if(b.gStyle.ContextMenu){k.AddButton(b.ToolbarIcons.question,"Access context menus","PadContextMenus")}}var m=k.has_canvas?k.CurrentPadName(k.this_pad_name):undefined;k.DrawPrimitives(0,function(){k.ShowButtons();k.CurrentPadName(m);k.DrawingReady()});return k}function d(k){c.call(this,k,true);this._websocket=null}d.prototype=Object.create(c.prototype);d.prototype.ChangeLayout=function(t,n){var r=this.get_layout_kind();if(r==t){return b.CallBack(n,true)}var s=this.select_main("origin"),l=s.select(".side_panel"),p=this.select_main(),q=[];while(p.node().firstChild){q.push(p.node().removeChild(p.node().firstChild))}if(!l.empty()){b.cleanup(l.node())}this.set_layout_kind("simple");s.html("");if(t=="simple"){p=s;for(var o=0;o<q.length;++o){p.node().appendChild(q[o])}this.set_layout_kind(t);return b.CallBack(n,true)}var m=this;b.AssertPrerequisites("jq2d",function(){var v=new b.GridDisplay(s.node(),t);if(t.indexOf("vert")==0){p=j.select(v.GetFrame(0));l=j.select(v.GetFrame(1))}else{p=j.select(v.GetFrame(1));l=j.select(v.GetFrame(0))}p.classed("central_panel",true).style("position","relative");l.classed("side_panel",true).style("position","relative");for(var u=0;u<q.length;++u){p.node().appendChild(q[u])}m.set_layout_kind(t,".central_panel");b.CallBack(n,true)})};d.prototype.ToggleProjection=function(k,m){delete this.proj_painter;if(k){this.proj_painter=1}if(this.use_openui&&this.ShowUI5ProjectionArea){return this.ShowUI5ProjectionArea(k,m)}var l="simple";if(k=="X"){l="vert2_31"}else{if(k=="Y"){l="horiz2_13"}}this.ChangeLayout(l,m)};d.prototype.DrawProjection=function(n,q){if(!this.proj_painter){return}if(this.proj_painter===1){var r=b.Create("TCanvas"),l=this,p=this.root_pad(),k=this.frame_painter_ref,m;if(n=="X"){r.fLeftMargin=p.fLeftMargin;r.fRightMargin=p.fRightMargin;r.fLogx=k.logx?1:0;r.fUxmin=k.logx?b.log10(k.scale_xmin):k.scale_xmin;r.fUxmax=k.logx?b.log10(k.scale_xmax):k.scale_xmax;m="fixframe"}else{r.fBottomMargin=p.fBottomMargin;r.fTopMargin=p.fTopMargin;r.fLogx=k.logy?1:0;r.fUxmin=k.logy?b.log10(k.scale_ymin):k.scale_ymin;r.fUxmax=k.logy?b.log10(k.scale_ymax):k.scale_ymax;m="rotate"}r.fPrimitives.Add(q,"hist");if(this.use_openui&&this.DrawInUI5ProjectionArea){this.DrawInUI5ProjectionArea(r,m,function(s){l.proj_painter=s})}else{this.DrawInSidePanel(r,m,function(s){l.proj_painter=s})}}else{var o=this.proj_painter.main_painter();if(o){o.UpdateObject(q,"hist")}this.proj_painter.RedrawPad()}};d.prototype.DrawInSidePanel=function(n,l,m){var k=this.select_main("origin").select(".side_panel");if(k.empty()){return b.CallBack(m,null)}b.draw(k.node(),n,l,m)};d.prototype.ShowMessage=function(k){b.progress(k,7000)};d.prototype.SaveCanvasAsFile=function(m){var k=this,l=m.indexOf(".");this.CreateImage(m.substr(l+1),function(n){k.SendWebsocket("SAVE:"+m+":"+n)})};d.prototype.SendSaveCommand=function(k){this.SendWebsocket("PRODUCE:"+k)};d.prototype.WindowBeforeUnloadHanlder=function(){this.CloseWebsocket(true)};d.prototype.SendWebsocket=function(l,k){if(this._websocket){this._websocket.Send(l,k)}};d.prototype.CloseWebsocket=function(k){if(this._websocket){this._websocket.Close(k);this._websocket.Cleanup();delete this._websocket}};d.prototype.OpenWebsocket=function(k){this.CloseWebsocket();this._websocket=new b.WebWindowHandle(k);this._websocket.SetReceiver(this);this._websocket.Connect()};d.prototype.UseWebsocket=function(k){this.CloseWebsocket();this._websocket=k;this._websocket.SetReceiver(this);this._websocket.Connect()};d.prototype.OnWebsocketOpened=function(k){};d.prototype.OnWebsocketClosed=function(k){b.CloseCurrentWindow()};d.prototype.OnWebsocketMsg=function(t,l){console.log("GET MSG len:"+l.length+" "+l.substr(0,60));if(l=="CLOSE"){this.OnWebsocketClosed();this.CloseWebsocket(true)}else{if(l.substr(0,6)=="SNAP6:"){l=l.substr(6);var z=l.indexOf(":"),y=l.substr(0,z),p=b.parse(l.substr(z+1)),k=this;this.RedrawPadSnap(p,function(){k.CompeteCanvasSnapDrawing();var A=k.GetAllRanges();if(A){A=":"+A}t.Send("READY6:"+y+A)})}else{if(l.substr(0,5)=="MENU:"){l=l.substr(5);var z=l.indexOf(":"),r=l.substr(0,z),q=b.parse(l.substr(z+1));if(typeof this._getmenu_callback=="function"){this._getmenu_callback(q,r)}}else{if(l.substr(0,4)=="CMD:"){l=l.substr(4);var z=l.indexOf(":"),x=l.substr(0,z),n=l.substr(z+1),m="REPLY:"+x+":";if((n=="SVG")||(n=="PNG")||(n=="JPEG")){this.CreateImage(n.toLowerCase(),function(A){t.Send(m+A)})}else{console.log("Unrecognized command "+n);t.Send(m)}}else{if((l.substr(0,7)=="DXPROJ:")||(l.substr(0,7)=="DYPROJ:")){var o=l[1],v=b.parse(l.substr(7));this.DrawProjection(o,v)}else{if(l.substr(0,5)=="SHOW:"){var s=l.substr(5),u=(s[s.length-1]=="1");this.ShowSection(s.substr(0,s.length-2),u)}else{if(l.substr(0,5)=="EDIT:"){var w=this.FindSnap(l.substr(5));console.log("GET EDIT "+l.substr(5)+" found "+!!w);if(w){this.ShowSection("Editor",true);if(this.pad_events_receiver){this.pad_events_receiver({what:"select",padpainter:this,painter:w})}}}else{console.log("unrecognized msg "+l)}}}}}}}};d.prototype.PadButtonClick=function(k){if(k=="ToggleGed"){return this.ActivateGed(this,null,"toggle")}if(k=="ToggleStatus"){return this.ActivateStatusBar("toggle")}c.prototype.PadButtonClick.call(this,k)};d.prototype.HasEventStatus=function(){if(this.use_openui){return this.openuiHasEventStatus()}return this.brlayout?this.brlayout.HasStatus():false};d.prototype.ActivateStatusBar=function(k){if(this.use_openui){this.openuiToggleEventStatus(k)}else{if(this.brlayout){this.brlayout.CreateStatusLine(23,k)}}this.ProcessChanges("sbits",this)};d.prototype.HasGed=function(){if(this.use_openui){return this.openuiHasGed()}return this.brlayout?this.brlayout.HasContent():false};d.prototype.RemoveGed=function(){if(typeof this.CleanupGed=="function"){this.CleanupGed()}if(this.brlayout){this.brlayout.DeleteContent()}this.ProcessChanges("sbits",this)};d.prototype.ActivateGed=function(n,l,o){if(this.use_openui){return this.openuiActivateGed(n,l,o)}if(!this.brlayout){return}if(this.brlayout.HasContent()){if((o==="toggle")||(o===false)){return this.RemoveGed()}return this.SelectObjectPainter(n)}if(o===false){return}var m=this.brlayout.CreateBrowserBtns();b.ToolbarIcons.CreateSVG(m,b.ToolbarIcons.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",this.brlayout.Toggle.bind(this.brlayout,"fix"));b.ToolbarIcons.CreateSVG(m,b.ToolbarIcons.circle,15,"toggle float mode").style("margin","3px").on("click",this.brlayout.Toggle.bind(this.brlayout,"float"));b.ToolbarIcons.CreateSVG(m,b.ToolbarIcons.cross,15,"delete GED").style("margin","3px").on("click",this.RemoveGed.bind(this));this.brlayout.SetBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>");this.brlayout.SetBrowserTitle("GED");this.brlayout.ToggleBrowserKind(l||"float");var k=this;b.AssertPrerequisites("openui5",function(){k.ShowGed(n);k.ProcessChanges("sbits",k)})};d.prototype.ShowSection=function(l,k){if(this.use_openui){return this.fullShowSection(l,k)}console.log("Show section "+l+" flag = "+k);switch(l){case"Menu":break;case"StatusBar":this.ActivateStatusBar(k);break;case"Editor":this.ActivateGed(this,null,!!k);break;case"ToolBar":break;case"ToolTips":this.SetTooltipAllowed(k);break}};d.prototype.CompeteCanvasSnapDrawing=function(){if(!this.pad){return}if(document){document.title=this.pad.fTitle}if(this._all_sections_showed){return}this._all_sections_showed=true;this.ShowSection("Menu",this.pad.TestBit(b.TCanvasStatusBits.kMenuBar));this.ShowSection("StatusBar",this.pad.TestBit(b.TCanvasStatusBits.kShowEventStatus));this.ShowSection("ToolBar",this.pad.TestBit(b.TCanvasStatusBits.kShowToolBar));this.ShowSection("Editor",this.pad.TestBit(b.TCanvasStatusBits.kShowEditor));this.ShowSection("ToolTips",this.pad.TestBit(b.TCanvasStatusBits.kShowToolTips))};d.prototype.ProcessChanges=function(l,k){if(!this._websocket){return}var m=(l=="sbits")?"STATUSBITS:"+this.GetStatusBits():"RANGES6:"+this.GetAllRanges();this._websocket.Send(m)};d.prototype.SelectActivePad=function(n,l,o){if((this.snapid===undefined)||!n){return}var k=null,m=false;if((n.snapid!==undefined)&&this._websocket){k={_typename:"TWebPadClick",padid:n.snapid.toString(),objid:"",x:-1,y:-1,dbl:false}}if(!n.is_active_pad){m=true;this.ForEachPainterInPad(function(p){p.DrawActiveBorder(null,p===n)},"pads")}if(l&&(l.snapid!==undefined)&&k){m=true;k.objid=l.snapid.toString()}if(o&&k){m=true;k.x=Math.round(o.x||0);k.y=Math.round(o.y||0);if(o.dbl){k.dbl=true}}if(this._websocket&&k&&m){this._websocket.Send("PADCLICKED:"+b.toJSON(k))}};d.prototype.GetStatusBits=function(){var k=0;if(this.HasEventStatus()){k|=b.TCanvasStatusBits.kShowEventStatus}if(this.HasGed()){k|=b.TCanvasStatusBits.kShowEditor}if(this.IsTooltipAllowed()){k|=b.TCanvasStatusBits.kShowToolTips}if(this.use_openui){k|=b.TCanvasStatusBits.kMenuBar}return k};d.prototype.ProduceJSON=function(){var m=this.GetObject(),l=(m.fFillStyle==0);if(l){m.fFillStyle=1001}if(!this.normal_canvas){this.ForEachPainterInPad(function(o){if(o.$secondary){return}var n=o.GetObject();if(n&&n._typename){m.fPrimitives.Add(n,o.OptionsAsString())}},"objects")}var k=b.toJSON(m);if(l){m.fFillStyle=0}if(!this.normal_canvas){m.fPrimitives.Clear()}return k};function f(o,n,m){var k=!n;if(k){n=b.Create("TCanvas")}var l=new d(n);l.DecodeOptions(m);l.normal_canvas=!k;l.SetDivId(o,-1);l.CheckSpecialsInPrimitives(n);l.CreateCanvasSvg(0);l.SetDivId(o);l.AddButton(b.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");if(b.gStyle.ContextMenu){l.AddButton(b.ToolbarIcons.question,"Access context menus","PadContextMenus")}if(l.enlarge_main("verify")){l.AddButton(b.ToolbarIcons.circle,"Enlarge canvas","EnlargePad")}if(k&&m.indexOf("noframe")<0){b.Painter.drawFrame(o,null)}l.DrawPrimitives(0,function(){l.ShowButtons();l.DrawingReady()});return l}function a(o,k,m){var n=b.Create("TCanvas");var l=new d(n);l.normal_canvas=false;l.SetDivId(o,-1);l.AddButton(b.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");if(b.gStyle.ContextMenu){l.AddButton(b.ToolbarIcons.question,"Access context menus","PadContextMenus")}if(l.enlarge_main("verify")){l.AddButton(b.ToolbarIcons.circle,"Enlarge canvas","EnlargePad")}l.RedrawPadSnap(k,function(){l.ShowButtons();l.DrawingReady()});return l}b.TAxisPainter=i;b.TFramePainter=e;b.TPadPainter=c;b.TCanvasPainter=d;b.Painter.drawFrame=h;b.Painter.drawPad=g;b.Painter.drawCanvas=f;b.Painter.drawPadSnapshot=a;return b}));