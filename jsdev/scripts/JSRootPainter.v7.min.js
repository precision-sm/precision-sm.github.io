(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.v7.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.v7.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.v7.js")}a(JSROOT,d3)}}}(function(a,i){a.sources.push("v7");a.v7={};a.TObjectPainter.prototype.GetCoordinate=function(n){var l={x:0,y:0};if(!n){return l}var k=this.pad_width(),m=this.pad_height(),j=this.pad_painter();function o(r,s,q){var p=r.fNormal.fVal*q+r.fPixel.fVal;if(r.fUser.fVal){p+=(r.fUser.fVal-s.fBegin)/(s.fEnd-s.fBegin)*q}return p}if(!j.pad_frame){l.x=n.fHoriz.fNormal.fVal*k;l.y=m-n.fVert.fNormal.fVal*m}else{l.x=o(n.fHoriz,j.pad_frame.fUserCoord[0],k);l.y=m-o(n.fVert,j.pad_frame.fUserCoord[1],m)}return l};function h(k,j){a.TObjectPainter.call(this,k);this.embedded=j;this.name="yaxis";this.kind="normal";this.func=null;this.order=0;this.full_min=0;this.full_max=1;this.scale_min=0;this.scale_max=1;this.ticks=[];this.invert_side=false;this.lbls_both_sides=false}h.prototype=Object.create(a.TObjectPainter.prototype);h.prototype.Cleanup=function(){this.ticks=[];this.func=null;delete this.format;a.TObjectPainter.prototype.Cleanup.call(this)};h.prototype.SetAxisConfig=function(l,n,o,m,k,j,p){this.name=l;this.kind=n;this.func=o;this.full_min=m;this.full_max=k;this.scale_min=j;this.scale_max=p};h.prototype.format10Exp=function(j,m){var l="";if(m){m=Math.round(m/Math.pow(10,j));if((m!=0)&&(m!=1)){l=m.toString()+(a.gStyle.Latex?"#times":"x")}}l+="10";if(a.gStyle.Latex>1){return l+"^{"+j+"}"}var k={"0":"\u2070","1":"\xB9","2":"\xB2","3":"\xB3","4":"\u2074","5":"\u2075","6":"\u2076","7":"\u2077","8":"\u2078","9":"\u2079","-":"\u207B"};var o=j.toString();for(var p=0;p<o.length;++p){l+=k[o[p]]}return l};h.prototype.CreateFormatFuncs=function(){var l=this.GetObject(),k=(l&&l._typename==="TGaxis");delete this.format;var p=508;if(k){p=l.fNdiv}else{if(l){p=Math.max(l.fNdivisions,4)}}this.nticks=p%100;this.nticks2=(p%10000-this.nticks)/100;this.nticks3=Math.floor(p/10000);if(l&&!k&&(this.nticks>7)){this.nticks=7}var m=Math.abs(this.func.range()[1]-this.func.range()[0]);if(m<=0){m=100}if(this.kind=="time"){if(this.nticks>8){this.nticks=8}var j=this.scale_max-this.scale_min,o=a.Painter.getTimeFormat(l),n=a.Painter.chooseTimeFormat(j/m,false);if((o.length==0)||(j<0.1*(this.full_max-this.full_min))){o=a.Painter.chooseTimeFormat(j/this.nticks,true)}this.tfunc1=this.tfunc2=i.timeFormat(o);if(n!==o){this.tfunc2=i.timeFormat(n)}this.format=function(r,q){return q?this.tfunc1(r):this.tfunc2(r)}}else{if(this.kind=="log"){if(this.nticks2>1){this.nticks*=this.nticks2;this.nticks2=1}this.noexp=l?l.TestBit(a.EAxisBits.kNoExponent):false;if((this.scale_max<300)&&(this.scale_min>0.3)){this.noexp=true}this.moreloglabels=l?l.TestBit(a.EAxisBits.kMoreLogLabels):false;this.format=function(v,q,t){var u=parseFloat(v),s=Math.round(u);if(!q){return((s===u)&&(Math.abs(s)<1000000000))?s.toString():a.FFormat(u,t||a.gStyle.fStatFormat)}if(u<=0){return null}var r=a.log10(u);if(this.moreloglabels||(Math.abs(r-Math.round(r))<0.001)){if(!this.noexp&&!t){return this.format10Exp(Math.floor(r+0.01),u)}return(r<0)?u.toFixed(Math.round(-r+0.5)):u.toFixed(0)}return null}}else{if(this.kind=="labels"){this.nticks=50;var j=this.scale_max-this.scale_min;if(this.nticks>j){this.nticks=Math.round(j)}this.nticks2=1;this.regular_labels=true;if(l&&l.fNbins&&l.fLabels){if((l.fNbins!=Math.round(l.fXmax-l.fXmin))||(l.fXmin!=0)||(l.fXmax!=l.fNbins)){this.regular_labels=false}}this.axis=l;this.format=function(t){var s=parseFloat(t);if(!this.regular_labels){s=(s-this.axis.fXmin)/(this.axis.fXmax-this.axis.fXmin)*this.axis.fNbins}s=Math.round(s);if((s<0)||(s>=this.axis.fNbins)){return null}for(var r=0;r<this.axis.fLabels.arr.length;++r){var q=this.axis.fLabels.arr[r];if(q.fUniqueID===s+1){return q.fString}}return null}}else{this.order=0;this.ndig=0;this.format=function(t,r,q){var s=parseFloat(t);if(r&&this.order){s=s/Math.pow(10,this.order)}if(s===Math.round(s)){return(Math.abs(s)<1000000000)?s.toFixed(0):s.toExponential(4)}if(r){return(this.ndig>10)?s.toExponential(this.ndig-11):s.toFixed(this.ndig)}return a.FFormat(s,q||a.gStyle.fStatFormat)}}}}};h.prototype.ProduceTicks=function(o,j){if(!this.noticksopt){return this.func.ticks(o*(j||1))}if(j){o=(o-1)*j}var l=this.func.domain(),k=[];for(var m=0;m<=o;++m){k.push((l[0]*(o-m)+l[1]*m)/o)}return k};h.prototype.CreateTicks=function(r,y,p,F){if(p&&this.nticks&&(this.kind=="normal")){this.noticksopt=true}var D={nminor:0,nmiddle:0,nmajor:0,func:this.func};D.minor=D.middle=D.major=this.ProduceTicks(this.nticks);if(r){var I=D.major,E=(this.scale_max-this.scale_min)*0.00001;if(I[0]>this.scale_min+E){I.unshift(this.scale_min)}if(I[I.length-1]<this.scale_max-E){I.push(this.scale_max)}return I}if((this.kind=="labels")&&!this.regular_labels){D.lbl_pos=[];for(var v=0;v<this.axis.fNbins;++v){var q=this.axis.fXmin+v/this.axis.fNbins*(this.axis.fXmax-this.axis.fXmin);if((q>=this.scale_min)&&(q<this.scale_max)){D.lbl_pos.push(q)}}}if(this.nticks2>1){D.minor=D.middle=this.ProduceTicks(D.major.length,this.nticks2);var m=Math.abs(this.func.range()[1]-this.func.range()[0]);if((D.middle.length<=D.major.length)||(D.middle.length>m/3.5)){D.minor=D.middle=D.major}else{if((this.nticks3>1)&&(this.kind!=="log")){D.minor=this.ProduceTicks(D.middle.length,this.nticks3);if((D.minor.length<=D.middle.length)||(D.minor.length>m/1.7)){D.minor=D.middle}}}}D.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};D.next=function(n){if(this.nminor>=this.minor.length){return false}this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);if(n){this.grpos=Math.round(this.grpos)}this.kind=3;if((this.nmiddle<this.middle.length)&&(Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1)){this.nmiddle++;this.kind=2}if((this.nmajor<this.major.length)&&(Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1)){this.nmajor++;this.kind=1}return true};D.last_major=function(){return(this.kind!==1)?false:this.nmajor==this.major.length};D.next_major_grpos=function(){if(this.nmajor>=this.major.length){return null}return this.func(this.major[this.nmajor])};this.order=0;this.ndig=0;if((this.kind=="normal")&&(D.major.length>0)){var w=0,o=0;if(!y){var k=Math.max(Math.abs(D.major[0]),Math.abs(D.major[D.major.length-1])),H=Math.min(Math.abs(D.major[0]),Math.abs(D.major[D.major.length-1])),t=(k>0)?Math.round(a.log10(k)/3)*3:0,s=(H>0)?Math.round(a.log10(H)/3)*3:0;if(k||H){w=Math.max(t,s)+3;o=Math.min(t,s)-3}}var l=0,C=this.ndig,j=10000000000;for(var A=o;A<=w;A+=3){this.order=A;this.ndig=0;var u=[],G=0,z=0;while(G<D.major.length){var B=this.format(D.major[G],true);if(u.indexOf(B)<0){u.push(B);z+=B.length;G++;continue}if(++this.ndig>11){break}u=[];G=0;z=0}if(!A&&(this.ndig<4)){z-=(D.major.length*2+3)}if(z<j){j=z;l=this.order;C=this.ndig}}this.order=l;this.ndig=C;if(F){if(this.order){console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable")}if(this.ndig){console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required")}this.ndig=0;this.order=0}}return D};h.prototype.IsCenterLabels=function(){if(this.kind==="labels"){return true}if(this.kind==="log"){return false}var j=this.GetObject();return j&&j.TestBit(a.EAxisBits.kCenterLabels)};h.prototype.AddTitleDrag=function(m,l,u,r,o){if(!a.gStyle.MoveResize){return}var k=this,n=null,p="",v,y,x,t,s,j,w,q;if(a._test_d3_===3){p="drag";v=i.behavior.drag().origin(Object)}else{v=i.drag().subject(Object)}v.on(p+"start",function(){i.event.sourceEvent.preventDefault();i.event.sourceEvent.stopPropagation();var A=m.node().getBBox(),z=k.GetObject();t=y=m.property("shift_x");s=x=m.property("shift_y");j=l?(y>0):(x>0);if(z.TestBit(a.EAxisBits.kCenterTitle)){q=(r===l)?o:0}else{q=Math.round(o/2)}n=m.append("rect").classed("zoom",true).attr("x",A.x).attr("y",A.y).attr("width",A.width).attr("height",A.height).style("cursor","move")}).on("drag",function(){if(!n){return}i.event.sourceEvent.preventDefault();i.event.sourceEvent.stopPropagation();y+=i.event.dx;x+=i.event.dy;var A=m.property("shift_x"),z=m.property("shift_y");if(l){A=y;if(Math.abs(x-z)>Math.abs(x-q)){z=q}}else{z=x;if(Math.abs(y-A)>Math.abs(y-q)){A=q}}if(j===(l?(A>0):(z>0))){t=A;s=z;m.attr("transform","translate("+t+","+s+")")}}).on(p+"end",function(){if(!n){return}i.event.sourceEvent.preventDefault();i.event.sourceEvent.stopPropagation();m.property("shift_x",t).property("shift_y",s);var z=k.GetObject();z.fTitleOffset=(l?t:s)/u;if((l?s:t)===q){z.InvertBit(a.EAxisBits.kCenterTitle)}n.remove();n=null});m.style("cursor","move").call(v)};h.prototype.DrawAxis=function(H,P,O,U,aq,l,ag,aJ,ae){var q=this.GetObject(),ap="",aG=(q&&q._typename==="TGaxis"),ad=P,L=0.03,R=100,p=true,I=this.pad_width()||10,N=this.pad_height()||10;this.vertical=H;function J(w,r){return(w&&!r)||(!w&&r)}if(!ag){ag=0}else{if(this.invert_side){ag=-ag}}if(aG){this.createAttLine({attr:q});p=q.fLineColor!=0;ap=q.fChopt;L=q.fTickSize;R=(H?1.7*U:0.6*O)}else{this.createAttLine({color:q.fAxisColor,width:1,style:1});ap=J(H,this.invert_side)?"-S":"+S";L=q.fTickLength;R=(H?I:N)}if(!aG||(this.name==="zaxis")){ad=P.select("."+this.name+"_container");if(ad.empty()){ad=P.append("svg:g").attr("class",this.name+"_container")}else{ad.selectAll("*").remove()}}else{if(!aJ&&p){ad.append("svg:line").attr("x1",0).attr("y1",0).attr("x1",H?0:O).attr("y1",H?U:0).call(this.lineatt.func)}}ad.attr("transform",aq||null);var aD=1,ax=0,X=Math.min(I,N),M=(ap.indexOf("+")>=0),j=(ap.indexOf("-")>=0),ak=(ap.indexOf("S")>=0),ah=(ap.indexOf("Y")>=0),G=(ap.indexOf("0")>=0),Z=(ap.indexOf("O")>=0),k=(ap.indexOf("U")>=0),al=(ap.indexOf("N")>=0),E=(ap.indexOf("I")>=0),ao=q.TestBit(a.EAxisBits.kNoExponent);if(aG&&q.TestBit(a.EAxisBits.kTickPlus)){M=true}if(aG&&q.TestBit(a.EAxisBits.kTickMinus)){j=true}if(M&&j){aD=1;ax=1}else{if(j){aD=J(l,H)?1:-1}else{if(M){aD=J(l,H)?-1:1}}}L=Math.round((ak?L:0.03)*R);if(this.max_tick_size&&(L>this.max_tick_size)){L=this.max_tick_size}this.CreateFormatFuncs();var S="",aw="",v=0,B=0;this.ticks=[];var aa=this.CreateTicks(false,ao,al,E);while(aa.next(true)){var au=Math.round(L/4),ar=0;if(aa.kind<3){au=Math.round(L/2)}if(aa.kind==1){if(!("format" in this)||(this.format(aa.tick,true)!==null)){au=L}this.ticks.push(aa.grpos)}if(ax>0){ar=-au}else{if(aD<0){ar=-au;au=0}else{ar=0}}if(S.length==0){S=H?("M"+au+","+aa.grpos):("M"+aa.grpos+","+(-au));aw=H?("M"+(ag-au)+","+aa.grpos):("M"+aa.grpos+","+(ag+au))}else{S+=H?("m"+(au-B)+","+(aa.grpos-v)):("m"+(aa.grpos-v)+","+(B-au));aw+=H?("m"+(B-au)+","+(aa.grpos-v)):("m"+(aa.grpos-v)+","+(au-B))}S+=H?("h"+(ar-au)):("v"+(au-ar));aw+=H?("h"+(au-ar)):("v"+(ar-au));v=aa.grpos;B=ar}if((S.length>0)&&!aJ&&p){ad.append("svg:path").attr("d",S).call(this.lineatt.func)}if((ag!==0)&&(aw.length>0)&&!aJ&&p){ad.append("svg:path").attr("d",aw).call(this.lineatt.func)}var C=Math.round((q.fLabelSize<1)?q.fLabelSize*X:q.fLabelSize);if((C<=0)||(Math.abs(q.fLabelOffset)>1.1)){k=true}if(!aJ&&!k){var an=this.get_color(q.fLabelColor),av=Math.round(q.fLabelOffset*X),af=this.IsCenterLabels(),y=q.TestBit(a.EAxisBits.kLabelsVert),aI=1,A=0,am=false,Y=null,aj=[ad.append("svg:g").attr("class","axis_labels")],o=aa.lbl_pos||aa.major;if(this.lbls_both_sides){aj.push(ad.append("svg:g").attr("class","axis_labels").attr("transform",H?"translate("+O+",0)":"translate(0,"+(-U)+")"))}for(var K=0;K<aj.length;++K){if(K>0){aD=-aD}var v=0,aA=H?-av*aD:(av+2)*aD+ax*L;Y=a.Painter.getFontDetails(q.fLabelFont,C);this.StartTextDrawing(Y,"font",aj[K]);for(var D=0;D<o.length;++D){var u=this.format(o[D],true);if(u===null){continue}var at=Math.round(this.func(o[D])),ac=(D>0)?Math.abs(Math.round(at-this.func(o[D-1]))):0,x=(D<o.length-1)?Math.abs(Math.round(this.func(o[D+1])-at)):0;if(af){var T=x||ac;at=Math.round(at-(H?0.5*T:-0.5*T));if((at<-5)||(at>(H?U:O)+5)){continue}}var ay={text:u,color:an,latex:1,draw_g:aj[K]};A=Math.max(A,u.length);if(H){ay.x=aA;ay.y=at;ay.align=y?((aD<0)?23:20):((aD<0)?12:32)}else{ay.x=at;ay.y=aA;ay.align=y?((aD<0)?12:32):((aD<0)?20:23)}if(y){ay.rotate=270}var aH=this.DrawText(ay);if(aH&&((!H&&!y)||(H&&y))&&(this.kind!="log")){var m=ac*0.45+x*0.45;if(!ac){m=0.9*x}else{if(!x){m=0.9*ac}}aI=Math.min(aI,m/aH)}else{if(H&&ae&&!K&&(ae-av>20)&&(aH>ae-av)){aI=Math.min(aI,(ae-av)/aH)}}if(v&&(at!=v)&&((H&&!y)||(!H&&y))){var z=Math.abs(at-v);aI=Math.min(aI,0.9*z/C)}v=at}if(this.order){this.DrawText({color:an,x:H?aD*5:O+5,y:this.has_obstacle?aA:(H?-3:-3*aD),align:H?((aD<0)?30:10):(J(this.has_obstacle,(aD<0))?13:10),latex:1,text:"#times"+this.format10Exp(this.order),draw_g:aj[K]})}}if((aI>0.01)&&(aI<0.7)&&!H&&!y&&(A>5)&&!this.lbls_both_sides){am=true;aI*=3}for(var K=0;K<aj.length;++K){if((aI>0.01)&&(aI<1)){this.TextScaleFactor(1/aI,aj[K])}this.FinishTextDrawing(aj[K]);if(am){aj[K].selectAll("text").each(function(){var r=i.select(this),w=r.attr("transform");r.attr("transform",w+" rotate(25)").style("text-anchor","start")})}}if(aj.length>1){aD=-aD}if(Y){C=Y.size}}if(a.gStyle.Zooming&&!this.disable_zooming){var Q=ad.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair");if(H){Q.attr("x",(aD>0)?(-2*C-3):3).attr("y",0).attr("width",2*C+3).attr("height",U)}else{Q.attr("x",0).attr("y",(aD>0)?0:-C-3).attr("width",O).attr("height",C+3)}}if((q.fTitle.length>0)&&!aJ){var V=ad.append("svg:g").attr("class","axis_title"),ai=(q.fTitleSize>=1)?q.fTitleSize:Math.round(q.fTitleSize*X),n=1.6*(q.fTitleSize<1?q.fTitleSize:q.fTitleSize/(this.pad_height("")||10)),ab=q.TestBit(a.EAxisBits.kCenterTitle),W=q.TestBit(a.EAxisBits.kRotateTitle)?-1:1,s=this.get_color(q.fTitleColor),aC=0,aB=0;this.StartTextDrawing(q.fTitleFont,ai,V);var F=((W<0)&&!l)||((W>=0)&&l);if(H){n*=-aD*I;aC=Math.round(n*q.fTitleOffset);if((this.name=="zaxis")&&aG&&("getBoundingClientRect" in ad.node())){var t=ad.node().getBoundingClientRect();if(aC<t.width-L){aC=Math.round(t.width-L)}}aB=Math.round(ab?U/2:(l?U:0));this.DrawText({align:(ab?"middle":(F?"begin":"end"))+";middle",rotate:(W<0)?90:270,text:q.fTitle,color:s,draw_g:V})}else{n*=aD*N;aC=Math.round(ab?O/2:(l?0:O));aB=Math.round(n*q.fTitleOffset);this.DrawText({align:(ab?"middle":(F?"begin":"end"))+";middle",rotate:(W<0)?180:0,text:q.fTitle,color:s,draw_g:V})}var az=null;if(H&&(q.fTitleOffset==0)&&("getBoundingClientRect" in ad.node())){az=ad.node().getBoundingClientRect()}this.FinishTextDrawing(V,function(){if(az){var r=V.node().getBoundingClientRect();aC=(aD>0)?Math.round(az.left-r.right-ai*0.3):Math.round(az.right-r.left+ai*0.3)}V.attr("transform","translate("+aC+","+aB+")").property("shift_x",aC).property("shift_y",aB)});this.AddTitleDrag(V,H,n,l,H?U:O)}this.position=0;if("getBoundingClientRect" in ad.node()){var aF=ad.node().getBoundingClientRect(),aE=this.svg_pad().node().getBoundingClientRect();this.position=aF.left-aE.left}};h.prototype.Redraw=function(){var n=this.GetObject(),k=this.AxisToSvg("x",n.fX1,"pad"),y=this.AxisToSvg("y",n.fY1,"pad"),j=this.AxisToSvg("x",n.fX2,"pad"),v=this.AxisToSvg("y",n.fY2,"pad"),z=j-k,r=y-v,o=Math.abs(z)<Math.abs(r),l=null,s=false,m="normal",p=n.fWmin,u=n.fWmax,q=p,x=u;if(n.fChopt.indexOf("t")>=0){l=i.scaleTime();m="time";this.toffset=a.Painter.getTimeOffset(n);q=new Date(this.toffset+p*1000);x=new Date(this.toffset+u*1000)}else{if(n.fChopt.indexOf("G")>=0){l=i.scaleLog();m="log"}else{l=i.scaleLinear();m="normal"}}l.domain([q,x]);if(o){if(r>0){l.range([r,0])}else{var t=y;y=v;v=t;r=-r;s=true;l.range([0,r])}}else{if(z>0){l.range([0,z])}else{var t=k;k=j;j=t;z=-z;s=true;l.range([z,0])}}this.SetAxisConfig(o?"yaxis":"xaxis",m,l,p,u,p,u);this.CreateG();this.DrawAxis(o,this.draw_g,z,r,"translate("+k+","+v+")",s)};function d(j){a.TooltipHandler.call(this,j);this.mode3d=false;this.shrink_frame_left=0;this.x_kind="normal";this.y_kind="normal";this.xmin=this.xmax=0;this.ymin=this.ymax=0;this.axes_drawn=false;this.keys_handler=null;this.mode3d=false}d.prototype=Object.create(a.TooltipHandler.prototype);d.prototype.frame_painter=function(){return this};d.prototype.GetTipName=function(j){var k=a.TooltipHandler.prototype.GetTipName.call(this)||"TFrame";if(j){k+=j}return k};d.prototype.Shrink=function(k,j){this.fX1NDC+=k;this.fX2NDC-=j};d.prototype.SetLastEventPos=function(j){this.fLastEventPnt=j};d.prototype.GetLastEventPos=function(){return this.fLastEventPnt};d.prototype.UpdateAttributes=function(l){var k=this.GetObject();if((this.fX1NDC===undefined)||(l&&!this.modified_NDC)){a.extend(this,a.gStyle.FrameNDC);if(k&&k.fPos&&k.fSize){this.fX1NDC=k.fPos.fHoriz.fNormal.fVal;this.fX2NDC=this.fX1NDC+k.fSize.fHoriz.fNormal.fVal;this.fY1NDC=k.fPos.fVert.fNormal.fVal;this.fY2NDC=this.fY1NDC+k.fSize.fVert.fNormal.fVal}}if(this.fillatt===undefined){this.createAttFill({pattern:1001,color:0});var j="white";if(k&&k.fFillColor){j=this.canv_painter().GetNewColor(k.fFillColor,true)}this.fillatt.SetSolidColor(j)}this.createAttLine({color:"black"})};d.prototype.ProjectAitoff2xy=function(k,r){var q=Math.PI/180,s=(k/2)*q,t=r*q,j=Math.sqrt(2),o=2*j/Math.PI,m=Math.cos(t),n=Math.sqrt(1+m*Math.cos(s)),p={x:m*Math.sin(s)*2*j/n/o/q,y:Math.sin(t)*j/n/o/q};return p};d.prototype.ProjectMercator2xy=function(k,j){var m=Math.tan((Math.PI/2+j/180*Math.PI)/2);return{x:k,y:Math.log(m)}};d.prototype.ProjectSinusoidal2xy=function(k,j){return{x:k*Math.cos(j/180*Math.PI),y:j}};d.prototype.ProjectParabolic2xy=function(k,j){return{x:k*(2*Math.cos(2*j/180*Math.PI/3)-1),y:180*Math.sin(j/180*Math.PI/3)}};d.prototype.RecalculateRange=function(k){if(!k){return}var j=[];if(k==1){j.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymin));j.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymax));j.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymax));j.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){j.push(this.ProjectAitoff2xy(this.scale_xmin*0.9999,0));j.push(this.ProjectAitoff2xy(this.scale_xmax*0.9999,0))}if(this.scale_xmin<0&&this.scale_xmax>0){j.push(this.ProjectAitoff2xy(0,this.scale_ymin));j.push(this.ProjectAitoff2xy(0,this.scale_ymax))}}else{if(k==2){if(this.scale_ymin<=-90||this.scale_ymax>=90){console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax);this.options.Proj=0;return}j.push(this.ProjectMercator2xy(this.scale_xmin,this.scale_ymin));j.push(this.ProjectMercator2xy(this.scale_xmax,this.scale_ymax))}else{if(k==3){j.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymin));j.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymax));j.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymax));j.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){j.push(this.ProjectSinusoidal2xy(this.scale_xmin,0));j.push(this.ProjectSinusoidal2xy(this.scale_xmax,0))}if(this.scale_xmin<0&&this.scale_xmax>0){j.push(this.ProjectSinusoidal2xy(0,this.scale_ymin));j.push(this.ProjectSinusoidal2xy(0,this.scale_ymax))}}else{if(k==4){j.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymin));j.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymax));j.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymax));j.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymin));if(this.scale_ymin<0&&this.scale_ymax>0){j.push(this.ProjectParabolic2xy(this.scale_xmin,0));j.push(this.ProjectParabolic2xy(this.scale_xmax,0))}if(this.scale_xmin<0&&this.scale_xmax>0){j.push(this.ProjectParabolic2xy(0,this.scale_ymin));j.push(this.ProjectParabolic2xy(0,this.scale_ymax))}}}}}this.original_xmin=this.scale_xmin;this.original_xmax=this.scale_xmax;this.original_ymin=this.scale_ymin;this.original_ymax=this.scale_ymax;this.scale_xmin=this.scale_xmax=j[0].x;this.scale_ymin=this.scale_ymax=j[0].y;for(var l=1;l<j.length;++l){this.scale_xmin=Math.min(this.scale_xmin,j[l].x);this.scale_xmax=Math.max(this.scale_xmax,j[l].x);this.scale_ymin=Math.min(this.scale_ymin,j[l].y);this.scale_ymax=Math.max(this.scale_ymax,j[l].y)}};d.prototype.DrawGrids=function(){var m=this.svg_frame().select(".grid_layer");m.selectAll(".xgrid").remove();m.selectAll(".ygrid").remove();var o=this.frame_height(),j=this.frame_width(),l,p=a.gStyle.fGridStyle,k=(a.gStyle.fGridColor>0)?this.get_color(a.gStyle.fGridColor):"black";if((p<0)||(p>=a.Painter.root_line_styles.length)){p=11}if(this.x_handle){l="";for(var q=0;q<this.x_handle.ticks.length;++q){if(this.swap_xy){l+="M0,"+this.x_handle.ticks[q]+"h"+j}else{l+="M"+this.x_handle.ticks[q]+",0v"+o}}if(l.length>0){m.append("svg:path").attr("class","xgrid").attr("d",l).style("stroke",k).style("stroke-width",a.gStyle.fGridWidth).style("stroke-dasharray",a.Painter.root_line_styles[p])}}if(this.y_handle){l="";for(var q=0;q<this.y_handle.ticks.length;++q){if(this.swap_xy){l+="M"+this.y_handle.ticks[q]+",0v"+o}else{l+="M0,"+this.y_handle.ticks[q]+"h"+j}}if(l.length>0){m.append("svg:path").attr("class","ygrid").attr("d",l).style("stroke",k).style("stroke-width",a.gStyle.fGridWidth).style("stroke-dasharray",a.Painter.root_line_styles[p])}}};d.prototype.AxisAsText=function(j,k){if(j=="x"){if(this.x_kind=="time"){k=this.ConvertX(k)}if(this.x_handle&&("format" in this.x_handle)){return this.x_handle.format(k,false,a.gStyle.XValuesFormat)}}else{if(j=="y"){if(this.y_kind=="time"){k=this.ConvertY(k)}if(this.y_handle&&("format" in this.y_handle)){return this.y_handle.format(k,false,a.gStyle.YValuesFormat)}}else{if(this.z_handle&&("format" in this.z_handle)){return this.z_handle.format(k,false,a.gStyle.ZValuesFormat)}}}return k.toPrecision(4)};d.prototype.SetAxesRanges=function(m,k,l,j){if(this.axes_drawn){return}if((this.xmin==this.xmax)&&(m!==k)){this.xmin=m;this.xmax=k}if((this.ymin==this.ymax)&&(l!==j)){this.ymin=l;this.ymax=j}};d.prototype.DrawAxes=function(s){if(this.axes_drawn){return true}if((this.xmin==this.xmax)||(this.ymin==this.ymax)){return false}this.CleanupAxes();this.CleanXY();this.CreateXY();var q=this.svg_frame().select(".axis_layer"),u=this.frame_width(),p=this.frame_height(),v=a.Create("TAxis"),t=a.Create("TAxis");this.x_handle=new a.TAxisPainter(v,true);this.x_handle.SetDivId(this.divid,-1);this.x_handle.pad_name=this.pad_name;this.x_handle.SetAxisConfig("xaxis",(this.logx&&(this.x_kind!=="time"))?"log":this.x_kind,this.x,this.xmin,this.xmax,this.scale_xmin,this.scale_xmax);this.x_handle.invert_side=false;this.x_handle.lbls_both_sides=false;this.x_handle.has_obstacle=false;this.y_handle=new a.TAxisPainter(t,true);this.y_handle.SetDivId(this.divid,-1);this.y_handle.pad_name=this.pad_name;this.y_handle.SetAxisConfig("yaxis",(this.logy&&this.y_kind!=="time")?"log":this.y_kind,this.y,this.ymin,this.ymax,this.scale_ymin,this.scale_ymax);this.y_handle.invert_side=false;this.y_handle.lbls_both_sides=false;var r=this.swap_xy?this.y_handle:this.x_handle,l=this.swap_xy?this.x_handle:this.y_handle,k=false,j=false;if(!k){var n=this.pad_painter();if(n&&n._fast_drawing){k=true}}if(!k){r.DrawAxis(false,q,u,p,r.invert_side?undefined:"translate(0,"+p+")",false,j?-p:0,k);l.DrawAxis(true,q,u,p,l.invert_side?"translate("+u+",0)":undefined,false,j?u:0,k,l.invert_side?0:this.frame_x());this.DrawGrids()}if(!s&&a.gStyle.CanAdjustFrame&&!k){var o=0,m=l.position;if((-0.2*u<m)&&(m<0)){o=-m/u+0.001;this.shrink_frame_left+=o}else{if((m>0)&&(m<0.3*u)&&(this.shrink_frame_left>0)&&(m/u>this.shrink_frame_left)){o=-this.shrink_frame_left;this.shrink_frame_left=0}}if(o!=0){this.Shrink(o,0);this.Redraw();this.DrawAxes(true)}}this.axes_drawn=true;return true};d.prototype.SizeChanged=function(){this.RedrawPad()};d.prototype.CleanXY=function(){delete this.x;delete this.grx;delete this.ConvertX;delete this.RevertX;delete this.y;delete this.gry;delete this.ConvertY;delete this.RevertY;delete this.z;delete this.grz};d.prototype.CleanupAxes=function(){if(this.x_handle){this.x_handle.Cleanup();delete this.x_handle}if(this.y_handle){this.y_handle.Cleanup();delete this.y_handle}if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}if(this.draw_g){this.draw_g.select(".grid_layer").selectAll("*").remove();this.draw_g.select(".axis_layer").selectAll("*").remove()}this.axes_drawn=false};d.prototype.CleanDrawings=function(){if(typeof this.Create3DScene==="function"){this.Create3DScene(-1)}this.CleanupAxes();this.CleanXY();this.xmin=this.xmax=0;this.ymin=this.ymax=0;this.zmin=this.zmax=0;this.zoom_xmin=this.zoom_xmax=0;this.zoom_ymin=this.zoom_ymax=0;this.zoom_zmin=this.zoom_zmax=0;this.scale_xmin=this.scale_xmax=0;this.scale_ymin=this.scale_ymax=0;this.scale_zmin=this.scale_zmax=0;if(this.draw_g){this.draw_g.select(".main_layer").selectAll("*").remove();this.draw_g.select(".upper_layer").selectAll("*").remove()}};d.prototype.Cleanup=function(){this.CleanDrawings();if(this.draw_g){this.draw_g.selectAll("*").remove();this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null)}if(this.keys_handler){window.removeEventListener("keydown",this.keys_handler,false);this.keys_handler=null}this.draw_g=null;delete this._click_handler;delete this._dblclick_handler;a.TooltipHandler.prototype.Cleanup.call(this)};d.prototype.Redraw=function(){var y=this.pad_painter();if(y){y.frame_painter_ref=this}if(this.mode3d){return}this.UpdateAttributes();var x=this.pad_width(),u=this.pad_height(),s=Math.round(x*this.fX1NDC),t=Math.round(x*(this.fX2NDC-this.fX1NDC)),m=Math.round(u*(1-this.fY2NDC)),B=Math.round(u*(this.fY2NDC-this.fY1NDC)),A=false,q=false;if(y&&y.options){if(y.options.RotateFrame){A=true}if(y.options.FixFrame){q=true}}this.draw_g=this.svg_layer("primitives_layer").select(".root_frame");var p,n;if(this.draw_g.empty()){var D=this.svg_layer("primitives_layer");this.draw_g=D.append("svg:g").attr("class","root_frame");this.draw_g.append("svg:title").text("");p=this.draw_g.append("svg:rect");this.draw_g.append("svg:g").attr("class","grid_layer");n=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden");this.draw_g.append("svg:g").attr("class","axis_layer");this.draw_g.append("svg:g").attr("class","upper_layer")}else{p=this.draw_g.select("rect");n=this.draw_g.select(".main_layer")}this.axes_drawn=false;var o="translate("+s+","+m+")";if(A){o+=" rotate(-90) translate("+-B+",0)";var C=t;t=B;B=C}this._frame_x=s;this._frame_y=m;this._frame_width=t;this._frame_height=B;this.draw_g.attr("transform",o);p.attr("x",0).attr("y",0).attr("width",t).attr("height",B).call(this.fillatt.func).call(this.lineatt.func);n.attr("width",t).attr("height",B).attr("viewBox","0 0 "+t+" "+B);var v=this.draw_g.select(".interactive_rect");if(a.BatchMode){return v.remove()}this.draw_g.attr("x",s).attr("y",m).attr("width",t).attr("height",B);if(!A&&!q){this.AddDrag({obj:this,only_resize:true,minwidth:20,minheight:20,redraw:this.SizeChanged.bind(this)})}if(v.empty()){v=this.draw_g.append("rect").attr("class","interactive_rect").style("opacity",0).style("fill","none").style("pointer-events","visibleFill").property("handlers_set",0)}var z=(y&&y._fast_drawing)?0:1;if(v.property("handlers_set")!=z){var l=z?this.ProcessTooltipEvent.bind(this,null):null,r=z?this.ProcessTooltipEvent.bind(this,{handler:true,touch:false}):null;v.property("handlers_set",z).on("mouseenter",r).on("mousemove",r).on("mouseleave",l);if(a.touches){var k=z?this.ProcessTooltipEvent.bind(this,{handler:true,touch:true}):null;v.on("touchstart",k).on("touchmove",k).on("touchend",l).on("touchcancel",l)}}v.attr("x",0).attr("y",0).attr("width",t).attr("height",B);var j=this.hints_layer().select(".objects_hints");if(!j.empty()&&this.tooltip_allowed&&(j.property("hints_pad")==this.pad_name)){setTimeout(this.ProcessTooltipEvent.bind(this,j.property("last_point")),10)}};d.prototype.GetFrameRect=function(){return{x:this.frame_x(),y:this.frame_y(),width:this.frame_width(),height:this.frame_height(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};d.prototype.ProcessFrameClick=function(r,j){var l=this.pad_painter();if(!l){return}r.painters=true;r.disabled=true;var q=l.GetTooltips(r),p=null;for(var m=0;(m<q.length)&&!p;++m){if(q[m]&&q[m].exact){p=q[m]}}var n;if(p){var o=j?this._dblclick_handler:this._click_handler;if(o){n=o(p.user_info,r)}}if(!j){l.SelectObjectPainter(p?p.painter:this,{x:r.x+(this._frame_x||0),y:r.y+(this._frame_y||0)})}return n};d.prototype.ConfigureUserClickHandler=function(j){this._click_handler=j&&(typeof j=="function")?j:null};d.prototype.ConfigureUserDblclickHandler=function(j){this._dblclick_handler=j&&(typeof j=="function")?j:null};d.prototype.Zoom=function(k,r,u,n,s,v){if(this.options&&this.options.Proj){return false}if(k==="x"){k=r;r=u;u=undefined}else{if(k==="y"){n=u;u=r;k=r=undefined}else{if(k==="z"){s=r;v=u;k=r=u=undefined}}}var p=(k!==r),m=(u!==n),l=(s!==v),j=false,x=false,w=false;if(p){var o=0;if(k<=this.xmin){k=this.xmin;o++}if(r>=this.xmax){r=this.xmax;o++}if(o===2){p=false;j=true}}else{j=(k===r)&&(k===0)}if(m){var o=0;if(u<=this.ymin){u=this.ymin;o++}if(n>=this.ymax){n=this.ymax;o++}if(o===2){m=false;x=true}}else{x=(u===n)&&(u===0)}if(l){var o=0;if(s<=this.zmin){s=this.zmin;o++}if(v>=this.zmax){v=this.zmax;o++}if(o===2){l=false;w=true}}else{w=(s===v)&&(s===0)}var q=false,t=this;if(p||m||l){this.ForEachPainter(function(y){if(p&&y.CanZoomIn("x",k,r)){t.zoom_xmin=k;t.zoom_xmax=r;q=true;p=false}if(m&&y.CanZoomIn("y",u,n)){t.zoom_ymin=u;t.zoom_ymax=n;q=true;m=false}if(l&&y.CanZoomIn("z",s,v)){t.zoom_zmin=s;t.zoom_zmax=v;q=true;l=false}})}if(j||x||w){if(j){if(this.zoom_xmin!==this.zoom_xmax){q=true}this.zoom_xmin=this.zoom_xmax=0}if(x){if(this.zoom_ymin!==this.zoom_ymax){q=true}this.zoom_ymin=this.zoom_ymax=0}if(w){if(this.zoom_zmin!==this.zoom_zmax){q=true}this.zoom_zmin=this.zoom_zmax=0}}if(q){this.RedrawPad()}return q};d.prototype.IsAxisZoomed=function(j){return this["zoom_"+j+"min"]!==this["zoom_"+j+"max"]};d.prototype.Unzoom=function(n,l,k){if(typeof n==="undefined"){n=true;l=true;k=true}else{if(typeof n==="string"){k=n.indexOf("z")>=0;l=n.indexOf("y")>=0;n=n.indexOf("x")>=0}}var j=this.zoom_changed_interactive;if(n||l||n){this.zoom_changed_interactive=2}var m=this.Zoom(n?0:undefined,n?0:undefined,l?0:undefined,l?0:undefined,k?0:undefined,k?0:undefined);if((n||l||n)&&!m){this.zoom_changed_interactive=(!isNaN(j)&&(j>0))?j-1:0}return m};d.prototype.clearInteractiveElements=function(){a.Painter.closeMenu();if(this.zoom_rect){this.zoom_rect.remove();this.zoom_rect=null}this.zoom_kind=0;this.SwitchTooltip(true)};d.prototype.mouseDoubleClick=function(){i.event.preventDefault();var j=i.mouse(this.svg_frame().node());this.clearInteractiveElements();var n=(j[0]>=0)&&(j[0]<=this.frame_width()),l=(j[1]>=0)&&(j[1]<=this.frame_height());if(n&&l&&this._dblclick_handler){if(this.ProcessFrameClick({x:j[0],y:j[1]},true)){return}}var k="xyz";if(!n){k=this.swap_xy?"x":"y"}else{if(!l){k=this.swap_xy?"y":"x"}}if(this.Unzoom(k)){return}};d.prototype.FindAlternativeClickHandler=function(o){var j=this.pad_painter();if(!j){return false}var n={x:o[0],y:o[1],painters:true,disabled:true,click_handler:true};var m=j.GetTooltips(n);for(var l=0;l<m.length;++l){if(m[l]&&(typeof m[l].click_handler=="function")){m[l].click_handler(m[l]);return true}}return false};d.prototype.startRectSel=function(){if(this.zoom_kind>100){return}if((i.event.which||i.event.button)!==1){return}i.event.preventDefault();var l=i.mouse(this.svg_frame().node());if(this.FindAlternativeClickHandler(l)){return}this.clearInteractiveElements();this.zoom_origin=l;var j=this.frame_width(),k=this.frame_height();this.zoom_curr=[Math.max(0,Math.min(j,this.zoom_origin[0])),Math.max(0,Math.min(k,this.zoom_origin[1]))];if((this.zoom_origin[0]<0)||(this.zoom_origin[0]>j)){this.zoom_kind=3;this.zoom_origin[0]=0;this.zoom_origin[1]=this.zoom_curr[1];this.zoom_curr[0]=j;this.zoom_curr[1]+=1}else{if((this.zoom_origin[1]<0)||(this.zoom_origin[1]>k)){this.zoom_kind=2;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=0;this.zoom_curr[0]+=1;this.zoom_curr[1]=k}else{this.zoom_kind=1;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=this.zoom_curr[1]}}i.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),true);this.zoom_rect=null;this.SwitchTooltip(false);i.event.stopPropagation()};d.prototype.moveRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}i.event.preventDefault();var j=i.mouse(this.svg_frame().node());j[0]=Math.max(0,Math.min(this.frame_width(),j[0]));j[1]=Math.max(0,Math.min(this.frame_height(),j[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=j[0];this.zoom_curr[1]=j[1];break;case 2:this.zoom_curr[0]=j[0];break;case 3:this.zoom_curr[1]=j[1];break}if(this.zoom_rect===null){this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("pointer-events","none")}this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]))};d.prototype.endRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}i.event.preventDefault();i.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);var o=i.mouse(this.svg_frame().node()),q=[true,true];o[0]=Math.max(0,Math.min(this.frame_width(),o[0]));o[1]=Math.max(0,Math.min(this.frame_height(),o[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=o[0];this.zoom_curr[1]=o[1];break;case 2:this.zoom_curr[0]=o[0];q[1]=false;break;case 3:this.zoom_curr[1]=o[1];q[0]=false;break}var k,s,v,n,r=false,w=this.swap_xy?1:0,u=1-w;if(q[w]&&(Math.abs(this.zoom_curr[w]-this.zoom_origin[w])>10)){k=Math.min(this.RevertX(this.zoom_origin[w]),this.RevertX(this.zoom_curr[w]));s=Math.max(this.RevertX(this.zoom_origin[w]),this.RevertX(this.zoom_curr[w]));r=true}if(q[u]&&(Math.abs(this.zoom_curr[u]-this.zoom_origin[u])>10)){v=Math.min(this.RevertY(this.zoom_origin[u]),this.RevertY(this.zoom_curr[u]));n=Math.max(this.RevertY(this.zoom_origin[u]),this.RevertY(this.zoom_curr[u]));r=true}var p=this.zoom_kind,j=(p===1)?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;this.clearInteractiveElements();if(r){this.zoom_changed_interactive=2;this.Zoom(k,s,v,n)}else{switch(p){case 1:var t=this.frame_painter();if(t){t.ProcessFrameClick(j)}break;case 2:var l=this.pad_painter();if(l){l.SelectObjectPainter(this.x_handle)}break;case 3:var l=this.pad_painter();if(l){l.SelectObjectPainter(this.y_handle)}break}}this.zoom_kind=0};d.prototype.startTouchZoom=function(){if(this.zoom_kind!=0){i.event.preventDefault();i.event.stopPropagation();return}var k=i.touches(this.svg_frame().node());this.touch_cnt+=1;if(k.length==1){var m=new Date(),o=m.getTime()-this.last_touch.getTime();this.last_touch=m;if((o<300)&&this.zoom_curr&&(Math.abs(this.zoom_curr[0]-k[0][0])<30)&&(Math.abs(this.zoom_curr[1]-k[0][1])<30)){i.event.preventDefault();i.event.stopPropagation();this.clearInteractiveElements();this.Unzoom("xyz");this.last_touch=new Date(0);this.svg_frame().on("touchcancel",null).on("touchend",null,true)}else{if(a.gStyle.ContextMenu){this.zoom_curr=k[0];this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this));i.event.preventDefault();i.event.stopPropagation()}}}if((k.length!=2)||!a.gStyle.Zooming||!a.gStyle.ZoomTouch){return}i.event.preventDefault();i.event.stopPropagation();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null);var j=k[0],p=k[1],l=this.frame_width(),n=this.frame_height();this.zoom_curr=[Math.min(j[0],p[0]),Math.min(j[1],p[1])];this.zoom_origin=[Math.max(j[0],p[0]),Math.max(j[1],p[1])];if((this.zoom_curr[0]<0)||(this.zoom_curr[0]>l)){this.zoom_kind=103;this.zoom_curr[0]=0;this.zoom_origin[0]=l}else{if((this.zoom_origin[1]>n)||(this.zoom_origin[1]<0)){this.zoom_kind=102;this.zoom_curr[1]=0;this.zoom_origin[1]=n}else{this.zoom_kind=101}}this.SwitchTooltip(false);this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);i.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",this.endTouchSel.bind(this))};d.prototype.moveTouchSel=function(){if(this.zoom_kind<100){return}i.event.preventDefault();var k=i.touches(this.svg_frame().node());if(k.length!=2){return this.clearInteractiveElements()}var j=k[0],l=k[1];if(this.zoom_kind!=103){this.zoom_curr[0]=Math.min(j[0],l[0]);this.zoom_origin[0]=Math.max(j[0],l[0])}if(this.zoom_kind!=102){this.zoom_curr[1]=Math.min(j[1],l[1]);this.zoom_origin[1]=Math.max(j[1],l[1])}this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);if((this.zoom_origin[0]-this.zoom_curr[0]>10)||(this.zoom_origin[1]-this.zoom_curr[1]>10)){this.SwitchTooltip(false)}i.event.stopPropagation()};d.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null);if(this.zoom_kind===0){i.event.preventDefault();var k=new Date();var r=k.getTime()-this.last_touch.getTime();if((r>500)&&(r<2000)&&!this.frame_painter().IsTooltipShown()){this.ShowContextMenu("main",{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]});this.last_touch=new Date(0)}else{this.clearInteractiveElements()}}if(this.zoom_kind<100){return}i.event.preventDefault();i.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);var j,q,s,l,p=false,m=this.swap_xy?1:0,o=1-m,n=[true,true];if(this.zoom_kind===102){n[1]=false}if(this.zoom_kind===103){n[0]=false}if(n[m]&&(Math.abs(this.zoom_curr[m]-this.zoom_origin[m])>10)){j=Math.min(this.RevertX(this.zoom_origin[m]),this.RevertX(this.zoom_curr[m]));q=Math.max(this.RevertX(this.zoom_origin[m]),this.RevertX(this.zoom_curr[m]));p=true}if(n[o]&&(Math.abs(this.zoom_curr[o]-this.zoom_origin[o])>10)){s=Math.min(this.RevertY(this.zoom_origin[o]),this.RevertY(this.zoom_curr[o]));l=Math.max(this.RevertY(this.zoom_origin[o]),this.RevertY(this.zoom_curr[o]));p=true}this.clearInteractiveElements();this.last_touch=new Date(0);if(p){this.zoom_changed_interactive=2;this.Zoom(j,q,s,l)}i.event.stopPropagation()};d.prototype.ShowContextMenu=function(r,y,s){if(("zoom_kind" in this)&&(this.zoom_kind>100)){return}var w=this,t=false,u=this;if(!y){i.event.preventDefault();i.event.stopPropagation();y=i.event;if(r===undefined){var k=i.mouse(this.svg_frame().node()),q=i.touches(this.svg_frame().node()),o=this.pad_painter(),j=null,m=null;if(q.length===1){j={x:q[0][0],y:q[0][1],touch:true}}else{if(k.length===2){j={x:k[0],y:k[1],touch:false}}}if((j!==null)&&(o!==null)){j.painters=true;var l=o.GetTooltips(j),x=1000;for(var p=0;p<l.length;++p){if(l[p]&&l[p].menu){var v=("menu_dist" in l[p])?l[p].menu_dist:7;if(v<x){m=l[p].painter;x=v}}}}if(m!==null){w=m}if(j!==null){t=(j.x>0)&&(j.x<20)&&(j.y>0)&&(j.y<20)}this.SetLastEventPos(j)}}w.ctx_menu_evnt=y;a.Painter.createMenu(w,function(z){var n=z.painter.FillContextMenu(z,r,s);if(u&&(!n||(t&&(r!=="frame")&&(u!=z.painter)))){n=u.FillContextMenu(z)}if(n){z.painter.FillObjectExecMenu(z,r,function(){z.painter.SwitchTooltip(false);z.show(z.painter.ctx_menu_evnt,z.painter.SwitchTooltip.bind(z.painter,true))})}})};d.prototype.FillContextMenu=function(n,k,l){this.clearInteractiveElements();if((k=="x")||(k=="y")){var j=null;n.add("header: "+k.toUpperCase()+" axis");n.add("Unzoom",this.Unzoom.bind(this,k));if(this[k+"_kind"]=="normal"){n.addchk(this["log"+k],"SetLog"+k,this.ToggleLog.bind(this,k))}if(j){n.addchk(j.TestBit(a.EAxisBits.kMoreLogLabels),"More log",function(){j.InvertBit(a.EAxisBits.kMoreLogLabels);this.RedrawPad()});n.addchk(j.TestBit(a.EAxisBits.kNoExponent),"No exponent",function(){j.InvertBit(a.EAxisBits.kNoExponent);this.RedrawPad()});n.add("sub:Labels");n.addchk(j.TestBit(a.EAxisBits.kCenterLabels),"Center",function(){j.InvertBit(a.EAxisBits.kCenterLabels);this.RedrawPad()});n.addchk(j.TestBit(a.EAxisBits.kLabelsVert),"Rotate",function(){j.InvertBit(a.EAxisBits.kLabelsVert);this.RedrawPad()});this.AddColorMenuEntry(n,"Color",j.fLabelColor,function(o){j.fLabelColor=parseInt(o);this.RedrawPad()});this.AddSizeMenuEntry(n,"Offset",0,0.1,0.01,j.fLabelOffset,function(o){j.fLabelOffset=parseFloat(o);this.RedrawPad()});this.AddSizeMenuEntry(n,"Size",0.02,0.11,0.01,j.fLabelSize,function(o){j.fLabelSize=parseFloat(o);this.RedrawPad()});n.add("endsub:");n.add("sub:Title");n.add("SetTitle",function(){var o=prompt("Enter axis title",j.fTitle);if(o!==null){j.fTitle=o;this.RedrawPad()}});n.addchk(j.TestBit(a.EAxisBits.kCenterTitle),"Center",function(){j.InvertBit(a.EAxisBits.kCenterTitle);this.RedrawPad()});n.addchk(j.TestBit(a.EAxisBits.kRotateTitle),"Rotate",function(){j.InvertBit(a.EAxisBits.kRotateTitle);this.RedrawPad()});this.AddColorMenuEntry(n,"Color",j.fTitleColor,function(o){j.fTitleColor=parseInt(o);this.RedrawPad()});this.AddSizeMenuEntry(n,"Offset",0,3,0.2,j.fTitleOffset,function(o){j.fTitleOffset=parseFloat(o);this.RedrawPad()});this.AddSizeMenuEntry(n,"Size",0.02,0.11,0.01,j.fTitleSize,function(o){j.fTitleSize=parseFloat(o);this.RedrawPad()});n.add("endsub:");n.add("sub:Ticks");this.AddColorMenuEntry(n,"Color",j.fAxisColor,function(o){j.fAxisColor=parseInt(o);this.RedrawPad()});this.AddSizeMenuEntry(n,"Size",-0.05,0.055,0.01,j.fTickLength,function(o){j.fTickLength=parseFloat(o);this.RedrawPad()});n.add("endsub:")}return true}var m=n.size()==0;if(m){n.add("header:Frame")}else{n.add("separator")}if(this.zoom_xmin!==this.zoom_xmax){n.add("Unzoom X",this.Unzoom.bind(this,"x"))}if(this.zoom_ymin!==this.zoom_ymax){n.add("Unzoom Y",this.Unzoom.bind(this,"y"))}if(this.zoom_zmin!==this.zoom_zmax){n.add("Unzoom Z",this.Unzoom.bind(this,"z"))}n.add("Unzoom all",this.Unzoom.bind(this,"xyz"));n.addchk(this.logx,"SetLogx",this.ToggleLog.bind(this,"x"));n.addchk(this.logy,"SetLogy",this.ToggleLog.bind(this,"y"));n.add("separator");n.addchk(this.tooltip_allowed,"Show tooltips",function(){var o=this.frame_painter();if(o){o.tooltip_allowed=!o.tooltip_allowed}});this.FillAttContextMenu(n,m?"":"Frame ");n.add("separator");n.add("Save as frame.png",function(){this.pad_painter().SaveAs("png","frame","frame.png")});n.add("Save as frame.svg",function(){this.pad_painter().SaveAs("svg","frame","frame.svg")});return true};d.prototype.ShowAxisStatus=function(n){var l=this.GetShowStatusFunc();if(!l){return}var o=null;var r=n,k="TAxis";if(o){r=o.fName;k=o.fTitle||"histogram TAxis object"}var j=i.mouse(this.svg_frame().node());var q=(n=="x")?0:1;if(this.swap_xy){q=1-q}var p=(n=="x")?this.RevertX(j[q]):this.RevertY(j[q]);l(r,k,n+" : "+this.AxisAsText(n,p),j[0].toFixed(0)+","+j[1].toFixed(0))};d.prototype.AddInteractive=function(){if(a.BatchMode||(!a.gStyle.Zooming&&!a.gStyle.ContextMenu)){return}var j=this.pad_painter();if(j&&j._fast_drawing){return}var k=this.svg_frame();if(k.empty()){return}var m=k.selectAll(".xaxis_container"),l=k.selectAll(".yaxis_container");if(!k.property("interactive_set")){this.AddKeysHandler();this.last_touch=new Date(0);this.zoom_kind=0;this.zoom_rect=null;this.zoom_origin=null;this.zoom_curr=null;this.touch_cnt=0}if(a.gStyle.Zooming&&(!this.options||!this.options.Proj)){if(a.gStyle.ZoomMouse){k.on("mousedown",this.startRectSel.bind(this));k.on("dblclick",this.mouseDoubleClick.bind(this))}if(a.gStyle.ZoomWheel){k.on("wheel",this.mouseWheel.bind(this))}}if(a.touches&&((a.gStyle.Zooming&&a.gStyle.ZoomTouch)||a.gStyle.ContextMenu)){k.on("touchstart",this.startTouchZoom.bind(this))}if(a.gStyle.ContextMenu){if(a.touches){m.on("touchstart",this.startTouchMenu.bind(this,"x"));l.on("touchstart",this.startTouchMenu.bind(this,"y"))}k.on("contextmenu",this.ShowContextMenu.bind(this));m.on("contextmenu",this.ShowContextMenu.bind(this,"x"));l.on("contextmenu",this.ShowContextMenu.bind(this,"y"))}m.on("mousemove",this.ShowAxisStatus.bind(this,"x"));l.on("mousemove",this.ShowAxisStatus.bind(this,"y"));k.property("interactive_set",true)};d.prototype.mouseWheel=function(){i.event.stopPropagation();i.event.preventDefault();this.clearInteractiveElements();var m={name:"x",ignore:false},l={name:"y",ignore:!this.AllowDefaultYZooming()},n=i.mouse(this.svg_frame().node()),j=this.frame_width(),k=this.frame_height();this.AnalyzeMouseWheelEvent(i.event,this.swap_xy?l:m,n[0]/j,(n[1]>=0)&&(n[1]<=k));this.AnalyzeMouseWheelEvent(i.event,this.swap_xy?m:l,1-n[1]/k,(n[0]>=0)&&(n[0]<=j));this.Zoom(m.min,m.max,l.min,l.max);if(m.changed||l.changed){this.zoom_changed_interactive=2}};d.prototype.AllowDefaultYZooming=function(){var m=this.pad_painter();if(m&&m.painters){for(var l=0;l<m.painters.length;++l){var j=m.painters[l];if(j&&(j.wheel_zoomy!==undefined)){return j.wheel_zoomy}}}return false};d.prototype.AnalyzeMouseWheelEvent=function(j,v,l,q){v.min=v.max=undefined;v.changed=false;if(q&&v.ignore){return}var u=0,w=1,s=1;if("dleft" in v){w=v.dleft;u=1}if("dright" in v){s=v.dright;u=1}if("delta" in v){u=v.delta}else{if(j&&j.wheelDelta!==undefined){u=-j.wheelDelta}else{if(j&&j.deltaY!==undefined){u=j.deltaY}else{if(j&&j.detail!==undefined){u=j.detail}}}}if(u===0){return}u=(u<0)?-0.2:0.2;w*=u;s*=u;var k=v.min=this["scale_"+v.name+"min"],n=v.max=this["scale_"+v.name+"max"],m=this[v.name+"min"],t=this[v.name+"max"];if((v.min===v.max)&&(u<0)){v.min=m;v.max=t}if(v.min>=v.max){return}if((l>0)&&(l<1)){if(this["log"+v.name]){var r=(v.min>0)?a.log10(v.max/v.min):2;if(r>10){r=10}else{if(r<0.01){r=0.01}}v.min=v.min/Math.pow(10,r*w*l);v.max=v.max*Math.pow(10,r*s*(1-l))}else{var o=(v.max-v.min),p=o;if(w>0){o=1.001*o/(1-w)}v.min+=-w*l*o;if(s>0){p=1.001*p/(1-s)}v.max-=-s*(1-l)*p}if(v.min>=v.max){v.min=v.max=undefined}else{if(w!==s){if(((v.min<m)&&(k===m))||((v.max>t)&&(n==t))){v.min=v.max=undefined}}}}else{v.min=v.max=undefined}v.changed=((v.min!==undefined)&&(v.max!==undefined))};d.prototype.AddKeysHandler=function(){if(this.keys_handler||a.BatchMode||(typeof window=="undefined")){return}this.keys_handler=this.ProcessKeyPress.bind(this);window.addEventListener("keydown",this.keys_handler,false)};d.prototype.ProcessKeyPress=function(p){var j=this.select_main();if(j.empty()){return}var o=j.attr("frame_active");if(o&&o!=="true"){return}var l="";switch(p.keyCode){case 33:l="PageUp";break;case 34:l="PageDown";break;case 37:l="ArrowLeft";break;case 38:l="ArrowUp";break;case 39:l="ArrowRight";break;case 40:l="ArrowDown";break;case 42:l="PrintScreen";break;case 106:l="*";break;default:return false}if(p.shiftKey){l="Shift "+l}if(p.altKey){l="Alt "+l}if(p.ctrlKey){l="Ctrl "+l}var n={name:"x",dleft:0,dright:0};switch(l){case"ArrowLeft":n.dleft=-1;n.dright=1;break;case"ArrowRight":n.dleft=1;n.dright=-1;break;case"Ctrl ArrowLeft":n.dleft=n.dright=-1;break;case"Ctrl ArrowRight":n.dleft=n.dright=1;break;case"ArrowUp":n.name="y";n.dleft=1;n.dright=-1;break;case"ArrowDown":n.name="y";n.dleft=-1;n.dright=1;break;case"Ctrl ArrowUp":n.name="y";n.dleft=n.dright=1;break;case"Ctrl ArrowDown":n.name="y";n.dleft=n.dright=-1;break}if(n.dleft||n.dright){if(!a.gStyle.Zooming){return false}if(this.mode3d&&(l.indexOf("Ctrl")!==0)){return false}this.AnalyzeMouseWheelEvent(null,n,0.5);this.Zoom(n.name,n.min,n.max);if(n.changed){this.zoom_changed_interactive=2}p.stopPropagation();p.preventDefault()}else{var k=this.pad_painter(),m=k?k.FindButton(l):"";if(m){k.PadButtonClick(m);p.stopPropagation();p.preventDefault()}}return true};d.prototype.CreateXY=function(){this.swap_xy=false;this.reverse_x=false;this.reverse_y=false;this.logx=this.logy=false;var j=this.frame_width(),m=this.frame_height();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;if(false){this.x_kind="time";this.timeoffsetx=a.Painter.getTimeOffset(this.histo.fXaxis);this.ConvertX=function(n){return new Date(this.timeoffsetx+n*1000)};this.RevertX=function(n){return(this.x.invert(n)-this.timeoffsetx)/1000}}else{this.x_kind="normal";this.ConvertX=function(n){return n};this.RevertX=function(n){return this.x.invert(n)}}if(this.zoom_xmin!=this.zoom_xmax){this.scale_xmin=this.zoom_xmin;this.scale_xmax=this.zoom_xmax}if(this.x_kind=="time"){this.x=i.scaleTime()}else{if(this.logx){if(this.scale_xmax<=0){this.scale_xmax=1}if((this.scale_xmin<=0)||(this.scale_xmin>=this.scale_xmax)){this.scale_xmin=this.scale_xmax*0.0001}this.x=i.scaleLog()}else{this.x=i.scaleLinear()}}var l=this.reverse_x?[j,0]:[0,j],k=this.reverse_y?[0,m]:[m,0];this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range(this.swap_xy?k:l);if(this.x_kind=="time"){this.grx=function(n){return this.x(this.ConvertX(n))}}else{if(this.logx){this.grx=function(n){return(n<this.scale_xmin)?(this.swap_xy?this.x.range()[0]+5:-5):this.x(n)}}else{this.grx=this.x}}if(this.zoom_ymin!=this.zoom_ymax){this.scale_ymin=this.zoom_ymin;this.scale_ymax=this.zoom_ymax}if(false){this.y_kind="time";this.timeoffsety=a.Painter.getTimeOffset(this.histo.fYaxis);this.ConvertY=function(n){return new Date(this.timeoffsety+n*1000)};this.RevertY=function(n){return(this.y.invert(n)-this.timeoffsety)/1000}}else{this.y_kind="normal";this.ConvertY=function(n){return n};this.RevertY=function(n){return this.y.invert(n)}}if(this.logy){if(this.scale_ymax<=0){this.scale_ymax=1}if((this.scale_ymin<=0)||(this.scale_ymin>=this.scale_ymax)){this.scale_ymin=0.0003*this.scale_ymax}this.y=i.scaleLog()}else{if(this.y_kind=="time"){this.y=i.scaleTime()}else{this.y=i.scaleLinear()}}this.y.domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range(this.swap_xy?l:k);if(this.y_kind=="time"){this.gry=function(n){return this.y(this.ConvertY(n))}}else{if(this.logy){this.gry=function(n){return(n<this.scale_ymin)?(this.swap_xy?-5:this.y.range()[0]+5):this.y(n)}}else{this.gry=this.y}}};d.prototype.SetRootPadRange=function(k,j){};d.prototype.ToggleLog=function(n){var k=this.main_painter()||this,p=this.root_pad();var o=p["fLog"+n];if(!o){var m=this[n+"_kind"];if(this.swap_xy&&n==="x"){m=this["y_kind"]}else{if(this.swap_xy&&n==="y"){m=this["x_kind"]}}if(m==="labels"){return}}var j=this.pad_painter(),l=this.canv_painter();if(j&&j.snapid&&l&&l._websocket){l.SendWebsocket("OBJEXEC:"+j.snapid+":SetLog"+n+(o?"(0)":"(1)"))}else{p["fLog"+n]=o?0:1;k.RedrawPad()}};function g(m,l,j){var k=new d(l);if(j=="3d"){k.mode3d=true}k.SetDivId(m,2);k.Redraw();return k.DrawingReady()}function b(k,j){a.TObjectPainter.call(this,k);this.pad=k;this.iscan=j;this.this_pad_name="";if(!this.iscan&&(k!==null)){if(k.fObjectID){this.this_pad_name="pad"+k.fObjectID}else{this.this_pad_name="ppp"+a.id_counter++}}this.painters=[];this.has_canvas=true}b.prototype=Object.create(a.TObjectPainter.prototype);b.prototype.Cleanup=function(){for(var l=0;l<this.painters.length;++l){this.painters[l].Cleanup()}var j=this.svg_pad(this.this_pad_name);if(!j.empty()){j.property("pad_painter",null);j.property("mainpainter",null);if(!this.iscan){j.remove()}}delete this.frame_painter_ref;delete this.pads_cache;this.painters=[];this.pad=null;this.draw_object=null;this.pad_frame=null;this.this_pad_name="";this.has_canvas=false;a.TObjectPainter.prototype.Cleanup.call(this)};b.prototype.CleanPrimitives=function(j){if(!j||(typeof j!=="function")){return}for(var l=this.painters.length-1;l>=0;--l){var m=this.painters[l];if(j(m)){m.Cleanup();this.painters.splice(l--,1)}}};b.prototype.ForEachPainterInPad=function(l,n){if(!n){n="all"}if(n!="objects"){l(this)}for(var j=0;j<this.painters.length;++j){var m=this.painters[j];if(typeof m.ForEachPainterInPad==="function"){if(n!="objects"){m.ForEachPainterInPad(l,n)}}else{if(n!="pads"){l(m)}}}};b.prototype.ButtonSize=function(j){return Math.round((!j?1:j)*(this.iscan||!this.has_canvas?16:12))};b.prototype.IsTooltipAllowed=function(){var j=undefined;this.ForEachPainterInPad(function(k){if((j===undefined)&&(k.tooltip_allowed!==undefined)){j=k.tooltip_allowed}});return j};b.prototype.SetTooltipAllowed=function(j){this.ForEachPainterInPad(function(k){if(k.tooltip_allowed!==undefined){k.tooltip_allowed=j}})};b.prototype.RegisterForPadEvents=function(j){this.pad_events_receiver=j};b.prototype.SelectObjectPainter=function(m,n){var k=(this.iscan||!this.has_canvas),l=k?this:this.canv_painter(),j=m instanceof b?m:m.pad_painter();if(n&&!k){this.CalcAbsolutePosition(this.svg_pad(this.this_pad_name),n)}if(typeof l.SelectActivePad=="function"){l.SelectActivePad(j,m,n)}if(l.pad_events_receiver){l.pad_events_receiver({what:"select",padpainter:j,painter:m,position:n})}};b.prototype.CreateCanvasSvg=function(m,j){var p=null,n=null,o=5,q=null,k;if(m>0){if(this._fixed_size){return(m>1)}n=this.svg_canvas();if(n.empty()){return false}p=n.property("height_factor");q=this.check_main_resize(m,null,p);if(!q.changed){return false}k=this.svg_layer("btns_layer")}else{var l=this.select_main();if(l.style("position")=="static"){l.style("position","relative")}n=l.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("mainpainter",null).property("current_pad","").property("redraw_by_resize",false);n.append("svg:title").text("ROOT canvas");var r=n.append("svg:rect").attr("class","canvas_fillrect").attr("x",0).attr("y",0);if(!a.BatchMode){r.style("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}n.append("svg:g").attr("class","primitives_layer");n.append("svg:g").attr("class","info_layer");k=n.append("svg:g").attr("class","btns_layer").property("leftside",a.gStyle.ToolBarSide=="left").property("vertical",a.gStyle.ToolBarVert);if(a.gStyle.ContextMenu){n.select(".canvas_fillrect").on("contextmenu",this.ShowContextMenu.bind(this))}p=0.66;if(this.pad&&this.pad.fCw&&this.pad.fCh&&(this.pad.fCw>0)){p=this.pad.fCh/this.pad.fCw;if((p<0.1)||(p>10)){p=0.66}}if(this._fixed_size){l.style("overflow","auto");q={width:this.pad.fCw,height:this.pad.fCh}}else{q=this.check_main_resize(2,j,p)}}if((q.width<=o)||(q.height<=o)){n.style("display","none");console.warn("Hide canvas while geometry too small w=",q.width," h=",q.height);q.width=200;q.height=100}else{n.style("display",null)}if(this._fixed_size){n.attr("x",0).attr("y",0).attr("width",q.width).attr("height",q.height).style("position","absolute")}else{n.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0)}n.attr("viewBox","0 0 "+q.width+" "+q.height).attr("preserveAspectRatio","none").property("height_factor",p).property("draw_x",0).property("draw_y",0).property("draw_width",q.width).property("draw_height",q.height);this._fast_drawing=a.gStyle.SmallPad&&((q.width<a.gStyle.SmallPad.width)||(q.height<a.gStyle.SmallPad.height));this.AlignBtns(k,q.width,q.height,n);return true};b.prototype.EnlargePad=function(){if(i.event){i.event.preventDefault();i.event.stopPropagation()}var l=this.svg_canvas(),j=l.property("pad_enlarged");if(this.iscan||!this.has_canvas||(!j&&!this.HasObjectsToDraw()&&!this.painters)){if(this._fixed_size){return}if(!this.enlarge_main("toggle")){return}if(this.enlarge_main("state")=="off"){l.property("pad_enlarged",null)}}else{if(!j){this.enlarge_main(true,true);l.property("pad_enlarged",this.pad)}else{if(j===this.pad){this.enlarge_main(false);l.property("pad_enlarged",null)}else{console.error("missmatch with pad double click events")}}}var k=this._fast_drawing;this.CheckResize({force:true});if(this._fast_drawing!=k){this.ShowButtons()}};b.prototype.CreatePadSvg=function(z){if(!this.has_canvas){this.CreateCanvasSvg(z?2:0);return true}var k=this.svg_pad(),v=this.svg_canvas(),j=k.property("draw_width"),u=k.property("draw_height"),n=v.property("pad_enlarged"),t=!n||(n===this.pad),s=j,p=u,r=0,q=0,l=null,o=null,m=null;if(this.pad&&this.pad.fDrawOpts&&this.pad.fSize){s=Math.round(j*this.pad.fSize.fHoriz.fNormal.fVal);p=Math.round(u*this.pad.fSize.fVert.fNormal.fVal);r=Math.round(j*this.pad.fDrawOpts.fPos.fAttr.fHoriz.fNormal.fVal);q=Math.round(u*this.pad.fDrawOpts.fPos.fAttr.fVert.fNormal.fVal)}if(n===this.pad){s=j;p=u;r=q=0}if(z){l=this.svg_pad(this.this_pad_name);o=l.select(".root_pad_border");m=this.svg_layer("btns_layer",this.this_pad_name)}else{l=k.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,true).attr("pad",this.this_pad_name).property("pad_painter",this).property("mainpainter",null);o=l.append("svg:rect").attr("class","root_pad_border");l.append("svg:g").attr("class","primitives_layer");m=l.append("svg:g").attr("class","btns_layer").property("leftside",a.gStyle.ToolBarSide!="left").property("vertical",a.gStyle.ToolBarVert);if(a.gStyle.ContextMenu){o.on("contextmenu",this.ShowContextMenu.bind(this))}if(!a.BatchMode){o.attr("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:this.pad.fBorderMode==0?"none":""});l.attr("display",t?null:"none").attr("viewBox","0 0 "+s+" "+p).attr("preserveAspectRatio","none").attr("x",r).attr("y",q).attr("width",s).attr("height",p).property("draw_x",r).property("draw_y",q).property("draw_width",s).property("draw_height",p);o.attr("x",0).attr("y",0).attr("width",s).attr("height",p).call(this.fillatt.func).call(this.lineatt.func);this._fast_drawing=a.gStyle.SmallPad&&((s<a.gStyle.SmallPad.width)||(p<a.gStyle.SmallPad.height));if(l.property("can3d")===1){this.select_main().select(".draw3d_"+this.this_pad_name).style("display",t?"":"none")}this.AlignBtns(m,s,p);return t};b.prototype.RemovePrimitive=function(k){if(!this.pad||!this.pad.fPrimitives){return}var j=this.pad.fPrimitives.arr.indexOf(k);if(j>=0){this.pad.fPrimitives.RemoveAt(j)}};b.prototype.FindPrimitive=function(n,m,j){if(!this.pad||!this.pad.fPrimitives){return null}for(var k=0;k<this.pad.fPrimitives.arr.length;k++){var l=this.pad.fPrimitives.arr[k];if((n!==null)&&(l!==n)){continue}if((m!==undefined)&&(m!==null)){if(l._typename!==m){continue}}if((j!==undefined)&&(j!==null)){if(l.fName!==j){continue}}return l}return null};b.prototype.HasObjectsToDraw=function(){var j=this.pad?this.pad.fPrimitives:null;if(j){for(var k=0;k<j.length;++k){if(j[k]&&j[k]._typename!="ROOT::Experimental::RPadDisplayItem"){return true}}}return false};b.prototype.DrawPrimitives=function(k,o,j){if(k===0){this._doing_pad_draw=true;if(this.iscan){this._start_tm=this._lasttm_tm=new Date().getTime()}this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.length:0}while(true){if(j&&(typeof j=="object")){j._primitive=true}if(!this.pad||(k>=this.pad.fPrimitives.length)){delete this._doing_pad_draw;delete this._current_primitive_indx;if(this._start_tm){var m=new Date().getTime()-this._start_tm;if(m>3000){console.log("Canvas drawing took "+(m*0.001).toFixed(2)+"s")}delete this._start_tm;delete this._lasttm_tm}return a.CallBack(o)}var l={func:this.DrawPrimitives.bind(this,k+1,o)};this._current_primitive_indx=k;j=a.draw(this.divid,this.pad.fPrimitives[k],"",l);k++;if(!l.completed){return}if(!a.BatchMode&&this.iscan){var n=new Date().getTime();if(n>this._lasttm_tm+500){this._lasttm_tm=n;j._primitive=true;return requestAnimationFrame(l.func)}}}};b.prototype.GetTooltips=function(l){var j=[],k=[];if(this.painters!==null){this.painters.forEach(function(m){if("ProcessTooltip" in m){j.push(m)}})}if(l){l.nproc=j.length}j.forEach(function(m){var n=m.ProcessTooltip(l);if(!n){n={user_info:null}}k.push(n);if(n&&l&&l.painters){n.painter=m}});return k};b.prototype.FillContextMenu=function(m){if(this.pad){m.add("header: "+this.pad._typename+"::"+this.pad.fName)}else{m.add("header: Canvas")}var l=this.IsTooltipAllowed();if(l!==undefined){m.addchk(l,"Show tooltips",this.SetTooltipAllowed.bind(this,!l))}if(!this._websocket){function j(p){this.pad[p]=this.pad[p]?0:1;var o=this.svg_pad(this.this_pad_name).property("mainpainter");if(o&&(typeof o.DrawGrids=="function")){o.DrawGrids()}}function k(p){this.pad[p.substr(1)]=parseInt(p[0]);var o=this.svg_pad(this.this_pad_name).property("mainpainter");if(o&&(typeof o.DrawAxes=="function")){o.DrawAxes()}}m.addchk(this.pad.fGridx,"Grid x","fGridx",j);m.addchk(this.pad.fGridy,"Grid y","fGridy",j);m.add("sub:Ticks x");m.addchk(this.pad.fTickx==0,"normal","0fTickx",k);m.addchk(this.pad.fTickx==1,"ticks on both sides","1fTickx",k);m.addchk(this.pad.fTickx==2,"labels up","2fTickx",k);m.add("endsub:");m.add("sub:Ticks y");m.addchk(this.pad.fTicky==0,"normal","0fTicky",k);m.addchk(this.pad.fTicky==1,"ticks on both side","1fTicky",k);m.addchk(this.pad.fTicky==2,"labels right","2fTicky",k);m.add("endsub:");this.FillAttContextMenu(m)}m.add("separator");if(this.ToggleEventStatus){m.addchk(this.HasEventStatus(),"Event status",this.ToggleEventStatus.bind(this))}if(this.enlarge_main()||(this.has_canvas&&this.HasObjectsToDraw())){m.addchk((this.enlarge_main("state")=="on"),"Enlarge "+(this.iscan?"canvas":"pad"),this.EnlargePad.bind(this))}var n=this.this_pad_name;if(n.length===0){n=this.iscan?"canvas":"pad"}m.add("Save as "+n+".png",n+".png",this.SaveAs.bind(this,"png",false));m.add("Save as "+n+".svg",n+".svg",this.SaveAs.bind(this,"svg",false));return true};b.prototype.ShowContextMenu=function(l){if(!l){var k=i.mouse(this.svg_pad(this.this_pad_name).node());if(k&&(k.length==2)&&(k[0]>0)&&(k[0]<10)&&(k[1]>0)&&k[1]<10){return}i.event.stopPropagation();i.event.preventDefault();l=i.event;var j=this.frame_painter();if(j){j.SetLastEventPos()}}a.Painter.createMenu(this,function(m){m.painter.FillContextMenu(m);m.painter.FillObjectExecMenu(m,"",function(){m.show(l)})})};b.prototype.Redraw=function(j){if(this._doing_pad_draw){return console.log("Prevent redrawing",this.pad.fName)}var m=true;if(this.iscan){this.CreateCanvasSvg(2)}else{m=this.CreatePadSvg(true)}for(var k=0;k<this.painters.length;++k){var l=this.painters[k];if(m||l.this_pad_name){l.Redraw(j)}}};b.prototype.NumDrawnSubpads=function(){if(this.painters===undefined){return 0}var j=0;for(var k=0;k<this.painters.length;++k){var l=this.painters[k].GetObject();if(l&&(l._typename==="TPad")){j++}}return j};b.prototype.RedrawByResize=function(){if(this.access_3d_kind()===1){return true}for(var j=0;j<this.painters.length;++j){if(typeof this.painters[j].RedrawByResize==="function"){if(this.painters[j].RedrawByResize()){return true}}}return false};b.prototype.CheckCanvasResize=function(k,l){if(!this.iscan&&this.has_canvas){return false}if((k===true)||(k===false)){l=k;k=null}if(k&&(typeof k==="object")&&k.force){l=true}if(!l){l=this.RedrawByResize()}var m=this.CreateCanvasSvg(l?2:1,k);if(m){for(var j=0;j<this.painters.length;++j){this.painters[j].Redraw(l?false:true)}}return m};b.prototype.UpdateObject=function(j){if(!j){return false}this.pad.fCw=j.fCw;this.pad.fCh=j.fCh;this.pad.fTitle=j.fTitle;return true};b.prototype.DrawNextSnap=function(o,p,l,w){if(p===-1){this._doing_pad_draw=true;this._snaps_map={};this._num_primitives=o?o.length:0}if(w==="workaround"){--p;w=null}while(true){if(w&&o&&o[p]&&w.snapid===undefined){if(this.painters.indexOf(w)<0){this.painters.push(w)}w.snapid=o[p].fObjectID}w=null;++p;if(!o||p>=o.length){delete this._doing_pad_draw;delete this._snaps_map;delete this._current_primitive_indx;return a.CallBack(l,this)}var m=o[p],u=m.fObjectID,j=this._snaps_map[u];if(j){j++}else{j=1}this._snaps_map[u]=j;this._current_primitive_indx=p;for(var n=0;n<this.painters.length;++n){if(this.painters[n].snapid===u){if(--j===0){w=this.painters[n];break}}}var v=this.DrawNextSnap.bind(this,o,p,l);if(w){if(m._typename=="ROOT::Experimental::RPadDisplayItem"){return w.RedrawPadSnap(m,v)}if(w.UpdateObject(m.fObject,m.fOption||"")){w.Redraw()}continue}if(m._typename=="ROOT::Experimental::RPadDisplayItem"){var t=m;var r=new b(t,false);r.DecodeOptions("");r.SetDivId(this.divid);r.snapid=m.fObjectID;r.CreatePadSvg();if(m.fPrimitives&&m.fPrimitives.length>0){r.AddButton(a.ToolbarIcons.camera,"Create PNG","PadSnapShot");r.AddButton(a.ToolbarIcons.circle,"Enlarge pad","EnlargePad");if(a.gStyle.ContextMenu){r.AddButton(a.ToolbarIcons.question,"Access context menus","PadContextMenus")}}var s=r.CurrentPadName(r.this_pad_name);r.DrawNextSnap(m.fPrimitives,-1,function(){r.CurrentPadName(s);v(r)});return}var q={func:v};if(m._typename==="ROOT::Experimental::RObjectDisplayItem"){if(!this.frame_painter()){return a.draw(this.divid,{_typename:"TFrame",$dummy:true},"",function(){q.func("workaround")})}}w=a.draw(this.divid,m.fObject,m.fOption||"",q);if(!q.completed){return}}};b.prototype.FindSnap=function(m){if(this.snapid===m){return this}if(!this.painters){return null}for(var j=0;j<this.painters.length;++j){var l=this.painters[j];if(typeof l.FindSnap==="function"){l=l.FindSnap(m)}else{if(l.snapid!==m){l=null}}if(l){return l}}return null};b.prototype.AddOnlineButtons=function(){this.AddButton(a.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");if(a.gStyle.ContextMenu){this.AddButton(a.ToolbarIcons.question,"Access context menus","PadContextMenus")}if(this.enlarge_main("verify")){this.AddButton(a.ToolbarIcons.circle,"Enlarge canvas","EnlargePad")}};b.prototype.RedrawPadSnap=function(n,l){if(!n||!n.fPrimitives){return}var p={fCw:n.fWinSize[0].fVal,fCh:n.fWinSize[1].fVal,fTitle:n.fTitle};if(this.batch_mode&&this.iscan&&(!p.fCw||!p.fCh)){p.fCw=900;p.fCh=700}if(this.iscan&&n.fTitle&&document){document.title=n.fTitle}if(this.iscan&&n.fTitle&&document){document.title=n.fTitle}if(this.snapid===undefined){this.snapid=n.fObjectID;this.draw_object=p;this.pad=p;this.pad_frame=n.fFrame;if(this.batch_mode&&this.iscan){this._fixed_size=true}this.CreateCanvasSvg(0);this.SetDivId(this.divid);this.AddOnlineButtons();this.DrawNextSnap(n.fPrimitives,-1,l);return}this.UpdateObject(p);if(this.iscan){this.CreateCanvasSvg(2)}else{this.CreatePadSvg(true)}var m=false;for(var o=0;o<this.painters.length;++o){var j=this.painters[o];if(j.snapid===undefined){continue}for(var q=0;q<n.fPrimitives.length;++q){if(n.fPrimitives[q].fObjectID===j.snapid){j=null;m=true;break}}if(j){this.painters.splice(o--,1);j.Cleanup()}}if(!m){var s=this.svg_pad(this.this_pad_name),r=this.frame_painter();if(s&&!s.empty()){s.property("mainpainter",null)}for(var o=0;o<this.painters.length;++o){if(r!==this.painters[o]){this.painters[o].Cleanup()}}this.painters=[];if(r){this.painters.push(r);r.CleanDrawings()}this.RemoveButtons();this.AddOnlineButtons()}var t=this,u=t.CurrentPadName(t.this_pad_name);t.DrawNextSnap(n.fPrimitives,-1,function(){t.CurrentPadName(u);l(t)})};b.prototype.CreateImage=function(k,j){if(k=="pdf"){a.CallBack(j,btoa("dummy PDF file"))}else{if((k=="png")||(k=="jpeg")||(k=="svg")){this.ProduceImage(true,k,function(l){if((k=="svg")||!l){return a.CallBack(j,l)}var m=l.indexOf("base64,");a.CallBack(j,(m>0)?l.substr(m+7):"")})}else{a.CallBack(j,"")}}};b.prototype.ItemContextMenu=function(k){var n=this.svg_pad(this.this_pad_name).node().getBoundingClientRect();var o={clientX:n.left+10,clientY:n.top+10};if(k=="pad"){return setTimeout(this.ShowContextMenu.bind(this,o),50)}var j=null,m;switch(k){case"xaxis":case"yaxis":case"zaxis":j=this.main_painter();m=k[0];break;case"frame":j=this.frame_painter();break;default:var l=parseInt(k);if(!isNaN(l)){j=this.painters[l]}}if(!j||(typeof j.FillContextMenu!=="function")){return}a.Painter.createMenu(j,function(p){if(j.FillContextMenu(p,m)){setTimeout(p.show.bind(p,o),50)}})};b.prototype.SaveAs=function(k,l,j){if(!j){j=this.this_pad_name;if(j.length===0){j=this.iscan?"canvas":"pad"}j+="."+k}this.ProduceImage(l,k,function(m){var n=document.createElement("a");n.download=j;n.href=(k!="svg")?m:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(m);document.body.appendChild(n);n.addEventListener("click",function(o){n.parentNode.removeChild(n)});n.click()})};b.prototype.ProduceImage=function(q,p,o){var w=(q==="frame");var l=w?this.svg_frame():(q?this.svg_canvas():this.svg_pad(this.this_pad_name));if(l.empty()){return a.CallBack(o)}var u=(q&&!w)?this.canv_painter():this;var s=[];if(!w){u.ForEachPainterInPad(function(y){var G={prnt:y.svg_pad(y.this_pad_name)};s.push(G);var B=y.svg_layer("btns_layer",y.this_pad_name);G.btns_node=B.node();if(G.btns_node){G.btns_prnt=G.btns_node.parentNode;G.btns_next=G.btns_node.nextSibling;B.remove()}var z=y.frame_painter_ref;if(!z||(typeof z.Render3D!=="function")){return}var F=z.access_3d_kind();if((F!==1)&&(F!==2)){return}var A=z.size_for_3d(2);var E=(F==2)?E:z.size_for_3d(1);var x=z.renderer.domElement;z.Render3D(0);var D=x.toDataURL("image/png");if(F==2){G.foreign=G.prnt.select("."+A.clname);G.foreign.remove()}var C=z.svg_frame();G.frame_node=C.node();if(G.frame_node){G.frame_next=G.frame_node.nextSibling;C.remove()}G.img=G.prnt.insert("image",".primitives_layer").attr("x",A.x).attr("y",A.y).attr("width",x.width).attr("height",x.height).attr("href",D)},"pads")}function j(x){x=encodeURIComponent(x);x=x.replace(/%([0-9A-F]{2})/g,function(y,z){var A=String.fromCharCode("0x"+z);return A==="%"?"%25":A});return decodeURIComponent(x)}function t(z){for(var y=0;y<s.length;++y){var A=s[y];if(A.img){A.img.remove()}var x=A.prnt.select(".primitives_layer");if(A.foreign){A.prnt.node().insertBefore(A.foreign.node(),x.node())}if(A.frame_node){x.node().insertBefore(A.frame_node,A.frame_next)}if(A.btns_node){A.btns_prnt.insertBefore(A.btns_node,A.btns_next)}}a.CallBack(o,z)}var k=l.property("draw_width"),v=l.property("draw_height");if(w){k=this.frame_width();v=this.frame_height()}var r='<svg width="'+k+'" height="'+v+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+l.node().innerHTML+"</svg>";if(p=="svg"){return t(r)}var n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';var m=new Image();m.onload=function(){var x=document.createElement("canvas");x.width=m.width;x.height=m.height;var y=x.getContext("2d");y.drawImage(m,0,0);t(x.toDataURL("image/"+p))};m.onerror=function(x){console.log("IMAGE ERROR",x);t(null)};m.src="data:image/svg+xml;base64,"+window.btoa(j(n+r))};b.prototype.PadButtonClick=function(j){if(j=="CanvasSnapShot"){return this.SaveAs("png",true)}if(j=="EnlargePad"){return this.EnlargePad()}if(j=="PadSnapShot"){return this.SaveAs("png",false)}if(j=="PadContextMenus"){i.event.preventDefault();i.event.stopPropagation();if(a.Painter.closeMenu()){return}var m=this,o=i.event;a.Painter.createMenu(m,function(u){u.add("header:Menus");if(m.iscan){u.add("Canvas","pad",m.ItemContextMenu)}else{u.add("Pad","pad",m.ItemContextMenu)}if(m.frame_painter()){u.add("Frame","frame",m.ItemContextMenu)}var p=m.main_painter();if(p){u.add("X axis","xaxis",m.ItemContextMenu);u.add("Y axis","yaxis",m.ItemContextMenu);if((typeof p.Dimension==="function")&&(p.Dimension()>1)){u.add("Z axis","zaxis",m.ItemContextMenu)}}if(m.painters&&(m.painters.length>0)){u.add("separator");var s=[];for(var v=0;v<m.painters.length;++v){var q=m.painters[v];var t=q?q.GetObject():null;if(!t||(s.indexOf(t)>=0)){continue}var r=("_typename" in t)?(t._typename+"::"):"";if("fName" in t){r+=t.fName}if(r.length==0){r="item"+v}u.add(r,v,m.ItemContextMenu)}}u.show(o)});return}var l=false;for(var n=0;n<this.painters.length;++n){var k=this.painters[n];if(typeof k.PadButtonClick=="function"){k.PadButtonClick(j)}if(!l&&(typeof k.ButtonClick=="function")){l=k.ButtonClick(j)}}};b.prototype.FindButton=function(l){var k=this.svg_layer("btns_layer",this.this_pad_name),j="";if(!k.empty()){k.selectAll("svg").each(function(){if(i.select(this).attr("key")===l){j=i.select(this).attr("name")}})}return j};b.prototype.toggleButtonsVisibility=function(m){var n=this.svg_layer("btns_layer",this.this_pad_name),k=n.select("[name='Toggle']");if(k.empty()){return}var l=k.property("buttons_state");if(k.property("timout_handler")){if(m!=="timeout"){clearTimeout(k.property("timout_handler"))}k.property("timout_handler",null)}var j=false;switch(m){case"enable":j=true;break;case"enterbtn":return;case"timeout":j=false;break;case"toggle":l=!l;k.property("buttons_state",l);j=l;break;case"disable":case"leavebtn":if(!l){k.property("timout_handler",setTimeout(this.toggleButtonsVisibility.bind(this,"timeout"),500))}return}n.selectAll("svg").each(function(){if(this===k.node()){return}i.select(this).style("display",j?"":"none")})};b.prototype.RemoveButtons=function(){var j=this.svg_layer("btns_layer",this.this_pad_name);if(!j.empty()){j.selectAll("*").remove();j.property("nextx",null)}};b.prototype.RemoveButtons=function(){var j=this.svg_layer("btns_layer",this.this_pad_name);if(!j.empty()){j.selectAll("*").remove();j.property("nextx",null)}};b.prototype.AddButton=function(p,m,j,o){if(!a.gStyle.ToolBar){return}if(!this._buttons){this._buttons=[]}for(var l=0;l<this._buttons.length;++l){if(this._buttons[l].funcname==j){return}}this._buttons.push({btn:p,tooltip:m,funcname:j,keyname:o});var n=this.iscan||!this.has_canvas;if(!n&&(j.indexOf("Pad")!=0)&&(j!=="EnlargePad")){var q=this.canv_painter();if(q&&(q!==this)){q.AddButton(p,m,j)}}};b.prototype.ShowButtons=function(){if(!this._buttons){return}var q=this.svg_layer("btns_layer",this.this_pad_name);if(q.empty()){return}q.selectAll("*").remove();var n=this.iscan||!this.has_canvas,p,j=q.property("leftside")?this.ButtonSize(1.25):0,r=0;if(this._fast_drawing){p=a.ToolbarIcons.CreateSVG(q,a.ToolbarIcons.circle,this.ButtonSize(),"EnlargePad");p.attr("name","Enlarge").attr("x",0).attr("y",0).on("click",this.PadButtonClick.bind(this,"EnlargePad"))}else{p=a.ToolbarIcons.CreateSVG(q,a.ToolbarIcons.rect,this.ButtonSize(),"Toggle tool buttons");p.attr("name","Toggle").attr("x",0).attr("y",0).property("buttons_state",(a.gStyle.ToolBar!=="popup")).on("click",this.toggleButtonsVisibility.bind(this,"toggle")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enable")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"disable"));for(var m=0;m<this._buttons.length;++m){var o=this._buttons[m];var l=a.ToolbarIcons.CreateSVG(q,o.btn,this.ButtonSize(),o.tooltip+(n?"":(" on pad "+this.this_pad_name))+(o.keyname?" (keyshortcut "+o.keyname+")":""));if(q.property("vertical")){l.attr("x",r).attr("y",j)}else{l.attr("x",j).attr("y",r)}l.attr("name",o.funcname).style("display",(p.property("buttons_state")?"":"none")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enterbtn")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"leavebtn"));if(o.keyname){l.attr("key",o.keyname)}l.on("click",this.PadButtonClick.bind(this,o.funcname));j+=this.ButtonSize(1.25)}}q.property("nextx",j);this.AlignBtns(q,this.pad_width(this.this_pad_name),this.pad_height(this.this_pad_name));if(q.property("vertical")){p.attr("y",j)}else{if(!q.property("leftside")){p.attr("x",j)}}};b.prototype.AlignBtns=function(n,m,k,l){var q=this.ButtonSize(1.25),p=(n.property("nextx")||0)+q,j,o;if(n.property("vertical")){j=n.property("leftside")?2:(m-q);o=k-p}else{j=n.property("leftside")?2:(m-p);o=k-q}n.attr("transform","translate("+j+","+o+")")};b.prototype.DecodeOptions=function(j){var k=this.GetObject();if(!k){return}var l=new a.DrawOptions(j);if(l.check("WEBSOCKET")){this.OpenWebsocket()}if(!this.options){this.options={}}a.extend(this.options,{GlobalColors:true,LocalColors:false,IgnorePalette:false,RotateFrame:false,FixFrame:false});if(l.check("NOCOLORS")||l.check("NOCOL")){this.options.GlobalColors=this.options.LocalColors=false}if(l.check("LCOLORS")||l.check("LCOL")){this.options.GlobalColors=false;this.options.LocalColors=true}if(l.check("NOPALETTE")||l.check("NOPAL")){this.options.IgnorePalette=true}if(l.check("ROTATE")){this.options.RotateFrame=true}if(l.check("FIXFRAME")){this.options.FixFrame=true}if(l.check("WHITE")){k.fFillColor=0}if(l.check("LOGX")){k.fLogx=1}if(l.check("LOGY")){k.fLogy=1}if(l.check("LOGZ")){k.fLogz=1}if(l.check("LOG")){k.fLogx=k.fLogy=k.fLogz=1}if(l.check("GRIDX")){k.fGridx=1}if(l.check("GRIDY")){k.fGridy=1}if(l.check("GRID")){k.fGridx=k.fGridy=1}if(l.check("TICKX")){k.fTickx=1}if(l.check("TICKY")){k.fTicky=1}if(l.check("TICK")){k.fTickx=k.fTicky=1}};function f(n,m,k){var j=new b(m,false);j.DecodeOptions(k);j.SetDivId(n);if(j.svg_canvas().empty()){j.has_canvas=false;j.this_pad_name=""}j.CreatePadSvg();if(j.MatchObjectType("TPad")&&(!j.has_canvas||j.HasObjectsToDraw())){j.AddButton(a.ToolbarIcons.camera,"Create PNG","PadSnapShot");if((j.has_canvas&&j.HasObjectsToDraw())||j.enlarge_main("verify")){j.AddButton(a.ToolbarIcons.circle,"Enlarge pad","EnlargePad")}if(a.gStyle.ContextMenu){j.AddButton(a.ToolbarIcons.question,"Access context menus","PadContextMenus")}}var l=j.has_canvas?j.CurrentPadName(j.this_pad_name):undefined;j.DrawPrimitives(0,function(){j.ShowButtons();j.CurrentPadName(l);j.DrawingReady()});return j}function c(j){b.call(this,j,true);this._websocket=null}c.prototype=Object.create(b.prototype);c.prototype.ChangeLayout=function(s,m){var q=this.get_layout_kind();if(q==s){return a.CallBack(m,true)}var r=this.select_main("origin"),j=r.select(".side_panel"),o=this.select_main(),p=[];while(o.node().firstChild){p.push(o.node().removeChild(o.node().firstChild))}if(!j.empty()){a.cleanup(j.node())}this.set_layout_kind("simple");r.html("");if(s=="simple"){o=r;for(var n=0;n<p.length;++n){o.node().appendChild(p[n])}this.set_layout_kind(s);return a.CallBack(m,true)}var l=this;a.AssertPrerequisites("jq2d",function(){var u=new a.GridDisplay(r.node(),s);if(s.indexOf("vert")==0){o=i.select(u.GetFrame(0));j=i.select(u.GetFrame(1))}else{o=i.select(u.GetFrame(1));j=i.select(u.GetFrame(0))}o.classed("central_panel",true).style("position","relative");j.classed("side_panel",true).style("position","relative");for(var t=0;t<p.length;++t){o.node().appendChild(p[t])}l.set_layout_kind(s,".central_panel");a.CallBack(m,true)})};c.prototype.ToggleProjection=function(j,l){delete this.proj_painter;if(j){this.proj_painter=1}if(this.use_openui&&this.ShowUI5ProjectionArea){return this.ShowUI5ProjectionArea(j,l)}var k="simple";if(j=="X"){k="vert2_31"}else{if(j=="Y"){k="horiz2_13"}}this.ChangeLayout(k,l)};c.prototype.DrawProjection=function(m,p){if(!this.proj_painter){return}if(this.proj_painter===1){var q=a.Create("TCanvas"),k=this,o=this.root_pad(),j=this.main_painter(),l;if(m=="X"){q.fLeftMargin=o.fLeftMargin;q.fRightMargin=o.fRightMargin;q.fLogx=j.logx?1:0;q.fUxmin=j.logx?a.log10(j.scale_xmin):j.scale_xmin;q.fUxmax=j.logx?a.log10(j.scale_xmax):j.scale_xmax;l="fixframe"}else{q.fBottomMargin=o.fBottomMargin;q.fTopMargin=o.fTopMargin;q.fLogx=j.logy?1:0;q.fUxmin=j.logy?a.log10(j.scale_ymin):j.scale_ymin;q.fUxmax=j.logy?a.log10(j.scale_ymax):j.scale_ymax;l="rotate"}q.fPrimitives.Add(p,"hist");if(this.use_openui&&this.DrawInUI5ProjectionArea){this.DrawInUI5ProjectionArea(q,l,function(r){k.proj_painter=r})}else{this.DrawInSidePanel(q,l,function(r){k.proj_painter=r})}}else{var n=this.proj_painter.main_painter();if(n){n.UpdateObject(p,"hist")}this.proj_painter.RedrawPad()}};c.prototype.DrawInSidePanel=function(m,k,l){var j=this.select_main("origin").select(".side_panel");if(j.empty()){return a.CallBack(l,null)}a.draw(j.node(),m,k,l)};c.prototype.ShowMessage=function(j){a.progress(j,7000)};c.prototype.SaveCanvasAsFile=function(l){var j=this,k=l.indexOf(".");this.CreateImage(l.substr(k+1),function(m){j.SendWebsocket("SAVE:"+l+":"+m)})};c.prototype.SendSaveCommand=function(j){this.SendWebsocket("PRODUCE:"+j)};c.prototype.SendWebsocket=function(k,j){if(this._websocket){this._websocket.Send(k,j)}};c.prototype.CloseWebsocket=function(j){if(this._websocket){this._websocket.Close(j);this._websocket.Cleanup();delete this._websocket}};c.prototype.OpenWebsocket=function(j){this.CloseWebsocket();this._websocket=new a.WebWindowHandle(j);this._websocket.SetReceiver(this);this._websocket.Connect()};c.prototype.UseWebsocket=function(j){this.CloseWebsocket();this._websocket=j;console.log("Use websocket",this._websocket.key);this._websocket.SetReceiver(this);this._websocket.Connect()};c.prototype.WindowBeforeUnloadHanlder=function(){this.CloseWebsocket(true)};c.prototype.OnWebsocketOpened=function(j){};c.prototype.OnWebsocketClosed=function(j){a.CloseCurrentWindow()};c.prototype.OnWebsocketMsg=function(B,p){console.log("GET MSG "+p.substr(0,30));if(p=="CLOSE"){this.OnWebsocketClosed();this.CloseWebsocket(true)}else{if(p.substr(0,5)=="SNAP:"){p=p.substr(5);var k=p.indexOf(":"),j=p.substr(0,k),y=a.parse(p.substr(k+1));this.RedrawPadSnap(y,function(){B.Send("SNAPDONE:"+j)})}else{if(p.substr(0,4)=="JSON"){var w=a.parse(p.substr(4));this.RedrawObject(w)}else{if(p.substr(0,5)=="MENU:"){p=p.substr(5);var k=p.indexOf(":"),t=p.substr(0,k),u=a.parse(p.substr(k+1));if(typeof this._getmenu_callback=="function"){this._getmenu_callback(u,t)}}else{if(p.substr(0,4)=="CMD:"){p=p.substr(4);var k=p.indexOf(":"),m=p.substr(0,k),A=p.substr(k+1),x="REPLY:"+m+":";if((A=="SVG")||(A=="PNG")||(A=="JPEG")){this.CreateImage(A.toLowerCase(),function(C){B.Send(x+C)})}else{if(A.indexOf("ADDPANEL:")==0){var z=A.substr(9);console.log("request panel = "+z);if(!this.ActivatePanel){B.Send(x+"false")}else{var o=new a.WebWindowHandle(B.kind);o.SetReceiver({cpainter:this,OnWebsocketOpened:function(C){console.log("Panel socket connected")},OnWebsocketMsg:function(C,D){var E=(D.indexOf("SHOWPANEL:")==0)?D.substr(10):"";console.log("Panel get message "+D+" show "+E);this.cpainter.ActivatePanel(E,C,function(F){B.Send(x+(F?"true":"false"))})},OnWebsocketClosed:function(C){B.Send(x+"false")},OnWebsocketError:function(C){B.Send(x+"false")}});var s=B.href;if(z.indexOf("../")==0){var l=s.lastIndexOf("/",s.length-2);s=s.substr(0,l)+z.substr(2)}else{s+=z}o.Connect(s)}}else{console.log("Unrecognized command "+A);B.Send(x)}}}else{if((p.substr(0,7)=="DXPROJ:")||(p.substr(0,7)=="DYPROJ:")){var q=p[1],n=a.parse(p.substr(7));this.DrawProjection(q,n)}else{if(p.substr(0,5)=="SHOW:"){var r=p.substr(5),v=r[r.length-1]=="1";this.ShowSection(r.substr(0,r.length-2),v)}else{console.log("unrecognized msg len:"+p.length+" msg:"+p.substr(0,20))}}}}}}}};c.prototype.ShowSection=function(k,j){switch(k){case"Menu":break;case"StatusBar":break;case"Editor":break;case"ToolBar":break;case"ToolTips":this.SetTooltipAllowed(j);break}};a.TCanvasStatusBits={kShowEventStatus:a.BIT(15),kAutoExec:a.BIT(16),kMenuBar:a.BIT(17),kShowToolBar:a.BIT(18),kShowEditor:a.BIT(19),kMoveOpaque:a.BIT(20),kResizeOpaque:a.BIT(21),kIsGrayscale:a.BIT(22),kShowToolTips:a.BIT(23)};c.prototype.CompeteCanvasSnapDrawing=function(){if(!this.pad){return}if(document){document.title=this.pad.fTitle}if(this._all_sections_showed){return}this._all_sections_showed=true;this.ShowSection("Menu",this.pad.TestBit(a.TCanvasStatusBits.kMenuBar));this.ShowSection("StatusBar",this.pad.TestBit(a.TCanvasStatusBits.kShowEventStatus));this.ShowSection("ToolBar",this.pad.TestBit(a.TCanvasStatusBits.kShowToolBar));this.ShowSection("Editor",this.pad.TestBit(a.TCanvasStatusBits.kShowEditor));this.ShowSection("ToolTips",this.pad.TestBit(a.TCanvasStatusBits.kShowToolTips))};c.prototype.HasEventStatus=function(){return this.has_event_status};c.prototype.GetNewColor=function(j,l){if(!j){return}var k=l?j:j.fAttr;if(!k.fKind){return"rgb("+Math.round(k.fRedOrPalettePos*255)+","+Math.round(k.fGreen*255)+","+Math.round(k.fBlue*255)+")"}return col};function e(n,m,l){var j=!m;if(j){console.log("No canvas specified");return null;m=a.Create("ROOT::Experimental::TCanvas")}var k=new c(m);k.normal_canvas=!j;k.SetDivId(n,-1);k.CreateCanvasSvg(0);k.SetDivId(n);k.AddButton(a.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");if(a.gStyle.ContextMenu){k.AddButton(a.ToolbarIcons.question,"Access context menus","PadContextMenus")}if(k.enlarge_main("verify")){k.AddButton(a.ToolbarIcons.circle,"Enlarge canvas","EnlargePad")}k.DrawPrimitives(0,function(){k.ShowButtons();k.DrawingReady()});return k}a.addDrawFunc({name:"ROOT::Experimental::RHistDrawable<1>",icon:"img_histo1d",prereq:"v7hist",func:"JSROOT.v7.drawHist1",opt:""});a.addDrawFunc({name:"ROOT::Experimental::RHistDrawable<2>",icon:"img_histo2d",prereq:"v7hist",func:"JSROOT.v7.drawHist2",opt:""});a.addDrawFunc({name:"ROOT::Experimental::RText",icon:"img_text",prereq:"v7more",func:"JSROOT.v7.drawText",opt:"",direct:true});a.addDrawFunc({name:"ROOT::Experimental::RLine",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawLine",opt:"",direct:true});a.addDrawFunc({name:"ROOT::Experimental::RBox",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawBox",opt:"",direct:true});a.addDrawFunc({name:"ROOT::Experimental::RMarker",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawMarker",opt:"",direct:true});a.v7.TAxisPainter=h;a.v7.TFramePainter=d;a.v7.TPadPainter=b;a.v7.TCanvasPainter=c;a.v7.drawFrame=g;a.v7.drawPad=f;a.v7.drawCanvas=e;return a}));